{
    "abstractText": "Background: Computational text phenotyping is the practice of identifying patients with certain disorders and traits from clinical notes. Rare diseases are challenging to be identified due to few cases available for machine learning and the need for data annotation from domain experts. Methods: We propose a method using ontologies and weak supervision, with recent pre-trained contextual representations from Bi-directional Transformers (e.g. BERT). The ontology-driven framework includes two steps: (i) Text-to-UMLS, extracting phenotypes by contextually linking mentions to concepts in Unified Medical Language System (UMLS), with a Named Entity Recognition and Linking (NER+L) tool, SemEHR, and weak supervision with customised rules and contextual mention representation; (ii) UMLS-to-ORDO, matching UMLS concepts to rare diseases in Orphanet Rare Disease Ontology (ORDO). The weakly supervised approach is proposed to learn a phenotype confirmation model to improve Text-to-UMLS linking, without annotated data from domain experts. We evaluated the approach on three clinical datasets, MIMIC-III discharge summaries, MIMIC-III radiology reports, and NHS Tayside brain imaging reports from two institutions in the US and the UK, with annotations. Results: The improvements in the precision were pronounced (by over 30% to 50% absolute score for Text-to-UMLS linking), with almost no loss of recall compared to the existing NER+L tool, SemEHR. Results on radiology reports from MIMIC-III and NHS Tayside were consistent with the discharge summaries. The overall pipeline processing clinical notes can extract rare disease cases, mostly uncaptured in structured data (manually assigned ICD codes). Conclusion: The study provides empirical evidence for the task by applying a weakly supervised NLP pipeline on clinical notes. The proposed weak supervised deep learning approach requires no human annotation except for validation and testing, by leveraging ontologies, NER+L tools, and contextual representations. The study also demonstrates that Natural Language Processing (NLP) can complement traditional ICD-based approaches to better estimate rare diseases in clinical notes. We discuss the usefulness and limitations of the weak supervision approach and propose directions for future studies.",
    "authors": [
        {
            "affiliations": [],
            "name": "Hang Dong"
        },
        {
            "affiliations": [],
            "name": "V\u0131\u0301ctor Su\u00e1rez-Paniagua"
        },
        {
            "affiliations": [],
            "name": "Huayu Zhang"
        },
        {
            "affiliations": [],
            "name": "Minhong Wang"
        },
        {
            "affiliations": [],
            "name": "Arlene Casey"
        },
        {
            "affiliations": [],
            "name": "Emma Davidson"
        },
        {
            "affiliations": [],
            "name": "Jiaoyan Chen"
        },
        {
            "affiliations": [],
            "name": "Beatrice Alex"
        },
        {
            "affiliations": [],
            "name": "William Whiteley"
        },
        {
            "affiliations": [],
            "name": "Honghan Wu"
        }
    ],
    "id": "SP:91a5dead9cb0cc1acbeddc5269f0dad95a443f7a",
    "references": [
        {
            "authors": [
                "S. Nguengang Wakap",
                "D.M. Lambert",
                "A. Olry",
                "C. Rodwell",
                "C. Gueydan",
                "V. Lanneau",
                "D. Murphy",
                "Y. Le Cam",
                "A. Rath"
            ],
            "title": "Estimating cumulative point prevalence of rare diseases: analysis of the orphanet database",
            "venue": "European Journal of Human Genetics 28(2), 165\u2013173",
            "year": 2020
        },
        {
            "authors": [
                "Department of Health",
                "Social Care"
            ],
            "title": "The UK Rare Diseases Framework",
            "venue": "(2021). https://www.gov.uk/government/publications/uk-rare-d iseases-framework/the-uk-rare-diseases-framework",
            "year": 2022
        },
        {
            "authors": [
                "Scottish Government"
            ],
            "title": "Illnesses and Long-term Conditions",
            "venue": "(2021). https://www.gov.scot/policies/illnesses-and-long-ter m-conditions/rare-diseases/",
            "year": 2021
        },
        {
            "authors": [
                "R.L. Richesson",
                "K.W. Fung",
                "O. Bodenreider"
            ],
            "title": "Coverage of rare disease names in clinical coding systems and ontologies and implications for electronic health records-based research",
            "venue": "Proceedings of the 5th International Conference on Biomedical Ontology, Houston, Texas, USA, pp. 78\u201380",
            "year": 2014
        },
        {
            "authors": [
                "E. Bearryman"
            ],
            "title": "Does Your Rare Disease Have a Code? (2016)",
            "venue": "https://www.eurordis.org/news/does-your-rare-disease -have-code",
            "year": 2021
        },
        {
            "authors": [
                "H. Dong",
                "V. Su\u00e1rez-Paniagua",
                "W. Whiteley",
                "H. Wu"
            ],
            "title": "Explainable automated coding of clinical notes using hierarchical label-wise attention networks and label embedding initialisation",
            "venue": "Journal of Biomedical Informatics, 103728",
            "year": 2021
        },
        {
            "authors": [
                "H. Dong",
                "V. Su\u00e1rez-Paniagua",
                "H. Zhang",
                "M. Wang",
                "E. Whitfield",
                "H. Wu"
            ],
            "title": "Rare disease identification from clinical notes with ontologies and weak supervision",
            "venue": "2021 43rd Annual International Conference of the IEEE Engineering in Medicine & Biology Society (EMBC), Online, pp. 2294\u20132298",
            "year": 2021
        },
        {
            "authors": [
                "C.E. Kahn Jr"
            ],
            "title": "An ontology-based approach to estimate the frequency of rare diseases in narrative-text radiology reports",
            "venue": "Studies in Health Technology and Informatics 245, 896\u2013900",
            "year": 2017
        },
        {
            "authors": [
                "D. Vasant",
                "L. Chanas",
                "J. Malone",
                "M. Hanauer",
                "A. Olry",
                "S. Jupp",
                "P.N. Robinson",
                "H. Parkinson",
                "A. Rath"
            ],
            "title": "ORDO: an ontology connecting rare disease, epidemiology and genetic data",
            "venue": "Bio-Ontology @ ISMB 2014, pp. 1\u20134",
            "year": 2014
        },
        {
            "authors": [
                "T. Groza",
                "S. K\u00f6hler",
                "D. Moldenhauer",
                "N. Vasilevsky",
                "G. Baynam",
                "T. Zemojtel",
                "L. Schriml",
                "W. Kibbe",
                "P. Schofield",
                "T. Beck",
                "D. Vasant",
                "A. Brookes",
                "A. Zankl",
                "N. Washington",
                "C. Mungall",
                "S. Lewis",
                "M.A. Haendel",
                "H. Parkinson",
                "P. Robinson"
            ],
            "title": "The human phenotype ontology: Semantic unification of common and rare disease",
            "venue": "The American Journal of Human Genetics 97(1), 111\u2013124",
            "year": 2015
        },
        {
            "authors": [
                "S. Maiella",
                "A. Olry",
                "M. Hanauer",
                "V. Lanneau",
                "H. Lourghi",
                "B. Donadille",
                "C. Rodwell",
                "S. K\u00f6hler",
                "D. Seelow",
                "S. Jupp",
                "H. Parkinson",
                "T. Groza",
                "M. Brudno",
                "P.N. Robinson",
                "A. Rath"
            ],
            "title": "Harmonising phenomics information for a better interoperability in the rare disease field",
            "venue": "European Journal of Medical Genetics 61(11), 706\u2013714",
            "year": 2018
        },
        {
            "authors": [
                "W. Shen",
                "J. Wang",
                "J. Han"
            ],
            "title": "Entity linking with a knowledge base: Issues, techniques, and solutions",
            "venue": "IEEE Transactions on Knowledge and Data Engineering 27(2), 443\u2013460",
            "year": 2015
        },
        {
            "authors": [
                "Y. Wang",
                "S. Sohn",
                "S. Liu",
                "F. Shen",
                "L. Wang",
                "E.J. Atkinson",
                "S. Amin",
                "H. Liu"
            ],
            "title": "A clinical text classification paradigm using weak supervision and deep representation",
            "venue": "BMC Medical Informatics and Decision Making 19(1), 1",
            "year": 2019
        },
        {
            "authors": [
                "A. Ratner",
                "P. Varma",
                "B. Hancock",
                "C. R\u00e9",
                "other members of Hazy Lab"
            ],
            "title": "Weak Supervision: A New Programming Paradigm for Machine Learning",
            "venue": "(2019). http://ai.stanford.edu/blog/weak-supervision/",
            "year": 2021
        },
        {
            "authors": [
                "H. Wu",
                "G. Toti",
                "K.I. Morley",
                "Z.M. Ibrahim",
                "A. Folarin",
                "R. Jackson",
                "I. Kartoglu",
                "A. Agrawal",
                "C. Stringer",
                "D. Gale",
                "G. Gorrell",
                "A. Roberts",
                "M. Broadbent",
                "R. Stewart",
                "R.J. Dobson"
            ],
            "title": "SemEHR: A general-purpose semantic search system to surface semantic data from clinical notes for tailored care, trial recruitment, and clinical research",
            "venue": "Journal of the American Medical Informatics Association 25(5), 530\u2013537",
            "year": 2018
        },
        {
            "authors": [
                "H. Wu",
                "K. Hodgson",
                "S. Dyson",
                "K. Morley",
                "Z. Ibrahim",
                "E. Iqbal",
                "R. Stewart",
                "R. Dobson",
                "C. Sudlow"
            ],
            "title": "Efficiently reusing natural language processing models for phenotype identification in free-text electronic medical records: Methodological study",
            "venue": "JMIR Medical Informatics 7(4), 1\u201314",
            "year": 2019
        },
        {
            "authors": [
                "P.J. Gorinski",
                "H. Wu",
                "C. Grover",
                "R. Tobin",
                "C. Talbot",
                "H. Whalley",
                "C. Sudlow",
                "W. Whiteley",
                "B. Alex"
            ],
            "title": "Named Entity Recognition for Electronic Health Records: A Comparison of Rule-based and Machine Learning Approaches",
            "venue": "arXiv preprint arXiv:1903.03985",
            "year": 2019
        },
        {
            "authors": [
                "G. Gorrell",
                "X. Song",
                "A. Roberts"
            ],
            "title": "Bio-yodie: A named entity linking system for biomedical text",
            "venue": "arXiv preprint arXiv:1811.04860",
            "year": 2018
        },
        {
            "authors": [
                "Y. Peng",
                "S. Yan",
                "Z. Lu"
            ],
            "title": "Transfer learning in biomedical natural language processing: An evaluation of bert and elmo on ten benchmarking datasets",
            "venue": "Proceedings of the 18th BioNLP Workshop and Shared Task, Florence, Italy, pp. 58\u201365",
            "year": 2019
        },
        {
            "authors": [
                "A.E.W. Johnson",
                "T.J. Pollard",
                "L. Shen",
                "Lehman",
                "L.-w.H.",
                "M. Feng",
                "M. Ghassemi",
                "B. Moody",
                "P. Szolovits",
                "L.A. Celi",
                "R.G. Mark"
            ],
            "title": "MIMIC-III, a freely accessible critical care database",
            "venue": "Scientific Data 3(1), 1\u20139",
            "year": 2016
        },
        {
            "authors": [
                "J. Pathak",
                "A.N. Kho",
                "J.C. Denny"
            ],
            "title": "Electronic health records-driven phenotyping: challenges, recent advances, and perspectives",
            "venue": "Journal of the American Medical Informatics Association 20(e2), 206\u2013211",
            "year": 2013
        },
        {
            "authors": [
                "Y. Chen",
                "R.J. Carroll",
                "E.R.M. Hinz",
                "A. Shah",
                "A.E. Eyler",
                "J.C. Denny",
                "H. Xu"
            ],
            "title": "Applying active learning to high-throughput phenotyping algorithms for electronic health records data",
            "venue": "Journal of the American Medical Informatics Association 20(e2), 253\u2013259",
            "year": 2013
        },
        {
            "authors": [
                "T. Searle",
                "Z. Ibrahim",
                "R. Dobson"
            ],
            "title": "Experimental evaluation and development of a silver-standard for the MIMIC-III clinical coding dataset",
            "venue": "Proceedings of BioNLP, pp. 76\u201385. Association for Computational Linguistics, Online",
            "year": 2020
        },
        {
            "authors": [
                "E. Ford",
                "J.A. Carroll",
                "H.E. Smith",
                "D. Scott",
                "J.A. Cassell"
            ],
            "title": "Extracting information from the text of electronic medical records to improve case detection: a systematic review",
            "venue": "Journal of the American Medical Informatics Association 23(5), 1007\u20131015",
            "year": 2016
        },
        {
            "authors": [
                "H. Harkema",
                "J.N. Dowling",
                "T. Thornblade",
                "W.W. Chapman"
            ],
            "title": "Context: An algorithm for determining negation, experiencer, and temporal status from clinical reports",
            "venue": "Journal of Biomedical Informatics 42(5), 839\u2013851",
            "year": 2009
        },
        {
            "authors": [
                "Z. Kraljevic",
                "T. Searle",
                "A. Shek",
                "L. Roguski",
                "K. Noor",
                "D. Bean",
                "A. Mascio",
                "L. Zhu",
                "A.A. Folarin",
                "A. Roberts",
                "R. Bendayan",
                "M.P. Richardson",
                "R. Stewart",
                "A.D. Shah",
                "W.K. Wong",
                "Z. Ibrahim",
                "J.T. Teo",
                "R.J.B. Dobson"
            ],
            "title": "Multi-domain clinical natural language processing with medcat: The medical concept annotation toolkit",
            "venue": "Artificial Intelligence in Medicine 117, 102083",
            "year": 2021
        },
        {
            "authors": [
                "M.G. Kersloot",
                "F.J.P. van Putten",
                "A. Abu-Hanna",
                "R. Cornet",
                "D.L. Arts"
            ],
            "title": "Natural language processing algorithms for mapping clinical text fragments onto ontology concepts: a systematic review and recommendations for future studies",
            "venue": "Journal of Biomedical Semantics 11(1), 14",
            "year": 2020
        },
        {
            "authors": [
                "M. Cusick",
                "P. Adekkanattu",
                "T.R. Campion",
                "E.T. Sholle",
                "A. Myers",
                "S. Banerjee",
                "G. Alexopoulos",
                "Y. Wang",
                "J. Pathak"
            ],
            "title": "Using weak supervision and deep learning to classify clinical notes for identification of current suicidal ideation",
            "venue": "Journal of Psychiatric Research 136, 95\u2013102",
            "year": 2021
        },
        {
            "authors": [
                "Z. Shen",
                "D. Schutte",
                "Y. Yi",
                "A. Bompelli",
                "F. Yu",
                "Y. Wang",
                "R. Zhang"
            ],
            "title": "Classifying the lifestyle status for alzheimer\u2019s disease from clinical notes using deep learning with weak supervision",
            "venue": "BMC medical Dong et al. Page 16 of 16 informatics and decision making 22(1), 1\u201311",
            "year": 2022
        },
        {
            "authors": [
                "J. Devlin",
                "Chang",
                "M.-W.",
                "K. Lee",
                "K. Toutanova"
            ],
            "title": "BERT: Pre-training of deep bidirectional transformers for language understanding",
            "venue": "Proceedings of NAACL-HLT, pp. 4171\u20134186. Association for Computational Linguistics, Minneapolis, Minnesota",
            "year": 2019
        },
        {
            "authors": [
                "A. Vaswani",
                "N. Shazeer",
                "N. Parmar",
                "J. Uszkoreit",
                "L. Jones",
                "A.N. Gomez",
                "\u0141. Kaiser",
                "I. Polosukhin"
            ],
            "title": "Attention is all you need",
            "venue": "Advances in Neural Information Processing Systems, Long Beach, CA, USA, pp. 5998\u20136008",
            "year": 2017
        },
        {
            "authors": [
                "Y. Gu",
                "R. Tinn",
                "H. Cheng",
                "M. Lucas",
                "N. Usuyama",
                "X. Liu",
                "T. Naumann",
                "J. Gao",
                "H. Poon"
            ],
            "title": "Domain-specific language model pretraining for biomedical natural language processing",
            "venue": "ACM Trans. Comput. Healthcare 3(1)",
            "year": 2021
        },
        {
            "authors": [
                "F. Liu",
                "E. Shareghi",
                "Z. Meng",
                "M. Basaldella",
                "N. Collier"
            ],
            "title": "Self-alignment pretraining for biomedical entity representations",
            "venue": "Proceedings of NAACL-HLT, pp. 4228\u20134238. Association for Computational Linguistics, Online",
            "year": 2021
        },
        {
            "authors": [
                "N.F. Noy"
            ],
            "title": "Ontology Mapping",
            "venue": "Staab, S., Studer, R. (eds.) Handbook on Ontologies. International Handbooks on Information Systems, pp. 573\u2013590. Springer, Berlin, Heidelberg",
            "year": 2009
        },
        {
            "authors": [
                "J. Euzenat",
                "P. Shvaiko"
            ],
            "title": "The Matching Problem",
            "venue": "Ontology Matching, pp. 25\u201354. Springer, Berlin, Heidelberg",
            "year": 2013
        },
        {
            "authors": [
                "J. Textoris",
                "M. Leone"
            ],
            "title": "Genetic Aspects of Uncommon Diseases",
            "venue": "Leone, M., Martin, C., Vincent, J.-L. (eds.) Uncommon Diseases in the ICU, pp. 3\u201311. Springer, Cham",
            "year": 2014
        },
        {
            "authors": [
                "S. Gururangan",
                "A. Marasovi\u0107",
                "S. Swayamdipta",
                "K. Lo",
                "I. Beltagy",
                "D. Downey",
                "N.A. Smith"
            ],
            "title": "Don\u2019t stop pretraining: Adapt language models to domains and tasks",
            "venue": "Proceedings of ACL, pp. 8342\u20138360. Association for Computational Linguistics, Online",
            "year": 2020
        },
        {
            "authors": [
                "X. Ma",
                "Z. Wang",
                "P. Ng",
                "R. Nallapati",
                "B. Xiang"
            ],
            "title": "Universal text representation from bert: An empirical study",
            "venue": "arXiv preprint arXiv:1910.07973",
            "year": 2019
        },
        {
            "authors": [
                "NZ Ministry of Health"
            ],
            "title": "Mapping Between ICD-10 and ICD-9",
            "venue": "(2000). https://www.health.govt.nz/nz-health-statistics/data -references/mapping-tools/mapping-between-icd-10-a nd-icd-9",
            "year": 2021
        },
        {
            "authors": [
                "NCBO BioPortal"
            ],
            "title": "International Classification of Diseases, Version 9 Clinical Modification",
            "venue": "(2021). https://bioportal.bioontology.org/ontologies/ICD9CM",
            "year": 2021
        },
        {
            "authors": [
                "D. Sykes",
                "A. Grivas",
                "C. Grover",
                "R. Tobin",
                "C. Sudlow",
                "W. Whiteley",
                "A. Mcintosh",
                "H. Whalley",
                "B. Alex"
            ],
            "title": "Comparison of rule-based and neural network models for negation detection in radiology reports",
            "venue": "Natural Language Engineering 27(2), 203\u2013224",
            "year": 2021
        },
        {
            "authors": [
                "H. Xiao"
            ],
            "title": "Serving Google BERT in Production Using Tensorflow and ZeroMQ",
            "venue": "(2019). https://hanxiao.io/2019/01/02/Serving-Google-BERT-in -Production-using-Tensorflow-and-ZeroMQ/",
            "year": 2021
        },
        {
            "authors": [
                "F. Pedregosa",
                "G. Varoquaux",
                "A. Gramfort",
                "V. Michel",
                "B. Thirion",
                "O. Grisel",
                "M. Blondel",
                "P. Prettenhofer",
                "R. Weiss",
                "V. Dubourg",
                "J. Vanderplas",
                "A. Passos",
                "D. Cournapeau",
                "M. Brucher",
                "M. Perrot",
                "E. Duchesnay"
            ],
            "title": "Scikit-learn: Machine learning in Python",
            "venue": "Journal of Machine Learning Research 12, 2825\u20132830",
            "year": 2011
        },
        {
            "authors": [
                "A. Bodnari"
            ],
            "title": "Healthcare Gets More Productive with New Industry-specific AI Tools",
            "venue": "(2020). https://cloud.google.com/blog/topics/healthcare-life -sciences/now-in-preview-healthcare-natural-langua ge-api-and-automl-entity-extraction-for-healthcare",
            "year": 2021
        },
        {
            "authors": [
                "J.A. Fries",
                "E. Steinberg",
                "S. Khattar",
                "S.L. Fleming",
                "J. Posada",
                "A. Callahan",
                "N.H. Shah"
            ],
            "title": "Ontology-driven weak supervision for clinical entity classification in electronic health records",
            "venue": "Nature communications 12(1), 1\u201311",
            "year": 2021
        },
        {
            "authors": [
                "A. Ratner",
                "S.H. Bach",
                "H. Ehrenberg",
                "J. Fries",
                "S. Wu",
                "C. R\u00e9"
            ],
            "title": "Snorkel: Rapid training data creation with weak supervision",
            "venue": "The VLDB Journal 29(2), 709\u2013730",
            "year": 2020
        },
        {
            "authors": [
                "E. Gibaja",
                "S. Ventura"
            ],
            "title": "A tutorial on multilabel learning",
            "venue": "ACM Comput. Surv. 47(3)",
            "year": 2015
        },
        {
            "authors": [
                "R.M. Monarch"
            ],
            "title": "Human-in-the-Loop Machine Learning: Active Learning and Annotation for Human-centered AI",
            "venue": "Shelter Island, NY: Manning Publications Company, ???",
            "year": 2021
        },
        {
            "authors": [
                "G. Karamanolakis",
                "S. Mukherjee",
                "G. Zheng",
                "A.H. Awadallah"
            ],
            "title": "Self-training with weak supervision",
            "venue": "Proceedings of NAACL-HLT, pp. 845\u2013863. Association for Computational Linguistics, Online",
            "year": 2021
        },
        {
            "authors": [
                "H. Jiang",
                "D. Zhang",
                "T. Cao",
                "B. Yin",
                "T. Zhao"
            ],
            "title": "Named entity recognition with small strongly labeled and large weakly labeled data",
            "venue": "Proceedings of ACL-IJCNLP, pp. 1775\u20131789. Association for Computational Linguistics, Online",
            "year": 2021
        },
        {
            "authors": [
                "P. Kolyvakis",
                "A. Kalousis",
                "B. Smith",
                "D. Kiritsis"
            ],
            "title": "Biomedical ontology alignment: an approach based on representation learning",
            "venue": "Journal of biomedical semantics 9(1), 1\u201320",
            "year": 2018
        },
        {
            "authors": [
                "P. Lison",
                "J. Barnes",
                "A. Hubin"
            ],
            "title": "skweak: Weak supervision made easy for NLP",
            "venue": "Proceedings of ACL-IJCNLP: System Demonstrations, pp. 337\u2013346. Association for Computational Linguistics, Online",
            "year": 2021
        },
        {
            "authors": [
                "H. Zhang",
                "J. Thygesen",
                "H. Wu"
            ],
            "title": "Increased covid-19 related mortality rate for patients with rare diseases: a retrospective cohort study with data from genomics england",
            "venue": "The Lancet 398, 95",
            "year": 2021
        },
        {
            "authors": [
                "H. Zhang",
                "J.H. Thygesen",
                "T. Shi",
                "G.V. Gkoutos",
                "H. Hemingway",
                "B. Guthrie",
                "H. Wu"
            ],
            "title": "Increased covid-19 mortality rate in rare disease patients: a retrospective cohort study in participants of the genomics england 100,000 genomes project",
            "venue": "Orphanet Journal of Rare Diseases 17(1), 1\u20137",
            "year": 2022
        }
    ],
    "sections": [
        {
            "text": "Background: Computational text phenotyping is the practice of identifying patients with certain disorders and traits from clinical notes. Rare diseases are challenging to be identified due to few cases available for machine learning and the need for data annotation from domain experts. Methods: We propose a method using ontologies and weak supervision, with recent pre-trained contextual representations from Bi-directional Transformers (e.g. BERT). The ontology-driven framework includes two steps: (i) Text-to-UMLS, extracting phenotypes by contextually linking mentions to concepts in Unified Medical Language System (UMLS), with a Named Entity Recognition and Linking (NER+L) tool, SemEHR, and weak supervision with customised rules and contextual mention representation; (ii) UMLS-to-ORDO, matching UMLS concepts to rare diseases in Orphanet Rare Disease Ontology (ORDO). The weakly supervised approach is proposed to learn a phenotype confirmation model to improve Text-to-UMLS linking, without annotated data from domain experts. We evaluated the approach on three clinical datasets, MIMIC-III discharge summaries, MIMIC-III radiology reports, and NHS Tayside brain imaging reports from two institutions in the US and the UK, with annotations. Results: The improvements in the precision were pronounced (by over 30% to 50% absolute score for Text-to-UMLS linking), with almost no loss of recall compared to the existing NER+L tool, SemEHR. Results on radiology reports from MIMIC-III and NHS Tayside were consistent with the discharge summaries. The overall pipeline processing clinical notes can extract rare disease cases, mostly uncaptured in structured data (manually assigned ICD codes). Conclusion: The study provides empirical evidence for the task by applying a weakly supervised NLP pipeline on clinical notes. The proposed weak supervised deep learning approach requires no human annotation except for validation and testing, by leveraging ontologies, NER+L tools, and contextual representations. The study also demonstrates that Natural Language Processing (NLP) can complement traditional ICD-based approaches to better estimate rare diseases in clinical notes. We discuss the usefulness and limitations of the weak supervision approach and propose directions for future studies.\nKeywords: Clinical Notes; Natural Language Processing; Ontology Matching; Phenotyping; Rare Diseases; Weak Supervision\n*Correspondence: hang.dong@cs.ox.ac.uk; honghan.wu@ucl.ac.uk 1Centre for Medical Informatics, Usher Institute of Population Health Sciences and Informatics, University of Edinburgh, Edinburgh, United Kingdom 2Health Data Research UK, London, United Kingdom 3Department of Computer Science, University of Oxford, Oxford, United Kingdom 5Institute of Health Informatics, University College London, London, United Kingdom Full list of author information is available at the end of the article"
        },
        {
            "heading": "Introduction",
            "text": "Text phenotyping is the task of extracting diseases or traits of patients from clinical notes, which can benefit a wide range of tasks like cohort selection, epidemiological research, and decision making for better clinical care. A particular set of human phenotypes are rare diseases: a rare disease is very uncommon, affecting 5 or fewer people in 10,000, but there are between 6,000 and 8,000 rare diseases and they collectively affect approximately 3.5-5.9% of the\nar X\niv :2\n20 5.\n05 65\n6v 5\n[ cs\n.C L\n] 3\nM ay\npopulation (or 263\u2013446 million persons) globally [1] (and over 1 in 17 people in the UK [2] and 8% of population in Scotland [3]) at some point in their lifetime. Compared to common diseases, rare diseases are usually not coded in a precise manner, this is partly because they are underrepresented in the current, ICD-10 (International Classification of Diseases, version 10) terminologies [4, 5]. Detailed information about a patient is usually hidden in unstructured, clinical narratives. It is thus necessary to use clinical notes with Natural Language Processing (NLP) techniques to complement coded data to identify rare diseases in patients.\nThe main challenge for rare disease identification with NLP is the lack of annotated data for machine learning, especially deep learning. Deep learning models for clinical note classification tend to perform worse for infrequent diseases due to the lack of cases for training [6]. On the other hand, annotating a variety of rare diseases in clinical notes from scratch needs specific domain expertise. This also requires the manual annotation of a very large number of clinical notes to ensure enough cases for each rare disease, thus taking time and incurring considerable costs from a group of clinical experts.\nWe propose an ontology-driven and weakly supervised framework for rare disease identification from clinical notes, extending our previous work in [7] with further, detailed empirical analyses and external validation. Ontologies are essential for text phenotyping as they provide a curated list of terms of diseases and traits. Previous studies have used ontologies to estimate the frequency of rare diseases [8]. Our main ontology-driven framework is illustrated in Figure 1.\nWe use Orphanet Rare Disease Ontology [9] as the list of vocabularies of rare diseases[1]. We then leverage the concepts and synonyms in Unified Medical Language System (UMLS) as an intermediary dictionary to extend matching terms and address the issue of name variation [12] in linking texts to rare diseases, e.g. \u201ctracheobronchomalacia\u201d for Williams-Campbell syndrome. The framework thus contains two integrated parts, entity linking (Text-to-UMLS) and ontology matching (UMLS-to-ORDO). Entity linking from mentions (or text fragments) to UMLS concepts is challenging due to the ambiguous mentions [12, 8], especially for abbreviations, e.g. \u201cHD\u201d which could mean Huntington Disease, Hemodialysis, or Hospital Day. String matching usually does not consider the complex contexts of a mention and can therefore result in many false positives. [1]We focus on the identification of diseases instead of the associated phenotypic abnormalities, therefore we chose ORDO instead of Human Phenotype Ontology (HPO) [10]. The overall ontology based and weak supervision framework can potentially be applied to HPO, given it being aligned to ORDO [11]. We leave the phenotypic abnormalities (in HPO) for future studies.\nMachine learning can be applied for the disambiguation of terms, but it needs abundant annotated training data, which are currently not available in the context of rare diseases.\nWe therefore propose a weakly supervised approach to filter out the false positives in entity linking. Weak supervision [13, 14] is a strategy to automatically create labelled training data using heuristics, knowledge bases, crowdsourcing, and other sources, to alleviate the burden and cost of annotation. We first use a string matching based named entity linking tool, SemEHR [15] (widely applied for text phenotyping in the UK [15, 16, 17], based on Bio-YODIE [18]) to generate candidate entity linking results, i.e. mentions and their UMLS concepts, from clinical notes; then, we propose to efficiently create weak training data of candidate mention-UMLS pairs of sufficient quality with two rules, mention character length, regarding ambiguous abbreviations, and \u201cprevalence\u201d, regarding rare diseases. A phenotype confirmation model can thus be learned through contextual mention representations with domain-specific BERT models (e.g. BlueBERT [19]) to capture the context under-lied in the texts to disambiguate the mention to improve entity linking. For UMLS-to-ORDO matching, we used the mappings in ORDO and corrected the wrong links by filtering ORDO concepts with a phenome type as an upper class in the ontology [9].\nFor our main experiments, we trained a weakly supervised phenotype confirmation model using the discharge summaries in the MIMIC-III dataset [20]. A large, weak entity linking dataset (of 127,150 candidate mentionUMLS pairs) was created for training. For evaluation, we annotated 1,073 mention-UMLS pairs as a gold-standard dataset. By filtering out the false positives, the proposed approach dramatically improved the precision and F1 of the entity linking tool, SemEHR, with almost no loss of recall.\nWe further evaluated the phenotype confirmation models from discharge summaries to radiology reports in US MIMIC-III and UK NHS Tayside through either a direct transfer of the model or a weakly supervised re-training from new clinical notes. Almost perfect (100%) recall was achieved with a dramatic absolute increase of precision by over 30% to 50% with re-training and parameter tuning. This demonstrates that the approach can be efficiently adapted to identify rare disease phenotypes in another type of clinical notes and from another institution. Our annotated datasets on discharge summaries and radiology reports in MIMIC-III and our implementation of the overall approach are publicly available[2].\nAs far as we know, this is the first study on text phenotyping of rare diseases using weak supervision, with the application on clinical notes of different types and institutions.\n[2]https://github.com/acadTags/Rare-disease-identificatio\nn\nICD-9 codes\nPatient ID\nAdmission ID\nUMLS ORDO\nICD-10 codes\nText-to-UMLS: SemEHR+WS(rules+BERT)\nLi nk\ns f ro\nm O\nR D\nO\nMatching between ICD-10 and ICD-9\nLink s fro\nm IC D-9\nUMLS-to-ORDO: Filter links from ORDO\nClinical notes (discharge summaries, radiology reports)\nFigure 1 A pipeline for rare disease identification from clinical notes with ontologies and weak supervision. The upper horizontal lines (in red) show the proposed pipeline based on clinical notes (e.g. discharge summaries and radiology reports in US MIMIC-III and UK NHS Tayside) and ontologies, including two steps (Text-to-UMLS and UMLS-to-ORDO). No annotation data are needed, through a UMLS extraction tool, SemEHR, and weak supervision (WS) based on customised rules and BERT-based contextual representations (see details on WS in Figure 2). The admission ID and ICD-9 codes (linked with dotted lines) are only available for the MIMIC-III data. The lower, dotted lines show a baseline approach purely based on manual ICD codes, also enhanced with ontology matching. (Figure adapted from [7].)\nOur findings will shed light on using weakly supervised approaches and contextual representations for text phenotyping from clinical notes. The overall approach to identifying rare disease cohorts has the potential to support epidemiology and clinical decision making for better care."
        },
        {
            "heading": "Background and Related Work",
            "text": "Text phenotyping with ontologies. Compared to the efficient and gradually economical genotyping (i.e. sequencing genomics information), phenotyping usually needs highthroughput computational approaches for the extraction of diseases and traits from electronic health records (EHRs) [21, 22]. Clinical codes (e.g. with International Classification of Diseases, ICD) are a common source typically used regarding their ease of retrieval for phenotyping. However, ICD codes are usually less specific to define nuanced diseases or traits (e.g. rare diseases [4]) and are likely to be incomplete or under-coded [23], which may cause erroneous and missing cases in phenotyping. An alternative source for phenotyping is free-text clinical notes in the EHRs. It is shown in a previous systematic review of cohort identification from EHRs [24] that text phenotyping (or case detection) achieves on average higher precision (or positive prediction value) and recall (or sensitivity) than code-based phenotyping, and combining both sources (texts and codes) achieved greatly improved phenotyping results. Text phenotyping also requires understanding the wider contextual features of the matched concepts, including negation (i.e. whether negated or hypothetical), experiencer (i.e. whether experienced by the patient or someone else), and temporality (i.e. whether historical) [25, 16]. These contextual features have been reasonably well detected with rule-based\napproaches, e.g. [25], and applied in Bio-YODIE and SemEHR, and more recently with neural network methods, e.g. in MedCAT [26].\nOntologies are essential for text phenotyping as they define the concepts and terms of diseases and traits. These concepts and terms are widely used to annotate clinical notes, i.e. match to text fragments or mentions [27] and to estimate rare diseases from texts [8]. The task to match ontology concepts (and their terms) to mentions is formally referred to as entity linking. One main issue of entity linking is entity ambiguity, where a mention could possibly denote different concepts or terms in an ontology [12]. Our work aims to improve entity linking with better disambiguation using weak supervision and contextual mention representation.\nWeak supervision. Weak supervision [13, 14] is a strategy to efficiently create a large set of noisy labelled training data in a programmatical way using various sources containing heuristics and knowledge bases. The success of applying weak supervision in clinical NLP studies depends on two aspects, data programming and data representation, as suggested in [13]. Efficient data programming ensures that reliable weak data can be programmatically created for supervised learning. In clinical NLP, studies use lexical or concept filtering rules to create labelled data to extract nuanced categories (e.g. suicidal ideation [28] or lifestyle factors for Alzheimer\u2019s Disease [29]) from clinical texts. We extend over this line of research by using ontologies and a medical concept labelling tool with two specific rules to create reliable weak data to extract rare diseases. The second aspect is data representation, representing the contexts and semantics in the data into vectors in a high-dimensional\nUMLS CUI (e.g. C0020179 Huntington Disease)\nContext window of the mention (e.g. \u2026 a history of ESRD on HD, atrial fibrillation, who presented with \u2026)\nDocument structure (e.g. Hospital_course)\nMention (e.g. HD) Mention length rule:\ud835\udc0d\ud835\udc28.\ud835\udc28\ud835\udc1f \ud835\udc1c\ud835\udc21\ud835\udc1a\ud835\udc2b\ud835\udc1a\ud835\udc1c\ud835\udc2d\ud835\udc1e\ud835\udc2b\ud835\udc2c \ud835\udc22\ud835\udc27 \ud835\udc26\ud835\udc1e\ud835\udc27\ud835\udc2d\ud835\udc22\ud835\udc28\ud835\udc27 > \ud835\udfd1\n\u201cPrevalence\u201d rule: \ud835\udc6d\ud835\udc93\ud835\udc86\ud835\udc92(\ud835\udc02\ud835\udc14\ud835\udc08)/|\ud835\udc29\ud835\udc1a\ud835\udc22\ud835\udc2b\ud835\udc2c| < \ud835\udfce. \ud835\udfd3%\nBinary label (e.g. False)\nContextual mention representation (e.g. BlueBERT)\nPhenotype confirmation\nmodel\nMetadata of a mention-UMLS pair, from an NER+L tool (e.g. SemEHR) Weak supervision (WS) module\nWeak labelling function \ud835\udc87\nTrue if both rules satisfied False if both rules not satisfied\nFigure 2 Weak supervision process for Text-to-UMLS linking. The left four white text boxes displayed the metadata (with examples) of a candidate mention-UMLS pair, identified by a Named Entity Recognition and Linking (NER+L) tool, SemEHR; the coloured text\nboxes in the middle show the contextual representation block (in green ) and the rule-based weak data labelling (in blue ). A binary label is then generated, which weakly estimates whether the candidate pair indicates a correct phenotype of the patient. A phenotype confirmation model (in grey ) is then learned to select correct phenotypes from the pairs. (Figure adapted from [7]).)\nspace for subsequent steps in machine learning. For deep learning methods, previous studies [13, 29] proposed to use neural word embeddings and more recently using BERT [30] to represent the contexts of the textual data. We follow this direction to apply weak supervision with contextual representations for rare disease phenotyping.\nContextual Representation. The most significant, recent progress in NLP is the contextual representations pretrained using Transformers [31] from a very large corpus [30]. The most representative contextual representation is BERT [30]. The pre-training task for BERT learns a masked language model with next sentence prediction, trained with a vast amount of curated texts on the Web (e.g. BookCorpus and English Wikipedia) using a 12 or 24 layered deep neural network mainly composed of multihead self-attentions blocks. The learned parameters in the large neural network can then be applied to a wide range of downstream tasks, e.g. text classification, Named Entity Recognition, and question answering, with superior performance than the previous, task-specific models [30]. Contextual representations have been adapted to the clinical domain by pre-training using biomedical publications, clinical notes, and clinical ontologies. The notable models include but are not limited to BlueBERT [19] (BERT further pre-trained with PubMed abstracts and MIMIC-III clinical notes), PubMedBERT [32] (pre-trained from scratch with PubMed abstracts and full texts), SapBERT [33] (PubMedBERT further pre-trained with UMLS concepts), etc. We adapt the contextual representation methods for the mentions or text fragments to improve entity linking."
        },
        {
            "heading": "Method",
            "text": "In this section, we will describe the ontology-driven method, the weak supervision for entity linking, contextual mention representation, and model training and inferencing.\nEntity Linking and Ontology Matching Entity Linking. Given a set of entities E in an ontology and a collection of documents (e.g. clinical notes), entity linking aims to match a mention (or text fragment) m to its corresponding entity e \u2208 E in the ontology [12]. The mention m is a sequence of tokens in a document which potentially refers to one or more named entities and is usually identified in advance during the named entity recognition stage [12]. For Named Entity Recognition and Linking (NER+L) tools with a very large number of entities, e.g. Bio-YODIE [18], SemEHR [15], and MedCAT [26], a mention m is recognised at the same time when it is linked to a concept in an ontology; this is usually realised through string matching [18, 26].\nWe applied SemEHR, a medical NER+L tool widely deployed in Trusted Research Environments (or Data Safe Havens) and servers in the UK. Previously, high recall and F1 (around 90%) were reported on sub-phenotyping with stroke from texts with SemEHR [17]. The output is a set of mention-UMLS pairs, where each mention is in a context window and with a name of the document structure (or the template section of the clinical note) if available. SemEHR adapts Bio-YODIE as its main NLP module, enhanced with a search interface and continuous learning functionalities based on users\u2019 feedback labels and rulebased and machine learning methods. Bio-YODIE can efficiently extract UMLSs from texts using a string matching based approach. When there is an ambiguous mention,\ntime-efficient NER+L systems like Bio-YODIE mainly assume a corpus-based prior to assign the same, most frequent UMLS to the mention regardless of its context or surrounding texts [18]. This can result in many false positive phenotypes, mostly regarding the abbreviations in the clinical notes. For example in Table 1, none of the identified \u201cHD\u201d mentions indicate a type of disease, according to the context. While SemEHR has a continuous learning functionality to classify and correct the errors, the approach relies on users\u2019 feedback labels and requires time from clinical experts.\nOntology Matching. Another issue in entity linking is the variations of terms that may be missed in the process [12]. This can be addressed by using the rich term variations in the metathesaurus UMLS as an intermediary dictionary with ontology matching to match concepts in UMLS to ORDO. Ontology matching (or mapping) is the task of finding the correspondence between two ontologies [34]. Each correspondence is represented as a triple < e, e\u2032, r >, where e and e\u2032 denote an entity in the ontology O and O\u2032, respectively, and r denotes a relation that holds between the two entities [35, p. 43]. The main form of an entity in an ontology is a concept or a class, denoted as c \u2208 C [35, p. 34]. In ORDO, the matching of an ORDO concept to UMLS and ICD-10 concepts are available as cross references [9], for example for Orphanet 3325 (Heparininduced thrombocytopenia), there exist correspondences < Orphanet 3325,UMLS:C0272285,E >, where the relation E denote \u201cExact matching\u201d. We use E (Exact matching) or BTNT (ORDO\u2019s Broader Term maps to a Narrower Term) to ensure the matched term is a rare disease (and removed NTBT relations). We further added a rule (\u201cisNotGroupOfDisorders\u201d) to filter out the Group of Disorders, e.g. Orphanet 181422 (Rare hyperlipidemia), which were mostly matched to a common disease in the UMLS, e.g. to C0020473 (hyperlipidemia). More details and examples of ontology matching are presented in Table S2-2 in Supplementary material 2.\nWeak Supervision for Phenotype Confirmation Model To address the issue of ambiguous mentions, we propose weak supervision based on rules for labelled data creation with context mention embeddings for representation. When both data and representations are created, a classifier can be learned to decide whether a mention linked to UMLS in the context indicates a correct phenotype of the patient.\nAlgorithm 1: Weakly supervised data creation Require: T , document set; cUMLS \u2208 OUMLS , UMLS\nconcepts and ontology; cORDO \u2208 OORDO , ORDO concepts and ontology.\nEnsure: Dweak, weakly labelled data 1 Initialise Dweak \u2190 \u2205; 2 OrareUMLS = {cUMLS |cUMLS \u2208< cORDO, cUMLS , r >}; 3 L\u2190 SemEHR(T,OrareUMLS); 4 for each < mstart,mend, crareUMLS, t, s > in L do 5 \u03bb1 = mend \u2212mstart > l; 6 \u03bb2 = Freq(crareUMLS) |L| < p; 7 if \u03bb1 XNOR \u03bb2 then 8 yweak \u2190 \u03bb1 AND \u03bb2; 9 Lweak \u2190 append(L, yweak);\n10 Dweak \u2190 Dweak \u222a Lweak; 11 end 12 end\nWeakly Supervised Data Creation. The idea in the weak data creation is to create rules that can complement the existing tool (e.g. SemEHR) to create reliable mentionUMLS pairs for training. The whole data creation process for weak supervision is described in the Algorithm 1. The candidate mention-UMLS pairs from an NER+L tool are denoted as a list of 5-element tuples L (i.e. links), where each tuple includes a mention start position mstart, a mention end positionmend, a rare disease UMLS concept crareUMLS, the context window of the mention t, and the name s of the document structure where the mention is located. We propose two rules as functions on mention-UMLS pairs, mention character length rule, \u03bb1, and \u201cprevalence\u201d rule, \u03bb2, as shown in the blue blocks in Figure 2. Given that abbreviations (like \u201cHD\u201d in Table 1) are usually ambiguous and falsely linked by the NER+L tools, the mention character length rule \u03bb1 satisfies when the mention has more than l (default as 3) characters, i.e.mend\u2212mstart > l, otherwise as False. Given that rare diseases usually have a very low prevalence [3, 36] and rare disease mentions usually have a low frequency in a consecutive sample of clinical notes, the \u201cprevalence\u201d rule \u03bb2 satisfies when the UMLS concept represents a very small percentage p (default as 0.5%) in the whole number of candidate links |L|, i.e. Freq(c)|L| < p, otherwise as False. This is an attempt to integrate an estimated epidemiological rule into weak supervision for text phenotyping.\nThe final rule-based weak labelling function \u03bb is defined as True (i.e, mention-UMLS indicates a correct phenotype of the patient) when both rules \u03bb1 and \u03bb2 are satisfied, and as False when both rules are not satisfied. The data selection is equivalent to an XNOR logic operator (selected if and only if both rules are True or both are False) and the data labelling is equivalent to an AND operator of the rules. This ensures that only data that are consistently checked\nby both rules are weakly labelled. The binary weak label, yweak \u2208 {0, 1}, is then appended to each mention-UMLS pair to create the weakly labelled data Dweak.\nThe mention length threshold l and the \u201cprevalence\u201d threshold p are selected to ensure a sufficient amount of reliable, weak data generated. We empirically determine the best values of l (as 3 or 4) and p (as 0.005 or 0.01) based on the validation set or a small number of annotated data solely for evaluation (results on MIMIC-III discharge summaries in Table S1-1 in the Supplementary material 1).\nContextual Mention Representation. We use a clinically pre-trained BERT model (e.g. BlueBERT, as described in the related work) to represent the mention in its context window t in the weakly labelled data Dweak. A BERT model can be succinctly described as the Equations 1. We excluded layer normalisation, dropout, and other functions and parameters in the equations for simplicity. The output Hn \u2208 R|tokens|,d is a matrix that can be used as the layer for the subsequent task, where |tokens| is the length of sequence after tokenisation and d denotes the dimensionality (usually 768 for BERTnorm and 1024 for BERTlarge). FFNN() is a feed-forward neural network of two linear transformations with a ReLU activation function in between, and MultiHead() is a multi-head self-attention layer that models multiple forms of alignment from the tokens to themselves; and the three inputs represent matrices of queries (Q), keys (K), and values (V ), respectively, linearly transformed from Hi. We refer readers for the details of the Transformers and BERT architectures to [31, 30].\nHi+1 = FFNN(MultiHead(WQHi,WKHi,WVHi))\nH0 = Embedding(Tokenize(t)) (1)\nThe contextual understanding mainly comes from selfattention (as softmax(QK T\n\u221a dk )V , where dk is a scaling factor) that captures the importance of every other token to each token. These parameters have been pre-trained based on massive corpora from general and medical domains. The hidden layers in BERT, H can be used as static embeddings to represent a sequence. We extract the second-last layer Hn\u22121 in BERT as static embedding (or features) for the subsequent task, according to the results that Hn\u22121 has the best feature-based results among any single layers in H for an NER task [30]. A plausible explanation for this is that the last layer is more biased towards the training loss (e.g. masked language model and next sentence prediction), while the second-to-last layer better represents the contextual information of the sentence.\nThe selection of the specific BERT model generally favours models pre-trained with in-domain (i.e. clinical) corpora [37] and is empirically based on results (e.g. F1 scores) on the validation set. We will compare and analyse different BERT models in the experiments (see Table 4).\nAlgorithm 2: Weakly supervised data representation and model training Require: < mstart,mend, crareUMLS, t, s, yweak >\u2208 Dweak Ensure: Mweak, the phenotype confirmation model 1 Initialise Xweak \u2190 \u2205, Yweak \u2190 \u2205; 2 for each < mstart,mend, crareUMLS, t, s, yweak > in Dweak do 3 t\u2190 concatenate(t, [SEP], s), if s is not null ; 4 Hn\u22121 \u2190 BERT(t); 5 mtokenstart,m token end \u2190 tokenize(t,mstart,mend); 6 v \u2190 mean(Hn\u22121[mtokenstart,mtokenend ]); 7 Xweak \u2190 Xweak \u222a v; 8 Yweak \u2190 Yweak \u222a yweak; 9 end\n10 Mweak \u2190 Train and Validate(Xweak, Yweak);\nThe overall weak supervision data representation and model training process is described in Algorithm 2. We use Hn\u22121 \u2190 BERT(t) to denote the whole process above. Mean pooling, as empirically suggested in [38], is applied to create a final vector v. We define a contextual mention representation where only the tokens within the mention are included, i.e. v \u2190 mean(Hn\u22121[mtokenstart,mtokenend ]). The start and end tokens\u2019 position of the mention mtokenstart and mtokenend are derived based on the WordPiece tokenizer of the BERT model and the original position of the mention.\nWe also experimented with two encoding strategies, mention masking and using document structure name s (see line 3 in Algorithm 2), that allow a more flexible representation of the contexts. Non-masked encoding with document structures provided better results on the validation set (see Table S1-2 in Supplementary material 1).\nModel Training and Inference. Finally, a phenotype confirmation model can be trained from the weakly labelled data. The contextual mention representation v, as static embedding, is fed into a binary classification model. We use logistic regression as the training model (in Train and validate() in Algorithm 2), which is similar to adding a feed-forward layer on top of the static pre-trained layer in BERT with sigmoid activation. We also compared this static embedding approach to fine-tuning the whole BERT model in the experiments.\nThe inference stage is succinctly defined in Equation 2. We use SemEHR to extract candidate mention-UMLS pairs from a clinical note d. We then transform each instance into a contextual mention representation (see line 3-6 in Algorithm 2), denoted as the function VBERT(). After selecting the patients\u2019 phenotype inOrareUMLS withMweak, we can then use the correspondence between UMLS and ORDO, denoted as OMU\u2192O, to obtain the final set of rare disease phenotypes CdORDO as concepts in ORDO.\nCdORDO = OMU\u2192O(Mweak(VBERT(SemEHR(d,O rare UMLS)))))\n(2)"
        },
        {
            "heading": "Experiments",
            "text": "We evaluated the above ontology-driven and weakly supervised algorithms on MIMIC-III discharge summaries and further validated the approach with MIMIC-III radiology reports and NHS Tayside brain imaging reports. For validation and testing, we manually annotated a small number of mention-to-UMLS pairs from each of the datasets. We present results on each part of the system, Text-to-UMLS and UMLS-to-ORDO. For Text-to-UMLS, we carried out extensive experiments to study the best combination of parameters in weak labelling rules, the encoding strategies, with a comparison between weak and strong supervision. We then show the whole pipeline can support rare disease phenotyping by enriching the traditional method using ICD codes. Finally, we show that the proposed approach can easily generalise or be adapted to a new type of clinical note, radiology reports, in the same or another institution.\nData Processing and Annotation We evaluated the proposed NLP pipeline with three datasets in two healthcare institutions in the US and the UK. The main dataset we used was the discharge summaries (n=59,652) in MIMIC-III (\u201cMedical Information Mart for Intensive Care\u201d) dataset [20], which contains clinical data from adult patients admitted to the ICU in the Beth Israel Deaconess Medical Center in Boston, Massachusetts between 2001 and 2012. We were granted access to MIMICIII through PhysioNet after completing the ethical training by the Collaborative Institutional Training Initiative program. MIMIC-III data are supposed to contain rich rare disease mentions, as a large number of rare diseases (especially genetic disorders) can lead to an ICU (intensive care unit) admission [36].\nThe manual ICD-9 codes (i.e. ICD-9-CM) of the MIMICIII admissions allow us to compare code-based phenotyping with text phenotyping for rare diseases. We linked ICD9 codes to ICD-10 codes using the matching from the Ministry of Health, New Zealand [39] and linked ICD-9 to UMLS codes based on the ICD-9 ontology in BioPortal [40], as shown in Figure 1. We used ORDO version 3.0 (released 07/03/2020), which contained 14,501 concepts or classes related to rare diseases. We selected the ORDO concepts which have linkage to UMLS and ICD-10 in this study as this supports the interoperability (e.g. linking and traversing) among the clinical terminologies; this resulted in a set of 4,064 rare disease concepts[3]. We focus on this [3]The most 5 frequent UMLS (version 2020AB) semantic types of the 4,064 linked ORDO concepts: T047 (Disease or Syndrome, 3,245 concepts, 79.8%), T019 (Congenital Abnormality, 465 concepts, 11.4%), T191 (Neoplastic Process, 374 concepts, 9.2%), T049 (Cell or Molecular Dysfunction, 35 concepts, 0.9%), and T046 (Pathologic Function, 19 concepts, 0.5%); note that 160 concepts (3.9%) are associated with two semantic types.\nessential set of overlapped rare diseases and the coverage is improving as the mappings are being updated; we leave the ORDO concepts without both ICD-10 and UMLS linkage for future research.\nAfter processing the discharge summaries with a SemEHR database instance[4] [15] with rule-based contextual filtering on negation and experiencer based on [25], we obtained 127,150 candidate mention-UMLS pairs for the UMLS concepts linked to ORDO. After applying the weak labelling function with the two rules, we finally obtained 15,598 positive and 74,217 negative data, and 37,335 non-labelled data or mention-UMLS pairs.\nWe further applied the same preprocessing steps with the MIMIC-III radiology reports (n=522,279) and NHS Tayside brain imaging reports (n=156,618). MIMIC-III radiology reports are from the same institution and within the same time span as in MIMIC-III discharge summaries [20]. The Tayside data contain the routine brain MRI and CT scans from the National Health Service (NHS) Tayside Health Board, which have been applied in previous NLP research [17, 41]. We have received NHS Tayside Caldicott Guardian approval to use the anonymised brain imaging reports for this work.\nThe statistics of the three datasets, MIMIC-III discharge summaries (\u201cDisch\u201d), MIMIC-III radiology reports (\u201cRad\u201d), and NHS Tayside brain imaging reports (\u201cTayside Brain Img\u201d), with the Natural Language Processing pipeline and manual annotations, are presented in Table 2. MIMIC-III discharge summaries have proportionally more documents associated with at least one candidate rare diseases (identified by SemEHR), quantified by |TRD||D| : 3.4 times more than MIMIC-III radiology reports and 13.3 times more than brain imaging reports in Tayside.\nData Annotation. For evaluation, we created a gold standard dataset of 1,073 candidate mention-UMLS-ORDO [4]https://github.com/CogStack/CogStack-SemEHR\ntriplets (with each mention in a context window) generated by SemEHR and ontology matching in ORDO, from a set of 500 randomly sampled discharge summaries from MIMIC-III, of which 312 (or 62.5%) discharge summaries have at least one candidate or potential \u201crare disease\u201d mention. There were in total 95 types of rare disease associated with the mentions. Annotators were asked to label whether a mention-UMLS pair truly indicates a phenotype of the patient with an annotation guideline of detailed examples on hypothetical mentions. The mention-UMLS pairs were annotated by 3 domain experts, including two research fellows and one PhD student in Medical Informatics (MI). Based on the random 200 mention-UMLS pairs annotated by all 3 domain experts, the multi-rater Kappa value was 0.76. ORDO-to-UMLS concept matching was annotated by 2 domain experts (a research fellow and a PhD student in MI) and obtained a Kappa of 0.72. All contradictory and unsure annotations were resolved by a research fellow in biomedical science and MI. We used the first 400 data instances for model validation and the rest 673 for final testing.\nTo study how the model performs when it is directly transferred to or re-trained on other clinical notes, we further annotated 198 candidate mention-UMLS pairs in a sample of 1,000 radiology reports in MIMIC-III [20] and 279 candidate mention-UMLS pairs (with 4 new manually identified mentions) in a sample of 5,000 brain imaging reports in NHS Tayside [17]. Each dataset was annotated by two researchers in clinical science or MI with contradictions addressed by another researcher. The Kappa for MIMIC-III radiology reports and NHS Tayside reports were 0.88 and 0.86, respectively.\nTo note that the evaluation set is independent of the rules used for weak supervision, thus abbreviations and \u201cpopular\u201d disease mentions were in the validation and testing data. This helps to test whether the phenotype confirmation model trained on the rule-based weakly labelled data can generalise to the full scenario that also contains the unseen mentions, which were filtered out during weak supervision.\nImplementation Details We used the open-source tool, bert-as-service[5] [42], built on Google AI\u2019s BERT implementation with Python Tensorflow[6] [30] for contextual mention representation. We tested a range of pre-trained BERT models (BERT, BlueBERT, PubMedBERT, and SapBERT) and selected BlueBERT-base [19] based on results on the validation set (see Table 4). We then trained a logistic regression model with the representations, with default configuration using scikit-learn [43] on the weakly labelled mention-UMLS pairs. We also implemented a word2vec embedding baseline with Gensim[7] and a BERT fine-tuning baseline with [5]https://bert-as-service.readthedocs.io/en/latest/ [6]https://github.com/google-research/bert [7]https://radimrehurek.com/gensim/models/word2vec.html\nHuggingface Transformers[8], with detailed parameters in Embedding and Fine-tuning Settings in Supplementary material 1. Our implementation of the experiments is available at https://github.com/acadTags/Rare-dis ease-identification.\nAs baselines, we compared the proposed approach (\u201cSemEHR+WS\u201d) with SemEHR with the two rules only using an OR operation for the interest of higher recall (\u201cSemEHR+rules\u201d). We evaluated the baselines using precision, recall, and F1 scores. Note that SemEHR had a reference recall of 100% as all candidate \u201crare disease\u201d mentions were identified by SemEHR, which was the starting source for the annotations.[9]\nWe tuned the two parameters l and p (to 3 and 0.5%, respectively, if not specified) in the weak labelling rules (in Algorithm 1) by grid search based on the performance of validation data in MIMIC-III discharge summaries. The detailed parameter tuning results of l and p are in Table S1-1 in Supplementary material 1, Weak Rule Parameter Tuning. We also tuned the size of context windows (default as 5), which however, did not affect the performance, probably because our final representation was based on the position of the mention in the BERT layer (see line 6 in Algorithm 2). Also, we tuned the optimal number of random training mention-UMLS pairs needed (n=9k) based on the validation set, which had little impact on the results (<1% F1 score).\nIn contrast to weak supervision (WS), we also provide results on strong supervision (SS), the traditional approach that trains a model from full manually labelled data. For MIMIC-III discharge summaries, we used the first 400 validation set in the full 1,073 mentions to train a model, Mstrong, and test on the rest 673 mentions with the same inferencing step in Equation 2 but using Mstrong instead of Mweak. As manually labelled data are usually more reliable than weakly labelled data, the performance of strong supervision is considered as an upper bound in studies in weak supervision [45, 46].\nWe provide the results regarding each step in the pipeline (in Figure 1), Text-to-UMLS linking and UMLS-to-ORDO matching, followed by the overall results on rare disease identification, Text-to-ORDO linking and admission-level ORDO concept prediction.\nMain Results: Text-to-UMLS linking Table 3 shows the validation and testing results of Text-toUMLS linking. With weak supervision (WS), the precision and F1 of SemEHR has been greatly improved by around 55% and 40% absolute value, respectively, for both validation and testing data. Adding the two customised rules already improved the testing performance greatly by over 30% F1 to SemEHR (as shown in SemEHR+rules), which validates the efficiency of the two proposed rules with the NER+L tool to create reliable weak annotations. Adding WS further outperformed the SemEHR+rules setting absolutely by around 10% precision (and 5% F1), showing the usefulness of the contextual mention representation on filtering out false positives. The recall dropped slightly after introducing the two rules. This indicates the bias or noise in the rules with the current threshold (p as 0.5% and l as 3). Results with weak supervision are within a small gap of 5% F1 of strong supervision with hand-labelled data. This, overall, demonstrates the potential of WS to improve text phenotype entity linking.\nAs a solid evaluation needs to assess the system with different biased test sets, we further split the testing data into those weakly labelled or unlabelled during the weak supervision. This helps analyse the impact of the rule-based weak supervision on the testing performance. \u201cSeen\u201d data mean that the mention-UMLS pairs were weakly labelled with \u03bb, i.e. with both rules satisfied or both not satisfied (see line 7-11 in Algorithm 1); \u201cunseen\u201d data mean that only one of the rules was satisfied so that the data were not labelled in the process. WS improved the performance of SemEHR in both settings: while the weakly \u201cseen\u201d data were dramatically boosted by rules (by nearly 50% F1), the \u201cunseen\u201d data were greatly improved (by 10% F1) through the model generalised with contextual representations.\n[8]https://github.com/huggingface/transformers [9]We also benchmarked the performance on MIMIC-III discharge summaries with recent NER+L tools, MedCAT [26] and Google Healthcare Natural Language API [44]. However, given that the results (especially recall) may favour SemEHR-based methods, we do not formally report the results of the two NER+L tools but make them available at https://github.com/acadTags/Rare-disease-identificatio n/blob/main/supp-results.\nThe \u201cunseen\u201d data can be further split into the case that only the mention character length rule (\u03bb1) or the prevalence rule (\u03bb2) is satisfied. The former, \u201cunseen-\u03bb1\u201d testing set (n=127, where 96 are positive mentions) has more mentions than the latter, \u201cunseen-\u03bb2\u201d (n=47, where 11 are positive mentions). SemEHR+WS obtained substantially better P/R/F1 performance on \u201cunseen-\u03bb1\u201d (84.1/99.0/90.9) than \u201cunseen-\u03bb2\u201d (46.2/54.5/50.0). This shows that mentions that are infrequent abbreviations (i.e., \u201cunseen-\u03bb2\u201d) tend to be more challenging than frequent non-abbreviations (i.e., \u201cunseen-\u03bb1\u201d). In both scenarios, SemEHR+WS performed the best F1 among the baselines except for strong supervision (SemEHR+SS). However, given that the number of testing samples is small, e.g. only 11 positive mentions for \u201cunseen-\u03bb2\u201d, we do not formally report the breakdown of results to draw solid conclusions.\nEmbedding and Encoding Strategies. We compared the different embedding methods, including word embeddings and several BERT models pre-trained from different sources. Table 4 shows that contextual mention embeddings (e.g. with BERT, described in lines 4-6 in Algorithm 2) based methods greatly outperformed word embeddings, although increasing the dimensionality of word2vec embeddings improved their recall and F1. For the contextual mention embeddings, we compared the vanilla BERT and representative pre-trained BERT models in the biomedical domain. We observed that BlueBERT, pre-trained using the in-domain (or same-data), MIMIC-III clinical notes, outperformed the various BERT models only from general domains (e.g. BERT), biomedical publications (e.g. PubMedBERT), or clinical ontologies (e.g. SapBERT). This supports the use of in-domain pre-trained models, e.g. BlueBERT for the task, corroborating the conclusion from [37]. We also see that neither using fine-tuning (cf. featurebased) nor the large version of BlueBERT could improve the performance, which is probably because they introduce more learnable parameters (and a larger model size for BlueBERT-large), thus likely overfitting the weakly labelled data and underperforming on the real, testing data. We further compare the encoding strategies and found that non-masked encoding (with document structures) achieved the best F1 scores on the validation data (see Table S1-2 in Supplementary material 1).\nUMLS-to-ORDO Matching Results For UMLS-to-ORDO ontology matching, the original accuracy by the ORDO ontology was 87.4% (=83/95), if considering the repeated mentions in the whole 1073 evaluation data, the linking accuracy was 81.6% (=876/1073). The most frequent three false UMLS-to-ORDO mappings in ORDO were Hyperlipidemia (C0020473) to Rare hyperlipidemia (Orphanet 181422), Epilepsy (C0014544) to Rare epilepsy (Orphanet 101998), and Dyslipidemias (C0242339) to Rare dyslipidemia (Orphanet 101953), all linking a broader, common disease concept to its specific types in rare diseases under the phenome type or the upper class [9] of group of disorders (Orphanet 557492). By filtering with ORDO\u2019s phenome type using \u201cisNotGroupOfDisorders\u201d (i.e. not under group of disorders), the UMLS-to-ORDO concept linking accuracy of the unique and repeated mentions was improved to 88.4% (from 87.4%) and 94.4% (from 81.6%), respectively, from the whole validation and testing data in the MIMIC-III discharge summaries.\nOverall Mention-level and Admission-level Results We finally obtained the mention-level results (Text-toORDO) based on the two parts of the system. The results, shown in Table 5, are consistent with Text-to-UMLS results. The overall metrics are lower than Text-to-UMLS results (71.7% vs 86.1% for testing F1 score for WS) due to the imperfect matching between UMLS and ORDO. For a perfect UMLS-to-ORDO matching, the results of the Textto-UMLS and Text-to-ORDO should be the same.\nIn the interest of detection of rare disease cases in admissions, we aggregated the mention-level results to admission-level results, where one admission may be associated with several unique rare diseases (each as a concept in ORDO). Thus, we report the standard micro-level labelbased metrics for multi-label classification [47]. Microlevel metrics count each admission to a single ORDO con-\ncept as an instance and create a confusion matrix to calculate the precision, recall, and F1 scores. We were also able to obtain ICD-based results purely based on ontology matching (from ICD-9 codes to ICD-10 or UMLS concepts then finally to ORDO concepts, as shown in Figure 1). Admission-level results were generally consistent with mention-level (Text-to-UMLS and Text-to-ORDO) results. In terms of precision and F1 score, weak supervision greatly improved the performance of SemEHR and outperformed other third-party tools, slightly below strong supervision, while the recall was the same for both WS and SS. We also obtained the admission-level results of ICD codes.\nAdmission-level results are presented in Table S1-3 in Supplementary Material 1. It is discovered that our NLPbased approach (SemEHR+WS) achieved better precision and F1 scores than the code-based approach (ICD). In terms of recall, ICD codes could only identify a few more rare diseases cases than SemEHR with weak supervision (e.g. 21 vs 20 out of 30 in the validation set and 36 vs 33 out of 42 in the test set, between ICD \u222a SemEHR+WS and SemEHR+WS). Note that this result may not be accurate as our annotation is based on the string matching based NER+L results from SemEHR, so the false positives from ICD-based cohorts may actually be true cases. Also, the number of positive data is much lower in admissionlevel results than in the mention-level (e.g. for testing data, 42 admissions vs. 187 mention-UMLS pairs). But nevertheless, our results show the essential role of free-texts and NLP methods for rare disease phenotyping; the results are consistent with the conclusion in [24] regarding general diseases.\nError Analysis We breakdown the errors of the proposed approach (\u201cSemEHR+WS\u201d) regarding Text-to-ORDO in MIMIC-III discharge summaries (see results in Table 5) in Figure 3. There were altogether 91 errors (including 59 false positives and 32 false negatives), representing 8.5% from the 1,073 candidate mentions-UMLS-ORDO triplets, where 61 (or 5.7%) were from Text-to-UMLS stage and 30 (or 2.8%) only from the UMLS-to-ORDO stage (and 4 in both stages).\nWhile rules are effective for WS, they may also introduce some bias. Over half 57.4% (or 35 of 61 errors)\nCorrect 91.5%\nUMLS-to-ORDO error 2.8%\nWeak rule bias 57.4%\nEntity type error 26.2%\nHypo/neg 6.6%\nOther 9.8%Text-to-UMLS\nerror 5.7%\nFigure 3 Error breakdown of Text-to-ORDO identification of 1,073 candidate mentions in MIMIC-III discharge summaries (Hypo/neg: Hypothetical or negation)\nfrom the Text-to-UMLS side were likely due to the bias introduced from the weak rules, where the prediction was wrong when using the weak rules only. The other two main errors were either (i) semantic type errors (representing 26.2% or 16 out of 61), where the mention was a (negative) laboratory test (e.g. \u201clegionella\u201d) or other unrelated types (e.g. \u201cENDO\u201d as department name) instead of a disease, or (ii) diseases of hypothetical or negative contexts (represented 6.6% or 4 out of 61), which were not filtered out by the NER+L tool, SemEHR, and were also challenging for the annotators. The other errors (9.8%, 6 out of 61) were due to not enough information for human to decide or no exact reason found for the error. The issues above may be addressed by combining WS with human-in-the-loop machine learning [48] with adaptive rules to improve the performance. The wrong UMLS-to-ORDO ontology mappings were due to the simple heuristic (\u201cisNotGroupOfDisorders\u201d) which also filtered out correct mappings - this may be addressed when the official ontology matching is updated or by using a machine learning based system to correct the matching.\nNLP vs. ICD for Rare Disease Phenotyping We applied the trained model and the whole pipeline to process all MIMIC-III discharge summaries (n=59,652) and compared the rare disease admissions identified from NLP and ICD. The NLP approach is the proposed ontologydriven and weakly supervised pipeline. For the ICD-based results, we combined the ICD-9 codes matched to either the UMLS or ICD-10 codes linked to ORDO (see Figure 1).\nUsing our NLP-based pipeline, it is possible to greatly enrich the rare disease cases identified solely from ICD codes. For most (97.2%=453/466) types of the rare diseases, our approach mining free texts could enrich at least one (and usually many) potential rare disease case compared to the ICD-based approach. The results can be useful to identify potential cases for an alerting system for clinical care or a base for further refinement. Figure 4 shows the selected 10 rare diseases which were best predicted in the annotated 312 discharge summaries, however, since the\nsupport value was few (between 1 to 5) for each of the diseases in the admission-level evaluation, the results did not represent the predictions of the full 59k admission cases in"
        },
        {
            "heading": "MIMIC-III.",
            "text": "We thus further performed an extra manual evaluation to verify whether the rare disease cases identified by NLP were true phenotypes (or represented a current or past rare disease of the patient), as there was no gold reference standard. Five researchers (one in clinical science, one in biomedical science, and the remaining three in MI) screened the 1,428 cases or patient stays identified by NLP (WS or SS) regarding the 10 selected diseases, according to the definitions of the rare diseases in ORDO. The accuracy scores (the fraction of correct rare disease cases in all identified cases) of the weakly-supervised NLP-identified rare diseases are displayed after each horizontal bar in Figure 4. We can see that NLP identified most rare diseases (6/10) with an accuracy score from around 70% to over 90%. For rheumatic fever, over 90% of the cases were true positives, except for a few hypothetical mentions or the subject being the patient\u2019s relative. Some examples are provided in Table S2-1 in Supplementary material 2. As rheumatic fever is usually a historical disease when the patient was a child, the disease was commonly not coded with ICD.\nFor certain rare diseases, the accuracy score from the manual evaluation was very low, e.g. 0.0% for IRIDA syndrome due to \u201cmicrocytic anaemia\u201d wrongly assigned as a synonym or an atom of C0085576 (\u201cIron-Refractory Iron Deficiency Anemia\u201d or IRIDA) in the previous UMLS version (2019AA) in the Text-to-UMLS process, 8.2% and 43.8% for Retinitis Pigmentosa and Progressive Multifocal Leukoencephalopathy, respectively, due to the ambiguous meanings of their abbreviations (\u201cRP\u201d and \u201cPML\u201d) and unseen in WS (with a low corpus-based prevalence below 0.5%). For Multifocal Atrial Tachycardia, the definition in ORDO is a neonatal disease, while its matched UMLS concept of the same name may also mean an adult disease. We also found difficulty in reaching a consensus in the annotation due to the vague definition of Acute Liver Failure in ORDO[10], for which we derived two distinct interpretations which were then reconciled by a senior clinician[11]. This analysis suggests that we should take the definitions into consideration in entity linking and ontology matching. We should also ensure that the definitions used are appropriate for the clinical research question for people using the tools. [10]https://www.ebi.ac.uk/ols/ontologies/ordo/terms?iri=h\nttp%3A%2F%2Fwww.orpha.net%2FORDO%2FOrphanet 90062 [11]Our two interpretations of acute liver failure differ most in the factors of drug use, alcohol abuse, virus infection, etc., that could contribute to the rarity of the disease but not specified in the definition from ORDO. We finally considered hepatitis virus or drugs as causes of acute liver failure as a rare disease, but removed cases of alcohol abuse.\n8\n10\n26\n39\n42\n69\n6\n85\n20\n271\n213\n48\n110\n26\n30\n229\n183\n79\n69.4%\n94.1%\n58.7% 67.5%\n70.9%\n43.8%\n86.7%\n0.0%\n8.2% 90.9%\n0 50 100 150 200 250 300\nAmyotrophic lateral sclerosis Rheumatic fever\nAcute liver failure Necrotizing enterocolitis\nMultifocal atrial tachycardia Progressive multifocal leuko\nCalciphylaxis IRIDA syndrome\nRetinitis pigmentosa Asbestos intoxication\nNumber of Rare Disease Admissions Identified in MIMIC-III\nICD-9 only both ICD-9 and NLP NLP (SemEHR+WS) only\nFigure 4 Number of rare disease patient stays from MIMIC-III (n=59,652): ICD (code-based) vs. NLP (text-based, with weak supervision), for 10 selected diseases. Admissions are split into those only identified through links from ICD-9 codes (in black), those only identified from free texts with weak supervision (NLP, in white), and the intersection of cases from both ICD-9 and NLP (in grey). The percentage after each horizontal bar shows the accuracy of NLP based on the manual assessment of the identified cases.\nAlthough the accuracy scores were not perfect, for all diseases except IRIDA syndrome, NLP could still enrich the cases identified from ICD-9 after the manual check by the experts. We also find that with ICD codes, it is possible to find cases not identified by NLP as well, as shown in asbestos intoxication, necrotizing enterocolitis, etc., which may be related to the imperfect recall of the NLP model or the rare diseases being not (explicitly) mentioned in the clinical note. In general, the results above on rare diseases extend the conclusion of the previous survey in case detection [24] that NLP with free-texts can greatly enrich the information from ICD codes and the two sources complement each other. We further present the results of NLP with strong supervision in Figure S1-1 in Supplementary material 1, which overall predicted fewer cases and resulted in better accuracy scores, but reflected the same picture as with weak supervision.\nTransfer and Re-training with Radiology Reports For external validation, we applied the proposed weak supervision pipeline and models to extract rare disease phenotypes from two datasets of radiology reports, US MIMICIII radiology reports (n=520k) [20] and UK NHS Tayside brain imaging reports (n=156k) [17]. For each of the datasets, we selected a subset of clinical notes (1,000 for MIMIC-III and 5000 for Tayside), and obtained the candidate mention-UMLS pairs with SemEHR to be labelled for evaluation. The detailed data statistics are in Table 2. Based on the real-world practice of NLP, we consider two ways to apply the pipeline in Figure 2: (i) model transfer and (ii) in-domain re-training. For model transfer, we directly applied our phenotype confirmation models, Mweak (and\nMstrong), trained from MIMIC-III discharge summaries to the two new datasets; for in-domain re-training, we created weakly labelled training data from each new dataset and trained a data-specific phenotype confirmation model with Algorithms 1-2; we further tuned the parameters p and l in the weak labelling rules during re-training.\nTable 6 shows the external validation results of the NLP pipeline with model transfer or in-domain re-training. We mainly present the Text-to-UMLS results, consistent with Text-to-ORDO results in Table S1-4 and admission-level results in Table S1-5 in Supplementary material 1. It is observed that directly applying a weak supervision model trained from another type of report (e.g. discharge summaries) could largely improve the precision and F1 score of SemEHR, with a slight drop of recall from nearly 100% to over 90%. This transferability of models suggests that there are common linguistic patterns used in all types of clinical notes, even from different sources. The strong supervision model obtained a higher precision, but with a much lower recall (a drop of 20% to over 30% compared to SemEHR only) and thus may bear the risk of missing true positive mentions. Results from the in-domain re-training of models were much better than model transfer, as the former could bridge the linguistic gap between discharge summaries and radiology reports even for the same cohort or institution in MIMIC-III. We further tuned the weak labelling parameters to optimise the recall or F1 score. A perfect or no loss of recall (100% or near 95%) was achieved on par with SemEHR and the precision was further improved compared to using the original parameters. Although the parameter tuning process was based on the full annotated data, this can be substituted by the inspection of a small number of data\nat the rule designing stage. Finally, we noticed that simply using rules (SemEHR+rules) with the best tuned parameters was highly effective, achieving better results than most evaluation settings, but still surpassed by the best tuned WS model, especially for the Tayside reports. The results between rules only and weak supervision were consistent with those of the discharge summaries in Table 3."
        },
        {
            "heading": "Conclusion, Discussion, and Future Studies",
            "text": "In this study, we proposed an ontology-driven and weakly supervised approach for rare disease phenotyping from clinical notes. Unlike the use of ontologies, weak supervision has not been well established in the clinical NLP domain. Our proposed weak supervised deep learning approach requires no human annotation and extends the paradigm from [13] on weak supervision for clinical texts, by introducing ontologies, named entity linking tools, and contextual representations. We designed two simple but effective rules (mention character length and corpus-based \u201cprevalence\u201d) to create weakly labelled data regarding ambiguous abbreviations and rare entities. The trained phenotype confirmation model effectively filtered out the false positives in the data with no (or a minimum) side effect on the true positives.\nTraditional clinical NLP relies heavily on strong supervision with manually labelled data. However, with recent data-demanding methods like deep learning, it is time to consider to automatically create labelled data to train models, with the support of rules and resources like ontologies and NER+L tools. Our work on rare diseases provides empirical evidence for the task by applying a weakly supervised NLP pipeline on three clinical note datasets (one for discharge summaries and two for radiology reports) in two institutions in the US and the UK. The improvements on the precision were highly significant (by over 30% to 50% absolute score for Text-to-UMLS linking), with almost no loss of recall compared to the existing NER+L tool, SemEHR. Our study also demonstrates that NLP can comple-\nment traditional ICD-based approaches to better estimate rare diseases in clinical notes (see Figure 4).\nWhile our rule-based weak supervision does not require annotated data, it can bring bias or noise as no simple rule can perfectly predict the labels for a complex task. This bias, although not affecting most predictions for the testing data, was manifested in the slight drop of recall in Text-to-UMLS linking (Table 3). This loss of recall may be minimised through tuning the parameters in the weak labelling rule (e.g. relaxing the \u201cprevalence\u201d or mention length threshold, shown in Table 6), but needs a small set of annotated data or some manual inspection of the predictions. The mention character length rule may also be enhanced with accurate abbreviation expansion and disambiguation to retain abbreviations that are rare diseases. Besides, recent studies in the general NLP domain have begun tackling the bias of rules (with a rule-level attention mechanism [49]) or noise of weakly labelled data (with the estimation of data-level confidence [50]). Also, we used a heuristic-based logic operation (as XNOR) to aggregate the two rules; future studies can explore more advanced aggregation methods (e.g., learning a label model [45, 46]).\nAs suggested in our results and other studies [45, 46], the current performance of the best weakly supervised methods is still below strong supervision. But the gap between the weak and strong supervision is small (within 5% F1 score) and there is no difference in terms of recall. This shows that the expensive and time-consuming annotations for text phenotyping may be greatly reduced, substituted by an alerting system or manual screening based on the predictions of a weakly supervised NLP system. With a small number of annotated data for parameter tuning, both the precision and recall of our weak NLP model were further improved (see Table 6). This may suggest a future study to better use a small sample of annotated data with the weakly annotated data for semi-supervised learning to improve the performance.\nThere are still, however, some false positive mentions detected by the proposed NLP pipeline, as shown in our analyses of the prediction errors and the identified cohorts (in\nFigures 3-4). Disambiguating entity types (especially for abbreviations) still remains a challenge for text phenotying. This suggests to potentially integrate word sense disambiguation to enhance the weak supervision approach, e.g., through more reliable weak data creation. Also, errors in identifying hypothetical and negation (\u201cHypo/neg\u201d) mentions suggest to separately model \u201cHypo/neg\u201d in the classification, which can be learned with mentions beyond the scope of rare diseases. Furthermore, the complexities of linguistic patterns of a (rare) disease may still require better representations beyond the current context window and may need to be enhanced with ontology concepts. Our evaluation of the NLP-identified cases suggests modelling the semantics of the lexical definitions in ontologies (e.g. ORDO) to improve entity linking and ontology matching.\nAlso, we note that our work is highly dependent on existing ontologies and their available matchings to each other. We leveraged and validated the matching among ORDO, UMLS, ICD-10, and ICD-9. The current matchings are generally correct, but not perfect (e.g. 88.4% accuracy of matching between UMLS and ORDO). A more accurate matching among ontologies, potentially corrected with machine learning [51], will improve the performance of our pipeline. It is also possible to directly match texts to ORDO, which can include rare diseases not contained in UMLS, but this does not leverage the synonyms in UMLS that represent the name variation of rare disease entities. Also, our approach cannot identify emerging rare disease entities, not contained in the ontologies and not thus easily captured by SemEHR, which is the next, challenging direction for our study.\nWhile we only enhanced SemEHR with the weakly supervised phenotype confirmation model, the approach can be adapted to improve other NER+L tools and models to support more accurate rare disease cohort selection and coding. Recently, more packages and environments (e.g. Snorkel [46], skweak [52]) have been created to apply weak supervision in general domain NLP practice. Thus, a promising future study is to adapt the current weak supervision infrastructures or the ideas behind them to the clinical NLP domain and establish best practices in the field; a recent work adapting Snorkel [46] is Trove [45], which has not yet been applied to the domain of rare diseases, that involves additional ontologies and their mappings.\nOur work mainly focused on identifying rare disease concepts in the clinical notes, while other physical, behavioural, and physiological characteristics need to be identified so as to establish a clinical diagnosis of a rare disease. We also mainly focused on rare diseases as a whole and the approach can be applied to identify specific rare diseases. Future work needs to extract a wider set of information to enhance rare disease phenotyping, and to facilitate the development of risk prediction tools for rare diseases to support decision making during the COVID-19 pandemic and beyond [53, 54].\nAbbreviations\nBERT: Bidirectional Encoder Representations from Transformers; UMLS:\nUnified Medical Language System; ORDO: Orphanet Rare Disease Ontol-\nogy; MIMIC-III: Medical Information Mart for Intensive Care; NHS: National\nHealth Services; NLP: Natural Language Processing; NER+L: Named Entity\nRecognition and Linking; ICD: International Classification of Diseases; WS:\nWeak Supervision; SS: Strong Supervision."
        },
        {
            "heading": "Declarations",
            "text": "Acknowledgement This work is a substantial extension of our previous work in [7], which provided the first versions of Figures 1 and 2 (re-created and revised in this paper) and some preliminary results on MIMIC-III discharge summaries. We\nwould like to thank Emma Whitfield for the important support on data annotations of discharge summaries during the previous study [7] and feedback on the writing of this work. This work has made use of the resources provided by the Edinburgh Compute and Data Facility (ECDF).\nFunding This work is supported by Health Data Research UK National Phenomics and Text Analytics Implementation Projects, Wellcome Institutional Translation Partnership Awards (PIII009, PIII029, PIII032, PIII054), Medical Research Council and Health Data Research UK (MR/S004149/1). HZ and AC are supported by the Advanced Care Research Centre (ACRC). HD and JC are also supported by EPSRC project ConCur on Knowledge Graph Construction and Curation (EP/V050869/1). The funding bodies are independent of the design of the study and collection, analysis, and interpretation of data and in writing the manuscript.\nAvailability of data and materials The MIMIC III datasets are available at https://mimic.physionet.org/ upon request after the ethical training. NHS Tayside data are not publicly available due to the privacy of patients and please refer to https://www.dundee.ac.uk/hic regarding further interest in the dataset. The rare disease mention annotations of MIMIC-III discharge summaries and radiology reports, along with the implementation of the approach, are available at https://github.com/acadTags/Rare-disease-identification.\nEthics approval and consent to participate We were granted access to MIMIC-III through PhysioNet after completing the ethical training in human research subject protections and HIPAA regulations, through the Collaborative Institutional Training Initiative program (https://physionet.org/about/citi-course/). We have also received NHS Tayside Caldicott Guardian approval (CSAppMW1758) to use the anonymised brain imaging reports for this work. All our methods were carried out in accordance with relevant guidelines and regulations. The approval of both MIMIC-III and NHS Tayside datasets allows us to carry out Natural Language Processing experiments on the reports. All reports have been de-identified and we do not identify any individual patients in the methods and experiments, thus the research is exempt from requiring informed consent from the patients according to the NHS Tayside Caldicott Guardian approval.\nCompeting interests The authors declare that they have no competing interests.\nConsent for publication Not applicable.\nAuthors\u2019 contributions HD, HW, VSP, HZ, and MW conceptualised the research. HD, HW, VSP, MW, and HZ designed the method and experiments. HD, MW, and VSP implemented the approach. MW, HZ, ED, AC, and other researchers annotated the datasets or screened the detected rare disease cases. ED and WW provided clinical suggestions on screening the detected rare disease cases. WW and BA applied for the ethical approval for data access to NHS Tayside brain imaging reports. BA established the secure data server for experimentation. JC provided feedback on ontology-based methods and revisions. HD drafted the paper. All authors read and revised the draft and approved the final manuscript.\nAuthor details 1Centre for Medical Informatics, Usher Institute of Population Health Sciences and Informatics, University of Edinburgh, Edinburgh, United Kingdom. 2Health Data Research UK, London, United Kingdom. 3Department of Computer Science, University of Oxford, Oxford, United Kingdom. 4Advanced Care Research Centre, Usher Institute, University of Edinburgh, Edinburgh, United Kingdom. 5Institute of Health Informatics, University College London, London, United Kingdom. 6Centre for Clinical Brain Sciences, University of Edinburgh, Edinburgh, United Kingdom. 7Department of Computer Science, The University of Manchester, Manchester, United Kingdom. 8Edinburgh Futures Institute, University of Edinburgh, Edinburgh, United Kingdom.\nReferences 1. Nguengang Wakap, S., Lambert, D.M., Olry, A., Rodwell, C., Gueydan,\nC., Lanneau, V., Murphy, D., Le Cam, Y., Rath, A.: Estimating cumulative point prevalence of rare diseases: analysis of the orphanet database. European Journal of Human Genetics 28(2), 165\u2013173 (2020)\n2. Department of Health & Social Care: The UK Rare Diseases Framework. (2021). https://www.gov.uk/government/publications/uk-rare-d iseases-framework/the-uk-rare-diseases-framework (accessed May. 8, 2022) 3. Scottish Government: Illnesses and Long-term Conditions. (2021). https://www.gov.scot/policies/illnesses-and-long-ter m-conditions/rare-diseases/ (accessed Mar. 22, 2021) 4. Richesson, R.L., Fung, K.W., Bodenreider, O.: Coverage of rare disease names in clinical coding systems and ontologies and implications for electronic health records-based research. In: Proceedings of the 5th International Conference on Biomedical Ontology, Houston, Texas, USA, pp. 78\u201380 (2014). CEUR Workshop Proceedings (CEUR-WS.org) 5. Bearryman, E.: Does Your Rare Disease Have a Code? (2016). https://www.eurordis.org/news/does-your-rare-disease -have-code (accessed July 29, 2021) 6. Dong, H., Sua\u0301rez-Paniagua, V., Whiteley, W., Wu, H.: Explainable automated coding of clinical notes using hierarchical label-wise attention networks and label embedding initialisation. Journal of Biomedical Informatics, 103728 (2021). doi:10.1016/j.jbi.2021.103728 7. Dong, H., Sua\u0301rez-Paniagua, V., Zhang, H., Wang, M., Whitfield, E., Wu, H.: Rare disease identification from clinical notes with ontologies and weak supervision. In: 2021 43rd Annual International Conference of the IEEE Engineering in Medicine & Biology Society (EMBC), Online, pp. 2294\u20132298 (2021). IEEE 8. Kahn Jr, C.E.: An ontology-based approach to estimate the frequency of rare diseases in narrative-text radiology reports. Studies in Health Technology and Informatics 245, 896\u2013900 (2017). MEDINFO 2017: Precision Healthcare through Informatics 9. Vasant, D., Chanas, L., Malone, J., Hanauer, M., Olry, A., Jupp, S., Robinson, P.N., Parkinson, H., Rath, A.: ORDO: an ontology connecting rare disease, epidemiology and genetic data. In: Bio-Ontology @ ISMB 2014, pp. 1\u20134 (2014). https://www.resear chgate.net/publication/281824026 ORDO An Ontology Con necting Rare Disease Epidemiology and Genetic Data\n10. Groza, T., Ko\u0308hler, S., Moldenhauer, D., Vasilevsky, N., Baynam, G., Zemojtel, T., Schriml, L., Kibbe, W., Schofield, P., Beck, T., Vasant, D., Brookes, A., Zankl, A., Washington, N., Mungall, C., Lewis, S., Haendel, M.A., Parkinson, H., Robinson, P.: The human phenotype ontology: Semantic unification of common and rare disease. The American Journal of Human Genetics 97(1), 111\u2013124 (2015). doi:10.1016/j.ajhg.2015.05.020 11. Maiella, S., Olry, A., Hanauer, M., Lanneau, V., Lourghi, H., Donadille, B., Rodwell, C., Ko\u0308hler, S., Seelow, D., Jupp, S., Parkinson, H., Groza, T., Brudno, M., Robinson, P.N., Rath, A.: Harmonising phenomics information for a better interoperability in the rare disease field. European Journal of Medical Genetics 61(11), 706\u2013714 (2018). doi:10.1016/j.ejmg.2018.01.013. Focus on rare disease research projects supported by the E-Rare ERA-Net program 12. Shen, W., Wang, J., Han, J.: Entity linking with a knowledge base: Issues, techniques, and solutions. IEEE Transactions on Knowledge and Data Engineering 27(2), 443\u2013460 (2015). doi:10.1109/TKDE.2014.2327028 13. Wang, Y., Sohn, S., Liu, S., Shen, F., Wang, L., Atkinson, E.J., Amin, S., Liu, H.: A clinical text classification paradigm using weak supervision and deep representation. BMC Medical Informatics and Decision Making 19(1), 1 (2019). doi:10.1186/s12911-018-0723-6 14. Ratner, A., Varma, P., Hancock, B., Re\u0301, C., other members of Hazy Lab: Weak Supervision: A New Programming Paradigm for Machine Learning. (2019). http://ai.stanford.edu/blog/weak-supervision/ (accessed Mar. 13, 2021) 15. Wu, H., Toti, G., Morley, K.I., Ibrahim, Z.M., Folarin, A., Jackson, R., Kartoglu, I., Agrawal, A., Stringer, C., Gale, D., Gorrell, G., Roberts, A.,\nBroadbent, M., Stewart, R., Dobson, R.J.: SemEHR: A general-purpose semantic search system to surface semantic data from clinical notes for tailored care, trial recruitment, and clinical research. Journal of the American Medical Informatics Association 25(5), 530\u2013537 (2018). doi:10.1093/jamia/ocx160\n16. Wu, H., Hodgson, K., Dyson, S., Morley, K., Ibrahim, Z., Iqbal, E., Stewart, R., Dobson, R., Sudlow, C.: Efficiently reusing natural language processing models for phenotype identification in free-text electronic medical records: Methodological study. JMIR Medical Informatics 7(4), 1\u201314 (2019). e14782 17. Gorinski, P.J., Wu, H., Grover, C., Tobin, R., Talbot, C., Whalley, H., Sudlow, C., Whiteley, W., Alex, B.: Named Entity Recognition for Electronic Health Records: A Comparison of Rule-based and Machine Learning Approaches. arXiv preprint arXiv:1903.03985 (2019). Comment: 8 pages, presented at HealTAC 2019, Cardiff, 24-25/04/2019 18. Gorrell, G., Song, X., Roberts, A.: Bio-yodie: A named entity linking system for biomedical text. arXiv preprint arXiv:1811.04860 (2018) 19. Peng, Y., Yan, S., Lu, Z.: Transfer learning in biomedical natural language processing: An evaluation of bert and elmo on ten benchmarking datasets. In: Proceedings of the 18th BioNLP Workshop and Shared Task, Florence, Italy, pp. 58\u201365 (2019). Association for Computational Linguistics 20. Johnson, A.E.W., Pollard, T.J., Shen, L., Lehman, L.-w.H., Feng, M., Ghassemi, M., Moody, B., Szolovits, P., Celi, L.A., Mark, R.G.: MIMIC-III, a freely accessible critical care database. Scientific Data 3(1), 1\u20139 (2016). doi:10.1038/sdata.2016.35 21. Pathak, J., Kho, A.N., Denny, J.C.: Electronic health records-driven phenotyping: challenges, recent advances, and perspectives. Journal of the American Medical Informatics Association 20(e2), 206\u2013211 (2013). doi:10.1136/amiajnl-2013-002428 22. Chen, Y., Carroll, R.J., Hinz, E.R.M., Shah, A., Eyler, A.E., Denny, J.C., Xu, H.: Applying active learning to high-throughput phenotyping algorithms for electronic health records data. Journal of the American Medical Informatics Association 20(e2), 253\u2013259 (2013). doi:10.1136/amiajnl-2013-001945 23. Searle, T., Ibrahim, Z., Dobson, R.: Experimental evaluation and development of a silver-standard for the MIMIC-III clinical coding dataset. In: Proceedings of BioNLP, pp. 76\u201385. Association for Computational Linguistics, Online (2020). doi:10.18653/v1/2020.bionlp-1.8 24. Ford, E., Carroll, J.A., Smith, H.E., Scott, D., Cassell, J.A.: Extracting information from the text of electronic medical records to improve case detection: a systematic review. Journal of the American Medical Informatics Association 23(5), 1007\u20131015 (2016). doi:10.1093/jamia/ocv180 25. Harkema, H., Dowling, J.N., Thornblade, T., Chapman, W.W.: Context: An algorithm for determining negation, experiencer, and temporal status from clinical reports. Journal of Biomedical Informatics 42(5), 839\u2013851 (2009). doi:10.1016/j.jbi.2009.05.002. Biomedical Natural Language Processing 26. Kraljevic, Z., Searle, T., Shek, A., Roguski, L., Noor, K., Bean, D., Mascio, A., Zhu, L., Folarin, A.A., Roberts, A., Bendayan, R., Richardson, M.P., Stewart, R., Shah, A.D., Wong, W.K., Ibrahim, Z., Teo, J.T., Dobson, R.J.B.: Multi-domain clinical natural language processing with medcat: The medical concept annotation toolkit. Artificial Intelligence in Medicine 117, 102083 (2021). doi:10.1016/j.artmed.2021.102083 27. Kersloot, M.G., van Putten, F.J.P., Abu-Hanna, A., Cornet, R., Arts, D.L.: Natural language processing algorithms for mapping clinical text fragments onto ontology concepts: a systematic review and recommendations for future studies. Journal of Biomedical Semantics 11(1), 14 (2020). doi:10.1186/s13326-020-00231-z 28. Cusick, M., Adekkanattu, P., Campion, T.R., Sholle, E.T., Myers, A., Banerjee, S., Alexopoulos, G., Wang, Y., Pathak, J.: Using weak supervision and deep learning to classify clinical notes for identification of current suicidal ideation. Journal of Psychiatric Research 136, 95\u2013102 (2021) 29. Shen, Z., Schutte, D., Yi, Y., Bompelli, A., Yu, F., Wang, Y., Zhang, R.: Classifying the lifestyle status for alzheimer\u2019s disease from clinical notes using deep learning with weak supervision. BMC medical\ninformatics and decision making 22(1), 1\u201311 (2022) 30. Devlin, J., Chang, M.-W., Lee, K., Toutanova, K.: BERT: Pre-training of\ndeep bidirectional transformers for language understanding. In: Proceedings of NAACL-HLT, pp. 4171\u20134186. Association for Computational Linguistics, Minneapolis, Minnesota (2019). doi:10.18653/v1/N19-1423\n31. Vaswani, A., Shazeer, N., Parmar, N., Uszkoreit, J., Jones, L., Gomez, A.N., Kaiser, \u0141., Polosukhin, I.: Attention is all you need. In: Advances in Neural Information Processing Systems, Long Beach, CA, USA, pp. 5998\u20136008 (2017). NeurIPS Proceedings 32. Gu, Y., Tinn, R., Cheng, H., Lucas, M., Usuyama, N., Liu, X., Naumann, T., Gao, J., Poon, H.: Domain-specific language model pretraining for biomedical natural language processing. ACM Trans. Comput. Healthcare 3(1) (2021). doi:10.1145/3458754 33. Liu, F., Shareghi, E., Meng, Z., Basaldella, M., Collier, N.: Self-alignment pretraining for biomedical entity representations. In: Proceedings of NAACL-HLT, pp. 4228\u20134238. Association for Computational Linguistics, Online (2021). doi:10.18653/v1/2021.naacl-main.334 34. Noy, N.F.: Ontology Mapping. In: Staab, S., Studer, R. (eds.) Handbook on Ontologies. International Handbooks on Information Systems, pp. 573\u2013590. Springer, Berlin, Heidelberg (2009). doi:10.1007/978-3-540-92673-3 26 35. Euzenat, J., Shvaiko, P.: The Matching Problem. In: Ontology Matching, pp. 25\u201354. Springer, Berlin, Heidelberg (2013). doi:10.1007/978-3-642-38721-0 2 36. Textoris, J., Leone, M.: Genetic Aspects of Uncommon Diseases. In: Leone, M., Martin, C., Vincent, J.-L. (eds.) Uncommon Diseases in the ICU, pp. 3\u201311. Springer, Cham (2014). doi:10.1007/978-3-319-04576-4 1 37. Gururangan, S., Marasovic\u0301, A., Swayamdipta, S., Lo, K., Beltagy, I., Downey, D., Smith, N.A.: Don\u2019t stop pretraining: Adapt language models to domains and tasks. In: Proceedings of ACL, pp. 8342\u20138360. Association for Computational Linguistics, Online (2020). doi:10.18653/v1/2020.acl-main.740 38. Ma, X., Wang, Z., Ng, P., Nallapati, R., Xiang, B.: Universal text representation from bert: An empirical study. arXiv preprint arXiv:1910.07973 (2019) 39. Ministry of Health NZ: Mapping Between ICD-10 and ICD-9. (2000). https://www.health.govt.nz/nz-health-statistics/data -references/mapping-tools/mapping-between-icd-10-a nd-icd-9 (accessed Apr. 30, 2021) 40. NCBO BioPortal: International Classification of Diseases, Version 9 - Clinical Modification. (2021). https://bioportal.bioontology.org/ontologies/ICD9CM (accessed Apr. 30, 2021) 41. Sykes, D., Grivas, A., Grover, C., Tobin, R., Sudlow, C., Whiteley, W., Mcintosh, A., Whalley, H., Alex, B.: Comparison of rule-based and neural network models for negation detection in radiology reports. Natural Language Engineering 27(2), 203\u2013224 (2021). doi:10.1017/S1351324920000509 42. Xiao, H.: Serving Google BERT in Production Using Tensorflow and ZeroMQ. (2019). https://hanxiao.io/2019/01/02/Serving-Google-BERT-in -Production-using-Tensorflow-and-ZeroMQ/ (accessed Apr. 25, 2021) 43. Pedregosa, F., Varoquaux, G., Gramfort, A., Michel, V., Thirion, B., Grisel, O., Blondel, M., Prettenhofer, P., Weiss, R., Dubourg, V., Vanderplas, J., Passos, A., Cournapeau, D., Brucher, M., Perrot, M., Duchesnay, E.: Scikit-learn: Machine learning in Python. Journal of Machine Learning Research 12, 2825\u20132830 (2011) 44. Bodnari, A.: Healthcare Gets More Productive with New Industry-specific AI Tools. (2020). https://cloud.google.com/blog/topics/healthcare-life -sciences/now-in-preview-healthcare-natural-langua ge-api-and-automl-entity-extraction-for-healthcare (accessed Mar. 15, 2021) 45. Fries, J.A., Steinberg, E., Khattar, S., Fleming, S.L., Posada, J., Callahan, A., Shah, N.H.: Ontology-driven weak supervision for clinical entity classification in electronic health records. Nature communications 12(1), 1\u201311 (2021)\n46. Ratner, A., Bach, S.H., Ehrenberg, H., Fries, J., Wu, S., Re\u0301, C.: Snorkel: Rapid training data creation with weak supervision. The VLDB Journal 29(2), 709\u2013730 (2020) 47. Gibaja, E., Ventura, S.: A tutorial on multilabel learning. ACM Comput. Surv. 47(3) (2015). doi:10.1145/2716262 48. Monarch, R.M.: Human-in-the-Loop Machine Learning: Active Learning and Annotation for Human-centered AI. Shelter Island, NY: Manning Publications Company, ??? (2021). Version 11, MEAP Edition (Manning Early Access Program) 49. Karamanolakis, G., Mukherjee, S., Zheng, G., Awadallah, A.H.: Self-training with weak supervision. In: Proceedings of NAACL-HLT, pp. 845\u2013863. Association for Computational Linguistics, Online (2021). doi:10.18653/v1/2021.naacl-main.66 50. Jiang, H., Zhang, D., Cao, T., Yin, B., Zhao, T.: Named entity recognition with small strongly labeled and large weakly labeled data. In: Proceedings of ACL-IJCNLP, pp. 1775\u20131789. Association for Computational Linguistics, Online (2021). doi:10.18653/v1/2021.acl-long.140 51. Kolyvakis, P., Kalousis, A., Smith, B., Kiritsis, D.: Biomedical ontology alignment: an approach based on representation learning. Journal of biomedical semantics 9(1), 1\u201320 (2018) 52. Lison, P., Barnes, J., Hubin, A.: skweak: Weak supervision made easy for NLP. In: Proceedings of ACL-IJCNLP: System Demonstrations, pp. 337\u2013346. Association for Computational Linguistics, Online (2021). doi:10.18653/v1/2021.acl-demo.40 53. Zhang, H., Thygesen, J., Wu, H.: Increased covid-19 related mortality rate for patients with rare diseases: a retrospective cohort study with data from genomics england. The Lancet 398, 95 (2021). doi:10.1016/S0140-6736(21)02638-6. Public Health Science 2021 54. Zhang, H., Thygesen, J.H., Shi, T., Gkoutos, G.V., Hemingway, H., Guthrie, B., Wu, H.: Increased covid-19 mortality rate in rare disease patients: a retrospective cohort study in participants of the genomics england 100,000 genomes project. Orphanet Journal of Rare Diseases 17(1), 1\u20137 (2022)\nSupplementary materials 1 - Further Parameter Settings and Results and 2 - Examples of Rare Disease Identification and Ontology Matching\nWeak Rule Parameter Tuning The results of parameter tuning for weak labelling rules regarding F1, recall, and precision scores, are displayed in Table S1-1. We tuned through a grid search the possible values of p \u2208 {1e\u22124, 5e\u22124, 1e\u22123, 5e\u22123, 1e\u22122, 5e\u22122, 1e\u22121} and l \u2208 {2, 3, 4}, and selected the model based on recall and F1 scores in Text-to-UMLS linking. For MIMIC-III discharge summaries, the results were based on the 400 validation set of manually annotated mention-UMLS pairs. The parameter p controls the corpus-based \u201cprevalence\u201d of the disease concept, which is related to epidemiological information, e.g., the actual prevalence of a rare disease in the cohort. A higher p resulted in more disease concepts selected, thus higher recall but generally less precision. The parameter l controls the mention length, a key threshold to filter out abbreviations, which are usually ambiguous in their meanings. A higher l thus generally resulted in a higher precision but lower recall. We observed that a corpus-based \u201cprevalence\u201d threshold of 0.005 and a mention character length threshold of 3 resulted in the best F1 score for the dataset. We thus recommend to set p \u2208 {0.005, 0.01} and l \u2208 {3, 4} and used p as 0.005 and l as 3 for MIMIC-III discharge summaries.\nAlso, we found that the results were not sensitive to window size, i.e. the input tokens before and after the mention. Thus, all models used the default window size of 5.\nTable S1-1 F1, Precision (P), and Recall (R) scores with respect to the weak rule parameters p and l in Text-to-UMLS linking for MIMIC-III discharge summaries (with the highest F1 score in bold)\nl = 2 l = 3 l = 4 F1 P R F1 P R F1 P R\np = 0.0001 73.7% 64.1% 86.6% 59.3% 86.5% 45.1% 64.3% 87.8% 50.7% p = 0.0005 73.7% 59.6% 96.5% 82.6% 91.5% 75.4% 79.8% 91.0% 71.1% p = 0.001 72.8% 57.3% 100.0% 80.8% 91.2% 72.5% 79.8% 91.0% 71.1% p = 0.005 71.5% 55.7% 100.0% 89.8% 90.1% 89.4% 87.5% 91.5% 83.8% p = 0.01 71.0% 55.0% 100.0% 89.7% 87.3% 92.3% 88.5% 90.4% 86.6% p = 0.05 63.7% 46.7% 100.0% 64.0% 47.0% 100.0% 64.3% 47.3% 100.0% p = 0.1 60.0% 42.9% 100.0% 60.0% 42.9% 100.0% 60.0% 42.9% 100.0%\nEmbedding and Fine-tuning Settings We controlled the same window size (as 5) in baselines with word2vec embeddings and BERT model fine-tuning.\nFor the word2vec embeddings pre-trained on MIMIC-III discharge summaries, we used Gensim library[1] with Continuous Bag of Words algorithm, without filtering vocabularies by frequency (min count=0). We experimented with the dimensions of 100, 300, and 768 (see Table 4 in the paper).\n[1]https://radimrehurek.com/gensim/auto examples/tutorials/run word2vec.html\nar X\niv :2\n20 5.\n05 65\n6v 5\n[ cs\n.C L\n] 3\nM ay\n2 02\n3\nFor fine-tuning BERT models, we used the average pooling of the mention\u2019s sub-tokens representations in the second-last layer (same as the Contextual Mention Representation, with fine-tuning instead of static embedding), followed by a linear layer with softmax activation and cross-entropy loss. The learning rate, warmup steps, and weight decay were 5e-05, 500, and 0.01, resp., set up using Huggingface Trainer[2], and trained with 3 epochs. We fine-tuned the BlueBERT-based model (see Table 4 in the paper).\nResults on Different Encoding Strategies The first encoding strategy is mention masking, whether or not to mask the mention in the full context window. The intuition behind this is to explore the potential of a language model to confirm a phenotype solely based on the surrounding context but not the mention itself.\nThe second encoding strategy is using document structure names (or template section names) to enhance local context. If the document structure name s is available in the dataset, we add s before the context window t with a separation token [SEP] in between.\nResults on the different encoding strategies for Text-to-UMLS linking in MIMIC-III discharge summaries are displayed in Table S1-2. Non-masked encoding achieved better results than masked encoding. Using document structure names further boosted recall scores on the validation and the test set. We used non-masked encoding (with document structure names for MIMIC-III discharge summaries only) for data representation.\nTable S1-2 Comparison among encoding strategies for weakly supervised Text-to-UMLS linking on MIMIC-III discharge summaries\nvalidation set (n=142+/400) test set (n=187+/673) Text to UMLS P R F1 P R F1 non-M 89.9 87.3 88.6 81.3 90.9 85.9 non-M+DS 90.1 89.4 89.8 80.4 92.0 85.8 M 86.5 63.4 73.2 78.6 61.0 68.7 M+DS 86.4 62.7 72.7 78.0 62.6 69.4\nM denotes mention masking and non-M denotes no mention masking applied. DS denotes using document structure names. The non-M+DS model was trained on the full set of weakly labelled data, without tuning the optimal number of data, thus slightly below results in Table 2. BlueBERT-base (PubMed+MIMIC-III) was used to encode the text sequences.\nNLP with Strong Supervision vs. ICD for Admission-level Rare Disease Identification Figure S1-1 shows the results of the NLP pipeline with strong supervision compared to ICD codes for admission-level rare disease phenotyping. The results were generally consistent with the weak supervision approach (in Figure 4 in the paper) that NLP-based results greatly complement the code-based rare disease cohort. Generally, a higher accuracy with a less number of admissions was predicted by strong supervision compared to weak supervision (e.g. the accuracy was 25.5% or 14/55 predicted by \u201cRetinitis Pigmentosa\u201d for strong supervision, compared to 8.2% or 15/183 predicted by weak supervision).\nOverall Admission-level and Mention-level Results Table S1-3 shows the admission-level rare disease phenotyping results for MIMIC-III discharge summaries.\n[2]https://huggingface.co/docs/transformers/main classes/trainer\n8\n10\n26\n42\n42\n69\n6\n82\n16\n268\n103\n47\n102\n30\n24\n194\n55\n73\n74.1%\n95.1%\n68.0%\n68.1%\n75.5%\n36.1%\n100.0%\n0.0%\n25.5%\n92.9%\n0 50 100 150 200 250 300\nAmyotrophic lateral sclerosis Rheumatic fever\nAcute liver failure Necrotizing enterocolitis\nMultifocal atrial tachycardia Progressive multifocal leuko\nCalciphylaxis IRIDA syndrome\nRetinitis pigmentosa Asbestos intoxication\nNumber of Rare Disease Admissions Identified in MIMIC-III\nICD-9 only both ICD-9 and NLP NLP (SemEHR+SS) only\nFigure S1-1 Number of rare disease patient stays from MIMIC-III (n=59,652): ICD (code-based) vs. NLP (text-based, with strong supervision). The 10 rare diseases are the same as those presented for weak supervision in Figure 4 in the paper. Admissions are split into those only identified through links from ICD-9 codes (in black), those only identified from free texts with strong supervision (NLP, in white), and the intersection of cases from both ICD-9 and NLP (in grey). The percentage after each horizontal bar shows the accuracy of NLP based on the manual assessment of the identified cases.\nTable S1-4 and S1-5 show the overall mention-level (Text-to-ORDO) and admissionlevel results of two radiology report datasets in the US (MIMIC-III) and the UK (NHS Tayside). For Tayside data, the recall was lower as we manually identified new rare disease mentions that were not included in the candidate mentions from SemEHR. Weak supervision (WS) achieved better recall than transferring the SS model in results from both Tables. The code-based approach (ICD) also did not show an advantage in identifying more rare disease admissions (see recall, R), and overall performance (see F1), comparing ICD or \u201cICD \u222a SemEHR+WS\u201d with the (best) SemEHR+WS setting in Table S1-5 and Table S13, but the results may be biased towards methods adapting SemEHR as it was used as a starting source to create candidate mentions for the manual annotation.\nExamples of Rare Disease Text Phenotyping Table S2-6 (on page 5) shows some selected prediction errors and a few correct predictions. The first four examples are the false positives selected in the evaluation data for the weak supervision model due to semantic type errors, hypothetical contexts, or other issues. The last five examples are those selected from the identified rare disease cohort for Retinitis Pigmentosa and Rheumatic Fever. Synonyms in UMLS could help identify some name variations, e.g. \u201ctracheobronchomalacia\u201d for Williams-Campbell syndrome, and \u201cacute rheumatic fever\u201d for Rheumatic fever, but also introduces false positives especially regarding abbreviations, e.g. \u201cEMA\u201d and \u201cRP\u201d. The complex context in the clinical notes, including the relative\u2019s diseases or hypothetical mentions, although only representing a small part of cases, were still challenging for the NLP pipeline (SemEHR+WS), as these were not explicitly considered in the weakly supervised training process. We also note that there were errors in parsing the document structure name through regular expressions in SemEHR, which might affect the predictions.\nTable S1-3 Micro-level results of admission-level rare disease identification for MIMIC-III discharge summaries\nvalidation (n=30+/117\u221755)\ntest (n=42+/192\u221782)\nAdmission to ORDO P R F1 P R F1 SemEHR 15.4 93.3 26.4 12.7 95.2 22.3 + rules 39.2 66.7 49.4 38.9 88.1 54.0 + WS (rules+BERT) 57.1 66.7 61.5 49.3 78.6 60.6 + SS (anns+BERT) - - - 61.1 78.6 68.7 ICD 56.2 30.0 39.1 27.3 21.4 24.0 ICD \u222a SemEHR+WS 50.0 70.0 58.3 40.4 85.7 55.0 ICD \u222a SemEHR+SS - - - 45.9 81.0 58.6\nThe micro-level metric counts each admission and an associated ORDO concept (or an admission-ORDO pair) as a single instance. The column statistics (n=N++/Nd \u2217 Nl) show the number of positive data N+, admissions (or discharge summaries) Nd, and unique candidate rare diseases (or ORDO concepts) Nl in the dataset. WS, weak supervision; SS, strong supervision; anns, annotations. BlueBERT-base (PubMed+MIMIC-III) was used as the BERT model. ICD denotes the approach to matching ICD-9 codes to ORDO concepts. The union sign (\u222a) denotes merging and de-duplicating the cases identified from the two methods. Precision (P) and F1 for ICD-based methods may be lower than actual values, as all candidate mentions were from SemEHR.\nTable S1-4 Results on rare disease identification (Text-to-ORDO) for MIMIC-III and Tayside radiology reports\nMIMIC-III Radiology (n=46+/198) Tayside Brain Imaging (n=42+/283)\nText to ORDO P R F1 P R F1 SemEHR 22.9 93.5 36.8 13.1 78.6 22.4 + WS (transfer) 48.8 84.8 61.9 31.4 76.2 44.4 + SS (transfer) 86.5 69.6 77.1 53.2 59.5 56.2 + rules (tuned) 84.8 84.8 84.8 31.4 76.2 44.4 + WS (in-domain) 68.3 89.1 77.4 26.4 78.6 39.5 + WS (+ tuning R) 78.2 93.5 85.1 32.4 78.6 45.8 + WS (+ tuning F1) 86.7 84.8 85.7 46.3 73.8 56.9\nThe column statistics (n=N++/N ) shows the number of positive data N+ and the overall number of samples N in the dataset. WS, weak supervision; SS, strong supervision. The original parameters for WS were p = 0.005 and l = 3. The new parameters for best recall (R) were p = 0.01 and l = 4 and for best F1 were p = 0.0005 and l = 4, for both datasets. For SemEHR+rules, rules were aggregated with an OR operation and p = 0.0005 and l = 4.\nOntology Matching from ORDO to ICD-9 Table S2-7 (on page 6) shows 10 examples of rare disease concepts and their ontology matching from ORDO to UMLS, ICD-10, and ICD-9. The rare diseases are the same as those presented in Figure 4 in the paper and Figure S1-1 in Supplementary material 1.\nTable S1-5 Micro-level results of admission-level rare disease identification for MIMIC-III and Tayside Radiology Reports\nMIMIC-III Radiology (n=29+/145\u221743) Tayside Brain Imaging (n=41+/273\u221765)\nAdmission to ORDOs P R F1 P R F1 SemEHR 19.4 93.1 32.1 12.8 78.0 22.0 + WS (transfer) 38.7 82.8 52.7 30.7 75.6 43.7 + SS (transfer) 83.3 69.0 75.5 53.2 61.0 56.8 + rules (tuned) 80.0 82.8 81.4 30.7 75.6 43.7 + WS (in-domain) 59.5 86.2 70.4 25.8 78.0 38.8 + WS (+ tuning R) 71.1 93.1 80.6 31.7 78.0 45.1 + WS (+ tuning F1) 82.8 82.8 82.8 46.3 75.6 57.4 ICD 46.4 44.8 45.6 - - - ICD \u222a SemEHR+WS 51.9 93.1 66.7 - - -\nThe micro-level metric counts each admission and an associated ORDO concept (or an admission-ORDO pair) as a single instance. The column statistics (n=N++/Nd \u2217 Nl) show the number of positive data N+, the number of admissions (or discharge summaries) Nd, and the number of candidate rare diseases (or ORDO concepts) Nl in the dataset. WS, weak supervision; SS, strong supervision. The original parameters for WS were p = 0.005 and l = 3. The new parameters for best recall (R) were p = 0.01 and l = 4 and for best F1 were p = 0.0005 and l = 4, for both datasets. For SemEHR+rules, rules were aggregated with an OR operation and p = 0.0005 and l = 4. The union sign (\u222a) denotes merging and de-duplicating the cases identified from the two methods. For ICD \u222a SemEHR+WS, the WS model was \u201cin-domain + tuning R\u201d, the one re-trained with in-domain data and optimised recall. Precision (P) and F1 for ICD-based methods may be lower than actual values, as all candidate mentions were from SemEHR.\nTable S2-6 Examples of wrong and correct rare diseases identified by SemEHR with the weak supervised phenotype confirmation model from MIMIC-III discharge summaries\nROW ID Document Structure Text (with mention in bold) UMLS ORDO Pred Label Potential Reason 26825 pertinent results\n(should be pathology) Pathology: ...Immunostains for cytokeratin AE1/3 and CAM 5.2, CD-68, CD-79a, CD-138, S-100, LCA absorbed CEA, EMA, CD34, CD31, TTF-1, actin, desmin, MNF-116, calcitonin, and thyroglobulin are negative... C0268596 26791 Multiple acyl-CoA dehydrogenase deficiency T F negation with a long context, ambiguous mention (EMA as epithelial membrane antigen), and semantic type error (negative test)\n869 Hospital course Brief Hospital Course: ## Dyspnea - ...DFA for flu was negative; urinary legionella antigen was also negative... C0023241 549 Legionellosis T F semantic type error with negation (negative test) 8960 History of Past Illness Past Medical History: 1. Diagnosed in his early years with bilateral uveitis, clinically had bilateral uveitis significant with loss of vision and sarcoid floaters in both eyes. . . C0036202 797 Sarcoidosis T F not enough information (sarcoid floater not necessary means sarcoid) 46361 pertinent results (should be impression)\nIMPRESSION: ...Of note prior chest CT scans have findings suggesting a propensity to tracheobronchomalacia, as well as moderately severe emphysema.... C0340231 411501 WilliamsCampbell syndrome\nT F hypothetical context\n48161 Admission Medications Medications on Admission: ...Vitamin A palmitate 100,000 units 1.5 tablets dialy for retinitis pigmentosa, acetaminophen, tums, Mylanta, OTC Prilosec prn C0035334 791 Retinitis Pigmentosa T T correct 26351 Hospital course ...Her ASA continued to be held due to the RP bleed but was restarted after 48 hrs of stable Hct. . . C0035334 791 Retinitis Pigmentosa T F ambiguous abbreviation (Retroperitoneal bleeding) 12659 History of Past Illness Past Medical History: PMHx: ... 7. h/o of rheumatic fever with Sydenham\u2019s chorea. . . C0035436 3099 Rheumatic fever T T correct 20984 Hospital course The patient never reported any pharyngitis, but given his complaints of diffuse arthralgias, myalgias, migrating neuropathic pain, there was some concern of rheumatic fever, as the patient had 2 ASO screens performed which were both negative. C0035436 3099 Rheumatic fever T F hypothetical context 11568 basic (should be family history)\nFAMILY HISTORY: ...2) His mother has an enlarged heart which may be secondary to a history of acute rheumatic fever... C0035436 3099 Rheumatic fever T F a relative\u2019s disease\nPrediction errors are coloured with red in \u201cPred\u201d (third-last) column. For columns \u201cPred\u201d and \u201cLabel\u201d, \u201cT\u201d means that the prediction or gold is True and \u201cF\u201d indicates False. The wrongly parsed document structure names in the second column are marked with corrected ones in the form of \u201c(should be XXX)\u201d.\nTable S2-7 Ontology concept matching among ORDO, UMLS, ICD-10, and ICD-9 based on publicly available sources\nORDO ORDO Preferred Label UMLS ICD-10 ICD-9-NZ (from ICD-10) Preferred Label ICD-9-BP (from UMLS) Preferred Label 803 Amyotrophic lateral sclerosis C0002736 <G122 - - 335.20 Amyotrophic lateral sclerosis 3099 Rheumatic fever C0035436 >I011, >I00, >I010, >I012, >I018, >I019 3911, 390, 3910, 3912, 3918, 3919\nAcute rheumatic endocarditis; Rheumatic fever without mention of heart involvement; Acute rheumatic pericarditis; Acute rheumatic myocarditis; Other acute rheumatic heart disease; Acute rheumatic heart disease, unspecified 390- 392.99\nACUTE RHEUMATIC FEVER\n90062 Acute liver failure C0162557 <K720 - - - - 391673 Necrotizing entero-\ncolitis C0520459 =P77 7775 Necrotizing enterocolitis in newborn - -\n3282 Multifocal atrial tachycardia C0221158 <I471 - - - - 217260 Progressive multifocal leukoencephalopathy C0023524 =A812 0463 Progressive multifocal leukoencephalopathy 46.3 Progressive multifocal leukoencephalopathy 280062 Calciphylaxis C0006666 <E835 - - - - 791 Retinitis pigmentosa C0035334 <H355 - - - - 209981 IRIDA syndrome C0085576 <D508 - - - - 2302 Asbestos intoxica-\ntion C0003949 <J61 - - 501 Asbestosis\n=, >, and < in ORDO-to-ICD-10 mappings (all from ORDO) indicate exact, broader-to-narrower, and narrower-to-broader matching, respectively. Narrower-to-broader matching (<) from ORDO to ICD-10 was not used for phenotyping, as it may result in common or non-rare diseases\u2019 ICD codes. All ORDO-to-UMLS mappings (all from ORDO) indicate exact matching (=). \u201cICD-9-NZ\u201d denotes the set of ICD-9 codes linked from ICD-10 codes using the matching from the Ministry of Health, New Zealand, https://www.health .govt.nz/nz-health-statistics/data-references/mapping-tools/mapping-between-icd-10-and-icd-9. \u201cICD-9-BP\u201d refers to the set of ICD-9 codes linked from UMLS based on the ICD-9-CM ontology (version 2020AB) in BioPortal, https: //bioportal.bioontology.org/ontologies/ICD9CM."
        }
    ],
    "title": "Ontology-Driven and Weakly Supervised Rare Disease Identification from Clinical Notes",
    "year": 2023
}
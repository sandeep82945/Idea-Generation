{
    "abstractText": "Molecular dynamics (MD) simulations of complex electrochemical systems, such as ionic liquid supercapacitors, are increasingly including the constant potential method (CPM) to model conductive electrodes at a specified potential difference, but the inclusion of CPM can be computationally expensive. We demonstrate the computational savings available in CPM MD simulations of ionic liquid supercapacitors when the usual non-periodic slab geometry is replaced with fully periodic boundary conditions. We show how a doubled cell approach, previously used in non-CPM MD simulations of charged interfaces, can be used to enable fully periodic CPM MD simulations. Using either a doubled cell approach or a finite field approach previously reported by others, fully periodic CPM MD simulations produce comparable results to the traditional slab geometry simulations with a nearly double speedup in computational time. Indeed, these savings can offset the additional cost of the CPM algorithm, resulting in periodic CPM MD simulations that are computationally competitive with the non-periodic, fixed charge equivalent simulations for the ionic liquid supercapacitors studied here. Published under an exclusive license by AIP Publishing. https://doi.org/10.1063/5.0086986",
    "authors": [
        {
            "affiliations": [],
            "name": "Debra J. Searles"
        }
    ],
    "id": "SP:f03f6c1d471547d9419174d1b3811fbf9b6f7467",
    "references": [],
    "sections": [
        {
            "text": "Published under an exclusive license by AIP Publishing. https://doi.org/10.1063/5.0086986\nI. INTRODUCTION A better understanding of the electrode\u2013electrolyte interface is crucial to further progress in energy storage, electrocatalysis, and other electrochemical applications, many of which are vital for meeting the historic challenge of climate change. Room-temperature ionic liquids (RTILs) are especially promising as electrochemical solvents due to their high ionic conductivity and thermal stability, wide electrochemical window and liquid range,1,2 and extensive tunability.3 However, modeling the interface between RTILs and electrodes is especially challenging due to the high ionic concentrations of RTILs for which models beyond mean-field theory are required to take into account dynamic ionic correlations, both within the RTIL and with the electrode.4\nClassical molecular dynamics (MD) is an important technique for studying the interface between electrodes and RTILs as well as other concentrated electrolytes to provide insights beyond the current theoretical models. More detailed quantum mechanical\nmethods, such as ab initio MD, can provide more fundamental models but cannot reach the nano- to microsecond timescales required for observing ionic layer rearrangement and other slow electrolyte phenomena, which are routinely achievable in classical MD simulations. Therefore, improving MD simulations of RTILs is an active area of research with many recent promising calibrations of polarizable,5 atomistic,6 and coarse-grained7,8 force fields for RTILs.\nAs electrolyte force fields become more sophisticated and realistic, more effort should be invested at the same time into modeling conductive electrodes with more realistic dynamics. Most MD simulations consider an oversimplified model of the electrode, where the charge is simply uniformly distributed across the electrode surface and remains fixed over time. This fixed charge method (FCM) does not maintain a constant potential across the electrode surface and thus does not accurately model a conductive electrode. In addition, it clearly omits phenomena where the surface charge changes over time, the most prominent being capacitor charging and discharging.\nJ. Chem. Phys. 156, 184101 (2022); doi: 10.1063/5.0086986 156, 184101-1\nPublished under an exclusive license by AIP Publishing\n18 January 2024 23:48:35\nBy contrast, the constant potential method (CPM)9\u201312 explicitly includes charge redistribution steps to better model conductive electrodes. CPM MD generally provides better accuracy for simulations of electrochemical interfaces13,14 and is particularly important for understanding non-planar electrodes.15\u201317 Capturing the dynamic local fluctuations in electrode charges is also indispensable when studying dynamical phenomena of electrochemical interfaces, which influence capacitor charging and discharging,18,19 electrochemical thermodynamics,16 and electroresponsive tribology.20 The technical aspects of CPM MD are themselves a burgeoning field of research with modifications recently proposed to model electrode metallicity in addition to conductivity.21,22 A recent publication23 describes independent upgrades to the CPM implementation in the Large-scale Atomic/Molecular Massively Parallel Simulator (LAMMPS) software package,24 including adaptations to mesh-based long-ranged electrostatic evaluation, which are complementary to the implementations in this paper25,26 and raise the possibilities for significant efficiency gains.\nNonetheless, computational cost remains a significant obstacle to more widespread adoption of CPM MD since every charge update step includes at least one re-evaluation of the system\u2019s overall electrostatic energy. In any MD simulation with a large proportion of charged particles, the Fourier space calculation of long-ranged electrostatic interactions is usually the most computationally intensive component. Simulations of systems with mixed periodicity\u2014such as electrode\u2013electrolyte systems, which are not periodically repeated transverse to the electrodes\u2014are even more expensive, even considering the \u201cslab correction\u201d27 techniques often employed.\nRecently, two fully periodic approaches for studying electrochemical interfaces have been proposed and explored as fully periodic alternatives to the slab correction: finite field simulations28 and doubled cell simulations.29 In this paper, we demonstrate that these approaches make RTIL\u2013electrode simulations significantly more efficient by enabling fully periodic CPM MD simulations and eliminating the need for slab corrections. Full periodicity substantially reduces the computational cost of evaluating long-range electrostatics to the extent that fully periodic CPM MD simulations can be computationally competitive with non-periodic FCM MD simulations with atomistic electrode charges run on the same hardware. As such, the increased accuracy afforded by CPM MD simulations can be achieved with little or even no overhead relative to FCM MD, and we recommend their routine use when studying RTIL\u2013electrode interfaces. A copy of the source code used in this paper is available online.25,26"
        },
        {
            "heading": "II. METHODS",
            "text": ""
        },
        {
            "heading": "A. An overview of CPM MD",
            "text": "Molecular dynamics can provide a detailed model of electric layers in capacitors using a fixed volume simulation cell containing electrolyte molecules sandwiched between two charged electrodes (Fig. 1). In CPM MD simulations, the electrode charges qi are periodically updated to maintain the electrode potentials \u03a8i at their prescribed values.10,13,16 Here, we give a brief overview of the method as excellent detailed descriptions are available in other recent publications.23,30\nFIG. 1. Depiction of simulated constant potential supercapacitor, showing the cations (magenta) and anions (teal) between three-layer graphene electrodes (white). For each electrode, a single proximal layer is charge-updated during CPM MD, leading to either negative (red) or positive (blue) charges induced on each electrode as appropriate. This results in the potential difference \u0394\u03c8 being imposed between the electrodes. The potential offset \u03c8 maintains the overall electroneutrality of the system (depicted here as one of the electrodes being grounded). The molecular configuration was visualized using VMD.51\nThe potential energy of the MD simulation cell, U, is the sum of all non-Coulombic energies UNC and all Coulombic interactions. The Coulombic interactions can further be divided into electrolyte\u2013electrolyte, electrode\u2013electrolyte, and electrode\u2013electrode interactions. Due to the delocalization of charges on the conductive electrodes, it is usual to represent these as a set of Gaussian functions centered on the atomic sites, whereas the charges on the ions or molecules in the liquid are usually treated as point-charges. Using i to index the electrode atoms and j to index the charged sites of the electrolyte ions and molecules, we can then write U as\nU = UNC + 1\n4\u03c0\u03b50 \u23a1\u23a2\u23a2\u23a2\u23a2\u23a3 \u2211 j,j \u2032 , pbc QjQj \u2032 \u2223Rj \u2212 Rj \u2032 \u2223 + \u2211 i,j, pbc \u222b Qj\u03c1i(r) \u2223Rj \u2212 r\u2223 d3r\n+ \u2211 i,i\u2032 , pbc \u222c \u03c1i(r)\u03c1i\u2032(r\u2032) \u2223r \u2212 r\u2032\u2223 d 3r d3r\u2032 \u23a4\u23a5\u23a5\u23a5\u23a5\u23a6 . (1)\nHere, the subscripts \u201cpbc\u201d denote periodic boundary conditions (to be discussed later), \u03b50 is the permittivity of free space, and Qj and Rj are the charge and position of the electrolyte charge indexed j, respectively. The charge density \u03c1i(r) associated with the electrode particle indexed i is a Gaussian density centered at position ri,\n\u03c1i(r) = qini(r) = qi \u03b73\n\u03c03/2 exp(\u2212\u03b72\u2223r \u2212 ri\u22232), (2)\nwhere qi is the total charge on the electrode atom and \u03b7 (in inverse length units) serves as a width parameter for the Gaussian charges. The use of Gaussian charge densities ensures that the electrode\u2013electrode interactions can later be written as an invertible matrix.11\nWriting the vector of the electrode charges q \u2261 {q1, \u22c5 \u22c5 \u22c5 , qi, \u22c5 \u22c5 \u22c5}, the simulation box potential energy U [Eq. (1)] can be written as a quadratic form in q,\nU = UNC +Uelyt \u2212 qTb + 1 2 qTAq. (3)\nHere, Uelyt is the sum of the electrolyte\u2013electrolyte Coulombic interactions, the vector b represents the electrode\u2013electrolyte\nJ. Chem. Phys. 156, 184101 (2022); doi: 10.1063/5.0086986 156, 184101-2\nPublished under an exclusive license by AIP Publishing\n18 January 2024 23:48:35\ninteractions, and the matrix A represents the electrode\u2013electrode interactions\u2014that is, Eq. (3) represents the terms (in order) from Eq. (1) as functions of q. The electrostatic potential vector \u03a8 \u2261 {\u03a81, . . . ,\u03a8i, . . .} is the derivative of the energy with respect to the electrode charges, and therefore,\n\u03a8 \u2261 \u2202U \u2202qT = Aq \u2212 b, (4)\nwhere the second equality follows from Eq. (3). The elements of b depend on the positions of the electrolyte atoms, which will vary with time. However, the electrode atoms are often fixed during a simulation in which case A will not vary with time.\nIn CPM MD, the electrode charges q are updated so that the electrode potentials are specified. That is, we seek a specific q\u2217 such that substituting into Eq. (4) gives\n\u03a8 = \u03c8e + \u0394\u03c8d. (5)\nHere, d is an \u201cindicator\u201d vector with entries \u22121/2 for elements corresponding to atoms on one electrode and 1/2 for elements corresponding to atoms on the other and e is a \u201csum\u201d vector with entries one for all elements. This general form ensures that atoms of the same electrode have equal potential, and there is a potential difference \u0394\u03c8 between the electrodes, while allowing for an overall offset potential \u03c8 relative to the potential at infinity. Then, q\u2217 can be directly determined,\nq\u2217 = A\u22121(\u03c8e + \u0394\u03c8d + b). (6)\nOther studies, including the prior LAMMPS implementation of CPM MD,13 simply adopted \u03c8 = 0. However, this results in the total charge of the system being non-zero in general; this can severely jeopardize the accuracy of the resulting CPM MD simulation, as recently discussed.23,50 Substituting Eq. (5) into the electroneutrality constraint eTq\u2217 = 0 and solving for \u03c8 gives\n\u03c8 = \u2212 e TA\u22121(\u0394\u03c8d + b)\neTA\u22121e (7)\nin which case the constant potential, electroneutral charge vector q\u2217 is given by\nq\u2217 = A\u22121(\u0394\u03c8d + b \u2212 e TA\u22121(\u0394\u03c8d + b)\neTA\u22121e e)\n= OA\u22121(\u0394\u03c8d + b), (8)\nwhere the final result is arrived at by defining an \u201celectroneutrality projector\u201d matrix,\nO \u2261 I \u2212 (A\u22121eeT)/(eTA\u22121e). (9)\nThis is the same result recently obtained via statistical-mechanical analysis of fluctuations of the electrode charge in the constant potential ensemble.30 If the electrode particles used in CPM MD remain stationary, the matrix OA\u22121 will be constant and can be precomputed as its entries only depend on the electrode particle positions. Along these lines, we have updated the previous version\nof the LAMMPS CPM MD package13 to include the electroneutrality correction and use the new charge-neutral version25,26 in the calculations in the following.\nThen, the main computational burden during each charge update step is to obtain the vector of electrode potentials, b, from the positions of the electrolyte particles. Switching from partially periodic to fully periodic boundary conditions substantially speeds up this step, as we discuss in Sec. II B."
        },
        {
            "heading": "B. Faster electrostatic evaluation using fully periodic boundary conditions",
            "text": "MD simulations are performed under periodic boundary conditions to enable inferences about macroscopic systems from a nanometer-scale simulation volume. In supercapacitor simulations, the theoretical intention is to have electrodes and electrolyte repeated infinitely parallel to the electrode surface (which we label the x and y axes) but not transverse to the electrodes (which we label the z axis), as depicted in Fig. 2(a). Given the slow 1/r decay of the Coulombic interaction, direct evaluation of the Coulombic interaction terms in (1) is not feasible. Instead, Ewald summation can be used, where the Coulomb interaction is truncated in realspace so that it can be treated with a finite cutoff with the truncated long-range Coulombic interaction being calculated using Fourier transforms in reciprocal space, where it rapidly converges.31,32\nAlthough Ewald summation is straightforward in systems with full, three-dimensional periodicity, the electrode\u2013electrolyte system as described is trickier to handle because of its mixed periodicity. The finite z size of the system changes the associated Fourier sum into a Fourier integral,10,33 and this \u201cexact Ewald 2D\u201d method is rarely implemented in major MD codes. Instead, the \u201cslab correction\u201d is commonly used: as shown in Fig. 2(b), z-periodicity is imposed with empty space added between repeats of the simulation box, and a charged-sheet approximation is used to remove the residual dipole\u2013dipole interaction between those repeats.27\nThe slab correction is equivalent to discretizing the exact Ewald 2D method34 but still bears increased computational costs: since the\nJ. Chem. Phys. 156, 184101 (2022); doi: 10.1063/5.0086986 156, 184101-3\nPublished under an exclusive license by AIP Publishing\n18 January 2024 23:48:35\nsimulation box has been expanded in the z direction, more reciprocal vectors are required to reach the same accuracy, resulting in larger Fourier grids and more computational burden for the reciprocal space calculation. This has motivated a search for methods of simulating electrode\u2013electrolyte systems that preserve full periodicity. Two such methods have been recently described in the literature28,29 and are introduced in the following. They are applied to the simulation of a model supercapacitor with CPM MD and compared in this paper."
        },
        {
            "heading": "1. Finite field method",
            "text": "The first method utilizes an applied \u201cfinite field\u201d to decouple adjacent simulation boxes28 [Fig. 2(c)], motivated by a related approach to modeling polarizability in bulk systems.35 In this method, for an intended potential difference \u0394\u03c8, an electric field Ez = \u2212\u0394\u03c8/Lz is applied across the simulation box.\nThe simulation box potential energy under a finite field, U ff , is obtained by adding a polarization term to the original potential energy U from Eq. (1),\nU ff = U \u2212 \u0394\u03c8 Lz \u239b \u239d\u2211i qizi +\u2211 j QjZj \u239e \u23a0 , (10)\nwhere zi and Zj are the z-positions of the electrode atoms and electrolyte charge sites, respectively. We also define z as the vector of z-positions of the electrode atoms. The itinerant polarization35 does not need to be tracked because all particles are bounded between the electrodes.\nThe electrode charges q are then simply obtained by considering the electric field in the specification of the potential in Eq. (5) (i.e., \u03a8 = \u03c8e \u2212 \u0394\u03c8z/Lz) and solving for q with a variable \u03c8 and imposing charge neutrality. The field introduces a discontinuity in the potential generated across the box with a value \u0394\u03c8, which is the potential difference between the electrodes. The electrode charges are then\nq\u2217 = OA\u22121(\u2212\u0394\u03c8 Lz z + b), (11)\nwhich is a simple modification of (8) and allows an implementation that is similar to the basic CPM MD algorithms. Although the finite field method has very recently been applied to a computational RTIL\u2013electrode interface,36 comparisons have not been made with the slab correction method in terms of either accuracy or computational speed. We document these comparisons and as our first major computational result show that with properly optimized algorithms, the finite field method is significantly faster thanks to full periodicity in long-range electrostatics evaluations."
        },
        {
            "heading": "2. Doubled cell method",
            "text": "Another available method that has been used for other systems but not for CPM MD is a \u201cdoubled cell\u201d approach. In this approach, two sub-cells are built back-to-back with opposing polarities; this yields a unit cell that has zero net dipole and thus automatically has no dipole\u2013dipole interactions along the z direction. Although the system to be simulated is twice as large, each sub-cell is effectively independent so that twice as much data can be collected per simulation interval.\nThis method has previously been applied to polar surfaces as the \u201cmirrored slab\u201d method37,38 to capture the dynamics of polar liquids near statically charged surfaces. More recently, this method was applied to simulate the effects of an applied electric field on a liquid\u2013liquid interface.29 However, the same motivation in both cases\u2014allowing fully periodic electrostatic evaluation for systems with significant overall dipole\u2014also applies to CPM MD, and we demonstrate as the second major computational result that doubled cell CPM MD also yields accurate results with reduced computational cost relative to slab correction.\nThe only additional complexity occurs if we require each subcell to be independently electroneutral to resemble the single cells. We can accomplish this by modifying Eq. (5) to include two offset potentials,\n\u03a8 = \u03c8e + \u03c81e1 + \u0394\u03c8d. (12)\nThe vectors e, e1, and d run over all electrode particles in both subcells. As mentioned above, the elements of e are one for all electrode particles and the elements of d are 1/2 for atoms on both positive electrodes (one for each sub-cell) and \u22121/2 for atoms on the negative electrodes. The new vector e1 \u201cselects\u201d the electrode particles of only one sub-cell\u2014that is, its elements are one for all particles of the electrodes (both positive and negative) in one of the sub-cells and 0 for all electrode particles in the other sub-cell. When we require that eTq\u2217 = 0 and eT1 q\u2217 = 0, this ensures that both sub-cells are electroneutral.\nWe can then write out the two corresponding projection matrices in analogy with Eq. (8). Fulfilling the first constraint eTq\u2217 = 0 and solving for \u03c8 give us\nq\u2217 = OA\u22121(\u03c81e1 + \u0394\u03c8d + b), (13)\nwhere O is defined as above [Eq. (9)]. Fulfilling the second constraint, eT1 q\u2217 = 0, and solving for \u03c81 then give\nq\u2217 = O1OA\u22121(\u0394\u03c8d + b), (14)\nwhere\nO1 \u2261 I \u2212 OA\u22121e1eT1 eT1 OA \u22121e1 . (15)\nIn short, maintaining independent electroneutrality for each sub-cell simply requires pre-calculation of one additional projection matrix O1OA\u22121, which does not change in systems with stationary electrode particles, resulting in minimal additional computational burden. Although this does result in a nominal difference in the instantaneous offset potentials between the cells, our results show that electrolyte dynamics within one sub-cell is not affected by the configuration in the other. Intuitively, this arises since the conductors screen electric fields, and therefore, the presence of conductive electrodes between the electrolytes of each cell prevents them from interacting as long as the electrolytes are separated far enough to avoid short-range interactions. This further emphasizes that the offset potential serves only to maintain electroneutrality and does not affect the accuracy of simulation results in any other way.\nJ. Chem. Phys. 156, 184101 (2022); doi: 10.1063/5.0086986 156, 184101-4\nPublished under an exclusive license by AIP Publishing\n18 January 2024 23:48:35"
        },
        {
            "heading": "C. Calculating potential profiles in different optimized geometries",
            "text": "The electric potential profile across the simulation box, \u03c8(z), is a key measurement output for a computational supercapacitor as it is used to determine the differential capacitance at each electrode, and our third major result is that full periodicity also simplifies the calculation of \u03c8(z). If the potential profile only varies in z, then it can be calculated by obtaining the linear charge density, \u03c1(z), and solving the 1D Poisson equation,\nd2\ndz2 \u03c8(z) = \u2212 1 \u03b50 \u03c1(z), (16)\nsubject to the appropriate boundary conditions. For this paper, we use a matrix-based finite difference method, which approximates d2/dz2 as a linear finite difference relation; this method converges well even at low finite difference orders.39 The Poisson equation can then be inverted simply by applying the inverse finite difference matrix to the discretization of the charge density \u03c1(z).\nThe boundary conditions to be applied depend on whether electroneutrality is imposed and whether periodic or non-periodic boundaries have been used. If electroneutrality is not imposed, non-periodic boundary conditions involve setting the potential at each electrode to their CPM pre-specified values (see supplementary material of Ref. 19, for example). With electroneutrality, the potential at each electrode is set using \u0394\u03c8 and \u03c8 instead, as in Eq. (5). Both finite field and doubled cell methods have full periodicity, and thus, boundary conditions can be applied across the periodic boundary rather than at the location of each electrode. In the finite field method, the total potential rise \u03c8(Lz) \u2212 \u03c8(0) is simply the preset potential difference \u0394\u03c8, which enters the boundary conditions as a discontinuity across the z-boundary of the unit cell. In the doubled cell method, the (doubled) unit cell is repeated with no further modification, and the boundary condition is just continuity across the z-boundary, \u03c8(Lz) \u2212 \u03c8(0) = 0. The continuity of the potential is likely to be easier to apply if the electrodes are not planar. Furthermore, our results show that for the special case of planar electrodes, the boundary condition can accommodate the use of CPM MD to only charge or discharge the electrode layers closest to the electrolyte, resulting in further computational savings."
        },
        {
            "heading": "III. SIMULATIONS AND ANALYSES",
            "text": "We demonstrate the slab, finite field, and doubled cell methods with a computational ionic liquid supercapacitor (Fig. 1). The supercapacitor electrolyte consists of a 10 nm wide block of 1- butyl-3-methylimidazolium hexafluorophosphate (BMim+ \u2212 PF\u22126 ). The electrolyte is sandwiched between two atomistic graphene electrodes of three layers each with the interlayer spacing set to 0.335 nm as standard. The ions are simulated using a coarse-grained model that has been tested previously.7 The BMim+ cations and PF\u22126 anions are coarse-grained to three particles and one particle per ion, respectively, with Lennard-Jones and Coulomb interactions modeled using parameters from the literature7 and the cations treated as rigid bodies with the SHAKE algorithm.40 In the model, the IL ions are charge-scaled so that the charge on each cation (anion) is +0.78 (\u22120.78). Literature values for the graphene carbon atom LennardJones parameters41 were used, and Lennard-Jones parameters for\ninteractions between the carbon and IL atoms were obtained using the standard Lorentz\u2013Berthelot rules. The supercapacitor was simulated over a set of potential differences from 0.0 to 2.5 V for 30 ns per run at each potential difference, and each set of runs was repeated three times for each method from statistically different initial configurations.\nDuring production runs, only the first layer of each electrode closest to the electrolyte was \u201ccharged\u201d with CPM MD with the next two layers contributing only non-Coulombic interactions, based on previous studies finding that the charge is predominantly induced on the first layer13 and consistent with the charge distribution of a conductor. Within the simulation cell, charged electrode layers were separated by a distance of 109.75 \u00c5 (with electrolyte filling the inbetween space), and the simulation cell had a width of 136 \u00c5. Thus, in both finite field and doubled cell configurations, there was a spacing of about 26 \u00c5 between charged electrode layers, exceeding the short-range cutoff used to evaluate pair forces (16 \u00c5).\nSnapshots from each run were separately post-processed to determine the charges that would have been obtained with the constant potential applied to all three layers. The resulting charge distribution was found to confirm the findings of the previous studies, as we discuss later, validating the choice to charge only one layer during production for significant computational savings. In subsequent discussion, these differing configurations of electrode charges are referred to as \u201csingle-layer\u201d and \u201cthree-layer\u201d charges, respectively.\nFrom each run, the transverse charge profile across the cell was obtained as an equilibrium average and the potential profile was calculated using the finite difference method discussed earlier. The potential on each electrode was subsequently obtained by comparison to the potential in the middle of the cell, and charge\u2013potential curves were then used to obtain the single-electrode differential capacitance by spline fitting.\nTwo sets of simulations were run to compare the results obtained using fixed charges on the electrode particles, instead of charges dynamically updated using CPM. In the first set, all electrode particles were left uncharged. This allows us to validate the doubled cell method by comparing the electrolyte dynamics with CPM simulations at 0 V (Sec. IV B). In the second set, the top-most layer of each electrode was given a charge of 9 \u00d7 10\u22125 e per particle (positive or negative, depending on the electrode location). This allows us to compare the computational expense of the fixed charge with CPM charged electrodes (Sec. IV E).\nFurther details for the simulations and analyses are given in the Appendix."
        },
        {
            "heading": "IV. RESULTS",
            "text": ""
        },
        {
            "heading": "A. Charging and steady state properties",
            "text": "Figure 3(a) shows typical traces of the surface charge density, \u03c3, against simulation time at 0.0, 1.2, and 2.5 V for the first 15 ns of the 30 ns trajectories. These graphs show a non-zero charging time characteristic of the CPM MD simulation, allowing equilibration to be visually estimated. Similar charging characteristics are seen for all other potential differences studied, as shown in the Appendix, Fig. 11. Equilibrium charges are attained within a few nanoseconds, which is a typical timescale for coarse-grained simulations, and so,\nJ. Chem. Phys. 156, 184101 (2022); doi: 10.1063/5.0086986 156, 184101-5\nPublished under an exclusive license by AIP Publishing\n18 January 2024 23:48:35\nthe final 25 ns of each trajectory is taken as the equilibrium portion for further analysis.\nThe simulations using the slab, finite field, and doubled cell geometries return largely identical results, whether from the charging curves or from obtaining the equilibrium average charges as a function of the potential difference [Fig. 1(b)]. To further validate the doubled cell method, we analyzed both long term charges and short term dynamics of doubled cell trajectories.\nB. Validating the doubled cell method In order for the doubled cell method to be computationally efficient, both cells must return independent trajectories so that the doubled system size truly gives twice as much data. As Fig. 4 shows, at any single potential difference, the left and right sub-cell charge densities are uncorrelated after equilibration\u2014each set of similarly colored points is roughly circular in shape instead of covering an ellipse, which would be the case if correlations were present. While uncorrelated, left and right sub-cell charges have the same expectation value, as highlighted by the green line [left cell \u03c3(t) = right cell \u03c3(t)]. Thus, after equilibration, the two sub-cells sample independent and identical electrode charge distributions.\nTo further validate trajectory independence in the doubled cell method, two short trajectories with \u0394\u03c8 = 0 V and under different initial conditions were compared [Fig. 5(a)]. Under the antisymmetric (or anti) initial condition, a single cell configuration (comprising both positions and velocities) was reflected along the z axis, while under the symmetric (or sym) initial condition, the duplicated cell was also z-reversed, resulting in a reflected image. Thus, under the sym condition, the electrolyte and electrodes initially have the same alignment in both cells, while under the anti condition, the electrolyte and electrodes initially have opposite alignment, making two significantly different initial conditions. Stated differently, the left\nJ. Chem. Phys. 156, 184101 (2022); doi: 10.1063/5.0086986 156, 184101-6\nPublished under an exclusive license by AIP Publishing\ncell is in the same state under both sym and anti initial conditions, while the right cell is significantly different. Thus, if the left cell evolves identically under sym and anti initial conditions, its evolution has not been influenced by the right cell; on the other hand, if the sym and anti evolution of the left cell differs, then the left cell is influenced by the right cell, and the dynamics of the two sub-cells are not truly independent.\nWe track the dynamical evolution by measuring the electrolyte dipole moment (\u2211QjZj) for the left cell. This allows us to compare CPM and fixed charge MD simulations (since the electrode charge does not evolve in the latter). Figure 5(b)(i) shows that in all CPM MD simulations, the electrolyte dipole moment evolves identically for the first 2.5 ps. The identical evolution is seen under both anti and sym initial conditions in the doubled cell method as well as for slab and finite field simulations using only a single cell. At the start of the simulation, the electrode charges in the right cell will be recalculated so that the dipole moment of this cell is reset to zero. After 2.5 ps, all of the CPM MD trajectories diverge from each other. This suggests that the trajectory divergence occurs for the usual reasons, namely, accumulation of the numerical error leading to Lyapunov instability, and does not originate from the doubled cell method. We note that in the doubled cell method, two separate Nose\u2013Hoover thermostats are used, one for each cell; using a single Nose\u2013Hoover thermostat across the electrolytes of both cells couples them together and reduces their independence (data not shown).\nWe demonstrate that for the fixed charge MD, statistical independence of the two cells is not observed by repeating simulation of the short trajectories under a fixed charge condition, simply leaving all electrode particles neutral. As shown in Fig. 5(b)(ii), there is an immediate difference between sym and anti trajectories, showing that in fixed charge MD the two cells are no longer completely uncoupled. Both the sym and anti trajectories also quickly diverge from a single cell, slab-corrected fixed charge comparison trajectory.\nWe can rationalize the difference between CPM and fixed charge doubled cell MD by considering the role of the induced charges on the electrodes. In CPM, the induced electrode charges ensure that the overall simulation cell has a dipole moment of zero, and thus, the sub-cells are not influenced by each other or their own periodic replicates. By contrast, in the fixed charge method, there is no guarantee that the overall simulation cell has a dipole moment of zero due to the electrolyte fluctuations, and thus, the sub-cells can be mutually influenced through their dipole moments.\nWe emphasize that the anti initial condition is an extreme-case initial configuration, where the electrolyte dipoles in each sub-cells are aligned and thus the overall simulation cell has twice the dipole moment of each individual sub-cell. Thus, our tests do not invalidate the fixed charge doubled cell methodology. Over an equilibrated simulation, the two sub-cells will have equal and opposite dipoles on average, and thus, on average, the interaction between sub-cells should be minimal. Nonetheless, the sub-cells are guaranteed on physical grounds to be independent in doubled cell CPM MD and thus yield twice as much data per unit of simulation time regardless of the instantaneous configuration."
        },
        {
            "heading": "C. Electrolyte and charge densities",
            "text": "Figure 6 shows the equilibrium density profiles of BMim+ and PF\u22126 particles across the cell for the imposed potential differences\nFIG. 6. Trajectory averaged anion and cation densities near the cell electrodes at electrode potential differences of \u0394V = 0.0 V (top), 1.2 V (middle), and 2.5 V (bottom) with the dashed gray lines indicating the positions of the electrodes nearest to the ionic liquid. Densities were drawn using dashed, dotted, and solid lines for slab, finite field, and doubled cell geometries, respectively, but the differences cannot be visually distinguished and are not larger than between different runs using identical geometries.\n\u0394V = 0.0, 1.2, and 2.5 V. Again, little difference is seen between the slab, finite field, and doubled cell geometries. Ionic layers are observed to form at the interfaces with the conducting electrodes with the layers at 0.0 V attributable purely to size and symmetry of the ions and their interactions with the carbon atoms of the electrode. At higher voltages, distinct phenomena control the electrode ionic layering. The anion, which is represented as a sphere, can be packed into the layer nearest the electrode with increasing density at higher potential differences. Since the cation has an irregular shape, cationic layers cannot pack with the same efficiency, and the increased electrode charge causes cationic density to broaden and build up in the second layer instead. In either case, there is a clear change from co-layering at low electrode charges, where anion and cation layers almost coincide, to counter-layering where anions and cations alternate. These profiles are similar to prior studies16 and demonstrate that the finite field and doubled cell methods produce similar results in terms of the electrolyte arrangement.\nFigure 7 shows the charge density across the cell, accounting for the Gaussian charge densities on the electrode layers. Again, all three methods return very similar charge densities with larger oscillations near the electrodes as the potential difference increases. Similar oscillations are seen at all other potential differences, as seen in the Appendix, Fig. 12. Comparing the post-processed three-layer charges to the single-layer charges shows that when CPM MD is\nJ. Chem. Phys. 156, 184101 (2022); doi: 10.1063/5.0086986 156, 184101-7\nPublished under an exclusive license by AIP Publishing\n18 January 2024 23:48:35\napplied to all three electrode layers, more than 90% of the charge is still induced on the single layers closest to the electrolyte. Leaving the basal layers uncharged is thus expected to have a minimal effect on the electrolyte dynamics but has consequences for obtaining the correct potential profile using Poisson methods, as discussed in the following."
        },
        {
            "heading": "D. Simulation cell potential profiles and differential capacitances",
            "text": "Figure 8 shows the potential profiles, \u03c8(z) \u2212 \u03c8, across the cell for \u0394V = 0.0, 1.2, and 2.5 V in slab, finite field, and doubled cell methods. The average values of \u03c8 are very small compared to \u03c8(z) for these systems (e.g., for slab simulations, \u2223\u03c8\u2223 < 0.03 V at all potentials considered). As in Fig. 7, solid lines show the single-layer potential profile and dashed lines show the three-layer potential profile. Potential profiles are similar for all other potential differences, as seen in the Appendix, Fig. 13.\nThe three-layer potential profiles show little difference between the three methods (besides statistical variation between trajectories). For all methods, the potential difference between the innermost electrodes and the cell boundaries is equal to the imposed electrode potential difference as with the finite field and doubled cell methods.\nThe single-layer potential profiles within the electrodes, on the other hand, are visibly affected by the choice of boundary conditions and differ visibly between slab, finite field, and doubled cell methods. We discuss these results for the particular case of \u0394\u03c8 = 2.5 V, but the same phenomena are seen at all other potential differences (shown in Fig. 8 for 0.0 and 1.2 V).\nConsidering the single-layer charged electrodes first (solid lines in Fig. 8), the insets show that for all systems, \u03c8(z) \u2212 \u03c8 is exactly \u22121.25 V at the electrode in contact with the electrolyte, as set. Between this electrode and the next, the magnitude of the potential initially increases in all cases due to the Gaussian distribution of the charges. In the slab and double cell system, it then reaches a constant value, which is maintained until the edge of the 2D simulation cell is\nFIG. 8. Trajectory averaged electrostatic potential (\u03c8(z) \u2212 \u03c8) across the simulation cell for slab (top left), finite field (top right), and doubled cell (bottom) methods at imposed potential differences \u0394V = 0.0, 1.2, and 2.5 V. As in Fig. 7, solid lines are single-layer potential profiles and dashed lines are three-layer predicted potential profiles, and electrode positions are indicated by the dotted lines. The solid lines for the slab results are obtained by setting the potential difference between the innermost electrode layers to the simulation imposed value. (Insets) Potentials in the electrode regions are magnified to better visualize the effect of inner-layer charges on the potential profile.\nreached (slab) or the charge of the other surface electrode becomes significant (doubled cell). In the finite field method, the field due to the added ramp potential that has been applied across the whole simulation cell rather than between the electrodes is evident and results in a linear drop in the magnitude back to the value of \u22121.25 V at the\nFIG. 9. Electrode charges (top) and differential capacitance (bottom) as a function of the electrode potential \u03c8e, calculated from three-layer charges.\nJ. Chem. Phys. 156, 184101 (2022); doi: 10.1063/5.0086986 156, 184101-8\nPublished under an exclusive license by AIP Publishing\n18 January 2024 23:48:35\nsimulation cell boundary. For all systems with the use of the threelayer charged electrodes, \u03c8(z) \u2212 \u03c8 at each of the three electrodes is fixed to \u22121.25 V, so after the initial increase in magnitude of the electrostatic potential due to the Gaussian distribution of charge, there is a drop back to \u22121.25 V at the next electrode. Since the charge on this electrode is small, there is little evidence of the Gaussian distribution of charges. The potential within the electrode is artificially increased due to the absence of the counter-charges from the inner layers.\nGiven the electrostatic potential profiles, the electric surface potential (the difference in the electrostatic potential at each electrode in the middle of the cell), \u03c8e, can be determined, and the dependence of the electrode charges on \u03c8e is shown in Fig. 9. Within the statistical error, the same average charge and electrode potentials are evolved for each simulation at the same potential difference, regardless of the method used. Therefore, the calculated differential capacitance, CD = d\u03c3/d\u03c8e, is also the same between slab, finite field, and doubled cell methods (within statistical uncertainties), as Fig. 9 shows, and the double-humped curve characteristic of screening and overcrowding in complex ionic electrolytes is obtained.4,42 The method used to determine the uncertainties in CD is given in the Appendix."
        },
        {
            "heading": "E. Computational efficiency",
            "text": "Although the three methods compared so far give similar results, their computational costs required differ greatly. Figure 10 shows the computational expense for simulations using each method running on four Intel Xeon Haswell 2.6 GHz processors. (For the doubled cell geometry, each nanosecond of simulation time was counted as providing two nanoseconds of simulation data since the sub-cells have independent dynamics.) The supercapacitor system was also simulated in slab geometry with fixed (single-layer) charges of \u00b19 \u00d7 10\u22125e per atom to allow the computational costs of CPM and FCM MD to be compared.\nComparison of constant potential and fixed charge methods for the slab geometry shows that CPM charge updating incurs a computational overhead of about 20% for this system. A similar overhead is incurred in doubled cell and finite field geometries\u2014however, the significantly reduced unit cell size and subsequent reduction in long-range electrostatic calculations more than offset the overhead.\nIn either periodic geometry, the long-range electrostatic calculations are about 60% cheaper than in the slab geometry. As such, on aggregate, either fully periodic method for CPM MD results in simulations that are 30%\u201335% cheaper than FCM MD slab simulations (at least with atomistic electrode charges). The strong scaling (speedup when using more processors on a problem of the same size) is similar for all four methods with the finite field and doubled cell methods showing slightly better scaling.\nIn closing, it is interesting to note that the use of doubled cell configuration has been used in fixed charge MD simulations for some time with the purpose of more realistically applying a field across a slab-like system.29 One main purpose of our paper is to demonstrate the application of the doubled cell configuration to CPM MD simulations, which are important for modeling realistic electrode\u2013electrolyte interactions, but our results suggest that in a doubled cell, fixed charge simulation, the two sub-cells are not fully decoupled (while in a CPM MD simulation, they are fully decoupled). Fixed charge simulations will generally be more straightforward and quicker than an equivalent CPM MD simulation, and if the quantities of interest do not depend intimately on the details of electrode charges (such as polarization in the bulk electrolyte, far from electrodes) then the added complexity of a CPM MD simulation may not be worthwhile. Nonetheless, our results show that the novel application of a doubled cell configuration to CPM MD can result in substantial computational savings and true decoupling of the trajectories of both sub-cells."
        },
        {
            "heading": "V. CONCLUSIONS",
            "text": "We have shown that fully periodic geometries are useful for accelerating CPM MD simulations of electrodes and their interactions with ionic liquid electrolytes. The resulting efficiency gains in long-range electrostatic calculations can more than offset the cost of the CPM charge update procedure, resulting in CPM MD simulations that are computationally cheaper than their fixed charge equivalents in slab geometries.\nWe have demonstrated these capabilities of CPM MD in a computational ionic liquid supercapacitor with flat electrodes. The charging behavior over time, ionic and charge densities across the cell, and resulting estimates of differential capacitance are statistically identical between the slab geometry and the two periodic geometries tested, namely, finite field and doubled cell. In doubled cell geometry, the electrode charges evolved in each sub-cell are statistically uncorrelated, and the dynamics of each sub-cell are found to be independent of the electrolyte configuration of the other subcell. Strictly speaking, our demonstration currently only applies to flat electrodes, such as those in our computational system. However, we anticipate that the finite field and doubled cell techniques can also be applied to electrodes with complex morphologies, such as curved or nanoporous electrodes, and investigation is currently under way to confirm this.\nWhen deriving the simulation cell potential profile in order to calculate electrode potentials and differential capacitances, the use of fully periodic geometries also entails simplified boundary conditions, which make trajectory post-processing easier. In our study, we found the use of single-layer charges had no effect in the middle of the cell, despite multiple charged sheets being physically necessary to screen charge within the electrode. Thus, the significant advantages\nJ. Chem. Phys. 156, 184101 (2022); doi: 10.1063/5.0086986 156, 184101-9\nPublished under an exclusive license by AIP Publishing\n18 January 2024 23:48:35\nof fully periodic CPM MD argue for its wider adoption in simulating electrode\u2013electrolyte interactions."
        },
        {
            "heading": "ACKNOWLEDGMENTS",
            "text": "The authors thank the Australian Research Council for its support for this project through the Discovery Program (Grant Nos. DP180104031 and FL190100080). We would like to thank Dr. Emily Kahl for her invaluable support in developing and debugging the source code used in this project. We acknowledge access to computational resources at the NCI National Facility through the National Computational Merit Allocation Scheme supported by the Australian Government, and this work was also supported by resources provided by the Pawsey Supercomputing Centre with funding from the Australian Government and the government of Western Australia. We also acknowledge support from the Queensland Cyber Infrastructure Foundation (QCIF) and the University of Queensland Research Computing Centre (RCC).\nAUTHOR DECLARATIONS Conflict of Interest\nThe authors have no conflicts to disclose.\nDATA AVAILABILITY\nThe data that support the findings of this study are available from the corresponding author upon reasonable request."
        },
        {
            "heading": "APPENDIX: METHOD AND COMPUTATIONAL DETAILS",
            "text": ""
        },
        {
            "heading": "1. Force field and overall simulation details",
            "text": "The electrolyte modeled was an ionic liquid, [BMim+][PF\u22126 ], using the coarse-grained force field by Roy and Maroncelli7 with three-site cations (kept rigid using SHAKE) and one-site anions. Each electrode was modeled as three graphene sheets with the usual A-B-A staggering, bond\u2013bond (1.42 \u00c5) and interlayer (3.35 \u00c5) distances, and the Lennard-Jones parameters by Cole and Klein;41 this combination of CG IL and graphene force fields has frequently been used in prior research.43 Non-Coulombic interactions were modeled with the Lennard-Jones form with a cutoff of 16 \u00c5, whereas Coulombic interactions were modeled using particle\u2013particle particle-mesh (PPPM) summation44 to a relative accuracy of 10\u22128.\nAll MD simulations were integrated using a velocity-Verlet algorithm with a time step of 2 fs. A Nose\u2013Hoover thermostat45\u201347 with a time constant of 100 fs was applied to the electrolyte particles to maintain a temperature of 400 K, and cations were kept rigid using the SHAKE algorithm.40 The LAMMPS package24 was used to run simulations with modifications to implement the CPM charge update algorithms. The extra code was based on the prior package LAMMPS-CONP13 with further optimizations and is freely available on GitHub."
        },
        {
            "heading": "2. Equilibration, production, and post-analysis",
            "text": "Bulk simulations of 1440 ion pairs were first conducted for 4 ns using an NPT barostat48 at 1 bar with a time constant of 4 ps, and the\nbulk density of the CG IL model was determined to be 1.267 g cm\u22123. A 320 ion pair lattice was then initialized and equilibrated under xand y-periodic boundary conditions with cell sides 32.2 and 34.4 \u00c5, respectively, while wall potentials with the electrode Lennard-Jones parameters were applied in the z direction until bulk density was replicated in the middle half of the configuration over 1 ns. This slab configuration was then combined with a pair of electrodes whose distance was scanned to maintain bulk density, resulting in a final distance between proximal electrode planes of 109.75 \u00c5 and a unit cell z length of 136 \u00c5.\nFrom this initial state, CPM MD simulations were run for 30 ns (1.5 \u00d7 107 time steps) in either slab, single cell (finite field), or doubled cell geometries; doubled cell initial states were formed by replicating the one-cell initial state in the z direction and then flipping positions of electrolytes in the second sub-cell. For each geometry, 11 potential differences were used (0.0, 0.3, 0.5, 0.8, 1.0, 1.2, 1.5, 1.8, 2.0, 2.2, and 2.5 V). Electrode charges were updated every five steps (10 fs), which is acceptable since other studies report accurate results even with less frequent charge updates,49 and the electrode charges were modeled as Gaussian distributions [see (2)] with \u03b7 = 1.979/\u00c5, as used in other studies.13 After each set of simulations had been completed, the final state of the 0.0 V simulation was used as the starting state for a new set of simulations; this was repeated twice for a total of three independent simulation sets. At an accuracy of 10\u22128, the PPPM meshes used for slab, finite field, and doubled cell geometries contained 30(x) \u00d7 30(y) \u00d7 225(z), 30 \u00d7 30 \u00d7 90, and 30 \u00d7 32 \u00d7 180 grid points, respectively.\nFor each run, position configurations were written to a disk every 20 ps (104 time steps). During each run, only the electrode layers nearest to the ionic liquid were charged with the CPM update procedure, while the further two layers of each electrode were left neutral and only contributed Lennard-Jones interactions. To study the accuracy of this approximation, the snapshots of each trajectory were re-run, and the charges that would have evolved had all three electrode layers been charged were recorded for analysis. As described in Sec. IV C, the resulting charges on the further two layers are very small and unlikely to significantly affect the observed dynamics, but they can affect the calculation of the cell potential profile.50\nThe steady state particle and charge densities were subsequently obtained over a z-grid spacing of 0.34 \u00c5, corresponding to 400 grid points per unit cell for the slab and finite field geometries and 800 grid points per unit cell for the doubled cell geometries, and the electrostatic potential profile \u03c8(z) was obtained using finite differences as described in the text. The average value of \u03c8(z) across the middle 100 grid points of each unit cell (sub-cell, for doubled cell calculations) was then used as the potential in the middle of the cell and set to 0 V for calculating the anode and cathode potentials.\nEach set of runs thus contributed 22 data points (two for each potential difference) to the plot of the electrode charge against potential in Fig. 9. Charge-against-potential datasets were subsequently used to estimate the differential capacitance, CD = d\u03c3/d\u03c8e, by fitting the dataset to a fifth-order spline between \u22121.2 and 1.3 V. The gradient at each end-point was constrained to be equal to the linear least squares gradient of the five furthest points to prevent oscillatory overfitting at the end points. The uncertainty in CD was estimated by random sampling from the independent trajectories: each of the 22 data points in the charge\u2013potential curve could take\nJ. Chem. Phys. 156, 184101 (2022); doi: 10.1063/5.0086986 156, 184101-10\nPublished under an exclusive license by AIP Publishing\n18 January 2024 23:48:35\none of the three possible values (six for the doubled cell results), given the three independent sets of runs, and thus, independent CD curves could be calculated based on which run was chosen at which point. 200 such independent CD curves were calculated and the 95% confidence interval, shown in Fig. 9, was chosen as 1.96 \u00d7 the standard deviation at each potential."
        },
        {
            "heading": "3. Initial charge trajectories, charge density profiles, and potential profiles for all potential differences",
            "text": "Figures 11\u201313 show initial charge trajectories, charge density profiles, and potential profiles for all potential differences. Although\nFIG. 11. Typical trajectories of instantaneous surface charge density against simulation time for all potential differences studied under CPM MD, spread over three panels for clarity. The set shown was collected using slab simulations; as discussed in the main text, finite field and doubled cell simulations yield similar results. Each trajectory is labeled with the potential difference used, and the lines are also color-coded using the same color scheme as subsequent graphs. The graphs are spread over three different panels for better visibility.\nFIG. 13. Single cell potential profiles for all potential differences studied with the positions of negative (positive) electrodes denoted by red (blue) dotted lines as in the main text figures and different line colors showing the simulation imposed potential difference. The three-layer potentials are depicted here, and a constant shift is applied so that the potentials at the cell edges are \u00b1\u0394V/2. At higher potential differences, the down-shift of the potential in the middle of the cell is noticeable and corresponds to the asymmetric electrode differential capacitance documented in the text.\nthe data shown here is derived from the slab trajectories, similar results are seen when visualizing the same quantities from the finite field and doubled cell trajectories."
        }
    ],
    "year": 2024
}
{
    "abstractText": "From construction materials, such as sand or asphalt, to kitchen ingredients, like rice, sugar, or salt; the world is full of granular materials. Despite impressive progress in robotic manipulation, manipulating and interacting with granular material remains a challenge due to difficulties in perceiving, representing, modelling, and planning for these variable materials that have complex internal dynamics. While some prior work has looked into estimating or learning accurate dynamics models for granular materials, the literature is still missing a more abstract planning method that can be used for planning manipulation actions for granular materials with unknown material properties. In this work, we leverage tools from optimal transport and connect them to robot motion planning. We propose a heuristics-based sweep planner that does not require knowledge of the material\u2019s properties and directly uses a height map representation to generate promising sweeps. These sweeps transform granular material from arbitrary start shapes into arbitrary target shapes. We apply the sweep planner in a fast and reactive feedback loop and avoid the need for model-based planning over multiple time steps. We validate our approach with a large set of simulation and hardware experiments where we show that our method is capable of efficiently solving several complex tasks, including gathering, separating, and shaping of several types of granular materials into different target shapes.",
    "authors": [
        {
            "affiliations": [],
            "name": "Nikhilesh Alatur"
        },
        {
            "affiliations": [],
            "name": "Olov Andersson"
        },
        {
            "affiliations": [],
            "name": "Roland Siegwart"
        },
        {
            "affiliations": [],
            "name": "Lionel Ott"
        }
    ],
    "id": "SP:f58eafeea413eb009d9044c59d6ac40d1614ce4c",
    "references": [
        {
            "authors": [
                "A. Billard",
                "D. Kragic"
            ],
            "title": "Trends and challenges in robot manipulation",
            "venue": "Science, 2019.",
            "year": 2019
        },
        {
            "authors": [
                "Z. Pan",
                "A. Zeng",
                "Y. Li",
                "J. Yu",
                "K. Hauser"
            ],
            "title": "Algorithms and systems for manipulating multiple objects",
            "venue": "IEEE Transactions on Robotics, 2022.",
            "year": 2022
        },
        {
            "authors": [
                "W. Kim",
                "C. Pavlov",
                "A.M. Johnson"
            ],
            "title": "Developing a simple model for sand-tool interaction and autonomously shaping sand",
            "venue": "arXiv preprint arXiv:1908.02745, 2019. (a) EMD: Gathering in Uniform (b) EMD: Separation in Uniform (c) EMD: Letter in 1-blob (d) IoU: Gathering in Uniform (e) IoU: Separation in Uniform (f) IoU: Letter in 1-blob Fig. 6: 5%/50%/95% quantiles for selected simulation runs (green: OURS, red: MAX-OT, blue: DIFF-MAP). (a) Grind (b) Grit (c) Wood Chips Fig. 7: Three types of real granular materials.",
            "year": 1908
        },
        {
            "authors": [
                "H. Yin",
                "A. Varava",
                "D. Kragic"
            ],
            "title": "Modeling, learning, perception, and control methods for deformable object manipulation",
            "venue": "Science Robotics, 2021.",
            "year": 2021
        },
        {
            "authors": [
                "L. Fang",
                "R. Zhang",
                "C. Vanden Heuvel",
                "R. Serban",
                "D. Negrut"
            ],
            "title": "Chrono:: Gpu: An open-source simulation package for granular dynamics using the discrete element method",
            "venue": "Processes, 2021.",
            "year": 2021
        },
        {
            "authors": [
                "C. Matl",
                "Y. Narang",
                "R. Bajcsy",
                "F. Ramos",
                "D. Fox"
            ],
            "title": "Inferring the material properties of granular media for robotic tasks",
            "venue": "IEEE International Conference on Robotics and Automation, 2020.",
            "year": 2020
        },
        {
            "authors": [
                "W. Hu",
                "J. Zhou",
                "R. Serban",
                "D. Negrut"
            ],
            "title": "Using an sph-based continuum representation of granular terrain to simulate the rover mobility",
            "venue": "International Design Engineering Technical Conferences and Computers and Information in Engineering Conference, 2021.",
            "year": 2021
        },
        {
            "authors": [
                "M. Macklin",
                "M. M\u00fcller",
                "N. Chentanez",
                "T.-Y. Kim"
            ],
            "title": "Unified particle physics for real-time applications",
            "venue": "ACM Transactions on Graphics, 2014.",
            "year": 2014
        },
        {
            "authors": [
                "Y. Zhang",
                "W. Yu",
                "C.K. Liu",
                "C. Kemp",
                "G. Turk"
            ],
            "title": "Learning to manipulate amorphous materials",
            "venue": "ACM Transactions on Graphics, 2020.",
            "year": 2020
        },
        {
            "authors": [
                "N. Tuomainen",
                "D. Blanco-Mulero",
                "V. Kyrki"
            ],
            "title": "Manipulation of granular materials by learning particle interactions",
            "venue": "IEEE Robotics and Automation Letters, 2022.",
            "year": 2022
        },
        {
            "authors": [
                "D. Mart\u0131\u0301nez",
                "G. Alenya",
                "C. Torras"
            ],
            "title": "Planning robot manipulation to clean planar surfaces",
            "venue": "Engineering Applications of Artificial Intelligence, 2015. (a) Quantiles for EMD. (b) Quantiles for IoU. Fig. 8: 5%/50%/95% quantiles for hardware experiments for gathering and separation.",
            "year": 2015
        },
        {
            "authors": [
                "D. Leidner",
                "W. Bejjani",
                "A. Albu-Sch\u00e4ffer",
                "M. Beetz"
            ],
            "title": "Robotic agents representing, reasoning, and executing wiping tasks for daily household chores",
            "venue": "Autonomous Agents and Multi-Agent Systems, 2016.",
            "year": 2016
        },
        {
            "authors": [
                "Y. Li",
                "J. Wu",
                "R. Tedrake",
                "J.B. Tenenbaum",
                "A. Torralba"
            ],
            "title": "Learning particle dynamics for manipulating rigid bodies, deformable objects, and fluids",
            "venue": "arXiv preprint arXiv:1810.01566, 2018.",
            "year": 1810
        },
        {
            "authors": [
                "C. Schenck",
                "J. Tompson",
                "S. Levine",
                "D. Fox"
            ],
            "title": "Learning robotic manipulation of granular media",
            "venue": "Conference on Robot Learning, 2017.",
            "year": 2017
        },
        {
            "authors": [
                "S. Elliott",
                "M. Cakmak"
            ],
            "title": "Robotic cleaning through dirt rearrangement planning with learned transition models",
            "venue": "IEEE International Conference on Robotics and Automation, 2018.",
            "year": 2018
        },
        {
            "authors": [
                "H. Suh",
                "R. Tedrake"
            ],
            "title": "The surprising effectiveness of linear models for visual foresight in object pile manipulation",
            "venue": "International Workshop on the Algorithmic Foundations of Robotics, 2020.",
            "year": 2020
        },
        {
            "authors": [
                "K. Tsuruta",
                "S.J. Griffioen",
                "J.M. Ib\u00e1\u00f1ez",
                "R.L. Johns"
            ],
            "title": "Deep sandscapes: Design tool for robotic sand-shaping with gan-based heightmap predictions",
            "venue": "Annual Modeling and Simulation Conference, 2022.",
            "year": 2022
        },
        {
            "authors": [
                "J. Kim",
                "N. Cauli",
                "P. Vicente",
                "B. Damas",
                "F. Cavallo",
                "J. Santos- Victor"
            ],
            "title": "icub, clean the table!\u201d a robot learning from demonstration approach using deep neural networks",
            "venue": "IEEE International Conference on Autonomous Robot Systems and Competitions, 2018.",
            "year": 2018
        },
        {
            "authors": [
                "N. Cauli",
                "P. Vicente",
                "J. Kim",
                "B. Damas",
                "A. Bernardino",
                "F. Cavallo",
                "J. Santos-Victor"
            ],
            "title": "Autonomous table-cleaning from kinesthetic demonstrations using deep learning",
            "venue": "IEEE International Conference on Development and Learning and Epigenetic Robotics, 2018.",
            "year": 2018
        },
        {
            "authors": [
                "A. Zeng",
                "P. Florence",
                "J. Tompson",
                "S. Welker",
                "J. Chien",
                "M. Attarian",
                "T. Armstrong",
                "I. Krasin",
                "D. Duong",
                "V. Sindhwani",
                "J. Lee"
            ],
            "title": "Transporter networks: Rearranging the visual world for robotic manipulation",
            "venue": "Conference on Robot Learning, 2020.",
            "year": 2020
        },
        {
            "authors": [
                "A. Cherubini",
                "V. Ortenzi",
                "A. Cosgun",
                "R. Lee",
                "P. Corke"
            ],
            "title": "Modelfree vision-based shaping of deformable plastic materials",
            "venue": "The International Journal of Robotics Research, 2020.",
            "year": 2020
        },
        {
            "authors": [
                "D. Jud",
                "G. Hottiger",
                "P. Leemann",
                "M. Hutter"
            ],
            "title": "Planning and control for autonomous excavation",
            "venue": "IEEE Robotics and Automation Letters, 2017.",
            "year": 2017
        },
        {
            "authors": [
                "J. Solomon"
            ],
            "title": "Optimal transport on discrete domains",
            "venue": "AMS Short Course on Discrete Differential Geometry, 2018.",
            "year": 2018
        },
        {
            "authors": [
                "Y. Rubner",
                "C. Tomasi",
                "L.J. Guibas"
            ],
            "title": "The earth mover\u2019s distance as a metric for image retrieval",
            "venue": "International Journal of Computer Vision, 2000.",
            "year": 2000
        },
        {
            "authors": [
                "G. Monge"
            ],
            "title": "M\u00e9moire sur la th\u00e9orie des d\u00e9blais et des remblais",
            "venue": "Memoire. Math. Phys. Acad. Royale Sci., 1781.",
            "year": 1781
        },
        {
            "authors": [
                "P. Fankhauser",
                "M. Bloesch",
                "C. Gehring",
                "M. Hutter",
                "R. Siegwart"
            ],
            "title": "Robot-centric elevation mapping with uncertainty estimates",
            "venue": "International Conference on Climbing and Walking Robots, 2014.",
            "year": 2014
        },
        {
            "authors": [
                "P. Fankhauser",
                "M. Bloesch",
                "M. Hutter"
            ],
            "title": "Probabilistic terrain mapping for mobile robots with uncertain localization",
            "venue": "IEEE Robotics and Automation Letters, 2018.",
            "year": 2018
        },
        {
            "authors": [
                "C.-A. Cheng",
                "M. Mukadam",
                "J. Issac",
                "S. Birchfield",
                "D. Fox",
                "B. Boots",
                "N. Ratliff"
            ],
            "title": "Rmpflow: A geometric framework for generation of multitask motion policies",
            "venue": "IEEE Transactions on Automation Science and Engineering, vol. 18, no. 3, pp. 968\u2013987, 2021.",
            "year": 2021
        },
        {
            "authors": [
                "R. Flamary",
                "N. Courty",
                "A. Gramfort",
                "M.Z. Alaya",
                "A. Boisbunon",
                "S. Chambon",
                "L. Chapel",
                "A. Corenflos",
                "K. Fatras",
                "N. Fournier",
                "L. Gautheron",
                "N.T. Gayraud",
                "H. Janati",
                "A. Rakotomamonjy",
                "I. Redko",
                "A. Rolet",
                "A. Schutz",
                "V. Seguy",
                "D.J. Sutherland",
                "R. Tavenard",
                "A. Tong",
                "T. Vayer"
            ],
            "title": "Pot: Python optimal transport",
            "venue": "Journal of Machine Learning Research, 2021.",
            "year": 2021
        }
    ],
    "sections": [
        {
            "text": "I. INTRODUCTION\nMany real-world tasks require the manipulation of granular materials, such as gravel or grit in construction or rice in cooking. While robotics has come a long way in manipulating rigid objects, highly deformable materials, including granular materials, still pose a large challenge due to the difficulty of accurately modelling how the material moves in response to a given manipulation action [1]. In their recent survey on manipulating multiple objects, ranging from a few large objects to piles of small objects/particles, Pan et al. [2] summarise the major challenges that apply to manipulating granular materials as: Perceiving the material of interest, potentially under partial occlusion, efficient state representation of such a high dimensional material, accurate and efficient models for these complex materials that are simple to estimate and plan with, and the need for many different manipulation actions to solve a higher level task, such as scooping, dumping, pushing and so on.\nWhile manipulation of granular materials is still at its infancy, several works have attemped to learn models of materials for planning purposes, or directly learn a particular manipulation action, either with reinforcement learning or\n*This project has received funding from the European Union\u2019s Horizon 2020 research and innovation program under grant agreement No 955356\nAll authors are members of the Autonomous Systems Lab, ETH Zurich, Switzerland; {firstname.lastname}@mavt.ethz.ch\nlearning from demonstration. While having good models of materials is key for planning precise manipulation actions on a control level, we argue that the state of art in manipulating granular materials could benefit from a higher-level planning layer that can, independently of the actual material being manipulated, plan manipulation actions to achieve a higher level goal in terms of shaping the distribution of the material."
        },
        {
            "heading": "A. Contributions",
            "text": "Our contributions can be summarised as follows: In this work, we show that the mathematical theory of Optimal Transport (OT) is a promising framework for planning manipulation actions that require transportation and volumetric shaping of granular materials on a high level, without requiring exact model knowledge of the material. While OT ignores robot motion constraints, we propose an efficient way of incorporating it into a heuristics-based sweep planner, allowing volumetric shaping for arbitrary input and output distributions. We show that this higher-level shape planner works for a wide variety of tasks and granular materials without requiring an accurate model of material dynamics. Since we can forego computationally expensive models, the proposed approach can run in a reactive feedback loop on a real robot arm using only a height map as input. We support our claims by an extensive simulation study and real-world experiments for different materials and tasks that require reasoning about how to efficiently re-distribute granular material."
        },
        {
            "heading": "II. RELATED WORK",
            "text": "We here categorize related work based on the type and fidelity of the model used. While an exhaustive survey of\nar X\niv :2\n30 3.\n17 04\n7v 1\n[ cs\n.R O\n] 2\n9 M\nar 2\n02 3\nmodelling approaches for granular dynamics is beyond the scope of this work, we summarize the findings of [3], [4], [5], and [2].\na) First-principle Methods: Understanding the underlying physics of granular materials has been of great interest to the research community. The discrete element method (DEM) is known to be the most accurate method for modelling granular materials [3], [6], [7], where each grain is modelled as an individual particle that interacts through contact with its neighbouring particles. Unfortunately, due to its particle-level discretization, DEM does not scale well for large volumes and small grain sizes and cannot be run in real-time as suggested by the results in [5] and [7]. Furthermore, several hyperparameters such as grain size and shape have to be defined [6], [7], which can be difficult to impossible for real, heterogeneous granular materials encountered in the field. Matl et al., [6] leveraged the DEM method to perform real-tosim transfer for pouring granular materials into target shapes with a robotic manipulator. However, as they optimized their model parameters by matching the macroscopic pouring behaviour, it remains unclear how well the estimated model transfers to other manipulation tasks and interaction types.\nb) Simplified Models: Because of the computational complexity of accurate physics models, many simplified methods have been developed. Position-based dynamics by Macklin and Mueller [8] is one popular method that trades off physical accuracy for visual fidelity and real-time performance [4]. A PBD simulator was used by Zhang et al. [9] to train an RL agent for manipulating gathering, spreading, and flipping granular and viscous materials. However, no real-world experiments were shown. More recently, Tuomainen et al., [10] train a graph neural network from a simulator that uses the material-point-method for learning the dynamics of pouring actions and use this to plan pouring trajectories that minimizes the Wasserstein distance between the poured and target shape. Others used task- and actionspecific representations, such as Martinez et al. [11] who cluster dirt particles into elliptical regions, learn how these elliptic regions change during pushing actions and then plan trajectories for collecting dirt on a table. Similarly, Leidner et al. [12] employ a hand-crafted heuristic model for a cleaning task, where affected dirt particles are simply placed at the end of each sweep when planning the cleaning trajectories.\nc) Differentiable Physics: Simulators that represent physical models in a differentiable architecture hold promise for fast parameter estimation and optimization-based planning and control [4]. Li et al. [13] proposed the DPI-Net architecture to learn the behaviour of soft objects and liquids from data, in their case generated by the PBD-based FleX simulator from Nvidia. While this line of work holds a lot of promise, it is still in its infancy [4], and ready-to-use models that can be quickly adapted to different environments, tasks, and manipulation actions still seem to be missing.\nd) Visual Predictive Models: Visual predictive models do not attempt to model the granular material in a firstprinciple fashion, instead, they directly learn how the sensory feedback will change for a given manipulation action.\nSchenck et al. [14] propose a visual-predictive model for scooping pinto beans from a source container and dumping them into an empty target container for different target shapes, where the model is learned from real-world training examples. Elliott et al. [15] learn a visual-predictive model, based on pixel-level classifiers, for predicting the outcome of a push-motion to dirt lying on a table and then use A* to plan sweeping trajectories for cleaning the table. Suh et al. [16] investigate the impact of the network architecture on the quality of the learned visual predictive models. They find that simple linear predictive models outperform deeper neural networks, and demonstrate their model in an impressive experiment where they can gather small carrot pieces into letter-shaped target regions. Tsuruta et al. [17] train a GAN to predict future sand state (elevation map) when given an input elevation map and a tool path (perpendicular spatula). By directly working in the space of the sensory input, visual predictive models avoid the difficult problem of estimating the state of the granular material and also offer an intuitive interface to define the environment and target shape. However, as they are learned for one specific material-environment-action combination it remains unclear how well these models generalize to different materials and actions or unseen environments. Also, in the case of image-based models, it is often difficult to represent more complex material distributions that go beyond binary state representations (no-material/material).\ne) Model-free Methods: Besides model-based methods, there have been several works that have shown impressive real-world results without requiring any type of model. One line of work uses learning from demonstration, such as in [18], [19], [20], or [21] to solve gathering, cleaning, and shaping tasks that involve granular materials. While these methods can be well suited for repetitive tasks in known environments, they have not been shown to generalize to new environments, materials, or tasks. Finally, Jud et al. [22] use a heuristics-based planner for digging and dumping with an excavator, it is able to execute digging cycles until the currently seen elevation map approximates the target elevation map of a digging site."
        },
        {
            "heading": "III. METHOD",
            "text": ""
        },
        {
            "heading": "A. Overview",
            "text": "Here we present our framework for generating robot motion plans to transform piles of granular material from arbitrary source shapes into arbitrary target shapes via sweeping motions, without assuming access to material properties or models. To this end, we adopt an Eulerian viewpoint, where the granular material is represented by its volume distribution, in our case by a discrete height map (see [2] for the difference between Lagrangian and Eulerian state representations). We leverage discrete optimal transport, a mathematical framework that provides tools for computing distances and transformation maps between arbitrary probability distributions, providing a way to morph a source distribution into a target distribution with the minimum amount of work. We then propose a heuristics-based sweep\nplanner for bridging the gap between optimal transport and the motion constraints of robot sweep."
        },
        {
            "heading": "B. Computational Discrete Optimal Transport",
            "text": "We here give a brief introduction to computational optimal transport and motivate its applicability to plan manipulation actions for transporting granular materials. Quoting from Solomon\u2019s survey on optimal transport on discrete domains [23], \u201cthe optimal transport (or Monge\u2013Kantorovich) problem involves the matching of probability distributions defined over a geometric domain like a surface or manifold\u201d. In the following, we introduce a notation that is specific to our use case of transporting granular materials, adapted from the more general formulation in [23].\na) Discretization into height maps: We represent the volumetric distribution of the granular material in the form of a discrete height map H = (h,X), which has N entries and where Xi denotes the 2D location of the centre of cell i and hi denotes the (average) height of the granular material in cell i.\nb) Normalization into probability distribution: As optimal transport theory is formulated for probability distributions, we introduce a normalized height map h\u0303 = h\u2211(N)\ni=1 hi ,\nand similarly H\u0303 . c) Source and target distributions: The goal of optimal transport is to compute the optimal transport solution to move the \u201dprobability mass\u201d from a source into a target distribution. Hence, we will distinguish two height maps/distributions: The current state of the granular material, before applying any action, is denoted by HS and the desired target height map as HT .\nd) Ground Cost: OT finds the optimal way to transport probability mass from H\u0303S into H\u0303T , where optimality is defined with respect to the ground cost, which is a distance metric on the geometric domain on which the distribution is defined. The ground cost is captured by the matrix C whose entries cij represent the cost required to transport one unit of probabilistic mass from H\u0303S,i to H\u0303T ,j .\ne) Transport Map: The transport map T \u2208 RNS\u00d7NT denotes a transport plan for how the probability mass in H\u0303S should be re-distributed to H\u0303T . The entry Tij tells us how much (probability) mass needs to be moved from H\u0303S,i to H\u0303T ,j . Additionally, we require that mass cannot be destroyed or created, only moved:{\u2211\nj Tij = h\u0303S,i\u2211 i Tij = h\u0303T ,j\n(1)\nf) Solution as Linear Program (LP): The problem of transporting the probability mass h\u0303src to h\u0303tgt that is optimal w.r.t. the ground cost matrix C can then be efficiently solved as a linear program, as shown in [23]:\nOT (h\u0303S , h\u0303T ;C) =  minT \u2211 ij (Tij cij)\ns.t. T \u2265 0\u2211 j Tij = h\u0303S,i \u2200i\u2211 i Tij = h\u0303T ,j \u2200j\n(2)\nBy solving this linear program, we get the optimal transport map T \u2217 as well as the optimal transportation cost OT (h\u0303S , h\u0303T ;C) = \u2211 ij (T \u2217 ij cij).\ng) Choice of Ground Cost: A common choice for the ground cost is as follows:\ncij,p = \u2016XS,i \u2212XT ,j\u20161/p (3)\nUsing this ground cost, induces the so-called p-Wasserstein distance [23]:\nWp(h\u0303S , h\u0303T ) = (OT (h\u0303S , h\u0303T ;Cp)) 1/p (4)\nIn this work, we use the 1-Wasserstein distance. Interestingly, the Wasserstein distance is also known as Earth mover\u2019s distance [24] in the computer vision literature, as the problem of moving earth is often used as an example to introduce the concept of optimal transport and it also hints at its roots in the very first formalization of optimal transport by Monge [25]. Hence, from now on we will use the term Earth Mover\u2019s Distance (EMD) as it fits the theme of this work."
        },
        {
            "heading": "C. Connecting OT with Robot Motion Planning",
            "text": "While OT at a glance seems very suitable for planning robot motions that require manipulating granular materials, it has seen very little practical application in this field. Tuomainen et al., [10] use the Earth Mover\u2019s Distance in their robotic pouring problem as an error metric for the poured granular material. However, instead of exploiting the easily computable optimal transport map, they directly optimize on a learned material model, which takes hours for each motion. Schenck et al. [14] mention that the earth mover\u2019s distance as a possible error metric in their scooping and dumping problem for granular material, but instead fall back to the L1 norm due to its computational simplicity. One major problem is that Optimal Transport assumes that the (probability) mass in each cell can be split up into infinitesimally small chunks and moved individually to other cells without any extra cost. While this might approximately hold for highly localized actions like precise scooping and dumping, this is not the case for manipulation actions, such as sweeping, that affect a large region of the granular material distribution. In the following, we leverage not only the error metric provided by OT, but also the transport map T\u2217 for planning efficient robot motion that requires transporting granular materials via sweeping motions of a robot arm."
        },
        {
            "heading": "D. Assumptions",
            "text": "In the following, we will assume that the granular material of interest is incompressible, has a grain size that is much smaller than the end-effector, and have negligible cohesive and adhesive effects which enables the use of position-controlled sweeping trajectories. We will further assume that the material is (and will remain) on a planar, gravity-aligned, convex, and obstacle-free workspace that is completely reachable by the robotic end-effector. Lastly, we assume that the volume distribution of the granular material is given in the form an occlusion-free, discrete height map."
        },
        {
            "heading": "E. Next-Best-Sweep Planner",
            "text": "To avoid computationally prohibitive sweep planning based on accurate dynamics models of the materials, we instead propose to use a next-best sweep planner that computes promising sweep candidates based on the optimal transport map T\u2217 between the current heightmap H\u0303S and the target height map H\u0303T . We will first introduce a heuristic scoring function g(T, a) that takes as input the transport map T and a sweep primitive a to compute a proxy score on how well the sweep agrees with the transport map. We will use g(T, a) to rank a set of L candidate sweeps Asweep = {a1, ..., aL} and choose the sweep a\u2217 with the best score such that g(T, a\u2217) \u2265 g(T, ai), \u2200ai \u2208 Asweep.\na) Sweep Action Primitive: We will define the sweep action primitive a(Xstart, Xend;wspatula) as a straight line sweep with a perfectly perpendicular and plane-parallel spatula, parameterized by the sweep start location Xstart, sweep end location Xend, and the spatula width wspatula.\nb) Simple Push Model: Before defining the proxy score, we will first introduce the simple forward push model, which has been inspired by [12], and [16]. The push model is visually depicted in Figure 2, where all cells in the source height map HS that fall inside the rectangular sweep patch spanned by ai,start, ai,end, and wspatula, shown as black cell, are predicted to end up at the end of the sweep, shown as the cyan coloured cell. The sweep patch, called P , is shown by the blue, directed rectangle in Figure 2. Further, we introduce the corresponding displacement vector as ~tfw and its normal vector ~nfw = ~tfw/||~tfw||\nc) Proxy Score: We define a proxy score for a sweep as the sum of the mass Tij that is supposed to be moved according to the computed OT transport map, for all edges starting inside the sweep patch XS,i \u2208 P , weighted by a heuristic function r(i, j),\ng(T, a) = NS\u2211 i=1 1P (XS ,i ) NT\u2211 j=1 Tij r(i, j).\nHere 1P () is the indicator function for set P. The heuristic r(i, j) is constructed to reflect how well the simple pushmodel predictions ~tfw (shown in Fig. 2) for the sweep aligns with the OT vectors ~tedge, where\nr(i, j) = \u03b1+ max(~nfw \u00b7 ~tedge, 0) + \u03b1\u2212min(~nfw \u00b7 ~terror, 0).\nAdditionally, the heuristic function contains a penalty term for overshoot (~nfw \u00b7~terror) (see Fig. 2) so that material is not pushed further than where it was supposed to go (green cell). Here \u03b1+ and \u03b1\u2212 are two scalar, positive hyperparameters tuned by a simple parameter sweep in simulation.\nd) Sampling Sweeps: We compute the next-best sweep to execute by generating a set of candidate sweeps A and computing the proxy score g for all of them and choosing the highest-ranking sweep. For sampling the sweeps to evaluate, we use the transport map T as it gives us a strong prior where to look for sweeps that move a lot of probability mass. First, we sample an edge pair from the probability distribution induced by T as (i, j) \u223c T which we use to\ndefine the start of the sweep Xstart = XS,i and the end of the sweep Xend = XT ,j , while discarding very short sweeps where ||Xend \u2212 Xstart|| < \u03b4min. For covering a larger range of potential sweeps, for example for sweeps that start at Xstart but do not have to go all the way to Xend, we generate further samples by linearly interpolating the sweep end between Xstart and Xend at a step size of \u03b4refine. We repeat this sampling L times to generate our set of candidate sweeps A."
        },
        {
            "heading": "IV. EXPERIMENTS AND RESULTS",
            "text": "In the following we demonstrate the effectiveness of our proposed method. First we show extensive quantitative results in simulation on different tasks, comparing our method against two baselines evaluated using the earth mover\u2019s distance. Then we show the ability of our approach to handle varied real-world granular materials by performing multiple shaping tasks with a Panda robot arm."
        },
        {
            "heading": "A. Simulation Setup",
            "text": "We use Nvidia\u2019s Isaac simulator1 because it supports simulating granular material in real time. The Isaac simulator leverages the Position-Based Dynamics approach by Macklin et al. [8] to simulate fluids and granular materials. The environment consists of a simulated Franka-Emika Panda arm with a 7 cm wide spatula as end-effector, a 0.5m \u00d7 0.5m large workspace fully reachable by the robot arm. The depth measurements from the rendered depth camera are converted to a point cloud and fused into a discrete height map at a resolution of 2 cm with the approach from Fankhauser et al. [26], [27]. After computing the straight\n1https://developer.nvidia.com/isaac-sim\nline sweeps, the motions are executed by feeding way points along the sweep to the RMPFlow controller [28] that ships with Isaac. See Figure 3a for a visualization of the simulation setup. We use the \u2019Python Optimal Transport\u2019 toolbox by Flamary et al., [29] for computing the optimal transport map T and the earth mover\u2019s distance."
        },
        {
            "heading": "B. Simulation Tasks",
            "text": "We will show the usefulness of Optimal Transport as a general tool for planning earth-moving operations and the effectiveness of our proxy-score heuristic planner for pushing granular material into many different shapes. We will use three different tasks to show the validity of the above claims.\na) Gathering: The gathering task is the simplest task, where scattered material should be collected into a single small target region, as shown in [11], [12], [16], [20].\nb) Separation: Separating granular material into different blobs is more complex than simple gathering, as already shown in [9]. Here the robotic agent needs to reason about how to efficiently re-distribute the granular material from the source distribution into the target distribution. We differentiate between different separation tasks and denote SEP-N as the task of separation into N cluster of equal size.\nc) Letter: Sweeping granular materials into more complex target shapes is an even more difficult task that requires precise reasoning about the material distribution and planning the appropriate robot motions. We choose letters, which was also used in [16] as examples of complex shapes.\nWe also use five different initial distributions for the PBD material in the gathering and separation tasks, shown in Figure 5. These vary in terms of scatter across the whole workspace to demonstrate the generalizability of our approach across different initial conditions."
        },
        {
            "heading": "C. Methods",
            "text": "We will compare our proposed planner against two other baseline methods MAX-OT and DIFF-MAP, which are briefly summarized in the following:\nWe will assume that both H\u0303S and H\u0303T cover the same area, which is required for the DIFF-MAP methods to work.\na) OURS: We deploy our proposed OT-based sweep planner with \u03b1+ = 1.0, \u03b1error = 100.0, Lsamples = 10 and \u03b4refine = 0.02. The high value \u03b1\u2212 = 100.0 leads to the planner approaching the target shape more conservatively, resulting in it overshooting less and removing material that was already in place. The same parameter set was used for all tasks, both in the simulation experiments as well as the physical experiments.\nb) MAX-OT: The first baseline computes the optimal transport map T\u2217 = OT (H\u0303S , H\u0303T , C) and then selects the next-best sweep as the strongest non-trivial edge in the transport map a = (XS,i, XT ,j) where {(ij) | Tij = max(T ) \u2227 XS,i 6= XT ,j}. This reflects a naive application of OT to the problem that does not respect the motion constraints of a sweep.\nc) DIFF-MAP: Our second baseline does not use optimal transport at all and is instead inspired by the heuristic planner from [22]. We construct two new height maps H\u0303excess, where h\u0303excess = max(h\u0303S \u2212 h\u0303T , 0.0) and H\u0303lack, where h\u0303lack = max(h\u0303T \u2212 h\u0303S , 0.0)\nWe then sample the start of the sweep from the first probability distribution as,start \u223c H\u0303excess and the end from the latter as,end \u223c H\u0303lack"
        },
        {
            "heading": "D. Simulation Results",
            "text": "We generated 10 randomized gathering targets by randomly choosing the centre of the circle and 9 randomized separation targets (three each for SEP-2/SEP-3/SEP-4) in a similar fashion. We let each of the methods perform for 30 iterations on the simpler start environments (1-blob, 2-blobs, Gaussian) and for 50 iterations on the more challenging (more scattered) environments (4-blobs, Uniform). In total we let each method solve 95 different sweeping tasks, each with a different start and end configuration. In addition, we ran six runs with 50 sweeps in the 1-blob environment for shaping the letters \u201dE, T, H, A, S, L\u201d. The results for the gathering tasks are summarized in Table I and the results for separation are summarized in Table II and they are separated by the chosen initial condition. The reported values are the earth mover\u2019s distance scaled up by 10\u22123, given as the median and the 5% and 95% quantiles in the subsequent brackets. We see that our method consistently outperforms the two other baseline methods, with only a few cases where the 95% quantiles overlap with the 5% quantile of one of the\nbaseline methods. The proposed method also consistently has the lowest variance by a large margin. This becomes obvious when looking at the evolution of the metrics over time in Figure 6, where the median, 5% quantile, and 95% quantile curves are plotted for OUR method and the two baselines for gathering in Uniform, separation in Uniform, and letter in 1-blob. The plots show that our method manages to quickly decrease the EMD values to a low value with a small variance. We have also plotted the Intersection-overUnion to provide a second metric, that is not based on optimal transport."
        },
        {
            "heading": "E. Hardware Setup",
            "text": "Our setup for the hardware experiment is shown in Figure 3b. The setup consists of a Franka-Emika Panda robot arm to which we attach a brush as an end-effector, similar to [15], for mechanical compliance when interacting with the rigid ground or rigid particles. We use the Pico Monstar Time-of-Flight camera from pmdtechnologies to get highaccuracy point cloud scans, which are integrated by the same elevation mapping framework by Fankhauser et al. [26], [27] as for the simulation experiments. We use a fixed scanning position that yields a complete scan of the workspace. The PILZ Industrial Motion Planner, which ships with the popular MoveIt2 planning framework, is used to move the end effector on smooth linear trajectories.\n2https://moveit.ros.org/\nTo show that our approach generalizes to different materials, we have chosen three different granular materials. Our material selection consists of gravel (rounded edges), grit (sharp edges), and wooden chips. The materials are shown in Figures 7a, 7b, 7c."
        },
        {
            "heading": "F. Hardware Results",
            "text": "Similar to the simulation experiments, we will demonstrate the functionality of our proposed planner in four different tasks that consist of gathering to a single target, separating into two clusters, separating into four clusters, and shaping the letters \u201dE\u201d, \u201dT\u201d, \u201dH\u201d. For the hardware experiments, we do not additionally randomize the target distribution as was done in the simulation experiments. Instead we use the respective nominal target shapes shown in Figure 4.\nHowever, we perform the three different tasks on all three materials. The results from these nine runs are summarized in the quantile plots showing the evolution of the median, and the 5% as well as 95% quantile curves for both the EMD as well as IoU in Figures 8a-8b, which show consistent progress towards the target shape with small variance. For the letter task, see Figure 1 for the qualitative results on shaping the letters \u201dE\u201d, \u201dT\u201d, and \u201dH\u201d with grit stones."
        },
        {
            "heading": "V. CONCLUSIONS",
            "text": "In this work, we proposed a material-agnostic planner for transforming piles of granular material from arbitrary initial shapes to arbitrary target shapes by means of sweeping motions with a robot arm. We leverage the mathematical framework of optimal transport and adapt it to sweep-based planning through a reactive next-best-sweep sampling-based approach and show that it is a promising avenue for granular material manipulation in robotics. We have validated the approach in large-scale simulation and hardware experiments and compared them to two simpler baselines that tend to work on simpler tasks, like gathering, but fail at more difficult tasks that require more precise reasoning about how to efficiently re-distribute the material. We have shown that the proposed planner successfully generalizes to multiple input shapes, target shapes, and granular materials without requiring sophisticated or computationally expensive dynamics models of the materials. Finally, while we assumed that the state of the granular material is given as a volumetric height map, this only works for larger particles that can be picked up by the depth sensor. For small-grained materials, like sand, one has to either use very high-precision depth sensors or leverage other sensor modalities to estimate the volume."
        }
    ],
    "title": "Material-agnostic Shaping of Granular Materials with Optimal Transport",
    "year": 2023
}
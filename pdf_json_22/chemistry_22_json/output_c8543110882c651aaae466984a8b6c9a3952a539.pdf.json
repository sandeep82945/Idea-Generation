{
    "abstractText": "Biochemical reactions inside living cells often occur in the presence of crowders molecules that do not participate in the reactions but influence the reaction rates through excluded volume effects. However the standard approach to modelling stochastic intracellular reaction kinetics is based on the chemical master equation (CME) whose propensities are derived assuming no crowding effects. Here, we propose a machine learning strategy based on Bayesian Optimisation utilising synthetic data obtained from spatial cellular automata (CA) simulations (that explicitly model volume-exclusion effects) to learn effective propensity functions for CMEs. The predictions from a small CA training data set can then be extended to the whole range of parameter space describing physiologically relevant levels of crowding by means of Gaussian Process regression. We demonstrate the method on an enzyme-catalyzed reaction and a genetic feedback loop, showing good agreement between the time-dependent distributions of molecule numbers predicted by the effective CME and CA simulations.",
    "authors": [
        {
            "affiliations": [],
            "name": "Svitlana Braichenko"
        },
        {
            "affiliations": [],
            "name": "Guido Sanguinetti"
        }
    ],
    "id": "SP:5c5d09afd957458cd31889a1565462721bab28c9",
    "references": [
        {
            "authors": [
                "M.B. Elowitz",
                "A.J. Levine",
                "E.D. Siggia",
                "P.S. Swain"
            ],
            "title": "Stochastic gene expression in a single cell",
            "venue": "Science 297(5584), 1183\u20131186",
            "year": 2002
        },
        {
            "authors": [
                "X. Darzacq",
                "J. Yao",
                "D.R. Larson",
                "S.Z. Causse",
                "L. Bosanac",
                "V. De Turris",
                "V.M. Ruda",
                "T. Lionnet",
                "D. Zenklusen",
                "B Guglielmi"
            ],
            "title": "Imaging transcription in living cells",
            "venue": "Annual Review of Biophysics 38, 173\u2013196",
            "year": 2009
        },
        {
            "authors": [
                "S. Shah",
                "Y. Takei",
                "W.",
                "E. Lubeck",
                "J. Yun",
                "C.H.L. Eng",
                "N. Koulena",
                "C. Cronin",
                "C. Karp",
                "Liaw",
                "E.J"
            ],
            "title": "Dynamics and spatial genomics of the nascent transcriptome by intron seqfish",
            "venue": "Cell 174(2), 363\u2013376",
            "year": 2018
        },
        {
            "authors": [
                "A.J. Larsson",
                "P. Johnsson",
                "M. Hagemann-Jensen",
                "L. Hartmanis",
                "O.R. Faridani",
                "B. Reinius",
                "\u00c5. Segerstolpe",
                "C.M. Rivera",
                "B. Ren",
                "R. Sandberg"
            ],
            "title": "Genomic encoding of transcriptional burst kinetics",
            "venue": "Nature 565(7738), 251\u2013254",
            "year": 2019
        },
        {
            "authors": [
                "D.T. Gillespie"
            ],
            "title": "Exact stochastic simulation of coupled chemical reactions",
            "venue": "The journal of Physical Chemistry 81(25), 2340\u20132361",
            "year": 1977
        },
        {
            "authors": [
                "M. Voliotis",
                "P. Thomas",
                "R. Grima",
                "C.G. Bowsher"
            ],
            "title": "Stochastic simulation of biomolecular networks in dynamic environments",
            "venue": "PLoS Computational Biology 12(6), e1004923",
            "year": 2016
        },
        {
            "authors": [
                "D.T. Gillespie"
            ],
            "title": "The chemical langevin equation",
            "venue": "The Journal of Chemical Physics 113(1), 297\u2013306",
            "year": 2000
        },
        {
            "authors": [
                "D. Schnoerr",
                "G. Sanguinetti",
                "R. Grima"
            ],
            "title": "Approximation and inference methods for stochastic biochemical kinetics\u2014a tutorial review",
            "venue": "Journal of Physics A: Mathematical and Theoretical 50(9), 093001",
            "year": 2017
        },
        {
            "authors": [
                "D.M. Suter",
                "N. Molina",
                "D. Gatfield",
                "K. Schneider",
                "U. Schibler",
                "F. Naef"
            ],
            "title": "Mammalian genes are transcribed with widely different bursting kinetics",
            "venue": "Science 332(6028), 472\u2013474",
            "year": 2011
        },
        {
            "authors": [
                "S.O. Skinner",
                "H. Xu",
                "S. Nagarkar-Jaiswal",
                "P.R. Freire",
                "T.P. Zwaka",
                "I. Golding"
            ],
            "title": "Single-cell analysis of transcription kinetics across the cell cycle",
            "venue": "Elife 5, e12175",
            "year": 2016
        },
        {
            "authors": [
                "N. Van Kampen"
            ],
            "title": "Stochastic Processes in Physics and Chemistry",
            "venue": "North-Holland Personal Library, Elsevier, Amsterdam, 3rd ed edn.",
            "year": 2007
        },
        {
            "authors": [
                "D.T. Gillespie"
            ],
            "title": "A rigorous derivation of the chemical master equation",
            "venue": "Physica A: Statistical Mechanics and its Applications 188(1-3), 404\u2013425",
            "year": 1992
        },
        {
            "authors": [
                "D.T. Gillespie"
            ],
            "title": "A diffusional bimolecular propensity function",
            "venue": "The Journal of Chemical Physics 131(16), 164109",
            "year": 2009
        },
        {
            "authors": [
                "B. Van den Berg",
                "R. Wain",
                "C.M. Dobson",
                "R.J. Ellis"
            ],
            "title": "Macromolecular crowding perturbs protein refolding kinetics: implications for folding inside the cell",
            "venue": "The EMBO journal 19(15), 3870\u20133875",
            "year": 2000
        },
        {
            "authors": [
                "H.X. Zhou",
                "G. Rivas",
                "A.P. Minton"
            ],
            "title": "Macromolecular crowding and confinement: biochemical, biophysical, and potential physiological consequences",
            "venue": "Annual Review of Biophysics 37, 375\u2013397",
            "year": 2008
        },
        {
            "authors": [
                "C. Tan",
                "S. Saurabh",
                "M.P. Bruchez",
                "R. Schwartz",
                "P. LeDuc"
            ],
            "title": "Molecular crowding shapes gene expression in synthetic cellular nanosystems",
            "venue": "Nature Nanotechnology 8(8), 602\u2013608",
            "year": 2013
        },
        {
            "authors": [
                "M.A. Mour\u00e3o",
                "J.B. Hakim",
                "S. Schnell"
            ],
            "title": "Connecting the dots: the effects of macromolecular crowding on cell physiology",
            "venue": "Biophysical Journal 107(12), 2761\u20132766",
            "year": 2014
        },
        {
            "authors": [
                "R. Grima"
            ],
            "title": "Intrinsic biochemical noise in crowded intracellular conditions",
            "venue": "The Journal of Chemical Physics 132(18), 05B604",
            "year": 2010
        },
        {
            "authors": [
                "C. Cianci",
                "S. Smith",
                "R. Grima"
            ],
            "title": "Molecular finite-size effects in stochastic models of equilibrium chemical systems",
            "venue": "The Journal of Chemical Physics 144(8), 084101",
            "year": 2016
        },
        {
            "authors": [
                "D.T. Gillespie",
                "S. Lampoudi",
                "L.R. Petzold"
            ],
            "title": "Effect of reactant size on discrete stochastic chemical kinetics",
            "venue": "The Journal of Chemical Physics 126(3), 034302",
            "year": 2007
        },
        {
            "authors": [
                "H. Berry"
            ],
            "title": "Monte Carlo simulations of enzyme reactions in two dimensions: fractal kinetics and spatial segregation",
            "venue": "Biophysical Journal 83(4), 1891\u20131901",
            "year": 2002
        },
        {
            "authors": [
                "S. Schnell",
                "T.E. Turner"
            ],
            "title": "Reaction kinetics in intracellular environments with macromolecular crowding: Simulations and rate laws",
            "venue": "Progress in Biophysics and Molecular Biology 85(2), 235\u2013260",
            "year": 2004
        },
        {
            "authors": [
                "R. Grima",
                "S. Schnell"
            ],
            "title": "A systematic investigation of the rate laws valid in intracellular environments",
            "venue": "Biophysical Chemistry 124(1), 1\u201310",
            "year": 2006
        },
        {
            "authors": [
                "S. Smith",
                "R. Grima"
            ],
            "title": "Fast simulation of brownian dynamics in a crowded environment",
            "venue": "The Journal of Chemical Physics 146(2), 024105",
            "year": 2017
        },
        {
            "authors": [
                "J.S. Kim",
                "A. Yethiraj"
            ],
            "title": "Crowding effects on association reactions at membranes",
            "venue": "Biophysical Journal 98(6), 951\u2013958",
            "year": 2010
        },
        {
            "authors": [
                "W.X. Chew",
                "K. Kaizu",
                "M. Watabe",
                "S.V. Muniandy",
                "K. Takahashi",
                "S.N. Arjunan"
            ],
            "title": "Reaction-diffusion kinetics on lattice at the microscopic scale",
            "venue": "Physical Review E 98(3), 032418",
            "year": 2018
        },
        {
            "authors": [
                "S.S. Andrews"
            ],
            "title": "Smoldyn: particle-based simulation with rule-based modeling, improved molecular interaction and a library interface",
            "venue": "Bioinformatics 33(5), 710\u2013717",
            "year": 2017
        },
        {
            "authors": [
                "A. Deutsch",
                "S. Dormann"
            ],
            "title": "Mathematical Modeling of Biological Pattern Formation",
            "venue": "Springer",
            "year": 2005
        },
        {
            "authors": [
                "D.A. Wolf-Gladrow"
            ],
            "title": "Lattice-gas Cellular Automata and Lattice Boltzmann Models: an Introduction",
            "venue": "Springer",
            "year": 2004
        },
        {
            "authors": [
                "G. Wieczorek",
                "P. Zielenkiewicz"
            ],
            "title": "Influence of macromolecular crowding on proteinprotein association rates\u2014a brownian dynamics study",
            "venue": "Biophysical Journal 95(11), 5030\u20135036",
            "year": 2008
        },
        {
            "authors": [
                "C. Gardiner"
            ],
            "title": "Stochastic Methods: A Handbook for the Natural and Social Sciences",
            "venue": "Springer Series in Synergetics, Springer-Verlag, Berlin Heidelberg, fourth edn.",
            "year": 2009
        },
        {
            "authors": [
                "F. Baras",
                "M.M. Mansour"
            ],
            "title": "Reaction-diffusion master equation: a comparison with microscopic simulations",
            "venue": "Physical Review E 54(6), 6139",
            "year": 1996
        },
        {
            "authors": [
                "D.T. Gillespie"
            ],
            "title": "Stochastic simulation of chemical kinetics",
            "venue": "Annual Review of Physical Chemistry 58, 35\u201355",
            "year": 2007
        },
        {
            "authors": [
                "P. Loskot",
                "K. Atitey",
                "L. Mihaylova"
            ],
            "title": "Comprehensive review of models and methods for inferences in bio-chemical reaction networks",
            "venue": "Frontiers in Genetics 10, 549",
            "year": 2019
        },
        {
            "authors": [
                "K. \u00d6cal",
                "R. Grima",
                "G. Sanguinetti"
            ],
            "title": "Parameter estimation for biochemical reaction networks using Wasserstein distances",
            "venue": "Journal of Physics A: Mathematical and Theoretical 53(3), 034002",
            "year": 2019
        },
        {
            "authors": [
                "B. Shahriari",
                "K. Swersky",
                "Z. Wang",
                "R.P. Adams",
                "N. de Freitas"
            ],
            "title": "Taking the human out of the loop: a review of bayesian optimization",
            "venue": "Proceedings of the IEEE 104(1), 148\u2013175",
            "year": 2016
        },
        {
            "authors": [
                "E. Brochu",
                "V.M. Cora",
                "N. de Freitas"
            ],
            "title": "A tutorial on bayesian optimization of expensive cost functions, with application to active user modeling and hierarchical reinforcement learning",
            "venue": "arXiv:1012.2599 [cs]",
            "year": 2010
        },
        {
            "authors": [
                "C. Villani"
            ],
            "title": "Optimal Transport: Old and New",
            "venue": "Grundlehren Der Mathematischen Wissenschaften, Springer-Verlag, Berlin Heidelberg",
            "year": 2009
        },
        {
            "authors": [
                "C.E. Rasmussen",
                "C.K.I. Williams"
            ],
            "title": "Gaussian Processes for Machine Learning",
            "venue": "Adaptive Computation and Machine Learning, MIT Press, Cambridge, Mass",
            "year": 2006
        },
        {
            "authors": [
                "E. Vazquez",
                "J. Bect"
            ],
            "title": "Convergence properties of the expected improvement algorithm with fixed mean and covariance functions",
            "venue": "Journal of Statistical Planning and Inference 140(11), 3088\u20133095",
            "year": 2010
        },
        {
            "authors": [
                "M.P. Allen",
                "D.J. Tildesley"
            ],
            "title": "Computer Simulation of Liquids",
            "venue": "Oxford University Press",
            "year": 2017
        },
        {
            "authors": [
                "P. Thomas",
                "A.V. Straube",
                "R. Grima"
            ],
            "title": "The slow-scale linear noise approximation: An accurate, reduced stochastic description of biochemical networks under timescale separation conditions",
            "venue": "BMC Systems Biology 6(1), 39",
            "year": 2012
        },
        {
            "authors": [
                "K. Cranmer",
                "J. Brehmer",
                "G. Louppe"
            ],
            "title": "The frontier of simulation-based inference",
            "venue": "Proceedings of the National Academy of Sciences 117(48), 30055\u201330062",
            "year": 2020
        }
    ],
    "sections": [
        {
            "text": "Keywords: inference \u00b7 stochastic reactions \u00b7 crowding."
        },
        {
            "heading": "1 Introduction",
            "text": "The empirical demonstration of stochasticity in gene expression [1] has had a profound impact both on experimental and computational biology. Experimentally, the last two decades have witnessed a flourishing of advanced technologies to measure stochastic effects in biology at unprecedented throughput and spatial/temporal resolution [2,3,4]. Computationally, considerable effort has gone towards developing algorithmic solutions to facilitate the in silico simulation of stochastic biological systems, and their calibration to observational data [5,6,7,8,9,10].\nThe vast majority of stochastic modelling work operates within the framework of the classical Chemical Master Equation (CME), which describes the time evolution of the (single-time marginal) state probability distribution of a\n? Supported by Leverhulme Trust.\nar X\niv :2\n20 5.\n06 26\n8v 1\n[ q-\nbi o.\nQ M\n] 1\n1 M\ndiscrete state, continuous-time Markovian system [11]. In this framework, each reaction has associated with it a propensity function which is derived assuming molecules are point particles diffusing fast enough such that well-mixed conditions ensue [12,11,13]. The CME formulation provides a number of advantages, including a transparent and elegant mathematical formalism, and efficient simulation and approximation algorithms [8]. In particular, the existence of an exact Stochastic Simulation Algorithm (SSA) [5] has led to the wide use of this formulation. However, the assumption that reactants freely diffuse inside cells is clearly at odds with biological reality: the cellular environment is spatially highly structured, and, for every given reaction, it contains large numbers of particles that do not partake in the reaction, creating a crowding effect which can significantly affect the dynamics of biochemical processes inside the cell [14,15,16,17]. While the modelling community is keenly aware of this mismatch in assumptions, there have been only a few attempts at modifying the propensities of the SSA/CME to take into account crowding [18,19,20]. These pioneering studies have focused on simple biochemical systems but they do not provide a general recipe applicable to all intracellular reaction systems of interest. In contrast, particle-based algorithms (such as Brownian dynamics and cellular automata [21,22,23,18,24,25,26,27]) have been extensively used to study the effect of crowding; these approaches while naturally suited to study crowding, they are computationally demanding since they model the movement of each particle (crowder or reactant) in the system.\nIn this paper, we devise a computational approach based on machine learning to adapt the efficiency of the CME approach to the reality of crowding. In a nutshell, the idea is to learn CME propensity functions that lead to particle number distributions which optimally match the ones resulting from particlebased algorithms. This leads to a general computational recipe for constructing effective CMEs that capture the stochastic dynamics of any biochemical system in crowded conditions."
        },
        {
            "heading": "2 Connecting different mathematical descriptions of stochastic kinetics using Bayesian optimization",
            "text": "In this paper, we shall be concerned with two different descriptions of stochastic chemical kinetics: (i) Cellular automata (CA); (ii) Monte Carlo simulations using the SSA. We next describe each in detail and then show how a Bayesian optimization based procedure can be used to connect these different stochastic descriptions."
        },
        {
            "heading": "2.1 Cellular Automata",
            "text": "Cellular Automata (CA) can be characterized as a lattice of sites each holding a finite number of discrete states plus some rules which describe the evolution of the state of each site. Typically these update rules are a function of the states of the sites within a local neighbourhood. For a general introduction to CA in\nthe context of biological and chemical modelling see [28,29]. Many CA models that study the influence of crowding in biochemical reactions [21,22,23] have the following properties in common: (i) each lattice site is either occupied by a molecule or empty; (ii) at each time step, a molecule is selected at random and one of its neighbouring sites is also chosen at random; (iii) if the chosen neighbouring site is empty then the molecule moves to it otherwise a reaction is attempted (only if the site is occupied by a reactant). In Fig. 1(a) we illustrate a CA modelling a simple enzymatic reaction.\nCellular Automata\nwith crowding synthetic data: ns samples\n(a) (b)\nThe main advantage of CAs is their simplicity, in particular it is easy to devise rules that mimic molecular movement and interaction in complex geometries. Their disadvantages are (i) each molecule, independent of type, occupies the same amount of space (equal to one lattice site); (ii) the regularity of the lattice can influence the simulated dynamics. These main disadvantages can be overcome by using Brownian-dynamics, a lattice-free approach [25,30,18,24], however these simulations are much more computationally expensive and we do not consider them further here."
        },
        {
            "heading": "2.2 The chemical master equation and the SSA",
            "text": "An alternative mathematical description to CA involves ignoring the spatial information and deriving equations that characterize the statistics of the total number of particles of each species in the volume of interest. Specifically, the system may be described in terms of the state vector n = (n1, ..., nN ), where ni indicates a number of molecules belonging to species Xi. The dynamics of the reaction system can be described in terms of the probability distribution P (n, t) = P (n, t|n0, t0) for the system to be in state n at time t when it was in state n0 at time t0. The time evolution of this probability distribution obeys a master equation\n\u2202tP (n, t) = R\u2211 r=1 gr(n\u2212 Sr)P (n\u2212 Sr, t)\u2212 R\u2211 r=1 gr(n)P (n, t), (1)\nwhere gr(n)\u2206t is the probability of reaction r occurring somewhere in the compartment in the time interval [t, t + \u2206t). The propensity functions gr(n) have been derived from first principles when the interacting particles are point-like (no volume exclusion) and assuming that all species are well-mixed, i.e., when the distance travelled by molecules between successive reactions is much larger than the size of the system [12,13]. In this case, the master equation Eq. (1) is known as the chemical master equation. In the well-mixed limit, this is formally equivalent to the reaction-diffusion master equation [31] which has been shown to provide an accurate approximation of microscopic simulations that track point particle positions [32]. We note that there is no general closed-form solution to the CME and hence in practice, one uses the SSA [33] to estimate P (n, t) in a Monte Carlo setup. We refer the reader to [31,8] for comprehensive background on the CME and the various methods to approximate its solutions."
        },
        {
            "heading": "2.3 Bayesian Optimisation (BO)",
            "text": "The CME presents considerable computational advantages over CA simulations, however simply ignoring spatial effects will generally result in an inaccurate prediction of the stochastic dynamics of the total number of particles for each species in a compartment. Nevertheless, it is plausible that there exists a different CME parametrisation which leads to a time-dependent probability distribution\nof molecule numbers that well approximates the same distributions calculated from CA. The main purpose of this paper is to illustrate a machine-learning strategy that automates the task of finding appropriate propensity functions.\nThe task is akin to the inference of CME parameters from observations [8,34,35], however in this case the CME parameters are not determined in order to maximise a data likelihood, but rather to give rise to (transient and steady state) particle number distributions that match the distributions generated from CA. To do so, we use a machine learning technique called Bayesian optimisation (BO) [36,37]. BO is an efficient sequential algorithm to optimise objective functions which are very expensive to evaluate. In our case, the task is\nx\u2217 = arg min x f(x), (2)\nwhere x \u2208 Rd is a vector of CME parameters and the objective function f(x) is a (rescaled) one-dimensional Wasserstein distance (WD) [38] between the empirical marginal distribution of CA and CME trajectories (1); see Appendix A for more details. BO works by using discrete evaluations of the expensive objective function f(x) to construct a statistical surrogate (the acquisition function) which is easy to optimise and can be used to identify the next query point. Generally, Gaussian process (GP) regression [39] is used to construct the surrogate function. GP regression is a methodology to perform Bayesian inference over functional spaces; given some training points (in our case estimates of the objective function at some parameter values), one can obtain a posterior predictive distribution over function values everywhere in parameter space, in terms of a mean posterior function \u00b5(x) and posterior variance function \u03c3(x), which provide a point-wise posterior distribution over the values of the expensive function f(x). The acquisition function is then obtained as some analytical function of the posterior mean and variance. In our case, we use the expected improvement acquisition function\n\u03b1EI(x) = (\u00b5n(x)\u2212 \u03c4n)\u03a6 ( \u00b5n(x)\u2212 \u03c4n \u03c3n(x) ) + \u03c3n(x)\u03c6 ( \u00b5n(x)\u2212 \u03c4n \u03c3n(x) ) , (3)\nwhere \u03c4n is the highest value of the unknown function found after n steps, \u00b5n(x) and \u03c3n(x) are the posterior mean and variance from GP regression after n function evaluations, \u03a6 is the standard normal cumulative distribution function, and \u03c6 is the standard normal probability density function. The acquisition function is analytically computable and can be optimised using standard methods to provide an optimal query point for the next evaluation of the expensive function f(x). We note that our choice of acquisition function is not unique; other possible choices are upper confidence bound, probability of improvement and knowledge gradient [36]. The expected improvement acquisition function that we use is guaranteed to find the optimum of the target function under mild assumptions [40].\nThe computational recipe is as follows:\n1. Generate a number ns of CA trajectories for some chosen set of parameter values, and collect marginal probabilities of particle numbers at a set of time points.\n2. Generate initial estimates of f(x) by evaluating Wasserstein distances between CA distributions and CME distributions on a grid of CME parameters, and obtain the optimal initial value \u03c40 as the minimum distance obtained.\n3. Perform a sequential search which, at iteration n, selects a location xn at which to query f(xn) by maximising the expected improvement acquisition function. Set \u03c4n = max{\u03c4n\u22121, f(xn)} and recompute the acquisition function by including f(xn) among the training points.\n4. Once the improvement in objective function becomes smaller than a predefined threshold, the algorithm makes a final recommendation xp, which represents the best estimate for the minimum of f(x).\nWe use the python BO implementation in scikit-optimize and in parallel we confirm the results using the python package optuna.\nA cartoon summarizing the overall learning procedure is shown in Fig. 1 and an illustration focusing on how BO works to minimize a function is shown in Fig. 2.\nThe BO procedure allows us to associate with one set of CA parameters a parametrisation of an effective CME which optimally matches (in a Wasserstein distance sense) the marginal probabilities of the CA. To extend this to any parametrisation of the CA, we once again appeal to smoothness and use CA/ CME pairs on a grid of CA parameters (each obtained via a separate BO procedure) to train a GP regression map to predict effective CME parametrisations also for unseen CA systems. This allows us to avoid expensive CA simulations and to provide effective CMEs for any setting of biochemical and crowding parameters in the CA system."
        },
        {
            "heading": "3 Applications",
            "text": "In this section, we apply our BO-based method to an enzyme system and a gene regulatory network. The code to recreate the results as well as the CA data are available at https://github.com/sb2g14/wasserstein time inference."
        },
        {
            "heading": "3.1 Michaelis-Menten reaction in crowded conditions",
            "text": "Here we study the stochastic kinetics of Michaelis-Menten enzyme reaction system\nE + S k1\u2212\u2212\u21c0\u21bd\u2212 k\u22121 ES k2\u2212\u2192 E + P, (4)\nwhere E, S, ES and P are enzyme, substrate, enzyme-substrate complex and protein, respectively; k1, k\u22121 and k2 are bimolecular, reverse and catalytic rates, respectively. Specifically, we consider this reaction in crowded conditions, where the (inert) crowders are assumed to be immobile [21,22]. The detailed set of rules for the CA simulations of this system is described in Appendix B.\nSimilar to [22], the reaction rates may be estimated from the CA simulations directly using the formulae\nk1 = d\u03b3/dt\n[E][S] , (5)\nk\u22121 = d\u03b3/dt+ d [S]/ dt\n[ES] , (6)\nk2 = d [P ]/ dt\n[ES] , (7)\nwhere \u03b3(t) is the average number of E + S \u2212\u2192 ES reactions that have occurred in the time interval [0, t] divided by the number of grid points and [X] is the\nconcentration of species X, i.e. the average number of particles of species X divided by the number of grid points. Note that averages are here understood to be computed over an ensemble of independent CA simulations. The reactions occur on a 2D square lattice of size 100\u00d7 100. The initial values of the molecule numbers of each species are distributed uniformly and the boundary conditions are periodic. The latter conditions are used since they typically give rise to small finite-size errors in Monte Carlo simulations [41].\nIn Fig. 3, we show the calculation of the effective bimolecular rate k1 using Eq. (5) as a function of time and of the concentration of crowders \u03c6 in the system (dark grey points). Note that the effective rates of the other two reactions k\u22121 and k2 (estimated using Eq. (6) and Eq. (7)) do not show any appreciable variation with crowding levels and hence we do not discuss them any further (the values of the estimated rates are in agreement with the probabilities of the associated reactions in the CA). Clearly, crowding induces a bimolecular rate that is monotonically decreasing with time \u2013 this is due to the increasing amounts of product (and the decreasing amounts of the substrate) which reduces the rate of encounter of substrate and enzyme molecules.\n(t+\u03c4)h (following a Zipf-Mandelbrot law) using the method of least\nsquares (red lines). They are also estimated using 10 BO runs (green dashed lines shows the average while the grey shaded area shows the standard deviation). The initial values of the molecule numbers are NS = 2000, NE = 100, NC = 0 and NP = 0. A detailed description of the CA simulations can be found in Appendix B. Note that time is in arbitrary units.\nWe fit the time-dependent bimolecular rates using the Zipf-Mandelbrot law k1 = k0 (t+\u03c4)h with parameters k0, \u03c4 and h obtained from the least-squares fit of the data estimated from Eqs. (5) \u2013 these are shown are orange lines in Fig. 3. Note that \u03c6 was limited to the range 0\u2212 0.4 since this is the physiological range [22].\nWe next aim to learn the parameters k0, \u03c4 and h that characterise the effective bimolecular reaction rate using BO. Specifically, we use BO to fit the timedependent distributions of all species calculated from the CA with those obtained from SSA simulations where the propensity functions in the CME description (Eq. (1)) are:\ng1(~n) = k0\n(t+ \u03c4)h nSnE , (8)\ng2(~n) = k\u22121nES , (9)\ng3(~n) = k2nES , (10)\nwhere nX is the number of molecules of species X. Since some of the propensities have a time-dependent rate coefficient, the SSA simulations cannot be performed using the standard Gillespie algorithm; rather we use the exact Extrande algorithm [6]. The objective function minimized by BO (see Eq. (2)) is given by\nf = Nt\u2211 i=1 fi,\nfi = |\u03b3refi \u2212 \u03b3SSAi |\n\u03b3SSAi + N\u2211 j=1 WD(P ji , Q j i ) \u3008Qji \u3009 , (11)\nwhere \u03b3refi and \u03b3 SSA i correspond to the sample averaged counter of bimolecular reactions in the system at time interval [0, ti] in the CA and SSA simulations, respectively; Nt is the number of time intervals; P j i and Q j i are the CA and SSA marginal distributions at time ti for the number of molecules of species j, respectively; \u3008Qji \u3009 is the mean of the SSA number distribution Q j i ; N is the total number of species. The first term in Eq. (11) helps to avoid parameters indistinguishably in the unimolecular reaction rates k\u22121 and k2.\nWe repeat the BO-based estimation multiple times leading to a set of ZipfMandelbrot law curves \u2013 in Fig. 3, dashed green lines show the mean of these functions while the shaded areas show their standard deviation. These are in good agreement with the least square estimates (orange lines) calculated previously. In Tab. 1 (Appendix C) we show the inferred parameters and the objective function f for two different initial conditions.\nTo learn the functional dependence of the parameters of the effective bimolecular propensity g1(~n) defined in Eq. (8) with the crowding level \u03c6, we obtain effective parameters (k0, \u03c4, h) by minimisation of the objective function (11) for a set of training values of \u03c6 and then we use Gaussian Process (GP) regression to extend our predictions to a whole range of values of \u03c6 not covered by the\ntraining set. This approach has a huge computational benefit because we can obtain predictions of effective rates in the whole range of \u03c6 without running computationally demanding CA and BO at each point of the parameter space. Here we use the python GP implementation in scikit-learn with a sum of Neural Network kernel and white kernel, the latter term to model the noise induced by finite simulation samples. In Figs. 4 (a), (b) and (c) we show the results of this procedure. The GP regression line (blue line) was here learnt from 5 training points (shown in teal stars and each obtained using BO trained with ns = 2000 CA samples) evenly chosen in the space \u03c6 = 0 \u2212 0.4. To test the accuracy of GP regression, we calculated k0, \u03c4 and h for another set of values of \u03c6; these testing points are shown as teal diamonds and are close to the GP regression curve calculated from training data.\nTo further test the accuracy of the GP regression line, we calculated the relative errors between the GP\u2019s estimates of k\u03030 = k0\u2126, \u03c4 and h for 4 test points\nand a direct prediction from BO using 6000 CA samples at the same points (the ground truth). The results are shown by the open crosses in Fig. 4 (d) \u2013 the relative errors are relatively small showing the accuracy of the GP regression. We also compute the relative errors between the ground truth and the k\u03030, \u03c4 and h directly predicted from BO using the same number of CA samples as used to train the GP. We see that this relative error (shown by the open circles) is of comparable magnitude to the one obtained earlier for the GP prediction; in other words, GP predictions appear to be of a similar quality to ab initio re-learning of the effective rates from a new batch of CA simulations.\nFinally, in Fig. 4 (e) we show the time of training a new sample with SSA (black stars) given the pre-trained prediction model in comparison to running a single CA sample (red diamonds). Note that while we previously found that the errors of GP prediction are comparable to the CA errors, the training time for a new GP sample is more than 2 orders of magnitude smaller without accounting for pre-training time. All the experiments were performed using a single core of Intel Xeon 3.5 GHz and 16 GB RAM.\nIn Fig. 5 we compare distributions drawn from CA simulations of the enzyme reaction system (4) (our ground truth; teal histograms) and the distributions generated with SSA using effective rates calculated using BO (orange outline histograms). We compare the marginal distributions of products P obtained in the enzyme reaction. The left column in Fig. 5 compares distributions sampled at the beginning of the experiment (t = 40) while the middle and the right columns compare the distributions in the middle (t = 480) and the end (t = 1000) of the experiment, respectively. The lower row of figures is for \u03c6 = 0, the middle row is for \u03c6 = 0.2 (middle row) and the top row is for \u03c6 = 0.4. In the corner of each subplot, we show the WD between the marginal distributions (obtained from the CA and SSA+BO) and the value of fi (as defined by Eq. (11)) for the respective time interval. Curiously, the distribution at \u03c6 = 0 and t = 480, and the one at \u03c6 = 0.2 and t = 480 look similar in the plot, but the difference in the WDs is significant at 2.3 vs 10.9. This is due to a systematic discrepancy between the CA and the SSA marginal distributions in the upper subplot that is not easily visible by eye but can be picked by zooming into the subplots. Also, we can see that the quality of the approximation degrades with an increase in \u03c6 (larger values of WD). This might happen because with an increase in crowding, the dynamics of the system become non-Markovian (time between successive reaction events is not any more exponential)."
        },
        {
            "heading": "3.2 Gene network with negative feedback",
            "text": "Next, we study the stochastic kinetics of a gene network with negative feedback in the presence of crowding (a well-mixed, non-crowded version of this system was studied in [42]).\nThe CA simulations for this system proceed via a set of rules and boundary conditions, akin to those used previously for enzyme kinetics. We consider a fictitious 2D cell defined by a square lattice of points (100 \u00d7 50) with periodic boundary conditions (to reduce finite-size effects). One (immobile) lattice point\nis the gene which can have one of three states: G (unbound to a protein), GP (bound to a protein) and GP2 (bound to two proteins). The rest of the lattice points are either empty or occupied by an mRNA (M), a protein (P), a crowder (C), a free degrading enzyme (E) or a protein-enzyme complex (EP). All of these molecules are mobile, i.e. can jump to a neighbouring empty lattice point, except the crowders which are immobile at all times. M is produced when the gene is in state G or GP (transcription); subsequently, M can produce P (translation) or else it is removed from the system (mRNA degradation). P can bind to the enzyme E to form the complex EP which can then decay to E (protein degradation). P can also bind to the gene G to form GP and this can bind to another P to form GP2. G and GP are assumed to produce M at the same rate but GP2 is transcriptionally silent \u2013 hence this is a negative feedback loop since the gene-product (the protein) represses its own production. In all cases, the initial number of molecules of each species are nG = 1, nGP = 0, nGP2 = 0, nM = 0, nP = 0, nE = 100, nEP = 0. In Fig. 6 we show a cartoon of this system.\nThe procedure leading to an effective CME, approximating the spatial CA dynamics, is the same as before. We use BO to fit CA generated time-dependent\nmarginal distributions of all species to those generated by an SSA. In this case the reactions modelled by the SSA are given by\nG k0\u2212\u2192 G + M, M ks\u2212\u2192 P + M, P + E k3\u2212\u2212\u21c0\u21bd\u2212\nk\u22123 EP\nk4\u2212\u2192 E, M kdM\u2212\u2212\u2212\u2192 \u2205,\nP + G k1\u2212\u2212\u21c0\u21bd\u2212 k\u22121 GP, P + GP k2\u2212\u2212\u21c0\u21bd\u2212 k\u22122 GP2, GP k0\u2212\u2192 GP + M. (12)\nNote that the objective function minimized by BO is same as Eq. (11) but\nwithout the (first) \u03b3 dependent term; to lighten the computational burden, we choose to infer only the three bimolecular rates (k1, k2, k3) and assume that the unimolecular reaction rates are fixed to the ones set in the CA simulations. This is a reasonable assumption since crowding tends to primarily affect bimolecular rates. Note that while the inferred bimolecular rates were time-dependent in the previous enzyme example, for the feedback loop they are found to quickly converge to a time-independent non-zero value and hence we do not need to assume a Zipf-Mandelbrot law for the rates \u2013 this is because for the feedback loop, in steady-state all species numbers fluctuate around a non-zero value.\nThe results of the parameter inference averaged over 5 BO runs are shown in Tab. 2 in Appendix C (here we also show the probabilities of the individual reactions in the CA). The standard deviation in the inferred parameters in most of the cases is smaller than 20% of the mean, therefore, we can conclude that the parameters are inferred fairly well. In Fig. 7 we compare distributions drawn\nfrom CA simulations (our ground truth; teal histograms) and the distributions generated with SSA using effective rates calculated using BO (orange outline histograms). Note the same tendency as in the previous example, where the WDs increase with the level of crowding probably because of the breakdown of the Markovian assumption behind the CME. Interestingly, as shown in Fig. 8,\nthe CME starts to fail as a good approximation of the CA for increased mRNA production rate k0 even in the case where there is no crowding. Presumably, this happens because of increased mRNA production close to the gene which causes a large degree of volume exclusion due to self-crowding of mRNA molecules (the CA sample average of the fraction of occupied volume in steady-state is quite low at 0.023)."
        },
        {
            "heading": "4 Conclusions",
            "text": "As advances in measurement technology probe deeper into the spatial stochasticity of biochemical reactions, novel computational tools are needed to formulate quantitative theories of cellular function. Existing frameworks for modelling spatial stochastic effects such as Brownian Dynamics simulations and Cellular Automata (CA) inescapably suffer from a high computational load. This is further aggravated by the frequent need to explore a range of parametrisations for the models as biochemical parameters are seldom accessible, creating the need for even larger-scale simulation studies. In this paper, we propose an automatic approach to generate simpler effective CME models which can recapitulate the statistical behaviour of spatially crowded stochastic systems. Given a (limited) number of expensive spatial simulation runs, our approach can provide a fast CME-based simulator for any parametrisation of the spatial system which optimally matches its statistical properties. Our approach focussed on CA spatial systems, but in principle, the same procedure can be deployed for any spatial simulator.\nAs well as providing an efficient simulation tool, our approach opens potential new directions. As a first application, its computational efficiency would easily allow the analysis of 3D systems, as the scaling of the CME is clearly independent of the dimension of the space in which the reactions happen. Secondly, the availability of efficient simulation tools opens the way to the use of simulator-based inference tools to estimate the parameters of spatial crowded systems from data [43], therefore enabling a formal statistical link between computational methodology and experimental technology."
        },
        {
            "heading": "A Wasserstein Distance (WD)",
            "text": "In principle any distance measure between distributions may be used as an objective function but WD has proven to be one of the most effective [35]. Consider two distributions P and Q of datasets P1, ..., Pn and Q1, ..., Qn, then the Wasserstein distance between them is\nWD(p) =  n\u2211 i=1 ||Pi \u2212Qi||p  1p , (13)\nwhere p \u2265 1 is the dimensionality of the original data distribution. In this paper, we always use p = 1."
        },
        {
            "heading": "B CA rules modelling enzyme kinetics in crowded conditions",
            "text": "At the beginning of each simulation, the counter \u03b3 is reset to zero, and E, S and crowder molecules are randomly placed on the square lattice. At each time step, a \u201csubject\u201d molecule is randomly chosen and it is moved or participates in a reaction according to the following rules:\n1. Choose randomly one of 4 nearest neighbouring \u201cdestination\u201d sites. 2. If the destination site is empty and the \u201csubject\u201d molecule is E, S or P then\nmove the molecule (simulates diffusion). 3. Otherwise:\n(a) If the \u201csubject\u201d molecule is E or S and the molecule occupying the \u201cdestination\u201d site (\u201ctarget\u201d molecule) is, respectively, S or E then generate a uniform random number between 0 and 1. If this is lower than the reaction probability P1 = 1, replace the \u201ctarget\u201d molecule with ES, remove \u201csubject\u201d molecule and increase the counter \u03b3 by one. This step models the reaction E + S\u2192 ES.\n(b) If the \u201csubject\u201d molecule is ES, check if there are any molecules placed on the neighbouring sites. If at least one nearest neighbour site is empty, randomly choose a vacant \u201cdestination\u201d site and generate a uniform random number between 0 and 1.\ni. If the generated number is less than P\u22121 = 0.02, place E on \u201csubject\u201d site and S on \u201cdestination\u201d site (ES\u2192 E + S).\nii. If the number is greater than P\u22121 but lower than P\u22121 + P2, where P2 = 0.04, then place E on the \u201csubject\u201d site and P on the \u201cdestination\u201d site (ES\u2192 E + P).\niii. If the number is greater than P\u22121 +P2 move ES to the \u201cdestination\u201d site (only diffusion occurs).\n4. Otherwise, if the \u201cdestination\u201d site is occupied, reject the move (simulates volume exclusion effects)."
        },
        {
            "heading": "C Supplementary tables",
            "text": ""
        }
    ],
    "title": "Bayesian learning of effective chemical master equations in crowded intracellular conditions",
    "year": 2022
}
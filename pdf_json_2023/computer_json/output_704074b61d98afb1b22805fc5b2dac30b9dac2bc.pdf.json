{
    "abstractText": "This paper develops a fast algorithm for computing the equilibrium assignment with the perturbed utility route choice (PURC) model. Without compromise, this allows the significant advantages of the PURC model to be used in large-scale applications. We formulate the PURC equilibrium assignment problem as a convex minimization problem and find a closed-form stochastic network loading expression that allows us to formulate the Lagrangian dual of the assignment problem as an unconstrained optimization problem. To solve this dual problem, we formulate a quasi-Newton accelerated gradient descent algorithm (qN-AGD*). Our numerical evidence shows that qN-AGD* clearly outperforms a conventional primal algorithm as well as a plain accelerated gradient descent algorithm. qN-AGD* is fast with a runtime that scales about linearly with the problem size, indicating that solving the perturbed utility assignment problem is feasible also with very large networks.",
    "authors": [
        {
            "affiliations": [],
            "name": "Rui Yao"
        },
        {
            "affiliations": [],
            "name": "Mogens Fosgerau"
        },
        {
            "affiliations": [],
            "name": "Mads Paulsen"
        }
    ],
    "id": "SP:9167c9040a3040bfe42424b3ae9977ea04a74f00",
    "references": [
        {
            "authors": [
                "T. Akamatsu"
            ],
            "title": "Cyclic flows, markov process and stochastic traffic assignment",
            "venue": "Transportation Research Part B: Methodological,",
            "year": 1996
        },
        {
            "authors": [
                "T. Akamatsu"
            ],
            "title": "Decomposition of path choice entropy in general transport networks",
            "venue": "Transportation Science,",
            "year": 1997
        },
        {
            "authors": [
                "R. Allen",
                "J. Rehbeck"
            ],
            "title": "Identification With Additively Separable Heterogeneity",
            "venue": "Econometrica, 87(3):1021\u20131054,",
            "year": 2019
        },
        {
            "authors": [
                "H. Attouch",
                "J. Peypouquet"
            ],
            "title": "The rate of convergence of nesterov\u2019s accelerated forward-backward method is actually faster than 1/k\u02c62",
            "venue": "SIAM Journal on Optimization,",
            "year": 2016
        },
        {
            "authors": [
                "H. Bar-Gera"
            ],
            "title": "Origin-based algorithm for the traffic assignment problem",
            "venue": "Transportation Science,",
            "year": 2002
        },
        {
            "authors": [
                "H. Bar-Gera"
            ],
            "title": "Transportation networks for research",
            "year": 2016
        },
        {
            "authors": [
                "A. Beck",
                "M. Teboulle"
            ],
            "title": "A fast iterative shrinkage-thresholding algorithm for linear inverse problems",
            "venue": "SIAM journal on imaging sciences,",
            "year": 2009
        },
        {
            "authors": [
                "M. Beckmann",
                "C.B. McGuire",
                "C.B. Winsten"
            ],
            "title": "Studies in the economics of transportation",
            "venue": "Technical report,",
            "year": 1956
        },
        {
            "authors": [
                "S. Bekhor",
                "J. Prashker"
            ],
            "title": "Stochastic user equilibrium formulation for generalized nested logit model",
            "venue": "Transportation Research Record,",
            "year": 2001
        },
        {
            "authors": [
                "S. Bekhor",
                "J.N. Prashker"
            ],
            "title": "Formulations of extended logit stochastic user equilibrium assignments",
            "venue": "In 14th International Symposium on Transportation and Traffic TheoryTransportation Research Institute,",
            "year": 1999
        },
        {
            "authors": [
                "S. Bekhor",
                "T. Toledo"
            ],
            "title": "Investigating path-based solution algorithms to the stochastic user equilibrium problem",
            "venue": "Transportation Research Part B: Methodological,",
            "year": 2005
        },
        {
            "authors": [
                "S. Bekhor",
                "T. Toledo",
                "L. Reznikova"
            ],
            "title": "A path-based algorithm for the cross-nested logit stochastic user equilibrium traffic assignment",
            "venue": "Computer-Aided Civil and Infrastructure Engineering,",
            "year": 2009
        },
        {
            "authors": [
                "M. Ben-Akiva",
                "D. Mcfadden",
                "T. G\u00e4rling",
                "D. Gopinath",
                "J. Walker",
                "D. Bolduc",
                "A. Boersch-Supan",
                "P. Delqui\u00e9",
                "O. Larichev",
                "T. Morikawa"
            ],
            "title": "Extended framework for modelling choice behavior",
            "venue": "Marketing Letters,",
            "year": 1999
        },
        {
            "authors": [
                "E. Cascetta",
                "A. Nuzzolo",
                "F. Russo",
                "A. Vitetta"
            ],
            "title": "A modified logit route choice model overcoming path overlapping problems: Specification and some calibration results for interurban networks",
            "venue": "Technical report, Proceedings of the 13th International Symposium on the Theory of Road Traffic Flow,",
            "year": 1996
        },
        {
            "authors": [
                "A. Chambolle",
                "C. Dossal"
            ],
            "title": "On the convergence of the iterates of the \u201cfast iterative shrinkage/thresholding algorithm",
            "venue": "Journal of Optimization theory and Applications,",
            "year": 2015
        },
        {
            "authors": [
                "C. Chu"
            ],
            "title": "A Paired Combinational Logit Model for Travel Demand Analysis",
            "venue": "Technical report, Proceedings of the fifth World Conference on Transportation Research, Yokahama, Japan,",
            "year": 1989
        },
        {
            "authors": [
                "C.F. Daganzo"
            ],
            "title": "Unconstrained extremal formulation of some transportation equilibrium problems",
            "venue": "Transportation Science,",
            "year": 1982
        },
        {
            "authors": [
                "C.F. Daganzo",
                "Y. Sheffi"
            ],
            "title": "On stochastic models of traffic assignment",
            "venue": "Transportation science,",
            "year": 1977
        },
        {
            "authors": [
                "A. Daly",
                "M. Bierlaire"
            ],
            "title": "A general and operational representation of generalised extreme value models",
            "venue": "Transportation Research Part B: Methodological,",
            "year": 2006
        },
        {
            "authors": [
                "D. Davis",
                "W. Yin"
            ],
            "title": "A three-operator splitting scheme and its optimization applications",
            "venue": "Setvalued and variational analysis,",
            "year": 2017
        },
        {
            "authors": [
                "T. De La Barra",
                "B. Perez",
                "J. Anez"
            ],
            "title": "Multidimensional path search and assignment",
            "venue": "In PTRC Summer Annual Meeting,",
            "year": 1993
        },
        {
            "authors": [
                "R.B. Dial"
            ],
            "title": "A probabilistic multipath traffic assignment model which obviates path enumeration",
            "venue": "Transportation research,",
            "year": 1971
        },
        {
            "authors": [
                "R.B. Dial"
            ],
            "title": "A path-based user-equilibrium traffic assignment algorithm that obviates path storage and enumeration",
            "venue": "Transportation Research Part B: Methodological,",
            "year": 2006
        },
        {
            "authors": [
                "M. Du",
                "H. Tan",
                "A. Chen"
            ],
            "title": "A faster path-based algorithm with barzilai-borwein step size for solving stochastic traffic equilibrium models",
            "venue": "European Journal of Operational Research,",
            "year": 2021
        },
        {
            "authors": [
                "L.C. Duncan",
                "D.P. Watling",
                "R.D. Connors",
                "T.K. Rasmussen",
                "O.A. Nielsen"
            ],
            "title": "Path size logit route choice models: Issues with current models, a new internally consistent approach, and parameter estimation on a large-scale network with gps data",
            "venue": "Transportation Research Part B: Methodological,",
            "year": 2020
        },
        {
            "authors": [
                "C. Fisk"
            ],
            "title": "Some developments in equilibrium traffic assignment",
            "venue": "Transportation Research Part B: Methodological,",
            "year": 1980
        },
        {
            "authors": [
                "G. Fl\u00f6tter\u00f6d",
                "M. Bierlaire"
            ],
            "title": "Metropolis\u2013hastings sampling of paths",
            "venue": "Transportation Research Part B: Methodological,",
            "year": 2013
        },
        {
            "authors": [
                "M. Fosgerau",
                "D.L. McFadden"
            ],
            "title": "A theory of the perturbed consumer with general budgets",
            "venue": "NBER Working Paper, pages 1\u201327,",
            "year": 2012
        },
        {
            "authors": [
                "M. Fosgerau",
                "E. Frejinger",
                "A. Karlstrom"
            ],
            "title": "A link based network route choice model with unrestricted choice set",
            "venue": "Transportation Research Part B: Methodological,",
            "year": 2013
        },
        {
            "authors": [
                "M. Fosgerau",
                "M. Paulsen",
                "T.K. Rasmussen"
            ],
            "title": "A perturbed utility route choice model",
            "venue": "Transportation Research Part C,",
            "year": 2022
        },
        {
            "authors": [
                "M. Fosgerau",
                "M. Lukawska",
                "M. Paulsen",
                "T.K. Rasmussen"
            ],
            "title": "Bikeability and the induced demand for cycling",
            "venue": "Proceedings of the National Academy of Sciences,",
            "year": 2023
        },
        {
            "authors": [
                "E. Frejinger",
                "M. Bierlaire",
                "M. Ben-Akiva"
            ],
            "title": "Sampling of alternatives for route choice modeling",
            "venue": "Transportation Research Part B: Methodological,",
            "year": 2009
        },
        {
            "authors": [
                "J. Hofbauer",
                "W.H. Sandholm"
            ],
            "title": "On the global convergence of stochastic fictitious",
            "venue": "play. Econometrica,",
            "year": 2002
        },
        {
            "authors": [
                "R. Jayakrishnan",
                "W.T. Tsai",
                "J.N. Prashker",
                "S. Rajadhyaksha"
            ],
            "title": "A faster path-based algorithm for traffic",
            "year": 1994
        },
        {
            "authors": [
                "J. Liang",
                "T. Luo",
                "C.-B. Schonlieb"
            ],
            "title": "Improving \u201cfast iterative shrinkage-thresholding algorithm\u201d: faster, smarter, and greedier",
            "venue": "SIAM Journal on Scientific Computing,",
            "year": 2022
        },
        {
            "authors": [
                "H.X. Liu",
                "X. He",
                "B. He"
            ],
            "title": "Method of successive weighted averages (mswa) and self-regulated averaging schemes for solving stochastic user equilibrium problem",
            "venue": "Networks and Spatial Economics,",
            "year": 2009
        },
        {
            "authors": [
                "M. Maher"
            ],
            "title": "Algorithms for logit-based stochastic user equilibrium assignment",
            "venue": "Transportation Research Part B: Methodological,",
            "year": 1998
        },
        {
            "authors": [
                "T. Mai"
            ],
            "title": "A method of integrating correlation structures for a generalized recursive route choice model",
            "venue": "Transportation Research Part B: Methodological,",
            "year": 2016
        },
        {
            "authors": [
                "T. Mai",
                "E. Frejinger"
            ],
            "title": "Undiscounted recursive path choice models: Convergence properties and algorithms",
            "venue": "Transportation Science,",
            "year": 2022
        },
        {
            "authors": [
                "T. Mai",
                "M. Fosgerau",
                "E. Frejinger"
            ],
            "title": "A nested recursive logit model for route choice analysis",
            "venue": "Transportation Research Part B: Methodological,",
            "year": 2015
        },
        {
            "authors": [
                "D. McFadden"
            ],
            "title": "Modelling the choice of residential location",
            "venue": "Spatial Interaction Theory and Planning Models,",
            "year": 1978
        },
        {
            "authors": [
                "D. McFadden"
            ],
            "title": "Econometric Models of Probabilistic Choice",
            "year": 1981
        },
        {
            "authors": [
                "P. Milgrom",
                "I. Segal"
            ],
            "title": "Envelope theorems for arbitrary choice",
            "venue": "sets. Econometrica,",
            "year": 2002
        },
        {
            "authors": [
                "Y. Nie"
            ],
            "title": "A note on bar-gera\u2019s algorithm for the origin-based traffic assignment problem",
            "venue": "Transportation Science,",
            "year": 2012
        },
        {
            "authors": [
                "Y.M. Nie"
            ],
            "title": "A class of bush-based algorithms for the traffic assignment problem",
            "venue": "Transportation Research Part B: Methodological,",
            "year": 2010
        },
        {
            "authors": [
                "Y. Oyama"
            ],
            "title": "Capturing positive network attributes during the estimation of recursive logit models: A prism-based approach",
            "venue": "Transportation Research Part C: Emerging Technologies,",
            "year": 2023
        },
        {
            "authors": [
                "Y. Oyama",
                "E. Hato"
            ],
            "title": "Prism-based path set restriction for solving markovian traffic assignment problem",
            "venue": "Transportation Research Part B: Methodological,",
            "year": 2019
        },
        {
            "authors": [
                "Y. Oyama",
                "Y. Hara",
                "T. Akamatsu"
            ],
            "title": "Markovian traffic equilibrium assignment based on network generalized extreme value model",
            "venue": "Transportation Research Part B: Methodological,",
            "year": 2022
        },
        {
            "authors": [
                "B.T. Polyak"
            ],
            "title": "Some methods of speeding up the convergence of iteration methods",
            "venue": "Ussr computational mathematics and mathematical physics,",
            "year": 1964
        },
        {
            "authors": [
                "W.B. Powell",
                "Y. Sheffi"
            ],
            "title": "The convergence of equilibrium algorithms with predetermined step sizes",
            "venue": "Transportation Science,",
            "year": 1982
        },
        {
            "authors": [
                "C.G. Prato"
            ],
            "title": "Route choice modeling: Past, present and future research directions",
            "venue": "Journal of Choice Modelling,",
            "year": 2009
        },
        {
            "authors": [
                "C.G. Prato",
                "S. Bekhor"
            ],
            "title": "Applying branch-and-bound technique to route choice set generation",
            "venue": "Transportation Research Record,",
            "year": 2006
        },
        {
            "authors": [
                "R.T. Rockafellar"
            ],
            "title": "Convex Analysis",
            "venue": "ISBN 0691080690",
            "year": 1970
        },
        {
            "authors": [
                "Y. Sheffi"
            ],
            "title": "Urban transportation networks, volume",
            "year": 1985
        },
        {
            "authors": [
                "Y. Sheffi",
                "W.B. Powell"
            ],
            "title": "An algorithm for the equilibrium assignment problem with random link",
            "venue": "times. Networks,",
            "year": 1982
        },
        {
            "authors": [
                "J.R.-V. S\u00f8rensen",
                "M. Fosgerau"
            ],
            "title": "How McFadden met Rockafellar and learned to do more with less",
            "year": 2020
        },
        {
            "authors": [
                "I. Sutskever",
                "J. Martens",
                "G. Dahl",
                "G. Hinton"
            ],
            "title": "On the importance of initialization and momentum in deep learning",
            "venue": "In International conference on machine learning,",
            "year": 2013
        },
        {
            "authors": [
                "D. Ton",
                "D. Duives",
                "O. Cats",
                "S. Hoogendoorn"
            ],
            "title": "Evaluating a data-driven approach for choice set identification using gps bicycle route choice data from amsterdam",
            "venue": "Travel behaviour and society,",
            "year": 2018
        },
        {
            "authors": [
                "P. Tseng"
            ],
            "title": "Convergence of a block coordinate descent method for nondifferentiable minimization",
            "venue": "Journal of optimization theory and applications,",
            "year": 2001
        },
        {
            "authors": [
                "P. Vovsha",
                "S. Bekhor"
            ],
            "title": "Link-nested logit model of route choice: overcoming route overlapping problem",
            "venue": "Transportation Research Record: Journal of Transportation Research Board,",
            "year": 1998
        },
        {
            "authors": [
                "D.P. Watling",
                "T.K. Rasmussen",
                "C.G. Prato",
                "O.A. Nielsen"
            ],
            "title": "Stochastic user equilibrium with a bounded choice model",
            "venue": "Transportation Research Part B: Methodological,",
            "year": 2018
        },
        {
            "authors": [
                "C.-H. Wen",
                "F. Koppelman"
            ],
            "title": "The Generalized Nested Logit Model",
            "venue": "Transportation Research B,",
            "year": 2001
        },
        {
            "authors": [
                "C. Xie",
                "S.T. Waller"
            ],
            "title": "Stochastic traffic assignment, lagrangian dual, and unconstrained convex optimization",
            "venue": "Transportation Research Part B: Methodological,",
            "year": 2012
        },
        {
            "authors": [
                "R. Yao",
                "S. Bekhor"
            ],
            "title": "A variational autoencoder approach for choice set generation and implicit perception of alternatives in choice modeling",
            "venue": "Transportation Research Part B: Methodological,",
            "year": 2022
        },
        {
            "authors": [
                "J. Zhang",
                "T. He",
                "S. Sra",
                "A. Jadbabaie"
            ],
            "title": "Why gradient clipping accelerates training: A theoretical justification for adaptivity",
            "year": 1905
        }
    ],
    "sections": [
        {
            "text": "Keywords: Perturbed utility, stochastic traffic assignment, dual algorithm, closed-form network loading, network route choice"
        },
        {
            "heading": "1. Introduction",
            "text": "Traffic assignment deals with the problem of allocating travel demands between a set of origindestination (OD) pairs onto a congestible transportation network under specific behavioral assumptions (Sheffi, 1985). This problem is central to transportation network planning and analysis.\nThe perturbed utility route choice (PURC) model (Fosgerau et al., 2022, 2023) predicts the demand of a traveler as the network flow vector that solves a certain convex optimization problem. The model has a number of features that are very attractive for applications. It generates realistic predictions of equilibrium network flow with substitution patterns induced directly by the network structure, while allowing a priori any physically possible route in the transportation network without the need for choice set generation, and while predicting zero flow in irrelevant parts of the network. Not least, the PURC model can be estimated by linear regression.\nThe demand of individual travelers depends on the travel times in the network. The network is congestible, which means that travel times, in turn, depend on the aggregate demand on each link in the network. To make predictions, we generally impose the condition that demand and travel times are in equilibrium, i.e. that individual demands are those that result from the network\n\u2217Corresponding author: mogens.fosgerau@econ.ku.dk.\nar X\niv :2\n31 2.\n00 84\n8v 1\n[ m\nat h.\nO C\n] 1\nD ec\n2 02\ntravel times, while travel times are those that result from the aggregate demand of travelers. The equilibrium traffic assignment problem is to determine this point (Sheffi, 1985).\nA naive approach to solving this problem would alternate between computing network flows conditional on travel times and updating travel times. This would, however, be extremely timeconsuming as the network flow of each traveler is the solution to an individual convex optimization problem with as many free variables as there are links in the network. This approach would be particularly impractical in large networks since the problem complexity increases drastically with the number of travelers and network size. This paper develops a much faster approach for computing the PURC traffic equilibrium by exploiting properties of the model, thus making it relevant for large-scale applications.\nThe first contribution of this paper is to formulate the traffic assignment problem as a single large constrained convex optimization problem. We show that the equilibrium solution exists uniquely. This means we can be sure always to find an equilibrium while not having to worry about the potential existence of multiple equilibria.\nSecond, we exploit the structure of the PURC model to derive a closed-form expression for the link flows as functions of the link costs and dual parameters corresponding to the flow conservation constraints. This enables us to formulate the Lagrangian dual of the primal traffic assignment problem in closed form as an unconstrained convex optimization problem. This dual traffic assignment problem is much faster to solve than the primal traffic assignment problem since it is unconstrained and involves only the dual variables as decision variables.\nThird, we propose a fast solution algorithm. We include the equilibrium condition for travel times as an auxiliary fixed-point problem and solve the dual traffic assignment problem conditional on travel times using the accelerated gradient descent (AGD) algorithm (Nesterov, 1983; Beck and Teboulle, 2009). To avoid oscillation at later iterations, we employ the AGD* scheme (Chambolle and Dossal, 2015), which turns out to gain us considerable speed. Furthermore, using a quasi-Newton method, we scale the gradient by the Hessian diagonal to avoid line search for step sizes, thereby gaining additional speed. Furthermore, at each iteration, we propose to update link travel times by a Newton step such that the equilibrium condition for travel times is satisfied at convergence. We refer to the resulting algorithm as qN-AGD*.\nWe test the performance of our qN-AGD* algorithm with a range of networks of various sizes and find very satisfactory runtimes. Importantly, we find that the runtime scales about linearly with the size of the problem, i.e., the number of nodes times the number of origin-destination pairs, suggesting that our algorithm will perform well with very large problems.\nThe paper is organized as follows. Section 2 comprises a literature review of stochastic assignment models and algorithms and their relations to perturbed utility models. Section 3 presents the link-based perturbed utility route choice model and an analysis of its solution properties. The perturbed utility-based stochastic traffic assignment model is formulated and analyzed in Section 4, along with a closed-form network loading and an unconstrained dual assignment problem. Section 5 presents an efficient algorithm based on quasi-Newton accelerated gradient descent (qN-AGD*)\nfor the dual formulation. Section 6 reports the results of the numerical experiments. Section 7 concludes."
        },
        {
            "heading": "2. Literature review",
            "text": ""
        },
        {
            "heading": "2.1. Perturbed utility models",
            "text": "The perturbed utility model (Fosgerau and McFadden, 2012; Allen and Rehbeck, 2019) in its general form, describes consumer choice as a vector x that maximizes a concave function v\u22a4x\u2212F (x), where v is a vector of utility indexes and F is the convex perturbation function. The consumption vector x is constrained to lie in some budget set B. This general framework can represent a wide range of behavioral models as special cases (Allen and Rehbeck, 2019). The perturbed utility model becomes a discrete choice model when the budget set is defined as the probability simplex. In particular, any additive random utility discrete choice model (McFadden, 1981) can be represented as a perturbed utility model, where the perturbation function F is the convex conjugate (Rockafellar, 1970) of the surplus function of the additive random utility model (Hofbauer and Sandholm, 2002). The multinomial logit model is a perturbed utility model in which the perturbation function is the Shannon entropy (S\u00f8rensen and Fosgerau, 2020).\nIn this paper, we employ the perturbed utility route choice model (Fosgerau et al., 2022), described in detail in Section 3. This is a perturbed utility model in which the budget set for a traveler is the set of network flow vectors that satisfy flow conservation of one unit demand traveling from the origin to the destination. Moreover, the convex perturbation function incorporates the network structure by being constructed as a sum of convex terms, one for each link in the network. As a consequence, correlation between alternatives is directly induced by the physical network structure."
        },
        {
            "heading": "2.2. Stochastic traffic assignment models",
            "text": "A stochastic traffic assignment model predicts network flows in stochastic user equilibrium (SUE), under which no traveler can reduce their perceived travel cost by unilaterally changing their routing decision (Daganzo and Sheffi, 1977). A key building block for stochastic traffic assignment is the traveler route choice model that characterizes individual traveler behavior. There are two main challenges associated with route choice modeling: correlation between path utilities and choice set generation.\nThe generalized extreme value (GEV) model (McFadden, 1978) applied to model route choice accounts for correlation in path utilities, as it allows a closed-form expression for capturing similarity between alternatives in the random error term (Prato, 2009). Examples include the link-nested logit (Vovsha and Bekhor, 1998), paired combinatorial logit (Chu, 1989), and generalized nested logit (Wen and Koppelman, 2001). Alternatively, in models such as C-logit (Cascetta et al., 1996) and path-size logit (Ben-Akiva et al., 1999; Duncan et al., 2020), a correction term is added to the systematic utility function to capture the effect of overlapping paths. However, these models\nare typically path-based and therefore require explicit choice set generation, either ex-ante or by variants of column generation methods.\nIn general, the classical discrete choice models require a choice set to be defined. Route choice set generation is challenging in large networks where full path enumeration is not feasible. Deterministic generation methods construct a set of feasible paths with pre-defined rules like link penalty (De La Barra et al., 1993), and branch and bound (Prato and Bekhor, 2006). These deterministic methods are generally computationally efficient, but there is no guarantee they will reproduce the observed paths. Moreover, the restrictions involved in generating choice sets may cause bias in parameter estimation (Frejinger et al., 2009). Stochastic generation methods based on variants of random walk methods assume an underlying universal choice set (Frejinger et al., 2009; Flo\u0308ttero\u0308d and Bierlaire, 2013) can be used to avoid bias in parameter estimates but entails additional complications of path sampling. Under specific assumptions about the existence of a consideration set, recent developments in machine learning methods provide a data-driven approach to inferring the choice set generation process (Ton et al., 2018; Yao and Bekhor, 2022).\nLink-based recursive route choice models avoid choice set generation by assuming travelers sequentially choose the next link at each node. This family of models includes the recursive logit (RL) (Fosgerau et al., 2013), nested RL (Mai et al., 2015), and recursive network GEV (Mai, 2016). However, maximum likelihood estimation of these recursive models is challenging, as it requires a bi-level procedure (Oyama, 2023) where the Bellman equations must be solved many times at each evaluation of the likelihood. This can be time-consuming for large networks. Furthermore, a solution for the parameters may fail to exist (Mai and Frejinger, 2022). Oyama (2023) shows that the estimation of recursive route choice models can be facilitated by additional prism constraints, but at the cost of consistency of the parameter estimates. In contrast, the perturbed utility route choice model (Fosgerau et al., 2022) requires only linear regression for model estimation, while it is still capable of capturing correlations and avoids choice set generation.\nA number of stochastic traffic assignment models have been proposed based on different route choice models. Fisk (1980) proposes a path-based constrained optimization formulation for multinomial logit by extending the Beckmann et al. (1956) formulation with a path entropy term, whose optimal value satisfies the SUE condition. Sheffi and Powell (1982) propose an unconstrained dual formulation that generalizes Fisk (1980)\u2019s formulation with a satisfaction function to allow other distributions. However, neither the function construction nor model estimation is trivial. To account for path correlations, Bekhor and Prashker (1999, 2001) develop path entropy-based formulations for cross-nested logit (CNL), paired combinatorial logit (PCL) and generalized nested logit (GNL) models. For a given path set, these path-based SUE models are computationally efficient, but depend on a generated path set.\nIn order to avoid path set generation, Akamatsu (1997) propose a link-based assignment formulation equivalent to Fisk (1980) with infinite path set, which decomposes the path entropy term with respect to link flow. The traveler route choice behavior in Akamatsu (1997) is indeed characterized by the RL model (Fosgerau et al., 2013). The Akamatsu (1997) formulation will generally\npredict cyclic flows. This is caused by the Markov property in combination with the fact that it assigns positive probability to all out-going links (Akamatsu, 1996). For the same reason, positive flow is assigned on all links in the network, which might be behaviorally questionable and computationally challenging. Oyama and Hato (2019) propose to constrain the Markovian assignment within a prism-shaped state-extended subnetwork to limit cyclic flows by generalizing the branchand-bound method (Prato and Bekhor, 2006). Oyama et al. (2022) develop a general link-based assignment formulation for network generalized extreme value models (NGEV) (Daly and Bierlaire, 2006), which can be rewritten in terms of perturbed utility as\nmin x\u2208\u2126 \u2211 a \u222b xa 0\nc(m) dm\ufe38 \ufe37\ufe37 \ufe38 C(x)\n+ \u2211 w \u03b8w \u2211 i \u2211 j:(i,j) xwij ln\n( xwij\n\u03b1wji \u2211 j:(i,j) x w ij ) \ufe38 \ufe37\ufe37 \ufe38\nF (x)\n, (1)\nwhere \u2126 is the feasible region, c(x) is the link cost as function of flow x, \u03b8w is the GEV scale parameter for OD w, and \u03b1wji is the degree of membership of j of nest i. Defining C(x) and F (x) as indicated and assuming suitable differentiability, the first-order conditions of this problem are equivalent to the first-order conditions of the individual perturbed utility maximization problems. This shows that the recursive NGEV is a perturbed utility model.\nAlthough the recursive NGEV assignment model (1) (Oyama et al., 2022) allows a wide range of GEV models, the underlying modeling assumptions lead to positive predicted OD flows on each link in the network and complicated model estimation. In contrast, we propose a stochastic traffic assignment model for a generic convex perturbation with a condition that induces the optimal flow to be zero on most links (Fosgerau et al., 2022), i.e. those that are not in the set of optimal paths."
        },
        {
            "heading": "2.3. Assignment algorithms",
            "text": "There exists a variety of solution algorithms for the stochastic traffic assignment problem, which find the equilibrium network flows (i.e., the SUE) corresponding to the optimal traveler route choice decisions. These algorithms typically follow a two-step iterative procedure. The procedure first performs stochastic network loading to determine the auxiliary optimal flows for the given costs (e.g., flow-independent logit loading Dial (1971)); then updates the network flow assignment based on the auxiliary solution (e.g., the method of successive averages (MSA, Powell and Sheffi, 1982)) and updates the costs. Many GEV-based SUE models exploit a closed-form probability expression for performing efficient network loading (e.g., Dial, 1971; Bekhor et al., 2009; Watling et al., 2018; Oyama et al., 2022). A key contribution of this paper is the derivation of a closed-form stochastic network loading function for a generic convex perturbation.\nThe stochastic network loading step essentially provides the steepest descent direction for the stochastic traffic assignment problem. In the assignment step, flows are then updated with a suitable step size. The well-known MSA uses a predetermined step-size sequence for iteratively updating flows (Sheffi and Powell, 1982). Several studies improve the convergence of MSA by\nusing an adaptive step size scheme. For example, Liu et al. (2009) propose a self-regulated step size scheme that reduces the step size if the iterate tends to diverge. Du et al. (2021) adapt the Barzilai-Borwein step size as a quasi-Newton method for path-based SUE, which is determined by solving the secant equation with the step size being an approximation to the inverse Hessian matrix. On the other hand, gradient descent with momentum, accumulating the past gradients to guide the current iterate (Polyak, 1964), has been shown to speed up convergence (LeCun et al., 2015). One variant of the momentum method, the accelerated gradient descent (AGD) method (Nesterov, 1983; Beck and Teboulle, 2009; Sutskever et al., 2013), has demonstrated its efficiency in solving the recursive NGEV SUE problem (Oyama et al., 2022). However, the original AGD method often exhibits an oscillatory convergence pattern, which detracts from its performance. Chambolle and Dossal (2015) proposed a modification of the AGD algorithm (termed AGD* in this paper) with superior practical performance and an improved theoretical convergence rate (Attouch and Peypouquet, 2016).\nBoth AGD and AGD* typically require a backtracking line search procedure to find the step sizes. In this paper, we propose a quasi-Newton extension of the AGD* method that automatically scales the gradient with the Hessian diagonal, thus not only improving convergence but also avoiding any line search.\nMost of the existing stochastic assignment algorithms consider the primal SUE formulation (e.g., Fisk, 1980; Akamatsu, 1997; Bekhor and Prashker, 2001; Oyama and Hato, 2019), in which the decision variables are flows. The primal formulation requires the flows to satisfy conservation constraints, which can be handled with path-based gradient projection (Jayakrishnan et al., 1994; Bekhor and Toledo, 2005). However, the projection in link flow space is not trivial. In contrast, the dual formulation reduces to an unconstrained optimization problem (Daganzo, 1982), which allows efficient algorithms to be used for the link-based stochastic traffic assignment problems. Adding to existing studies with link-based dual formulations for GEV-based SUE (Maher, 1998; Xie and Waller, 2012; Oyama et al., 2022), we propose a dual formulation for link-based perturbed utility stochastic traffic assignment problem with node potentials being the decision variables, which typically have a smaller dimension than the link variables in a real network."
        },
        {
            "heading": "3. The perturbed utility route choice model",
            "text": "We begin by revisiting the perturbed utility route choice (PURC) model (Fosgerau et al., 2022). A network is given by (V, E), where V is the set of nodes with typical element v, and E is the set of directed edges (or links) with typical element (i, j) for a link from node i to node j. We assume there exists at least one path between any two network nodes, i.e.\nAssumption 1. The network (V, E) is connected.\nThe node-link incident matrix A \u2208 R|V|\u00d7|E| has entries\nav,ij =  \u22121, v = i, 1, v = j,\n0, otherwise.\nA unit demand vector b \u2208 R|V| is given as\nbv =  \u22121, if v is the traveler\u2019s origin, 1, if v is the traveler\u2019s destination,\n0, otherwise.\nA network link flow vector x \u2208 R|E|+ satisfies flow conservation if Ax = b. A traveler in the PURC model is associated with a demand vector b, a vector of positive link costs1 c \u2208 R|E|++, and link-specific convex perturbation functions Fe, where\nAssumption 2. The perturbation function Fe : R+ \u2192 R+, \u2200e \u2208 E, is continuously differentiable, strictly convex, and strictly increasing, with Fe(0) = F \u2032 e(0) = 0 and range equal to R+. Define (F \u2032e) \u22121(y) = 0 for y < 0 such that the inverse function of the derivative of the perturbation function has domain equal to R.\nFor a flow vector x \u2208 R|E|+ , we define\nF (x) = \u2211 e\u2208E Fe(xe) (2)\nfor the sum across links of perturbations Fe(xe). 2\nThe PURC model assumes that the traveler chooses link flow vector x to minimize a perturbed cost function c\u22a4x + F (x), under the flow conservation constraint.3 Thus, the traveler\u2019s demand solves the following convex program.\nmin x\u2208R|E|+\nc\u22a4x+ F (x) (3a)\ns.t. Ax = b. (3b)\nIt is an important feature of the program (3) that the objective (3a) is convex and separable by links. The coupling across links arises only through the linear conservation constraint (3b).\n1For simplicity, we deviate slightly from Fosgerau et al. (2022) by not making explicit the dependence of link costs on link lengths. This is just a question of notation.\n2Fosgerau et al. (2022) defines link-specific perturbation functions by multiplying a basic perturbation function by link lengths. This ensures that the overall perturbation function F is invariant with respect to link splitting.\n3In the route choice context, it is equivalent but more natural to talk about cost minimization rather than utility maximization.\nFosgerau et al. (2022) exploit this property to derive an estimation procedure that requires only linear regression."
        },
        {
            "heading": "3.1. PURC solution properties",
            "text": "To develop our fast assignment algorithm, we must establish some properties of the solution to the traveler\u2019s route choice problem. The program (3) is convex with a strictly convex objective; hence, the solution exists uniquely. We indicate the optimal values of decision variables by \u2018*\u2019. The complementarity condition for problem (3) is\n0 \u2264 x\u2217ij \u22a5 [ cij + F \u2032 ij(x \u2217 ij) + \u03b7 \u2217 j \u2212 \u03b7\u2217i ] \u2265 0, \u2200(i, j) \u2208 E , (4)\nwhere \u03b7 = {\u03b7v}v\u2208V denotes the dual variable for the conservation constraint (3b). The dual variable \u03b7 enters only as a difference \u03b7\u2217j \u2212\u03b7\u2217i ; hence it is determined only up to a constant. We are therefore free to impose the constraint that \u03b7d = 0 at the traveler\u2019s destination node d.\nWe can derive an expression for the optimal link flows as a function of the dual variables \u03b7j .\nFor x\u2217ij > 0, we have by complementarity and using the invertibility of F \u2032 ij that\nx\u2217ij = (F \u2032 ij) \u22121 (\u03b7\u2217i \u2212 \u03b7\u2217j \u2212 cij) , \u2200(i, j) \u2208 E . (5) For x\u2217ij = 0, under Assumption 2, we have similarly that\n0 \u2264 F \u2032ij(x\u2217ij) + cij + \u03b7\u2217j \u2212 \u03b7\u2217i = cij + \u03b7\u2217j \u2212 \u03b7\u2217i ,\nand hence Eq. (5) holds also in this case. We will use this in the next section to find a closed-form network loading expression for the dual Lagrangian of the traffic assignment problem that we will formulate.\nThe dual variables \u03b7\u2217j have a very immediate and useful interpretation as they are equal to the shortest path marginal cost from node j to the destination. To see this, note that \u03b7\u2217i \u2264 F \u2032ij(x \u2217 ij) + cij + \u03b7 \u2217 j for all (i, j) \u2208 E . Then, by the complementarity condition (4)\n\u03b7\u2217i = min j:(i,j)\u2208E\n{ \u03b7\u2217j + F \u2032 ij(x \u2217 ij) + cij } . (6)"
        },
        {
            "heading": "4. The perturbed utility-based traffic assignment problem",
            "text": "We now set up the traffic assignment problem for the perturbed utility route choice model. We consider a general assignment setting with multiple traveler types and allow for arbitrary heterogeneity. We denote the set of traveler types by W with typical element w and the volume of travelers of each type w by qw.\nThe network and the link travel times are common across types. Congestion in the network causes interaction between travelers. Otherwise, each type is assumed to behave according to its\nown perturbed utility route choice model (3) as described in the previous section. We index the link cost functions, the perturbation functions, and the demand vectors by the type, cwij , F w ij , and bw. The link cost function cwij is a type-specific function of link travel time tij . This allows e.g. type-specific preferences against tolls, while the link travel time is common to all types. We make the following assumptions.\nAssumption 3. The link cost functions cwij : R+ \u2192 R+, (i, j) \u2208 E , w \u2208 W are positive, continuously differentiable, and increasing with respect to link flow, and convex, cwij(0) > 0, c w ij \u2032 > 0.\nAssumption 4. The link travel time functions tij : R+ \u2192 R+, (i, j) \u2208 E are positive, differentiable, increasing, and strictly convex, tij > 0, t \u2032 ij > 0.\nThe travel time on link (i, j) depends on the link flow xij = \u2211 w\u2208W q wxwij and the link cost for type w is then cwij(tij(xij)). Assumptions 3 and 4 combine to ensure that the link costs are convex functions of link flow."
        },
        {
            "heading": "4.1. Primal formulation",
            "text": "We will formulate a convex minimization problem, whose solution is the Wardrop/Nash equilibrium where all travelers make individually optimal choices according to (3), taking link costs as given. Link costs, in turn, depend through the common travel time on the link flow, which is the aggregated demand from the individual travelers. This is our primal perturbed utility-based stochastic traffic assignment problem (TAP).\n[TAP]\nmin x\nZ = \u2211\n(i,j)\u2208E \u2211 w\u2208W\n[\u222b \u2211 w\u2032\u2208W q w\u2032xw \u2032 ij\n0 cwij(tij(m))dm+ q wFwij (x w ij)\n] (7a)\ns.t. xwij \u2265 0, \u2200(i, j) \u2208 E , w \u2208 W (7b)\nqw(Avx w \u2212 bwv ) = 0, \u2200v \u2208 V, w \u2208 W. (\u03b7wv ) (7c)\nIn this expression, xw = (xwe )e\u2208E is the link flow vector for type w, and x = {xwe }e\u2208E,w\u2208W . Av is the row vector corresponding to node v of the incidence matrix A. Eq. (7c) is the conservation constraints with corresponding Lagrange multipliers \u03b7wv for each node and type. We denote \u03b7 = (\u03b7wv )v\u2208V,w\u2208W .\nOur proposed primal TAP formulation extends Beckmann et al. (1956)\u2019s deterministic UE formulation with the addition of a perturbation term. The PURC is similar to the recursive NGEV formulation of Oyama et al. (2022) with the important difference that PURC allows corner solutions, i.e. links with zero flow. In particular, because of the requirements on the PURC perturbation function, the optimal flow for a given OD concentrates on a relatively small number of paths, while it is zero in the rest of the network.\nWe first show that the equilibrium link flow pattern in the primal TAP equals the PURC\ndemand for each w.\nProposition 1. The stochastic user equilibrium condition in TAP (7) is equivalent to the optimality condition in PURC (3), such that traveler route choice behavior is in accordance with the PURC model. Proof. Denote optimal link flows by x\u2217ij = \u2211 w\u2208W q wxw\u2217ij and equilibrium type-specific link costs by cw\u2217ij = c w ij(t(x \u2217 ij)) The complementarity condition for x w ij in the primal TAP is\n0 \u2264 xw\u2217ij \u22a5 qw(cw\u2217ij + F \u2032ij(xw\u2217ij ) + \u03b7w\u2217j \u2212 \u03b7w\u2217i ) \u2265 0. (8)\nSince we consider only types with positive demand qw > 0, this reduces to\n0 \u2264 xw\u2217ij \u22a5 (cw\u2217ij + F \u2032ij(xw\u2217ij ) + \u03b7w\u2217j \u2212 \u03b7w\u2217i ) \u2265 0, (9)\nwhich is the same as Eq. (4) required for each traveler.\nWe are now ready to prove the existence and uniqueness of the solution to the primal TAP.\nProposition 2 (Existence and uniqueness of TAP). The primal traffic assignment problem (TAP) admits a unique solution.\nProof. By Assumptions 2, 3, and 4 on Fwij , c w ij , and tij , ij \u2208 E , w \u2208 W, the objective Z is strictly convex. In addition, the domain is convex. Hence, any solution is unique. To establish existence, we will show that the relevant domain is bounded. Observe that the perceived link cost cwij(xij) + F \u2032ij(x w ij) is positive for all links and types. Links with positive flow can never form a cycle at optimum, since then a cheaper feasible flow vector can be identified by removing the cyclic flow. It is therefore no loss of generality to restrict the domain of Z to the set of acyclic link flows for each w. This set is bounded, hence TAP (7) admits a unique solution."
        },
        {
            "heading": "4.2. Dual formulation",
            "text": "The primal TAP involves a large number of flow conservation constraints, one for each combination of type and network node. In this section, we will utilize that we have found an expression for the individual link flows as a function of the dual parameters. We will use this to find a closed-form expression for the dual problem corresponding to the primal TAP, and we will show that the dual problem is unconstrained. This will be useful for finding a fast solution algorithm.\nThe Lagrangian function for the primal TAP (7) is\nL(x, \u03b7) = \u2211\n(i,j)\u2208E \u2211 w\u2208W\n[\u222b \u2211 w\u2032\u2208W q w\u2032xw \u2032 ij\n0 cwij(tij(m))dm+ q wFwij (x w ij)\n]\n\u2212 \u2211\n(i,j)\u2208E \u2211 w\u2208W qw ( \u03b7wi \u2212 \u03b7wj ) xwij \u2212 \u2211 v\u2208V \u2211 w\u2208W qw\u03b7wv b w v (10a)\ns.t. xwij \u2265 0, \u2200(i, j) \u2208 E , w \u2208 W, (10b)\nwhere \u03b7wi , w \u2208 W, i \u2208 V are the Lagrangian multipliers for the flow conservation constraints. As for the individual traveler, we are free to impose the normalization that \u03b7wdw = 0, such that these Lagrangian multipliers can be interpreted as the minimum perceived cost from node i to the destination node dw of each type w.\nThe Lagrangian function (10) has simple constraints, but adds extra decision variables, the dual variables \u03b7wij . Using the closed-form expression (5) for the flow variables x w\u2217 ij as a function of the dual variables allows us to reduce the number of decision variables considerably.\nProposition 3 (Perturbed utility-based network loading). The optimal link flow xw\u2217ij for given \u03b7 is\nxw\u2217ij = x w\u2217 ij (\u03b7 w\u2217 i , \u03b7 w\u2217 j , c w\u2217 ij ) = (F w\u2032 ij ) \u22121 (\u03b7w\u2217i \u2212 \u03b7w\u2217j \u2212 cw\u2217ij ) , (11) where\ncw\u2217ij = c w ij ( tij (\u2211 w\u2208W qwxw\u2217ij )) . (12)\nProof. As shown in Section 3.1, Eq. (5) holds for xw\u2217ij \u2265 0. This is ensured by projecting the RHS of Eq. (11) onto the positive orthant. Consequently, the complementarity conditions (9) are satisfied for given \u03b7\u2217 and the corresponding xw\u2217ij . Hence, the optimal link flow is obtained by Eq. (11).\nHaving determined xw\u2217ij as a function of \u03b7 w\u2217 i , \u03b7 w\u2217 j and c w\u2217 ij also in the primal TAP, we can substitute that into the Lagrangian (10) to obtain the corresponding Lagrangian dual and the dual traffic assignment problem (DTAP).\n[DTAP]\nmax \u03b7\nG = \u2211\n(i,j)\u2208E \u2211 w\u2208W\n[\u222b \u2211 w\u2032\u2208W q w\u2032xw \u2032\u2217 ij\n0 cwij(tij(m))dm+ q wFwij (x w\u2217 ij )\n]\n\u2212 \u2211\n(i,j)\u2208E \u2211 w\u2208W qw ( \u03b7wi \u2212 \u03b7wj ) xw\u2217ij \u2212 \u2211 v\u2208V \u2211 w\u2208W qw\u03b7wv b w v (13)\nWe note that DTAP is unconstrained with the node potentials \u03b7 being the only decision variables. This allows us to adapt existing fast algorithms for solving the DTAP. The closed-form network\nloading expression (11), allows us to directly obtain the corresponding individual flows. The following lemma shows that the strong duality condition holds, such that solving the dual problem is equivalent to solving the primal TAP (7).\nLemma 1 (Strong duality). The duality gap between the primal problem TAP (7) and the corresponding dual problem at their optimal solutions is zero.\nProof. The primal TAP (7) is convex, the constraints (7b)-(7c) are linear, and optimal solution x\u2217 exists. Then we need only to verify the weak Slater\u2019s condition (Boyd et al., 2004, Section 5.2.3), namely that\n\u2203xw \u2208 R|E| : \u2212xw \u2264 0, Axw \u2212 bw = 0,\u2200w \u2208 W.\nHowever, this condition is satisfied by the flow determined by all-or-nothing (shortest path) assignment. We conclude that the duality gap is zero and thus that strong duality holds.\nFinally, we need to verify that the DTAP admits a solution, such that we can always use the\nunconstrained DTAP to solve the perturbed utility-based stochastic traffic assignment problem.\nLemma 2 (Existence of DTAP). The DTAP (13) admits at least one solution \u03b7\u2217.\nProof. By Proposition 2, the optimal flow xw\u2217ij exists uniquely and link costs c w kj(tij(x \u2217 ij))+(F w ij ) \u2032(xw\u2217kj ) are positive and bounded. Hence, by the RHS of the complementarity (9), \u03b7w\u2217k is bounded up to a constant \u03b7wdw . In addition, for the given x w\u2217 ij , DTAP (13) reduces to a linear program. We conclude that DTAP admits a solution \u03b7\u2217 for any given constant \u03b7wdw ."
        },
        {
            "heading": "5. Solution method",
            "text": "In this section, we propose a fast algorithm for solving the dual assignment problem (13). In contrast to the existing primal algorithms that solve for optimal link flows as a constrained optimization problem, the proposed dual approach solves for the Lagrangian multipliers (interpreted as the minimum perceived costs) in an unconstrained optimization problem. In addition to avoiding constraints, the dual problem has the advantage that the number of decision variables is smaller, since the number of nodes is typically less than half the number of links in a road network (|V|/|E| \u2264 0.5).\nAccelerated gradient descent (AGD) (Beck and Teboulle, 2009) is a first-order method with an additional Nesterov momentum (Nesterov, 1983) step for extrapolation, which has demonstrated its usefulness for solving origin-based Markovian traffic equilibrium problems (Oyama et al., 2022). Oyama et al. (2022) require a backtracking procedure to successively reduce the step size in order to obtain algorithm convergence. This means each iteration requires several runs of network loading to select the step size, which is computationally costly for large networks. Moreover, the convergence trajectory in the original AGD often oscillates at later iterations, which reduces the speed of the\nalgorithm. We propose a quasi-Newton accelerated gradient descent algorithm (qN-AGD*), which uses the AGD* scheme (Chambolle and Dossal, 2015) to reduce oscillation, and uses the Hessian diagonal to automatically scale the gradient in a quasi-Newton manner with fixed step size, without the need for a backtracking procedure.\nRecall that the optimal link flows (11) depend on the type-specific link costs cw\u2217ij . However, these in turn depend on the link flows through the link travel time functions tij . To tackle this problem, existing primal algorithms adapt the Gauss-Seidel approach, which decomposes the assignment problem for each origin-based network flow and iteratively solves these subproblems (e.g., Dial, 2006; Nie, 2010). In contrast, we consider all the node potential variables as one block of variables, while the link travel times are considered as another separate block of variables. Thus the assignment problem is decomposed into only two subproblems. This exploits that all node potentials \u03b7 can be updated in parallel, while the link travel times t can be updated subsequently.\nWe cast the link travel time problem as an auxiliary fixed-point problem for given \u03b7.\ntij = tij (\u2211 w\u2208W qw \u00b7 (Fw\u2032ij )\u22121 ( \u03b7w\u2217i \u2212 \u03b7w\u2217j \u2212 cw\u2217ij ))\nwith corresponding residual function\nUij(x \u2217 ij , t \u2217 ij) = tij (\u2211 w\u2208W qwxw\u2217ij ) \u2212 t\u2217ij = 0\nWe find that the fixed-point t\u2217 exists.\nProposition 4. Under Assumption 4, the fixed point t\u2217ij , (i, j) \u2208 E exists. Proof. By Proposition 2, type-specific link flows xw\u2217ij exist uniquely. Hence, link flows x \u2217 ij =\u2211\nw\u2208W x w\u2217 ij are also unique. The strict monotonicity of the link travel time functions tij(xij) then\nimplies that the fixed point t\u2217ij = tij(x \u2217 ij) exists.\nWe now propose the following dual assignment algorithm, combining the AGD* algorithm with\na quasi-Newton gradient scaling, as well as a Newton step for updating link travel times.\nAlgorithm 1 Dual assignment algorithm \u2013 qN-AGD*\nStep 0: Initialization. Input initial points \u03b7(0) and c\u2217(0), and step sizes \u03b31, \u03b32, set iteration counter m = 0, momentum acceleration variable r0 = 1 and momentum acceleration parameter \u03b1 > 1 .\nStep 1: Iteration. Step 1.1. - PURC assignment :\nx w\u2217(m+1) ij = min\n{ 1, (Fw \u2032 ij ) \u22121 ( \u03b7 w(m) i \u2212 \u03b7 w(m) j \u2212 c w\u2217(m) ij )} . (14)\nStep 1.2. - Update Lagrangian multipliers \u03b7, with Nesterov\u2019s momentum acceleration:\n\u03b7\u0303 w(m+1) j = \u03b7 w(m) j + \u03b31\u2207\u0303\u03b7wj G(\u03b7 (m)), (15a) \u03b7 w(m+1) j = \u03b7\u0303 w(m+1) j + m\nm+ \u03b1\n( \u03b7\u0303 w(m+1) j \u2212 \u03b7\u0303 w(m) j ) . (15b)\nStep 1.3. - Update auxiliary link travel times t\u2217 and cw\u2217, by one Newton step:\nt \u2217(m+1) ij = t \u2217(m) ij \u2212 \u03b32\nUij ( x w\u2217(m+1) ij , t \u2217(m) ij ) \u2207t\u2217ijUij ( x w\u2217(m+1) ij , t \u2217(m) ij\n) . (16) In addition, update link cost:\ncw\u2217(m+1) = cw ( t \u2217(m+1) ij ) . (17)\nStep 2: Convergence test. If the stopping criteria hold, stop. Otherwise, set m = m + 1 and go to Step 1.\nBoth AGD and AGD* employ the Nesterov momentum acceleration method, while mainly differing in the momentum updating scheme for rm+1. Compared to the AGD, AGD* Eq. (15) uses a smaller extrapolation step, which is often slower at early iterations but has the advantage of avoiding potential oscillation when approaching convergence (Chambolle and Dossal, 2015). We will perform numerical experiments to illustrate the superior performance of the AGD* to AGD in the following section.\nNext, we will show how to compute the gradient of the Lagrangian dual G(\u03b7). By the envelope theorem (Milgrom and Segal, 2002), for the given link costs c\u2217 and xw\u2217ij (by Eq. 11), the gradient of G(\u03b7) w.r.t. \u03b7wk is\n\u2207\u03b7wk G(\u03b7 (m)) = qw  \u2211 i:(i,k)\u2208E x w\u2217(m+1) ik \u2212 \u2211 j:(k,j)\u2208E x w\u2217(m+1) kj \u2212 b w k  = qw(Akx w\u2217(m+1) \u2212 bwk ). (18)\nWe further propose to scale the gradient with an upper bound of the Hessian diagonal to speed up convergence (Nie, 2012). This is often considered as a quasi-Newton method in primal deterministic assignment algorithms (e.g., Bar-Gera, 2002; Nie, 2010). The corresponding scaled gradient is\n\u2207\u0303\u03b7wk G(\u03b7 (m)) =\n\u2207\u03b7wk G(\u03b7 (m))\nqwAk ( \u2207\n\u03b7 w(m) k\n((Fwij ) \u2032)\u22121 )|E|\u00d71 , (19) where the division is performed element-wise. Note that, in the qN-AGD* algorithm, the scaled gradient (19) is used to update auxiliary node potentials \u03b7\u0303 in Eq. (15a), which makes it a quasiNewton method. This is in contrast to the AGD and AGD* algorithms which are first-order methods that do not utilize any Hessian.\nFor the auxiliary fixed-point problem, we apply a Newton step (16) for updating the travel\ntimes. The gradient of Uij is\n\u2207c\u2217ijUij = \u2202cij \u2202xij \u2211 w\u2208W qw\u2207 c w\u2217(m) ij ((Fwij ) \u2032)\u22121. (20)\nWe note that the resulting dual assignment algorithm (qN-AGD*) resembles the coordinate descent method, whose convergence properties are well-established (Tseng, 2001). Furthermore, Step 1.1. takes an additional projection of x w\u2217(m+1) ij onto x w\u2217(m+1) ij \u2264 1, corresponding to the feasible network\nflows of a traveler. Consequently, the gradient of \u03b7wk (Eq. 18) is clipped at q w( \u2211\n(i,j)\u2208E aij \u2212 bwk ). As shown in Zhang et al. (2019), as the local Lipschitz constants are often larger at early iterations, gradient clipping can accelerate algorithm convergence by adaptively scaling the gradient (to the clipped values), such that the global Lipschitz smoothness assumption can be relaxed. To this end, gradient clipping is applied at the early iterations (e.g., first 100), while it allows us to use a relatively large fixed step size without the need for a backtracking line search.\nWe consider the algorithm to have converged when the following two criteria both hold:\nR (m+1) 1 = \u2211 w\u2208W qw Q ||Axw\u2217(m+1) \u2212 bw||1 |V| \u2264 \u03f51 and R2 = ||t ( xw\u2217(m+1) \u00b7 q|W|\u00d71 ) \u2212 t\u2217(m+1)||1 |E| \u2264 \u03f52,\nwhere || \u00b7 ||1 denotes the L1-norm, total demand is Q = \u2211 w\u2208W q w, and t(\u00b7) is the vector function for link travel times depending on link flows. R1 is the mean absolute error of the first-order condition for \u03b7\u2217 weighted by demands, and R2 is the mean absolute error of t \u2217 to the auxiliary fixed point."
        },
        {
            "heading": "5.1. Entropy perturbation function",
            "text": "We now illustrate the gradient computations for the entropy perturbation function proposed in Fosgerau et al. (2022):\nFwij (x w ij) = (1 + x w ij) ln(1 + x w ij)\u2212 xwij , \u2200(ij) \u2208 E , w \u2208 W. (21)\nThe optimal link flows are\nxw\u2217ik = [exp (\u03b7 w\u2217 i \u2212 c\u2217ik \u2212 \u03b7w\u2217k )\u2212 1] + . (22)\nThe scaled gradient \u2207\u0303\u03b7wk g(\u03b7 (m)) simplifies to\n\u2207\u0303\u03b7wk G(\u03b7 (m)) =\nAkx w\u2217(m+1) \u2212 bwk Ak \u2299Ak ( x w\u2217(m+1) ij + 1 )|E|\u00d71 , (23) where \u2299 is the Hadamard (element-wise) product. The gradient \u2207c\u2217ijUij is\n\u2207c\u2217ijUij = \u2212 \u2202cij \u2202xij \u2211 w\u2208W qw ( x w\u2217(m+1) ij + 1 ) \u03b4wij \u2212 1, (24)\nwhere \u03b4wij = 1 if x w\u2217(m+1) ij > 0, and \u03b4 w ij = 0, otherwise."
        },
        {
            "heading": "6. Numerical experiments",
            "text": "In this section, we demonstrate the performance of our proposed dual assignment algorithm through a series of numerical experiments.\nWe use the entropy perturbation function (21), we initialize \u03b7(0), c\u2217(0) with the costs from on all-or-nothing assignment not including the perturbation term, set the momentum acceleration parameter to \u03b1 = 10, and the stopping criteria parameters to \u03f51 = \u03f52 = 10 \u22125. We specify the link cost function simply as cij(xij) = 0.5tij(xij), where tij is the Bureau of Public Roads (BPR) volume-delay function. For the proposed qN-AGD* algorithm, we fix the step sizes as \u03b31 = 0.5, \u03b32 = 1, which provide satisfactory performance in all numerical experiments. For reference, we also tested the performances of the AGD method (Beck and Teboulle, 2009; Oyama et al., 2022), the AGD* method (Chambolle and Dossal, 2015), and a primal algorithm based on three-operator splitting (Davis and Yin, 2017, TOS), which allows efficient gradient projection for the primal formulation. For each reference algorithm, we report the best convergence result among step size choices of {10\u22124, 10\u22125, 10\u22126}. All algorithms are implemented in PyTorch to enable GPU computation and run on a HPC cluster with an A100 GPU. The real networks are obtained from Bar-Gera (2016), with the default volume-delay functions and demand matrix as provided."
        },
        {
            "heading": "6.1. Convergence performance at different demand levels",
            "text": "We begin by comparing the convergence performance of the proposed qN-AGD* algorithm to the qN-AGD, AGD* and AGD algorithms, under three demand levels (1q, 1.5q, 2q). For this comparison, we use the Sioux Falls network, which has 76 links, 24 nodes, 528 OD pairs and 360,600 trips (1q). The key difference between the original AGD and our algorithm AGD* as defined in\nAlgorithm 1 is that the AGD uses a different momentum, which is rm+1 = 0.5(1+ \u221a 1 + 4r2m) (Beck and Teboulle, 2009).\nFigure 1 shows the convergence of the first-order gap R1 for the four algorithms, under three demand levels. The proposed qN-AGD* algorithm is the fastest of the four algorithms at any demand level: the qN-AGD* under 2q demand is even faster than AGD* at 1q demand. In addition, the qN-AGD* runtime at different demand levels only has small variations, which suggests the proposed qN-AGD* has the potential to work well also for congested networks. The qN-AGD is generally second best, which indicates that the quasi-Newton scaling is important. Among AGD* and AGD, AGD* is faster for higher precision solutions (e.g., with R1 = 10 \u22125), while AGD is faster for lower precision (e.g., with R1 = 10 \u22122). This is because AGD* avoids oscillation with a more conservative updating scheme (\u03b1 > 3), which might be slower at the earlier iterations than AGD\n(approximated by \u03b1 = 3) (Liang et al., 2022).\nFigure 2 shows the convergence of the objective to the true value for the four dual algorithms and (in addition)the primal TOS algorithm, under three demand levels. The primal TOS algorithm is our point of reference for the four dual algorithms (qN-AGD*, qN-AGD, AGD*, and AGD). In this experiment, all four dual algorithms converge to the optimal objective value, while the TOS has not converged after 10,000 iterations. Comparing the four dual algorithms, the qN-AGD* is the fastest to reach the optimal objective value, with no oscillation observed in its convergence\ntrajectory under any demand level. Similarly, qN-AGD is faster than first-order AGD and AGD*, but exhibits oscillation as in the case of AGD. These results are consistent with the finding in the literature that the AGD* algorithm reduces the oscillation behavior of the original AGD."
        },
        {
            "heading": "6.2. Runtime performance with different network sizes",
            "text": "Given the superior performance of the dual algorithms compared to the primal algorithm, we focus on examining the performance of the dual algorithms for networks with sizes ranging from small to large in this subsection. We consider the default demand matrix (1q) for all the test networks, and the results are summarized in Table 1.\nWe find that our qN-AGD* algorithm converges within a few seconds with the small to medium sized networks. For large networks like Berlin central areas and Chicago sketch we find also very satisfactory runtimes (within 100 seconds). Meanwhile, the runtime performance of qN-AGD is comparable to that of qN-AGD*, but slower. In contrast, AGD* and AGD are at least 20 times slower than qN-AGD* and qN-AGD in medium to large networks. Furthermore, in general, the runtime of AGD* and AGD increases superlinearly with respect to problem size. We note that the runtime for the Anaheim network is shorter in all four algorithms, compared to other networks with similar size. This could be related to the congestion level in the default network setups."
        },
        {
            "heading": "6.2.1. Runtime performance at different network sizes and demand levels",
            "text": "In this subsection, we systematically evaluate the computational efficiency of the proposed qNAGD* algorithm and the qN-AGD (which exhibits similar performance) in real-size networks at different demand levels. We here do not consider AGD* and AGD as they clearly showed inferior convergence.\nAs shown in Figure 3, we construct the grid test networks as proposed in Oyama et al. (2022) by joining blocks of grids, to exemplify the effects of network size and demand levels on runtime performance. We assume the BPR function tij = tij,0 ( 1 + 0.15(\nxij \u03baij\n)4 ) with free-flow travel time\ntij,0 = 1, link capacity \u03baij = 5,000, and link length lij = 1, for all links (i, j) \u2208 E . For each origin\no, the demand for each destination d \u2208 D is assumed to follow the gravity model:\nqdo = q \u00b7 exp(tod,0)\u2211\nd\u2208D\\o exp(tod,0) ,\u2200o \u2208 O,\nwhere tod,0 is the shortest free-flow travel time between OD pair od, and q is the total trips generated from each origin.\nAn indicator for the size of the assignment problem is the number of decision variables, i.e., the number of nodes times the number of traveler types. As shown in Figure 4, we find the runtime depends about linearly on the problem size. This suggests that our proposed algorithm will scale well to larger networks. Furthermore, the runtime only increases slightly with increasing demands. Note that the grid test networks are congested under our setting. This result further suggests that our proposed algorithm is suitable also for congested networks."
        },
        {
            "heading": "7. Conclusion",
            "text": "This paper has proposed the perturbed utility stochastic traffic assignment model and an accompanying accelerated gradient-based algorithm based on the equivalent dual formulation of the traffic assignment problem. The dual assignment problem is unconstrained with closed-form stochastic network loading, which helps to make our proposed qN-AGD* algorithm very fast.\nOur simulation evidence suggests that our proposed algorithm will scale well to larger problems. This is important for making the perturbed utility route choice model competitive with other route choice models for large-scale applications. This is also valuable, as the perturbed utility route choice model has several significant advantages over other route choice models. In particular, it does not require any choice set generation but simply uses the complete network as it is. It generates realistic substitution patterns directly from the network structure. Most of the network is inactive for any origin-destination pair. Not least, it is fast and easy to estimate using linear regression."
        }
    ],
    "title": "Perturbed utility stochastic traffic assignment",
    "year": 2023
}
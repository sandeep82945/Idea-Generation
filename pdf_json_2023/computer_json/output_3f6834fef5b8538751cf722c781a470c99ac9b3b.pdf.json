{
    "abstractText": "Objective: Develop low-order mechanistic models accounting quantitatively for, and identifiable from, the capnogram \u2014 the CO2 concentration in exhaled breath, recorded over time (Tcap) or exhaled volume (Vcap). Methods: The airflow model\u2019s single \u201calveolar\u201d compartment has compliance and inertance, and feeds a resistive unperfused airway comprising a laminarflow region followed by a turbulent-mixing region. The gas-mixing model tracks mixing-region CO2 concentration, which is fitted breath-by-breath to the measured capnogram, yielding estimates of model parameters that characterize the capnogram. Results: For the 17 examined records (310 breaths) of airflow, airway pressure and Tcap from ventilated adult patients, the models fit closely (mean rmse 1% of end-tidal CO2 concentration on Vcap; 1.7% on Tcap). The associated parameters (4 for Vcap, 5 for Tcap) for each exhalation, and airflow parameters for the corresponding forced inhalation, are robustly estimated, and consonant with each other and literature values. The models also allow, using Tcap alone, estimation of the entire exhaled airflow waveform to within a scaling. This suggests new Tcap-based tests, analogous to spirometry but with normal breathing, for discriminating chronic obstructive pulmonary disease (COPD) from congestive heart failure (CHF). A version trained on 15 exhalations from each of 24 COPD/24 CHF Tcap records from one hospital, then tested 100 times with 15 random exhalations from each of 27 COPD/31 CHF Tcap records at another, gave mean accuracy 80.6% (stdev 2.1%). Another version, tested on 29 COPD/32 CHF, yielded AUROC 0.84. Conclusion: Our mechanistic models closely fit Tcap and Vcap measurements, and yield subject-specific parameter estimates. Significance: This can inform cardiorespiratory care.",
    "authors": [
        {
            "affiliations": [],
            "name": "Elizabeth K. Murray"
        },
        {
            "affiliations": [],
            "name": "Carine X. You"
        },
        {
            "affiliations": [],
            "name": "Baruch S. Krauss"
        },
        {
            "affiliations": [],
            "name": "Thomas Heldt"
        }
    ],
    "id": "SP:1f2fc9c4d1bd87b8d62cf5631a4332ff751dc4a3",
    "references": [
        {
            "authors": [
                "M.B. Jaffe",
                "\u201cInfrared measurement of carbon dioxide in the human breath"
            ],
            "title": "breathe-through\u2019 devices from Tyndall to the present day",
            "venue": "Anesthesia & Analgesia, vol. 107, no. 3, pp. 890\u2013904, Sep. 2008.",
            "year": 2008
        },
        {
            "authors": [
                "C. Bohr"
            ],
            "title": "Ueber die lungenathmung",
            "venue": "Skandinavisches Archiv F\u00fcr Physiologie, vol. 2, no. 1, pp. 236\u2013268, 1891.",
            "year": 1891
        },
        {
            "authors": [
                "W.S. Fowler"
            ],
            "title": "Lung function studies II: The respiratory dead space",
            "venue": "American J. Physiology, vol. 154, no. 3, pp. 405\u2013416, Sep. 1948.",
            "year": 1948
        },
        {
            "authors": [
                "R. Fletcher"
            ],
            "title": "The concept of deadspace with special reference to the single breath test for carbon dioxide",
            "venue": "British J. Anaesthesia, vol. 53, no. 1, pp. 77\u201388, Jan. 1981.",
            "year": 1981
        },
        {
            "authors": [
                "S. Verscheure"
            ],
            "title": "Volumetric capnography: lessons from the past and current clinical applications",
            "venue": "Critical Care, vol. 20, no. 1, p. 184, Jun. 2016.",
            "year": 2016
        },
        {
            "authors": [
                "G. Tusman",
                "S. Bohm"
            ],
            "title": "Clinical monitoring by volumetric capnography",
            "venue": "Cardiopulmonary Monitoring, S. Magder et al., Eds. Springer Nature, 2021, pp. 601 \u2013 617.",
            "year": 2021
        },
        {
            "authors": [
                "W. Karlen"
            ],
            "title": "CapnoBase InVivo Dataset",
            "venue": "2021. [Online]. Available: https://doi.org/10.5683/SP2/7JTWDZ",
            "year": 2021
        },
        {
            "authors": [
                "W. Karlen"
            ],
            "title": "CapnoBase: Signal database and tools to collect, share and annotate respiratory signals",
            "venue": "Annual Meeting of the Society for Technology in Anesthesia, Jan. 2010.",
            "year": 2010
        },
        {
            "authors": [
                "G. Tusman"
            ],
            "title": "Model fitting of volumetric capnograms improves calculations of airway dead space and slope of Phase III",
            "venue": "J. Clinical Monitoring and Computing, vol. 23, no. 4, pp. 197\u2013206, Jun. 2009.",
            "year": 2009
        },
        {
            "authors": [
                "M.B. Jaffe"
            ],
            "title": "Using the features of the time and volumetric capnogram for classification and prediction",
            "venue": "Journal of Clinical Monitoring and Computing, vol. 31, no. 1, pp. 19\u201341, Feb. 2017.",
            "year": 2017
        },
        {
            "authors": [
                "B. You"
            ],
            "title": "Expiratory capnography in asthma: evaluation of various shape indices",
            "venue": "European Respiratory Journal, vol. 7, no. 2, pp. 318\u2013 323, Feb. 1994.",
            "year": 1994
        },
        {
            "authors": [
                "R.J. Mieloszyk"
            ],
            "title": "Automated quantitative analysis of capnogram shape for COPD\u2013Normal and COPD\u2013CHF classification",
            "venue": "IEEE Trans. Biomedical Engineering, vol. 61, no. 12, pp. 2882\u20132890, Dec. 2014.",
            "year": 2014
        },
        {
            "authors": [
                "D. Bhagya",
                "S. Manikandan"
            ],
            "title": "Speed of sound-based capnographic sensor with second-generation CNN for automated classification of cardiorespiratory abnormalities",
            "venue": "IEEE Sensors Journal, vol. 19, pp. 8887\u20138894, June 2019.",
            "year": 2019
        },
        {
            "authors": [
                "H. Benallal",
                "T. Busso"
            ],
            "title": "Analysis of end-tidal and arterial PCO2 gradients using a breathing model",
            "venue": "European J. Applied Physiology, vol. 83, no. 4, pp. 402\u2013408, Nov. 2000.",
            "year": 2000
        },
        {
            "authors": [
                "C.E.W. Hahn",
                "A.D. Farmery"
            ],
            "title": "Gas exchange modelling: no more gills, please",
            "venue": "British Journal of Anaesthesia, vol. 91, pp. 2\u201315, 2003.",
            "year": 2003
        },
        {
            "authors": [
                "J.O.D. Buijs"
            ],
            "title": "Bayesian tracking of a nonlinear model of the capnogram",
            "venue": "IEEE Engineering in Medicine and Biology Conf., Aug. 2006, pp. 2871\u20132874.",
            "year": 2006
        },
        {
            "authors": [
                "A. Abid"
            ],
            "title": "Model-based estimation of respiratory parameters from capnography, with application to diagnosing obstructive lung disease",
            "venue": "IEEE Trans. Biomedical Engineering, vol. 64, no. 12, pp. 2957\u20132967, Dec. 2017.",
            "year": 2017
        },
        {
            "authors": [
                "E. Karasan"
            ],
            "title": "An enhanced mechanistic model for capnography, with application to CHF-COPD discrimination",
            "venue": "IEEE Engineering in Medicine and Biology Conf., Jul. 2018, pp. 5267\u20135272.",
            "year": 2018
        },
        {
            "authors": [
                "E.R. Weibel"
            ],
            "title": "Morphometry of the Human Lung",
            "year": 1963
        },
        {
            "authors": [
                "C. Hsia"
            ],
            "title": "Lung structure and the intrinsic challenges of gas exchange",
            "venue": "Comprehensive Physiology, vol. 6, pp. 827\u2013895, 2016.",
            "year": 2016
        },
        {
            "authors": [
                "C. Kleinstreuer",
                "Z. Zhang"
            ],
            "title": "Airflow and particle transport in the human respiratory system",
            "venue": "Annual Review of Fluid Mechanics, vol. 42, no. 1, pp. 301\u2013334, 2010.",
            "year": 2010
        },
        {
            "authors": [
                "T. Gemci"
            ],
            "title": "Computational model of airflow in upper 17 generations of human respiratory tract",
            "venue": "J. Biomechanics, vol. 41, no. 9, pp. 2047\u2013 2054, Jan. 2008.",
            "year": 2008
        },
        {
            "authors": [
                "L. Ball"
            ],
            "title": "Respiratory mechanics during general anaesthesia",
            "venue": "Annals of Translational Medicine, vol. 6, pp. 379\u2013384, 2018.",
            "year": 2018
        },
        {
            "authors": [
                "C. Young"
            ],
            "title": "Lung-protective ventilation for the surgical patient: international expert panel-based consensus recommendations",
            "venue": "British J. Anaesthesia, vol. 123, pp. 898\u2013913, 2019.",
            "year": 2019
        },
        {
            "authors": [
                "T. Woo"
            ],
            "title": "A comparison of various respiratory system models based on parameter estimates from impulse oscillometry data",
            "venue": "IEEE Engineering in Medicine and Biology Conf., vol. 5, Feb. 2004, p. 3828.",
            "year": 2004
        },
        {
            "authors": [
                "F. Vicario"
            ],
            "title": "Noninvasive estimation of respiratory mechanics in spontaneously breathing ventilated patients: A constrained optimization approach",
            "venue": "IEEE Trans. Biomedical Engineering, vol. 63, pp. 775\u2013787, 2016.",
            "year": 2016
        },
        {
            "authors": [
                "B.L. Graham"
            ],
            "title": "Standardization of spirometry",
            "venue": "American J. Respiratory and Critical Care Medicine, vol. 200, pp. e70 \u2013 e88, 2019.",
            "year": 2019
        },
        {
            "authors": [
                "K. Tor\u00e9n"
            ],
            "title": "Vital capacity and COPD: the Swedish CArdioPulmonary bioImage Study (SCAPIS)",
            "venue": "International Journal of Chronic Obstructive Pulmonary Disease, vol. 11, pp. 927\u2013933, 2016.",
            "year": 2016
        },
        {
            "authors": [
                "P.M. Bossuyt"
            ],
            "title": "STARD 2015: an updated list of essential items for reporting diagnostic accuracy studies",
            "venue": "BMJ, vol. 351, 2015.",
            "year": 2015
        }
    ],
    "sections": [
        {
            "text": "Index Terms\u2014capnography, respiratory model, deadspace, ventilators, spirometry\nI. INTRODUCTION\nCAPNOGRAPHY records the partial pressure of exhaledCO2 (PeCO2) as a function of time (temporal capnography, Tcap) or exhaled volume (volumetric capnography, Vcap), [1] [2]. Tcap can be easily obtained, with the subject breathing normally while a continuous sample of the exhaled breath is drawn into the instrument \u2014 the capnograph \u2014 through a nasal cannula. This is known as a sidestream\nE. K. Murray and C. X. You contributed equally to this work. EKM and CXY were, and G. C. Verghese currently is, with the Research Laboratory of Electronics and the EECS Department, Massachusetts Institute of Technology (MIT), Cambridge, MA, USA. EKM is now with the EECS Department, UC Berkeley, CA, USA, and CXY with the Department of Economics, MIT.\nB. S. Krauss is with the Division of Emergency Medicine, Boston Children\u2019s Hospital, and also with the Department of Pediatrics, Harvard Medical School, Boston, MA, USA.\nT. Heldt is with the Institute for Medical Engineering and Science, and the EECS Department, MIT.\nconfiguration. (The inhaled breath is also sampled, but is not of clinical or physiological interest.) The CO2 partial pressure1 of the sample is measured in the capnograph as a function of time, typically using an infrared sensor. Tcap is routinely used in many clinical settings \u2014 including the operating room, intensive care unit, emergency department, and ambulance service \u2014 to monitor ventilation, determine respiratory rate, and measure end-tidal CO2 partial pressure (EtCO2).\nVcap is uncommon in the clinical setting, as it requires capturing and measuring the entire expired airflow, with CO2 partial pressure typically measured close to the mouth, in the main external tubing; this is the mainstream configuration. CO2 partial pressure can instead be measured on gas sampled sidestream from the main tubing.\nVcap is primarily used in the pulmonary function laboratory, or in surgical or intensive-care settings with mechanically ventilated patients, and is derived from simultaneous recordings of Tcap and airflow. The pressure at the mouth (or \u201cairway pressure\u201d) may also be recorded, and will often not be atmospheric pressure even during exhalation. The main clinical application of Vcap, beyond what Tcap provides, is for evaluating ventilation and gas exchange, which are reflective of deadspace (i.e., unperfused lung volumes), cardiac output, metabolic status, and related variables [3]\u2013[7]."
        },
        {
            "heading": "A. Tcap and Vcap from ventilator data",
            "text": "For orientation, Fig. 1(a) shows temporal waveforms of airflow, airway pressure, and CO2 partial pressure at the airway2, for one respiratory cycle of a ventilated adult surgical patient under anesthesia, from the CapnoBase database [8] [9].\nThe initial portion of these waveforms corresponds to the start of an inhalation, with the ventilator-controlled flow going negative and holding essentially constant for most of the inhalation, till 2.1 s in the figure, while the airway pressure at the mouth increases. The inhaled gas is essentially CO2free, so the corresponding segment of the capnogram, with no discernible delay, begins its descent to 0 mmHg from the peak value of around 27 mmHg that it had at the end of the previous exhalation (i.e., end-tidal CO2 or EtCO2).\nWhen inhalation ends at 2.1 s, (passive) exhalation begins and the flow changes to positive. Peak airflow is reached very\n1See Supplementary Material to review the relationship of partial pressure to concentration.\n2Measured sidestream, but with built-in correction in the instrument for time delay and deformation relative to mainstream sensing.\nCopyright (c) 2023 IEEE. Personal use of this material is permitted. However, permission to use this material for any other purposes must be obtained from the IEEE by sending an email to pubs-permissions@ieee.org.\nThis work is licensed under a Creativ Commons Attribution 4.0 License. For more information, see https://creativecommons.org/licenses/by/4.0/\n2 (a) (b)\nFig. 1. (a) Temporal waveforms of CO2 partial pressure (black, in mmHg), airflow (red, in deciliters/s), and airway pressure (blue, in mmHg) in a ventilated adult patient during surgery (exhalation #2 of record 365A in [8]). (b) Vcap plot of PeCO2 versus expired volume for this exhalation, parameterized along the curve by time t from the start of exhalation at 2.1 s.\nsoon after, and airflow then decays to essentially 0 before the next inhalation begins.\nMeasured PeCO2 remains at 0 mmHg for 0.2 s after the start of exhalation, then begins to rise at 2.3 s, as CO2 -rich alveolar gas progressively mixes in with previously inhaled air and arrives at the CO2 sensor. PeCO2 finally reaches a value that reflects the mean CO2 partial pressure in alveolar gas, typically 25\u201350 mmHg (27 mmHg here), somewhat lower than the CO2 partial pressure in the pulmonary circulation. Factors such as noise in the measurement, uneven emptying of the alveoli, and unsteadiness in the flow near the end of the exhalation can make the rise non-monotonic.\nIntegrating the exhaled airflow waveform with respect to time on any particular exhalation, and choosing the start of the exhalation as the time origin t = 0, yields the cumulative exhaled volume V (t) up to time t in that exhalation \u2014 with the value at the end of the exhalation being the tidal volume, VT . With this notation, airflow is the time-derivative V\u0307 (t). Plotting PeCO2(t) as a function of V (t) then yields the volumetric capnogram Vcap, as shown in Fig. 1(b) for the exhalation in Fig. 1(a), with VT = 610mL, and parameterized along the curve by time t from the start of exhalation (at 2.1 s)."
        },
        {
            "heading": "B. Prior work on modeling Tcap and Vcap",
            "text": "The Tcap and Vcap literatures have been fairly disjoint, but both have focused on extracting landmark features of capnogram morphology \u2014 e.g., slopes, points of inflection or intersection, abscissas and ordinates corresponding to these, and various associated areas \u2014 with the aid of piecewiselinear fits to various segments of the capnogram or, in the case of [10] for example, functional fits to the full capnogram by a sum of linear and logistic functions (not derived from any consideration of the underlying physiology). These features are then associated or correlated with particular phases, processes, parameters, and pathologies of respiration [11].\nThe interest in capnogram morphology is partly because particular cardiorespiratory conditions tend to be associated with characteristic capnogram shapes, e.g., Tcap from patients with chronic obstructive pulmonary disease (COPD) tends to have a \u201cshark\u2019s fin\u201d appearance [12]. Thus, analysis of capnogram shape has diagnostic utility. We showed in earlier\nwork [13] that simple machine-learning algorithms (specifically, quadratic discriminant analysis) operating on just 4 Tcap waveform features from each of 80 exhalations in a record can distinguish between patients with congestive heart failure (CHF) and those with COPD, with accuracies around 75\u201380%. Some recent work using machine-learning methods, [14] and related papers by the same authors, reports significantly better results for this task, but differences in data selection/labeling make comparison with [13] difficult.\nTcap suffices to determine respiratory rate and EtCO2 . Beyond these, the main clinically relevant parameters inferred from Vcap are the anatomical and physiological deadspace volumes. Anatomical deadspace corresponds to the portion of the respiratory tract that contains no alveoli, namely the conducting upper airway. Physiological deadspace corresponds to alveolar regions that are not perfused (for a variety of pathophysiological reasons). The classical modeling calculations for estimating the deadspaces involve tracking CO2 mass balance in various compartments at two or three discrete epochs of respiration [3] [4] [7].\nMost prior work on modeling Tcap and Vcap stops well short of close quantitative accounting of the entire capnogram trace using a model that (i) mechanistically reflects dominant aspects of the underlying anatomical and physiological parameters and processes, and (ii) is identifiable from the capnogram alone, for a subject-specific representation of the capnogram. Our work addresses this need.\nThe papers [15]\u2013[17] point in the required direction with their continuous rather than discrete tracking of CO2 mass in anatomically and physiologically relevant compartments over a tidal breathing cycle, using coupled differential equations. Of these references, only [17] is aimed at modeling the full capnogram; assuming known airflow, the model can synthesize Tcap (and in principle Vcap, though this is not explicitly studied). The paper presents a particle-filtering approach to estimating model parameters, illustrated with simulated data for a sinusoidally varying airflow.\nOur previous work [18] [19] on mechanistic modeling of the capnogram was in the spirit of [17], but aimed at modeling sidestream Tcap with no accompanying airflow measurements. A first- or second-order differential equation for the airflow\nThis work is licensed under a Creative Commons Attribution 4.0 License. For more information, see https://creativecommons.org/licenses/by/4.0/\n3 dynamics associated with a single-\u201calveolus\u201d model described the discharge (over time t) of alveolar gas into an unperfused mixing deadspace region during exhalation. We assumed constant CO2 partial pressure pA for this alveolar gas over the entire exhalation3, ignoring secondary effects from any spatial variation of alveolar CO2 partial pressure across the lung or temporal variation over the course of the exhalation. A separate first-order differential equation described the progressive mixing of the injected alveolar gas with previously inhaled air. The waveform of rising CO2 partial pressure in the mixing region constituted Tcap in this model. Model parameters, reflecting quantities with physiological or clinical interpretation or significance, could then be estimated by numerically fitting the model\u2019s capnogram to the measured one. We demonstrated the possibility of good discrimination between COPD and CHF patients, and also those with normal respiration, using interpretable model parameters estimated from the capnogram, rather than using more generic morphological features."
        },
        {
            "heading": "C. Outline of this paper",
            "text": "This paper introduces significant refinements of our earlier model in [18] [19], to enable quantitative modeling and comparison of Vcap and Tcap in a common framework. We develop models of sufficiently low complexity to be robustly identifiable in a subject-specific way through capnography alone, yet capturing gross features of the underlying respiratory anatomy and physiology. These are necessarily highly aggregated compartmental models, as in [15]\u2013[19]. A more detailed model may better represent known respiratory anatomy and physiology, but unless its parameters can be reliably estimated from the capnogram, the parameters will not be subject-specific, and the model is unlikely to be a clinically helpful representation of the capnogram, even if useful for purposes such as simulation [15].\nImportantly, we recognize that the (unperfused) anatomical deadspace region can be separated into two sequential segments: (i) a laminar-flow region of volume VL in the lower conducting airways, through which laminar flow is largely maintained during exhalation, as alveolar gas initially forces out previously inhaled air in this region; and (ii) a turbulentmixing region of volume VM in the upper airways, which the laminar flow feeds into. The volume VL is seen in Fig. 1(b) as the initial segment of the Vcap waveform (extending to a little over 150 mL) during which PeCO2 is essentially at 0 mmHg. Tcap that has only PeCO2 measurements and no airflow or airway pressure data is unable to register this volume VL.\nA second refinement of the model here relates to the CO2 partial pressure of alveolar gas entering the mixing volume during exhalation: we now use an exponential settling to the value pA, rather than the step change used in our earlier work. The smoother transition is intended to represent in some form, in this single-\u201calveolus\u201d model, the non-uniform emptying of the alveoli into the mixing volume. This modification substantially improves the fit of the model to measured data.\nIn the first part of this paper, we focus on using these refined models to represent a much richer set of data than in\n3Fuller notation for this quantity would be pA,CO2 , but since we need only CO2 partial pressures in this paper, we drop reference to CO2 .\nour previous work, namely ventilator signals such as those in Fig. 1(a). The signals during exhalations yield Tcap and Vcap, permitting detailed quantitative comparison and validation of parameters extracted from Tcap alone against those obtained from Vcap and from the airflow and airway-pressure signals. We demonstrate that the ascending part of the Vcap waveform, beyond the volume VL and essentially all the way to VT , is well described by the same simple one-compartment mixing dynamics used in our earlier work [18] [19]. Furthermore, the flow and pressure data during the corresponding inhalations allow independent estimates of parameters of the airflow subsystem model, which we compare against those determined from Tcap and in other ways.\nWe also extract deeper information from the model than in our previous work, recognizing that:\n1) the large and small time-constants associated with the second-order airflow subsystem respectively govern the fast initial rise and subsequent slower decay of airflow during exhalation (and are associated with inertance and compliance effects respectively); and 2) the coupled gas-mixing and airflow models allow estimation of the entire exhaled airflow waveform normalized by mixing volume, namely V\u0307 (t)/VM , from Tcap alone.\nThe latter result motivates novel Tcap-based analogs of spirometry tests widely used for COPD\u2013CHF discrimination and severity assessment. While spirometry is based on airflow measurements during forced exhalation, Tcap can be recorded during normal breathing instead, which is important for measurements on adults with respiratory difficulties. We introduce and evaluate such a test in the second part of this paper."
        },
        {
            "heading": "II. MODEL DEVELOPMENT AND ANALYSIS",
            "text": ""
        },
        {
            "heading": "A. Anatomical and physiological basis",
            "text": "In setting up our model, we keep in mind Weibel\u2019s [20] [21] classical anatomical model of the lungs, idealized to\nFig. 2. Idealized Weibel lung structure [20], with successive bifurcations over 23 generations. At the start of exhalation, the perfused respiratory zone at the bottom (generations 17-23, shown in red) contains CO2 -rich alveolar gas, while the non-perfused conducting zone above is essentially CO2 -free. We model the upward flow of exhaled alveolar gas as laminar through most of the terminal bronchioles (generations 6-16, shown in blue), largely preserving the CO2 -rich/CO2 -free boundary till this arrives in the turbulent-mixing region (shown in black). The indicated nominal volumes are taken from [21].\nThis work is licensed under a Creative Commons Attribution 4.0 License. For more information, see https://creativecommons.org/licenses/by/4.0/\n4 have binary branching at each of 23 successive generations, as summarized in Fig. 2. Generations 0 through 16 constitute the unperfused conducting zone, whose aggregate volume makes up the anatomical deadspace. Beyond this, the lungs transition to the perfused alveolar or respiratory region.\nDetailed modeling and experimental studies, e.g., [22] [23], suggest that flow in the lungs is turbulent in the upper part of the conducting zone, generations 0 to 5, where there are larger and fewer vessels, with relatively high airflow velocities, hence higher Reynolds numbers. This is the region we consider to be the turbulent-mixing deadspace, with volume VM ; to keep notation and terminology simple, we shall use VM to denote both the region and its actual volume. We shall denote the partial pressure of CO2 in VM at time t by pM (t), and this waveform constitutes the synthesized Tcap in our model.\nIn contrast, flow tends to be laminar in the remainder of the conducting zone, generations 6 through 16, where there are smaller and much more numerous vessels, with correspondingly lower airflow velocities. This is what we take to be the laminar-flow deadspace region; we shall use VL to denote both the region and its actual volume.\nAt the transition from inhalation to exhalation, we expect that the boundary between (i) air at CO2 partial pressure 0 mmHg that has just been inhaled, and (ii) alveolar gas at average CO2 partial pressure pA that is about to be exhaled, lies approximately in the transition region between generations 16 and 17, not as a sharp interface, but rather with some \u201cblurring\u201d due to local diffusion (see Supplementary Material). The CO2 partial pressure in both VL and VM is 0 mmHg still.\nAs exhalation begins, what initially enters VM is the previously inhaled gas in VL, so there is initially no change in the CO2 partial pressure in VM , and pM (t) remains at 0 mmHg. As already mentioned, this initial interval of zero CO2 partial pressure is seen in Fig. 1(b), extending to around 150 mL.\nOnce this initial volume VL has emptied into the mixing region VM , the boundary layer that was previously in the transition region (between generations 16 and 17) arrives in VM , followed by alveolar gas. During the remainder of the exhalation, this alveolar gas mixes rapidly with the gas already in VM , causing the CO2 partial pressure pM (t) to rise steadily."
        },
        {
            "heading": "B. Modeling Vcap",
            "text": "To analyze Vcap, we only require the gas-mixing subsystem model, since airflow V\u0307 (t) is measured and available. We desire an expression for how pM (\u00b7) varies with exhaled volume V (t) rather than with t. We could write pM (t) = p\u0303M (V (t)) to denote this function of volume, since V (t) is a monotonically increasing function of t during exhalation. However, to avoid proliferating notation, we shall simply denote it by pM (V ), relying on context to resolve ambiguity. We shall similarly write pA(V ) for the partial pressure of the alveolar gas entering the region VM after a volume V has been exhaled.\nGas-mixing subsystem model for Vcap: The incremental change in CO2 mass in the mixing volume, for an incremental exhaled volume dV , is proportional to d ( VMpM (V ) ) , by the definition of partial pressure. This must equal the incremental mass entering the mixing volume minus that leaving, so\nd ( VMpM (V ) ) = VMdpM (V ) = ( pA(V )\u2212 pM (V ) ) dV\nor equivalently d\ndV pM (V ) = \u2212\n1\nVM pM (V ) +\npA(V )\nVM . (1)\nThis is a linear constant-coefficient first-order differential equation for the evolution of pM (V ) with V during exhalation \u2014 and hence governing Vcap. (Note that V rather than t is the independent variable in this equation, but otherwise the development is the same as in, e.g., [17].) Explicit solutions can be obtained under a variety of scenarios.\nFor the simplest case [18], [19], assume the CO2 partial pressure in VM is 0 mmHg till a volume VL has been exhaled, and that pA(V ) then steps instantaneously to some value pA for V > VL, which may be thought of as the (spatial) average partial pressure of alveolar gas at the end of the preceding inhalation. The solution of (1) is then simply\npM (V ) = pA ( 1\u2212 exp{\u2212(V \u2212VL)/VM} ) , V > VL , (2)\nsettling exponentially from 0 mmHg to pA, with settling constant VM . This was shown in [18] for the special case of VL = 0, but predicated on a particular model for airflow. We now see the solution is more general, requiring no assumption about the airflow (other than positivity).\nOur experiments have shown that (2) does not yield good fits to Vcap data, so we re-examine the assumptions of pM (VL) = 0 and a simple step increase of pA(V ). Depending on how VL is estimated (we present one choice in Section III), the actual pM (VL) may be nonzero. Also, a smoother settling of pA(V ) to a value pA may better \u2014 though still coarsely \u2014 capture inhomogeneity of the lung (including varying levels of alveolar ventilation and perfusion) that cannot be directly represented in our single-\u201calveolus\u201d model. Accordingly, the results in this paper use a slightly more elaborate model for alveolar discharge into VM , specifically\npA(V ) = pM (VL) +K ( 1\u2212 exp{\u2212(V \u2212 VL)/\u03bd} ) (3)\nfor V > VL. Now pA(V ) settles exponentially, with settling constant \u03bd, from the starting value pM (VL) to the asymptotic value pM (VL) +K. Our estimate of average alveolar partial pressure pA is the corresponding asymptote:\npA = pM (VL) +K . (4)\nThe fundamental equation (1) has a simple explicit solution in this case too (see Supplementary Material), essentially the step response of two single-pole, linear, constant-coefficient subsystems in series, where one pole is at \u22121/VM and comes from (1), and the other at \u22121/\u03bd comes from (3)."
        },
        {
            "heading": "C. Modeling Tcap",
            "text": "An instrument that generates Vcap can also generate Tcap by ignoring the airflow information in Vcap and keeping only the timing information, and this is the case with our ventilator data. Typically, however, Tcap is obtained for subjects or patients breathing normally, using sidestream capnography, and with no airflow measurement. In this setting there is insufficient information to estimate (or even recognize) VL, because Tcap stays at 0 mmHg for essentially the entire time that the volume VL is being exhaled, and for some time prior. Thus, the deadspace of consequence for Tcap is just VM .\nThis work is licensed under a Creative Commons Attribution 4.0 License. For more information, see https://creativecommons.org/licenses/by/4.0/\n5 Gas-mixing subsystem model for Tcap\nFor Tcap we convert the model (1) to evolve with time t rather than exhaled volume V . Simply multiplying both sides of (1) by V\u0307 (t)(= dV (t)/dt) gives\nd dt pM (t) = p\u0307M (t) = \u2212 V\u0307 (t) VM pM (t) + V\u0307 (t)pA(t) VM . (5)\nTaking t = 0 to be when the exhaled alveolar gas first enters VM , i.e., when V = VL, this equation holds for t > 0. This equation in related forms has appeared in other settings, see for instance [15]\u2013[17] and literature cited in these, though only [17] uses it specifically for modeling Tcap, assuming airflow V\u0307 (t) is known (Vcap is mentioned but not directly modeled).\nUsing w(t) to denote the VM -normalized exhaled volume V (t)/VM , we can rewrite (5) as\np\u0307M (t) = \u2212w\u0307(t)pM (t) + w\u0307(t)pA(t) , t > 0 . (6)\nFor a given w\u0307(t) = V\u0307 (t)/VM , (6) is a linear, time-variant, first-order state-space equation [24] in the variable pM (t), with input pA(t) (explicit solution in Supplementary Material).\nEquation (6) already suggests what Tcap can in principle accomplish even without airflow measurements: for known pM (t) and thus p\u0307M (t), (6) is a (linear) constraint on w\u0307(t) and pA(t) at each t, so given simple parametric models for w\u0307(t) and pA(t), we could hope to estimate the associated parameters from measurements of pM (t). That expectation is developed and confirmed in this paper.\nFor a parametric model of pA(t), we assumed in our prior work [18] [19] that pA(t) is a step function, rising immediately at the start of exhalation from 0 mmHg to the value pA, so only this single parameter was needed to describe pA(t). In the results reported in this paper, we use a 2-parameter alternative to the step function, to represent an exponentially settling discharge of alveolar gas into VM , with time-constant \u03f5, so\npA(t) = pA\n( 1\u2212 exp{\u2212t/\u03f5} ) . (7)\nThis is distinct from the assumption we used for pA(V ) in (3), where the partial pressure settled exponentially as a function of volume, but (7) is better adapted to modeling Tcap.\nWe now turn to obtaining a parametric model for w\u0307(t).\nAirflow subsystem model for Tcap\nWe represent the lungs as a single \u201calveolar\u201d compartment with some inertance (or mass) and compliance, connected to a resistive airway that opens to atmospheric air or, for ventilated patients, to some other airway pressure imposed at the mouth, e.g., positive end-expiratory pressure or PEEP [25] [26]. This very simple airflow model, most often without even the inertance element, is widely used to model both exhalation and inhalation [27] [28], but [17]\u2013[19] appear to be unusual in applying such a model to quantitatively analyzing and interpreting Tcap. More complex models of airflow have their uses, but we require robust identification of model parameters despite the limited richness of Tcap waveforms collected \u2014 without airflow \u2014 in clinical settings. We retain the inertance element to capture the fact that airflow does not change discontinuously, as is evident from Fig. 1(a).\nAirflow during exhalation is primarily driven by the passive relaxation of the compliant lung compartment from some initial inflated volume VI attained at the end of the preceding inhalation. We use a linear and time-invariant (LTI) model with inertance, resistance, and compliance taking constant values L, R, C respectively. The exhaled volume V (t) then satisfies\nLV\u0308 (t) +RV\u0307 (t) + 1\nC V (t) =\n1 C VI \u2212 P (t) , (8)\nfor t > 0, with V (0) = VL (given our new choice of time origin). Here P (t) denotes the pressure gradient from airway to pleural cavity, Paw(t)\u2212Ppl(t), during exhalation. For ventilated patients, the airway pressure may include a small steady PEEP applied during the later part of the exhalation, to guarantee a sufficient lung inflation at the end of exhalation. We might model this by setting Paw(t) = PPEEP(t) + rV\u0307 (t), where PPEEP(t) rises from 0 to the desired PEEP level by the end of exhalation, and r denotes the flow resistance distal to the airway pressure measurement.\nElectrical circuit analogs: It is helpful to represent (8) and (5), which respectively constitute our airflow and gasmixing subsystems, via the natural electrical circuit analogs shown in Fig. 3, see also [19]. These are obtained by mapping pressure or partial pressure to electrical potential, and airflow or CO2 flow to electrical current, and accordingly defining the other component elements, variables, and parameters. The airflow circuit is LTI but has a nonlinear coupling to the gasmixing circuit, because the resistance in the gas-mixing circuit is the reciprocal of the current in the airflow circuit (so higher airflow leads to more rapid mixing).\nNormalized airflow model: Assuming P (t) attains a constant value P towards the end of the exhalation, and that both the airflow and its derivative correspondingly settle essentially to 0, the first two terms in (8) are negligible at the end of exhalation. The total expelled volume, which is the tidal volume, is accordingly seen from (8) to be VT = VI \u2212CP as expected (because it is the initial minus final lung volume on the exhalation). To make progress, we shall approximate P (t) by the constant P for all t > 0 during the exhalation (i.e., for V (t) > VL). With this, we can rewrite (8) as\n\u03b4\u03c4w\u0308(t) + \u03c4w\u0307(t) + w(t) = \u03b1 , t > 0 , (9)\nThis work is licensed under a Creative Commons Attribution 4.0 License. For more information, see https://creativecommons.org/licenses/by/4.0/\n6 where w(t) = V (t)/VM and\n\u03b4 = L/R , \u03c4 = RC , \u03b1 = VT /VM . (10)\nThe parameter \u03b1 is the normalized tidal volume (or inverse mixing-deadspace ratio). The canonical 2nd-order LTI model in (9) has an analytical solution for given initial conditions, which should be w(0) = VL/VM , with w\u0307(0) being the normalized airflow after the volume VL has been expelled. For reasons explained in Section III (Methods), in modeling Tcap we shall use only the solution of (9) for zero initial conditions.\nFor \u03b4 \u226a \u03c4 , which is typically the case in our data, \u03b4 turns out to be approximately the time constant that governs the rapid exponential settling of airflow to its peak near the beginning of exhalation, and also of airway pressure from its peak. (The analytical demonstration of this for the case of zero initial conditions is in the Supplementary Material.) This initial phase is evident in both these waveforms in the example of Fig. 1(a), during the interval 2.1\u20132.2 s. The slower subsequent exponential decay of both airflow and airway pressure to the end of exhalation is, on the other hand, approximately governed by the time constant \u03c4 . (In airflow models that have no inertance, so L = 0 and \u03b4 = 0, the modeled airflow rises instantly to its peak at the start of exhalation, decaying exponentially from there with time-constant \u03c4 .) Thus, fitting a sum of two exponentials to the airflow or airway-pressure waveform during exhalation allows estimation of \u03b4 and \u03c4 (see Supplementary Material related to Section IV.B) \u2014 but given only Tcap, one has to proceed differently.\nIf we consider Tcap as providing a measurement of pM (t), then in view of the constraint in (6) that results from the gasmixing subsystem, we are in a position to attempt identification of our parameterized models (9) for w\u0307(t) and (7) for pA(t). The combination of the gas-mixing equation (6) and the airflow equation (9) comprises a 3rd-order 3-parameter nonlinear time-invariant state-space model for Tcap, driven by the 2-parameter input in (7), with the state at time t determined by the state variables pM (t), w(t) and w\u0307(t), [24]. From measurements of pM (t) over the course of an exhalation, we can hope to estimate the 5 parameters involved in the model (6), (7), (9), namely \u03b4, \u03c4 , \u03b1, pA, and \u03f5. Importantly, having estimates of \u03b4, \u03c4 , \u03b1 would allow us to solve (9) for w(t), and thereby estimate the normalized airflow. In Sections III and IV we show how these expectations are met."
        },
        {
            "heading": "D. New Tcap tests for COPD\u2013CHF discrimination",
            "text": "Our earlier work [13] [18] [19] explored the use of capnography for COPD\u2013CHF and COPD\u2013Normal classification by using simple machine-learning approaches to discriminate between regions in a 4- or 5-dimensional parameter space that were characteristic of COPD and those characteristic of CHF. However, our observation above that a scaled version of the airflow profile can be estimated from Tcap alone suggests a quite different approach to COPD\u2013CHF discrimination.\nBoth COPD and CHF patients can present with dyspnea, and spirometry is widely used in pulmonary function testing to distinguish between them, and further to assess COPD severity [29]. It measures, among other variables, the forced expiratory\nvolume in 1 second (FEV1) and forced vital capacity (FVC), which summarize key characteristics of the airflow waveform during forced exhalation. Examining whether the FEV1/FVC ratio is below a population-adjusted threshold serves as an initial confirmation of COPD and its severity. Thresholds around 0.7 are typically used, though this is adjusted based on demographic parameters and the severity level that is being screened for [30].\nA natural unforced analog of FEV1/FVC would be V (1)/VT in our notation, i.e., the ratio of the unforced expiratory volume in 1 second (UEV1) to the tidal volume (TV or VT ). Since we are now able to estimate the normalized quantities w(1) = V (1)/VM and w(T ) = VT /VM = \u03b1 from Tcap alone, the ratio\nu = w(1)/\u03b1 (= V (1)/VT = UEV1/TV) (11)\nis a VM -independent unforced analog of FEV1/FVC, computable from Tcap alone.\nSection IV.C presents exploratory results using this ratio for COPD\u2013CHF discrimination. However, a fuller evaluation, adhering more closely to the STARD 2015 template [31] for evaluation of diagnostic accuracy, must be left to future work."
        },
        {
            "heading": "E. Modeling forced inhalations",
            "text": "In the case of ventilator data with measurements of both airflow and airway pressure, an additional window into airflow subsystem parameters is provided by the forced inhalation portion of the waveforms. Ventilators can operate in different modes, but the records of ventilated patients in the CapnoBase database [8] [9] dominantly involve volume-controlled ventilation, which maintains approximately constant airflow during the inhalation; all the records we study are of this type. This is clearly seen in the example in Fig. 1(a): after a short transient during the initial portion of the inhalation segment, the airflow is approximately constant till the end of the inhalation.\nOur circuit model on the left of Fig. 3 and corresponding equations require modification for the inhalation phase. As seen in Fig. 1(a), the initial airway pressure (when the airflow and its derivative are essentially 0) is the value P across the compliance/capacitor element of our model at the end of exhalation. There is then a short transient before the airflow settles at an essentially constant negative value, \u2212F (< 0).\nDuring intervals of constant airflow, the pressure gradient across the inertance is zero, and across the resistance is FR. The gradient across the compliance ramps up linearly, with slope F/C. If the pleural pressure does not vary significantly during this interval, we expect the linear pressure rise on the compliance to be directly reflected in a linear ramping up of airway pressure, and this is seen in the example in Fig. 1(a) during the interval of constant airflow. These features allow a direct and decoupled estimation of R and C from the available waveforms, as detailed in Section III (Methods). Our interest in estimating R and C in this paper is primarily to compare the product RC estimated from inhalation data, with the value of \u03c4 estimated from Tcap alone \u2014 and separately from airflow or airway pressure \u2014 during exhalation.\nThis work is licensed under a Creative Commons Attribution 4.0 License. For more information, see https://creativecommons.org/licenses/by/4.0/\n7"
        },
        {
            "heading": "III. METHODS",
            "text": ""
        },
        {
            "heading": "A. Data sources",
            "text": "1) Ventilator data: The ventilator data for this paper are taken from the publicly accessible CapnoBase database [8] [9]. We used 17 recordings of 2 minutes each, of the sort shown in Fig. 1(a), recorded from 11 adult patients aged 24\u201374, under anesthesia (in volume-controlled mode, with essentially constant airflow during inhalation) during a variety of elective surgeries. Patients were on a GE SmartVent 7900 ventilator; a Datex-Ohmeda CAiOVX measurement module sampled the flow sidestream to measure CO2 partial pressure, and corrected for delay and deformation in the sidestream tubing; the associated S/5 Collect software resampled all signals to 300Hz. Amplitude resolution for pressure is 0.1 cmH2O (0.074 mmHg), for CO2 partial pressure is 0.01 kPa (0.075 mmHg), for airflow is 0.1 L/min (1.67 mL/s). Exhalations preceded by unusually short ventilator-imposed inhalations, or with other unusual artifacts, were omitted, but 310 exhalations were retained.\n2) Tcap data (without airflow measurements): To evaluate the novel Tcap-based test suggested in Section II.D for COPD\u2013 CHF discrimination, we revisit Tcap data from [13] [18] [19].\nTraining database: Tcap recordings (without airflow measurements) were collected, under IRB-approved protocols, from COPD and CHF patients in the pulmonary function laboratory of Brigham and Women\u2019s Hospital, Boston, Massachusetts, during Jul\u2013Dec 2010. Standard spirometry measurements (FEV1, FVC) confirmed each patient\u2019s diagnosis and severity (moderate, severe). Enrolled subjects were seated, breathing normally, and connected through a standard nasal cannula to a capnograph (Capnostream 20, Oridion Medical, Needham, Massachusetts; flow rate 50 mL/min, sampling rate 50 Hz, amplitude resolution 1 mmHg on the PeCO2 measurement) for a 3-minute recording. 24 COPD records (12 moderate, 12 severe, 28\u201373 years, 12 female) and 24 CHF records (19 moderate, 5 severe, 32\u201384 years, 9 female) constituted the training database.\nTest database: Additional data were collected as above and with an identical device, again with IRB approval, from patients presenting to the Emergency Department of Einstein Medical Center, Philadelphia, Pennsylvania, with a chief complaint of moderate/severe dyspnea. Those meeting COPD or CHF eligibility criteria (detailed in [13]) were enrolled, and informed consent was obtained. The recordings of 10\u2013 30 min each yielded our test set, comprising 29 COPD records (collected Feb\u2013Dec 2007) and 32 CHF records (collected May 2012\u2013Jan 2013), not classified by severity. We also use a trimmed version of this test set (27 COPD/31 CHF) that retains only records with at least 30 validated exhalations (most have a few hundred, the longest has 617).\nB. Fitting Vcap; estimating VL, VM , \u03bd, pA To assess how well the gas-mixing model (1) with input (3) fits Vcap, we first require an estimate of the laminarflow deadspace volume VL. In all the results reported here, we estimate VL using the construction illustrated by the dashed black line in Fig. 4 for the case of the particular\nvolumetric capnogram in Fig. 1(b). Specifically, a close 10thorder polynomial least-mean-square-error fit (not shown in Fig. 4) is constructed for the entire Vcap waveform from V = 0 to V = VT , using the polyfit routine in MATLAB (MathWorks, Natick, Massachusetts). The point of inflection of the polynomial (marked o in Fig. 4) is where its slope is maximum. The intersection of the tangent line at this point with the volume axis is taken as our estimate of VL (marked * in the figure, 176 mL in this case).\nHaving an estimate of VL, we use MATLAB\u2019s lsqcurvefit routine to determine values of the parameters VM , \u03bd and K that lead to the nonlinear least-mean-squareerror fit of pM (V ) to the Vcap data for VL < V < VT\u221250mL, where pM (V ) is given by the analytical solution of the model equations (1), (3) (see Supplementary Material). (We do not attempt to fit the last 50 mL of the Vcap record, as the data tend to be erratic and noisy at the end of the exhalation.) The algorithm is initialized with estimates K = 30mmHg, VM = 0.5VT and \u03bd = 0 in every case. The particular structure of this model, as the cascade of two single-pole, linear, constant-coefficient systems with poles at \u22121/VM and \u22121/\u03bd, causes the analytical solution, and therefore the fit of the model to the data, to be unchanged if the values of VM and \u03bd are interchanged. Since \u03bd was introduced to relax our prior assumption of a step increase in pA(V ), i.e., to relax the assumption that \u03bd = 0, we pick the smaller of the two converged values to be our estimate of \u03bd.\nThe red curve in Fig. 4 shows the resulting fit, and it appears good visually; the root-mean-square-error (rmse) of the fit is 0.18 mmHg over the span of the fit. This number can be used as a benchmark when interpreting the results presented in Section IV for the performance of the model on all the other exhalations in our set of ventilatory recordings. The dashed blue curve in Fig. 4 is the estimated pA(V ) given by (3), settling exponentially to the value pA = 26.1mmHg.\nThis work is licensed under a Creative Commons Attribution 4.0 License. For more information, see https://creativecommons.org/licenses/by/4.0/\n8"
        },
        {
            "heading": "C. Fitting Tcap; estimating \u03b4, \u03c4, \u03b1, \u03f5, pA (and VM )",
            "text": "To fit Tcap waveforms, we combine the normalized gasmixing subsystem model (6), (7) with the normalized airflow subsystem model (9). Since the combination is nonlinear and without an analytical solution in general, the process of fitting involves embedding numerical simulation of the combined 3rd-order model within a loop in MATLAB\u2019s lsqcurvefit to determine the values of \u03b4, \u03c4 , \u03b1, \u03f5, pA that yield a leastmean-square-error fit (using the respective starting values 0.01 sec, 1.3 sec, 3.5, 0.01 sec, 30 mmHg for all exhalations).\nSince airflow is measured in the case of our ventilator data, we could actually determine when exhalation begins \u2014 at flow reversal from negative to positive \u2014 and also the laminarflow volume VL that has to be expelled before CO2 partial pressure in the exhaled breath starts to rise and register on Tcap. However, because we are interested in comparing with what can be determined from Tcap alone, without airflow or airway-pressure measurements, we choose the time origin within an exhalation to be when PeCO2 first crosses up through a low threshold (and subsequently rises for the rest of the exhalation). For Tcap obtained from the ventilator data, we have chosen this threshold to be 0.5 mmHg above the baseline attained at the end of the preceding inhalation; for our remaining (lower-resolution) Tcap data, we choose it to be 1 mmHg above baseline. The values of the normalized volume w(t) and normalized flow w\u0307(t) are zero at the start of exhalation, but are typically nonzero at this threshold crossing (because by then a volume VL has been exhaled). Though we could determine these initial conditions in the case of ventilator data, they are not available when only Tcap is known. Accordingly, the results we report in Section IV are obtained by assuming all initial conditions are zero, and using the solution of (9) (given in the Supplementary Material). An example of the fit of our model to Tcap is shown in the upper part of Fig. 5, for the same exhalation as in Figs. 1 and 4. The corresponding parameter estimates are \u03b4 = 0.10 s \u226a \u03c4 = 0.82 s, \u03b1 = 4.37, \u03f5 = 0.086 s, pA = 26.8mmHg. The capnogram synthesized by the model for these parameter values fits the measured Tcap well, with an rmse of 0.3 mmHg."
        },
        {
            "heading": "D. Estimating the exhaled airflow profile from Tcap",
            "text": "Having estimates of \u03b4, \u03c4 and \u03b1 allows solution of (9) with zero initial conditions (see expressions in the Supplementary Material) to estimate the normalized airflow waveform w\u0307(t) = V\u0307 (t)/VM during exhalation. Some discrepancy is to be expected because the actual initial conditions (after the laminar flow volume VL has been exhaled) are nonzero.\nIf a measurement of the full exhaled airflow waveform is available for comparison (as with our ventilator data), then VM can be estimated as the multiplicative factor that best aligns the normalized and measured airflow waveforms (adjusting as needed for the difference in time origins). This is illustrated by the lower set of traces in Fig. 5, which shows the estimated flow for the same exhalation we have been using as a running example, plotted with the actual measured flow (after time-shifting to adjust for the different choices of time-origin between Vcap and Tcap, and scaling for a leastmean-square-error fit over the duration of the exhalation).\nThe alignment of the flow profiles appears good, and the corresponding rmse is 30 mL/s. (Note also that the estimated \u03b4 and \u03c4 values we just quoted, Section III.C, are consistent with their being the approximate time constants governing the rise and fall of airflow.) Our results in Section IV establish that this performance is typical.\nThe estimate of VM can be obtained more easily from the relation VM = VT /\u03b1, provided the tidal volume VT is known; VT is easier to measure than the full airflow profile. This estimate of VM should closely match that obtained by scaling the estimated normalized flow to best fit the actual flow, because these two flows are ideally related by the same scale factor as the one that relates the integrals of these flows, namely the normalized and actual tidal volumes."
        },
        {
            "heading": "E. Fitting forced inhalations; estimating R and C",
            "text": "We have selected our records solely from patients whose ventilators operate in constant-flow mode during forced inhalation. As noted in Section II, the airflow model simplifies in any interval during which the airflow is constant at some value \u2212F < 0. Assuming pleural pressure does not vary significantly in such an interval, we expect an essentially linear ramping up of airway pressure with slope F/C in the interval, allowing C to be computed from a least-mean-squareerror linear fit to the ramp. The total insufflated volume Vins\nThis work is licensed under a Creative Commons Attribution 4.0 License. For more information, see https://creativecommons.org/licenses/by/4.0/\n9 during the transient, before constant airflow sets in, can also be computed; dividing this by the estimated C determines the pressure rise in the compliance above its starting value, before it begins its linear rise. (See Supplementary Material for figures embodying the preceding computations.) The total gradient across the compliance before it begins its linear rise is thus P +(Vins/C). Subtracting this from airway pressure at the beginning of the linear rise gives the gradient FR across the resistance, which therefore allows R to be estimated4.\nThe product RC, if estimated during an exhalation, would be expected to correspond to the time-constant \u03c4 that governs the decay of airflow during exhalation. However, since lung characteristics can and do differ between inhalation and exhalation, the RC product estimated during inhalation may only correspond approximately to \u03c4 . Similarly, to the extent that the R estimated from inhalation data applies to exhalation, we might obtain an approximate estimate of the inertance using the relation L = \u03b4R."
        },
        {
            "heading": "IV. RESULTS",
            "text": "In the first part of this section we present a summary of the results from our validation studies for the Vcap and Tcap models in Section II, using the ventilator data and the approaches outlined in Section III. The last part of this section presents the results of COPD\u2013CHF discrimination using our Tcap-based analog of a standard spirometry test."
        },
        {
            "heading": "A. Fitting Vcap, Tcap and airflow models to ventilator data",
            "text": "The fits of our models to Vcap, Tcap and airflow waveforms in the ventilator data can be assessed via the associated rootmean-square-error (rmse) values.\na) Vcap: The example in Fig. 4, with rmse 0.18 mmHg, provides a benchmark for assessing the fits on other exhalations. The rmse across all 310 exhalations in our records spanned 0.10\u20130.70 mmHg (and 0.4\u20132.2% of end-tidal partial pressure), with mean rmse 0.36 mmHg and standard deviation of 0.14 mmHg. The largest within-record standard deviation for rmse was 0.07 mmHg, across the 17 records. Note that these various rmse values are obtained with instrumentation that has a 0.075 mmHg quantization interval for CO2 measurement, and for exhalations that have end-tidal CO2 values in the range of 23.7 mmHg to 45.6 mmHg.\nb) Tcap: For Tcap, a benchmark is in the upper set of traces in Fig. 5, where the rmse was 0.3 mmHg. The rmse across all 310 exhalations spanned 0.14\u20131.11 mmHg (and 0.5\u2013 3.5% of end-tidal partial pressure), with a mean rmse of 0.57 mmHg and standard deviation of 0.25 mmHg. The largest within-record standard deviation for rmse was 0.12 mmHg.\nc) Airflow: A benchmark for the airflow estimates obtained by scaling Tcap-derived normalized airflows for leastmean-square-error fit to the corresponding measured airflows is in the lower set of traces in Fig. 5, where the rmse was 30 mL/s. The rmse of the airflow fits across all 310 exhalations ranged from 14 mL/s to 79 mL/s, with a mean rmse of 42 mL/s\n4There are various established approaches to estimating R and C in ventilated patients [32], typically using models with no inertance L. We are not aware of a prior description of our simple decoupled approach.\nand standard deviation of 13 mL/s. The largest within-record standard deviation for rmse was 10 mL/s."
        },
        {
            "heading": "B. Parameter estimates from ventilator data",
            "text": "The key parameters for our model are: \u2022 for Vcap, the laminar-flow deadspace volume VL, the\nmixing deadspace volume VM , the parameter \u03bd that governs the discharge of alveolar gas into VM , and the mean alveolar gas partial pressure pA; \u2022 for Tcap, the time constants \u03b4 (governing the fast initial transient on exhalation) and \u03c4 (governing the slower subsequent settling), also \u03b1 (the VM -normalized tidal volume VT ), \u03f5 to describe alveolar discharge, and pA \u2014 and we also showed that matching the Tcap-derived normalized airflow and tidal volume estimates to the actual values could yield two additional estimates of VM ; \u2022 from the inhalation data, R and C. In the remaining figures we present cross-record comparisons for many of these parameters. For other parameters we simply indicate below the range of mean values obtained for the estimates across all records. To avoid clutter, and because they are not as interesting or novel, we omit presenting the estimates of pA.\nFigure 6 shows \u03bd, VM , VL values estimated from Vcap as specified in Section III.B. Each row is labeled by the patient record identifier in Capnobase [8]. Also shown are the values of VM estimated as the scale factors that cause the Tcapderived estimates of normalized airflow and normalized tidal volume to respectively match the measured V (t) (with leastmean-square-error) and tidal volume VT (exactly).\nFigure 7 similarly shows the cross-record comparison of estimates for \u03b4 and \u03c4 obtained from Tcap, along with the small\nThis work is licensed under a Creative Commons Attribution 4.0 License. For more information, see https://creativecommons.org/licenses/by/4.0/\n10\nand large time constants, \u03b4\u2032 and \u03c4 \u2032 respectively, estimated through a simple least-mean-square-error fit of the sum of two exponentials to the airway-pressure waveform during exhalation (see Supplementary Material). The estimated \u03f5 values are in the same range as the \u03b4\u2019s, but omitted to avoid clutter.\nAlso incorporated for comparison in Fig. 7 is the product RC = \u03c4 \u2032\u2032 constructed from the estimates of R and C obtained from the airflow and airway-pressure waveforms during the forced inhalation preceding each exhalation. We omit a detailed presentation of the estimates obtained for R and C individually, except to note that the mean value of R estimated for each of the 17 records ranged from 3.45 to 18.74 mmHg \u00b7L\u22121s\u22121, and the mean value of C ranged from 49.0 to 101.1 mL \u00b7 mmHg\u22121. These values are consistent with values quoted in the literature (for instance [32]).\nFinally, the mean value of \u03b1 (the VM -normalized tidal volume) ranged from 2.61 to 4.59 across the 17 records."
        },
        {
            "heading": "C. COPD\u2013CHF discrimination using Tcap airflow estimate",
            "text": "Evaluation of our Tcap-based COPD\u2013CHF classifier using the UEV1/TV ratio u = w(T )/w(1) is done on the training and test data from standard sidestream capnometers (with no airflow or air pressure measurements) described in Section III.A(2). We use the same models and procedures as above (but with \u03f5 = 0, so only 4 parameters) to fit each of the (thousands of) exhalations in the 109 records. The sample w(t) plots in Fig. 8(a), chosen from exhalations in our test set, suggest that the ratio u might indeed differ systematically between COPD and CHF patients. This is further borne out by the histograms of u in Figs. 8(b) and (c), determined from the\nfirst 15 validated exhalations in each COPD and CHF record from, respectively, the training and test sets. This suggests a simple threshold test on u, which we examine next. (A fuller evaluation more closely meeting STARD 2015 criteria [31], and comparison to other simple tests \u2014 such as a threshold test on \u03c4 , motivated by results in [19] \u2014 is left to future work.)\nWe used the first 15 exhalations from each record in the training database as our training set. A threshold of 0.8 on u maximized the proportion of correct decisions on the exhalations in this set, where u below threshold are deemed to have come from COPD records, and values above from CHF. We then carried out two COPD\u2013CHF classification experiments, as described next.\n(1) Choosing 15 exhalations randomly from each record in the trimmed test set, Section III.A(2), we declared a record to be from a COPD patient if the threshold test declared more than half (\u2265 8) of these exhalations to be COPD \u2014 and repeated this 100 times. The accuracies of COPD\u2013CHF classification in these experiments were in the range 74.1%\u2013 86.2%, with a mean of 80.6%, stdev 2.1% (see Supplementary Material for a histogram of obtained accuracies).\n(2) For each record in the full test set, we declared the record to be COPD if more than a fraction f of all the exhalations were decided as COPD, and varied f between 0 and 1 to generate a \u201creceiver operating characteristic\u201d (ROC) curve (the test in (1) corresponds to f = 0.5). This ROC curve (see Supplementary Material) has area under it (AUROC) equal to 0.84. The corresponding \u201cequal-error-rate\u201d (EER) value, where specificity=sensitivity [24], is 77% for our test set, and is obtained for f = 0.2. The EER gives a rough lower bound for obtainable accuracy, as the relative prevalence of COPD to CHF in the test set is varied."
        },
        {
            "heading": "V. DISCUSSION",
            "text": "Our results in Section IV have established that Vcap and Tcap waveforms can be modeled quantitatively and with good fidelity using low-order mechanistic models that reflect the underlying respiratory anatomy and the physiological mechanisms, though in a necessarily aggregated manner. Some reinforcement of the postulated anatomical basis of the model comes from the fact that the values of VM and VL estimated from Vcap are consistent with the nominal values of 53 mL and 115 mL respectively, derived from data quoted in [21], and indicated in Fig. 2. It should be kept in mind, however, that some part of the mixing volume VM may be in the tubing that leads to the sensor, and hence capnometer-dependent.\nThe listed rmse values for the Vcap, Tcap and airflow fits to the ventilator data show that the particular set of waveforms (exhalation #2 of record 365A) selected as a running example to support the development in the paper \u2014 see Figs. 1, 4, 5 \u2014 falls in the best quartile of our data, from the point of view of model fits. However, even the poorest fits are not significantly worse in absolute terms.\nWe have previously demonstrated good fits to Tcap using similar models, [18] [19], but those papers assumed a step increase in pA(t) at the start of exhalation, rather than an exponential settling to pA with time constant \u03f5 as in (7),\nThis work is licensed under a Creative Commons Attribution 4.0 License. For more information, see https://creativecommons.org/licenses/by/4.0/\n11\nand only [19] incorporated the inertance L (or equivalently the time constant \u03b4) in the airflow model. The models in the current study thus involved one or two more parameters, permitting closer fits, and yet these parameters turned out to be robustly and consistently identifiable as well. (See Supplementary Material for comparison of fits to Tcap and airflow in Fig. 1, using different models.) These additional parameters \u2014 similarly, \u03bd in the case of Vcap \u2014 are also potentially of clinical interest.\nThe 17 ventilator records analyzed here have allowed us to compare, on the same data, the performance of our Tcap and Vcap models, as well as models for the inspiratory phase on each breath. Although the individual parameter estimates in Figs. 6 and 7 vary across the ventilator records, each standard deviation within a record is relatively small, suggesting the parameters are characteristic of the patient\u2019s current state. Also, when there are two records from a given patient (same patient number, different letter), the two sets of estimates are quite close, suggesting the parameters in our models can be robustly identified in a patient-specific way from capnography alone. The estimated parameters are aligned with values in the literature, consonant between Tcap and Vcap on exhalation (particularly in the case of time-constants associated with the airway model), and with estimates extracted from the recordings during inhalation. Our results suggest one can have confidence in the use of these models and the associated parameter estimates extracted from Tcap and Vcap.\nModels of greater fidelity to the anatomy and physiology can undoubtedly be constructed, and help to enhance understanding, for example in simulation studies [15], but robust identification from the available data becomes progressively harder. As our models closely fit the measured capnograms, there is not much information in the residual error to support additional modeling refinements. Though the parameters in our model represent aggregate effects, we anticipate that future work will discover useful associations of particular parameter ranges, combinations, or clusters with particular physiological states and clinical pathologies.\nFor Tcap, specific numerical results on the accuracy of our model fits, and the robustness and consistency of the resulting parameter estimates, were presented here only for\nthe ventilator data. The accuracy and robustness of the Tcap fits for the thousands of exhalations in all the other Tcap data (used for the COPD\u2013CHF study) were comparable.\nOur models revealed, somewhat surprisingly, that the entire airflow profile can be determined to within a scale factor VM using Tcap alone, see Section III.D. This accounts for why the time constants of airflow and airway pressure are well estimated using Tcap alone, see Fig. 7. The ventilator data have allowed us to verify that the scaled fit is good, see Fig. 5, despite having to assume zero initial conditions for (9) in order to generate a normalized airflow profile using Tcap alone. However, the scale factor VM estimated by combining Tcap with a measurement of airflow or tidal volume VT ended up larger (often 2-3 times larger) than the value estimated from Vcap, perhaps partly because of the assumption of zero initial conditions. Also, because of how we have defined the time origin for Tcap, the exhaled volume at this time is systematically lower than the VL estimated as in Fig. 4 (by around 29 mL in the example in Fig. 1), perhaps leaving this gap to be captured in Tcap\u2019s estimate of VM . These issues bear further investigation.\nA related challenge is to more closely model and fit the portion of Vcap leading up to the volume we have chosen as our estimate of VL. Our construction for estimating VL in Fig. 4 \u2014 while plausible, and in the style of other constructions in the capnography literature \u2014 is somewhat ad hoc.\nThe ability to estimate a scaled airflow profile from Tcap alone motivated our proposal for a Tcap-based analog of a standard spirometry test for COPD\u2013CHF discrimination, which we have evaluated here with encouraging results. The test may be more directly interpretable in a clinical setting than the discriminant tests described in our earlier work [13], [18], [19], which involved partitioning the multi-dimensional parameter space of our models into parameter clusters associated with COPD versus those associated with CHF. Those tests, using essentially the same database as in this paper, have obtained test-set accuracies in the range of 70\u201382%. It would be interesting, following up on observations in [19], to explore how a simple threshold test on the estimated exhalation time-constant \u03c4 compares with the above results, as also with spirometry; we leave this exploration for future work.\nThis work is licensed under a Creative Commons Attribution 4.0 License. For more information, see https://creativecommons.org/licenses/by/4.0/\n12\nEven restricting ourselves to COPD\u2013CHF discrimination tests based on estimated scaled airflow profile, the particular threshold test on u is only one of several possibilities, and others might be explored in future work. A more detailed view of pulmonary function is often obtained in spirometry by plotting airflow V\u0307 (t) versus volume V (t). An analog to this plot for the expiratory phase, and obtainable from Tcap measurements alone, is a plot of w\u0307(t) = V\u0307 (t)/VM versus w(t) = V (t)/VM , and would be interesting to explore.\nIt will also be worthwhile in future work to examine the relationship between the deadspace volumes VL, VM used in our models and those in more classical descriptions, for example the relation of VL + VM to classical estimates of anatomical deadspace, [4]\u2013[7]."
        },
        {
            "heading": "VI. CONCLUSION",
            "text": "Our low-order mechanistic models for capnography reflect the underlying lung anatomy and physiology, though in a necessarily aggregated manner, using just 4 or 5 parameters. They closely and robustly characterize \u2014 in quantitative detail \u2014 the capnogram traces in Vcap and Tcap. The associated parameters are thus potentially of clinical value in cardiorespiratory screening, diagnosis and monitoring, beyond the specific example of COPD\u2013CHF discrimination illustrated in this paper and in our earlier work.\nWe have shown that the full exhaled airflow profile can be inferred from Tcap alone, to within a scale factor. Related to this is the fact that time-constants associated with airflow and airway pressure can be estimated well from Tcap."
        },
        {
            "heading": "Acknowledgments",
            "text": "Partial support has come from Philips Healthcare, and we are particularly grateful to Joseph Frassica and Francesco Vicario for their interest and encouragement, and to the latter for helpful feedback as this paper took shape. Comments from reviewers were instrumental in improving the paper. EKM and CXY received support from the MIT EECS Department\u2019s SuperUROP funds. We are indebted to the Capnobase team [9] for its generosity in creating and disseminating this valuable database, and specifically to Walter Karlen and Mark Ansermino for helpful details. Our work has built on the efforts of prior students in the Computational Physiology and Clinical Inference Group at MIT\u2019s Research Laboratory of Electronics, specifically Rebecca Mieloszyk, Abubakar Abid, Ekin Karasan, and Rhian Chavez."
        }
    ],
    "title": "Low-Order Mechanistic Models for Volumetric and Temporal Capnography: Development, Validation, and Application",
    "year": 2023
}
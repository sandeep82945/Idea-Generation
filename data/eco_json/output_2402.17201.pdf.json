{
    "abstractText": "We propose an operating envelopes (OEs) aware energy community market mechanism that dynamically charges/rewards its members based on two-part pricing. The OEs are imposed exogenously by a regulated distribution system operator (DSO) on the energy community\u2019s revenue meter that is subject to a generalized net energy metering (NEM) tariff design. By formulating the interaction of the community manager and its members as a Stackelberg game, we show that the proposed two-part pricing achieves a Nash equilibrium and maximizes the community\u2019s social welfare in a decentralized fashion while ensuring that the community\u2019s operation abides by the OEs. The market mechanism conforms with the cost-causation principle and guarantees community members a surplus level no less than their maximum surplus when they autonomously face the DSO. The dynamic and uniform community price is a monotonically decreasing function of the community\u2019s aggregate renewable generation. We also analyze the impact of exogenous parameters such as NEM rates and OEs on the value of joining the community. Lastly, through numerical studies, we showcase the community\u2019s welfare, pricing, and compare its members\u2019 surplus to customers under the DSO and other OEs arrangements.",
    "authors": [
        {
            "affiliations": [],
            "name": "Ahmed S. Alahmed"
        }
    ],
    "id": "SP:d25c899368345f88ca14a57a4b4f1670b65d02e9",
    "references": [
        {
            "authors": [
                "M.Z. Liu",
                "L.N. Ochoa",
                "S. Riaz",
                "P. Mancarella",
                "T. Ting",
                "J. San"
            ],
            "title": "and J",
            "venue": "Theunissen, \u201cGrid and market services from the edge: Using operating envelopes to unlock network-aware bottom-up flexibility,\u201d IEEE Power and Energy Magazine, vol. 19, no. 4",
            "year": 2021
        },
        {
            "authors": [
                "B. Liu",
                "J.H. Braslavsky"
            ],
            "title": "Robust dynamic operating envelopes for DER integration in unbalanced distribution networks,",
            "venue": "IEEE Transactions on Power Systems,",
            "year": 2023
        },
        {
            "authors": [
                "B. Cui",
                "A. Zamzam"
            ],
            "title": "and A",
            "venue": "Bernstein, \u201cNetwork-cognizant time-coupled aggregate flexibility of distribution systems under uncertainties,\u201d IEEE Control Systems Letters, vol. 5, no. 5, pp. 1723\u20131728",
            "year": 2021
        },
        {
            "authors": [
                "D. Lee",
                "H.D. Nguyen",
                "K. Dvijotham"
            ],
            "title": "and K",
            "venue": "Turitsyn, \u201cConvex restriction of power flow feasibility sets,\u201d IEEE Transactions on Control of Network Systems, vol. 6, no. 3, pp. 1235\u20131245",
            "year": 2019
        },
        {
            "authors": [
                "G. Lankeshwara",
                "R. Sharma",
                "R. Yan",
                "T.K. Saha"
            ],
            "title": "and J",
            "venue": "V. Milanovi\u0107, \u201cTime-varying operating regions of end-users and feeders in low-voltage distribution networks,\u201d IEEE Trans. on Power Systems, pp. 1\u201312",
            "year": 2023
        },
        {
            "authors": [
                "Y. Yang",
                "G. Hu",
                "C.J. Spanos"
            ],
            "title": "Optimal sharing and fair cost allocation of community energy storage,",
            "venue": "IEEE Trans. Smart Grid,",
            "year": 2021
        },
        {
            "authors": [
                "G. Ferro",
                "M. Robba",
                "R. Haider"
            ],
            "title": "and A",
            "venue": "M. Annaswamy, \u201cA distributedoptimization-based architecture for management of interconnected energy hubs,\u201d IEEE Transactions on Control of Network Systems, vol. 9, no. 4, pp. 1704\u20131716",
            "year": 2022
        },
        {
            "authors": [
                "A.S. Alahmed",
                "L. Tong"
            ],
            "title": "Integrating distributed energy resources: Optimal prosumer decisions and impacts of net metering tariffs,",
            "venue": "SIGEN- ERGY Energy Inform. Rev.,",
            "year": 2022
        },
        {
            "authors": [
                "L. Han",
                "T. Morstyn"
            ],
            "title": "and M",
            "venue": "McCulloch, \u201cIncentivizing prosumer coalitions with energy management using cooperative game theory,\u201d IEEE Trans. Power Systems, vol. 34, no. 1",
            "year": 2019
        },
        {
            "authors": [
                "Y. Chen",
                "C. Zhao",
                "S.H. Low"
            ],
            "title": "and S",
            "venue": "Mei, \u201cApproaching prosumer social optimum via energy sharing with proof of convergence,\u201d IEEE Trans. Smart Grid, vol. 12, no. 3",
            "year": 2021
        },
        {
            "authors": [
                "P. Chakraborty",
                "E. Baeyens",
                "P.P. Khargonekar",
                "K. Poolla"
            ],
            "title": "and P",
            "venue": "Varaiya, \u201cAnalysis of solar energy aggregation under various billing mechanisms,\u201d IEEE Trans. Smart Grid, vol. 10, no. 4",
            "year": 2019
        },
        {
            "authors": [
                "G.E. Rahi",
                "S.R. Etesami",
                "W. Saad",
                "N.B. Mandayam"
            ],
            "title": "and H",
            "venue": "V. Poor, \u201cManaging price uncertainty in prosumer-centric energy trading: A prospect-theoretic stackelberg game approach,\u201d IEEE Trans. Smart Grid, vol. 10, no. 1",
            "year": 2019
        },
        {
            "authors": [
                "N. Vespermann",
                "T. Hamacher"
            ],
            "title": "and J",
            "venue": "Kazempour, \u201cAccess economy for storage in energy communities,\u201d IEEE Transactions on Power Systems, vol. 36, no. 3, pp. 2234\u20132250",
            "year": 2021
        },
        {
            "authors": [
                "M.Z. Liu",
                "L.F. Ochoa",
                "P.K.C. Wong"
            ],
            "title": "and J",
            "venue": "Theunissen, \u201cUsing OPFbased operating envelopes to facilitate residential der services,\u201d IEEE Transactions on Smart Grid, vol. 13, no. 6, pp. 4494\u20134504",
            "year": 2022
        },
        {
            "authors": [
                "L. Blackhall"
            ],
            "title": "On the calculation and use of dynamic operating envelopes,",
            "venue": "Project EVOLVE, Tech. Rep., Nov. 2020",
            "year": 2020
        },
        {
            "authors": [
                "Y. Zabihinia Gerdroodbari",
                "M. Khorasany"
            ],
            "title": "and R",
            "venue": "Razzaghi, \u201cDynamic PQ operating envelopes for prosumers in distribution networks,\u201d Applied Energy, vol. 325, p. 119757",
            "year": 2022
        },
        {
            "authors": [
                "G.Y. Yi"
            ],
            "title": "Verbi\u010d, \u201cFair operating envelopes under uncertainty using chance constrained optimal power flow,",
            "venue": "Electric Power Systems Research,",
            "year": 2005
        },
        {
            "authors": [
                "S.C. Ross",
                "J.L. Mathieu"
            ],
            "title": "A method for ensuring a load aggregator\u2019s power deviations are safe for distribution networks,",
            "venue": "Electric Power Systems Research,",
            "year": 2020
        },
        {
            "authors": [
                "J. Gasser",
                "H. Cai",
                "S. Karagiannopoulos",
                "P. Heer"
            ],
            "title": "and G",
            "venue": "Hug, \u201cPredictive energy management of residential buildings while self-reporting flexibility envelope,\u201d Applied Energy, vol. 288, p. 116653",
            "year": 2021
        },
        {
            "authors": [
                "S. Ross",
                "J. Mathieu"
            ],
            "title": "Strategies for network-safe load control with a third-party aggregator and a distribution operator,",
            "venue": "IEEE Transactions on Power Systems,",
            "year": 2021
        },
        {
            "authors": [
                "M.I. Azim",
                "G. Lankeshwara",
                "W. Tushar",
                "R. Sharma",
                "M.R. Alam",
                "T.K. Saha",
                "M. Khorasany"
            ],
            "title": "and R",
            "venue": "Razzaghi, \u201cDynamic operating envelopeenabled P2P trading to maximise financial returns of prosumers,\u201d IEEE Transactions on Smart Grid, pp. 1\u20131",
            "year": 2023
        },
        {
            "authors": [
                "W.Y. Oi"
            ],
            "title": "A disneyland dilemma: Two-part tariffs for a mickey mouse monopoly,",
            "venue": "The Quarterly Journal of Economics,",
            "year": 1971
        },
        {
            "authors": [
                "A.S. Alahmed",
                "L. Tong"
            ],
            "title": "Dynamic net metering for energy communities,",
            "venue": "IEEE Transactions on Energy Markets, Policy and Regulation,",
            "year": 2024
        },
        {
            "authors": [
                "A.S. Alahmed",
                "G. Cavraro",
                "A. Bernstein"
            ],
            "title": "and L",
            "venue": "Tong, \u201cOperatingenvelopes-aware decentralized welfare maximization for energy communities,\u201d in 2023 59th Annual Allerton Conference on Communication, Control, and Computing (Allerton)",
            "year": 2023
        },
        {
            "authors": [
                "A.S. Alahmed",
                "L. Tong"
            ],
            "title": "On net energy metering X: Optimal prosumer decisions",
            "venue": "social welfare, and cross-subsidies,\u201d IEEE Trans. Smart Grid, vol. 14, no. 02",
            "year": 2023
        },
        {
            "authors": [
                "P. Chakraborty",
                "E. Baeyens"
            ],
            "title": "and P",
            "venue": "P. Khargonekar, \u201cCost causation based allocations of costs for market integration of renewable energy,\u201d IEEE Trans. on Power Systems, vol. 33, no. 1",
            "year": 2018
        },
        {
            "authors": [
                "Y. Xu",
                "L. Tong"
            ],
            "title": "Optimal operation and economic value of energy storage at consumer locations,",
            "venue": "IEEE Transactions on Automatic Control,",
            "year": 2017
        },
        {
            "authors": [
                "A. Asadinejad",
                "A. Rahimpour",
                "K. Tomsovic",
                "H. Qi"
            ],
            "title": "and C",
            "venue": "fei Chen, \u201cEvaluation of residential customer elasticity for incentive based demand response programs,\u201d Electric Power Systems Research",
            "year": 2018
        },
        {
            "authors": [
                "Z.-Q. Luo",
                "J.-S. Pang",
                "D. Ralph"
            ],
            "title": "Mathematical Programs with Equilibrium Constraints",
            "venue": "Cambridge University Press, 1996. 11 VII. ACKNOWLEDGMENT The work of Ahmed S. Alahmed and Lang Tong was supported in part by the National Science Foundation under Award 2218110 and the Power Systems and Engineering Research Center (PSERC) under Research Project M-46. This work was authored in part by the National Renewable Energy Laboratory, operated by Alliance for Sustainable Energy, LLC, for the U.S. Department of Energy ",
            "year": 2830
        }
    ],
    "sections": [
        {
            "text": "ar X\niv :2\n40 2.\n17 20\n1v 1\n[ ee\nss .S\nY ]\n2 7\nFe b\n20 24\nIndex Terms\u2014Dynamic pricing, energy community, net metering, operating envelopes, Stackelberg game, transactive energy system, two-part pricing.\nI. INTRODUCTION AND BACKGROUND\nPrimarily driven by sustainability and economic incentives, distribution networks have experienced a massive deployment of behind-the-meter (BTM) distributed energy resources (DER). This introduces a paradigm shift in distribution networks, where the nodes can be referred to as prosumers, i.e., nodes both able to produce and consume energy. The DERs\u2019 uncoordinated power injections could pose challenges to system stability and power quality [1] given also that the DER outputs cannot be directly measured (because of load masking) or controlled (due to deregulated electricity markets unbundled model) by the DSO. To ensure that the net power injections do not compromise the network\u2019s operation, the DSO announces dynamic OEs, i.e., upper and lower bounds on the net power injections for each bus. OEs vary spatially and temporally depending on the network\u2019s conditions and provide higher flexibility than the fixed export limits (e.g., 5kW or 3.5kW [1]), which, as the level of penetration increases, quickly become obsolete. OEs are essentially conservative inner approximation of the power injections feasible region where a solution for the power flow equations is guaranteed to exist and meet the operational constraints. Though inner hyperrectangle approximations are widely adopted, e.g., see [2],\nAhmed S. Alahmed and Lang Tong are with the School of Electrical and Computer Engineering Cornell University, Ithaca, NY, USA ({ASA278, LT35}@cornell.edu).\nGuido Cavraro and Andrey Bernstein are with the Power System Engineering Center, National Renewable Energy Laboratory, Golden, CO, USA ({Guido.Cavraro, Andrey.Bernstein}@nrel.gov).\nmore advanced solutions propose ellipsoidal [3] inner approximations or convex restrictions of the feasibility sets [4], [5].\nRather than directly facing the DSO, prosumers can organize themself into energy communities, i.e., a group of spatially co-located nodes that perform energy and monetary transactions as a single entity behind the DSO\u2019s revenue meter that measures the community\u2019s net consumption [6], [7]. Under the widely adopted NEM tariff design, when the community is net-importing, it faces a buy (retail) rate; whereas when it is net-exporting, it faces a sell (export) rate [8], [9]. Energy communities are appealing also to nodes without BTM DERs, that can own quotes of a shared central PV or take advantage of other members\u2019 generation capabilities.\nThis paper proposes a novel pricing mechanism for energy communities. First, the pricing mechanism is threshold-based with the energy price being a function of the community\u2019s aggregate supply. Second, the mechanism is OEs-aware, as it induces a collective member response that does not violate the OEs on the community\u2019s aggregate net consumption. Third, the mechanism aligns each member\u2019s incentive with that of the community such that each member maximizing its individual surplus results in maximum community welfare. Fourth, the market mechanism obeys a cost-causation principle which, roughly speaking, means that joining the community is advantageous over autonomously facing the DSO.\nDespite the abundant literature on energy communities, the majority of literature that considered pricing-based energy management market mechanisms neglected network and grid constraints [6], [10]\u2013[14].On the other hand, the literature on OEs largely ignored incorporating them into a price-driven mechanism design that induces community members to collectively react to ensure a safe community operation [15]\u2013[18]. Rather, it focuses on methods to compute OEs, e.g., see [19]. Alternatively, works in the literature treat OEs as constraints that need to be ensured while controlling or optimizing the network performance. A model predictive control scheme for building management is devised in [20]; whereas [21] proposes a method to control thermostatic loads to provide frequency regulation. In [22], the authors consider an energy community with operator-designed OEs to maximize energy transactions between its members without compromising network constraints and is perhaps the closest to our work. The authors adopt an ex-post allocation rule (Shapley value) to distribute the coalition welfare, whereas, in our case, ex-ante and resource-aware pricing and allocation mechanisms are designed to distribute the coalition welfare and incentivize joining the coalition.\nUnder the proposed OEs-aware pricing mechanism, the profit-neutral operator charges/compensates its members via\n2 a two-part pricing,1 consisting of a threshold-based dynamic price and a fixed reward both of which are functions of the aggregate DER in the community. The dynamic, yet uniform, price is used to charge the net-consumption of members; the fixed reward is applied only when the community is congested, i.e., when one of the OEs binds.2 Both the community price and fixed rewards are endogenously determined, based on community members\u2019 flexibility and aggregate DER. The price monotonically decreases as the community aggregate generation/load ratio increases, indicating that the excess generation from net-producing members is first pooled to net-consuming members before it is exported back to the grid.\nThe paper contributions with respect to our prior work on the Dynamic NEM (D-NEM) mechanism [24], [25] are fourfold. First, we incorporate community-level-OEs, which give rise to a two-part-pricing-based mechanism that invites generalizing the cost-causation principle. Second, unlike DNEM, the community prices may not lie within the DSO NEM X rates. Third, the pricing mechanism obeys a fourthreshold policy that takes into account the community\u2019s OEs. Fourth, this work analyzes the value of joining the community over facing the DSO in a standalone setting, in addition to comparing the surplus of members when the OEs are at the member-level or the PCC-level.\nThe notations used here are standard. When necessary, boldface letters indicate column vectors as in x = (x1, . . . , xn). In particular, 1 is a column vector of all ones. For a vector x, x\u22a4 is the transpose of x. For a multivariate function f of x, we use interchangeably f(x) and f(x1, . . . , xn). For vectors x,y, x y is the element-wise inequality xi \u2264 yi for all i, and [x]+, [x]\u2212 are the element-wise positive and negative parts of vector x, i.e., [xi]\n+ := max{0, xi}, [xi]\u2212 := \u2212min{0, xi} for all i, and x = [x]+ \u2212 [x]\u2212. Also, [x]xx denotes the projection of x into the closed and convex set [x, x] as per the rule [x]xx := max{x,min{x, x}}. The notation is also used for vectors, i.e., [x]xx. Lastly, we denote by R+:= {x \u2208 R : x \u2265 0} and R\u2212:= {x \u2208 R : x \u2264 0} the set of non-negative and nonpositive real numbers, respectively.\nIn \u00a7II, we model the OEs-constrained energy community and its DER in addition to delineating the community pricing axioms and Stackelberg game. In \u00a7III, we present the OEsaware pricing policy and Stackelberg equilibrium. In \u00a7IV, we define and analyze the value of joining the community. Lastly, we present a numerical study to showcase the community performance compared to the benchmark in \u00a7V, followed by a summary of our findings in \u00a7VI. All proofs and additional theoretical results are relegated to the appendix.\nII. OES-AWARE ENERGY SHARING: MODELS, PRICING\nAXIOMS, AND STACKELBERG GAME\nWe describe the energy community structure, resources, payment and surplus functions, and the cost-causation principle in \u00a7II-A-\u00a7II-D, followed by introducing a bi-level op-\n1A two-part pricing comprises of a volumetric charge, that depends on the customer\u2019s net consumption, and a non-volumetric charge, which is a lump sum that does not vary with the customer\u2019s usage [23].\n2This is analogous to uplifts in wholesale electricity markets.\ntimization, in \u00a7II-E, that models the interaction between the community operator and its members as a Stackelberg game.\nA. Energy Community Structure\nThe profit-neutral operator receives a single bill on behalf of its N energy-sharing members, represented by the set N := {1, . . . , N}, who are subject to the operator\u2019s market mechanism that determines the pricing and payment rules (Fig.1). As depicted in Fig.1, two DSO-imposed OEs models might be practiced. The first, studied in [25],3 is when OEs must be imposed at the members\u2019 revenue meters (bottom panel) to ensure safe network operation, whereas, in the second, it is adequate to impose OEs at the community revenue meter (top panel). The first model may be more prevalent in large communities with non-adjacent loads and resources. The second model is more applicable to small to medium-sized communities such as apartment buildings, schools, farms, and medical complexes. Additionally, the aggregate-level OEs model is suitable for networks where the DSO lacks full observability of customer loads and BTM DER or finds it difficult to impose OEs at the community members\u2019 meters. Under both models, the operator\u2019s goal is to devise a market mechanism that maximizes the community\u2019s welfare given the DSO-imposed OEs. Community members respond to the operator\u2019s pricing by maximizing their own surplus through scheduling their local DER subject to their flexibility limits.\nB. Community Member DER, Payment, and Surplus\n1) Community DER: Every community member may have flexible loads and solar. The flexible loads are represented by K \u2208 K := {1, . . . ,K} devices whose load consumption bundle is denoted by the vector di \u2208 RK+ , which is bounded by the flexibility limits of the devices, i.e.,\ndi \u2208 Di := [di,di], \u2200i \u2208 N , (1)\nwhere di and di are the device bundle\u2019s lower and upper consumption limits of i \u2208 N , respectively. For a critical inflexible\n3The pricing policy under member-level OEs is in appendix.\n3 load k \u2208 K, prosumer i sets dik = dik. The community aggregate consumption is defined as dN := \u2211 i\u2208N 1 \u22a4di.\nEvery i \u2208 N member may have a random solar PV whose output is denoted by ri \u2208 R+, which may also include the member\u2019s share4 from the central solar PV.5 The community aggregate generation is defined as rN := \u2211\ni\u2208N ri. Given members\u2019 consumption and generation, the net consumption of every i \u2208 N member and their aggregate net consumption are defined as\nzi := 1 \u22a4di \u2212 ri, zN :=\n\u2211\ni\u2208N\nzi = dN \u2212 rN , (2)\nwhere zi > 0 (zi < 0) indicates a net-consuming (netproducing) member.\nUnder the aggregate-level OEs community model (Fig.1),\nthe aggregate net consumption is constrained as\nzN \u2208 ZN := [zN , zN ] (3)\nwhere zN \u2264 0 and zN \u2265 0 are the export and import envelopes at the PCC, respectively. Whereas, under the memberlevel OEs community model (Fig.1) studied in [25], the net consumption of every member is constrained, therefore,\nzi \u2208 Zi := [zi, zi] (4)\nwhere zi \u2264 0 and zi \u2265 0 are the export and import envelopes at the members\u2019 meters, respectively.6 We assume the following natural relationship between prosumer-level and aggregate-level OEs \u2211\ni\u2208N\nzi \u2264 zN , \u2211\ni\u2208N\nzi \u2265 zN . (5)\n2) Community Members Surplus: The profit-neutral community operator designs a pricing policy \u03c7 for its members that defines the payment function P \u03c7(z) := (P\u03c71 (z1), . . . , P \u03c7 N (zN )), where P \u03c7 i is the payment function for member i under \u03c7, and z := (z1, . . . , zN). The payment function may be a one-part pricing, i.e., a volumetric charge, or a two-part pricing, i.e., a combination of volumetric and non-volumetric (lump-sum) charges.\nThe surplus of every i \u2208 N community member is characterized by comfort/satisfaction from consumption and economics (payment) metrics as\nS\u03c7i (di, ri) := Ui(di) \ufe38 \ufe37\ufe37 \ufe38\nutility of consumption\n\u2212 P\u03c7i (zi) \ufe38 \ufe37\ufe37 \ufe38\npayment under \u03c7\n(6)\nwhere ri appears through (2) and, for every i \u2208 N , the utility of consumption function Ui(di) is assumed to be additive, concave, non-decreasing, and continuously differentiable with a marginal utility function Li := \u2207Ui = (Li1, . . . , LiK). We denote the inverse marginal utility vector by fi := (fi1, . . . , fiK) with fik := L \u22121 ik , \u2200i \u2208 N , k \u2208 K.\n4Utilizing the concept of virtual NEM (VNEM), the community operator assigns the solar farm\u2019s output to its members through shares, and virtually accounts for the share\u2019s output as if it was a BTM DER.\n5A central storage can be incorporated too, as described in [24]. 6The members\u2019 OEs are non-uniform because the DSO might discriminatively assign OEs within a customer class (e.g, residential), or because the community members do not all belong to a single customer class.\nC. Benchmark Prosumer DER, Payment, and Surplus\nThe benchmark to the energy community prosumer is a standalone prosumer who faces the DSO\u2019s NEM tariff. To ensure fairness when comparing the surplus of community members under the community pricing policy \u03c7 to their benchmark surplus under the DSO\u2019s regime, we consider that prosumer resources (BTM DER, and share from central generation) are the same with and without the community. The DSO ensures the distribution network\u2019s safe operation by imposing OEs at the benchmark customers\u2019 revenue meters, which constrain their net consumption zi as in (4). The benchmark payment, for every i \u2208 N , is given by the DSO\u2019s NEM X tariff, introduced in [26], as\n\u03c0NEM(zi) =\n{\n\u03c0+, zi \u2265 0 \u03c0\u2212, zi < 0 , P NEM(zi) = \u03c0 +[zi] + \u2212 \u03c0\u2212[zi] \u2212,\n(7)\nwhere \u03c0+, \u03c0\u2212 \u2265 0 are the buy (retail) and sell (export) rates.7 Consistent with the practice under NEM, we assume \u03c0+ \u2265 \u03c0\u2212, which also avoids risk-free price arbitrage, given that the retail and export rates are deterministic and known apriori. A NEM tariff with \u03c0\u2212 = \u03c0+ is referred to as NEM 1.0. Similar to community members, the surplus of the benchmark prosumer, for every i \u2208 N , is\nSNEMi (di, ri) := Ui(di)\u2212 P NEM(zi), zi := 1 \u22a4di \u2212 ri. (8)\nThe surplus-maximizing benchmark prosumer solves\nPNEMi : maximize di SNEMi (di, ri) := Ui(di)\u2212 P NEM(zi)\nsubject to zi = 1 \u22a4di \u2212 ri (9)\ndi \u2208 Di, zi \u2208 Zi.\nTo ensure that a feasible solution to (9) always exists, we assume that, for every i \u2208 N , the OEs (zi, zi) satisfy zi \u2265 1\u22a4di \u2212 ri and zi \u2264 1\n\u22a4di \u2212 ri. Given this assumption, Lemma 3 in the appendix characterizes the benchmark\u2019s maximum surplus SNEM \u2217\ni (ri) and shows that it is a function of the prosumer\u2019s renewable generation.\nD. Axiomatic Community Pricing\nTo ensure that the community pricing rule \u03c7 is fair and just for all members, we require it to satisfy Axioms 1\u20134 below that constitute the cost-causation principle. Before describing the axioms, we introduce P\u0303\u03c7i , which denotes the volumetric part of the payment function, i.e., only a volumetric charge.\nAxiom 1 (Uniform volumetric charge). The pricing rule has a uniform volumetric charge if, for any two community members i, j \u2208 N , i 6= j, having zi = zj results in P\u0303 \u03c7 i = P\u0303 \u03c7 j .\nFor the community pricing problem under consideration, the uniform volumetric charge corresponds to the coalition cost allocation axiom\u2019s broader equal treatment of equals premise.\n7Here, we do not include possible fixed connection charges in the NEM X tariff, assuming that such charges are matched by membership fees.\n4 Axiom 2 (Monotonicity and cost-causation). For every i \u2208 N , the volumetric part of the payment function P\u0303\u03c7i is monotonic and P\u0303\u03c7i (0) = 0.\nThe monotonicity in axiom 2 ensures that when any two members i, j \u2208 N , i 6= j have zizj \u2265 0 and |zi| \u2265 |zj|, then the member with higher net consumption (production) should get higher payment (compensation), i.e., |P\u0303\u03c7i (zi)| \u2265 |P\u0303 \u03c7 j (zj)|. Requiring P\u0303\u03c7i (0) = 0 in addition to monotonicity ensures that a member i \u2208 N who causes cost, i.e., zi > 0, is penalized for it, hence P\u0303\u03c7i (zi) \u2265 0, whereas if it mitigates cost, i.e., zi < 0, then it is rewarded for it, hence P\u0303\u03c7i (zi) \u2264 0.\nThe next axiom ensures the competitiveness of the community over receiving service under the DSO\u2019s NEM X regime.\nAxiom 3 (Individual rationality). The surplus of every member i \u2208 N should be no less than its benchmark, i.e., S\u03c7i \u2265 S NEM i .\nLastly, and consistent with the citizen energy community definition under [27], we require the community operator to be budget-balanced.\nAxiom 4 (Profit neutrality). The community pricing rule must\nensure the operator\u2019s profit neutrality, i.e., \u2211\ni\u2208N\nP\u03c7i (zi) = P NEM( \u2211\ni\u2208N\nzi).\nThe four axioms are used next in Definition 1.\nDefinition 1 (Cost-causation principle). A community payment function P \u03c7 conforms with the cost-causation principle if P \u03c7 \u2208 A := {P : Axioms 1\u20134 are satisfied}.\nWorth mentioning is that some of the celebrated ex-post allocation mechanisms such as the proportional rule and Shapley value violate the cost-causation principle [28]; they do not meet Axioms 1\u20132.\nE. Bi-level Optimization\nWe model the interaction between the community operator (leader) and its members (followers) as a Stackelberg game. The goal of the operator is to devise a pricing policy \u03c7 that achieves the maximum social welfare in a distributed fashion while satisfying the DSO\u2019s OEs and the generalized costcausation principle. Every member responds to the pricing policy by maximizing their own surplus subject to their local constraints via choosing a consumption scheduling policy \u03c8. 1) Lower Level \u2013 Members\u2019 Optimal Consumption Policy: Denote member\u2019s i consumption policy given the pricing policy \u03c7 by \u03c8i,\u03c7. Formally,\n\u03c8i,\u03c7 : R+ \u2192 Di, ri P \u03c7 i7\u2192 \u03c8i,\u03c7(ri).\nAssuming that all members are price-takers and surplus maximizers, the optimal consumption policy for the ith member \u03c8\u266fi,\u03c7 (given \u03c7) is such that \u03c8 \u266f i,\u03c7(ri) = d \u266f i , with\nd \u266f i := argmax\ndi\u2208Di\nS\u03c7i (di, ri) := Ui(di)\u2212 P \u03c7 i (zi)\nsubject to zi = 1 \u22a4di \u2212 ri. (10)\nNote that the consumption schedule of member i schedules is based on its DER ri, which comprises both private and shared resources and is stochastic.\n2) Upper Level \u2013 Operator\u2019s Optimal Pricing Policy:\nThe operator\u2019s pricing objective is to maximize the expected community welfare defined by the total surplus of its members\nW\u03c7,\u03c8\u03c7 := \u2211\ni\u2208N\nE[S\u03c7i (\u03c8i,\u03c7(ri), ri)],\nwhere the expectation is taken over member DERs (ri), and \u03c8\u03c7 := {\u03c81,\u03c7, . . . , \u03c8N,\u03c7}. Under Axiom 4, the (conditional) welfare maximizing pricing policy \u03c7\u266f\u03c8 (given \u03c8) is defined by \u03c7\u266f\u03c8 : R N + \u2192 R+, r 7\u2192 P \u03c7, where\nP\u03c7 := argmax P (\u00b7)\u2208A\n(\nW\u03c7\u03c8 = E [\u2211\ni\u2208N\nUi(\u03c8 \u266f i,\u03c7(ri))\u2212 P NEM(zN ) ] )\nsubject to zN = \u2211\ni\u2208N\n( \u03c8\u266fi,\u03c7(ri)\u2212 ri ) (11)\nzN \u2208 ZN .\nThe infinite-dimensional program in (11) cannot be solved easily without exploiting the NEM tariff structure.\n3) Stackelberg Equilibrium: The bi-level optimization above defines the so-called Stackelberg equilibrium (or Stackelberg strategy). Specifically, (\u03c7\u2217,\u03c8\u2217) is a Stackelberg equilibrium since (a) for all \u03c7 \u2208 X and i \u2208 N , S\u03c7i (\u03c8 \u2217 i (ri), ri) \u2265 S\u03c7i (\u03c8i(ri), ri) for all \u03c8 \u2208 \u03a8; (b) for all \u03c8 \u2208 \u03a8,W \u03c7\u2217,\u03c8\u2217 \u2265 E[ \u2211\ni S \u03c7 i (\u03c8 \u2217 i (ri), ri)]. Specifically, the Stackelberg equilibrium is the optimal community pricing when community members optimally respond to the community pricing.\nIII. TWO-PART PRICING AND STACKELBERG\nEQUILIBRIUM\nIn this section, we present the community pricing policy and its structural properties, followed by showing the optimal response of members, and the corresponding community market equilibrium to the bi-level optimization in (10)-(11).\nA. OEs-Aware Pricing Policy\nThe operator announces the community pricing policy given\nthe aggregate renewable DG rN as shown next.\nOEs-aware pricing policy. For every i \u2208 N , the OEs-aware energy community pricing policy is\n\u03c7\u2217 : r 7\u2192 P\u03c7 \u2217\ni (zi) = \u03c0 \u2217(rN ) \u00b7 zi \ufe38 \ufe37\ufe37 \ufe38\nvolumetric charge\n\u2212 A\u2217i (rN ) \ufe38 \ufe37\ufe37 \ufe38\nnon-volumetric charge\n,\n5 with threshold-based volumetric and non-volumetric charges\n\u03c0\u2217(rN ) =\n \n\n\u03c7+(rN ) , rN \u2264 \u03c31 \u03c0+ , rN \u2208 (\u03c31, \u03c32) \u03c7z(rN ) , rN \u2208 [\u03c32, \u03c33] \u03c0\u2212 , rN \u2208 (\u03c33, \u03c34) \u03c7\u2212(rN ) , rN \u2265 \u03c34,\n(12)\nA\u2217i (rN ) =\n \n\n(\u03c7+(rN )\u2212 \u03c0+) ( zi + zN\u2212 \u2211 i\u2208N zi\nN\n)\n, rN \u2264 \u03c31\n(\u03c7\u2212(rN )\u2212 \u03c0\u2212) ( zi + zN\u2212 \u2211 i\u2208N zi N ) , rN \u2265 \u03c34\n0 , otherwise,\n(13)\nwhere the four thresholds \u03c31 \u2264 \u03c32 \u2264 \u03c33 \u2264 \u03c34 are defined as\n\u03c31 := \u03c32 \u2212 zN , \u03c33 := \u2211\ni\u2208N\n1 \u22a4[fi(1\u03c0 \u2212)]didi\n\u03c32 := \u2211\ni\u2208N\n1 \u22a4[fi(1\u03c0 +)]did i\n\u03c34 := \u03c33 \u2212 zN ,\nand the prices \u03c7+(rN ) := \u00b5 \u2217 1(rN ), \u03c7 z(rN ) := \u00b5 \u2217 2(rN ), \u03c7\u2212(rN ) := \u00b5 \u2217 3(rN ) are, respectively, the solutions of: \u2211\ni\u2208N\n1 \u22a4[fi(1\u00b51)] di di = rN + zN (14)\n\u2211\ni\u2208N\n1 \u22a4[fi(1\u00b52)] di di = rN (15)\n\u2211\ni\u2208N\n1 \u22a4[fi(1\u00b53)] di di = rN + zN . (16)\nThe prices have the following order\n\u03c7+(rN ) \u2265 \u03c0 + \u2265 \u03c7z(rN ) \u2265 \u03c0 \u2212 \u2265 \u03c7\u2212(rN ) \u2265 0.\nFundamentally, the price \u03c0\u2217(rN ) is used to induce a welfare-maximizing members\u2019 response. A two-part pricing is necessary because when the OEs bind, the community operator accrues a profit due to the difference between \u03c0NEM(zN ) and \u03c0\u2217(rN ), given by\n\u2211\ni\u2208N\nA\u2217i (rN ) =\n \n\n(\u03c7+(rN )\u2212 \u03c0+)zN , rN \u2264 \u03c31 (\u03c7\u2212(rN )\u2212 \u03c0\u2212)zN , rN \u2265 \u03c34 0 , otherwise.\nThis profit is re-distributed to the members using the proportional allocation in (13), which, as shown in Lemma 2, is crucial in achieving profit-neutrality (Axiom 4) and individual rationality (Axiom 3). Given that there might be other allocation rules to distribute the profit, while not violating the pricing axioms, one could use the price in (12) and construct a profit-sharing coalitional game to distribute the operator profit to the coalition (community) members.\nWe discuss next the structural properties and intuitions of the OEs-aware pricing policy, depicted in Fig.2, and show how it differs from the pricing policy when there are no OEs [24] and when the OEs are at the member-level [25].\na) Two-part pricing: The pricing rule P\u03c7 \u2217\ni (\u00b7) charges or compensates members based on a two-part pricing. The volumetric charge is the product of the dynamic price in (12) and the member\u2019s net consumption zi. The non-volumetric part\n(13) is a reward (A\u2217i \u2265 0) paid to each member whenever rN /\u2208 (\u03c31, \u03c34). The reward each member gets is proportional to their benchmark\u2019s OEs zi, zi plus any benefit due to aggregation (zN \u2212 \u2211 i\u2208N zi, zN \u2212 \u2211\ni\u2208N zi). b) Four-thresholds and resource-aware policy: The structure of the dynamic price \u03c0\u2217 obeys four renewable-independent thresholds that depend only on the DSO\u2019s NEM X rates, OEs, and members\u2019 willingness to consume. The price and nonvolumetric rewards are both announced based on rN (Fig.2), with the price \u03c0\u2217(rN ) being a monotonically decreasing function of rN . The payment transitions from two-part to onepart and then to two-part again, as rN increases. The payment function is two-part only when one of the OEs binds.\nc) Privacy-preserving mechanism: The four thresholds \u03c31\u2212 \u03c34 can be computed without compromising members\u2019 privacy. In particular, the values [fi(1\u03c0 +)]didi and [fi(1\u03c0 \u2212)]didi are provided apriori by the members, given the public NEM rates, from which the operator can compute \u03c31 \u2212 \u03c34. The key to compute the dynamic prices \u03c7+(rN ), \u03c7 z(rN ), \u03c7 \u2212(rN ) is that they are bounded. The operator asks members to provide a value for each price sample, which are then employed by the operator to compute (14)-(16) using rN and the OEs. d) Non-discriminatory volumetric charge: The price \u03c0\u2217 is uniform to all members, and it is always within NEM X price range except when rN /\u2208 (\u03c31, \u03c34). Also, unlike the DSO\u2019s NEM tariff in (7), the operator charges its members a price that is not contingent on the member\u2019s net consumption zi. If the DSO\u2019s OEs are non-discriminatory, i.e., zi = z, zi = z, \u2200i \u2208 N , then the community\u2019s non-volumetric charge also becomes non-discriminatory (uniform), as\nA\u2217i (rN ) =\n \n\n(\u03c7+(rN )\u2212 \u03c0+)zN /N , rN \u2264 \u03c31 (\u03c7\u2212(rN )\u2212 \u03c0\u2212)zN /N , rN \u2265 \u03c34 0 , otherwise.\nThe distribution of the accrued profit above is simply based on the equal division allocation. e) Endogenously-determined market roles: Unlike conventional electricity markets, where the roles of buyers and sellers are predetermined, the proposed pricing policy allows the members to determine their roles (see \u00a7III-B).\n6 As shown in Fig.2, the price lies between the DSO\u2019s NEM X retail \u03c0+ and export \u03c0\u2212 rates when rN \u2208 (\u03c31, \u03c34). In particular, the community directly passes the DSO prices \u03c0+ and \u03c0\u2212 when rN \u2208 (\u03c31, \u03c32) and rN \u2208 (\u03c33, \u03c34), respectively, and charge a price that dynamically varies between \u03c0+ and \u03c0\u2212 depending on rN when rN \u2208 [\u03c32, \u03c33] (similar to D-NEM without OEs [24], yellow curve in Fig.2), and with OEs [25], see the appendix). When rN is relatively low (rN \u2264 \u03c31) and the import OE is binding, the operator charges a price higher than \u03c0+ to induce its members to reduce consumption, ensuring that zN = zN . On the other hand, when rN is relatively high (rN \u2265 \u03c34) and the export OE is binding, the operator charges a price below \u03c0\u2212 to behoove its members to increase consumption, ensuring that zN = zN .\nThe intuition of the non-volumetric reward A\u2217i is that because the operator charges a higher price \u03c7+(rN ) \u2265 \u03c0+ when rN is low rN \u2264 \u03c31, and charges a lower price \u03c7\u2212(rN ) \u2264 \u03c0\u2212 when rN is high rN \u2265 \u03c34, it compensates its members for the losses in the volumetric charge through the non-volumetric rewards. The reward each customer gets A\u2217i is proportional to their benchmark\u2019s OEs zi, zi because the operator needs to better reward customers with less restrictive OEs to ensure that they have enough incentive to join the community, which is required to satisfy the individual rationality axiom. 1) Comparison to Member-Level OEs: We highlight two key differences between the pricing mechanism of a community with aggregate-level and member-level OEs (\u00a7A). First, under the aggregate-level OEs framework, the pricing policy induces the members toward a collective response that abides by the OEs, whereas under member-level OEs, the price (\u03c0DNEM(r) in 22) is announced and members must account for their local OEs when scheduling their consumption. This fundamental difference resulted in a rather simpler policy in the member-level OEs framework, which abides by onepart pricing with a two-threshold (\u03981(r),\u03982(r)) price that is bounded between the NEM X prices, i.e., \u03c0DNEM(r) \u2208 [\u03c0\u2212, \u03c0+]. Second, to compute the price, the member-level OEs community operator needs full information about community renewable DG r, whereas in the aggregate-level OEs framework, only the aggregate DG rN is needed.\nB. Community Member Problem and Optimal Decisions\nGiven rN , the community price is announced, and accordingly every member i \u2208 N solves for the optimal consumption policy \u03c8\u2217i,\u03c7\u2217 : R+ \u2192 Di, ri P \u03c7\u2217 i7\u2192 d\u03c8 \u2217 i := \u03c8 \u2217 i (ri), where\nd \u03c8\u2217\ni =argmax di\u2208Di\nS\u03c7 \u2217 i (di, ri) := Ui (di)\u2212 P \u03c7\u2217 i (zi)\nsubject to zi = 1 \u22a4di \u2212 ri (17)\nThe following lemma characterizes the optimal consumption and net consumption of the members, and the community.\nLemma 1 (Member optimal consumption). For every member i \u2208 N , given the pricing policy, the maximum surplus S\u03c7 \u2217\ni (\u03c8 \u2217 i (ri), ri) is achieved by the optimal consumption and\nnet consumption given, respectively, by\nd \u03c8\u2217\ni (\u03c0 \u2217) = [fi(1\u03c0 \u2217)]didi , z\u03c8\n\u2217\ni (\u03c0 \u2217) = 1\u22a4d\u03c8\n\u2217\ni (\u03c0 \u2217)\u2212 ri, (18)\nProof: See the appendix. Given rN , and the optimal schedule of every member in Lemma 1, the community aggregate consumption is d\u03c8 \u2217\nN (\u03c0 \u2217)=\n\u2211\ni\u2208N d \u03c8\u2217 i (\u03c0 \u2217) and aggregate net consumption is\nz\u03c8 \u2217\nN (\u03c0 \u2217) =\n\u2211\ni\u2208N\nz\u03c8 \u2217\ni (\u03c0 \u2217)=\n  \n \nzN , rN \u2264 \u03c31 d\u03c8 \u2217\nN (\u03c0 +)\u2212 rN , rN \u2208 (\u03c31, \u03c32)\n0 , rN \u2208 [\u03c32, \u03c33] d\u03c8 \u2217\nN (\u03c0 \u2212)\u2212 rN , rN \u2208 (\u03c33, \u03c34)\nzN , rN \u2265 \u03c34.\n(19)\nFig.3 depicts the optimal aggregate consumption d\u03c8 \u2217\nN and\nnet consumption z\u03c8 \u2217\nN , which define the community operational\nzones. One can see the monotonicity of z\u03c8 \u2217\nN in rN and that the prices \u03c7+(rN ), \u03c7\n\u2212(rN ) are essentially dual variables of the import, and export OE constraints, respectively. \u03c7z(rN ) is the dual variable of energy balancing the community. The community is net-consuming when rN \u2264 \u03c32, net-producing when rN \u2265 \u03c34, and energy-balanced when rN \u2208 [\u03c32, \u03c33].\nC. Stackelberg Equilibrium and Properties\nGiven the optimal response of the benchmark (Lemma 3) and the community member (Lemma 1), and the pricing policy in \u00a7III-A, the following Lemma 2 establishes cost causation conformity of the OEs-aware pricing policy.\nLemma 2 (Cost-causation conformity). The OEs-aware pricing policy \u03c7\u2217 conforms with the cost-causation principle, i.e., P \u03c7 \u2217 \u2208 A.\nProof: See the appendix. A major result from Lemma 2 is that every member i \u2208 N under the proposed pricing policy achieves a surplus no less than its benchmark, i.e., S\u03c7 \u2217\ni (\u03c8 \u2217 i (ri), ri) \u2265 S\nNEM \u2217\ni (ri), where SNEM \u2217\ni (ri) is the optimal surplus of the benchmark (Lemma 3).\nTheorem 1 below establishes the Stackelberg equilibrium\nunder the proposed OEs-aware pricing policy.\nTheorem 1 (Equilibrium and welfare optimality). The solution (\u03c7\u2217, \u03c8\u2217) is an equilibrium to (10)-(11). Also, the equilibrium\n7 solution achieves the community maximum social welfare\nunder centralized operation, i.e.,\n(d\u03c8 \u2217 1 , . . . ,d \u03c8\u2217\nN ) = argmax (di,...,dN )\nE [\u2211\ni\u2208N\nUi(di)\u2212 P NEM(zN )\n]\nsubject to zN = \u2211\ni\u2208N\n( 1 \u22a4di \u2212 ri )\nzN \u2208 ZN ,di \u2208 Di \u2200i \u2208 N .\nProof: See the appendix. The proof of Theorem 1 leverages Lemmas 1\u20132 above, Lemma 3 in the appendix that characterizes the maximum surplus of the benchmark and Lemma 4 in the appendix that solves for the community maximum welfare under centralized operation. Theorem 1 also implies that the maximum community welfare is wholly distributed to the members.\nIV. VALUE OF COMMUNITY\nWe showed in Lemma 2 that for every member under the OEs-aware pricing policy, joining the community is advantageous, as it achieves surplus levels no less than the maximum surplus of the benchmark. To quantify and analyze this added benefit after joining the community, we introduce the value of community (VoC) metric, defined as the aggregate expected difference between community members\u2019 surplus under the OEs-aware pricing policy and the benchmark surplus8\nVoC\u03c7 \u2217,NEM:=\n\u2211\ni\u2208N\nVoC \u03c7\u2217,NEM i :=\n\u2211\ni\u2208N\nE\n[\nS\u03c7 \u2217\ni (\u03c8 \u2217 i (ri), ri)\u2212 S\nNEM \u2217 i (ri) ] ,\n(20)\nwhere VoC \u03c7\u2217,NEM i is the value gained by member i after joining the community,9 and the expectation is taken over ri. From Lemma 2, we know that VoC\n\u03c7\u2217,NEM i \u2265 0. Corollary 1 below\ncompares the benchmark prosumer\u2019s surplus given in Lemma 3 in the appendix to the member surplus under equilibrium.\nCorollary 1 (Member and community net-consumption complementarity). For every member i \u2208 N under the OEsaware pricing policy, if \u03c0\u2212 < \u03c0+, \u2211\ni\u2208N zi < zN and\u2211 i\u2208N zi > zN , then VoC \u03c7\u2217,NEM i > 0 except in the following three cases\n(i) rN \u2208 [\u03c31, \u03c32], ri \u2264 \u2206i2 := [fi(1\u03c0 +)]did\ni\n(ii) rN \u2208 [\u03c33, \u03c34], ri \u2265 \u2206i3 := [fi(1\u03c0 \u2212)]didi\n(iii) rN \u2208 [\u03c32, \u03c33], 1\u22a4d \u03c8\u2217 i (\u03c0 \u2217) = ri, under which VoC \u03c7\u2217,NEM i = 0.\nProof: See the appendix. Dually, Corollary 1 (depicted in Fig.4) gives the conditions for strict individual rationality. As shown in Fig.4, the corollary indicates that whenever the community OEs constraints are binding, all members achieve a strictly positive benefit over their benchmark. Also, if neither the community OEs nor the benchmark OEs are binding, whenever the benchmark\u2019s optimal net consumption sign sgn{zNEM \u2217\ni (ri)} (derived in Lemma 3) opposes the community\u2019s aggregate net consumption sign\n8VoC definition is analogous to the value of storage definition in [29]. 9There are still un-captured values for joining an energy community, such\nas wider DER accessibility and improved economies of scale.\nTABLE I VOC COMPARATIVE STATICS (PROPOSITION 1).\n\u2014\u2013 rN \u2264 \u03c31 rN \u2208 (\u03c31, \u03c32) rN \u2208 [\u03c32, \u03c33] rN \u2208 (\u03c33, \u03c34) rN \u2265 \u03c34\nri \u2264 \u2206i1 \u2193 0 \u2191 0 \u2193 0 0 0 \u2191 0 0 0 \u2191 \u2193 0 0 \u2191 \u2191 0 \u2193 ri \u2208 (\u2206i1,\u2206 i 2 ) \u2193 0 \u2191 0 0 0 0 0 \u2191 0 0 0 \u2191 \u2193 0 0 \u2191 \u2191 0 \u2193 ri \u2208 [\u2206i2,\u2206 i 3 ] \u2193 0 \u2191 0 \u2191 0 0 0 0 0 0 0 0 \u2193 0 0 0 \u2191 0 \u2193 ri \u2208 (\u2206i3,\u2206 i 4 ) \u2193 \u2193 \u2191 0 \u2191 \u2193 0 0 0 \u2193 0 0 0 0 0 0 0 \u2191 0 \u2193\nri \u2265 \u2206 i 4 \u2193 \u2193 \u2191 0 \u2191 \u2193 0 0 0 \u2193 0 0 0 \u2191 0 0 0 \u2191 0 \u2193\n\u2021Each color represents \u01eb-increases of one exogenous parameter (\u03c0+, \u03c0\u2212, zN , zN ) while fixing all others.\n\u03c0+: retail rate, \u03c0\u2212: export rate, zN : import OE, zN : export OE.\n\u2191: increasing, \u2193: decreasing, 0: unchanged.\nsgn{z\u03c8 \u2217\nN (rN )}, i.e., sgn{z NEM\n\u2217 i (ri)} 6= sgn{z \u03c8\u2217\nN (rN )} the member is strictly better than its benchmark. The yellow point in Fig.4 represents condition (iii) in Corollary 1.\nThe following proposition shows the monotonicity of the\nVoC of every member with the OEs.\nProposition 1 (VoC comparative statics analysis). For every member i \u2208 N under the OEs-aware pricing policy, the value of joining the community VoC\n\u03c7\u2217,NEM i monotonically increases\nwith the import OE zN and monotonically decreases with the export OE zN .\nFurthermore, VoC \u03c7\u2217,NEM i monotonically increases with \u03c0 +, except rN \u2264 \u03c31, \u2200ri \u2208 R+ and when rN \u2208 (\u03c31, \u03c32), ri \u2264 \u2206i1, under which the VoC\n\u03c7\u2217,NEM i monotonically decreases.\nLastly, VoC \u03c7\u2217,NEM i monotonically decreases with \u03c0 \u2212, except when rN \u2265 \u03c34, \u2200ri \u2208 R+ and when rN \u2208 (\u03c33, \u03c34), ri \u2264 \u2206i4 under which the VoC\n\u03c7\u2217,NEM i monotonically increases.\nProof: See the appendix. Table I summarizes the detailed comparative static analysis in Proposition 1 by considering \u01eb-increases of the exogenous parameters (\u03c0+, \u03c0\u2212, zN , zN ). The monotonicity with (zN , zN ) indicates the increased willingness of DSO prosumers to join the community when the community\u2019s OEs become less restrictive than their aggregate individual OEs, which is a straightforward benefit of aggregation. From Table I, increasing \u03c0+ increases the VoC when the community price is < \u03c0+ and when the community price is \u03c0+, but the benchmark\u2019s import OE does not bind. Conversely, increasing \u03c0\u2212 decreases the VoC decreases whenever the community price is > \u03c0\u2212 and when the community price is \u03c0\u2212, but the benchmark\u2019s export OE does not bind.\nLastly, we draw a stronger statement about the optimality\n8 of member surplus under a community with aggregate-level OEs compared to a community with member-level OEs (see Fig.1).\nTheorem 2 (Surplus optimality). Give ri, and rN , if an aggregate-level OEs and a member-level OEs communities are both in the net-consuming or net-producing zones then\nthe surplus of a prosumer in the former community is no less than its surplus in the latter, i.e., if rN < \u03c32 and rN < \u03981(r) or rN > \u03c33 and rN > \u03982(r) then\nS\u03c7 \u2217\ni (\u03c8 \u2217 i (ri), ri) \u2265 S \u2217,DNEM i (ri),\nwhere S\u2217,DNEMi (ri) is the maximum member surplus under DNEM with member-level OEs, and (\u03981(r),\u03982(r)) are D-NEM thresholds [25].\nProof: See the appendix. Whereas the welfare sub-optimality of a community with member-level OEs to a community with aggregate-level OEs is straightforward, as the former has a smaller feasible solution space, the surplus sub-optimality of members in the memberlevel OEs community to members in the aggregate-level OEs is less obvious. Roughly speaking, the reason for this surplus sub-optimality is that enforcing OEs at the members\u2019 meters rather than at the community\u2019s revenue meter, restricted energy sharing. Indeed, when the member-level OEs are binding, members who were buyers under aggregate-level OEs are now forced to reduce their consumption, and members who were sellers are now forced to increase their self-consumption instead. This prevented both buyers and sellers from transacting at the community price, which is always better than the DSO\u2019s NEM price. A direct result of Lemma 2, Theorem 1 in [25], and Theorem 2 is the following surplus order\nS\u03c7 \u2217\ni (\u03c8 \u2217 i (ri), ri) \u2265 S \u2217,DNEM i (ri) \u2265 S NEM \u2217 i (ri),\nwhere the first inequality holds only under the conditions in Theorem 2.\nV. NUMERICAL STUDY\nWe constructed hypothetical energy community with N = 20 residential customers (4 of which do not have BTM generation), whereby the 20 households pool and aggregate their resources behind a DSO revenue meter under a NEM tariff. A one-year DER data10 was used. The DSO\u2019s NEM tariff has a ToU-based (retail rate \u03c0+) with \u03c0+ ON\n= $0.40/kWh and \u03c0+\nOFF = $0.20/kWh as on- and off-peak prices, respectively,\nand an (export rate \u03c0\u2212) that is based on the wholesale market price.11 The DSO OEs are varied, but we assumed \u2211\ni\u2208N zi = zN = \u2212zN = \u2212 \u2211\ni\u2208N zi. We assumed a quadratic concave and non-decreasing utility\nfunction for every i \u2208 N , given by\nUi(di) =\n{\n\u03b1idi \u2212 1 2\u03b2id 2 i , 0 \u2264 di \u2264 \u03b1i \u03b2i \u03b12i 2\u03b2i , di > \u03b1i \u03b2i ,\n(21)\n10We used 2018 PecanStreet data for households in Austin, TX with 15- minute granularity.\n11We used the averaged 2018 real-time wholesale prices in Texas. The data is accessible at ERCOT.\nwhere \u03b1i, \u03b2i are parameters that were learned and calibrated using historical retail prices12 and consumption,13 and by assuming an elasticity of 0.21 taken from [30] (see appendix D in [9]).\nA. Community Members\u2019 Payments and Surpluses\nFigure 5 shows the average monthly community member\u2019s payment, percentage surplus difference over the benchmark, and the absolute value of the percentage ratio of volumetric to fixed charge under three different OEs settings. It also shows the surplus difference of members in a community with member-level OEs.\nFour main observations on the surplus difference (red asterisks and squares) are in order. First, members under communities with aggregate-level and member-level OEs achieved a higher surplus than their benchmark (Theorem 1 and Theorem 1 in [25]). For members who achieved higher surplus differences, it indicates that their benchmarks experienced high surplus loss due to standalone customer OEs. Second, tightening the OEs, made it, in general, more advantageous to join the community. The average surplus difference of the 20 customers under 120kW, 60kW, and 54kW OEs was approximately 5%, 8%, and 12%, respectively. Third, community members under aggregate-level OEs achieved a higher surplus than community members under member-level OEs (Theorem 2), and the difference was higher when the OEs were tighter. The average difference between the gain of members under communities with aggregate-level and member-level OEs was 0.03%, 2.91%, and 6.14% for 120kW, 60kW, and 54kW OEs, respectively. Fourth, non-solar adopters (members with asterisks) suffered the most as the OEs became tighter, which is because when they operate in standalone settings they were highly vulnerable to the import rate. One can see that although customers 11\u2217, 16\u2217, and 17\u2217 were the highest surplus difference achievers under 120kW OEs, their performance significantly degraded when the OEs were tightened to 54kW.\nAdditionally, one can see that the average monthly payment (blue dots) of aggregate-level OEs framework\u2019s community members did not change much when the OEs were tightened, because the fixed reward compensated customers when they faced > \u03c0+ buy rates (when the import OE was binding) and < \u03c0\u2212 sell rates (when the export OE was binding). The volumetric to fixed reward ratio (bar chart) helps in understanding this phenomenon. When OEs were relaxed (i.e., in the 120kW case), the ratio was effectively \u221e as the OEs were never binding. As the OEs were further constrained to 60kW and 54kW, the average ratio reduced to 39.4% and 19.55%, respectively, which shows that fixed rewards increased to compensate for the loss in volumetric charge, keeping the overall payment only slightly changed.\nB. Daily Community Price\nFigure 6 shows the aggregate-level OEs community\u2019s daily price over a year (dotted curves) and the average daily price\n12We used Data.AustinTexas.gov historical residential rates in Austin, TX. 13We used pre-2018 PecanStreet data for households in Austin, TX.\n9\n(yellow curves) under different OEs. For this particular figure, we set the sell rate at \u03c0\u2212 = $0.1/kWh. In hours with binding import OE, the community price became higher than \u03c0+, as the operator charges a higher price to reduce consumption. Whereas, when the export OE was binding, the price became less than \u03c0\u2212, as the operator charges a lower price to encourage higher consumption, hence locally consuming the excess renewables. Therefore, when the OEs were set at 44kW, the community price exceeded the NEM X rates in many instances, as the OEs were binding more often. The same goes for 54kW OEs. By further relaxing the OEs, the community price stayed within the NEM X rates, as it dynamically ranged between \u03c0+ and \u03c0\u2212 passing by \u03c7z . Indeed, at 120kW OEs, the daily price never oscillated between and never exceeded \u03c0+ and \u03c0\u2212, mimicking the community pricing policy without OEs, i.e., Dynamic NEM in [24].\nC. Community Price and Aggregate Net Consumption\nFigure 7 shows histograms of the hourly aggregate-level OEs community price (left column) and aggregate net consumption (right column), over the studied year, under OEs zN = \u2212zN = 54kW (top), zN = \u2212zN = 60kW\n(middle), and zN = \u2212zN = 120kW (bottom). First, note that the frequency of the prices $0.4/kWh and $0.2/kWh was high because the ToU retail rate \u03c0+ can only take these values, whereas the sell rate \u03c0\u2212 can take any value between $0.04/kWh to $0.15/kWh. When the OEs were high, zN = \u2212zN = 120kW, the community price never exceeded \u03c0+, as the import OE was never binding. When the OE decreased to zN = \u2212zN = 60kW, the frequency of $0.4/kWh and $0.2/kWh decreased as the community price crossed \u03c0+ (note the higher frequency of prices \u03c7+ ON\n> $0.4/kWh and \u03c7+\nOFF > $0.2/kWh) whenever the import rate was binding. This phenomenon was even clearer when the OEs were decreased to zN = \u2212zN = 54kW, under which \u03c7 + ON exceeded $0.7/kWh in some hours. The same observation can be extended to the export side, under which the community is charged with \u03c7\u2212 < \u03c0\u2212, whenever the export OE was binding. This however was not clear from the plots, because the community\u2019s generation was relatively low compared to consumption.\nThe dynamic aggregate net consumption plots (right column) show how the community price managed the community\u2019s operation at the PCC, by inducing its members to consume more when the export OE was binding and consume less when the import OE was binding.\nVI. CONCLUSION\nThis work proposes an energy community market mechanism that incorporates the DSO\u2019s dynamic OEs into its pricing structure. The mechanism induces a collective member response that not only satisfies the community operational limits but also decentrally maximizes the community social welfare while meeting the pricing axioms for equitable welfare allocations. The market mechanism charges its members via a two-part dynamic and resource-aware pricing, whereby, the OEs-awareness and welfare optimality are achieved through the dynamic price, and the non-volumetric part of the pricing is designed to ensure profit-neutrality, and member rationality, characterized by achieving benefits higher than possible outside the community. The community price is a monotonically decreasing function of the aggregate renewable generation in the community. The two-part pricing is threshold-based, with\n10\nthresholds that can be computed apriori and in a privacypreserving way. We analyzed the value of joining the community for each member and discovered multiple properties, including net-consumption complementarity and comparative statics with parameters like the DSO\u2019s NEM rates and OEs.\nSeveral limitations of this work are worth pursuing as future directions. Firstly, we assumed rational prosumers who react to the price by maximizing their own surplus, which might not be the case in practice, as there exists significant empirical evidence showing that most prosumers exercise price-unaware consumption decisions. Second, it would be interesting to exten this work to the scenario of curtailable renewable DG.\nREFERENCES\n[1] M. Z. Liu, L. N. Ochoa, S. Riaz, P. Mancarella, T. Ting, J. San, and J. Theunissen, \u201cGrid and market services from the edge: Using operating envelopes to unlock network-aware bottom-up flexibility,\u201d IEEE Power and Energy Magazine, vol. 19, no. 4, 2021. [2] B. Liu and J. H. Braslavsky, \u201cRobust dynamic operating envelopes for DER integration in unbalanced distribution networks,\u201d IEEE Transactions on Power Systems, 2023. [3] B. Cui, A. Zamzam, and A. Bernstein, \u201cNetwork-cognizant time-coupled aggregate flexibility of distribution systems under uncertainties,\u201d IEEE Control Systems Letters, vol. 5, no. 5, pp. 1723\u20131728, 2021. [4] D. Lee, H. D. Nguyen, K. Dvijotham, and K. Turitsyn, \u201cConvex restriction of power flow feasibility sets,\u201d IEEE Transactions on Control of Network Systems, vol. 6, no. 3, pp. 1235\u20131245, 2019. [5] G. Lankeshwara, R. Sharma, R. Yan, T. K. Saha, and J. V. Milanovic\u0301, \u201cTime-varying operating regions of end-users and feeders in low-voltage distribution networks,\u201d IEEE Trans. on Power Systems, pp. 1\u201312, 2023. [6] Y. Yang, G. Hu, and C. J. Spanos, \u201cOptimal sharing and fair cost allocation of community energy storage,\u201d IEEE Trans. Smart Grid, vol. 12, no. 5, Sep. 2021. [7] G. Ferro, M. Robba, R. Haider, and A. M. Annaswamy, \u201cA distributedoptimization-based architecture for management of interconnected energy hubs,\u201d IEEE Transactions on Control of Network Systems, vol. 9, no. 4, pp. 1704\u20131716, 2022.\n[8] National Academies of Sciences, Engineering, and Medicine, The Role of Net Metering in the Evolving Electricity System. The National Academies Press, 2023. [9] A. S. Alahmed and L. Tong, \u201cIntegrating distributed energy resources: Optimal prosumer decisions and impacts of net metering tariffs,\u201d SIGENERGY Energy Inform. Rev., vol. 2, no. 2, Aug. 2022. [10] L. Han, T. Morstyn, and M. McCulloch, \u201cIncentivizing prosumer coalitions with energy management using cooperative game theory,\u201d IEEE Trans. Power Systems, vol. 34, no. 1, 2019. [11] Y. Chen, C. Zhao, S. H. Low, and S. Mei, \u201cApproaching prosumer social optimum via energy sharing with proof of convergence,\u201d IEEE Trans. Smart Grid, vol. 12, no. 3, 2021. [12] P. Chakraborty, E. Baeyens, P. P. Khargonekar, K. Poolla, and P. Varaiya, \u201cAnalysis of solar energy aggregation under various billing mechanisms,\u201d IEEE Trans. Smart Grid, vol. 10, no. 4, 2019. [13] G. E. Rahi, S. R. Etesami, W. Saad, N. B. Mandayam, and H. V. Poor, \u201cManaging price uncertainty in prosumer-centric energy trading: A prospect-theoretic stackelberg game approach,\u201d IEEE Trans. Smart Grid, vol. 10, no. 1, 2019. [14] N. Vespermann, T. Hamacher, and J. Kazempour, \u201cAccess economy for storage in energy communities,\u201d IEEE Transactions on Power Systems, vol. 36, no. 3, pp. 2234\u20132250, 2021. [15] M. Z. Liu, L. F. Ochoa, P. K. C. Wong, and J. Theunissen, \u201cUsing OPFbased operating envelopes to facilitate residential der services,\u201d IEEE Transactions on Smart Grid, vol. 13, no. 6, pp. 4494\u20134504, 2022. [16] L. Blackhall, \u201cOn the calculation and use of dynamic operating envelopes,\u201d Project EVOLVE, Tech. Rep., Nov. 2020. [Online]. Available: https://rb.gy/k362o [17] Y. Zabihinia Gerdroodbari, M. Khorasany, and R. Razzaghi, \u201cDynamic PQ operating envelopes for prosumers in distribution networks,\u201d Applied Energy, vol. 325, p. 119757, 2022. [Online]. Available: https://www.sciencedirect.com/science/article/pii/S0306261922010406 [18] Y. Yi and G. Verbic\u030c, \u201cFair operating envelopes under uncertainty using chance constrained optimal power flow,\u201d Electric Power Systems Research, vol. 213, p. 108465, 2022. [Online]. Available: https://www.sciencedirect.com/science/article/pii/S0378779622005995 [19] S. C. Ross and J. L. Mathieu, \u201cA method for ensuring a load aggregator\u2019s power deviations are safe for distribution networks,\u201d Electric Power Systems Research, vol. 189, p. 106781, 2020. [20] J. Gasser, H. Cai, S. Karagiannopoulos, P. Heer, and G. Hug, \u201cPredictive energy management of residential buildings while self-reporting flexibility envelope,\u201d Applied Energy, vol. 288, p. 116653, 2021. [21] S. Ross and J. Mathieu, \u201cStrategies for network-safe load control with a third-party aggregator and a distribution operator,\u201d IEEE Transactions on Power Systems, vol. 36, no. 4, pp. 3329\u20133339, 2021. [22] M. I. Azim, G. Lankeshwara, W. Tushar, R. Sharma, M. R. Alam, T. K. Saha, M. Khorasany, and R. Razzaghi, \u201cDynamic operating envelopeenabled P2P trading to maximise financial returns of prosumers,\u201d IEEE Transactions on Smart Grid, pp. 1\u20131, 2023. [23] W. Y. Oi, \u201cA disneyland dilemma: Two-part tariffs for a mickey mouse monopoly,\u201d The Quarterly Journal of Economics, vol. 85, no. 1, pp. 77\u201396, 1971. [Online]. Available: http://www.jstor.org/stable/1881841 [24] A. S. Alahmed and L. Tong, \u201cDynamic net metering for energy communities,\u201d IEEE Transactions on Energy Markets, Policy and Regulation, pp. 1\u201312, 2024. [25] A. S. Alahmed, G. Cavraro, A. Bernstein, and L. Tong, \u201cOperatingenvelopes-aware decentralized welfare maximization for energy communities,\u201d in 2023 59th Annual Allerton Conference on Communication, Control, and Computing (Allerton), 2023, pp. 1\u20138. [26] A. S. Alahmed and L. Tong, \u201cOn net energy metering X: Optimal prosumer decisions, social welfare, and cross-subsidies,\u201d IEEE Trans. Smart Grid, vol. 14, no. 02, 2023. [27] \u201cEnergy communities, European Commission.\u201d [Online]. Available: https://shorturl.at/cdyY0 [28] P. Chakraborty, E. Baeyens, and P. P. Khargonekar, \u201cCost causation based allocations of costs for market integration of renewable energy,\u201d IEEE Trans. on Power Systems, vol. 33, no. 1, 2018. [29] Y. Xu and L. Tong, \u201cOptimal operation and economic value of energy storage at consumer locations,\u201d IEEE Transactions on Automatic Control, vol. 62, no. 2, pp. 792\u2013807, 2017. [30] A. Asadinejad, A. Rahimpour, K. Tomsovic, H. Qi, and C. fei Chen, \u201cEvaluation of residential customer elasticity for incentive based demand response programs,\u201d Electric Power Systems Research, 2018. [31] Z.-Q. Luo, J.-S. Pang, and D. Ralph, Mathematical Programs with Equilibrium Constraints. Cambridge University Press, 1996.\n11\nVII. ACKNOWLEDGMENT\nThe work of Ahmed S. Alahmed and Lang Tong was supported in part by the National Science Foundation under Award 2218110 and the Power Systems and Engineering Research Center (PSERC) under Research Project M-46. This work was authored in part by the National Renewable Energy Laboratory, operated by Alliance for Sustainable Energy, LLC, for the U.S. Department of Energy (DOE) under Contract No. DE-AC36-08GO28308. Funding is provided by the U.S. Department of Energy Office of Energy Efficiency and Renewable Energy Building Technologies Office, United States. The views expressed in the article do not necessarily represent the views of the DOE or the U.S. Government. The U.S. Government retains and the publisher, by accepting the article for publication, acknowledges that the U.S. Government retains a nonexclusive, paid-up, irrevocable, worldwide license to publish or reproduce the published form of this work, or allow others to do so, for U.S. Government purposes.\nAPPENDIX\nAppendix A: Pricing Policy under Member-Level OEs\nFrom [25], if the community has member-level OEs instead of aggregate-level OEs, the community pricing that induces market equilibrium is the Dynamic NEM (D-NEM) pricing given below.\nMember-level-OEs-aware pricing policy (D-NEM). For every i \u2208 N , the threshold-based and OEs-aware energy community pricing policy is\n\u03c7\u2217 : r 7\u2192 P DNEMi (zi) = \u03c0 DNEM(r) \u00b7 zi,\nwith\n\u03c0DNEM(r) =\n  \n\n\u03c0+ , rN < \u03981(r) \u03c0z(r) , rN \u2208 [\u03981(r),\u03982(r)] \u03c0\u2212 , rN > \u03982(r),\n(22)\nwhere the thresholds \u03982(r) \u2265 \u03981(r) are computed as\n\u03981(r) :=\nN\u2211\ni=1\n[D+i ] zi+ri z i +ri , \u03982(r) :=\nN\u2211\ni=1\n[D\u2212i ] zi+ri z i +ri ,\nwith D+i := [fi ( \u03c0+ ) ]di0 , D \u2212 i := [fi ( \u03c0\u2212 ) ]di0 , and the max and min operators being elementwise. The price \u03c0z(r) := \u00b5\u2217(r) \u2208 [\u03c0\u2212, \u03c0+] is the solution of\nN\u2211\ni=1\n[Dzi (\u00b5)] zi+ri zi+ri = rN ,\nwhere Dzi (\u00b5) := [fi ( \u00b5(r) ) ]di0 .\nAppendix B: Benchmark Prosumer Optimal Decision\nLemma 3 (Lemma 2 in [25]) below characterizes the optimal response and maximum surplus of the benchmark prosumer.\nLemma 3 (Benchmark prosumer optimal response and maximum surplus). The optimal benchmark consumption of every\nmember i \u2208 N under the DSO\u2019s NEM regime abides by the following 4-thresholds,\n\u2206i1 := \u2206 i 2 \u2212 zi, \u2206 i 2 := [fi(\u03c0 +)]di0 \u2206i3 := [fi(\u03c0 \u2212)]di0 , \u2206 i 4 := \u2206 i 3 \u2212 zi,\nas\ndNEM \u2217\ni (ri) =\n  \n \nd\u00b5 +\ni (ri) , ri \u2264 \u2206 i 1\nd\u03c0 +\ni , ri \u2208 (\u2206 i 1,\u2206 i 2)\nd\u00b5 o\ni (ri) , ri \u2208 [\u2206 i 2,\u2206 i 3]\nd\u03c0 \u2212\ni , ri \u2208 (\u2206 i 3,\u2206 i 4)\nd\u00b5 \u2212\ni (ri) , ri \u2265 \u2206 i 4,\n(23)\nzNEM \u2217\ni (ri) = d NEM\n\u2217\ni (ri)\u2212 ri, (24)\nwhere the static consumptions d\u03c0 + i and d \u03c0\u2212 i and dynamic consumptions d\u00b5 +\ni (ri), d \u00b5o i (ri), d \u00b5\u2212 i (ri), for every k \u2208\nK, are all given by dxik := [fi(x)] di 0 , and the prices \u00b5+(ri), \u00b5 o(ri), \u00b5 \u2212(ri) are, respectively, the solutions of:\n[fi(\u00b5 +)]di0 = zi + ri, [fi(\u00b5 o)]di0 = ri, [fi(\u00b5 \u2212)]di0 = zi + ri,\nwith the order \u00b5+(ri) \u2265 \u03c0+ \u2265 \u00b5o(ri) \u2265 \u03c0\u2212 \u2265 \u00b5\u2212(ri). Therefore, by definition, the surplus under optimal consumption is given by:\nSNEM \u2217\ni (ri) :=\n \n \nUi(d \u00b5+ i (ri))\u2212 \u03c0 +zi , ri \u2264 \u2206i1 Ui(d \u03c0+ i )\u2212 \u03c0 +(d\u03c0 + i \u2212 ri) , ri \u2208 (\u2206 i 1,\u2206 i 2) Ui(d \u00b5o i (ri)) , ri \u2208 [\u2206 i 2,\u2206 i 3] Ui(d \u03c0\u2212 i )\u2212 \u03c0 \u2212(d\u03c0 \u2212 i \u2212 ri) , ri \u2208 (\u2206 i 3,\u2206 i 4) Ui(d \u00b5\u2212 i (ri))\u2212 \u03c0 \u2212zi , ri \u2265 \u2206 i 4.\n(25)\nAppendix C: Proofs and additional theoretical results\nFor brevity, the proofs are all based on having K = 1 for every prosumer i \u2208 N .\nA. Proof of Lemma 1\nRecall the community member\u2019s surplus-maximization problem under the proposed market mechanism (17). One can easily see that the objective is both concave and differentiable. From KKT conditions, the optimal consumption of every i \u2208 N community member is:\nd\u03c8 \u2217\ni (\u03c0 \u2217) = max{0,min{fi(\u03c0 \u2217), di}} =: [fi(\u03c0 \u2217)]di0 ,\nwhich, given the OEs-aware pricing policy, can be explicitly written as\nd\u03c8 \u2217\ni (\u03c0 \u2217) =\n \n \nd\u03c8 \u2217\ni (\u03c7 +(rN )) , rN \u2264 \u03c31\nd\u03c8 \u2217\ni (\u03c0 +) , rN \u2208 (\u03c31, \u03c32)\nd\u03c8 \u2217\ni (\u03c7 z(rN )) , rN \u2208 [\u03c32, \u03c33]\nd\u03c8 \u2217\ni (\u03c0 \u2212) , rN \u2208 (\u03c33, \u03c34)\nd\u03c8 \u2217\ni (\u03c7 \u2212(rN )) , rN \u2265 \u03c34.\n(26)\nBy definition, the optimal net consumption is z\u03c8 \u2217\ni (\u03c0 \u2217) =\nd\u03c8 \u2217\ni (\u03c0 \u2217)\u2212 ri.\n12\nB. Proof of Lemma 2\nTo prove Lemma 2, we need to show that the OEs-aware\npricing policy satisfies each of Axiom 1\u2013Axiom 4.\nAxiom 1: Since the OEs-aware pricing policy\u2019s price \u03c0\u2217(rN ) in (12) is uniform, and the volumetric charge is of the form P\u0303\u03c7 \u2217\ni (zi) = \u03c0 \u2217zi, \u2200i \u2208 N , it holds that for any two\nmembers i, j \u2208 N , i 6= j if zi = zj , then\nP\u0303\u03c7 \u2217\ni (zi) = \u03c0 \u2217 \u00b7 zi = \u03c0 \u2217 \u00b7 zj = P\u0303 \u03c7\u2217 j (zj).\nAxiom 2: For any member i \u2208 N , the payment under the\nOEs-aware pricing policy is monotonic in zi because \u2202P\u0303\n\u03c7\u2217 i\n\u2202zi =\n\u03c0\u2217 \u2265 0. Additionally, the volumetric charge of every i \u2208 N satisfies P\u0303\u03c7 \u2217\ni (0) = \u03c0 \u2217 \u00b7 0 = 0.\nAxiom 4: From Lemma 1, given the members\u2019 optimal consumption policy \u03c8\u2217 in response to the OEs-aware pricing policy \u03c7\u2217, the aggregate net consumption of the community z\u03c8 \u2217\nN is as shown in (19), therefore,\n\u2206P\u03c7 \u2217,NEM(z\u03c8 \u2217 ) := \u2211\ni\u2208N\nP\u03c7 \u2217 i (z \u03c8\u2217 i )\u2212 P NEM(z\u03c8 \u2217 N )\n= \u2211\ni\u2208N\n(\u03c0\u2217(rN ) \u00b7 z \u03c8\u2217 i (\u03c0 \u2217)\u2212A\u2217i (rN ))\u2212 \u03c0 NEM(z\u03c8 \u2217 N ) \u00b7 z \u03c8\u2217 N (\u03c0 \u2217)\n= \u03c0\u2217(rN ) \u00b7 z \u03c8\u2217 N (\u03c0 \u2217)\u2212\n\u2211\ni\u2208N\nA\u2217i (rN )\u2212 \u03c0 NEM(z\u03c8\n\u2217 N ) \u00b7 z \u03c8\u2217 N (\u03c0 \u2217)\n= (\u03c0\u2217(rN )\u2212 \u03c0 NEM(z\u03c8\n\u2217 N )) \u00b7 z \u03c8\u2217 N (\u03c0 \u2217)\u2212\n\u2211\ni\u2208N\nA\u2217i (rN )\n(7),(12),(19) =\n  \n \n(\u03c7+(rN )\u2212 \u03c0+) \u00b7 zN , rN \u2264 \u03c31 (\u03c0+ \u2212 \u03c0+) \u00b7 (d\u03c8 \u2217\nN (\u03c0 +)\u2212 rN ) , rN \u2208 (\u03c31, \u03c32)\n(\u03c7z(rN )\u2212 \u03c0+) \u00b7 0 , rN \u2208 [\u03c32, \u03c33] (\u03c0\u2212 \u2212 \u03c0\u2212) \u00b7 (d\u03c8 \u2217\nN (\u03c0 \u2212)\u2212 rN ) , rN \u2208 (\u03c33, \u03c34)\n(\u03c7\u2212(rN )\u2212 \u03c0\u2212) \u00b7 zN , rN \u2265 \u03c34.\n\u2212 \u2211\ni\u2208N\n \n\n(\u03c7+(rN )\u2212 \u03c0+) ( zi + zN\u2212 \u2211 i\u2208N zi\nN\n)\n, rN \u2264 \u03c31\n(\u03c7\u2212(rN )\u2212 \u03c0\u2212) ( zi + zN\u2212 \u2211 i\u2208N zi N ) , rN \u2265 \u03c34\n0 , otherwise,\n=\n \n\n(\u03c7+(rN )\u2212 \u03c0+) \u00b7 zN , rN \u2264 \u03c31\n0 , rN \u2208 (\u03c31, \u03c32)\n0 , rN \u2208 [\u03c32, \u03c33]\n0 , rN \u2208 (\u03c33, \u03c34) (\u03c7\u2212(rN )\u2212 \u03c0\u2212) \u00b7 zN , rN \u2265 \u03c34.\n\u2212\n \n\n(\u03c7+(rN )\u2212 \u03c0+)zN , rN \u2264 \u03c31 (\u03c7\u2212(rN )\u2212 \u03c0 \u2212)zN , rN \u2265 \u03c34 0 , otherwise.\n= 0\nAxiom 3: Given ri, we compare the maximum benchmark surplus (SNEM \u2217\ni (ri)) in (25) in Lemma 3 and the community member surplus under the OEs-aware pricing policy, given by, using Lemma 1,\nS\u03c7 \u2217\ni (\u03c8 \u2217 i (ri), ri)= Ui(d\n\u03c8\u2217 i (\u03c0 \u2217))\u2212 \u03c0\u2217(d\u03c8 \u2217 i (\u03c0 \u2217)\u2212 ri) + A \u2217 i ,\nto show that individual rationality holds, i.e., \u2206Si := S\u03c7 \u2217\ni (\u03c8 \u2217 i (ri), ri) \u2212 S\nNEM \u2217\ni (ri) \u2265 0, \u2200i \u2208 N . For brevity, we assume non-binding consumption upper and lower limits. For notational convenience we define the following\nai :=\n(\nzi + zN \u2212\n\u2211\ni\u2208N zi\nN\n)\n, ai :=\n(\nzi + zN \u2212\n\u2211\ni\u2208N zi N\n)\n,\n(27)\nhence the fixed reward can be re-written as\nA\u2217i (rN ) =\n \n\n(\u03c7+(rN )\u2212 \u03c0 +) \u00b7 ai, rN \u2264 \u03c31 (\u03c7\u2212(rN )\u2212 \u03c0\u2212) \u00b7 ai, rN \u2265 \u03c34 0, otherwise.\nGiven that each of the piecewise functions SNEM \u2217 i and S \u03c7\u2217 i have 5 pieces, their difference \u2206Si have 5 2 = 25 pieces. The proof is completed if we show that each piece in \u2206Si is nonnegative. In [24], we already showed the non-negativity of 9 of the 25 combinations, which are\n1) rN \u2208 (\u03c31, \u03c32), ri \u2208 (\u2206 i 1,\u2206 i 2) 2) rN \u2208 (\u03c31, \u03c32), ri \u2208 [\u2206 i 2,\u2206 i 3] 3) rN \u2208 (\u03c31, \u03c32), ri \u2208 (\u2206 i 3,\u2206 i 4) 4) rN \u2208 [\u03c32, \u03c33], ri \u2208 (\u2206 i 1,\u2206 i 2) 5) rN \u2208 [\u03c32, \u03c33], ri \u2208 [\u2206 i 2,\u2206 i 3] 6) rN \u2208 [\u03c32, \u03c33], ri \u2208 (\u2206 i 3,\u2206 i 4) 7) rN \u2208 (\u03c33, \u03c34), ri \u2208 (\u2206 i 1,\u2206 i 2) 8) rN \u2208 (\u03c33, \u03c34), ri \u2208 [\u2206 i 2,\u2206 i 3] 9) rN \u2208 (\u03c33, \u03c34), ri \u2208 (\u2206 i 3,\u2206 i 4).\nTo this end, we prove the non-negativity of the remaining 16 cases using the following property for concave and continuously differentiable function\nL(x)(y \u2212 x) \u2265 U(y)\u2212 U(x) \u2265 L(y)(y \u2212 x),\nwhere x < y, \u2200x, y \u2208 R, and the community price order \u03c7+(rN ) \u2265 \u03c0+ \u2265 \u03c7z(rN ) \u2265 \u03c0\u2212 \u2265 \u03c7\u2212(rN ) \u2265 0., and the assumption \u2211\ni\u2208N zi \u2264 zN , \u2211\ni\u2208N zi \u2265 zN (Case 1: rN \u2264 \u03c31, ri \u2264 \u2206i1) The surplus difference is\n\u2206Si = Ui(d \u03c8\u2217 i (\u03c7 +))\u2212 \u03c7+(d\u03c8 \u2217 i (\u03c7 +)\u2212 ri) + (\u03c7 + \u2212 \u03c0+)ai\n\u2212 Ui(d \u00b5+ i (ri)) + \u03c0 +zi.\nHere we have three sub-cases i) d\u03c8 \u2217 i (\u03c7 +) > d\u00b5 + i , ii) d\u03c8 \u2217\ni (\u03c7 +) < d\u00b5\n+ i , and iii) d \u03c8\u2217 i (\u03c7 +) = d\u00b5 + i . Under sub-case\n(i), we can write\n\u00b5+(d\u03c8 \u2217 i (\u03c7 +)\u2212 d\u00b5 + i ) \u2265 Ui(d \u03c8\u2217 i (\u03c7 +))\u2212 Ui(d \u00b5+ i )\n\u2265 \u03c7+(d\u03c8 \u2217 i (\u03c7 +)\u2212 d\u00b5 + i ),\nwhere we used Li(d \u03c8\u2217 i (\u03c7 +)) = \u03c7+ and Li(d \u00b5+) = \u00b5+. Using the lower bound above, we have\n\u2206Si \u2265 (\u03c7 + \u2212 \u03c0+)(ai \u2212 zi) \u2265 0,\n13\nwhere we used zi = d \u00b5+ i \u2212 ri when ri \u2264 \u2206 i 1 (Lemma 3). Under sub-case (ii), we have\n\u03c7+(d\u00b5 + i \u2212 d \u03c8\u2217 i (\u03c7 +)) \u2265 Ui(d \u00b5+ i )\u2212 Ui(d \u03c8\u2217 i (\u03c7 +))\n\u2265 \u00b5+(d\u00b5 + i \u2212 d \u03c8\u2217 i (\u03c7 +)).\nBy multiplying the inequalities above by \u22121, we get the inequality in sub-case (i) and the proof follows directly. Under sub-case (iii), we have zi = d \u00b5+ i \u2212 ri = d \u03c8\u2217 i (\u03c7 +)\u2212 ri, hence\n\u2206Si \u2265 (\u03c7 + \u2212 \u03c0+)(ai \u2212 zi) \u2265 0.\n(Case 2: rN \u2264 \u03c31,\u2206i1 < ri < \u2206 i 2) The surplus difference is\n\u2206Si = Ui(d \u03c8\u2217 i (\u03c7 +))\u2212 \u03c7+(d\u03c8 \u2217 i (\u03c7 +)\u2212 ri) + (\u03c7 + \u2212 \u03c0+)ai\n\u2212 Ui(d \u03c0+ i ) + \u03c0 +(d\u03c0 + i \u2212 ri).\nSince d\u03c8 \u2217\ni (\u03c7 +) < d\u03c0\n+\ni , we have\n\u03c0+(d\u03c8 \u2217\ni (\u03c7 +)\u2212 d\u03c0\n+ i ) \u2265 Ui(d \u03c8\u2217 i (\u03c7 +))\u2212 Ui(d \u03c0+ i )\n\u2265 \u03c7+(d\u03c8 \u2217\ni (\u03c7 +)\u2212 d\u03c0\n+\ni ),\nand using the lower bound, we get\n\u2206Si \u2265 (\u03c7 + \u2212 \u03c0+)(ri \u2212 d\n\u03c0+ i + ai).\nWe know that \u03c7+ \u2265 \u03c0+, so we only need to show that ri \u2212 d\u03c0 +\ni +ai \u2265 0. Note that by adding ai to d \u03c0+ i \u2212 zi < ri < d \u03c0+ i\n(from case 2), we get\n0 \u2264 ai \u2212 zi < ri \u2212 d \u03c0+ i + ai < ai,\nwhich proves that \u2206Si \u2265 (\u03c7 + \u2212 \u03c0+)(ri \u2212 d\n\u03c0+\ni + ai) \u2265 0. (Case 3: rN \u2264 \u03c31,\u2206i2 \u2264 ri \u2264 \u2206 i 3) The surplus difference is\n\u2206Si = Ui(d \u03c8\u2217 i (\u03c7 +))\u2212 \u03c7+(d\u03c8 \u2217 i (\u03c7 +)\u2212 ri) + (\u03c7 + \u2212 \u03c0+)ai\n\u2212 Ui(d \u00b5o i ).\nSince d\u03c8 \u2217 i (\u03c7 +) < d\u00b5 o i , we have\n\u00b5o(d\u03c8 \u2217 i (\u03c7 +)\u2212 d\u00b5 o i ) \u2265 Ui(d \u03c8\u2217 i (\u03c7 +))\u2212 Ui(d \u00b5o i )\n\u2265 \u03c7+(d\u03c8 \u2217 i (\u03c7 +)\u2212 d\u00b5 o i ),\nand using the lower bound, we get\n\u2206Si \u2265 \u03c7 +(ri \u2212 d\n\u00b5o i ) + (\u03c7 + \u2212 \u03c0+)ai,\nbut we know that in Case 3, ri = d \u00b5o i , hence\n\u2206Si \u2265 (\u03c7 + \u2212 \u03c0+)ai \u2265 0.\n(Case 4: rN \u2264 \u03c31,\u2206i3 < ri < \u2206 i 4) The surplus difference is\n\u2206Si = Ui(d \u03c8\u2217 i (\u03c7 +))\u2212 \u03c7+(d\u03c8 \u2217 i (\u03c7 +)\u2212 ri) + (\u03c7 + \u2212 \u03c0\u2212)ai\n\u2212 Ui(d \u03c0\u2212 i ) + \u03c0 \u2212(d\u03c0 \u2212 i \u2212 ri).\nSince d\u03c8 \u2217\ni (\u03c7 +) < d\u03c0\n\u2212\ni , we have\n\u03c0\u2212(d\u03c8 \u2217\ni (\u03c7 +)\u2212 d\u03c0\n\u2212 i ) \u2265 Ui(d \u03c8\u2217 i (\u03c7 +))\u2212 Ui(d \u03c0\u2212 i )\n\u2265 \u03c7+(d\u03c8 \u2217\ni (\u03c7 +)\u2212 d\u03c0\n\u2212\ni ),\nand using the lower bound, we get\n\u2206Si \u2265 (\u03c7 + \u2212 \u03c0\u2212)(ri \u2212 d\n\u03c0\u2212 i + ai).\nWe know that \u03c7+ \u2265 \u03c0\u2212, so we only need to show that ri \u2212 d\u03c0 \u2212\ni +ai \u2265 0. Note that by adding ai to d \u03c0\u2212 i \u2264 ri \u2264 d \u03c0\u2212\ni \u2212zi (from case 4) we get\n0 \u2264 ai < ri \u2212 d \u03c0\u2212 i + ai < ai \u2212 zi,\nwhich proves that \u2206Si \u2265 (\u03c7+ \u2212 \u03c0\u2212)(ri \u2212 d\u03c0 \u2212\ni + ai) \u2265 0. (Case 5: rN \u2264 \u03c31, ri \u2265 \u2206 i 4) The surplus difference is\n\u2206Si = Ui(d \u03c8\u2217 i (\u03c7 +))\u2212 \u03c7+(d\u03c8 \u2217 i (\u03c7 +)\u2212 ri) + (\u03c7 + \u2212 \u03c0+)ai\n\u2212 Ui(d \u00b5\u2212 i ) + \u03c0 \u2212zi.\nSince d\u03c8 \u2217 i (\u03c7 +) < d\u00b5 \u2212 i , we have\n\u00b5\u2212(d\u03c8 \u2217 i (\u03c7 +)\u2212 d\u00b5 \u2212 i ) \u2265 Ui(d \u03c8\u2217 i (\u03c7 +))\u2212 Ui(d \u00b5\u2212 i )\n\u2265 \u03c7+(d\u03c8 \u2217 i (\u03c7 +)\u2212 d\u00b5 \u2212 i ),\nand using the lower bound and zi = d \u00b5\u2212 i \u2212 ri, we get\n\u2206Si \u2265 (\u03c7 + \u2212 \u00b5\u2212)(ri \u2212 d\n\u00b5\u2212 i ) + (\u03c7 + \u2212 \u03c0+)ai \u2265 0,\nbecause ri \u2265 d \u00b5\u2212 i . (Case 6: rN \u2265 \u03c34, ri \u2264 \u2206i1) The surplus difference is\n\u2206Si = Ui(d \u03c8\u2217 i (\u03c7 \u2212))\u2212 \u03c7\u2212(d\u03c8 \u2217 i (\u03c7 \u2212)\u2212 ri) + (\u03c7 \u2212 \u2212 \u03c0\u2212)ai\n\u2212 Ui(d \u00b5+ i ) + \u03c0 +zi.\nSince d\u03c8 \u2217 i (\u03c7 \u2212) > d\u00b5 + i , we have\n\u00b5+(d\u03c8 \u2217 i (\u03c7 \u2212)\u2212 d\u00b5 + i ) \u2265 Ui(d \u03c8\u2217 i (\u03c7 \u2212))\u2212 Ui(d \u00b5+ i )\n\u2265 \u03c7\u2212(d\u03c8 \u2217 i (\u03c7 \u2212)\u2212 d\u00b5 + i ),\nand using the lower bound and zi = d \u00b5+ i \u2212 ri, we get\n\u2206Si \u2265 (\u03c7 \u2212 \u2212 \u03c0+)(ri \u2212 d\n\u00b5+ i ) + (\u03c7 \u2212 \u2212 \u03c0\u2212)ai \u2265 0\nbecause \u03c7\u2212 \u2264 \u03c0\u2212 \u2264 \u03c0+, ri \u2264 d \u00b5+\ni and ai \u2264 0. (Case 7: rN \u2265 \u03c34,\u2206i1 < ri < \u2206 i 2) The surplus difference is\n\u2206Si = Ui(d \u03c8\u2217 i (\u03c7 \u2212))\u2212 \u03c7\u2212(d\u03c8 \u2217 i (\u03c7 \u2212)\u2212 ri) + (\u03c7 \u2212 \u2212 \u03c0\u2212)ai\n\u2212 Ui(d \u03c0+ i ) + \u03c0 +(d\u03c0 + i \u2212 ri).\nSince d\u03c8 \u2217\ni (\u03c7 \u2212) > d\u03c0\n+\ni , we have\n\u03c0+(d\u03c8 \u2217\ni (\u03c7 \u2212)\u2212 d\u03c0\n+ i ) \u2265 Ui(d \u03c8\u2217 i (\u03c7 \u2212))\u2212 Ui(d \u03c0+ i )\n\u2265 \u03c7\u2212(d\u03c8 \u2217\ni (\u03c7 \u2212)\u2212 d\u03c0\n+\ni ),\nand using the lower bound, we get\n\u2206Si \u2265 (\u03c7 \u2212 \u2212 \u03c0+)(ri \u2212 d\n\u03c0+ i ) + (\u03c7 \u2212 \u2212 \u03c0\u2212)ai \u2265 0\nbecause \u03c7\u2212 \u2264 \u03c0\u2212 \u2264 \u03c0+ and ri \u2264 d\u03c0 + i . (Case 8: rN \u2265 \u03c34,\u2206i2 \u2264 ri \u2264 \u2206 i 3) The surplus difference is\n\u2206Si = Ui(d \u03c8\u2217 i (\u03c7 \u2212))\u2212 \u03c7\u2212(d\u03c8 \u2217 i (\u03c7 \u2212)\u2212 ri) + (\u03c7 \u2212 \u2212 \u03c0\u2212)ai\n\u2212 Ui(d \u00b5o i ).\nSince d\u03c8 \u2217 i (\u03c7 \u2212) > d\u00b5 o i , we have\n\u00b5o(d\u03c8 \u2217 i (\u03c7 \u2212)\u2212 d\u00b5 o i ) \u2265 Ui(d \u03c8\u2217 i (\u03c7 \u2212))\u2212 Ui(d \u00b5o i )\n\u2265 \u03c7\u2212(d\u03c8 \u2217 i (\u03c7 \u2212)\u2212 d\u00b5 o i ),\n14\nand using the lower bound and d\u00b5 o\ni = ri, we get\n(\u03c7\u2212 \u2212 \u03c0\u2212)ai \u2265 0.\n(Case 9: rN \u2265 \u03c34,\u2206i3 < ri < \u2206 i 4) The surplus difference is\n\u2206Si = Ui(d \u03c8\u2217 i (\u03c7 \u2212))\u2212 \u03c7\u2212(d\u03c8 \u2217 i (\u03c7 \u2212)\u2212 ri) + (\u03c7 \u2212 \u2212 \u03c0\u2212)ai\n\u2212 Ui(d \u03c0\u2212 i ) + \u03c0 \u2212(d\u03c0 \u2212 i \u2212 ri).\nSince d\u03c8 \u2217\ni (\u03c7 \u2212) > d\u03c0\n\u2212\ni , we have\n\u03c0\u2212(d\u03c8 \u2217\ni (\u03c7 \u2212)\u2212 d\u03c0\n\u2212 i ) \u2265 Ui(d \u03c8\u2217 i (\u03c7 \u2212))\u2212 Ui(d \u03c0\u2212 i )\n\u2265 \u03c7\u2212(d\u03c8 \u2217\ni (\u03c7 \u2212)\u2212 d\u03c0\n\u2212\ni ),\nand using the lower bound we get\n\u2206Si \u2265 (\u03c7 \u2212 \u2212 \u03c0\u2212)(ri \u2212 d\n\u03c0\u2212 i + ai).\nNote that \u03c7\u2212 \u2212 \u03c0\u2212 \u2264 0 and by adding ai to \u2206i3 < ri < \u2206 i 4 we get\nai < ri \u2212 d \u03c0\u2212 i + ai < \u2212zi + ai \u2264 0\nwhich proves that \u2206Si \u2265 0. (Case 10: rN \u2265 \u03c34, ri \u2265 \u2206i4) The surplus difference is\n\u2206Si = Ui(d \u03c8\u2217 i (\u03c7 \u2212))\u2212 \u03c7\u2212(d\u03c8 \u2217 i (\u03c7 \u2212)\u2212 ri) + (\u03c7 \u2212 \u2212 \u03c0\u2212)ai\n\u2212 Ui(d \u00b5\u2212 i ) + \u03c0 \u2212zi.\nHere we have three sub-cases i) d\u03c8 \u2217 i (\u03c7 \u2212) > d\u00b5 \u2212 i , ii) d\u03c8 \u2217\ni (\u03c7 \u2212) < d\u00b5\n\u2212 i , and iii) d \u03c8\u2217 i (\u03c7 \u2212) = d\u00b5 \u2212 i . Under sub-case\n(i), we can write\n\u00b5\u2212(d\u03c8 \u2217 i (\u03c7 \u2212)\u2212 d\u00b5 \u2212 i ) \u2265 Ui(d \u03c8\u2217 i (\u03c7 \u2212))\u2212 Ui(d \u00b5\u2212 i )\n\u2265 \u03c7\u2212(d\u03c8 \u2217 i (\u03c7 \u2212)\u2212 d\u00b5 \u2212 i ),\nUsing the lower bound, we get\n\u2206Si \u2265 (\u03c7 \u2212 \u2212 \u03c0\u2212)(ai \u2212 zi) \u2265 0,\nwhere we used zi = d \u00b5\u2212 i \u2212 ri when ri \u2265 \u2206 i 4. Under sub-case (ii), we have\n\u03c7\u2212(d\u00b5 \u2212 i \u2212 d \u03c8\u2217 i (\u03c7 \u2212)) \u2265 Ui(d \u00b5\u2212 i )\u2212 Ui(d \u03c8\u2217 i (\u03c7 \u2212))\n\u2265 \u00b5\u2212(d\u00b5 \u2212 i \u2212 d \u03c8\u2217 i (\u03c7 \u2212)).\nBy multiplying the inequalities above by \u22121, we get the inequality in sub-case (i) and the proof follows directly. Under sub-case (iii), we have zi = d \u00b5\u2212 i \u2212 ri = d \u03c8\u2217 i (\u03c7 \u2212)\u2212 ri, hence\n\u2206Si \u2265 (\u03c7 \u2212 \u2212 \u03c0\u2212)(ai \u2212 zi) \u2265 0.\n(Case 11: \u03c31 < rN < \u03c32, ri \u2264 \u2206i1) The surplus difference is \u2206Si = Ui(d \u03c8\u2217 i (\u03c0 +))\u2212 \u03c0+(d\u03c8 \u2217 i (\u03c0 +)\u2212 ri)\u2212 Ui(d \u00b5+ i ) + \u03c0 +zi.\nSince d\u03c8 \u2217 i (\u03c0 +) > d\u00b5 + i , we have\n\u00b5+(d\u03c8 \u2217 i (\u03c0 +)\u2212 d\u00b5 + i ) \u2265 Ui(d \u03c8\u2217 i (\u03c0 +))\u2212 Ui(d \u00b5+ i )\n\u2265 \u03c0+(d\u03c8 \u2217 i (\u03c0 +)\u2212 d\u00b5 + i ),\nand using the lower bound and zi = d \u00b5+\ni \u2212ri, we get \u2206Si \u2265 0. (Case 12: \u03c31 < rN < \u03c32, ri \u2265 \u2206i4) The surplus difference is \u2206Si = Ui(d \u03c8\u2217 i (\u03c0 +))\u2212 \u03c0+(d\u03c8 \u2217 i (\u03c0 +)\u2212 ri)\u2212 Ui(d \u00b5\u2212 i ) + \u03c0 \u2212zi.\nSince d\u03c8 \u2217 i (\u03c0 +) < d\u00b5 \u2212 i , we have\n\u03c0+(d\u03c8 \u2217 i (\u03c0 +)\u2212 d\u00b5 \u2212 i ) \u2264 Ui(d \u03c8\u2217 i (\u03c0 +))\u2212 Ui(d \u00b5\u2212 i )\n\u2264 \u00b5\u2212(d\u03c8 \u2217 i (\u03c0 +)\u2212 d\u00b5 \u2212 i ),\nand using the lower bound and zi = d \u00b5\u2212\ni \u2212 ri, we get \u2206Si \u2265 (\u03c0\u2212 \u2212 \u03c0+)zi \u2265 0. (Case 13: \u03c32 \u2264 rN \u2264 \u03c33, ri \u2264 \u2206i1) The surplus difference is\n\u2206Si = Ui(d \u03c8\u2217 i (\u03c7 z))\u2212 \u03c7z(d\u03c8 \u2217 i (\u03c7 z)\u2212 ri)\u2212 Ui(d \u00b5+ i ) + \u03c0 +zi.\nSince d\u03c8 \u2217 i (\u03c7 z) > d\u00b5 + i , we have\n\u00b5+(d\u03c8 \u2217 i (\u03c7 z)\u2212 d\u00b5 + i ) \u2265 Ui(d \u03c8\u2217 i (\u03c7 z))\u2212 Ui(d \u00b5+ i )\n\u2265 \u03c7z(d\u03c8 \u2217 i (\u03c7 z)\u2212 d\u00b5 + i ),\nand using the lower bound and zi = d \u00b5+\ni \u2212 ri, we get \u2206Si \u2265 (\u03c0+ \u2212 \u03c7z)zi \u2265 0. (Case 14: \u03c32 \u2264 rN \u2264 \u03c33, ri \u2265 \u2206i4) The surplus difference is\n\u2206Si = Ui(d \u03c8\u2217 i (\u03c7 z))\u2212 \u03c7z(d\u03c8 \u2217 i (\u03c7 z)\u2212 ri)\u2212 Ui(d \u00b5\u2212 i ) + \u03c0 \u2212zi.\nSince d\u03c8 \u2217 i (\u03c7 z) < d\u00b5 \u2212 i , we have\n\u03c7z(d\u03c8 \u2217 i (\u03c7 z)\u2212 d\u00b5 \u2212 i ) \u2264 Ui(d \u03c8\u2217 i (\u03c7 z))\u2212 Ui(d \u00b5\u2212 i )\n\u2264 \u00b5\u2212(d\u03c8 \u2217 i (\u03c7 z)\u2212 d\u00b5 \u2212 i ),\nand using the lower bound and zi = d \u00b5\u2212\ni \u2212 ri, we get \u2206Si \u2265 (\u03c0\u2212 \u2212 \u03c7z)zi \u2265 0. (Case 15: \u03c33 < rN < \u03c34, ri \u2264 \u2206i1) The surplus difference is\n\u2206Si = Ui(d \u03c8\u2217 i (\u03c0 \u2212))\u2212 \u03c0\u2212(d\u03c8 \u2217 i (\u03c0 \u2212)\u2212 ri)\u2212 Ui(d \u00b5+ i ) + \u03c0 +zi.\nSince d\u03c8 \u2217 i (\u03c0 \u2212) > d\u00b5 + i , we have\n\u00b5+(d\u03c8 \u2217 i (\u03c0 \u2212)\u2212 d\u00b5 + i ) \u2265 Ui(d \u03c8\u2217 i (\u03c0 \u2212))\u2212 Ui(d \u00b5+ i )\n\u2265 \u03c0\u2212(d\u03c8 \u2217 i (\u03c0 \u2212)\u2212 d\u00b5 + i ),\nand using the lower bound and zi = d \u00b5+\ni \u2212 ri, we get \u2206Si \u2265 (\u03c0+ \u2212 \u03c0\u2212)zi \u2265 0. (Case 16: \u03c33 < rN < \u03c34, ri \u2265 \u2206i4) The surplus difference is\n\u2206Si = Ui(d \u03c8\u2217 i (\u03c0 \u2212))\u2212 \u03c0\u2212(d\u03c8 \u2217 i (\u03c0 \u2212)\u2212 ri)\u2212 Ui(d \u00b5\u2212 i ) + \u03c0 \u2212zi.\nSince d\u03c8 \u2217 i (\u03c0 \u2212) < d\u00b5 \u2212 i , we have\n\u03c0\u2212(d\u03c8 \u2217 i (\u03c0 \u2212)\u2212 d\u00b5 \u2212 i ) \u2264 Ui(d \u03c8\u2217 i (\u03c0 \u2212))\u2212 Ui(d \u00b5\u2212 i )\n\u2264 \u00b5\u2212(d\u03c8 \u2217 i (\u03c0 \u2212)\u2212 d\u00b5 \u2212 i ),\nand using the lower bound and zi = d \u00b5\u2212 i \u2212ri, we get \u2206Si \u2265 0.\nBy proving that the OEs-aware pricing policy satisfies Axiom 1\u2013Axiom 4, we showed that the OEs-aware pricing policy conforms with the cost-causation principle.\n15\nC. Lemma 4 and its proof\nLemma 4 (Community maximum welfare). The maximum community welfare under centralized resource scheduling,\ngiven by,\nW \u2217,NEMN := maximize (di,...,dN)\nE [\u2211\ni\u2208N\nUi(di)\u2212 P NEM(zN )\n]\nsubject to zN = \u2211\ni\u2208N\n( di \u2212 ri )\nzN \u2264 zN \u2264 zN\n0 < di < di, \u2200i \u2208 N .\nis a monotonically increasing function of rN , given by\nW \u2217,NEMN (rN ) =\nE\n \n\n\u2211\ni\u2208N Ui(d \u03c7+ i (rN ))\u2212 \u03c0 +zN , rN \u2264 \u03c31\n\u2211\ni\u2208N Ui(d \u03c0+ i )\u2212 \u03c0 +( \u2211 i\u2208N d \u03c0+\ni \u2212 rN ), rN \u2208 (\u03c31, \u03c32) \u2211\ni\u2208N Ui(d \u03c7z\ni (rN )), rN \u2208 [\u03c32, \u03c33] \u2211\ni\u2208N Ui(d \u03c0\u2212 i )\u2212 \u03c0 \u2212( \u2211 i\u2208N d \u03c0\u2212\ni \u2212 rN ), rN \u2208 (\u03c33, \u03c34) \u2211\ni\u2208N Ui(d \u03c7\u2212 i (rN ))\u2212 \u03c0 \u2212zN , rN \u2265 \u03c34,\n(28)\nwhere the thresholds \u03c31 \u2212 \u03c34 are as computed in the pricing policy and all consumptions are given by dxi := [fi(x)] di 0 .\nProof of Lemma 4\nGiven the assumptions zi \u2264 di \u2212 ri, and \u2211\ni\u2208N zi \u2264 zN , \u2211\ni\u2208N zi \u2265 zN , the proof of the maximum welfare of the community under centralized control follows the proof from Lemma 3, as it is a generalization of the benchmark customer problem by adding the dimension of community members. Therefore, the optimal aggregate consumption d\u2217N and maximum welfare W \u2217,NEMN will be functions of rN :=\u2211\ni\u2208N ri rather than ri. The optimal consumption of every member i \u2208 N under centralized operation is, therefore,\nd\u2217i (rN ) =\n  \n \nd\u03c7 +\ni (rN ) , rN \u2264 \u03c31\nd\u03c0 +\ni , rN \u2208 (\u03c31, \u03c32)\nd\u03c7 z\ni (rN ) , rN \u2208 [\u03c32, \u03c33]\nd\u03c0 \u2212\ni , rN \u2208 (\u03c33, \u03c34)\nd\u03c7 \u2212\ni (rN ) , rN \u2265 \u03c34,\nwhich yields the aggregate net-consumption\nz\u2217N (rN ) =\n \n\nzN , rN \u2264 \u03c31 \u2211\ni\u2208N d \u03c0+ i \u2212 rN , rN \u2208 (\u03c31, \u03c32)\n0 , rN \u2208 [\u03c32, \u03c33] \u2211\ni\u2208N d \u03c0\u2212 i \u2212 rN , rN \u2208 (\u03c33, \u03c34)\nzN , rN \u2265 \u03c34.\nThe maximum welfare can be directly computed by plugging d\u2217i (rN ) and z \u2217 N (rN ) into W \u2217,NEM N (rN ) = \u2211 i\u2208N Ui(d \u2217 i (rN ))\u2212 P NEMN (z \u2217 N (rN )), which yield (28). Note that the expectation is irrelevant here because the solution optimizes for every possible realization, hence it optimizes the expected value too.\nD. Proof of Theorem 1\nThe stochastic bi-level optimization in \u00a7II-E can be compactly formulated as\nmaximize {Pi(\u00b7)}Ni=1,{di} N i=1\n(\nW\u03c7\u03c8 = E [\u2211\ni\u2208N\nUi(d \u03c8 i )\u2212 P NEM(zN ) ] )\nsubject to zN \u2264 zN = \u2211\ni\u2208N\nd\u03c8i \u2212 ri \u2264 zN\nfor all i = 1, . . . , N\nd\u03c8i := argmax di Ui(di)\u2212 Pi(zi)\n0 \u2264 di \u2264 di,\nwhere we also removed the constraint {Pi(\u00b7)}Ni=1 \u2208 A from the upper level problem, hence we solve an upper bound that does not constrain the payment rule to the set of cost-causation conforming payment rules A. Next, we reformulate the program above by (1) replacing the lower-level optimization problem by its KKT conditions (mathematical program with equilibrium constraints [31]), and (2) using Pi(zi) := \u03c0 \u00b7 zi, \u2200i \u2208 N from Axioms 1\u20132, as\nmaximize \u03c0,{\u03bb}N\ni=1 ,{\u03bb}N i=1\n(\nW\u03c7\u03c8 = E [\u2211\ni\u2208N\nUi(d \u03c8 i )\u2212 P NEM(zN ) ] )\nsubject to zN \u2264 zN = \u2211\ni\u2208N\nd\u03c8i \u2212 ri \u2264 zN ,\nfor all i = 1, . . . , N\nLi(d \u03c8 i )\u2212 \u03c0 + \u03bbi \u2212 \u03bbi = 0\ndi \u2212 d \u03c8 i \u2265 0 \u22a5 \u03bbi \u2265 0\nd\u03c8i \u2265 0 \u22a5 \u03bbi \u2265 0,\nwhere x \u22a5 y means that x and y are perpendicular. By implementing the complementarity conditions above into the constraint Li(d \u03c8 i )\u2212 \u03c0 + \u03bbi \u2212 \u03bbi = 0, we have\nmaximize \u03c0\n(\nW\u03c7\u03c8 = E [\u2211\ni\u2208N\nUi(d \u03c8 i )\u2212 P NEM(zN ) ] )\nsubject to zN \u2264 zN = \u2211\ni\u2208N\nd\u03c8i \u2212 ri \u2264 zN ,\nfor all i = 1, . . . , N\nd\u03c8i = max{0,min{fi(\u03c0), di}}.\nNow, note that if \u03c0\u2217 is found, we have equilibrium. The concave and non-differentiable objective above can be divided into the following three convex programs PNEM,+,PNEM,\u2212, and PNEM,o, which correspond to when zN \u2265 0, zN \u2264 0 and zN = 0, respectively:\nPNEM,+ : minimize \u03c0\n\u2211\ni\u2208N\n(\n\u03c0+(d\u03c8i (\u03c0)\u2212 ri)\u2212 Ui(d \u03c8 i (\u03c0))\n)\nsubject to zN \u2265 \u2211\ni\u2208N\n( d\u03c8i (\u03c0)\u2212 ri ) \u2265 0.\nPNEM,\u2212 : minimize \u03c0\n\u2211\ni\u2208N\n(\n\u03c0\u2212(d\u03c8i (\u03c0) \u2212 ri)\u2212 Ui(d \u03c8 i (\u03c0))\n)\nsubject to 0 \u2265 \u2211\ni\u2208N\n( d\u03c8i (\u03c0)\u2212 ri ) \u2265 zN .\n16\nPNEM,o : minimize \u03c0\n\u2212 \u2211\ni\u2208N Ui(d \u03c8 i (\u03c0))\nsubject to \u2211\ni\u2208N\n( d\u03c8i (\u03c0)\u2212 ri ) = 0.\nStarting with PNEM,+, the Lagrangian L+ is given by\nL+(\u00b7) = \u2211\ni\u2208N\n\u03c0+(d\u03c8i (\u03c0) \u2212 ri)\u2212 \u2211\ni\u2208N\nUi(d \u03c8 i (\u03c0))\n+ \u03b3+ (\u2211\ni\u2208N\n(d\u03c8i (\u03c0) \u2212 ri)\u2212 zN )\n\u2212 \u03b3+ \u2211\ni\u2208N\n(d\u03c8i (\u03c0)\u2212 ri)\nhere \u03b3+, \u03b3+ \u2265 0 are Lagrange multipliers for the import OE and non-negative aggregate net-consumption constraint. Given that PNEM,o covers the case when \u03b3+ > 0, we can here set \u03b3+ = 0. From the KKT conditions we have,\n\u2202L+(\u00b7) \u2202\u03c0 = \u2211\ni\u2208N\n\u2202d\u03c8i (\u03c0)\n\u2202\u03c0\n(\n\u03c0+ \u2212 Li(d \u03c8 i (\u03c0\n\u2217)) + \u03b3+ ) = 0.\nIf \u03b3+ = 0, then \u03c0+ = Li(d \u03c8 i (\u03c0 \u2217)), and because fi = L \u22121 i , it must be that \u03c0\u2217 = \u03c0+ when rN > \u2211 i\u2208N d \u03c8 i (\u03c0\n+)\u2212zN =: \u03c31. On the other hand, if \u03b3+ > 0, then \u03c0\u2217 = \u03c0+ + \u03b3+ and the\nprice must be so that the following equality holds\nzN + rN = \u2211\ni\u2208N\nd\u03c8i (\u03c0 + + \u03b3+), (29)\nwhich is the same equality to find \u03c7+(rN ) in (14), hence \u03c0\u2217(rN ) = \u03c7\n+(rN ) \u2265 \u03c0+. Now it remains to show that (29) must have a non-negative\nsolution \u03c7+(rN ) when rN \u2264 \u03c31. Let\nF1(x) := \u2211\ni\u2208N\nd\u03c8i (x) \u2212 rN \u2212 zN , (30)\nwhich is a continuous and monotonically decreasing function of rN . Since F1(\u03c0 +) \u2265 0, F1(\u00b5max) \u2264 0, where \u00b5max is such that d\u03c8i (\u00b5max) = 0, there must exist a \u03c7 +(rN ) \u2208 [\u03c0+, \u00b5max] such that F (\u03c7+(rN )) = 0. The positive solution of (30) also implies d\u03c7 +\ni \u2208 [0, d \u03c0+\ni ]. From the continuity and monotonicity of F1 in rN , and the monotonicity of the marginal utility function Li, the price \u03c7\n+(rN ) is a continuous and monotonically decreasing function of rN . Therefore, in summary, \u03c0\u2217 = \u03c0+ when rN > \u03c31 and zN > \u2211 i\u2208N (d \u03c8 i (\u03c0\n+) \u2212 ri) > 0, and \u03c0 \u2217(rN ) = \u03c7 +(rN ) when rN \u2264 \u03c31 and \u2211\ni\u2208N\n(\nd\u03c8i (\u03c7 +(rN ))\u2212 ri\n)\n= zN .\nBy following the same steps in PNEM,+, we can show that by solving PNEM,\u2212, we have \u03c0\u2217(rN ) = \u03c0\u2212 when rN < \u03c34 and zN < \u2211 i\u2208N (d \u03c8 i (\u03c0 \u2212) \u2212 ri) < 0 and \u03c0\u2217(rN ) = \u03c7\u2212(rN ) when rN \u2265 \u03c34 and \u2211 i\u2208N (d \u03c8 i (\u03c7\n\u2212(rN ))\u2212 ri) = zN . Under PNEM,o, the Lagrangian Lo is given by\nLo(\u00b7) = \u2212 \u2211\ni\u2208N\nUi(d \u03c8 i (\u03c0)) + \u03b7\no \u2211\ni\u2208N\n(d\u03c8i (\u03c0)\u2212 ri), (31)\nwhere \u03b7o \u2265 0 is the Lagrangian multiplier of the equality constraint. By KKT conditions, the optimal price is \u03c0\u2217(rN ) = \u03b7o(rN ), where \u03b7\no(rN ) must be such that the equality constraint holds \u2211\ni\u2208N\nd\u03c8i (\u03c0) = rN , (32)\nwhich is the same equality to find \u03c7z(rN ) in (15), hence \u03c0\u2217(rN ) = \u03c7 z(rN ). Now we will show that \u03c7 z(rN ) \u2208 [\u03c0\u2212, \u03c0+] when rN \u2208 [\u03c32, \u03c33], let\nF2(x) := \u2211\ni\u2208N\nd\u03c8i (x)\u2212 rN , (33)\nNote that F2(x) is continuous and monotonically decreasing. Because\nF2(\u03c0 +) \u2264 0, F2(\u03c0 \u2212) \u2265 0,\nthere must exists \u03c0 \u2208 [\u03c0\u2212, \u03c0+] such that F2(\u03c0) = 0, and from the continuity and monotonicity of F2 in rN , and the monotonicity of the marginal utility function Li, the price \u03c7z(rN ) is a continuous and monotonically decreasing function of rN . Hence, in summary \u03c0 \u2217(rN ) = \u03c7 z(rN ) \u2208 [\u03c0\u2212, \u03c0+] when rN \u2208 [\u03c32, \u03c33]. The equilibrium price \u03c0\u2217(rN ) is therefore as shown in (12) with the payment rule P\u03c7 \u2217\ni (zi) = \u03c0 \u2217(rN ) \u00b7 zi \u2212 A\u2217i (rN ) that\nbelongs to A as shown in Lemma 2. Lastly, to show that the equilibrium achieves the highest community welfare, we leverage Lemma 4. Note that under the OEs-aware pricing, the member\u2019s optimal consumption policy\nd\u03c8 \u2217\ni (\u03c0 \u2217) = [fi(\u03c0 \u2217)]di0 , \u2200i \u2208 N ,\nresults in the following surplus function\nS\u03c7 \u2217\ni (\u03c8 \u2217(ri), ri) = Ui(d\n\u03c8\u2217 i (\u03c0 \u2217))\u2212 P\u03c7 \u2217 i (z \u03c8\u2217 i (\u03c0 \u2217)),\nwhere z\u03c8 \u2217 i (\u03c0 \u2217) = d\u03c8 \u2217 i (\u03c0 \u2217)\u2212ri. By aggregating the surplus of members under their optimal consumption policy \u2211\ni\u2208N\nS\u03c7 \u2217\ni (\u03c8 \u2217(ri), ri)=\n\u2211\ni\u2208N\n(\nUi(d \u03c8\u2217 i (\u03c0 \u2217))\u2212 P\u03c7 \u2217 i (z \u03c8\u2217 i (\u03c0 \u2217)) )\n(A) = \u2211\ni\u2208N\n  \n \nUi(d \u03c8\u2217 i (\u03c7 +))\u2212 \u03c7+z\u03c8 \u2217 i (\u03c7 +) , rN \u2264 \u03c31 Ui(d \u03c8\u2217 i (\u03c0 +))\u2212 \u03c0+z\u03c8 \u2217 i (\u03c0 +) , rN \u2208 (\u03c31, \u03c32) Ui(d \u03c8\u2217 i (\u03c0 z))\u2212 \u03c0zz\u03c8 \u2217 i (\u03c0 z) , rN \u2208 [\u03c32, \u03c33] Ui(d \u03c8\u2217 i (\u03c0 \u2212))\u2212 \u03c0\u2212z\u03c8 \u2217 i (\u03c0 \u2212) , rN \u2208 (\u03c33, \u03c34) Ui(d \u03c8\u2217 i (\u03c7 \u2212))\u2212 \u03c7\u2212z\u03c8 \u2217 i (\u03c7 \u2212) , rN \u2265 \u03c34\n+\n \n\n(\u03c7+(rN )\u2212 \u03c0+)zN , rN \u2264 \u03c31 (\u03c7\u2212(rN )\u2212 \u03c0\u2212)zN , rN \u2265 \u03c34 0 , otherwise.\n(19) =\n  \n \n\u2211\ni\u2208N Ui(d \u03c8\u2217 i (\u03c7 +))\u2212 \u03c0+zN , rN \u2264 \u03c31\n\u2211\ni\u2208N Ui(d \u03c8\u2217 i (\u03c0 +))\u2212 \u03c0+z\u03c8 \u2217 N (\u03c0 +) , rN \u2208 (\u03c31, \u03c32)\n\u2211\ni\u2208N Ui(d \u03c8\u2217 i (\u03c0 z)) , rN \u2208 [\u03c32, \u03c33]\n\u2211\ni\u2208N Ui(d \u03c8\u2217 i (\u03c0 \u2212))\u2212 \u03c0\u2212z\u03c8 \u2217 N (\u03c0 \u2212) , rN \u2208 (\u03c33, \u03c34)\n\u2211\ni\u2208N Ui(d \u03c8\u2217 i (\u03c7 \u2212))\u2212 \u03c0\u2212zN , rN \u2265 \u03c34\n=:W\u03c7 \u2217,\u03c8\u2217 ,\nwhere (A) is done by leveraging D-NEM threshold structure, and the expectation is dropped because the solution is for every possible realization, therefore it includes the expected value too. From Lemma 4, we can see that W\u03c7 \u2217,\u03c8\u2217 =W \u2217,NEMN (rN ), and that d\u03c8 \u2217\ni = d \u266f i , z\n\u03c8\u2217 i = z \u266f i , for all i \u2208 N , which proves\nthat the community welfare under the equilibrium solution W\u03c7 \u2217,\u03c8\u2217 is the maximum community welfare under centralized operation W \u2217,NEMN .\n17\nE. Proof of Corollary 1\nThe proof follows directly form the proof of conforming with Axiom 3 in Lemma 2, when the conditions \u03c0\u2212 < \u03c0+, \u2211\ni\u2208N zi < zN and \u2211 i\u2208N zi > zN are met.\nF. Proof of Proposition 1\nRecall the surplus of the community member\nS\u03c7 \u2217\ni (\u03c8 \u2217(ri), ri) and the maximum surplus of the benchmark in (8). For every i \u2208 N , to prove the monotonicity of VoC\n\u03c7\u2217,NEM i with each exogenous parameter we take the\nderivative with respect to that parameter.\n1) Monotonicity with (zN , zN ): Deriving VoC \u03c7\u2217,NEM i with\nrespect to zN , we have\n\u2202VoC\u03c7 \u2217,NEM i\n\u2202zN = E\n[{\n(\u03c7+(rN )\u2212 \u03c0+)/N , rN \u2264 \u03c31\n0 , otherwise\n]\n\u2265 0,\nbecause \u03c7+(rN ) \u2265 \u03c0+.\nOn the other hand, deriving VoC \u03c7\u2217,NEM i w.r.t. zN , we have\n\u2202VoC\u03c7 \u2217,NEM i\n\u2202zN = E\n[{\n(\u03c7\u2212(rN )\u2212 \u03c0\u2212)/N , rN \u2265 \u03c34\n0 , otherwise\n]\n\u2264 0,\nbecause \u03c7\u2212(rN ) \u2264 \u03c0\u2212. 2) Monotonicity with (\u03c0+):\n\u2202VoC\u03c7 \u2217,NEM i\n\u2202\u03c0+ =E\n[\n \n\n\u2212ai , rN \u2264 \u03c31 ri \u2212 d \u03c8\u2217 i (\u03c0 +) , rN \u2208 (\u03c31, \u03c32) 0 , rN \u2265 \u03c32\n+\n \n \nzi , ri \u2264 \u2206i1 d\u03c8 \u2217\ni (\u03c0 +)\u2212 ri , ri \u2208 (\u2206i1,\u2206 i 2)\n0 , ri \u2265 \u2206 i 2\n]\n,\nwhere we used Li(d \u03c8\u2217 i (\u03c0 +)) = \u03c0+, d\u03c0 + i = di \u03c8(\u03c0+) and ai is as in (27). 2.a) If rN \u2264 \u03c31: then we have\n\u2202VoC\u03c7 \u2217,NEM i\n\u2202\u03c0+ = E\n[\n \n\n\u2212(zN \u2212 \u2211 i\u2208N zi)/N , ri \u2264 \u2206 i 1 d\u03c8 \u2217\ni (\u03c0 +)\u2212 ri \u2212 ai , ri \u2208 (\u2206i1,\u2206 i 2)\n\u2212ai , ri \u2265 \u2206i2\n]\n\u2264 0\nwhere in the first and third pieces above, we used the assumption, zN \u2212 \u2211\ni\u2208N zi \u2265 0, and in the second piece we have from the thresholds\nd\u03c8 \u2217\ni (\u03c0 +)\u2212 ri \u2212 ai \u2264 \u2206 i 1 := d\n\u03c8\u2217 i (\u03c0 +)\u2212 zi \u2212 ri < 0,\nbecause \u2206i1 < ri. 2.b) If rN \u2208 (\u03c31, \u03c32): then we have\n\u2202VoC\u03c7 \u2217,NEM i\n\u2202\u03c0+ = E\n[\n \n\nri \u2212 d \u03c8\u2217 i (\u03c0 +) + zi , ri \u2264 \u2206i1 0 , ri \u2208 (\u2206i1,\u2206 i 2) ri \u2212 d \u03c8\u2217 i (\u03c0 +) , ri \u2265 \u2206i2 ] .\nWhen ri \u2264 \u2206i1, we have \u2202VoC\u03c7\n\u2217,NEM\ni \u2202\u03c0+ \u2264 0 because ri \u2264\nd\u03c8 \u2217\ni (\u03c0 +) \u2212 zi := \u2206i1. When ri \u2265 \u2206 i 2 \u2265 0, we have\n\u2202VoC\u03c7 \u2217,NEM\ni \u2202\u03c0+ \u2265 0 because ri \u2265 d\n\u03c8\u2217 i (\u03c0 +) := \u2206i2.\n2.c) If rN \u2265 \u03c32: then we have\n\u2202VoC\u03c7 \u2217,NEM i\n\u2202\u03c0+ = E\n[\n  \n\nzi , ri \u2264 \u2206i1 d\u03c8 \u2217\ni (\u03c0 +)\u2212 ri , ri \u2208 (\u2206i1,\u2206 i 2)\n0 , ri \u2265 \u2206i2\n]\n\u2265 0.\n3) Monotonicity with (\u03c0\u2212):\n\u2202VoC\u03c7 \u2217,NEM i\n\u2202\u03c0\u2212 =E\n[\n \n\n0 , rN \u2264 \u03c33 ri \u2212 d \u03c8\u2217 i (\u03c0 \u2212) , rN \u2208 (\u03c33, \u03c34) \u2212ai , rN \u2265 \u03c34\n+\n \n\n0 , ri \u2264 \u2206i3 d\u03c8 \u2217\ni (\u03c0 \u2212)\u2212 ri , ri \u2208 (\u2206 i 3,\u2206 i 4)\nzi , ri \u2265 \u2206 i 4\n]\n,\nwhere we used Li(d \u03c8\u2217 i (\u03c0 \u2212)) = \u03c0\u2212, d\u03c0 \u2212 i = di \u03c8(\u03c0\u2212) and ai is as in (27). The monotonicity of each piece above can be easily shown by following the steps in the proof of the monotonicity with \u03c0+.\nG. Proof of Theorem 2\nWe compare the surplus difference between community members under aggregate-level OEs and member-level OEs frameworks, where Under the former, the customer\u2019s payment is based on the two-part pricing, whereas under the latter the customer\u2019s payment is one-part, as shown in \u00a7A. The proof is complete if we show that\n\u2206S\u03c7 \u2217,DNEM\u2217 := S\u03c7\n\u2217\ni (\u03c8 \u2217(ri), ri)\u2212 S\nDNEM \u2217\ni (ri) =   \n\nUi(d \u03c8\u2217 i (\u03c7 +)) \u2212 \u03c7+z\u03c8 \u2217 i (\u03c7 +) + (\u03c7+ \u2212 \u03c0+)ai , rN \u2264 \u03c31 Ui(d \u03c8\u2217 i (\u03c0 +))\u2212 \u03c0+z\u03c8 \u2217 i (\u03c0 +) , rN \u2208 (\u03c31, \u03c32) Ui(d \u03c8\u2217 i (\u03c0 z))\u2212 \u03c0zz\u03c8 \u2217 i (\u03c0 z) , rN \u2208 [\u03c32, \u03c33] Ui(d \u03c8\u2217 i (\u03c0 \u2212))\u2212 \u03c0\u2212z\u03c8 \u2217 i (\u03c0 \u2212) , rN \u2208 (\u03c33, \u03c34) Ui(d \u03c8\u2217 i (\u03c7 \u2212))\u2212 \u03c7\u2212z\u03c8 \u2217 i (\u03c7 \u2212) + (\u03c7\u2212 \u2212 \u03c0\u2212)ai , rN \u2265 \u03c34 \u2212\n \n\nUi(d \u00b5z i (ri))\u2212 \u03c0 DNEM(r)zi , ri < d \u03c0DNEM i \u2212 zi Ui(d \u03c0DNEM i )\u2212 \u03c0 DNEM(r)(d\u03c0 DNEM i \u2212 ri) , ri \u2212 d \u03c0DNEM i \u2208 [\u2212zi,\u2212zi] Ui(d \u00b5z i (ri))\u2212 \u03c0 DNEM(r)zi , ri > d \u03c0DNEM i \u2212 zi,\nis non-negative, where the prices \u00b5z(ri) and \u00b5 z(ri) are the solutions of\n[fi(\u00b51)] di 0 = zi + ri, [fi(\u00b52)] di 0 = zi + ri,\nrespectively. From the community pricing policy under member-level OEs in \u00a7A, we have two main cases: 1) rN < \u03981(r), 2) rN > \u03982(r). Case 1) rN < \u03981(r), rN < \u03c32: Note that \u03c0\nDNEM = \u03c0+. We have two sub-cases for the aggregate-level OEs community: 1.a) rN \u2264 \u03c31, and 1.b) rN \u2208 (\u03c31, \u03c32).\n18\nCase 1.a) rN \u2264 \u03c31: If ri \u2208 [d\u03c0 + i \u2212 zi, d \u03c0+\ni \u2212 zi] we simply have Case 2 in the proof of Axiom 3 in Lemma 2. If ri > d\u03c0 +\ni \u2212 zi, we know that d \u00b5z i (ri) > d \u03c8\u2217 i (\u03c7 +), hence and using\nthe concavity of the utility function, we have\n\u00b5z(d\u03c8 \u2217 i (\u03c7 +)\u2212 d\u00b5 z i (ri)) \u2265 Ui(d \u03c8\u2217 i (\u03c7 +))\u2212 Ui(d \u00b5z i (ri))\n\u2265 \u03c7+(d\u03c8 \u2217 i (\u03c7 +)\u2212 d\u00b5 z i (ri)),\nand using the lower bound, we get\n\u2206S\u03c7 \u2217,DNEM\u2217 \u2265 (\u03c7+ \u2212 \u03c0+)ai + \u03c7 +(ri \u2212 d \u00b5z i (ri)) + \u03c0 +zi\n= (\u03c7+ \u2212 \u03c0+)( zN \u2212\n\u2211\ni\u2208N zi\nN ) \u2265 0,\nwhere we used d\u00b5 z i (ri) = zi + ri. Lastly, if ri < d \u03c0+\ni \u2212 zi then d\u00b5 z\ni (ri) \u22da d \u03c8\u2217 i (\u03c7 +). After checking both cases, one can\nsee that \u2206S\u03c7 \u2217,DNEM\u2217 \u2265 0. Case 1.b) rN \u2208 (\u03c31, \u03c32): If ri \u2208 [d\u03c0 + i \u2212 zi, d \u03c0+ i \u2212 zi] then \u2206S\u03c7 \u2217,DNEM\u2217 = 0. If ri > d \u03c0+ i \u2212 zi, we know that d \u00b5z i (ri) > d\u03c8 \u2217\ni (\u03c0 +). Using the concave utility function property as above, and taking the lower bound, we get \u2206S\u03c7 \u2217,DNEM\u2217 \u2265 0. Lastly, if ri < d \u03c0+ i \u2212zi then d \u00b5z i (ri) < d \u03c8\u2217 i (\u03c0 +), and using the concave utility function property as above, and taking the lower bound, we get \u2206S\u03c7 \u2217,DNEM\u2217 \u2265 0. Case 2) rN > \u03982(r), rN > \u03c33: Note that \u03c0 DNEM = \u03c0\u2212. We have two sub-cases for the aggregate-level OEs community: 2.a) rN \u2208 (\u03c33, \u03c34), and 2.b) rN \u2265 \u03c34. Case 2.a) rN \u2208 (\u03c33, \u03c34): If ri \u2208 [d\u03c0 \u2212 i \u2212zi, d \u03c0\u2212 i \u2212zi] we have \u2206S\u03c7 \u2217,DNEM\u2217 = 0. If ri > d \u03c0\u2212 i \u2212 zi, we know that d \u00b5z i (ri) > d\u03c8 \u2217\ni (\u03c0 \u2212). Using the concave utility function property as above, and taking the lower bound, we get \u2206S\u03c7 \u2217,DNEM\u2217 \u2265 0. Lastly, if ri < d \u03c0\u2212 i \u2212zi then d \u00b5z i (ri) < d \u03c8\u2217 i (\u03c0 \u2212), and using the concave utility function property as above, and taking the lower bound, we get \u2206S\u03c7 \u2217,DNEM\u2217 \u2265 0. Case 2.b) rN \u2265 \u03c34: If ri \u2208 [d\u03c0 \u2212 i \u2212 zi, d \u03c0\u2212\ni \u2212 zi] we simply have Case 9 in the proof of Axiom 3 in Lemma 2. If ri < d \u03c0\u2212 i \u2212 zi, we know that d \u00b5z i (ri) < d \u03c8\u2217 i (\u03c7 \u2212), hence and using the concavity of the utility function, and taking the lower bound, we get\n\u2206S\u03c7 \u2217,DNEM\u2217 \u2265 (\u03c7\u2212 \u2212 \u03c0\u2212)(\nzN \u2212 \u2211\ni\u2208N zi N ) \u2265 0,\nwhere we used d\u00b5 z i (ri) = zi + ri. Lastly, if ri > d \u03c0\u2212\ni \u2212 zi then d\u00b5 z\ni (ri) \u22da d \u03c8\u2217 i (\u03c7 \u2212). After checking both cases, one can\nsee that \u2206S\u03c7 \u2217,DNEM\u2217 \u2265 0."
        }
    ],
    "title": "A Decentralized Market Mechanism for Energy Communities under Operating Envelopes",
    "year": 2024
}
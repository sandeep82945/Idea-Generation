{
    "abstractText": "Despite the extensive application of nonlinear Model Predictive Control (MPC) in automated driving, balancing its computational efficiency with respect to the control performance and constraint satisfaction remains a challenge in emergency scenarios: in such situations, sub-optimal but computationally fast responses are more valuable than optimal responses obtained after long computations. In this paper, we introduce a hybridization approach for efficient approximation of nonlinear vehicle dynamics and non-convex constraints using a hybrid systems modeling framework. Hybridization allows to reformulate the nonlinear MPC problem during emergency evasive maneuvers as a hybrid MPC problem. In this regard, Max-Min-PlusScaling (MMPS) hybrid modeling is used to approximate the nonlinear vehicle dynamics. Meanwhile, different formulations for constraint approximation are presented, and various gridgeneration methods are compared to solve these approximation problems. Among these, two novel grid types are introduced to structurally include the influence of the system dynamics on the grid point distributions in the state domain. Overall, the work presents and compares three hybrid models and four hybrid constraints for efficient MPC synthesis and offers guidelines for implementation of the presented hybridization framework in other applications.",
    "authors": [
        {
            "affiliations": [],
            "name": "Leila Gharavi"
        },
        {
            "affiliations": [],
            "name": "Bart De Schutter"
        }
    ],
    "id": "SP:a120eb2a6ecedb8b089201be807e86f2aecaca3f",
    "references": [
        {
            "authors": [
                "P. Stano",
                "U. Montanaro",
                "D. Tavernini",
                "M. Tufo",
                "G. Fiengo",
                "L. Novella",
                "A. Sorniotti"
            ],
            "title": "Model predictive path tracking control for automated road vehicles: A review",
            "venue": "Annual Reviews in Control, 2022.",
            "year": 2022
        },
        {
            "authors": [
                "Society of Automotive Engineers (SAE International"
            ],
            "title": "Taxonomy and definitions for terms related to on-road motor vehicle automated driving systems",
            "venue": "Sep, 3, 2017, https://web.archive.org/web/20170903105244/ https:/www.sae.org/misc/pdfs/automated driving.pdf.",
            "year": 2017
        },
        {
            "authors": [
                "Y. Huang",
                "Y. Chen"
            ],
            "title": "Vehicle lateral stability control based on shiftable stability regions and dynamic margins",
            "venue": "IEEE Transactions on Vehicular Technology, vol. 69, no. 12, pp. 14 727\u201314 738, 2020.",
            "year": 2020
        },
        {
            "authors": [
                "N. Chowdhri",
                "L. Ferranti",
                "F.S. Iribarren",
                "B. Shyrokau"
            ],
            "title": "Integrated nonlinear model predictive control for automated driving",
            "venue": "Control Engineering Practice, vol. 106, p. 104654, 2021.",
            "year": 2021
        },
        {
            "authors": [
                "J.K. Subosits",
                "J.C. Gerdes"
            ],
            "title": "Impacts of model fidelity on trajectory optimization for autonomous vehicles in extreme maneuvers",
            "venue": "IEEE Transactions on Intelligent Vehicles, vol. 6, no. 3, pp. 546\u2013558, 2021.",
            "year": 2021
        },
        {
            "authors": [
                "V.Z. Patterson",
                "F.E. Lewis",
                "J.C. Gerdes"
            ],
            "title": "Optimal decision making for automated vehicles using homotopy generation and nonlinear model predictive control",
            "venue": "IEEE Intelligent Vehicles Symposium, 2021, pp. 1045\u20131050.",
            "year": 2021
        },
        {
            "authors": [
                "N. Guo",
                "X. Zhang",
                "Y. Zou",
                "B. Lenzo",
                "T. Zhang"
            ],
            "title": "A computationally efficient path-following control strategy of autonomous electric vehicles with yaw motion stabilization",
            "venue": "IEEE Transactions on Transportation Electrification, vol. 6, no. 2, pp. 728\u2013739, 2020.",
            "year": 2020
        },
        {
            "authors": [
                "M. Metzler",
                "D. Tavernini",
                "P. Gruber",
                "A. Sorniotti"
            ],
            "title": "On prediction model fidelity in explicit nonlinear model predictive vehicle stability control",
            "venue": "IEEE Transactions on Control Systems Technology, vol. 29, no. 5, pp. 1964\u20131980, 2021.",
            "year": 1964
        },
        {
            "authors": [
                "D. Tavernini",
                "M. Metzler",
                "P. Gruber",
                "A. Sorniotti"
            ],
            "title": "Explicit nonlinear model predictive control for electric vehicle traction control",
            "venue": "IEEE Transactions on Control Systems Technology, vol. 27, no. 4, pp. 1438\u2013 1451, 2019.",
            "year": 2019
        },
        {
            "authors": [
                "K. Oh",
                "J. Seo"
            ],
            "title": "Development of an adaptive and weighted model predictive control algorithm for autonomous driving with disturbance estimation and grey prediction",
            "venue": "IEEE Access, vol. 10, pp. 35 251\u2013 35 264, 2022.",
            "year": 2022
        },
        {
            "authors": [
                "T. Brudigam",
                "M. Olbrich",
                "D. Wollherr",
                "M. Leibold"
            ],
            "title": "Stochastic model predictive control with a safety guarantee for autonomous driving",
            "venue": "IEEE Transactions on Intelligent Vehicles, vol. 8, no. 1, pp. 22\u201336, 2023.",
            "year": 2023
        },
        {
            "authors": [
                "J. Wurts",
                "J.L. Stein",
                "T. Ersal"
            ],
            "title": "Design for real-time nonlinear model predictive control with application to collision imminent steering",
            "venue": "IEEE Transactions on Control Systems Technology, vol. 30, no. 6, pp. 2450\u2013 2465, 2022.",
            "year": 2022
        },
        {
            "authors": [
                "M. Rokonuzzaman",
                "N. Mohajer",
                "S. Nahavandi"
            ],
            "title": "Effective adoption of vehicle models for autonomous vehicle path tracking: a switched MPC approach",
            "venue": "Vehicle System Dynamics, pp. 1\u201324, 2022.",
            "year": 2022
        },
        {
            "authors": [
                "K. Zhang",
                "J. Sprinkle",
                "R.G. Sanfelice"
            ],
            "title": "Computationally aware control of autonomous vehicles: a hybrid model predictive control approach",
            "venue": "Autonomous Robots, vol. 39, pp. 503\u2013517, 2015.",
            "year": 2015
        },
        {
            "authors": [
                "T. Zhao",
                "E. Yurtsever",
                "R. Chladny",
                "G. Rizzoni"
            ],
            "title": "Collision avoidance with transitional drift control",
            "venue": "IEEE International Intelligent Transportation Systems Conference (ITSC), 2021, pp. 907\u2013914. IEEE TRANSACTIONS ON INTELLIGENT VEHICLES, VOL. 00, NO. 0, SEPTEMBER 2023 13",
            "year": 2021
        },
        {
            "authors": [
                "E. Asarin",
                "T. Dang",
                "A. Girard"
            ],
            "title": "Hybridization methods for the analysis of nonlinear systems",
            "venue": "Acta Informatica, vol. 43, no. 7, p. 451, 2007.",
            "year": 2007
        },
        {
            "authors": [
                "J. Lunze",
                "F. Lamnabhi-Lagarrigue"
            ],
            "title": "Handbook of Hybrid Systems Control: Theory, Tools, Applications",
            "year": 2009
        },
        {
            "authors": [
                "M. Amir",
                "T. Givargis"
            ],
            "title": "Hybrid state machine model for fast model predictive control: Application to path tracking",
            "venue": "IEEE/ACM International Conference on Computer-Aided Design (ICCAD), 2017, pp. 185\u2013192.",
            "year": 2017
        },
        {
            "authors": [
                "X. Sun",
                "Y. Cai",
                "S. Wang",
                "X. Xu",
                "L. Chen"
            ],
            "title": "Optimal control of intelligent vehicle longitudinal dynamics via hybrid model predictive control",
            "venue": "Robotics and Autonomous Systems, vol. 112, pp. 190\u2013200, 2019.",
            "year": 2019
        },
        {
            "authors": [
                "A. Bemporad",
                "M. Morari"
            ],
            "title": "Control of systems integrating logic, dynamics, and constraints",
            "venue": "Automatica, vol. 35, no. 3, pp. 407\u2013427, 1999.",
            "year": 1999
        },
        {
            "authors": [
                "T. Suzuki",
                "K. Aihara"
            ],
            "title": "Nonlinear system identification for prostate cancer and optimality of intermittent androgen suppression therapy",
            "venue": "Mathematical Biosciences, vol. 245, pp. 40\u201348, 2013.",
            "year": 2013
        },
        {
            "authors": [
                "E. Khanmirza",
                "M. Nazarahari",
                "A. Mousavi"
            ],
            "title": "Identification of piecewise affine systems based on fuzzy PCA-guided robust clustering technique",
            "venue": "Eurasip Journal on Advances in Signal Processing, vol. 2016, pp. 1\u201315, 2016.",
            "year": 2016
        },
        {
            "authors": [
                "X. Sun",
                "W. Hu",
                "Y. Cai",
                "P. Wong",
                "L. Chen"
            ],
            "title": "Identification of a piecewise affine model for the tire cornering characteristics based on experimental data",
            "venue": "Nonlinear Dynamics, vol. 101, pp. 857\u2013874, 2020.",
            "year": 2020
        },
        {
            "authors": [
                "S. Di Cairano",
                "H.E. Tseng",
                "D. Bernardini",
                "A. Bemporad"
            ],
            "title": "Vehicle yaw stability control by coordinated active front steering and differential braking in the tire sideslip angles domain",
            "venue": "IEEE Transactions on Control Systems Technology, vol. 21, no. 4, pp. 1236\u20131248, 2013.",
            "year": 2013
        },
        {
            "authors": [
                "D. Jagga",
                "M. Lv",
                "S. Baldi"
            ],
            "title": "Hybrid adaptive chassis control for vehicle lateral stability in the presence of uncertainty",
            "venue": "Mediterranean Conference on Control and Automation (MED 2018), 2018, pp. 529\u2013534.",
            "year": 2018
        },
        {
            "authors": [
                "M. Corno",
                "G. Panzani",
                "F. Roselli",
                "M. Giorelli",
                "D. Azzolini",
                "S.M. Savaresi"
            ],
            "title": "An LPV approach to autonomous vehicle path tracking in the presence of steering actuation nonlinearities",
            "venue": "IEEE Transactions on Control Systems Technology, vol. 29, no. 4, pp. 1766\u20131774, 2020.",
            "year": 2020
        },
        {
            "authors": [
                "W.P.M.H. Heemels",
                "B. De Schutter",
                "A. Bemporad"
            ],
            "title": "Equivalence of hybrid dynamical models",
            "venue": "Automatica, vol. 37, no. 7, pp. 1085\u20131091, 2001.",
            "year": 2001
        },
        {
            "authors": [
                "B. De Schutter",
                "T. van den Boom",
                "J. Xu",
                "S.S. Farahani"
            ],
            "title": "Analysis and control of max-plus linear discrete-event systems: An introduction",
            "venue": "Discrete Event Dynamic Systems: Theory and Applications, vol. 30, pp. 25\u201354, 2020.",
            "year": 2020
        },
        {
            "authors": [
                "A. Kripfganz",
                "R. Schulze"
            ],
            "title": "Piecewise affine functions as a difference of two convex functions",
            "venue": "Optimization, vol. 18, no. 1, pp. 23\u201329, 1987.",
            "year": 1987
        },
        {
            "authors": [
                "E. P\u00e9rez",
                "C. Ari\u00f1o",
                "F.X. Blasco",
                "M.A. Mart\u0131\u0301nez"
            ],
            "title": "Explicit predictive control with non-convex polyhedral constraints",
            "venue": "Automatica, vol. 48, no. 2, pp. 419\u2013424, 2012.",
            "year": 2012
        },
        {
            "authors": [
                "P. T\u00f8ndel",
                "T. Johansen",
                "A. Bemporad"
            ],
            "title": "An algorithm for multiparametric quadratic programming and explicit MPC solutions",
            "venue": "Automatica, vol. 39, no. 3, pp. 489\u2013497, 2003.",
            "year": 2003
        },
        {
            "authors": [
                "N. Kochdumper",
                "M. Althoff"
            ],
            "title": "Computing non-convex innerapproximations of reachable sets for nonlinear continuous systems",
            "venue": "IEEE Conference on Decision and Control (CDC), 2020, pp. 2130\u20132137.",
            "year": 2020
        },
        {
            "authors": [
                "X. Miao",
                "Y. Song",
                "Z. Zhang",
                "S. Gong"
            ],
            "title": "Successive convexification for ascent trajectory replanning of a multistage launch vehicle experiencing nonfatal dynamic faults",
            "venue": "IEEE Transactions on Aerospace and Electronic Systems, vol. 58, no. 3, pp. 2039\u20132052, jun 2022.",
            "year": 2022
        },
        {
            "authors": [
                "P. Scheffe",
                "T. Mario Henneken",
                "M. Kloock",
                "B. Alrifaee"
            ],
            "title": "Sequential convex programming methods for real-time optimal trajectory planning in autonomous vehicle racing",
            "venue": "IEEE Transactions on Intelligent Vehicles, 2021.",
            "year": 2021
        },
        {
            "authors": [
                "B. A\u00e7\u0131kme\u015fe",
                "J.M. Carson",
                "L. Blackmore"
            ],
            "title": "Lossless convexification of nonconvex control bound and pointing constraints of the soft landing optimal control problem",
            "venue": "IEEE Transactions on Control Systems Technology, vol. 21, no. 6, pp. 2104\u20132113, 2013.",
            "year": 2013
        },
        {
            "authors": [
                "R. Deits",
                "R. Tedrake"
            ],
            "title": "Computing large convex regions of obstaclefree space through semidefinite programming",
            "venue": "Algorithmic Foundations of Robotics XI: Selected Contributions of the Eleventh International Workshop on the Algorithmic Foundations of Robotics, 2015, pp. 109\u2013 124.",
            "year": 2015
        },
        {
            "authors": [
                "K. Okamoto",
                "P. Tsiotras"
            ],
            "title": "Optimal stochastic vehicle path planning using covariance steering",
            "venue": "IEEE Robotics and Automation Letters, vol. 4, no. 3, pp. 2276\u20132281, 2019.",
            "year": 2019
        },
        {
            "authors": [
                "L. Yao"
            ],
            "title": "Nonparametric learning of decision regions via the genetic algorithm",
            "venue": "IEEE Transactions on Systems, Man, and Cybernetics, Part B (Cybernetics), vol. 26, no. 2, pp. 313\u2013321, 1996.",
            "year": 1996
        },
        {
            "authors": [
                "J. Xu"
            ],
            "title": "Morphological decomposition of 2-D binary shapes into conditionally maximal convex polygons",
            "venue": "Pattern Recognition, vol. 29, no. 7, pp. 1075\u20131104, 1996.",
            "year": 1996
        },
        {
            "authors": [
                "L. Yao",
                "K.S. Weng"
            ],
            "title": "Learning decision regions based on adaptive ellipsoids",
            "venue": "International Journal of Uncertainty, Fuzziness and Knowlege- Based Systems, vol. 22, no. 1, pp. 41\u201373, 2014.",
            "year": 2014
        },
        {
            "authors": [
                "X. Wei",
                "M. Liu",
                "Z. Ling",
                "H. Su"
            ],
            "title": "Approximate convex decomposition for 3D meshes with collision-aware concavity and tree search",
            "venue": "ACM Transactions on Graphics, vol. 41, no. 4, pp. 1\u201318, 2022.",
            "year": 2022
        },
        {
            "authors": [
                "R. Bulbul",
                "A.U. Frank"
            ],
            "title": "AHD: The alternate hierarchical decomposition of nonconvex polytopes (generalization of a convex polytope based spatial data model)",
            "venue": "International Conference on Geoinformatics, 2009, pp. 1\u20136.",
            "year": 2009
        },
        {
            "authors": [
                "Q. Zhang",
                "I.E. Grossmann",
                "A. Sundaramoorthy",
                "J.M. Pinto"
            ],
            "title": "Datadriven construction of convex region surrogate models",
            "venue": "Optimization and Engineering, vol. 17, pp. 289\u2013332, 2016.",
            "year": 2016
        },
        {
            "authors": [
                "P. Duhr",
                "A. Sandeep",
                "A. Cerofolini",
                "C.H. Onder"
            ],
            "title": "Convex performance envelope for minimum lap time energy management of race cars",
            "venue": "IEEE Transactions on Vehicular Technology, vol. 71, no. 8, pp. 8280\u20138295, 2022.",
            "year": 2022
        }
    ],
    "sections": [
        {
            "text": "Index Terms\u2014Hybridization framework, Model predictive control, Evasive maneuvers, Vehicle control\nI. INTRODUCTION\nMODEL predictive control (MPC) has become increas-ingly popular in automated driving research over the past few decades [1]. This is mainly due to its capability to structurally handle constraints, as well as its ability to adapt to the system by performing controller synthesis in a rollinghorizon optimization-based manner.\nSeveral lines of research have focused on handling the effects of vehicle nonlinearities arising, e.g., during critical maneuvers like emergency braking, evasive maneuvers, drifting and so on. Handling such nonlinear vehicle dynamics is a significant source of computational burden in MPC, which is a major obstacle towards real-time applicability of MPC for high levels of automation defined by the Society of Automated Engineers (SAE) [2]. In particular, in Level 4 and Level 5 of automation, hazardous scenarios need to be automatically handled without any intervention from a human driver. Thus, improving the computational efficiency of MPC in critical scenarios remains an important research challenge. Suggested approaches to increase computational efficiency include decoupling the lateral and longitudinal vehicle dynamics [3] or\nLeila Gharavi and Bart De Schutter are with the Delft Center for Systems and Control, Delft University of Technology, 2628 CD Delft, The Netherlands (e-mails: L.Gharavi@tudelft.nl; B.DeSchutter@tudelft.nl).\nSimone Baldi is with the School of Mathematics, Southeast University, Nanjing 21118, China (e-mail: S.Baldi@tudelft.nl).\nusing ad-hoc kinematics and dynamics [4]. Other research lines have also looked at the effect of model fidelity on control in limits of friction [5] or around drift equilibria [6].\nAnother research direction has been solving the nonlinear optimization problem in a more efficient manner e.g., via new numerical solution algorithms [7] or offline explicit solution of the nonlinear MPC problem [8]. Nevertheless, Tavernini et al. [9] demonstrated that the explicit MPC approach does not yield significant computational improvements. Adaptive weights, adaptive prediction horizon length [10] or non-uniform sampling times [11] have also been examined; for instance, Wurts et al. [12] argue that varying sampling times can increase the computational burden due to the resulting change in integration points in the prediction horizon.\nIncreasing attention has also been given to switchingbased control designs. For instance, switching among different prediction models was proposed in [13]. In this sense, the switching command can be defined in different ways such as switching to a higher-fidelity model in case of uncontrollable error divergence [14], or switching among different drifting/driving modes [15].\nA more general approach along this angle is hybridization [16] of the control optimization problem, that is, approximating it using a hybrid systems formulation. In this sense, the term \u201chybrid\u201d refers to the class of systems incorporating both continuous and discrete dynamics [17]. In [18], a hybrid equivalent state machine is learned online and fed into the controller as the prediction model. In low-velocity tracking applications, [19] approximates the nonlinear model using a Mixed-Logical-Dynamical (MLD) formalism [20].\nIn vehicle control, the nonlinearity of the control optimization problem is caused by two factors: the prediction model of the system that serves as the equality constraint, and physics-based inequality constraints such as handling and tire force limits that are generally non-convex. The hybridization problem in MPC essentially must involve both model and constraint approximations. Despite some similarities, there are clear distinctions in the two resulting hybridization problems that must be taken into account.\nHybrid approximation of the system has been used to improve the computational speed in various applications [21]\u2013 [23]. Different approaches have been proposed in the automated driving literature to hybridize the vehicle model, such as representing the nonlinear tire forces by a piecewise-affine function [7], [24], [25] or using a grid-based linear-parametervarying approximation of the vehicle model [26]. Nevertheless, to the best of our knowledge, hybridization has not yet been incorporated into emergency evasive maneuvers and/or highlynonlinear vehicle dynamics.\nar X\niv :2\n31 0.\n00 71\n5v 1\n[ ee\nss .S\nY ]\n1 O\nct 2\n02 3\nThe hybridization of a nonlinear system dynamics is equivalent to breaking down a single global complex form into multiple modes with lower complexity and valid in a local activation region: by this approach, nonlinearity is traded with the introduction of switching/discrete behavior. This added discrete nature is represented in different forms in each hybrid system modeling framework [27]. For instance, in a piecewiseaffine formulation, the local modes, as well as their activation regions, are both explicitly represented. This, however, would increase the complexity of the approximation problem if the activation regions and/or their numbers are unknown.\nAmong different hybrid modeling frameworks, Max-MinPlus-Scaling (MMPS) systems [28] have the advantage of implicit expression of the activation regions, which simplifies the approximation by significant reduction of the number of decision variables. For this reason, the MMPS approach is the one adopted in this work. As its name suggests, MMPS formulation represents a function using only (and possibly nested) max, min, adding and scaling operators. Kripfganz [29] showed that any MMPS function can also be equivalently represented by the difference of two max operators of affine function, which may be more tractable.\nPhysics- or environment-based non-convex constraints have been dealt with in different ways. For instance, [30] considers the convex hull of the non-convex polyhedral constraints and disregards the non-optimal solutions using the binary search tree of [31]. In reachability analysis, [32] computes an inner-approximation of the feasible region using an outer approximation of the reachable sets.\nIn the motion control literature, real-time trajectory planning is often tackled by either lossless or successive convexification [33], [34]. In the lossless approach, a convex relaxation of the original problem is solved and then a proof of equivalence or a sub-optimality measure (if possible at all) is given between the solutions of the relaxed problem and the nonconvex one [35]. In successive convexification, a sequence of convex sub-problems is solved instead, accompanied by a proof of recursive feasibility [34]. It should be noted that the real-time capability of the convexification method in the aforementioned cases is a crucial factor since the non-convex constraints imposed by the environment are changing in each control time step.\nWhen there is no requirement of real-time implementation due to the fixed nature of the constraint, the convexification problem can be solved offline and with more focus on its accuracy. In some applications such as path planning in cluttered environments, it is important to find a feasible region for the next control time step, which translates into finding the largest convex subset of a given cluttered feasible region [36]. Nevertheless, a generic offline convexification problem can be obtained by approximating a non-convex region by a union of convex subregions. As defining these subregions manually is unpractical [37], approaches from computational geometry have been proposed. For instance, it has been shown that convexification is analogous to the NP-hard problem of Approximate Convex Decomposition [38] with applications to shape analysis [39] or decision region in pattern recognition [40]. However, the recent advances in this field have been\ntailored more and more toward the specific needs of pattern recognition; e.g., identifying the skeletons of the decomposed shape for shape analysis by concavity matrices [41] is more important than analyzing the approximations inaccuracy with respect to the distance to the non-convex boundary. In general, analyzing the difference between the convex hull and the shape is a popular approach in convex decomposition; however, it is mainly tailored for non-convex polyhedral regions [42]. Thus, it is essential to specify the primary factors of the constraint approximation problem with respect to the control objective, as well as the application.\nIn practice, hybrid approximations have rarely been used for highly complex vehicle models; e.g., to the best of our knowledge, there are no studies that include hybridization of the coupled longitudinal and lateral dynamics of the vehicle model. Moreover, controlling evasive maneuvers in critical scenarios requires a systematic analysis of the vehicle model complexity and the resulting computation trade-off, which has not been conducted as far as we are aware.\nIn this paper, we provide a comparison benchmark to analyze and improve the computational performance of MPC optimization problem for vehicle control in critical highvelocity scenarios using hybrid formulation of the control optimization problem. This benchmark is divided in two parts: the first part is dedicated to the hybridization of the MPC via approximating the constraints, i.e., prediction model and physics-based constraints, whereas the second part investigates the improvements of the resulting hybrid MPC controller in comparison with the original nonlinear MPC controller.\nThe contributions to the state-of-the-art in the current paper are as follows: \u2022 presenting of a novel hybrid approximation of the system\nusing an MMPS formulation, \u2022 developing a new generalized formalism for constraint\napproximation problem including an approach based on a polytopic definition of the regions by an MMPS function, and comparing the resulting approximations with two methods from the literature, \u2022 introducing two trajectory-based grid generation method for model approximation, \u2022 investigating grid-based numerical solutions of the model and constraint approximation with respect to the grid behavior, and \u2022 presenting a novel hybridization benchmark with the objective of improving the computational efficiency of nonlinear MPC controller.\nThe current paper is organized as follows: Section II covers the preliminary definitions of the model and constraint approximation problems. Section III describes the grid generation methods, including the novel trajectory-based approach in nonuniform sampling of the input/state pairs. Section IV defines the approximation problems. Section V presents the hybridization framework for model and constraint approximation using the generated grids and the validation results of the said approximation problems. Section VI summaries the hybridization framework, findings, and outlook for implementation and future work. This paper is Part I of a two-part publication entitled \u201cEfficient MPC for Emergency Evasive Maneuvers\u201d;\nthe application and analysis of the presented hybridization framework is then discussed in detail in the second part: \u201cEfficient MPC for Emergency Evasive Maneuvers: Part II, Comparative Assessment for Hybrid Control\u201d."
        },
        {
            "heading": "II. BACKGROUND",
            "text": "Consider a given nonlinear system, either in continuoustime x\u0307 = F(x,u) or in discrete-time x+ = F(x,u) where x\u2208Rn and u \u2208Rm respectively represent the state and input vectors, and the domain of F is denoted by (x,u) \u2208 D \u2286 Rm+n. In many physics-based applications, the model F is valid over a region C \u2286D defined by\nC := {(x,u) \u2208D | 0 \u2a7d G(x,u)\u2a7d 1},\nwhich collects a set of physics-based constraints1. For instance, most typical vehicle models in the literature are no longer valid if e.g., the vehicle is rolling over. Here we aim at approximating both the nonlinear model F and the nonlinear, non-convex set C . Therefore, we need to hybridize both F and C . Both approximation problems can essentially be expressed as follows: minimize the approximation error over their respective domains. However, the approximation error, as well as the domain, are different for each problem."
        },
        {
            "heading": "A. Model Approximation",
            "text": "The system F is approximated by a hybrid formulation f via solving the nonlinear optimization problem\nmin A \u222b C \u2225F(x,u)\u2212 f (x,u)\u22252 \u2225F(x,u)\u22252 + \u03b50 d(x,u), (1)\nwhere A represents the decision variables used to define f . The positive value \u03b50 > 0 added to the denominator is to avoid division by very small values for \u2225F(x,u)\u22252 \u2248 0. Note that the domain in the model approximation problem is C ."
        },
        {
            "heading": "B. Constraint Approximation",
            "text": "With the nonlinear, non-convex constraints given as 0 \u2a7d G(x,u)\u2a7d 1, we approximate the feasible region C by a union of convex subregions R.\nThis approximation problem can be formulated in two ways: region-based and boundary-based. In the region-based approach, we minimize the misclassification error via solving the following optimization problem\nmin \u03bd\n\u03b3c V {C \\R}\nV {C } +(1\u2212 \u03b3c) V {R \\C } V {D \\C } , (2)\nwhere \u03bd represents the decision variables used to define R, the operator V gives the size or \u201cvolume\u201d of the region, and \u03b3c \u2208 [0,1] is a tuning parameter to adjust the relative penalization weight for the misclassification errors regarding inclusion error C \\R, i.e., failing to cover the feasible region, and the violation error R \\C which corresponds to violating the constraints.\n1We use the normalized constraint formulation 0 \u2a7d G \u2a7d 1 instead of the generic form G \u2a7d 0 to avoid numerical issues in solving the approximation/control optimization problems.\nIn the boundary-based approach, we approximate the boundary G by a hybrid function g and minimize the boundaryapproximation error similar to (1) via solving the optimization problem\nmin \u03bd \u222b D |G(x,u)\u2212g(x,u)| |G(x,u)|+ \u03b50 d(x,u). (3)\nwith \u03b50 > 0. Note that as G is a scalar function, the 2-norm is replaced by the absolute value here.\nRemark 1. In case of having more inequalities e.g.,\n0 \u2a7d Gi(x,u)\u2a7d 1, for i = {1,2, . . . ,N},\nG(x,u) can be formulated as\nG(x,u) = max i\u2208{1,2,...,N} {Gi(x,u)}.\nAnother approach is to approximate each Gi independently; however, that method may lead to redundant approximations of boundaries or parts of Gi that do not belong to the overall boundary feasible region.\nThe nonlinear non-convex constraints arise from the physics-based limitations of the system. Therefore, \u2022 the physics-based nature of the constraints results in a\nconnected feasible region, \u2022 the highly-nonlinear (boundary of the) constraints limits\nthe analytical investigation of \u201cattainability\u201d2 or optimality, \u2022 the approximation approach is intended to be used within a hybridization benchmark, which means the method should be applicable for systems of higher degree and/or with high-dimensional feasible regions, \u2022 the constraint violation is evaluated by ensuring that the solution lies within any of the subregions, which means overlapping subregions are acceptable, \u2022 in light of improving the computational efficiency, it is desired to have a minimal approximation of the constraints, i.e., approximating the non-convex feasible region with a union of fewer number of subregions is desired as well as an accurate coverage of the whole region, which leads to the need for \u2022 a systematic approach to cover the non-convex feasible region by a union of convex subregions that allows balancing the violation vs. coverage of the approximation close to the constraint boundaries.\nConsidering the aforementioned features, the applicability of state-of-the-art methods based on convex-hull generation [43] is limited for the current case as input-state spaces for complex vehicle models exceed four dimensions and a systematic division of the feasible region is not computationally efficient in terms of memory usage and speed for our desired accuracy. To compare our constraint approximation approach, we consider two state-of-the-art methods that share the most common elements with the aforementioned considerations in their respective problems.\n2Attainability of a point means that there exists an input such that the point is obtained by the system dynamics.\nThe first method is from [38], where a non-convex region is covered by a number of ellipsoids. Here, an optimization problem is solved to minimize the misclassification error due to the region approximation where the center and radii of the ellipsoids are the decision variables. This approach is referred to as non-parametric elliptical learning and is equivalent to region-based approximation of the constraints by a union of ellipsoids. Our constraint approximation framework can be seen an extension and generalization of this approach by investigating boundary-based vs. region-based approximations and polytopic vs. ellipsoidal definition of the subregions.\nThe second method is from [44], where the gripping limits of the vehicle are approximated by a convex intersection of second-order cone constraints. [44] formulates the constraints using the system dynamics and fits the parameters of the combined formulation using experimental data. We refer to this approach as the convex envelope method, which is equivalent to a boundary-based approximation of the constraints by the intersection of multiple convex subregion. Since this method approximates the non-convex feasible region by a convex one, in Section V we will show its limitation in converging to an accurate approximation of the constraints in comparison with our proposed framework.\nSince analytical closed-form solutions for (1)\u2013(3) do not exist, we propose solving them numerically3 by generating a grid of samples from their regarding domains C and D , respectively denoted by C \u2217 and D\u2217. As the grid generation method influences the quality of the final fit, we provide various grid-generation methods for both approximation problems in the next section and examine the resulting fits in our results in Section V."
        },
        {
            "heading": "III. GRID GENERATION",
            "text": "We use two main approaches to generate D\u2217: domain-based and trajectory-based. In the domain-based approach, both the input and state elements of the grid points are selected from the input/state domain D , regardless of the system\u2019s behavior. While a domain-based grid can have a good coverage of D , it does not take into account the \u201clikelihood\u201d of the points being visited in a simulation with respect to the system dynamics. The trajectory-based way of generating D\u2217 tackles this issue by selecting the input elements of the grid points u\u2217 from D , while assigning the state elements to the points from an nstepstep-ahead simulation of F given u\u2217 as the input. As a result, the obtained D\u2217 will have a higher density in regions of D where the input/state pairs have a higher likelihood of being attainable.\nEach of these two approaches can be implemented in two ways, giving rise to a total of four methods to generate D\u2217: \u2022 Domain-based: [points are directly sampled from D]\n\u2013 Uniform (D\u2217U ): the points are generated by picking nsamp uniformly-spaced points along each axis in D . \u2013 Random (D\u2217R): a total of nrand points are randomly selected from D .\n3For instance, another approach to solving the aforementioned approximation problem is the Monte Carlo integration method.\n\u2022 Trajectory-based: [nsim open-loop simulations with nstep steps of F are run using random inputs from D]\n\u2013 Steady-state (D\u2217S ): the initial state of each simulation is selected as the steady-state solution w.r.t. the initial input, i.e., it is assumed that each simulation starts from a steady state. \u2013 Randomly-initiated (D\u2217T ): the initial state of each simulation is randomly selected from D .\nAlgorithms 1 and 2 respectively explain the domain-based and trajectory-based grid generation methods. The total number of grid points for each type denoted by N is\nN (D\u2217U ) = (nsamp) m+n, N (D\u2217R) = nrand,\nN (D\u2217S ) = N (D \u2217 T ) = nsim\u00d7nstep.\nAlgorithm 1 Domain-based grid generation Input: F, D , nsamp, nrand, type \u2208 {\u2018U\u2019, \u2019R\u2019}\nif type = \u2018U\u2019 then index \u2190 ( 0, 1\nnsamp\u22121 , 2 nsamp\u22121\n, . . .1 )\nfor k \u2208 {1,2, . . .m+n} do bandk = D(k)max \u2212D(k)min \u25b7 D(k) := axis k of D \u03bdk = D(k)min +bandk\u00d7 index \u25b7 \u03bdk := sample vector end for D\u2217U \u2190 \u03bd1\u00d7\u03bd2\u00d7\u00b7\u00b7 \u00b7\u00d7\u03bdm+n \u25b7 all possible combinations\nelse if type = \u2018R\u2019 then for k \u2208 {1,2, . . .nrand} do\n(xk,uk) random\u2190\u2212\u2212\u2212\u2212D\nD\u2217R\u2190D\u2217R\u222a (xk,uk) end for\nend if return D\u2217type\nAlgorithm 2 Trajectory-based grid generation Input: F, Dx, Du, nsim, nstep, type \u2208 {\u2018S\u2019, \u2019T\u2019}\nfor s \u2208 {1,2, . . . ,nsim} do u random\u2190\u2212\u2212\u2212\u2212Du \u25b7 Du := input domain if type = \u2018S\u2019 then\nx1\u2190{x | F(x,u1) = 0} \u25b7 steady-state solution else if type = \u2019T\u2019 then\nx1 random\u2190\u2212\u2212\u2212\u2212Dx \u25b7 Dx := state domain\nend if for k \u2208 {2,3, . . . ,nstep} do\nxk\u2190 xk\u22121 +F (xk\u22121,uk\u22121) if (xk,uk) /\u2208D then\nbreak \u25b7 stop current simulation end if x\u2190 x\u222a xk u\u2190 u\u222auk\nend for end for D\u2217type\u2190 (x,u) return D\u2217type\nThe grid D\u2217 plays the role of domain in the approximation problem. Therefore, it should be tailored to the objective of the problem itself. In this sense, Figure 1 shows a schematic view of the implementation of the proposed grid-generation approaches for both model and constraint approximation problems.\nFor model approximation, the grid should be generated only from C , as the points outside C are infeasible, which translates to zero likelihood of attainability. Therefore, while Algorithms 1 and 2 are implemented on D , only the samples from the feasible region should be kept. Then the four resulting grids, C \u2217U , C \u2217 R , C \u2217 S , and C \u2217 T can be used to examine their efficacy. Contrary to the model approximation problem, the points for constraint approximation should be distributed in the whole\ndomain D to allow examining the approximation error. In addition, for constraint approximation, the regions close to the boundary of C are of more interest than the areas with higher likelihood of attainability. Therefore, while trajectorybased methods are useful for model approximation, to find the constraints, we are interested in using a domain-based grid with a higher density in the neighborhood of G(x,u) = 0. This grid can be obtained by combining a uniform grid D\u2217U with a random grid B\u2217R on the boundary region B where\nB := {(x,u) \u2208D | |G(x,u)|\u2a7d \u03b5b}.\nThe resulting generated grid is D\u2217U \u222aB\u2217R.\nRemark 2. To ensure that trajectory-based grids are generated by \u201crealistic\u201d inputs, we impose a bound constraint on the random inputs as\n|u\u2217(k+1)\u2212u\u2217(k)|< \u2206\u2217u.\nThis can also account for the physical limitations of the actuators and be considered to be part of the physics-based constraints C and it is best selected based on data from real operation of the system.\nRemark 3. Depending on the problem characteristics such as the system dynamics, domain, and the nature of the input/state signals, some points in the generated grids (except for the U type) can be very close to each other. To avoid these points from having larger importance than other points during approximation, Algorithms 1 and 2 can further be refined by keeping only one point from each set of points that are closer to each other than a user-defined distance threshold."
        },
        {
            "heading": "IV. APPROXIMATION PROBLEM FORMULATION",
            "text": ""
        },
        {
            "heading": "A. Model Approximation",
            "text": "We approximate the nonlinear system F by the MMPS function f with the Kripfganz form [29] as\nf (x,u) = max p\u2208{1,2,...,P+}\n{ \u03c6+p (x,u) } \u2212 max\nq\u2208{1,2,...,P\u2212}\n{ \u03c6\u2212q (x,u) } ,\n(4) where P+ and P\u2212 are user-selected integers, and \u03c6+p , and \u03c6\u2212q are affine functions of x and u, sometimes referred to as dynamic modes, and expressed as\n\u03c6+p (x,u) = A + p x+B + p u+H + p ,\n\u03c6\u2212q (x,u) = A \u2212 q x+B \u2212 q u+H \u2212 q .\nWe implement the MMPS approximation in the following fashion: each dimension of the nonlinear function, i.e., each component of F , is approximated independently. Thus, P+ and P\u2212, as well as the affine functions \u03c6+ and \u03c6\u2212 are separately found for each component of F . Therefore, for brevity and without loss of generality, one can assume F to be scalar in the remaining of this section.\nFor a fixed pair (P+,P\u2212) that corresponds to the number of affine terms in the first and second max operators in (4), we solve the nonlinear optimization problem (1) subject to (4) to find the optimal \u03c6+ and \u03c6\u2212 functions where\nA = {\nA+p ,A \u2212 q ,B + p ,B \u2212 q ,H + p ,H \u2212 q } p\u2208{1,2,...,P+},q\u2208{1,2,...,P\u2212} . (5)\nRemark 4. To solve the nonlinear optimization problem in (1), we generate a grid C \u2217 of feasible samples from D as expressed in Section III, and minimize the objective function across C \u2217.\nRemark 5. The Kripfganz form essentially expresses the function using P+ \u00b7P\u2212 hyperplanes as there are P+ and P\u2212 affine functions in each max operator. Therefore, the hinging hyperplanes representing the local dynamics are obtained by subtraction of the affine functions \u03c6\u2212 from \u03c6+ which means that the optimal A in (1) would not be unique.\nConsidering Remarks 4 and 5 and to avoid numerical problems, it is convenient to add a regularization term to (1) by penalizing the 1-norm of the decision vector as\nmin A \u222b C \u2217 |F(x,u)\u2212 f (x,u)| |F(x,u)|+ \u03b50 d(x,u)+ \u03b3m\u2225A \u22251, s.t. (4), (6)\nwhere \u03b3m \u2208 R+ serves as a weighting coefficient to balance the penalization of the 1-norm of A with respect to the approximation error."
        },
        {
            "heading": "B. Constraint Approximation",
            "text": "We approximate the feasible region C by either a union of convex polytopes using the MMPS formalism, or by a union of ellipsoids. Figure 2 depicts both approaches to constraint approximation.\nIn the MMPS approach, a similar formulation to the MMPS model approximation problem is used: we approximate G by an MMPS function gMMPS of the Kripfganz form in (4). The resulting feasible region RMMPS is then expressed as\nRMMPS := {(x,u) \u2208D | gMMPS(x,u)\u2a7d 0}, (7)\nThe MMPS approximation of the feasible region is then obtained via solving either the region-based (2) or the boundarybased (3) optimization problems subject to\nR = RMMPS,\nand \u03bd = {\nR+p ,R \u2212 q ,S + p ,S \u2212 q ,T + p ,T \u2212 q } p\u2208{1,2,...,P+},q\u2208{1,2,...,P\u2212} , (8)\nwhere the matrices R, S, and T represent the constraintapproximation counterparts of matrices A, B, and H in (5) and (P+,P\u2212) stand for the respective number of affine terms.\nThe second way is to approximate the feasible region by a union of ne ellipsoids\nRe := { (x,u) \u2208D \u2223\u2223\u2223\u2223 (x\u2212 x0eu\u2212u0e )T Qe ( x\u2212 x0e u\u2212u0e ) \u2a7d 1 } , (9)\nwith Qe being a positive definite matrix and (x0,u0) representing the center coordinates of the ellipsoid. Note that this notation includes rotated ellipsoids as well. The approximated region RELLP is\nRELLP = ne\u22c3\ne=1\nRe := {(x,u) \u2208D | gELLP(x,u)\u2a7d 0}, (10)\nwhose boundary can be expressed by\ngELLP(x,u) = min e\u2208{1,2,...,ne} {( x\u2212 x0e u\u2212u0e )T Qe ( x\u2212 x0e u\u2212u0e ) \u22121 } .\n(11)\nThe ellipsoidal approximation is found by solving either the region-based (2) or the boundary-based (3) optimization problems subject to\nR = RELLP,\nand \u03bd = {(x0e ,u0e), Qe}e\u2208{1,2,...,ne} . (12)"
        },
        {
            "heading": "V. MODEL AND CONSTRAINT HYBRIDIZATION FOR VEHICLE CONTROL",
            "text": "In this section, the hybridization framework consisting of the model and constraint approximation approaches is implemented on a nonlinear single-track vehicle model with Dugoff tire forces and varying friction. First, the nonlinear system and physics-based constraints are described, then the training and validation grids are defined, which are next used for model and\nconstraint approximation problems within the hybridization framework. The results are then discussed to evaluate the performance of the different approaches and analyzed for application in other nonlinear problems."
        },
        {
            "heading": "A. Nonlinear System Descriptions",
            "text": "A single-track representation of the vehicle is shown in Fig. 3. With the system variables and parameters respectively defined in Tables I and II, the nonlinear vehicle model is described by the following equations [4]:\nv\u0307x = 1 m\n[ Fxf cos\u03b4 \u2212Fyf sin\u03b4 +Fxr ] + vyr, (13)\nv\u0307y = 1 m\n[ Fxf sin\u03b4 +Fyf cos\u03b4 +Fyr ] \u2212 vxr, (14)\nr\u0307 = 1 Izz\n[ Fxf sin\u03b4 lf +Fyf cos\u03b4 lf\u2212Fyr lr ] , (15)\nand the lateral forces are given by the Dugoff model\nFya = C\u03b1a\n1\u2212\u03baa f\u03bb (\u03bb wa )\u03b1a,\nwith a\u2208 {f, r} where \u00b5a is the varying friction coefficient, and \u03bb wa and f\u03bb are the weighting coefficient and function, defined as\n\u00b5a = \u00b50 ( 1\u2212 ervx \u221a \u03ba2a + tan2 \u03b1a ) ,\n\u03bb wa = \u00b5aFza(1\u2212\u03baa) 2 \u221a (C\u03baa\u03baa)2 +(C\u03b1a tan\u03b1a)2 ,\nf\u03bb (\u03bb wa ) = { \u03bb wa (2\u2212\u03bb wa ) \u03bb wa < 1 1 \u03bb wa \u2265 1 .\nTable I also shows the bounds we impose on state and input vectors for grid generation. The feasible region is defined by two other physics-based constraints:\n1) the working limits of the vehicle (known as the gg diagram constraint [4]) should be satisfied to allow derivation of the dynamics equation in (13) to (15); this entails\n(v\u0307x\u2212 vyr)2 +(v\u0307y + vxr)2 \u2a7d ( min a\u2208{f,r} {\u00b5ag})2, (16)\nTherefore, the feasible region C can be expressed as\nC := {(x,u) \u2208D | (16) , (17)} ."
        },
        {
            "heading": "B. Grid Definition and Coverage",
            "text": "Table III shows the grid properties for the model and constraint approximation problems. For the model, all four grid types U, R, S, and T are used for training and later validated on a finer grid of the all four types plus a combined grid C that includes all of them. For the constraint approximation, only one combined grid consisting of the union U and R grids is used for training and the approximations are validated on a finer and more extended combined grid.\nFor a visual comparison of the grid-point distribution for different types, we have plotted the coverage of the model approximation training and validation grids in the velocity domain (vx-vy) in Fig. 4. While the grids have a similar total number of points, the density of the points among different grid types varies significantly as follows:\n1) The domain-based grids cover C with a uniform density compared to the trajectory-based grids.\n2) Compared to its random counterpart, the U grid represents a sparser distribution in the velocity domain, which stems from the fact that representation of all the possible combinations of input/state pairs on lower-dimensional sub-spaces of C projects many points on the exact same location in the viewed plane. 3) Between the trajectory-based grids, the randomlyinitiated type (T) gives a better coverage of C . Contrarily, the S grid favors the regions of C where the states are attainable from a steady-state solution within a bounded number of steps, which explains the high density of points in low-speed region and the loose coverage of high-speed regions with zero lateral velocity.\nThe constraint approximation grids in the velocity domain are shown in Fig. 5. Besides generating more grid points in the validation grids, the width \u03b5b of its boundary region is selected twice as large as for the training one, which increases the relative density of the grid points in the high-speed region as visible in Fig. 5. Moreover, both grids have 50-60% of their points in the feasible region, which is a reasonable ratio for a fair comparison."
        },
        {
            "heading": "C. Model Approximation Results",
            "text": "Using the four model training grids in Table III, we approximate the dynamics of the three states independently by Kripfganz MMPS functions with (P+,P\u2212) with P+,P\u2212 \u2208 {1,2, . . .8}. Since the approximated model will eventually be discretized before being incorporated in the MPC formulation,\nwe already use a discretized form of the dynamics x\u0307 in (13) to (15) for approximation as\nx(k+1) = \u2206x(k)+ x(k).\nHere, \u2206x(k) is approximated instead of x(k+1) for two reasons: first, the assumptions and the approximation procedure remains valid by switching from x\u0307 to \u2206x, and second, in cases such as vx where the state values are of a significantly larger order of magnitude compared to their rates of change, approximating \u2206x leads to a more numerically-stable representation\nof the error. We solved the optimization problem (6) for every fixed pair of (P+,P\u2212) by MATLAB\u2019s nonlinear least squares optimizer, lsqnonlin, using the trust-region-reflective algorithm. This optimizer further exploits the structure of the nonlinear problem by approximating the Gauss-Newton direction through minimizing the 2-norm of the function deviation in the next step. The problem is then solved for 1000 initial random guesses to provide sufficient accuracy without excessive computational effort, among which we select the lowest objective value as the optimal solution. The codes for grid generation and hybrid approximations are available from our published hybridization toolbox [45].\nFig. 6 shows the training validation errors of the optimal solutions for \u2206vx, \u2206vy, and \u2206r on model approximation validation grids in Table III. The lateral dynamics of the nonlinear model has a higher degree of nonlinearity, which explains the different error scales in the MMPS approximation. The plots are grouped based on the system and the type of the training grid to gain a better insight into the behavior of each grid and its effect on the accuracy of the approximation.\nFirstly, it is observed that U and R grids overfit for lower numbers of hyperplanes compared to their trajectory-based counterparts, which is represented by high oscillations after a certain degree of complexity in the approximation form. The S grid shows the lowest oscillatory behavior in validation results, which can indicate the inability of this grid in converging to an accurate fit due to its grid-point distribution with higher density in regions that are attainable from a steady-state solution of the system dynamics.\nFor \u2206vx, U and R grids show overfitting behavior for P++P\u2212 \u2a7e 4 modes and T grid overfits for P++P\u2212 \u2a7e 5. However, the S grid does not show overfitting until 13 modes with a lower validation error (\u2248 0.4%) compared to the other grid types (\u2248 0.8%). It is worth noting that the trajectory-based validation grids start overfitting for a much larger number of modes compared to the domain-based types.\nFor \u2206vy, U and R grids again overfit at 4 modes, with 3% and 2% validation errors, respectively. The S grid overfits at 12 to 14 modes with reaching a validation error that is slightly above 1%, and the T grid overfits at 11 modes with an error of 2%.\nFor \u2206r, U grid overfits at 4 modes and its validation error\nremains above 42%. On the other hand, the R, S, and T grids reach their best fits at 12 to 15 modes, all with an error of about 9%. The S grid, while having the lowest training error in most cases, has the highest offset between the validation and the training error. This could be due to the S grid needing more points to provide a more realistic training error. However, it should be noted that the steady-state-initiated method\u2019s ability to generate new \u201cdistinct\u201d points is limited; as Table III shows, to generate a validation grid three-times as large as the training one, the number of simulations needed to be multiplied by 6, which is not the case for its randomlyinitiated counterpart, T. As the set of points attainable by a random input signal from a steady-state solution is limited, this difference is understandable. Nevertheless, this limitation is not restricting the S grid\u2019s ability to fit the model significantly (compared to e.g., the U grid)."
        },
        {
            "heading": "D. Constraint Approximation and Validation",
            "text": "For constraint approximation, both training and validation steps are done on the two constraint approximation C grids defined in Table III. The nonlinear constraints are approximated by either an intersection of second-order cones, which corresponds to the implementation of the convex envelope method from [44], or a union of convex subregions, which gives a non-convex approximation of the feasible region. Based on the formulation of the approximation problem, i.e., (2) or (3), the approach is region- or boundary-based. The shape of the subregions is also either ellipsoidal or polytopic, where the latter is developed by an MMPS formulation of the nonlinear constraint. This leads to four methods of constraint approximation as shown in Table V where the best fits and their corresponding parameters as well as their approximation errors are presented. It should be noted that the region-based ellipsoidal approximation is a modified implementation of the non-parametric ellipsoidal learning method [39].\nSimilar to model approximation, we solved the boundarybased optimization problems (3) for every fixed pair of (P+,P\u2212) or ne by MATLAB\u2019s nonlinear least squares optimizer, lsqnonlin for 1000 initial guesses (selected in a similar way as for the model approximation). However, the region-based approach results in a non-smooth optimization problem (2) which we solved using the particle swarm optimizer in MATLAB, which does not require the problem to be differentiable. The swarm size was selected to be 10 times larger than the number of decision variables as a sufficiently large number for our experiments, and the problem was solved 1000 times for each case of (P+,P\u2212) or ne and the best\nsolution was kept as the optimal one. In addition, the convex envelope approach from [44] where the boundary of the nonlinear constraints is approximated by an intersection of nc second-order cone constraints is also implemented in the same fashion for different values of nc. Figure 7 shows the training and validation errors for different constraint approximation methods.\nThe convex envelope approach approximates the feasible region by a convex area that is the intersection of nc secondorder cone constraints. Therefore, for systems where the concavity measure, i.e., the difference between the feasible region and its convex hull, is significant compared to its size, this method converges to either high violation or inclusion misclassification errors, which is visible in the behavior of the training and validation plots in Fig. 7a. Starting from one second-order cone constraint to approximate the feasible region with, this approach converges to an area covering about 25% of the feasible and 25% of the infeasible regions. Increasing the number of cone constraints to more than 3 leads to a significant improvement in the obtained fit. Nevertheless, the best convex envelope fit is obtained at nc = 6 with the inclusion and violation errors of 45% and 5% respectively, both of which are not acceptable as a proper fit. This shows that the method is converging to more accurate approximations of the largest convex subset of the feasible region, which is covering about 50% of it.\nThe difference between the region- and boundary-based approaches is due the fact that in the region-based approximation (2), the inclusion and violation misclassification errors are penalized, while in the boundary-based approximation (3), the error in approximation of the distance to the boundary is minimized. This difference is more clear in the MMPS approximation plots where with one binary variable, the boundary is approximated by an affine function, i.e., a hyperplane. Problem (3) then converges to a hyperplane with the lowest sum of distances from the nonlinear boundary. However, since the violation error is penalized more than the inclusion error with \u03b3c < 0.5, problem (2) converges to an empty set where the violation error is zero and the inclusion error is 1, giving the optimal misclassification error of 1\u2212 \u03b3c. In all the cases, it is observed that the region-based approximation converges to lower violation and higher inclusion errors due to the same reason.\nMMPS approximation of the constraints via the regionbased approach shows overfitting behavior after considering 6 binary variables. After 3 binary variables, the fits start oscillating between a more \u201cinclusive\u201d approximation and a more \u201cviolating\u201d one. However, the best fit is obtained with 7 binary variables. Even by increasing this number, problem (2) keeps converging to the same misclassification error.\nBoundary-based MMPS approximation reaches the best fit with 8 binary variables where again, adding more binary variables and increasing the complexity level of the fit does not change the inclusion and violation errors significantly and only minor oscillations between converging to a slightly more inclusive approximation or to a slightly more violating one are observed.\nEllipsoidal approximation of the feasible region gener-\nally converges to fits with lower accuracy compared to the MMPS approximation. In the region-based approximation, the training and validation errors stay at the same level with slight oscillations after ne = 7 with inclusion and violation misclassification errors of respectively 26.7% and 0.6%. In this sense, for the same number of integer variables, the ellipsoidal region-based approximation converges to a similar violation error but a 50% higher inclusion error. The boundary-based ellipsoidal approximation on the other hand shows a different overfitting behavior where increasing the number of ellipsoidal subregions results in convergence to a better coverage at the expense of a significant increase in violation error. Therefore, the best fit should be selected before the point where the violation error exceeds a user-defined accepted threshold. Here we select ne = 5 since it is the last complexity before the violation error exceeds 6%. Another observed pattern is the divergence of violation errors in training and validation, which mirrors the nature of the approximation approach: increasing the number of ellipsoids translates into generating more ellipsoidal subregions close to the boundary to minimize the distance-to-boundary sum. However, in the validation phase this leads to significantly higher violation errors as a result of the approximation overfitting to the training grid."
        },
        {
            "heading": "VI. CONCLUSIONS AND OUTLOOK",
            "text": "This paper has presented a hybridization framework for approximation nonlinear model and constraints. This framework serves as benchmark for formulating nonlinear MPC optimization problems using a hybrid systems formalism to improve computational efficiency and to ensure real-time implementation. The conclusions of the research in this paper with respect to its contributions, and the hybridization framework are summarized in the following subsections. The hybrid control comparison benchmark is discussed in detail in Part II of this publication."
        },
        {
            "heading": "A. Conclusions for Vehicle Tracking Control",
            "text": "Introduction of the hybridization framework in this paper is a result of the following steps where the model and constraint approximation problems were defined by means of several novel descriptions of the approximation problem. First, for the model approximation, the Kripfganz MMPS form was used to approximate the nonlinear system to a user-defined error\nbound. Second, the nonlinear feasible region resulting from the physics-based constraints was approximated by a union of ellipsoids and polytopes via region- and boundary-based formulation of the approximation problem. Third, the model and constraint approximation problems were solved numerically across various grids types sampled from the input/state domain and their corresponding fit qualities in terms of accuracy and overfitting behavior were compared. Fourth, among the different grid types, two novel trajectory-based grid generation methods were introduced to structurally increase the density of the grid points in regions of the state domain with higher likelihood of the attainability by the system dynamics. This approach resulted in 15\u221260% reduction of the approximation error compared to its domain-based counterpart. Finally, the different grid generation and formulations of the approximation problems were analyzed to present a hybridization benchmark for improving the computational performance of the MPC problem for other applications of nonlinear MPC, as well as tracking control in emergency evasive maneuvers; this comparative assessment is explained in Part II."
        },
        {
            "heading": "B. Generalized Hybridization Framework",
            "text": "Our proposed hybridization framework can be implemented in other applications of nonlinear MPC to improve computational efficiency by considering the following guidelines:\n1) The model approximation problem should be solved by either an R, S, or T grid. The density of the R-type grid points can vary by sampling using various random distributions. Additionally, if there is a significant variance in the likelihood of attainability for different input/state pairs, it is recommended to use the trajectorybased S or T grids. Depending on the nature of the system dynamics, the S grid is a proper choice if the attainable subset of the state-domain from steady-state solutions is rich or large enough to ensure coverage of the whole domain by selecting a sufficiently large number of sampling points over each trajectory. On the other hand, this will not be an issue for the T grid, at the expense of including input/state pairs that are only attainable from an unattainable initial state. In general, if such properties of the system dynamics are not fully known, it is suggested to consider all three grid types and compare the overfitting behavior as done in this paper. 2) The Kripfganz MMPS form is a compact and wellformulated way to impose continuity in the hybrid approximation of the nonlinear problem; it provides straightforward and intuitive control over the accuracy of the approximation with respect to the number of introduced binary variables that are assigned to each affine local dynamics appearing in the max operators. The number of affine terms can be increased up until the point where either the maximum number of binary variables or the maximum tolerated approximation error are reached. Both of these stopping criteria can be chosen by the user and based on the application. 3) The nonlinear non-convex feasible region can be approximated by a union of ellipsoids or polytopes using region-, as well as boundary-based formulations of the approximation problem. If the application requires to strictly avoid violating the nonlinear constraints by the approximated ones, it is recommended to use the region-based formulation of the approximation problem. However, the boundary-based formulation leaves more room to balance the trade-off between covering the nonlinear region and violating it, and converges to better coverage of the non-convex region. This trade-off can also be managed within the region-based formulation by adjusting the tuning parameter \u03b3c, but its capability in modifying the priority of the costs of inclusion vs. violation error with respect to the distance from the boundary is limited.\nUsing the above guidelines, the hybridization approach can be implemented in different applications such as motion planning, navigation, or real-time control of systems with fast dynamics where it is required to balance the computational speed and accuracy of the MPC problem."
        },
        {
            "heading": "C. Next Steps and Future Work",
            "text": "In the next part of this paper, we present the hybrid control comparison benchmark using this hybridization framework for balancing the computational efficiency of the MPC optimization problem in vehicle control during emergency evasive maneuvers.\nThe next steps of the current research can proceed along (but not limited to) the following lines: investigation of the proposed hybridization framework in applications with higher dimensions e.g., large-scale control problems, extension of the model approximation step by incorporating other hybrid modeling frameworks such as piecewise-quadratic or mixedlogical-dynamical systems as compact models for a good trade-off between constraint satisfaction, computational complexity, and control performance."
        },
        {
            "heading": "ACKNOWLEDGMENT",
            "text": "This research is funded by the Dutch Science Foundation NWO-TTW within the EVOLVE project (no. 18484). The authors would also like to thank Dr. Barys Shyrokau for fruitful discussions on grid generation ideas."
        }
    ],
    "title": "Efficient MPC for Emergency Evasive Maneuvers, Part I: Hybridization of the Nonlinear Problem",
    "year": 2023
}
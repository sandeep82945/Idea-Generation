{
    "abstractText": "Within an imaging instrument\u2019s field of view, there may be many observational targets of interest. Similarly, within a spectrograph\u2019s bandpass, there may be many emission lines of interest. The brightness of these targets and lines can be orders of magnitude different, which poses a challenge to instrument and mission design. A single exposure can saturate the bright emission and/or have a low signal-to-noise ratio (S/N) for faint emission. Traditional high dynamic range (HDR) techniques solve this problem by either combining multiple sequential exposures of varied duration or splitting the light to different sensors. These methods, however, can result in the loss of science capability, reduced observational efficiency, or increased complexity and cost. The simultaneous HDR method described in this paper avoids these issues by utilizing a special type of detector whose rows can be read independently to define zones that are then composited, resulting in areas with short or long exposure measured simultaneously. We demonstrate this technique for the Sun, which is bright on disk and faint off disk. We emulated these conditions in the lab to validate the method. We built an instrument simulator to demonstrate the method for a realistic solar imager and input. We then calculated S/Ns, finding a value of 45 for a faint coronal mass ejection and 200 for a bright one, both at 3.5 \uf065 N \uf052 \u2014meeting or far exceeding the international standard for digital photography that defines an S/N of 10 as acceptable and 40 as excellent. Future missions should consider this type of hardware and technique in their trade studies for instrument design. Unified Astronomy Thesaurus concepts: Astronomical techniques (1684); Direct imaging (387); Spectroscopy (1558); Astronomical detectors (84); Solar corona (1483); Solar coronal mass ejections (310)",
    "authors": [
        {
            "affiliations": [],
            "name": "James Paul Mason"
        },
        {
            "affiliations": [],
            "name": "Daniel B. Seaton"
        },
        {
            "affiliations": [],
            "name": "Andrew R. Jones"
        },
        {
            "affiliations": [],
            "name": "Meng Jin"
        },
        {
            "affiliations": [],
            "name": "Phillip C. Chamberlin"
        },
        {
            "affiliations": [],
            "name": "Alan Sims"
        },
        {
            "affiliations": [],
            "name": "Thomas N. Woods"
        }
    ],
    "id": "SP:db0a5c7c526cb7dfa38122ad9ec4a4479856559d",
    "references": [
        {
            "authors": [
                "Zenodo",
                "D. Berghmans",
                "B Nicula"
            ],
            "title": "SolarSoft: Programming and Data Analysis",
            "venue": "SoPh,",
            "year": 2008
        },
        {
            "authors": [
                "L. Golub",
                "J.M. Pasachoff"
            ],
            "title": "The Solar Corona (2nd edn.",
            "year": 2010
        },
        {
            "authors": [
                "A.G. Mu\u00f1oz",
                "L. Fossati",
                "A Youngblood"
            ],
            "title": "Guide to NumPy (USA: Trelgol Publishing",
            "year": 2021
        },
        {
            "authors": [
                "D.B. Seaton",
                "D. Berghmans",
                "B Nicula"
            ],
            "title": "2013b, SoPh",
            "year": 2013
        }
    ],
    "sections": [
        {
            "text": "N \u2014meeting or far exceeding the international standard for digital photography that defines an S/N of 10 as acceptable and 40 as excellent. Future missions should consider this type of hardware and technique in their trade studies for instrument design.\nUnified Astronomy Thesaurus concepts: Astronomical techniques (1684); Direct imaging (387); Spectroscopy (1558); Astronomical detectors (84); Solar corona (1483); Solar coronal mass ejections (310)"
        },
        {
            "heading": "1. Introduction",
            "text": "Many observational targets present a high dynamic range (HDR) in brightness. Spectral emission lines within a particular wavelength range of interest are not obligated to be similarly intense. For example, the Hubble Space Telescope observes Lyman \u03b1 (1216\u00c5), which is many times brighter than nearby spectral lines it also measures, such as Si III (1206\u00c5), O I (1304\u00c5), and C II (1335\u00c5). These lines are used for spectroscopy of transiting exoplanets and their host stars but the dynamic range requires that the dimmer lines be observed separately, necessitating multiple Hubble orbits (e.g., Mu\u00f1oz et al. 2020, 2021). This reduces the observational efficiency of a highly oversubscribed telescope as well as complicates the scientific analysis, which would prefer simultaneous measurements of all of these emission lines.\nSimilarly, within the field of view of a particular instrument, various objects may have wildly different intensities. The disk of the Sun is much brighter than the off-disk corona: 109 times brighter in white light by 2.5 nominal solar radii (  N ) and 104 times brighter in the extreme ultraviolet (EUV; Golub & Pasachoff 2010; Seaton et al. 2021). This is why observation of the middle (1.5 N ) and high (5 N ) corona is typically achieved by occulting the solar disk, for example during solar\neclipses or with coronagraphs. An unocculted exposure long enough to capture the corona leads to a completely saturated disk that could result in detector blooming that masks part of the corona. Moreover, scattered light is a problem that must be solved for any solar imager interested in the off-disk corona: even a small percentage of the copious disk photons scattering into the off-disk part of the image drives the signal-to-noise ratio (S/N) very low. Any science questions targeting a phenomenon that crosses from on disk to off (e.g., coronal mass ejections) therefore requires the combination of multiple optimized instruments. This introduces challenges with crosscalibration and coordination, as well as caveats in the conclusions drawn if, for example, different physical structures are being compared due to the observations being in different wavelength regimes. Such is the case with coronal mass ejections (CMEs) observed on disk with EUV but off disk with white light. HDR imaging solves these problems but can introduce new ones. In traditional HDR imaging, varying exposures are combined from either sequential images or separate sensors (Unger et al. 2016). Problems remain with these methods if (1) important temporal dynamics are lost or (2) a multisensor solution is prohibitively complex or expensive. Time dependence is a critical component of both examples in the previous paragraphs: exoplanet transits are transient phenomena that contain important atmospheric information in their time profiles, and coronal mass ejections constrain plasma particle acceleration models through their time-dependent kinematic\nOriginal content from this work may be used under the terms of the Creative Commons Attribution 4.0 licence. Any further\ndistribution of this work must maintain attribution to the author(s) and the title of the work, journal citation and DOI.\nprofiles (Mason et al. 2021 and references therein). Multiple sensors necessitate either beam splitters or multiple telescopes. Splitters reduce the number of photons and therefore the S/N, which is likely to majorly constrain HDR-oriented instruments because they are intended to measure faint sources. The alternative of employing multiple telescopes drastically drives up the cost of the observatory. Both options also increase the complexity of the design, necessitating additional mechanical, electrical, and/or software interfaces that, in turn, requires additional testing.\nWe present a method to achieve simultaneous HDR imaging with a single sensor through spatial partitioning, where each region integrates for an independent duration. Section 2 describes the algorithm, Section 3 presents our laboratory validation, and Section 4 details a software instrument simulator for the CME science case described above."
        },
        {
            "heading": "2. Simultaneous High Dynamic Range Algorithm",
            "text": "Our simultaneous high dynamic range (SHDR) algorithm only requires a detector whose rows can be read out independently. We have identified several complementary metal oxide semiconductor (CMOS) detectors with this capability and have employed it with one: a Teledyne e2v CIS115. The CIS115 detector is designed such that all the pixels in a single row are sampled at the same time. Rows are individually selected through a parallel address bus that is controlled by field-programmable gate array logic in our custom readout electronics. Only the selected row has its pixels sampled and reset. We developed the SHDR algorithm to support the Sun Coronal Ejection Tracker (SunCET; Mason et al. 2021) instrument, which is designed to track CMEs from their initiation on the bright solar disk through their complete\nacceleration profile in the middle corona where they become several orders of magnitude fainter. This means that the regions of interest are nonlinear: a circle at the center of the detector for the solar disk versus the remaining area on the detector. Figure 1 shows how the algorithm employs an independent but linear readout to achieve an effective nonlinear composite, in this case resulting in a short-integration-time6 circular region with a long-integration-time region for the remaining area. In order to remove transient noise including energetic particle hits in the data, this algorithm applies a median average across several sequential exposures. This is a wellestablished method that is used, for example, within all of the cameras on board the Solar Dynamics Observatory (Pesnell et al. 2012). This \u201cmedian image stack\u201d and regional readout define the imaging sequence over one minute, producing a composite image that is compressed and stored with the cameras\u2019 onboard processor and memory. Within our camera electronics software table, we can configure the duration of the long and short exposures (tlong and tshort) and the number of each used for the median stack (Nlong and Nshort). Note that this detector (and nearly all currently available similar detectors) cannot read pixels independently; it can only read rows independently. Therefore, in order to obtain the nonlinear (circular) cutout at the center of the image, those rows must be read twice, with both tshort and tlong exposure times (green and blue, respectively, in Figure 1). This means that the blue region combines Nlong \u2013 1 images for its median. As a result, Nlong should always be 4 to ensure enough images in the blue region for the median to be effective and to minimize any statistical difference between the red and blue\n6 Note: we use the terms \u201cintegration time\u201d and \u201cexposure time\u201d interchangeably herein.\nregions. The cutout and compositing of the circular region occur in camera processor software. SunCET\u2019s baseline design sets tlong= 15 s, Nlong= 4, tshort= 0.035 s, and Nshort= 10. These four parameters, as well as the mask that defines which pixels are in each of the three sectors (Figure 1, left), are configurable by command, allowing the flexibility to correct for any long-term changes due to, e.g., solar output, instrument degradation, or systematic pointing errors.\nThe orientation of the detector with respect to solar north need not stay fixed. One composite may be oriented as in Figure 1 while another is, for example, rotated 90\u00b0, meaning that the same physical area will have either three or four images in the median stack. The only difference is that the region with four images in the stack will have slightly less random noise. Section 4 shows S/N contour plots, which account for this and demonstrate that the effect is negligible. But first, Section 3 describes our laboratory characterization of the noise for SunCET\u2019s particular detector model and our demonstration of this algorithm."
        },
        {
            "heading": "3. Laboratory Validation",
            "text": "In order to demonstrate that our SHDR algorithm works in practice, we ran a technology demonstration (Figure 2). Light from a 405 nm laser was passed through a neutral density filter to reduce its intensity, a spatial filter to minimize distortions, and finally a 25 \u03bcm diameter pinhole to produce an Airy diffraction pattern imaged onto the same model of detector (Teledyne e2v CIS115) and custom electronics intended for SunCET flight. Surrounding the bright Airy disk, each subsequent concentric Airy ring dramatically decreases in brightness (Figure 3), similar to the bright solar disk and the off-limb corona.\nWe optimized the image sequence parameters for the brightness profile of this particular input source. Long exposures show the rings best, but the bright disk saturates. Short exposures prevent saturation but the signal from the rings is lost in noise. Stitching these together in the manner described in Section 2, we obtain the composite image shown in the middle of Figure 3. The specific values of the configurable parameters were: tlong= 50 s, Nlong= 4, tshort= 3.2 s, and Nshort= 10.\nAdditionally, we measured the noise characteristics of this detector, verifying the specification sheet. We measured the peak read noise (5.1 electrons), which is in good agreement with the specification (5 electrons). We also took dark exposures at room temperature and with the detector at \u221210\u00b0C (the target flight temperature for SunCET) inside a dark thermal chamber, finding the expected dark noise of \u223c20 electrons pixel\u22121 s\u22121 at \u223c20\u00b0C and 0.4 electrons pixel\u22121 s\u22121 at the target flight temperature.\nBlooming is also a concern for the SHDR algorithm but is typically not detailed in detector specification sheets, so we measured it by increasing exposure time until the laser light saturated pixels and overflowed into adjacent pixels. We found no measurable overflow beyond the immediately adjacent pixels. In cases like SunCET that bin the detector image to achieve Nyquist sampling of the telescope image resolution, this means the already minor blooming is negligible. Many other sensors of this type (CMOS) have already flown and shown no issues with blooming (De Groof et al. 2008; Seaton et al. 2013a)\u2014for example, Project for On-Board Autonomy-2 (PROBA2; Santandrea et al. 2013)/Sun Watcher with Active Pixels and Image Processing (SWAP; Seaton et al. 2013b), and Solar Orbiter (M\u00fcller et al. 2013)/Extreme Ultraviolet Imager (Rochus et al. 2020).\nFinally, timing of the components in the imaging sequence is important for synchronization, e.g., between the end of the green integrations and the end of the first red integration in Figure 1. This means that the time to clear a row in preparation for the next integration should be short. As designed and expected, we measured the row sample/reset time to be 1.5 \u03bcs, much shorter than our shortest integration time of 35,000 \u03bcs. Therefore, no significant waiting time needs to be inserted to achieve synchronization throughout the imaging sequence."
        },
        {
            "heading": "4. Instrument Simulation with Solar Extreme Ultraviolet Target",
            "text": "We produced a detailed software instrument simulator to encapsulate the performance of each component of the instrument, including those verified in the lab. This tool allows us to generate synthetic images that realistically represent what flight data would look like. Figure 4 summarizes the inputs, simulation processes, and outputs; Table 1 quantifies crucial instrument parameters."
        },
        {
            "heading": "4.1. Inputs",
            "text": "Inputs include magnetohydrodynamic (MHD) and instrument ray-tracing simulations, component data sheet values, laboratory measurements, and relevant on-orbit performance of components. Three MHD simulations of CMEs with a variety of speeds were run on the NASA Pleiades supercomputer following the procedure in Jin et al. (2017), which uses the Alfv\u00e9n Wave Solar Model (van der Holst et al. 2014) within the Space Weather Modeling Framework (T\u00f3th et al. 2012). Section 3 describes the detector verifications we made and Mason et al. (2021) present the mirror coating measurements. Measurements of on-orbit pointing stability for a common commercially available attitude determination and control system for small satellites come from data internal to the team\nfor the Compact Spectral Irradiance Monitor (CSIM) and also from Mason et al. (2017) for the Miniature X-ray Solar Spectrometer (MinXSS; Mason et al. 2016). We analyzed the on-orbit PROBA2/SWAP data, identifying the peak particle noise flux in its imager, which unsurprisingly occurred during a spacecraft transit through the South Atlantic Anomaly. We also included many toggles in the simulator to enable/disable, e.g., this worst-case particle noise and worst-case dead pixels."
        },
        {
            "heading": "4.2. Simulation",
            "text": "The instrument simulation follows the well-established principles laid out in Photon Transfer (Janesick 2007). The boxes in the middle of Figure 4 are grouped by convenience, but the code essentially follows the photons from their source through the instrument until they are absorbed (or not) by the detector. Note that all sources of noise are handled independently of the \u201cpure\u201d source signal from the MHD simulation, allowing for the clean S/N calculations in Section 4.3.\nShot noise generally follows a Poisson distribution and it occurs at several points. The generation of photons at the source in this case is primarily due to thermal excitation of electrons in ions. At the opposite end of this chain, when a photon is absorbed by the CMOS detector it generates a Poisson-distributed random number of electrons with a mean equal to the quantum yield, which is itself wavelengthdependent (higher energy photons must generate more electrons on average). The quantum efficiency is the probability that the photon is absorbed at all, and clearly those that are not absorbed will not result in any electron shot noise, so they are dropped from the calculation accordingly. Finally,\nthermal vibrations in the detector itself release a number of electrons known as dark current or dark noise because it occurs even in the absence of incident light. This process is also random. We first generate a full-size image where each pixel is assigned a Gaussian random value, with a mean and standard deviation determined from our dark noise measurements in the lab. We apply a random value from the Poisson distribution to each pixel with the mean set to whatever value was already present in the pixel. We also include other sources of noise. We assume a larger number of dead and hot pixels than we have seen in similar detectors in flight in order to be conservative. Similarly, we use the worst-case particle noise observed to date from the PROBA2/SWAP mission, which has a CMOS similar to the one being studied here. We do, however, scale the particle noise rate to account for differences in detector size, integration time, and shielding. There are also losses that occur as photons pass through any telescope. In this case, we have several filters and mechanical support meshes supporting them that block out visible light while letting EUV photons through, but it is not a perfect gate: some fraction of EUV photons do get absorbed. Similarly, the mirrors in our telescope have a coating that tunes the bandpass within the EUV but each photon reflection is not perfectly efficient. We also convolved the point-spread function from the Zemax model with the input image. Note that for flight, the smearing effects of the point-spread function will be mitigated using well-established EUV imager deconvolution methods (e.g., Seaton et al. 2013a; Schwartz et al. 2015; Gonz\u00e1lez et al. 2016) but those enhancements are not applied in these simulations, meaning our results are conservative in this respect. Additionally, the telescope must be mounted on a pointing platform, which will be imperfect. Our primary interest is small satellite flight so we focused on such platforms. In this case, pointing accuracy was assumed not to be an issue given the performance of commercially available systems. Stability, however, is important to simulate because it is tightly coupled with integration times, which are often a free parameter in design space to be explored and optimized. Therefore, we converted the 1\u03c3 rms 3U CubeSat stability adapted from Mason et al. (2017)\u2014verified to be consistent with results from the 6U CSIM\u2014to the amount of pixel shift during and across exposures. Finally, the detector\u2019s readout electronics and processing must be simulated. Gain is applied to amplify the signal, the full well of the sensor is accounted for as a high limit, the number of bits being read into for each row is accounted for as a high limit, pixel binning is applied, and the SHDR/imagestack median algorithms are applied. While every input and simulation component discussed here is tunable, the SHDR/ median algorithm is novel and in Section 4.3 we discuss how the variables that define its function impact the S/N."
        },
        {
            "heading": "4.3. Signal-to-noise Ratio",
            "text": "By changing the exposure values of tlong, Nlong, tshort, and Nshort (see Section 2) in the simulator, we can optimize against different noise sources. Longer exposures increase signal but are more susceptible to jitter, particle spikes, and dark noise, while read and digitization noise can play a larger role in shorter exposures. Dark noise can be largely removed (up to the\nlevel of shot noise) by subtraction, and particle spikes can be mostly screened by taking the median across the N exposures (Section 2). We explored the parameter space to optimize S/N of our model CMEs, establishing the baseline values of tlong= 15 s, Nlong= 4, tshort= 0.035 s, and Nshort= 10.\nFigure 5 shows the cases with the lowest and highest S/N from the multiple CME simulations with S/N contours overlaid on the left and on the right a horizontal trace of S/N through the middle of the 2011 CME. We performed this analysis through the entire simulation time span, from initiation of the CME to it reaching the edge of the FOV, and found S/N 40 in all cases. Table 2 shows the impact on S/N when varying different input parameters. The solution space is quite large, as evidenced by the remaining margin between these configurations and the requirements. Five of these parameters, in addition to the regional mask, are even configurable in flight, meaning that there remains flexibility to meet all requirements even if on-orbit performance is degraded for any reason."
        },
        {
            "heading": "5. Discussion",
            "text": "The SHDR method avoids the problems of traditional HDR for many science applications. SHDR does not require the employment of complex and expensive multiple sensors or beam splitters and does not sacrifice temporal dynamics to do it. The number of sensors available that have independent row readout capabilities is currently relatively small but there are several commercially available today, including the one we used in our lab testing, which is sensitive to both visible and ultraviolet wavelengths. Our code for the simulation presented here is also freely available for the community to use and modify for their own SHDR-parameter optimization (Mason & Seaton 2021). The ultimate extrapolation of this work would be a per-pixel readout to enable complete control without the need for the additional linear-to-nonlinear steps required here; such detectors are starting to become commercially available. SHDR can be applied as a solution for instruments in heliophysics, astrophysics, and planetary and Earth science. We presented a case of solar spatial observation to demonstrate the technique, in particular highlighting how the linear rowbased readout could be adapted into an effectively nonlinear readout. A direct linear readout where each row is still controlled independently would be especially effective for spectrographs that do not introduce curvature, e.g., first-order spectra: a group of rows covering each spectral line could be integrated as long as needed to achieve good S/N. Many of the spectrographic modes on board the Hubble Space Telescope produce this type of first-order spectra. Future missions targeting sources with large brightness variations should include the SHDR method in their design trade studies as a solution to either increase observing efficiency or obtain temporal dynamics while maintaining low complexity in the system.\nThe authors thank NASA for supporting this work as part of the SunCET Phase A study under grant 80NSSC20K1750. We also thank the entire SunCET team for helping to build the mission\u2019s science case that justified this work. Software: AASTeX (AAS Journals Team & Hendrickson 2018), SunCET IDL code (Mason & Seaton 2021), IDL, SolarSoft (Freeland & Handy 2012), IPython (Perez & Granger 2007), matplotlib (Hunter 2007), numpy (Oliphant 2006), pandas (McKinney 2010), scipy (Jones et al. 2001).\nORCID iDs\nJames Paul Mason https://orcid.org/0000-0002-3783-5509 Daniel B. Seaton https://orcid.org/0000-0002-0494-2025 Andrew R. Jones https://orcid.org/0000-0001-5533-5498\nFigure 5. Left: comparison of S/N contours overlaid on synthetic SunCET images for the two CME simulations that resulted in the lowest (top) and highest (bottom) S/Ns. Both cases reach or exceed the International Organization for Standardization (ISO) 12232-defined \u201cexcellent\u201d S/N 40. Right: a trace through the 2011 CME composite image indicated by the dashed green line.\nTable 2 Various Configurations and Resultant S/N for the 2011 CME\nNlong a tlong a Nshort a tshort a Resultant Pixels/Bin* / S/N of CME S/N of Disk Cadence Spatial Resolution at 3.5  N (mean)\nRequirement L 23 s L 23 s 192 s 6 \u00d7 6/ 30\u2033 10 10 Baseline 4 15 s 10 0.035 s 60 s 2 \u00d7 2/9.6\u2033 331 804 Example 2 4 5 s 10 0.1 s 20 s 2 \u00d7 2/9.6\u2033 186 1370 Example 3 4 15 s 10 0.035 s 60 s 4 \u00d7 4/19.2\u2033 598 812 Example 4 4 5 s 10 0.1 s 20 s 4 \u00d7 4/19.2\u2033 356 2874\nNote. a Indicates parameters that are configurable in flight.\nMeng Jin https://orcid.org/0000-0002-9672-3873 Phillip C. Chamberlin https://orcid.org/0000-00034372-7405 Alan Sims https://orcid.org/0000-0002-4546-2394 Thomas N. Woods https://orcid.org/0000-0002-2308-6797"
        }
    ],
    "title": "Simultaneous High Dynamic Range Algorithm, Testing, and Instrument Simulation",
    "year": 2022
}
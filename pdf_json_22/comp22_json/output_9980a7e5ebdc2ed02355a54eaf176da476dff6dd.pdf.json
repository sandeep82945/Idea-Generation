{
    "abstractText": "This article proposes a general method to model and simulate the process of magnetic field mapping; aim of our work is the combination of the effect of the bench position uncertainty with the magnetic measurements\u2019 uncertainty. The method is based on the study of positioner kinematics using a multi-body system approach. The geometrical errors of the manipulator, including the manufacturing tolerances and the assembling nonidealities are included in the model using the homogeneous transformation matrix (HTM), to numerically estimate the end-effector positioning uncertainty Up. The positioning uncertainty is then combined with the magnetic measurement uncertainty using the magnetic field gradient as a sensitivity coefficient; in presence of strong field nonlinearities, the combination can be performed using Monte Carlo (MC) simulations in order to estimate how Up propagates to the magnetic measurement uncertainty U f at different positions. The method has been validated in the specific case of the compact field mapper (CFM), a bench featuring a Cartesian robot and a triaxial Hall sensor used to measure flux density maps in the accessible region of interest of the magnets of the Swiss Light Source, with an uncertainty below 0.5 %. The method allowed us to define, during the design phase, the characteristics of the positioning system (i.e., the mechanical positioning uncertainty Up) in order to obtain the desired magnetic measurement uncertainty U f . Simulations and experiments in the case of a reference quadrupole are presented and discussed.",
    "authors": [
        {
            "affiliations": [],
            "name": "Paola La Marca"
        },
        {
            "affiliations": [],
            "name": "Ciro Calzolaio"
        }
    ],
    "id": "SP:5cce5d8fecf4f3e1ea3084c8972e15c67489b785",
    "references": [
        {
            "authors": [
                "L. Bottura",
                "K.N. Henrichsen"
            ],
            "title": "Field measurements",
            "venue": "CERN, Geneva, Switzerland, Tech. Rep. CERN-LHC-2002-020-MTA, 2002.",
            "year": 2002
        },
        {
            "authors": [
                "C.-K. Yang"
            ],
            "title": "A Hall probe calibration system at low temperature for the TPS cryogenic permanent magnet undulator",
            "venue": "IEEE Trans. Appl. Supercond., vol. 28, no. 3, pp. 1\u20135, Apr. 2018.",
            "year": 2018
        },
        {
            "authors": [
                "J. Zhang",
                "Y. Zhu",
                "M. Qian",
                "W. Zhang"
            ],
            "title": "High-precision Hall sensor array magnetic field measurement system",
            "venue": "Proc. AIP Conf., 2019, Art. no. 030020.",
            "year": 2019
        },
        {
            "authors": [
                "J. Cassar",
                "A. Sammut",
                "N. Sammut",
                "M. Calvi",
                "S. Spasic",
                "D.P. Renella"
            ],
            "title": "Performance analysis of a reduced form-factor high accuracy three-axis teslameter",
            "venue": "Electronics, vol. 8, no. 11, p. 1230, Oct. 2019.",
            "year": 2019
        },
        {
            "authors": [
                "D. Beltr\u00e1n",
                "J. Bordas",
                "J. Campmany",
                "A. Molins",
                "J.A. Perlas",
                "M. Traveria"
            ],
            "title": "An instrument for precision magnetic measurements of large magnetic structures",
            "venue": "Nucl. Instrum. Methods Phys. Res. A, Accel., Spectrometers, Detectors Associated Equip., vol. 459, nos. 1\u20132, pp. 285\u2013294, Feb. 2001.",
            "year": 2001
        },
        {
            "authors": [
                "G. Tosin",
                "J.F. Citadini",
                "E. Conforti"
            ],
            "title": "Hall-probe bench for insertiondevice characterization at LNLS",
            "venue": "IEEE Trans. Instrum. Meas., vol. 56, no. 6, pp. 2725\u20132730, Dec. 2007.",
            "year": 2007
        },
        {
            "authors": [
                "G. Moschioni",
                "B. Saggin",
                "M. Tarabini",
                "J. Hald",
                "J. Morkholt"
            ],
            "title": "Use of design of experiments and Monte Carlo method for instruments optimal design",
            "venue": "Measurement, vol. 46, no. 2, pp. 976\u2013984, Feb. 2013.",
            "year": 2013
        },
        {
            "authors": [
                "H. Schwenke",
                "W. Knapp",
                "H. Haitjema",
                "A. Weckenmann",
                "R. Schmitt",
                "F. Delbressine"
            ],
            "title": "Geometric error measurement and compensation of machines\u2014An update",
            "venue": "CIRP Ann., vol. 57, no. 2, pp. 660\u2013675, 2008.",
            "year": 2008
        },
        {
            "authors": [
                "J. Santolaria",
                "A. Brau",
                "J. Vel\u00e1zquez",
                "J. Aguilar"
            ],
            "title": "A self-centering active probing technique for kinematic parameter identification and verification of articulated arm coordinate measuring machines",
            "venue": "Meas. Sci. Technol., vol. 21, no. 5, 2010, Art. no. 055101.",
            "year": 2010
        },
        {
            "authors": [
                "S. Xiang",
                "Y. Altintas"
            ],
            "title": "Modeling and compensation of volumetric errors for five-axis machine tools",
            "venue": "Int. J. Mach. Tools Manuf., vol. 101, pp. 65\u201378, Feb. 2016. [Online]. Available: http://www.sciencedirect.com/science/article/pii/S0890695515300870",
            "year": 2016
        },
        {
            "authors": [
                "G. Fu",
                "J. Fu",
                "Y. Xu",
                "Z. Chen",
                "J. Lai"
            ],
            "title": "Accuracy enhancement of five-axis machine tool based on differential motion matrix: Geometric error modeling, identification and compensation",
            "venue": "Int. J. Mach. Tools Manuf., vol. 89, pp. 170\u2013181, Feb. 2015. [Online]. Available: http://www.sciencedirect.com/science/article/pii/S0890695514400191",
            "year": 2015
        },
        {
            "authors": [
                "G. Fu",
                "J. Fu",
                "Y. Xu",
                "Z. Chen"
            ],
            "title": "Product of exponential model for geometric error integration of multi-axis machine tools",
            "venue": "Int. J. Adv. Manuf. Technol., vol. 71, nos. 9\u201312, pp. 1653\u20131667, Apr. 2014.",
            "year": 2014
        },
        {
            "authors": [
                "G. Zhong",
                "C. Wang",
                "S. Yang",
                "E. Zheng",
                "Y. Ge"
            ],
            "title": "Position geometric error modeling, identification and compensation for large 5-axis machining center prototype",
            "venue": "Int. J. Mach. Tools Manuf., vol. 89, pp. 142\u2013150, Feb. 2015. [Online]. Available: http://www.sciencedirect.com/science/article/pii/S0890695514400075",
            "year": 2015
        },
        {
            "authors": [
                "G. Gatti",
                "G. Danieli"
            ],
            "title": "A practical approach to compensate for geometric errors in measuring arms: Application to a six-degree-offreedom kinematic structure",
            "venue": "Meas. Sci. Technol., vol. 19, no. 1, Jan. 2008, Art. no. 015107.",
            "year": 2008
        },
        {
            "authors": [
                "H. Wu",
                "H. Zheng",
                "X. Li",
                "W. Wang",
                "X. Xiang",
                "X. Meng"
            ],
            "title": "A geometric accuracy analysis and tolerance robust design approach for a vertical machining center based on the reliability theory",
            "venue": "Measurement, vol. 161, Sep. 2020, Art. no. 107809. [Online]. Available: http://www.sciencedirect.com/science/article/pii/S026322412030347X",
            "year": 2020
        },
        {
            "authors": [
                "M.A. Khan",
                "J. Sun",
                "B. Li",
                "A. Przybysz",
                "J. Kosel"
            ],
            "title": "Magnetic sensors\u2014A review and recent technologies",
            "venue": "Eng. Res. Exp., vol. 3, no. 2, Jun. 2021, Art. no. 022005.",
            "year": 2021
        },
        {
            "authors": [
                "S. Lozanova",
                "A. Ivanov",
                "C. Roumenin"
            ],
            "title": "A novel three-axis Hall magnetic sensor",
            "venue": "Proc. Eng., vol. 25, pp. 539\u2013542, Jan. 2011.",
            "year": 2011
        },
        {
            "authors": [
                "P. Beran",
                "M. Kl\u00f6hn",
                "H.-P. Hohe"
            ],
            "title": "Measurement characteristics of different integrated three-dimensional magnetic field sensors",
            "venue": "IEEE Magn. Lett., vol. 10, pp. 1\u20135, 2019.",
            "year": 2019
        },
        {
            "authors": [
                "R. Popovic",
                "P. Drljaca",
                "C. Schott"
            ],
            "title": "Bridging the gap between AMR, GMR, and Hall magnetic sensors",
            "venue": "Proc. 23rd Int. Conf. Microelectron., vol. 1, 2002, pp. 55\u201358.",
            "year": 2002
        },
        {
            "authors": [
                "A. Streun"
            ],
            "title": "Proposed upgrade of the SLS storage ring",
            "venue": "Proc. 7th Int. Part. Accel. Conf. (IPAC), Busan, South Korea, May 2016, pp. 2922\u20132925.",
            "year": 2016
        },
        {
            "authors": [
                "C. Calzolaio",
                "S. Sanfilippo",
                "S. Sidorov",
                "A. Anghel",
                "A. Streun"
            ],
            "title": "Design of a superconducting longitudinal gradient bend magnet for the SLS upgrade",
            "venue": "IEEE Trans. Appl. Supercond., vol. 27, no. 4, pp. 1\u20135, Jun. 2017.",
            "year": 2017
        },
        {
            "authors": [
                "C. Calzolaio"
            ],
            "title": "Longitudinal gradient bend magnets for the upgrade of the Swiss light source storage ring",
            "venue": "IEEE Trans. Appl. Supercond., vol. 30, no. 4, pp. 1\u20135, Jun. 2020.",
            "year": 2020
        },
        {
            "authors": [
                "C. Zoller",
                "C. Calzolaio",
                "A. Gabard",
                "P. La Marca"
            ],
            "title": "Test stand for the characterization of superconducting magnets cooled with cryocoolers",
            "venue": "Proc. IOP Conf. Ser., Mater. Sci. Eng. Oxford, U.K., Sep. 2018, Art. no. 012097.",
            "year": 2018
        },
        {
            "authors": [
                "L. Walckiers"
            ],
            "title": "Magnetic measurement with coils and wires",
            "venue": "2011, arXiv:1104.3784. [Online]. Available: https://arxiv.org/abs/1104.3784",
            "year": 2011
        },
        {
            "authors": [
                "A. Wolski"
            ],
            "title": "Maxwell\u2019s equations for magnets",
            "venue": "2011, arXiv:1103.0713. [Online]. Available: https://arxiv.org/abs/1103.0713",
            "year": 2011
        },
        {
            "authors": [
                "S. Ag"
            ],
            "title": "3-Axis low-Noise Magnetic Field Transducer",
            "year": 2015
        }
    ],
    "sections": [
        {
            "text": "Index Terms\u2014 Accelerator magnets, measurement uncertainty, particle accelerators, position measurements.\nNOMENCLATURE x, y, z [mm] Positioner coordinates. E p [\u03bcm] Positioning error. Up [m\u03bcm] Positioning uncertainty. Bi [T] Magnetic flux density. Bn, An [T] Normal and skew multipoles. E f [Magnetic units [28]] Magnetic measurement error. U f [Magnetic units] Magnetic measurement uncertainty. SP [1] Magnetic sensor instrumental uncertainty. SH P [1] Hall probe instrumental\nuncertainty.\nManuscript received 28 June 2022; revised 19 September 2022; accepted 21 September 2022. Date of publication 5 October 2022; date of current version 25 October 2022. The Associate Editor coordinating the review process was Jagadeesh Varadarajan Kumar. (Corresponding author: Marco Tarabini.)\nPaola La Marca and Marco Tarabini are with the Department of Mechanical Engineering, Politecnico di Milano, 20156 Milan, Italy (e-mail: marco.tarabini@polimi.it).\nPhilippe Lerch , Alexander Gabard, Giuseppe Montenero, and Ciro Calzolaio are with the Department of Magnet Design and Measurements, Paul Scherrer Institute, 5232 W\u00fcrenlingen, Switzerland.\nDigital Object Identifier 10.1109/TIM.2022.3212530\nI. INTRODUCTION\nTHE quality of nonhomogeneous field profiles generatedby particle accelerator magnets can be assessed with point-like measurements in the region of interest [1]. Miniaturized 3-D magnetic sensors are supported by lightweight mechanical structures and afterward moved to obtain 3-D maps of the magnetic field. The relative contributions of the magnetic sensor and of the positioning system to the overall measurement uncertainty have never been studied in the scientific literature.\nTo date, the effects of the mechanical performances of the scanning system on the magnetic measurement are often neglected and not fully investigated. The commonly adopted approach consists of the initial selection of a 3-D magnetic sensor with the desired accuracy, followed by the design of a scanning robot with a positioning accuracy in the order of 1\u03bcm [2], [3], [4]. The positioning errors are then experimentally characterized during the commissioning procedure, for example, [5], [6]. In the specific case of particle accelerator magnets, the measurement bench consists of miniaturized 3-D probes supported by thin and lightweight mechanical structures, designed to keep the motors and position sensors outside the magnetic field. The deflection of the probe holder due to the gravity, the probe vibration under external stimuli, and the positioning accuracy can be minimized only by designing bulky mechanical structures. In addition, the small magnet aperture requires selecting miniaturized 3-D Hall probes, whose uncertainty is larger than the one of larger magnetic sensors.\nIn an uncertainty-driven design, the starting point is the definition of the desired magnetic field uncertainty U f . By knowing the mathematical model which describes how U f depends on the magnetic sensor uncertainty Us and the positioning system uncertainty Up it is possible to determine the magnetic and positioning uncertainties allowing to reach the desired performances. Measurement uncertainties can be determined starting using the ISO GUM [7], [8] or with more complex numerical methods during the design phase [9].\nThe uncertainty of the positioning system has been largely studied in the case of machining centers, in order to quantify the effects of geometric errors, thermal drifts, and cutting forces during manufacturing [10]. The common approach in this field is the development of a model describing the bias error components and the definition of a bias error compensation strategy [11]. The kinematics model can be built\nThis work is licensed under a Creative Commons Attribution 4.0 License. For more information, see https://creativecommons.org/licenses/by/4.0/\nusing different strategies: Xiang and Altintas [12] proposed the use of the screw theory to model a five-axis machine and simplify the inverse kinematics equation; Fu et al. [13] used the differential motion matrix to obtain the influences of each axis on the tool positioning performances; exponential models are used by Fu et al. [14] to avoid singularity problems in complex robot chains. Finally, a general method consists in modeling the machine as a multibody system (MBS) composed of a series of rigid bodies connected by prismatic or rotational joints [15], [16]. Then, to describe the location of the end-effector in a usable frame, a homogeneous transformation matrix (HTM) is defined between each adjacent joint pair taking into account their relative position and orientation. Once the bench kinematic model is obtained, it can be used to simulate and forecast the final volumetric error [17].\nMagnetic sensors are based on the transduction of different physical phenomena, for instance, the electromagnetic induction, Hall effect, tunnel magnetoresistance (TMR), giant magnetoresistance (GMR), anisotropic magnetoresistance (AMR), and giant magnetoimpedance (GMI), [18]. The knowledge of the three Cartesian components of the magnetic field at the same time with a single miniaturized transducer is a great challenge for the semiconductor industry, [19], [20], [21]. In literature, detection techniques such as AMR or GMI are preferred for high-frequency magnetic fields, due to their larger bandwidth, and for low magnetic fields (less than 1 mT). For static fields, Hall probes are preferred since they show better resolution (especially for fields above 1 mT) but shorter bandwidth. Finally, Hall probes are a good compromise between uncertainty and cost compared to the other technologies mentioned above, which are generally more expensive.\nAs already mentioned, to date, magnetic and positioning uncertainties have always been considered independently. This article proposes a general method to identify and quantify the impact of the mechanical system performances on the magnetic field measurement uncertainty by coupling the bench kinematic model with the magnetic field one and performing Monte Carlo (MC) simulations to propagate positioning error distributions to U f . The scope of this analysis is the development of a comprehensive measurement model that allows to forecast final measurement uncertainty, including the mechanical structure in early considerations about the system behavior and using this study to guide the design choices. With this approach, it is possible to optimize the final positioning uncertainty to concur to the error budget with a nondominant weight with respect to the magnetic sensor contribution, thus optimizing the cost of the structure without investing in precise components that are not entailing uncertainty benefits.\nThe method has been developed for the upgrade of the storage ring of the Swiss Light Source (SLS-2) at the Paul Scherrer Institute (PSI), which requires the characterization of 800 magnets before their installation. The SLS-2 upgrade aims at the reduction of the beam emittance from 5000 pm to 137 pm keeping the same storage ring foot-print (i.e., same building) and undulators locations [22]. With these requirements, a new set of high-gradient magnets based on permanent blocks, normal-conducting coils, and super-conducting ones\nis in the design phase. Among them, a superconducting dipole providing a longitudinal gradient has been designed, reaching a peak field of 6 T [23], [24]. The performances of these magnets have to be assessed before installation in the machine. Thus, a new magnet survey stand is currently in use for the thermal, mechanical and magnetic characterization of superconducting magnets in operating conditions [25]. Due to the need of inspecting nonhomogeneous field profiles, it is necessary to measure maps of all three components of the magnetic induction vector with a relative uncertainty U f of 0.1%\u20130.5% of the maximum generated field, corresponding to 10\u201350 units (1 unit being 10\u22124 of reference field) [26]."
        },
        {
            "heading": "II. PROPOSED METHOD",
            "text": "The first step necessary to estimate the mapping uncertainty is the definition of a measurement model; for this purpose, the uncertainty sources affecting the final magnetic measurement process performances are analyzed. As represented schematically in Fig. 1, two main elements are present: magnetic sensor performances Us and positioning system ones, identified as Up. The first contribution affects directly the final process yield in the form of nonlinearities of the sensor, the presence of noise on the voltage output or noncompensated bias errors due to disturbances. On the other hand, the positioning uncertainty weight depends on the local field gradient, thus it is necessary to consider the field distribution to know the effect of Up on U f .\nThe uncertainty analysis is split into two parts: first, only the mechanical system performances are analyzed and modeled, then they are combined with the magnetic field distribution in the region to be scanned."
        },
        {
            "heading": "A. Mechanical Effects",
            "text": "Six degrees of freedom are necessary to describe the position of a rigid body in space. Considering a general linear axis, when the carriage moves, its position will be affected by three linear errors and three angular ones. As shown in Fig. 2, for Z -axis, \u03b4z(z) describes the positioning error along the motion direction, \u03b4x(z) and \u03b4y(z) are the straightness errors along the other two directions, while \u03b5z(z), \u03b5y(z), and \u03b5x(z) are, respectively, the roll, yaw, and pitch angular errors. Considering a three-axis machine, each axis is described by six errors and, additionally, three more parameters are required to include the orthogonality error between each axis pair. Thus, 21 geometric parameters are required to model the machine. Considering a generic point \u2212\u2192 P1 in space, which coordinates are expressed in the local frame 1, it can be referred to the global\nframe knowing the relative orientation and location of the two reference systems. This transformation can be formulated as in the following:\n\u2212\u2192 P0 = \u2212\u2192T0,1 + R0,1\u2212\u2192P1 (1)\nwhere \u2212\u2192 P1 and \u2212\u2192 P0 are, respectively, the expression of point\u2212\u2192\nP = [x, y, z] in local and global frames, \u2212\u2192T0,1 is the location vector containing the coordinates of the local frame origin with respect to the global one and R0,1 is the 3-D rotation matrix to identify their relative orientation. This transformation can be put in matrix form, as in (2), to obtain the HTM of the first pair, named M0,1\nM0,1 = \u23a1 \u23a3 R0,1 T0,10 0 0 1\n[\u22124ex]\n\u23a4 \u23a6. (2)\nEquation (1) can then be rearranged in a more compact form as\n\u2212\u2192 P0 = M0,1\u2212\u2192P1 (3)\nwhere \u2212\u2192 Pi = [x, y, z, 1] are the homogeneous coordinates of the point. For the sake of clarity, the 3-D rotation matrix is obtained by successive multiplication of zyx rotations of \u03c8 , \u03b8 , and \u03c6 angles, resulting in the following matrix (where c and s are short for cos and sin) (4), as shown at the bottom of the next page.\nIn the case of more complex kinematic chains, as in the case of an MBS shown in Fig. 3, the transformation from the global reference system to the nth-frame can be easily achieved by multiplying in order the consecutive HTMs\nM0,n = M0,1 M1,2, . . . ,Mn\u22121,n . (5) For each body, it is possible to write the HTM according to (2), knowing the relative locations and orientations of each\npair. By multiplying the HTMs following the kinematic chain order, it is possible to obtain the description of the end-effector position in space with respect to the selected global frame. In the case of parallel kinematics, the same formalism can be applied by analyzing each closed kinematic loop and adding to (5) the required constraints on links dimensions.\nUsing these formulations, it is possible to calculate the end-effector location in all the points of the measurement volume. This error is formulated as the difference between the target position \u2212\u2192 Pt and the actual reached one \u2212\u2192 Pr , according to the following equation for each axis:\nE p = \u2225\u2225\u2225\u2212\u2192Pt \u2212 \u2212\u2192Pr \u2225\u2225\u2225. (6) The actual measurement point \u2212\u2192 Pr can be obtained using the complete HTM Mn,0 for each point \u2212\u2192xi reached by the robot end-effector in the working volume\nE p,i = \u2225\u2225Mn,0(\u2212\u2192xi,0) \u00b7 \u2212\u2192xi,0 \u2212 \u2212\u2192xi,n\u2225\u2225. (7)\nThe HTM Mn,0 is composed of position independent errors, such as the linear and angular geometric errors shown in Fig. 2, and position-dependent ones, mainly the nonperfect orthogonality among axis which leads to deviations linearly dependent on the travel length. For this reason, Mn,0 in (7) is a function of the target point coordinates. Furthermore, it is possible to indicate with M\u2217n,0 the theoretical transformation from frame n to the global reference 0; this matrix contains only the rigid offsets between the two frames, thus no error is taken into account. Equation (7) can be rewritten in global coordinates as\nE p,i = \u2225\u2225Mn,0(\u2212\u2192xi,0) \u00b7 \u2212\u2192xi,0 \u2212 M\u2217n,0\u2212\u2192xi,0\u2225\u2225 (8)\nwhere \u2212\u2192xi,0 = M\u22170,n\u2212\u2192xi,n . In addition to the geometrical errors, vibrations play an important role in the definition of the positioning uncertainty of the end-effector. The oscillation amplitude \u2202\u2212\u2192xi is a time-dependent function and it will depend on the stimulated mode and on the system dynamic characteristics. Finally, errors in the position reading can be caused by the motion controller: in case the reading is time-delayed with respect to the real state of the system, an additional positioning error is present. This error is directly proportional to the scanning speed and it can be seen as the space traveled by the system while waiting for the position reading. Assuming constant velocity, \u2212\u2192x can be computed as\n\u2212\u2192xi = vs \u00b7 \u03c4 (9) where vs is the system speed and \u03c4 the reading delay in time and it can be included in 7 together with the oscillation error as\nE p,i = \u2225\u2225Mn,0(\u2212\u2192xi,0) \u00b7 (\u2212\u2192xi,0 + \u2202\u2212\u2192xi,0 + \u2212\u2192xi,0) \u2212 M\u2217n,0\u2212\u2192xi,0\u2225\u2225.\n(10)\nEquation (10) represents the positioning error model that includes the kinematic, dynamic, and motion controller sources."
        },
        {
            "heading": "B. Magnetic Effects",
            "text": "A model of the magnetic field in the robot working volume has been developed to investigate the mechanical positioning effect onto magnetic field measurement error. In domains free of currents or magnetized materials, as the inside of the magnet aperture and sufficiently away from the coil ends, the field can be represented with its 2-D multipole expansion according to the following equation in complex form [27], [28]: B(w) = B(x, y) = By + i Bx = N\u2211\nn=1 (Bn + i An)\n( x + iy\nRRef\n)n\u22121\n(11)\nwhere w = x + iy, Bx , and By are the induction vector Cartesian components, Bn and An are the normal and skew multipoles, Rref is the reference radius at which the harmonics are evaluated (or measured) and N is the number of discrete components considered in the field representation. The expansion coefficients, the field multipoles, represent the harmonic components of the field which contribute to the field shape and they can be normal or skew, meaning real or imaginary contribution for each n.\nSensor performances (regardless of the sensing technology) are included in the model using the factor SP accounting for the noise of the transducer and all the bias errors not compensated and included in the uncertainty budget. In the case of a generic probe, SP can be computed by combining, according to the ISO GUM indications, the random error components and the systematic ones that cannot be compensated.\nConcerning the spatial contribution in (11), it is then affected by the robot positioning errors, thus next equation shows the full coupled measurement model\nB(w) = SP N\u2211\nn=1 (Bn + i An)\n( MP,0(w) \u00b7 w\nRRef\n)n\u22121 (12)\nwhere MP,0(w) \u00b7 w is the actual probe position. The spatial error contributions are explicitly indicated in B(w) = SP N\u2211\nn=1 (Bn + i An)\n( MP,0(w) \u00b7 (w + \u2202w + w)\nRRef\n)n\u22121\n(13)\nwhere w are the nominal sampling points, \u2202w is the vibration effect and w is the time delay induced reading error. These coordinates are referred to as the global reference system as described in Section II-A. The magnetic measurement error is formulated as deviation, in units, of the measured field component from the nominal one obtained from the multipoles expansion in (11)\nE f,i = Bi,nom \u2212 Bi,meas Bi,nom\n(14)\nwhere Bi,nom is the nominal field component in the target point and Bi,meas is the measured field component in the actual probing location."
        },
        {
            "heading": "C. Coupled Model",
            "text": "Following the formalism in [7], a measurand \u03b7 can be estimated by the central value of the distribution that can be attributed to it according to the measurement equation\n\u03b7 = g(\u03be1, \u03be1, . . . , \u03bek) (15) where \u03bek are the input quantities influencing the output \u03b7 value. The function g defines the relationship between inputs and output and it is used to propagate the input quantities probability density functions to the measurand, with the final aim to obtain the standard uncertainty of \u03b7. The law of propagation of uncertainty is applied to outputs that are characterized by a Gaussian or t-distribution, for which linear dependence exists between the influence quantities and the measurand. Even in cases where the g function is linearized (i.e., by means of Taylor series approximation), it is important that the central limit theorem can be applied otherwise the measurement uncertainty defined confidence intervals are not representative. The supplement 1 of the ISO GUM, [8], suggests the usage of the MC method to overcome the limitations imposed by the law of uncertainty propagation: with this technique the probability distributions of the influence quantities are combined by numerical simulations generating random variables according to specified distributions. By random sampling the PDFs and knowing g, it is possible to obtain numerically the measurand PDF; normally, to have sufficient samples to get a valid estimate and standard deviation for \u03b7, the simulation requires more than 105 runs. The MC method can be used to forecast the uncertainty of the magnetic scanning system using (7): according to the indications in [8], a PDF is assigned to each input quantity to simulate by high-rate sampling the achieved end-effector position PDF and compare it with nominal values. Input quantities for the kinematic model are the spatial coordinates and the geometrical errors of each body composing the motion chain; their PDFs are combined to get the estimate of the positioning error and its standard uncertainty. Considering the coupled magnetic-mechanical model built in the previous section and represented in (12), the measurand B is depending on the following influence quantities: Hall probe characteristic factor, spatial coordinates, geometrical errors effect through the kinematic chain, bench dynamics and measurement equipment. From this result and knowing the nominal field, it is possible to obtain the estimate and the standard uncertainty of the measurement error described in 14."
        },
        {
            "heading": "III. CASE STUDY",
            "text": "The proposed method for the identification of the combined uncertainty requires the knowledge of the magnetic field to\nRn\u22121,n = \u23a1 \u23a3c(\u03c8)c(\u03b8) c(\u03c8)s(\u03c6)s(\u03b8)\u2212 c(\u03c6)s(\u03c8) s(\u03c6)s(\u03c8)+ c(\u03c6)c(\u03c8)s(\u03b8)c(\u03b8)s(\u03c8) c(\u03c6)c(\u03c8)+ s(\u03c6)s(\u03c8)s(\u03b8) c(\u03c6)s(\u03c8)s(\u03b8)\u2212 c(\u03c8)s(\u03c6)\n\u2212s(\u03b8) c(\u03b8)s(\u03c6) c(\u03c6)c(\u03b8)\n\u23a4 \u23a6 (4)\nbe scanned; for current purposes, FEM models of the SLS-2 magnet apertures have been developed. FEM results consist of data sets comprising the mesh nodes coordinates x, y, z and the corresponding field components Bx, By, Bz . The nodes\u2019 coordinates xi,nom have been perturbed with a Gaussian distribution N(0,Up) with zero mean and uncertainty Up to simulate the probe positioning uncertainty\nxi,meas = xi,nom + N ( 0,Up ) . (16)\nIn this notation, xi is a generic coordinate x , y or z, in the measurement or the nominal sets according to the subscripts meas and nom. The measured magnetic field is then interpolated at the position xi,meas, and its difference from the magnetic field at the position xi,nom is considered as non-compensated bias error to be added to the uncertainty budget. Simulations were run for different Up, in order to obtain the maximum uncertainty allowing to respect the uncertainty budget. Up has been varied between 0 and 50\u03bcm with a step size of 10\u03bcm; results of simulations are shown in Fig. 4, that represents the extended uncertainty (with 95% confidence interval) in the magnet longitudinal plane, where the field exhibits the strongest gradient.\nPositioning uncertainties of 20 and 50\u03bcm allow achieving magnetic measurement uncertainties U f of 10 and 25 units, respectively. The final uncertainty will be determined as a combination with the uncertainty of the magnetic sensor, discussed in the next paragraphs.\nThe further step was the design of the scanning system [hereinafter referred to as compact field mapper (CFM)]. The selected geometry (Fig. 5) consists of a three-axis Cartesian robot based on three stacked linear stages; the magnetic sensor is mounted on a carbon fiber arm in correspondence of the robot end-effector.\n1) Motion System: The motion of the bench end-effector can be analyzed considering it as the assembly of three rigid bodies (numbered as 1 \u2192 Z -axis, 2 \u2192 X-axis, 3 \u2192 Y -axis, in Fig. 6), on which local frames are placed, and using a global frame placed on the bench foundation (identified as 0 in\nFig. 6). The coordinate transformations from one local frame to the other can be expressed by means of HTM multiplication so that also mechanical errors (linear and angular) can be included. X and Y axis are commercial high-precision stages (Newport M-ILS150CC) while the Z -axis has been opportunely designed to cover a stroke of 800 mm. The assembly procedure has been step by step verified with the Leica Laser Tracker (LT): special attention is focused on the Z -axis rails mounting to verify their co-planarity (function on the plate grooves flatness specifications) and their parallelism (function of grooves sides orthogonality). Afterward, X stage is mounted on Z -slide and, finally, Y -axis is stacked on X one. Their mutual orthogonality is checked and adjusted iteratively thanks to the optical measurements.\n2) Magnetic Sensor: The selected sensor is a 3-axial Hall probe, whose performances allow accomplishing the design requirement. The sensor characteristics are summarized in Table I.\n3) Control Software: The stages are driven by Newport XPS-D motion controller for which a LabVIEW software is developed and its interface is shown in Fig. 7; the user can specify the scanning settings in terms of number of points along each axis, setup the communication parameters with the controller and the Hall probe acquisition device and define offsets to the display the results in magnet frame. The control and acquisition software has a queued message handler (QMH) architecture to simultaneously execute different threads exchanging data and commands with the XPS and, in parallel, to acquire and log the voltages from the Hall probe\nusing a multifunction NI DAQ card. Voltage sampling is regulated by evenly spaced triggers generated by XPS according to the mapping mesh specified by the operator. Furthermore, a trajectory manager is developed so that it is possible to select among scanning of lines, planes, or volumes. The block diagram is shown in Fig. 8: the central message handling loop (MHL) controls all the top-level threads, including the user interaction with the graphical interface and the display of measurement data; the motion control MHL instead generates trajectories and directly communicates to XPS control loop. The acquired voltage and position are logged in text files for post-processing."
        },
        {
            "heading": "A. Numerical Analyses",
            "text": "After creating the robot kinematic model from (5), equations are coded in MATLAB to simulate the positioning error in the\nworking volume: for each required point of the target scanning mesh, it is possible to obtain the real reached node coordinates, giving as input the entity of geometric errors.\nKnowing the probability density function of each geometric error, it is possible to run the MC simulation to have the PDF of E p and extract the expected value (systematic part of E p) and its standard deviation (Up). The MC simulation iteration number is set to 106 , sampling the geometric errors at each run from their PDFs and repeating the loop for 936 points distributed in the robot working volume. Table II shows all the influence variables with their PDF: uniform distribution is assigned to values given by the metrology reports of commercial stages, while normal distribution to the in-house performed inspections. Vibration effects \u2202\u2212\u2192x are introduced in the analysis as zero-mean normal distribution with standard deviation of 2.5\u03bcm, obtained from a dynamic model of the bench; similarly, position reading delay effect \u2212\u2192x is modeled with a normal distribution, zero-mean and standard deviation of 1\u03bcm. These effects have been added to the simulation but their contribution can be considered negligible with respect to the impact of kinematic errors.\nThe largest positioning error was obtained along the X-axis, with a systematic error of 16\u03bcm and a standard uncertainty of 13\u03bcm. The combination of these two quantities led to an uncertainty Up of 21\u03bcm.\nThe global measurement model is then studied by coupling the kinematic and the magnetic ones. Transducer performances have been derived from the manufacturer data-sheet (Table I). Temperature effects, that are generally relevant for Hall transducers, have not been considered because of the online sensitivity compensation implemented in the sensor. A similar consideration applies to the inductive effects due to planar Hall effect. SP was therefore computed from the data declared by the manufacturer that already included the sensor noise and the residual nonlinearities. Performances of the Hall probe, hereinafter referred to as SH P , were simulated\nby a uniform probability distribution with a standard deviation equal to 0.15 % and centered on the nominal unit value.\nThe MC simulation is performed also in this case with 106 iterations and the PDF of E f is processed to get the expected value (systematic part of E f ) and its standard deviation (U f ). Concerning the multipoles, this study is applied to a quadrupole magnet that has been fully characterized in the past at PSI for the SwissFEL project. The magnet, called QFDp4 and shown in Fig. 9, has a main quadrupole component and its first 15 harmonics are measured with the rotating coil technique [31] and listed in Table III. The simulated magnetic measurement resulted in 4 units of systematic error and a standard uncertainty of 5 units, which are combined to calculate the magnetic field measurement uncertainty U f as 6.5 units."
        },
        {
            "heading": "B. Experimental Results",
            "text": "The volumetric error is mapped using a Leica LT to investigate the positioning performances of the CFM; The metrological performances of the Tracker are declared by the manufacturer and include a maximum error of 10\u03bcm and a standard uncertainty of 5\u03bcm. The target retro-reflector is mounted on the bench end-effector and 936 target points are\nTABLE IV SYSTEMATIC AND RANDOM POSITIONING ERROR COMPONENTS OBTAINED IN SIMULATIONS AND EXPERIMENTS\nFig. 10. Average systematic component of CFM volumetric positioning error.\ncommanded to the robot in ten repetitions: these locations are spaced along each axis to cover the whole working volume. The software commands the robot to reach the target points and their actual coordinates are measured with the laser tracker using a 2 s time average. The scanning time was selected as a tradeoff between a reasonable test duration and the increase of the reference position accuracy deriving from the averaging procedure. Fig. 10 shows the average of the positioning error obtained as the difference between the nominal target position and the coordinates acquired by the laser tracker in the volume.\nTable IV reports the comparison of the positioning error components (bias and random) between experimental results and simulations; in this case, the largest error was obtained along Z -axis, with a systematic error of 11\u03bcm and a standard uncertainty of 14\u03bcm. The combination of these two quantities led to an uncertainty Up of 18\u03bcm. Experimental results are compatible with the simulation ones along all three Cartesian axes; the larger difference occurs along X-axis, where the systematic error component measured during the experiments is lower than that expected from simulations. This is reasonable due to an overestimation of X-related values reported in Table II; the identification of the reasons that led to the discrepancy between experiments and simulations could be performed using factorial design of experiments techniques and MC methods, as in [9].\nThe QFDp4 quadrupole is used then to test the accuracy of the CFM and to validate the measurement model. The magnet is installed in the measurement area and its orientation in space is adjusted thanks to mechanical jigs and checked with the LT. After this alignment, the orientation and location of the magnet frame are defined with respect to the Hall probe ones. Maps of the generated field in the magnet aperture are acquired with 30 repetitions and Fig. 11 shows an example\nTABLE V SYSTEMATIC AND RANDOM MAGNETIC ERROR COMPONENTS OBTAINED"
        },
        {
            "heading": "IN SIMULATIONS AND EXPERIMENTS",
            "text": "Fig. 12. Comparison simulated and experimental positioning error, indicated with MC and LT respectively. The uncertainty is reported with a confidence interval of 95 %.\nof a 2-D magnetic map. The plot shows the dependence of the magnetic field component along the Y -axis from the x and z coordinate and is a representative situation of the use of the CFM, with strong gradients along different axes. The measured field is then compared with the reference values obtained with the rotating coil system and reported in Section III-A; systematic error and experimental standard uncertainty of the magnetic measurement experiments and simulation are reported in Table V. For the experimental case, bias and random components can be combined as U f reaching 7.5 units."
        },
        {
            "heading": "C. Method Validation",
            "text": "This section compares the results obtained in the simulation and in the experimental environments to validate the measurement model and assess the final performances of the CFM. Fig. 12 shows the systematic positioning error and its uncertainty with 95 % confidence intervals obtained from simulation and experiments for each axis. The plot shows the compatibility of results, thus validating the kinematic model\nof the robot. The CFM positioning uncertainty Up is verified to be 36\u03bcm, with a coverage factor of 2.\nFig. 13 shows the 95 % confidence intervals for the simulated and the experimental scans of the induction vector produced by QFDp4 in its aperture. Also, in this case, the intervals are overlapped showing good agreement and finally the magnetic measurement uncertainty U f is 15 units, with a coverage factor of 2.\nBoth the kinematic model and the coupled mechanicalmagnetic ones are validated with the experimental campaign and, finally, it is proven that U f is well below 50 units as required for the SLS-2 upgrade."
        },
        {
            "heading": "IV. DISCUSSION",
            "text": ""
        },
        {
            "heading": "A. Model Validity",
            "text": "As presented in the previous section, the results obtained from the numerical estimation of the magnetic measurement uncertainty are coherent with the experimental ones, thus proving the method validity. With this technique, it is possible to forecast the final process yield and adjust the design parameters to achieve the target measurement performances. This result can be obtained only with a deep understanding of the positioner kinematic, that, as in the analyzed case, is simplified by a serial chain, but can show high complexity in more articulated robots. Furthermore, the magnetic model used to complete the measurement function is only bi-dimensional, neglecting the field distribution variation along the particle direction due to fringe effects caused by the yoke and the coil ends. These two limitations do not represent a violation of the method applicability but require further efforts to model the mechanical and the magnetic elements. In this work, the interferences caused by the magnetic field on the bench mechanical components are neglected due to the design of a long measurement arm. Generally, these effects should be considered by modeling and measuring the motor torque variation when put in proximity of a magnet to be tested."
        },
        {
            "heading": "B. Recommendations",
            "text": "The design of a magnetic field scanning system should target the minimization of the design efforts, to avoid requirements stricter than necessary. This step requires knowledge of\nthe magnetic field gradients. In presence of limited gradients, or if the magnetic field is constant, the uncertainty of the positioning system is not affecting the magnetic measurement, given that a position error does not entail an error in the magnetic field magnitude. In this case, the sensor performances are driving the uncertainty budget, thus requiring less restrictive mechanical constraints on tolerancing. In the case of high gradients, the mechanical structure becomes crucial in the instrument design, since a small error in the position causes a large error in the magnetic field magnitude; rigid structures, in these situations, ensure limited static deflections and acceptable dynamic effects. Slender structures, in fact, increase the jitter generated by the mechanical vibrations induced by the probe motion. Another limit arises as a consequence of the larger static deflection, which requires complex compensation techniques and time-consuming calibration. In all the intermediate cases, the coupled mechanical-magnetic model is a fundamental tool to have a good tuning between the two contributions and fulfill the U f requirement."
        },
        {
            "heading": "V. CONCLUSION",
            "text": "This article proposed a method to investigate the effect of mechanical positioning uncertainty on magnetic field maps. The method allows the a priori estimation of the final measurement uncertainty according to the mechanical design choices. This study has been applied to the CFM developed for SLS-2 magnets: having a target measurement uncertainty for the system under design, the weight of the position uncertainty with respect to the magnetic sensor one is opportunely tuned to avoid spoiling the sensor performances. For a stated magnetic sensor uncertainty of 15 units (0.15 %), the CFM propagated measurement uncertainty U f is within the sensor limit. Currently, the bench is installed in the magnetic measurement laboratory at PSI and it is ready for serial measurements."
        }
    ],
    "title": "Numerical and Experimental Estimation of Measurement Uncertainty in Magnetic Field Mapping",
    "year": 2022
}
{
    "abstractText": "Institute of Physics, University of S\u00e3o Paulo, S\u00e3o Paulo, SP, Brazil, Faculdade de F\u0131\u0301sica, Universidade Federal do Par\u00e1, Bel\u00e9m, PA, Brazil, Brazilian Synchrotron Light Laboratory \u2013 SIRIUS/CNPEM, Campinas, SP, Brazil, Department of Physics, San Diego State University, San Diego, California, USA, and Department of Physics, University of Guelph, Guelph, Ontario, Canada. *Correspondence e-mail: skycia@uoguelph.ca, morelhao@if.usp.br",
    "authors": [
        {
            "affiliations": [],
            "name": "Rafaela F. S. Penacchio"
        },
        {
            "affiliations": [],
            "name": "Maur\u0131\u0301cio B. Estradiote"
        },
        {
            "affiliations": [],
            "name": "Cl\u00e1udio M. R. Rem\u00e9dios"
        },
        {
            "affiliations": [],
            "name": "Guilherme A. Calligaris"
        },
        {
            "affiliations": [],
            "name": "Milton S. Torikachvili"
        },
        {
            "affiliations": [],
            "name": "Stefan W. Kycia"
        },
        {
            "affiliations": [],
            "name": "S\u00e9rgio L. Morelh\u00e3o"
        }
    ],
    "id": "SP:29d9ae5cae9dd65881e3f4003a30965fbc6a9255",
    "references": [
        {
            "authors": [
                "Chang",
                "S.-L."
            ],
            "title": "Multiple Diffraction of X-rays in Crystals",
            "venue": "Berlin, Heidelberg: Springer.",
            "year": 1984
        },
        {
            "authors": [
                "Chang",
                "S.-L."
            ],
            "title": "Chin",
            "venue": "J. Phys. 35, 896\u2013902.",
            "year": 1997
        },
        {
            "authors": [
                "R. Colella"
            ],
            "title": "Acta Cryst",
            "venue": "A30, 413\u2013423.",
            "year": 1974
        },
        {
            "authors": [
                "R. Colella"
            ],
            "title": "Phys",
            "venue": "Scr. 15, 143\u2013146.",
            "year": 1977
        },
        {
            "authors": [
                "H.J. Juretschke"
            ],
            "title": "Phys",
            "venue": "Rev. Lett. 48, 1487\u20131489.",
            "year": 1982
        },
        {
            "authors": [
                "R. Lang",
                "A. de Menezes",
                "A. dos Santos",
                "S. Reboh",
                "E. Meneses",
                "L. Amaral",
                "L. Cardoso"
            ],
            "title": "Recrystallization, edited by K. Sztwiertnia",
            "venue": "ch. 14. Rijeka: IntechOpen",
            "year": 2012
        },
        {
            "authors": [
                "V. Mu\u00f1oz-Sanjos\u00e9"
            ],
            "title": "Thin Solid Films, 541, 107\u2013112",
            "venue": "Meents, A., Gutmann, S., Wagner, A. & Schulze-Briese, C. (2010).",
            "year": 2013
        },
        {
            "authors": [
                "E. Abramof"
            ],
            "title": "Appl",
            "venue": "Phys. Lett. 112, 101903. Morelh\u00e3o, S. L., Kycia, S. W., Netzke, S., Fornari, C. I., Rappl, P. H. O.",
            "year": 2018
        },
        {
            "authors": [
                "M. Renninger"
            ],
            "title": "Z",
            "venue": "Kristallogr. 97, 107\u2013121.",
            "year": 1937
        },
        {
            "authors": [
                "E. Rossmanith"
            ],
            "title": "J",
            "venue": "Appl. Cryst. 36, 1467\u20131474.",
            "year": 2003
        },
        {
            "authors": [
                "Q. Shen"
            ],
            "title": "Acta Cryst",
            "venue": "A59, 335\u2013340.",
            "year": 2003
        }
    ],
    "sections": [
        {
            "text": "1574 https://doi.org/10.1107/S1600576723005800 J. Appl. Cryst. (2023). 56, 1574\u20131584\nReceived 19 December 2022 Accepted 2 July 2023\nEdited by A. H. Liu, HPSTAR and Harbin Institute of Technology, People\u2019s Republic of China\nKeywords: X-ray dynamic diffraction; single crystals; triplet phase determination; Python code.\nSupporting information: this article has supporting information at journals.iucr.org/j\nIntroduction to Python Dynamic Diffraction Toolkit (PyDDT): structural refinement of single crystals via X-ray phase measurements\nRafaela F. S. Penacchio,a Maur\u0131\u0301cio B. Estradiote,a Cla\u0301udio M. R. Reme\u0301dios,b Guilherme A. Calligaris,c Milton S. Torikachvili,d Stefan W. Kyciae* and Se\u0301rgio L. Morelha\u0303oa*\naInstitute of Physics, University of Sa\u0303o Paulo, Sa\u0303o Paulo, SP, Brazil, bFaculdade de F\u0131\u0301sica, Universidade Federal do Para\u0301, Bele\u0301m, PA, Brazil, cBrazilian Synchrotron Light Laboratory \u2013 SIRIUS/CNPEM, Campinas, SP, Brazil, dDepartment of Physics, San Diego State University, San Diego, California, USA, and eDepartment of Physics, University of Guelph, Guelph, Ontario, Canada. *Correspondence e-mail: skycia@uoguelph.ca, morelhao@if.usp.br\nPyDDT is a free Python package of computer codes for exploiting X-ray dynamic multiple diffraction in single crystals. A wide range of tools are available for evaluating the usefulness of the method, planning feasible experiments, extracting phase information from experimental data and further improving model structures of known materials. Graphical tools are also useful in analytical methodologies related to the three-dimensional aspect of multiple diffraction. For general X-ray users, the PyDDT tutorials provide the insight needed to understand the principles of phase measurements and other related methodologies. Key points behind structure refinement using the current approach are presented, and the main features of PyDDT are illustrated for amino acid and filled skutterudite single crystals.\n1. Introduction\nMultiple diffraction (MD) peaks exhibiting asymmetrical line profiles in azimuthal scans of weak Bragg reflections are direct evidence of dynamical diffraction within perfect crystalline domains (Renninger, 1937; Chang, 1984). As the profile asymmetries are related to the structure factor phases of two or more simultaneously excited hkl reflections, MD experiments have been used as a refinement tool capable of uncovering structural details beyond the resolution limit of other techniques. A list of applications mainly related to phase measurements includes improvement of diffraction anomalous fine structure techniques (Lee et al., 2006; Liu et al., 2016), studies of orbital and charge ordering in magnetic materials (Shen et al., 2006; Weng et al., 2012; Liu et al., 2017), probing minor internal strain induced by ion doping in optical crystals (Morelha\u0303o et al., 2011; Amirkhanyan et al., 2014), identification of chirality in crystals with no resonant atoms (Hu\u0308mmer & Weckert, 1995; Shen et al., 2000; Morelha\u0303o et al., 2015; Kozlovskaya et al., 2021), validation of ionic model structures for amino acid crystals (Morelha\u0303o et al., 2017) and inspection of phonon scattering mechanisms in thermoelectric materials (Vale\u0301rio et al., 2020). This list of successful applications has been possible after decades of knowledge in theoretical approaches and experimental procedures to process MD line-profile asymmetries into structural information (Hart & Lang, 1961; Colella, 1974; Post, 1977; Chapman et al., 1981; Juretschke, 1982; Chang, 1997; Weckert & Hu\u0308mmer, 1997; Chang et al., 1999; Wang et al., 2001; Mo et al., 2002; Morelha\u0303o\nISSN 1600-5767\nPublished under a CC BY 4.0 licence\n& Kycia, 2002; Morelha\u0303o, 2003b; Soares et al., 2003; Shen, 2003; Thorkildsen et al., 2003).\nBesides phase measurements, MD-based optical devices for X-rays are applications under consideration (Souvorov et al., 2004; Huang et al., 2013, 2014; Tang et al., 2021). At the same time, the intrinsic three-dimensional nature of MD events has opened up an entirely new branch of methodologies for analyzing bulk crystals and nanostructured devices: for instance, to detect subtle growth-induced lattice changes at the p.p.m. level of doped crystals for habit modification studies (Reme\u0301dios et al., 2008, 2010; Lan et al., 2018), lattice constants, phase transitions, piezoelectric and thermal expansion coefficients of single crystals (Avanci et al., 1998a; Borcha et al., 2009; Tsai et al., 2011; dos Santos et al., 2019), anisotropic strain on ion-beam-induced crystallization of nanoparticles (Lang et al., 2012, 2013), interface lattice strain (Sun et al., 2006, 2007; Zheng et al., 2016), spatial orientation of crystal domains in piezoelectrics (Morelha\u0303o et al., 1999), thin films (Morelha\u0303o & Domagala, 2007) and nanostructures (Mart\u0131\u0301nezToma\u0301s et al., 2013), crystalline perfection of surfaces and epitaxial films (Morelha\u0303o & Cardoso, 1996; Hayashi et al., 1997; Avanci et al., 1998b), and lattice mismatch of heteroepitaxial systems from semiconductors to topological insulators (de Menezes et al., 2010; Domaga\u0142a et al., 2016; Smith et al., 2017; Borcha et al., 2017; Morelha\u0303o et al., 2018, 2019). Diffuse multiple scattering is another MD-related phenomenon, observable on area detectors when using high-flux X-ray beams from advanced synchrotron facilities (Nisbet et al., 2015). Although this phenomenon also carries detailed 3D information about the crystal structure, its predictability and practical applications are still open to investigation.\nTo explain and further exploit the potential of dynamic diffraction as a refinement tool, we introduce in this work the Python Dynamic Diffraction Toolkit (PyDDT), available on GitHub (Penacchio, 2022). It is a package of computer codes\nto guide general X-ray users through all the necessary steps to succeed in acquiring and analyzing dynamic MD data: understand the potential of dynamic diffraction in studying a material that can be grown as single crystals with millimetrescale dimensions, select X-ray energy and measurable MD events intended to refine the average crystal unit cell, extract and index a list of useful profile asymmetries present on azimuthal scans, generate model structures, and compare model-predicted asymmetries with experimental ones. In addition, available graphical tools can help users in dealing with the 3D aspect of MD, such as a quantitative geometric description of MD peak splitting due to anisotropic lattice strain, the 2D intensity distribution near MD events, and directional prediction of multiple diffuse scattering contributions. To demonstrate the key concepts behind structure refinement via dynamic diffraction and the use of graphical tools, we start with one of the most traditional problems in X-ray crystallography: the contribution of chemical bonding charges to the diffracted intensities."
        },
        {
            "heading": "2. Covalent bonds in silicon crystals",
            "text": "Since the work of Ewald & Ho\u0308nl (1936), the non-vanishing intensity of the silicon 222 reflection has been assigned to charge density along the covalent bonds. Later studies have shown that anharmonic effects due to noncentrosymmetric atomic sites also contribute to the 222 intensity above room temperature more than any other structural imperfections (Colella & Merlini, 1966; Roberto et al., 1974; Colella, 1977). As the experimental evidence of bonding and anharmonic contributions has come from intensity measurements of extremely weak reflections, the occurrence of MD was carefully avoided. However, there is something curious about the MD events having 222 as the reference reflection: all triplet phases are close to either 0 or 180 in model structures\nJ. Appl. Cryst. (2023). 56, 1574\u20131584 Rafaela F. S. Penacchio et al. PyDDT 1575\nwhere electronic charges are distributed along the bonds. Therefore, azimuthal scans of the 222 reflection, as presented in Fig. 1(a), provide one of the best showcases of how the MD excitation geometry g = 1 and the triplet phase are unambiguously correlated to the observable line profile asymmetry of any isolated MD peak. This correlation is written as (Morelha\u0303o et al., 2017; Vale\u0301rio et al., 2020)\ng cos\u00f0 \u00de > 0 higher lower \u00f0HL\u00de shoulders; < 0 lower higher \u00f0LH\u00de shoulders:\n\u00f01\u00de\nFor instance, the MD peaks with 131 and 113 secondary reflections have the same phase value of = 5.4 , but they are excited under different geometries, g = 1 and g = 1, respectively. This results in MD peaks with opposite lineprofile asymmetries, as seen in the insets of Fig. 1(a). The MD peak at \u2019 19 has its left shoulder higher (H) than the right shoulder, which is lower (L), hence the labeled HL (higher\u2013 lower shoulders) type of asymmetry. The LH (lower\u2013higher shoulders) type of asymmetry is observed for the structurally equivalent MD peak at \u2019 41 , where only the geometry of excitation has changed from g = 1 to g = 1, as indicated in Fig. 1(b) by Bragg cone (BC) lines of different colors.\nA BC line is a 2D graphic representation of Bragg\u2019s law as a function of the instrumental angles ! and , as detailed elsewhere (Domaga\u0142a et al., 2016). During the rotation, the reciprocal-lattice point of the secondary reflection crosses the scattering sphere, also known as Ewald\u2019s sphere, twice, first when moving from outside to inside the sphere, the g = 1 geometry, and second when moving from inside to outside the sphere, the g = 1 geometry. A clockwise crystal rotation around the axis has been assumed as the positive sense. In Fig. 1(b), these excitation geometries are represented by the BC lines in blue (g = 1) and red (g = 1). In addition to indexing azimuthal scans, there are other MD-related phenomena where BC line plots can be helpful: revealing surface structure information via a specific MD geometry, otherwise known as Bragg surface diffraction (Jen & Chang, 1992; Morelha\u0303o & Cardoso, 1993; Hayashi et al., 1997; Avanci & Morelha\u0303o, 2000; Avanci et al., 1998a; Freitas et al., 2009; Lang et al., 2013; Huang et al., 2014; Zheng et al., 2016), where the 2D intensity distribution around the MD peaks follows the orientation of the BC lines. When single crystals are hit with a high-flux ( 1014 ph s 1 mm 2) monochromatic X-ray beam, diffuse multiple scattering (Nisbet et al., 2015) makes BC lines visible on zero-noise area detectors.\nThe simple rule summarized by equation (1) for correlating structural information and experimental results is the foundation upon which PyDDT was built. The structural information comes from the triplet phase values, calculated as in\nFHFG H FG \u00bc FHFG H FG exp\u00f0i \u00de; \u00f02\u00de\nwhere FX (X = G, H and G\u2013H) stands for the structure factor of each involved reflection. G is the reference reflection, i.e. 222 in the above example, H is the secondary reflection excited during the scan, and G\u2013H is the coupling reflection responsible for the second-order rescattering process. The\nexperimental results are the observed HL or LH asymmetries of the MD peaks. The asymmetries are the signature of a crystal undergoing dynamic diffraction, i.e. the multiple diffracted wavefields interfering with each other as they propagate inside the crystal (Weckert & Hu\u0308mmer, 1997). The strategy of analyzing only the type of asymmetry, instead of measuring the triplet phase value itself from the line profile asymmetry, falls into the imponderability of knowing the lattice coherence length of each sample. In other words, lattice defects reduce the coherence of the diffracted wavefields, causing asymmetric profiles from the dynamic MD theory to appear as nearly symmetrical (Morelha\u0303o et al., 2011). In this introductory example of structure modeling via dynamic diffraction, the presence of electronic charges in the covalent bonds, as schematized in Fig. 2, is necessary for a non-zero structure factor of the reference reflection, i.e. the Si 222 reflection. On top of this, the model also explains all observed peak asymmetries, implying that the 222 reflection phase itself, and hence the calculated triplet phases in Table 1, agree with the experimental data in Fig. 1(a).\n1576 Rafaela F. S. Penacchio et al. PyDDT J. Appl. Cryst. (2023). 56, 1574\u20131584"
        },
        {
            "heading": "111 5.8 1 175.9 HL 531 32.7 1 6.1 HL",
            "text": ""
        },
        {
            "heading": "133 0.7 1 174.6 LH 331 30.2 1 4.1 LH",
            "text": "In addition to isolated three-beam MD events where only one secondary reflection is excited, systematic four-beam MD events also obey the asymmetry rule in equation (1) and can be used for phasing purposes. They consist of two simultaneous three-beam MD peaks with identical triplet phases at any X-ray energy. For instance, for the MD peak at \u2019 9.5 in Fig. 1(a), both the 513 and 131 secondary reflections lead to\n= 174.5 . As both reflections have geometry g = 1 (red BC lines), the LH asymmetry is observed. On the other hand, simultaneous MD peaks with opposite geometries and identical values can also occur, leading to symmetrical MD peaks at mirroring positions. The 313 and 331 MD peaks [Fig. 1(a)] are an example, as their combined profile is symmetric around = 30 . At 8 keV these peaks are set apart by 0.34 , and hence they are not systematic MD peaks but rather nearly coincidental, requiring an energy increment of 31 eV to become a single peak with a perfectly symmetrical line profile. The silicon 222 reflection has a sixfold symmetry axis, implying a scan that repeats itself every 60 , giving rise to 12 mirroring positions: six with double peaks such as those at = 30 , and six with a tiny intensity dip as seen at = 0 and = 60 in Fig. 1(a). Each of these dips in intensity denotes the excitation of the secondary reflection 220, whose coupling reflection 002 is prohibited, F002 = 0, even in the silicon model with bonding charges. MD peaks with dip-like line profiles are caused by the Aufhellung effect that generally occurs when |FG| |FHFG\u2013H| (Chang, 1984; Morelha\u0303o et al., 2005b). Structure refinement through PyDDT uses the entire data set of MD events whose line profiles are dominated by the second-order term of the n-beam dynamic theory of X-ray diffraction (Colella, 1974; Chang, 1984; Weckert & Hu\u0308mmer, 1997; Morelha\u0303o, 2003a). These are the profiles that obey the asymmetry rule in equation (1). The best approach to ensure the validity of this rule for most H reflections is by selecting weak reference reflections such that |FG| |FHFG\u2013H|. For instance, according to the model structure in Fig. 2, the Si 222 reference reflection has |FG| = 6.5, while the weakest MD peak listed in Table 1 has H as the 533 reflection and |FHFG\u2013H| = 638. As a visual criterion, nearly symmetric MD peaks, where the asymmetries are limited to very low intensity shoulders, generally follow the rule in equation (1). Exceptions are related to the overlap of MD peaks when it compromises the identification of their individual asymmetries. Plotting BC lines, as in Fig. 1(b), is helpful to visualize such overlap events even when they appear as a single MD peak. Another exception is caused by polarization suppression of the secondorder term, an unusual situation that can occur when the H or G\u2013H reflections have a Bragg angle close to 45 , as discussed extensively elsewhere (Stetsko et al., 2000; Morelha\u0303o & Avanci, 2001; Morelha\u0303o et al., 2005a,c).\n3. Capabilities of PyDDT\nUsage of PyDDT can be divided into a few main procedures as follows.\n(i) To understand the potential of dynamic diffraction in the structure refinement of single crystals, PyDDT allows users to\ncompare the structure factor phases of different models with subtle changes in ionic charges, Debye\u2013Waller factors, occupation factors, bonding charges, internal lattice strain and any other structural modification describable through an average crystal unit cell. On the basis of the list of susceptible reflection phases, measurable reflections are selected as the reference reflection G, and the triplet phases are computed for the proposed model structures. Graphical output showing all MD events with the flipping of profile asymmetries between models provides a clear perspective of how helpful dynamic diffraction via azimuthal scans can be in terms of finding improved model structures of the materials. See Section 3.1 for a few examples.\n(ii) Selection of the X-ray energy to enhance phase variation between models is another capability of PyDDT. It also allows the identification of resonant phase shifts, a handy tool for planning multiwavelength anomalous diffraction experiments, where the MD asymmetries are scanned against the reference reflection phase as it shifts as a function of X-ray energy. For each wavelength/energy, completely different data sets of profile asymmetries are obtained, which can significantly narrow the range of feasible model structures. A demonstration of this phenomenon is given in Section 3.2.\n(iii) With an azimuthal scan in hand, 2D graphs of the BC lines, e.g. Fig. 1(b), are available via PyDDT to help with azimuth offset correction, identification of MD excitation geometry g and discarding of overlapped peaks whose asymmetries may behave differently than predicted by equation (1). After the offset correction, the MD peak positions are determined and their secondary reflections H indexed. Line profile fitting of each MD peak is performed automatically to determine the degrees of asymmetry and reliability, as described in Section 3.3. By the end of this procedure, there is a list of H reflection indices with their g = 1 or 1 values and observed HL or LH type of line-profile asymmetries.\n(iv) An asymmetry comparison diagram (ACD) is the final output of PyDDT, given to the user as a graphical tool to organize and compare the whole set of observed asymmetries against the model-predicted ones. A few examples of this PyDDT capability are given in Section 3.4."
        },
        {
            "heading": "3.1. Finding suitable MD peaks",
            "text": "From the crystallographic information file (CIF) of a compound, available built-in tools allow users to generate alternative model structures. Each model is a formatted input text file containing the chemical species and their atomic fractional coordinates, occupation factors and isotropic B factors, as described in the walkthrough of the PyDDT user\u2019s guide (Penacchio, 2022). For a practical example, validation of ionic models is necessary for crystal structures determined by neutron diffraction, as demonstrated earlier when resolving the ionic model of a simple amino acid crystal, alanine, by carrying out a single scan (Morelha\u0303o et al., 2017). In the case of l-asparagine monohydrate (ASN), a more complex amino acid with water molecules in its crystal structure, different B factors for each atomic site can blur the resolution of electronic\nJ. Appl. Cryst. (2023). 56, 1574\u20131584 Rafaela F. S. Penacchio et al. PyDDT 1577\ncharge in the hydrogen bonds between the molecules [Fig. 3(a)], at least from the perspective of dynamic diffraction.\nThe interplay between ionic models and displacement parameters can be demonstrated by searching for reflection phases susceptible to the number of electrons transferred from hydrogen to other atoms, for instance between hydrogen and nitrogen in the amino group, as depicted in Fig. 3(b). For a partial charge transfer x in electron number, the corresponding model has an occupation factor 1 x for each hydrogen in this group, while both the neutral nitrogen and the N3 ion occupy the same site with occupancy factors 1 x and x, respectively. For x = 0, all atoms are neutral, and there is one e at each hydrogen site. For x = 1, there are only nonX-ray scattering protons at the hydrogen sites, and the amino group has a spherically symmetric electronic charge distribution. In such models, the effective scattering factors of the Hx+ and N3x ions in the amino group are fHx\u00fe \u00bc \u00f01 x\u00defH and fN3x \u00bc \u00f01 x\u00defN \u00fe xfN3 . PyDDT has a user-friendly interface for generating such model structures, including the Cromer\u2013 Mann coefficients to calculate the scattering factor f of atoms and ions (Brown et al., 2006). Resonance amplitudes f 0 + if 00, often called dispersion correction terms or anomalous scattering factors, are also accounted for in f via linear interpolation of the tabulated values for free atoms (Brown et al., 2006; Morelha\u0303o, 2016).\nFig. 4(a) compares single reflection phases between two models, one for x = 0 and another for x = 1; both models have a mean B factor hBi = 6 A\u030a2 for all atomic sites \u2013 the effect of different B factors for each atomic site is evaluated later in Section 3.4. As can be seen, two families of reflections, {026} and {304}, are highly susceptible to this particular charge distribution in the amino group. These reflections are also very weak, making them good candidates for reference reflections where the asymmetry rule in equation (1) is valid. A near 180 phase shift of the reference reflection implies a significant number of MD profiles having opposite asymmetries in the two models, as shown in Fig. 4(b) for 026 as the reference reflection. The scan of the 026 reflection has the advantage that the strongest MD event, with 113 (or 113) secondary reflection, is in principle able to discriminate between the two models."
        },
        {
            "heading": "3.2. Selection of X-ray energy",
            "text": "In materials containing elements whose absorption edges are in the spectral range of the radiation source, X-ray energies can be selected to enlarge the dynamic diffraction data set via the resonant phase shift. This recalls the multiwavelength anomalous diffraction approach used in protein crystallography, but with the difference that the experimental data monitored as a function of the X-ray energy are the MD peak asymmetries instead of diffracted intensities of individual Bragg reflections. For example, consider skutterudite LaFe4P12 (SKD) (Takegahara & Harima, 2007), whose 002 reflection undergoes a huge phase shift of about 280 across the Fe absorption edge [Fig. 5(a)]. Consequently, SKD 002 scans have peak asymmetries extremely susceptible to X-ray energies close to 7.1 keV, such as those in Figs. 5(b)\u20135(d), where the peak asymmetries are observed to flip twice. For instance, MD 413 has = 108.8, 0.5 and 175.7 at the used energies of 6.705, 7.103 and 7.314 keV, respectively. Hence its HL asymmetry in Fig. 5(b) flips to LH in Fig. 5(c) and flips back to HL in Fig. 5(d). As the double flipping is mainly induced by the resonant phase shift of the reference reflection, it is observed for all MD peaks that were tracked from one scan to the other. In tracking peak positions as X-ray energy increases, the\n1578 Rafaela F. S. Penacchio et al. PyDDT J. Appl. Cryst. (2023). 56, 1574\u20131584\ngeneral rule is that MD events excited under the g = 1 (g = 1) geometry move in the negative (positive) sense of the values. In other words, all MD events with blue hkl indices (g =\n1) in Fig. 5(b) go to the left in Figs. 5(c) and 5(d), while the MD events with red indices (g = 1) go to the right. Model structures capable of explaining multiwavelength data sets of profile asymmetries in SKD are related to differences in the Debye\u2013Waller factors for each atomic site, as pointed out elsewhere (Vale\u0301rio et al., 2020; Penacchio, 2022).\nFor light materials such as amino acid crystals without metal ions, it is necessary to consider the benefits of using shorter or longer wavelengths according to the number of accessible MD peaks with a minimum of overlapping. This is another benefit of having graphical tools available to visualize BC lines and understand their behavior as a function of X-ray energy. Slightly above the minimum energy for exciting a given MD event, its line profile can become very broad as both diffraction geometries occur close to each other and can overlap\nmany other MD events, e.g. the case reported in Fig. 5(e). A small increment in energy leads to drastic displacement in , as illustrated by the 13 displacement of MD 455 between Figs. 5(c) and 5(d), against an energy increment of only 211 eV. The usefulness of such cases is related more to the accurate determination of either lattice parameters or energy of synchrotron X-rays than to the asymmetry reading itself, and they can be better interpreted via graphical representation of the azimuthal scans as a function of X-ray wavelength (Rossmanith, 2003)."
        },
        {
            "heading": "3.3. Indexing and asymmetry reading",
            "text": "The larger the unit cell, the greater the number of MD peaks in the scans. Indexing of organic crystals, in general with unit cells of volume above 500 A\u030a3, can be challenging. The BC line graphs from PyDDT are very helpful, mainly for reference reflections along axes of low symmetry such as the\nJ. Appl. Cryst. (2023). 56, 1574\u20131584 Rafaela F. S. Penacchio et al. PyDDT 1579\nalanine 261 reflection, a single-fold symmetry axis with no mirroring positions in the scan (Morelha\u0303o et al., 2017). The ASN 026 reflection is a twofold symmetry axis, making it much easier to identify the sample\u2019s azimuth and therefore index the secondary reflections of the MD peaks. The 026 scan repeats itself every 180 , giving rise to four mirror positions, three of which are seen in Fig. 6 at = 0, 90 and 180 . The MD events with symmetric line profiles at either = 0 or 180 are caused by the systematic simultaneous excitation of secondary reflections 020 and 006, taking place when the crystal\u2019s [100] direction lies in the plane of incidence \u2013 the plane that contains the incident and 026 diffracted X-ray beams. The other secondary reflections were indexed assuming this direction points to the X-ray source at = 0; see Section S1 in the supporting information for a graph of the BC lines. Once the sample azimuth is identified, PyDDT selects and indexes most peaks above the background noise. Nevertheless, the user needs to carry out a final check, deselecting overlapped peaks and including others that, for some reason, were skipped by the peak searching algorithm.\nSeveral MD peaks in the ASN 026 scan exhibit line profiles with readily distinguishable asymmetries, such as those highlighted in the insets of Fig. 6. This is the typical signature of dynamic diffraction and, therefore, of a sample of good crystalline quality. From only the asymmetries of a few MD peaks, it is already possible to rule out the model structure with neutral atoms, that is, the x = 0 model in Fig. 3(b). For instance, the MD peak at \u2019 102 with secondary reflection 113 and geometry g = 1 exhibits the LH type of asymmetry, implying that it must have cos( ) < 0 according to equation (1). The x = 0 and x = 1 models lead to triplet phases = 4.6 and = 177.9 , respectively. Equivalent results are obtained for the other indexed peaks in the insets of Fig. 6, all indicating that ionic models where x > 0 need to be evaluated. However, it is necessary to read as many asymmetries as possible for a more accurate evaluation of valid model structures.\nPyDDT comes with a line-profile fitting tool designed for asymmetry reading of isolated non-overlapped peaks. It consists of a Gaussian function with a sloping baseline to be adjusted to the log-transformed intensity data. Although the fit quality can be questionable for highly asymmetric peaks, as\nin Fig. 7(a), it is very efficient at identifying the peak asymmetry: a negative/positive slope indicates the HL/LH type of asymmetry. The slope and its uncertainty are useful for setting reliability criteria in the automatic asymmetry reading mode of PyDDT, a detail particularly relevant for line profiles with a low degree of asymmetry, such as those in Figs. 7(b) and 7(c).\nThe extent of the line-profile asymmetry is many times greater than the peak intrinsic width at half maximum. Instrumental broadening can smooth the asymmetry and reduce the MD signal-to-noise ratio, but the asymmetry reading is feasible with either characteristic or synchrotron radiation, provided that the axial divergence is limited to a few times the intrinsic width, in general below 1 mrad. Figs. 7(b)\n1580 Rafaela F. S. Penacchio et al. PyDDT J. Appl. Cryst. (2023). 56, 1574\u20131584\nand 7(c) report slopes of 0.4 0.1 and 1.0 0.2, respectively, for the 035 MD peak of the ASN sample as measured on two different instruments; see Section S2 for more details about the fitting procedure. The former was measured with Cu K 1 radiation from a rotating-anode generator, whose conditioning beam optics and four-circle diffractometer have been described elsewhere (Morelha\u0303o et al., 2018, 2019). The latter was measured on a high-flux low-divergence synchrotron beamline, the EMA beamline of the synchrotron light source SIRIUS, at the Brazilian Synchrotron Light Laboratory (LNLS) (dos Reis et al., 2020). Low-divergence beams make the asymmetry sharper, reducing overlapping, but require scans with more data points. Concurrently, the combination of low divergence and narrow reference reflection can be very demanding in terms of instrumental stability to keep the baseline intensity constant during the rotation. High-flux beams significantly reduce the counting time and, in general, improve the baseline statistical noise. However, in the case of a fragile crystal such as ASN, whose structure is stabilized by hydrogen bonds between the molecules, a flux above 1013 ph s 1 mm 2 hitting the sample at room temperature\ngives rise to the formation of hydrogen gas inside the crystals (Meents et al., 2010). This quickly breaks the crystal from the inside out, creating misaligned domains and making the line profiles and the baseline more irregular. After extended exposure, the crystal becomes a mosaic of small domains no longer holding dynamic diffraction. The MD line profiles become broader with undetectable asymmetries. In Fig. 8, there is a comparison of the same -scan session collected inhouse and on the EMA beamline as a function of flux and time of exposure.\nThe overall effects of angular resolution and baseline instabilities explain the slope values with nearly the same relative uncertainties in both instruments, such as the values reported above [Figs. 7(b) and 7(c)], for which the relative uncertainties are 25 and 20%, respectively (see also Section S2 and the inset of Fig S3). The cut-off for the slope relative uncertainty is usually set to about 50%, i.e. only profile asymmetries of non-overlapping MD events with relative uncertainties smaller than 50% were considered for comparison with model-predicted asymmetries, as described in the next section."
        },
        {
            "heading": "3.4. Comparing structure models and experimental results",
            "text": "Model structures can depend on several variables. PyDDT has built-in tools to generate ACDs (asymmetry comparison diagrams) where experimental and model-predicted profile asymmetries are compared as a function of two variables per diagram (Vale\u0301rio et al., 2020). For instance, one variable can be the charge transferred x in electron number from hydrogen to nitrogen in the amino group, as depicted in Fig. 3(b). The other variable can be the relative value of the B factor for each atomic site with respect to the overall mean value hBi. To be more specific, for the nth atomic site Bn(z) = (1 z)hBi + zB0, n, where z 2 [0, 1] and B0, n stand for the actual values reported in the literature, such as from neutron diffraction in the case of alanine and ASN crystals (Lehmann et al., 1972; Verbist et al., 1972).\nAn ACD consists of a grid of square matrices, where each matrix represents a model structure and each position in a matrix represents one of the measured profile asymmetries, i.e. one MD event of the scan. For viewing purposes, every matrix position is colored differently according to whether the corresponding profile asymmetry matches or differs from the model-predicted one. Fig. 9 shows examples of ACDs as a function of x and z variables for two amino acid crystals. For the ACD of alanine, the MD data set from the synchrotron 261\nscan is revisited (Morelha\u0303o et al., 2017), this time via PyDDT, to assess the impact of z properly. For the ACD of l-asparagine monohydrate, the data set from its 026 scan in Fig. 6 is used.\nInitially, a preliminary ACD is constructed using the complete list of reliable profile asymmetries obtained from scans, as in Fig. 9(a). It can be simplified by selecting only susceptible MD events, those highlighted in Fig. 9(b), whose corresponding matrix positions change in color as a function of the model parameters. The simplified ACD shown in\nJ. Appl. Cryst. (2023). 56, 1574\u20131584 Rafaela F. S. Penacchio et al. PyDDT 1581\nFig. 9(c) indicates an asymmetry data set much more susceptible to parameter x than parameter z. For models with different B factors for each atomic site at room temperature, z = 1, the experimental MD profile asymmetries agree with model structures where the amount of charge transferred from hydrogen to nitrogen in the amino group is limited to x 0.2. This limit increases to x 0.4 in the hypothetical case of a sample cooled to the point where z \u2019 0. In other words, the dynamic diffraction data set of alanine used here is detecting electronic charges at the hydrogen sites, implying compatible ionic models ranging from neutral atoms to one with H0.2+ and N0.6 ions.\nThe situation is opposite with the ACD of asparagine in Fig. 9(d), constructed using the susceptible MD peaks indicated in Fig. 9(e), where the triplet phase values for a model with x = 1 and z = 0.1 are also displayed; see Section S3 for more details about the behavior of as a function of x and z. Without accounting for the significantly different B factors, z < 0.1, only ionic models where x > 0.1 agree with the data set used. However, as different B factors are introduced into the models, z > 0.1, the predicted asymmetries become independent of x and they match the whole dynamic diffraction data set from the ASN 026 scan. This is a significant result, demonstrating that all asymmetries with reliability better than 40% obtained via PyDDT perfectly match those predicted by\nmodels with the B factors from neutron diffraction at room temperature (Verbist et al., 1972)."
        },
        {
            "heading": "4. Final remarks",
            "text": "To exploit dynamic multiple diffraction as a structure refinement tool, it is imperative first to evaluate how susceptible the individual Bragg reflection phases are to structural variables within the broad spectrum of synchrotron X-rays. PyDDT is a package of computer codes to make such a preliminary evaluation as easy as possible. However, unlike deterministic methods in crystallography, phase measurements via azimuthal scans of Bragg reflections allow the narrowing of the range of feasible model structures of known materials. Therefore, before moving on to the experimental parts, from crystal synthesis to the actual realization of azimuthal scans of chosen reflections, potential users have to be as sure as possible that, in principle, the method is capable of elucidating new information about the material. Accessing electronic charges in covalent and hydrogen bonds were the main examples used in this work to illustrate the usage of PyDDT. It has been demonstrated that in amino acid crystals the atomic displacement parameters can affect the reflection phase susceptibility in detecting bond charges, a fact that has to be taken into account from the initial evaluation.\n1582 Rafaela F. S. Penacchio et al. PyDDT J. Appl. Cryst. (2023). 56, 1574\u20131584\nResonant/anomalous phase shift is an asset with the potential for better resolution of displacement parameters, bonding charges and ionic models. Its occurrence can be easily identified via PyDDT, as demonstrated in predicting and measuring a remarkable phase shift in skutterudite LaFe4P12. Structure refinement of this class of thermoelectric materials by anomalous phase measurements is currently under investigation.\nOrientation of single crystals with a multi-axis diffractometer can be a trivial task in many experiments. For azimuthal scan-based phase measurements there are two extra challenges. The sample has to be perfect enough to undergo dynamic multiple diffraction, and the azimuthal rotation demands mechanical stability to keep the reference reflection diffracting within the vertical beam divergence during the scans. On the instrumental side, modern synchrotron facilities with smaller beam sizes have improved sample stability and its sphere of confusion over the years, speeding up MD azimuthal scans. Without recourse to synchrotron X-rays, selecting and mounting good samples must be accomplished in supporting laboratories equipped with four-circle diffractometers and confocal optics, such as the in-house rotating-anode powered diffractometer used in this work."
        },
        {
            "heading": "Acknowledgements",
            "text": "We acknowledge the SIRIUS Light Source of the Brazilian Synchrotron Light Laboratory (LNLS), part of the Brazilian Centre for Research in Energy and Materials (CNPEM), a private non-profit organization under the supervision of the Brazilian Ministry for Science, Technology and Innovations (MCTI). The EMA beamline staff are acknowledged for their assistance during the experiments under proposal No. 20210171. We are also grateful to the Canadian Light Source, a National Research Facility of the University of Saskatchewan, which is supported by the Canada Foundation for Innovation (CFI), the Natural Sciences and Engineering Research Council (NSERC), the National Research Council (NRC), the Canadian Institutes of Health Research (CIHR) and the Government of Saskatchewan. The BXDS-WLE beamline staff are acknowledged for their assistance during the experiments under project No. 35B12870.\nFunding information\nThe following funding is acknowledged: Fundac\u0327a\u0303o de Amparo a\u0300 Pesquisa do Estado de Sa\u0303o Paulo (scholarship No. 2021/ 01004-6 to Rafaela Penacchio; scholarship No. 2022/09531-8 to Mauricio Estradiote; grant No. 2019/01946-1 to Sergio Morelhao); Conselho Nacional de Desenvolvimento Cient\u0131\u0301fico e Tecnolo\u0301gico (scholarship No. 310432/2020-0 to Sergio Morelhao); Natural Sciences and Engineering Research Council of Canada (award to Stefan Kycia)."
        }
    ],
    "title": "Introduction to Python Dynamic Diffraction Toolkit (PyDDT): structural refinement of single crystals via X-ray phase measurements",
    "year": 2023
}
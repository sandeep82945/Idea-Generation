{
    "abstractText": "The demand for high-throughput electron tomography is rapidly increasing in biological and material sciences. However, this 3D imaging technique is computationally bottlenecked by alignment and reconstruction which runs from hours to days. We demonstrate real-time tomography with dynamic 3D tomographic visualization to enable rapid interpretation of specimen structure immediately as data is collected on an electron microscope. Using geometrically complex chiral nanoparticles, we show volumetric interpretation can begin in less than 10minutes and a high-quality tomogram is available within 30minutes. Real-time tomography is integrated into tomviz, an opensource and cross-platform 3D data analysis tool that contains intuitive graphical user interfaces (GUI), to enable any scientist to characterize biological and material structure in 3D.",
    "authors": [
        {
            "affiliations": [],
            "name": "Jonathan Schwartz"
        },
        {
            "affiliations": [],
            "name": "Chris Harris"
        },
        {
            "affiliations": [],
            "name": "Jacob Pietryga"
        },
        {
            "affiliations": [],
            "name": "Huihuo Zheng"
        },
        {
            "affiliations": [],
            "name": "Prashant Kumar"
        },
        {
            "affiliations": [],
            "name": "Anastasiia Visheratina"
        },
        {
            "affiliations": [],
            "name": "Nicholas A. Kotov"
        },
        {
            "affiliations": [],
            "name": "Peter Ercius"
        },
        {
            "affiliations": [],
            "name": "David A. Muller"
        },
        {
            "affiliations": [],
            "name": "Alessandro Genova"
        },
        {
            "affiliations": [],
            "name": "Yi Jiang"
        },
        {
            "affiliations": [],
            "name": "Marcus Hanwell"
        },
        {
            "affiliations": [],
            "name": "Robert Hovden"
        }
    ],
    "id": "SP:5af6e098b1fc288a01b8de99912cc57a09d27932",
    "references": [
        {
            "authors": [
                "R. Crowther",
                "L. Amos",
                "J. Finch",
                "R. David",
                "A. Klug"
            ],
            "title": "Three dimensional reconstructions of spherical viruses by fourier synthesis from electron micrographs",
            "venue": "Nature 226,",
            "year": 1970
        },
        {
            "authors": [
                "O Medalia"
            ],
            "title": "Macromolecular architecture in eukaryotic cells visualized by cryoelectron tomography",
            "venue": "Science 298,",
            "year": 2002
        },
        {
            "authors": [
                "P. Midgley",
                "Weyland",
                "M. 3d electron microscopy in the physical sciences"
            ],
            "title": "the development of z-contrast and eftem tomography",
            "venue": "Ultramicroscopy 96, 413\u2013431",
            "year": 2003
        },
        {
            "authors": [
                "M Scott"
            ],
            "title": "Electron tomography at 2.4-\u00e5ngstr\u00f6m resolution",
            "venue": "Nature 483,",
            "year": 2012
        },
        {
            "authors": [
                "Y Yang"
            ],
            "title": "Determining the three-dimensional atomic structure of an amorphous solid",
            "venue": "Nature 592,",
            "year": 2021
        },
        {
            "authors": [
                "R. David",
                "A. Klug"
            ],
            "title": "A reconstruction of three dimensional structures from electron micrographs",
            "venue": "Nature 217,",
            "year": 1968
        },
        {
            "authors": [
                "M. Schorb",
                "I. Haberbosch",
                "H. Wim",
                "Y. Schwab",
                "D. Mastronarde"
            ],
            "title": "Software tools for automated transmission electron microscopy",
            "venue": "Nat. Methods 16,",
            "year": 2019
        },
        {
            "authors": [
                "Buurlage",
                "J.-W"
            ],
            "title": "Real-time reconstruction and visualization towards dynamic feedback control during time-resolved tomography experiments at tomcat",
            "venue": "Sci. Rep",
            "year": 2019
        },
        {
            "authors": [
                "J Yan"
            ],
            "title": "Self-assembly of chiral nanoparticles into semiconductor heliceswith tunable near-infrared optical activity.Chem",
            "venue": "Mater. 32,",
            "year": 2019
        },
        {
            "authors": [
                "E. Orlova",
                "H. Saibil"
            ],
            "title": "Structural analysis of macromolecular assemblies by electron microscopy",
            "venue": "Chem. Rev. 111,",
            "year": 2011
        },
        {
            "authors": [
                "A. Andersen"
            ],
            "title": "Algebraic reconstruction in CT from limited views",
            "venue": "IEEE Trans. Med. Imaging",
            "year": 1989
        },
        {
            "authors": [
                "S. Gazzola",
                "P.C. Hansen",
                "Nagy",
                "J. IR tools"
            ],
            "title": "a matlab package of iterative regularization methods and large-scale test problems",
            "venue": "Numer. Algor. 81, 773\u2013811",
            "year": 2018
        },
        {
            "authors": [
                "P. Gilbert"
            ],
            "title": "Iterative methods for the three-dimensional reconstruction of an object from projections",
            "venue": "J. Theor. Biol",
            "year": 1972
        },
        {
            "authors": [
                "H. Zhang",
                "Ha",
                "D.-H",
                "R. Hovden",
                "L. Kourkoutis",
                "R. Robinson"
            ],
            "title": "Controlled synthesis of uniform cobalt phosphide hyperbranched nanocrystals using tri-n-octylphosphine oxide as a phosphorus source",
            "venue": "Nano Lett. 11,",
            "year": 2010
        },
        {
            "authors": [
                "W Xu"
            ],
            "title": "High-performance iterative electron tomography reconstruction with long-object compensation using graphics processing units (GPUs)",
            "venue": "J. Struct. Biol",
            "year": 2010
        },
        {
            "authors": [
                "E. Sidky",
                "X. Pan"
            ],
            "title": "Image reconstruction in circular cone-beam computed tomography by constrained, total-variation minimization",
            "venue": "Phys. Med. Biol",
            "year": 2018
        },
        {
            "authors": [
                "T. Sanders",
                "A. Gelb",
                "R. Platte",
                "I. Arslan",
                "K. Landskron"
            ],
            "title": "Recovering fine details from under-resolved electron tomography data using higher order total variation l1 regularization",
            "venue": "Ultramicroscopy 174,",
            "year": 2017
        },
        {
            "authors": [
                "Y Yang"
            ],
            "title": "Deciphering chemical order/disorder and material properties at the single-atom level",
            "venue": "Nature 542,",
            "year": 2017
        },
        {
            "authors": [
                "J. Schwartz",
                "H. Zheng",
                "M. Hanwell",
                "Y. Jiang",
                "R. Hovden"
            ],
            "title": "Dynamic compressed sensing for real-time tomographic reconstruction",
            "venue": "Ultramicroscopy 219,",
            "year": 2020
        },
        {
            "authors": [
                "Y. Jiang",
                "E. Padgett",
                "R. Hovden",
                "D.A. Muller"
            ],
            "title": "Sampling limits for electron tomography with sparsity-exploiting reconstructions",
            "venue": "Ultramicroscopy 186,",
            "year": 2018
        },
        {
            "authors": [
                "T. Elfving",
                "P.C. Hanser",
                "N. Touraj"
            ],
            "title": "Semi-convergence and relaxation paramters for a class of sirt algorithms",
            "venue": "Electron. Trans. Numer. Anal. 37,",
            "year": 2010
        },
        {
            "authors": [
                "T. Elfving",
                "N. Touraj",
                "P.C. Hanser"
            ],
            "title": "Semi-convergence properties of Kaczmarz\u2019s method",
            "venue": "Inverse Probl. 30,",
            "year": 2014
        },
        {
            "authors": [
                "R. Bracewell"
            ],
            "title": "Strip integration in radio astronomy",
            "venue": "Aust. J. Phys. 9,",
            "year": 1956
        },
        {
            "authors": [
                "Buurlage",
                "J.-W",
                "R. Bisseling",
                "J. Batenburg"
            ],
            "title": "A geometric partitioning method for distributed tomographic reconstruction",
            "venue": "Parallel Comput",
            "year": 2019
        },
        {
            "authors": [
                "J Schwartz"
            ],
            "title": "Real-time 3d analysis during tomographic experiments on tomviz",
            "venue": "Microsc. Microanal. 27(S1),",
            "year": 2021
        },
        {
            "authors": [
                "M.D. Hanwell",
                "K.M. Martin",
                "A. Chaudhary",
                "Avila",
                "L.S. The visualization toolkit (vtk"
            ],
            "title": "Rewriting the rendering code for modern graphics cards",
            "venue": "SoftwareX 1, 9\u201312",
            "year": 2015
        },
        {
            "authors": [
                "W Jiang"
            ],
            "title": "Emergence of complexity in hierarchically organized chiral particles",
            "venue": "Science",
            "year": 2020
        },
        {
            "authors": [
                "B Levin"
            ],
            "title": "Tutorial on the visualization of volumetric data using tomviz",
            "venue": "Microsc. Today",
            "year": 2018
        },
        {
            "authors": [
                "M Hanwell"
            ],
            "title": "Tomviz. https://github.com/OpenChemistry/ tomviz/tree/1.10.0 (2021)",
            "year": 2021
        },
        {
            "authors": [
                "B Levin"
            ],
            "title": "Nanomaterial datasets to advance tomography in scanning transmission electron microscopy",
            "venue": "Sci. Data",
            "year": 2016
        },
        {
            "authors": [
                "E Padgett"
            ],
            "title": "A simple preparation method for full-range electron tomography of nanoparticles and fine powders",
            "venue": "Microsc. Microanal",
            "year": 2017
        },
        {
            "authors": [
                "C. Meyer",
                "N. Dellby",
                "T. Lovejoy",
                "A. Mittelberger",
                "Krivanek",
                "O. Nion swift"
            ],
            "title": "open source image processing software for instrument control, data acquisition, organization, visualization, and analysis using python",
            "venue": "Microsc. Microanal. 25, 122\u2013123",
            "year": 2019
        },
        {
            "authors": [
                "D. Mastronarde"
            ],
            "title": "Automated electron microscope tomography using robust prediction of specimen movements",
            "venue": "J. Struct. Biol. 152,",
            "year": 2005
        },
        {
            "authors": [
                "T. Donath",
                "F. Beckmann",
                "A. Schreyer"
            ],
            "title": "Automated determination of the center of rotation in tomography data",
            "venue": "J. Opt. Soc. Am",
            "year": 2006
        },
        {
            "authors": [
                "T. Sanders",
                "M. Prange",
                "C. Akatay",
                "P. Binev"
            ],
            "title": "Physically motivated global alignment method for electron tomography",
            "venue": "Adv. Struct. Chem. Imaging 1,",
            "year": 2015
        },
        {
            "authors": [
                "F. Joachim",
                "B. McEwen"
            ],
            "title": "Alignment by Cross-Correlation 205\u2013213",
            "venue": "(Springer US,",
            "year": 1992
        },
        {
            "authors": [
                "J. Kremer",
                "D. Mastronarde"
            ],
            "title": "Computer visualization of threedimensional image data using imod",
            "venue": "J. Struct. Biol",
            "year": 1996
        },
        {
            "authors": [
                "M. Odstr\u010dil",
                "M. Holler",
                "J. Raabe",
                "G. Guizar-Sicairos"
            ],
            "title": "Alignment methods for nanotomography with deep subpixel accuracy",
            "venue": "Opt. Express",
            "year": 2019
        }
    ],
    "sections": [
        {
            "text": "nature communications\nArticle https://doi.org/10.1038/s41467-022-32046-0\nReal-time 3D analysis during electron tomography using tomviz\nJonathan Schwartz 1, Chris Harris2, Jacob Pietryga1, Huihuo Zheng3, Prashant Kumar 4, Anastasiia Visheratina4, Nicholas A. Kotov 4, BriannaMajor2, Patrick Avery 2, Peter Ercius 5, Utkarsh Ayachit2, BerkGeveci2, David A. Muller 6, Alessandro Genova2, Yi Jiang 7, Marcus Hanwell2,8 & Robert Hovden 1,9\nThe demand for high-throughput electron tomography is rapidly increasing in biological and material sciences. However, this 3D imaging technique is computationally bottlenecked by alignment and reconstruction which runs from hours to days. We demonstrate real-time tomography with dynamic 3D tomographic visualization to enable rapid interpretation of specimen structure immediately as data is collected on an electron microscope. Using geometrically complex chiral nanoparticles, we show volumetric interpretation can begin in less than 10minutes and a high-quality tomogram is available within 30minutes. Real-time tomography is integrated into tomviz, an opensource and cross-platform 3D data analysis tool that contains intuitive graphical user interfaces (GUI), to enable any scientist to characterize biological and material structure in 3D.\nThree-dimensional (3D) characterization across the nanoscale is now possible using scanning/transmission electron microscopes (S/ TEM)1\u20135. In an electron tomography experiment, the volumetric structure of biological or material specimens is reconstructed from high-resolution projection images acquired across many viewing angles6,7. Unfortunately, tomographic reconstructions can take one to several days to complete depending upon the dataset size or algorithm(s) employed. Evenworse, the reconstruction occurs offline, long after all the data has been collected, preventing immediate interpretation during an ongoing experiment. While advancements in detector hardware have boosted throughput with digital data collection8, substantial human effort and computational resources are still required to process the raw data before visualization. It has been a longstanding goal to begin 3D analysis of specimens in real time to allow immediate assessment of nanoscale structure and data quality9.\nHere we present facile 3D visualization of specimens during an electron or cryo-electron tomography experiment using the tomviz platform (tomviz.org). Our platform now provides interactive 3D material or biological structure in real-time to enhance highthroughput specimen interpretation. Tomviz offers multiple realtime reconstruction algorithms integrated into a fully graphical interface that presents the user with immediate visualization during data collection. Achieving high-throughput electron tomography requires an integrated pipeline that links the microscope hardware to optimized reconstruction algorithms and efficient 3D volumetric visualization. A multi-threaded data analysis pipeline runs dynamic visualizations that update as new data is collected or reconstruction algorithms proceed. Iterative reconstruction algorithms efficiently accommodate new data and keep pace with typical experimental acquisition rates. Scientists can interactively analyze 3D specimen structure concurrent with a tomographic reconstruction after or during an experiment. The robust graphical interface allows for 3D specimens to be rendered as shaded contours or translucent volumes that can be rotated, cropped, or sliced\nReceived: 28 November 2021\nAccepted: 15 July 2022\nCheck for updates\n1Department of Material Science and Engineering, University of Michigan, Ann Arbor, MI, USA. 2Kitware Inc, Clifton Park, NY, USA. 3Argonne Leadership Computing Facility, Argonne National Laboratory, Lemont, IL, USA. 4Department of Chemical Engineering, University of Michigan, Ann Arbor, MI, USA. 5The Molecular Foundry, Lawrence Berkeley National Laboratory, Berkeley, CA, USA. 6School of Applied and Engineering Physics, Cornell University, Ithaca, NY, USA. 7Advanced Photon Source, Argonne National Laboratory, Lemont, IL, USA. 8National Synchrotron Light Source II, Brookhaven National Laboratory, Upton, NY, USA. 9Applied Physics Program, University of Michigan, Ann Arbor, MI, USA. e-mail: hovden@umich.edu\nNature Communications | (2022) 13:4458 1\n12 34\n56 78\n9 0 () :,;\n12 34\n56 78\n9 0 () :,;\nas the reconstruction occurs. In favorable cases, structural interpretation can begin as early as 10min and a high-resolution volume is available after only 60% of data is acquired (~30min). The latest tomviz release (v 2.0) is now packagedwith real-time 3D analysis for electron tomography and is available as an open-source crossplatform tool with compiled binaries certified for Linux, Mac, and Windows."
        },
        {
            "heading": "Results",
            "text": ""
        },
        {
            "heading": "Real-time tomography workflow",
            "text": "The real-time tomography workflow is illustrated in Fig. 1: electron micrographs are collected, passed to tomviz for reconstruction, and visualized as an interactive 3D rendering. This process runs simultaneously and continuously while the electron microscope is being operated. During experimental acquisition, tomviz monitors when new projections are collected (Fig. 1a) and appends new data into the reconstruction process. Importantly, tomograms are reconstructed in parallel with data acquisition. Real-time algorithms accommodate the arrival of new data without restarting the reconstruction process. Iterative reconstruction methods are made efficient for real-time processes by utilizing dynamic descent parameters (see \u201cMethods\u201d). Dynamic reconstructions maintain pace with typical experimental acquisitions (e.g., 5123\u201310243 voxels) using a personal computer. The intermediate reconstructions are rendered in 3D and immediately presented to the scientist (Fig. 1b). Thus, the tomogram dynamically improves with time as both the reconstruction algorithm converges and additional specimen information arrives. High-quality 3D reconstructions are available before the end of the experiment (Fig. 1c).\nEarly insight into 3D structure Direct visualization of a specimen\u2019s 3D structure enables immediate identification ofmorphological and internal information shortly after a tomography experiment begins. We demonstrate real-time tomography on a helical nanoparticle comprised of a chiral dipeptide Cystine amino acid coordinated with Cadmium (Cyst/Cd) (Supplementary Videos S1, S2, and S7). The bowtie-shaped particles were synthesized using a size-limited self-assembly process described by Yan et al.10. These semiconducting nanoparticles contain strong tunable chiroptical properties due to a twisted geometry10. As shown in Fig. 1b, the overall morphology for the Cd/Cyst nanoparticle can be observed as early as 10min and fine details are visible after 20\u201330min of the experiment (roughly half-completion). The specimen\u2019s righthanded chirality cannot be determined from a single projection image and requires 3D imaging (Fig. 1c). With real-time tomography the material\u2019s chirality and symmetry were identified within the first third of data acquisition (~15min). This immediate feedback can save researchers days of effort as reconstructions are no longer processed offline. Moreover, real-time visualization allows quick adjustment and optimization of reconstruction parameters that can greatly influence the reconstruction quality. Ultimately, scientists can efficiently investigate 3D nanostructure during imaging to guide experiments and redefine scientific objectives while simultaneously operating the microscope.\nReal-time 3D visualization during reconstruction Currently, the best tomographic reconstructions are obtained from algorithms that are slow and iterative. In practice, electron tomography experiments are limited by a finite and restricted angular range\nNature Communications | (2022) 13:4458 2\n(e.g., <\u00b170\u00b0) resulting in incomplete information that degrades resolution in 3D11. Iterative algorithms can recover tomograms with high spatial resolution and minimal reconstruction error12. While these algorithms better estimate 3D structure from under-determined measurements, they come at the expense of computational time13. Fortunately, using the tomviz tool, iterative reconstructions can be visualized in real-time throughout the arduous computation (Supplementary Videos S2 and S3).\nReal-time tomography greatly alleviates the wait-time by visualizing the intermediate 3D structure between algorithm iterations\u2014 beneficial during an experiment or analysis. Figure 2 demonstrates interactive visualizations of the Simultaneous Iterative Reconstruction Technique (SIRT)14 for a cobalt phosphide (Co2P) hyperbranched nanoparticle15 (5123 voxels volume reconstructed across the 363.52nm full field of view). SIRT tomograms begin with a loose estimate16\n(Fig. 2a) and develop sharper, high-frequency information with each increasing iteration (Fig. 2b, c and Supplementary Video S4). Compressed sensing algorithms such as total variation minimization (TVmin) seek maximally sparse solutions to recover high-resolution, low-noise structures using fewer projections than conventional methods17,18. Figure 2e, f and Supplementary Video S5 demonstrates an interactive 3D visualization using TVmin reconstruction of an iron platinum (FePt) nanoparticle at atomic resolution (2563 voxels volume reconstructed across the 9.536 nm full field of view)\u2014data provided and pre-processed by Yang et al.19. This work replicates the atomic resolution tomogram using independent pre-processing and reconstruction methods. Recent developments in dynamic compressive sensing20 have also been incorporated into tomviz to accommodate the arrival of new projections during an experiment.\nIn addition to early estimates of specimen structure, real-time tomography allows assessment of the reconstruction convergence. This is observed qualitatively in the 3D visualization (Fig. 2e, f) and quantitatively plotted in the residuals (Fig. 2d, h). Watching the convergence provides visual inspection and intuition of how hyperparameters influence the final 3D structure and ensure proper convergence. For example, compressed-sensing-inspired reconstructionmethods are sensitive to regularization weights and require visual inspection to assess accuracy21. Furthermore, these advanced reconstruction algorithms do not exhibit predictable or monotonic convergence a priori and requiremonitoring to optimize convergence and determinewhen to terminate22,23. Even for traditional algorithmswhere convergence is more predictable, they are often slow and changes becomemarginal\u2014the scientist need not wait to begin interpreting the 3D structure. Lastly, practical issues such as misalignment, spurious values in data (e.g., hot pixels), in-plane rotations, and other preprocessing artifacts alter or degrade a reconstruction; however, these problems are diagnosable without completing a full reconstruction. Real-time assessment saves researchers time by providing early feedback and optimizing reconstruction parameters to serve the longstanding goal of high-throughput tomography.\nAlternatively, weighted back projection (WBP) reconstructions are ideal for quick assessment of specimen morphology due to their fast, non-iterative computation24,25. Figure 3 shows screenshots taken from a live WBP reconstruction visualized using tomviz\u2014time proceeds from left to right. Figure 3a is a tomogram of gold (Au) nanoparticles on strontium titanate (STO) nanocubes. Figure 3b shows platinum (Pt) nanoparticles on a carbon (C) support with the rotation axis along the x-direction. For WBP of single-axis tomography, partial volumetric updates are provided slice by slice along the direction parallel to the rotation axis. In the software, the 3D visualizations dynamically grow in one direction throughout the computation. Supplementary Video S6 shows the user experience of a WBP reconstruction emerging over just a few minutes."
        },
        {
            "heading": "The live tomography software",
            "text": "The latest tomviz release (v. 2.0) includes real-time tomography capabilities, is entirely open-source (BSD License), runs on all operating systems (OSX, Windows, Linux) with certified installers, and can be implemented on rudimentary TEMs available at most institutions. A user manual with step-by-step instructions for implementing real-time tomography is provided as a Supplementary Protocol along with Supplemental Videodemonstrations (Supplemental Videos S3 andS4).\nThe tomviz graphical user interface (GUI) (Fig. 4) provides an intuitive tomography tool that allows scientists to focus on 3D specimen interpretation26. Tomviz monitors data directories for the arrival of newprojections during anexperiment (Fig. 4a) and visualizes the 3D reconstruction as it dynamically updates (Fig. 4c). During a real-time tomographic reconstruction users can zoom, rotate, slice, and segment the object to highlight regions of interest as the algorithm runs independently. Each voxel in the 3D render (i.e., volumes or isometric\nNature Communications | (2022) 13:4458 3\ncontours) is assigned a color and opacity controlled by the coloropacity transfer function overlayed on the histogram visible at the top of the GUI (Fig. 4, top-right). Users can intuitively define voxel transparency by selecting points on the curve and dragging it between transparent and opaque. The data \u201cPipeline\u201d retains all transformations and modules performed to produce visualizations, all of which can be saved in a state file for sharing and reproducibility.\nA seamless user experience is enabled by an underlying multithreaded framework of Python/C++ interactions. As the reconstruction occurs, algorithms written in Python trigger signals to notify the application that a new volume is available (\u201cMethods\u201d). Tomographic reconstructions can either run on basic computer infrastructure found on any laptop or scaled acrossmultiple GPUs to process large volumes (>10243 voxels). Live reconstructions without performance degradation require a tripling ofmemory requirements. One data copy resides on the visualization (GUI) thread, another on the reconstruction (Python) thread, plus a temporary copy for efficient staging and handoff. The temporary copy allows the reconstruction to run unhindered during the handoff process. The total memory usage for realtime reconstruction is usually well within a consumer-grade computer (c.a. 0.4\u201316 GB). After the reconstruction is complete, all copies are released from memory and only the final reconstruction remains. Analytical reconstruction methods such as WBP can run slice-by-slice with new reconstructed slices appended along a single reconstruction direction. For iterative methods, we recommend updating the entire volume either every iteration or every few (depending on the speed of computation)\u2014especially for complex sampling schemes such as dual or multiple-axis tomography that lacks a single rotation axes. Enhancements to the underlying 3D rendering (VTK) within tomviz were made to improve interactive visualization and analysis throughout the reconstruction process27."
        },
        {
            "heading": "Discussion",
            "text": "We demonstrate real-time visualization of electron tomography reconstructions as they proceed during or after an experiment using tomviz, an open-source cross-platform tool compatible with all electron microscopes. We achieved real-time electron tomography by integrating dynamic volumetric data analysis tools, data input/output, processing, reconstruction, and visualization into a single software tool. In the actual software, the 3D visualizations are dynamically updated in parallel with computation. This means that scientists need not wait for reconstruction to complete, or all data to be collected\nbefore beginning the interpretation of results. Continuous feedback provides high-throughput and early diagnoses of 3D specimens, opportunities to optimize experimental parameters, or investigate multiple regions of interest. Although dose is fundamentally set by the experimental acquisition parameters (e.g., dwell time, beam current, sampling rate, or tilt increment), in practice real-time tomographymay reduce dose by streamlining acquisition and allowing the possibility of early termination if the reconstruction requirements are met. Optimized, threaded pipelines and the iterative nature of tomographic methods allow tomviz to show intermediate results with minimal impact on performance. This enables interactive 3D analysis of the current reconstruction state while the reconstruction proceeds on a separate thread. A robust graphical interface allows objects to be rendered as shaded contours or volumetric projections and these objects can be rotated, cropped, or sliced. This capability opens radically new possibilities for developing high-throughput, real-time tomographic reconstruction algorithms for geometrically complex inorganic28 or biological materials. Ultimately, interactive real-time visualization goes beyond high-throughput and allows researchers to make early judgments to answer or identify new scientific questions during experimentation."
        },
        {
            "heading": "Methods",
            "text": ""
        },
        {
            "heading": "Installing tomviz",
            "text": "Tomviz binary installers are available at tomviz.org for macOS, Linux, or Windows29. A user manual for real-time tomography using tomviz is provided as Supplemental Material."
        },
        {
            "heading": "Source-code availability",
            "text": "In addition to stable binary releases, the latest experimental builds and source code is available at github.com/OpenChemistry/tomviz. The entire package is built from 74,029 lines of code and 5253 merges to date30. The application is primarily developed in C++ using CMake to coordinate the build process. Algorithms for electron tomography are primarily written using Python to offer facile in-app readability and modification. The entire code-base and dependencies are open-source and compiled to maximize reproducibility."
        },
        {
            "heading": "License",
            "text": "Tomviz and its underlying tomography algorithms are developed openly and freely as open source software under the 3-clause BSD License31\u2014an Open Source Initiative approved license. This allows for\nNature Communications | (2022) 13:4458 4\nunrestricted academic, commercial, and government use with no obligation on the part of the licensee to distribute the source code. This license encourages the widest possible re-use of the source code."
        },
        {
            "heading": "Specimen synthesis and preparation",
            "text": "Cyst/Cd helical nanoparticles are self-assembled via electrostatic and coordination interactions between positively charged cadmium ions and negatively charged chiral dipeptide cystine. The helical nanoparticles were mixed in an aqueous solution and drop cast using amicropipet onto a 3mm copper TEM grid dried at room temperature. The TEM grid was an ultrathin (3 nm) carbon film with a large hexagonal mesh (100) to provide high specimen tilts without beam shadowing (Electron Microscopy Sciences, Hatfield, PA, USA). Specimen preparation for the Co2P, C/Pt\n32, FePt,19, and Au/ STO33 datasets are available in the cited manuscripts with data descriptors."
        },
        {
            "heading": "Electron tomography acquisition",
            "text": "Real-time electron tomography of the Cys/Cd helical nanoparticle (Fig. 1) was performed during experimental image acquisition on a Talos F200X (Thermo Fisher) operated at 200 kV with a 10.5 mrad semi-convergence angle using an annular dark field detector with an inner collection angle of 36mrad. The projections were recorded from \u221264\u00b0 to +71\u00b0 with a +1\u00b0 angular increment using a Model 2021 Fischione Analytical Tomography Holder. At each tilt angle, a STEM image with a 4 \u03bcs dwell time at each pixel of lateral dimension 2.47 nm. The tilt series for Figs. 2\u20134 were collected and aligned in advance of the real-time reconstruction. The FePt nanoparticle (Fig. 2f) was collected on a FEI Titan at 300 keV with a 30mrad convergence angle and 1.5\u00b0 tilt increment19. The Co2P (Fig. 2c), Au/ STO (Fig. 3a), and C/Pt (Fig. 3b)32 nanoparticles33 were acquired on a FEI Tecnai F20 at 200 keV and 2\u00b0, 2\u00b0, and 1\u00b0 tilt intervals, respectively. Additional experimental information is available in the corresponding references for each dataset.\nA user manual with step-by-step instructions for implementing real-time tomography is provided as a Supplementary Protocol along with supplemental video demonstrations. As with any tomography experiment, microscope alignment is critical. In particular, the sample should be eucentric to alleviate specimen drift and the need for any stage refinement during acquisition. After the microscope is aligned, a user defines the data directory tomviz will monitor to bridge the pipeline from data acquisition to the 3D reconstruction and visualization. Because tomviz operates independently from the microscope acquisition control, this real-time tomography tool can runon anyTEM and users can choose their preferred acquisition programs (e.g., Nion Swift34, Digital Micrograph, FEI Velox, SerialEM35)."
        },
        {
            "heading": "File formats",
            "text": "Data stored as raw binaries, XDMF, HDF5, text, png, SER, DM3/4, or TIFF can be read into tomviz. This includes 32-bit IEEE floats. Users can save visualizations and computations as statefiles (.tvsm) to reproduce results and be shared among colleagues. Reconstructions can be exported into file formats compatible with dedicated 3D rendering software (e.g., Blender)."
        },
        {
            "heading": "Data processing",
            "text": "Tomographic experiments require identification of the center of rotation in the projection tilt series; otherwise, artifacts will be introduced into the tomogram36. Even after aligning the stage to eucentricity, the rotation axis can be offset from center and often require additional processing. When an object is tilted around the rotation axis, the object\u2019s center of mass (CoM) forms a circle and coincides with the origin of the perpendicular axis. To determine the CoM, we projected each projection onto the perpendicular axis and calculated its shift: xCM=\u2211ixi\u03c1(xi)/\u2211i\u03c1(xi) where \u03c1(xi) is the Coulomb potential at position xi4. This method is known to be sensitive to noise, so prior to aligning the projections we performed a background subtraction to account for the sample support (lacey carbon) and increasing\nNature Communications | (2022) 13:4458 5\nthickness from high tilts. In our experiments, the uniform thin carbon support was removed by subtracting the average background scattered intensity.\nSuccessful tilt axis identification with the center of mass alignment requires the total projected volume to be fixed for each projection37 and objects to be isolated. In cases where either of these requirements are not met (e.g., slab specimen geometries or fields of view where multiple particles are visible), alternative alignment routines should be considered.We provide cross-correlation38 for aligning non-isolated objects (Supplementary Fig. S3). For those thatwould like to performmarker-based alignment, we suggest using IMOD39 prior to loading input projections in tomviz. Further tilt axis refinement can be selected with our automated identification script. More advanced iterative projection matching alignment routines can be utilized near the end of data collection to improve the tomogram resolution40.\nReal-time reconstruction algorithms during experimental acquisition Modifications to the common implementation for SIRT and TVmin weremade to account for the dynamic addition of input projections throughout an experiment. SIRT seeks the minimal error between the reconstruction and experimental data: argminx k Ax bk2 where A is the measurement matrix, b is the experimental projections, and x is the tomogram. We can further regularize the process through the assumption that our volumes should be piece-wise smooth and minimize its total variation \u2225x\u2225TV. Iterative algorithms require rescaling of the descent parameter based on the number of projections sampled. SIRT can easily estimate the descent parameter through the calculation of the Lipschitz constant (L = \u2225ATA\u22252). The Lispchitz constant can be estimated by using the power method41. The descent parameter for TVmin is scaled by a dampening envelope that ensures its magnitude decays linearly20. Noniterative algorithms such asWBP do not require rescaling of descent parameters and simply need to reinitialize the computation with the new projection images collected."
        },
        {
            "heading": "GUI parallelization for real-time visualization",
            "text": "The multithreaded pipeline within the tomviz application executes long-running jobswhile simultaneously offering real-time visualization of the progress. As the reconstruction occurs, algorithms written in Python can trigger signals to notify the application that a new volume is available. A slot on the C++ side listens for this signal, using a mutually exclusive lock (mutex) on the image data to secure access to the updated volume. The new data is copied into the foreground thread (main GUI), and once it is available the mutex is released. Once the application receives a signal indicating that the output has been updated, downstream data operations can then be re-executed and any connected visualizationmodules will also be notified. As an effect, the histogram is recalculated in another background thread while all the current visualizationmodules display the rendered representation. In the case of the contour module, this will necessitate the recalculation of the surface mesh or the update will be uploaded to the GPU for volume rendering."
        },
        {
            "heading": "Data availability",
            "text": "Figure 1 and the user manual use exemplary data from Supplemental Dataset 1. The aligned and raw tilt series for the FePt dataset in Fig. 2 can be accessed through physics.ucla.edu/research/imaging/FePt. In addition, the projection images for the Co2P and C-Pt nanoparticles displayed in Figs. 2 and 3 are available through doi.org/10.608432."
        },
        {
            "heading": "Code availability",
            "text": "Tomviz binaries are available as Supplementary Software and the source code can be downloaded from GitHub (github.com/ OpenChemistry/tomviz)."
        },
        {
            "heading": "Acknowledgements",
            "text": "R.H. and J.S. acknowledge support from the Army Research Office, Computing Sciences (W911NF-17-S-0002). The tomviz project began with support under DOE Office of Science contract DE-SC0011385. This research used resources of the Argonne Leadership Computing Facility, which is a DOEOffice of Science User Facility supported under Contract\nDE-AC02-06CH11357. P.E. is supported by the Molecular Foundry, Lawrence Berkeley National Laboratory, which is supported by the U.S. Department of Energy under contract no. DE-AC02-05CH11231. The authors thank Suk Hyun Sung and Yanqi Luo for input and feedback. Microscope illustration in Fig. 1 is released under creative commons license by Database Center for Life Science (DBCLS). This work made use of the Michigan Center for Materials Characterization (MC2) with technical support from Tao Ma and Bobby Kerns. The authors acknowledge financial support from the University of Michigan College of Engineering."
        },
        {
            "heading": "Author contributions",
            "text": "M.H. and R.H. conceived the idea. R.H., M.H., C.H., J.S., D.A.M., P.E., P.A., B.M., B.G., U.A., and A.G. designed tomviz\u2019s software and visualization architecture. J.S., J.P., Y.J., H.Z., and R.H. implemented real-time tomography algorithms. J.S., J.P., and R.H. conducted experiments. P.K., A.V., and N.A.K. synthesized Cyst/Cd nanoparticles. J.S. and R.H. wrote the manuscript. All authors reviewed and commented on the manuscript."
        },
        {
            "heading": "Competing interests",
            "text": "The authors declare no competing interests."
        },
        {
            "heading": "Additional information",
            "text": "Supplementary informationTheonline version contains supplementary material available at https://doi.org/10.1038/s41467-022-32046-0.\nCorrespondence and requests for materials should be addressed to Robert Hovden.\nPeer review information Nature Communications thanks the anonymous reviewers for their contribution to the peer review of this work. Peer reviewer reports are available.\nReprints and permission information is available at http://www.nature.com/reprints\nPublisher\u2019s note Springer Nature remains neutral with regard to jurisdictional claims in published maps and institutional affiliations.\nOpen Access This article is licensed under a Creative Commons Attribution 4.0 International License, which permits use, sharing, adaptation, distribution and reproduction in any medium or format, as long as you give appropriate credit to the original author(s) and the source, provide a link to the Creative Commons license, and indicate if changes were made. The images or other third party material in this article are included in the article\u2019s Creative Commons license, unless indicated otherwise in a credit line to the material. If material is not included in the article\u2019s Creative Commons license and your intended use is not permitted by statutory regulation or exceeds the permitted use, you will need to obtain permission directly from the copyright holder. To view a copy of this license, visit http://creativecommons.org/ licenses/by/4.0/.\n\u00a9 The Author(s) 2022\nNature Communications | (2022) 13:4458 7"
        }
    ],
    "title": "Real-time 3D analysis during electron tomography using tomviz",
    "year": 2022
}
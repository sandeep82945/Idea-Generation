{
    "abstractText": "Prebunching via echo\u2010enabled harmonic generation (EEHG) is an efficient way to reduce the radiator length and improve the longitudinal coherence as well as output stability in storage\u2010ring\u2010based free\u2010 electron lasers. We propose a conceptual design, which uses two straight sections to seed coherent extreme\u2010ultraviolet (EUV) and soft X\u2010ray emission with nearly MHz repetition rate. To take the large energy spread (10\u22123) of a storage ring into account and utilize the existing bending magnets between the two straight sections as the first chicane, we implement a special modeling tool, named EEHG optimizer. This tool has been successfully applied to maximize the prebunching with a reasonably low energy modulation, thereby generating intense coherent X\u2010ray pulses within a short undulator length (a few meters) limited by the available space of a storage ring. Numerical simulations confirm that the optimized EEHG parameters can be directly applied to generate a 10 MW scale peak power with fully coherent ultrafast EUV to soft X\u2010ray pulses based on the NSLS\u2010II parameters. This method can be easily extended to other types of diffraction\u2010limited storage rings.",
    "authors": [
        {
            "affiliations": [],
            "name": "X. Yang"
        },
        {
            "affiliations": [],
            "name": "G. Penn"
        },
        {
            "affiliations": [],
            "name": "L. H. Yu"
        },
        {
            "affiliations": [],
            "name": "V. Smaluk"
        },
        {
            "affiliations": [],
            "name": "T. Shaftan"
        }
    ],
    "id": "SP:4d6de627c4cafaad0dc57f1769146ba7a9035cd6",
    "references": [
        {
            "authors": [
                "L.H. Yu"
            ],
            "title": "Generation of intense UV radiation by subharmonically seeded single-pass free-electron lasers",
            "venue": "Phys. Rev. A 44,",
            "year": 1991
        },
        {
            "authors": [
                "L.H. Yu",
                "I. Ben-Zvi"
            ],
            "title": "High-gain harmonic generation of soft x-rays with the \u201cfresh bunch",
            "venue": "technique. Nucl. Instrum. Methods Phys. Res. Sect. A 393,",
            "year": 1997
        },
        {
            "authors": [
                "Yu",
                "L. H"
            ],
            "title": "High-gain harmonic-generation free-electron laser",
            "venue": "Science 289,",
            "year": 2000
        },
        {
            "authors": [
                "L.H. Yu",
                "T. Shaftan"
            ],
            "title": "Towards coherent X-ray free-electron lasers",
            "venue": "Nat. Photon",
            "year": 2019
        },
        {
            "authors": [
                "Mitri",
                "S. D"
            ],
            "title": "Bridging the gap of storage ring light sources and linac-driven free-electron lasers",
            "venue": "Phys. Rev. Accel. Beams",
            "year": 2021
        },
        {
            "authors": [
                "C Feng"
            ],
            "title": "Coherent extreme ultraviolet free-electron laser with echo-enabled harmonic generation",
            "venue": "Phys. Rev. Accel. Beams 22,",
            "year": 2019
        },
        {
            "authors": [
                "C. Feng",
                "Z. Zhao"
            ],
            "title": "A storage ring based free-electron laser for generating ultrashort coherent EUV and X-ray radiation",
            "venue": "Sci. Rep",
            "year": 2017
        },
        {
            "authors": [
                "G. Stupakov"
            ],
            "title": "Using the beam-echo effect for generation of short-wavelength radiation",
            "venue": "Phys. Rev. Lett. 102,",
            "year": 2009
        },
        {
            "authors": [
                "D. Xiang",
                "G. Stupakov"
            ],
            "title": "Echo-enabled harmonic generation free electron laser",
            "venue": "Phys. Rev. ST Accel. Beams 12,",
            "year": 2009
        },
        {
            "authors": [
                "S Khan"
            ],
            "title": "Generation of ultrashort and coherent synchrotron radiation pulses at DELTA",
            "venue": "Synchrotron Radiat. News 26,",
            "year": 2013
        },
        {
            "authors": [
                "P. Willmott"
            ],
            "title": "An Introduction to Synchrotron Radiation",
            "venue": "Techniques and Applications 2nd edn. (Wiley,",
            "year": 2019
        },
        {
            "authors": [
                "N Mille"
            ],
            "title": "Ptychography at the carbon K-edge",
            "venue": "Commun. Mater. 3,",
            "year": 2022
        },
        {
            "authors": [
                "H Stiel"
            ],
            "title": "Towards understanding excited-state properties of organic molecules using time-resolved soft X-ray absorption spectroscopy",
            "venue": "Int. J. Mol. Sci",
            "year": 2021
        },
        {
            "authors": [
                "F Segatta"
            ],
            "title": "Exploring the capabilities of optical pump X-ray probe NEXAFS spectroscopy to track photo-induced dynamics mediated by conical intersections",
            "venue": "Faraday Discuss",
            "year": 2020
        },
        {
            "authors": [
                "T. Shaftan",
                "V. Smaluk",
                "G. Wang"
            ],
            "title": "Concept of the Complex Bend",
            "venue": "NSLS-II Technical Note No",
            "year": 2018
        },
        {
            "authors": [
                "S. Henderson"
            ],
            "title": "Status of the APS upgrade project, in Proceedings of IPAC\u20102015, Richmond, VA, USA, 1791\u20131793",
            "venue": "TUPJE067 (JACoW, Geneva, Switzerland,",
            "year": 2015
        },
        {
            "authors": [
                "L. Liu",
                "X.R. Resende",
                "A.R.D. Rodrigues"
            ],
            "title": "Sirius (BR): A new Brazilian synchrotron light source, in Proceedings of IPAC\u20102016, Busan, Korea, 2811\u20132814",
            "venue": "WEPOW001 (JACoW, Geneva, Switzerland,",
            "year": 2010
        },
        {
            "authors": [
                "P.F. Tavares",
                "J. Bengtsson",
                "Andersson",
                "\u00c1. Future development plans for the MAX IV light source"
            ],
            "title": "Pushing further towards higher brightness and coherence",
            "venue": "J. Electron Spectrosc. Relat. Phenom. 224, 8",
            "year": 2018
        },
        {
            "authors": [
                "G. Penn",
                "M. Reinsch"
            ],
            "title": "Designs and numerical calculations for echo-enabled harmonic generation at very high harmonics",
            "venue": "J. Mod. Opt",
            "year": 2011
        },
        {
            "authors": [
                "G. Penn"
            ],
            "title": "Stable, coherent free-electron laser pulses using echo-enabled harmonic generation",
            "venue": "Phys. Rev. ST Accel. Beams 17,",
            "year": 2014
        },
        {
            "authors": [
                "L. Yu",
                "X. Yang",
                "T. Shaftan",
                "V. Smaluk",
                "Y. Li"
            ],
            "title": "Assessment of FEL options for NSLS-II upgrade, BNL LDRD",
            "year": 2022
        },
        {
            "authors": [
                "K. Halbach"
            ],
            "title": "Physical and optical properties of rare earth cobalt magnets",
            "venue": "Nucl. Instrum. Methods 187,",
            "year": 1981
        },
        {
            "authors": [
                "Reiche",
                "S. GENESIS 1.3"
            ],
            "title": "A fully 3D time-dependent FEL simulation code",
            "venue": "Nucl. Instrum. Methods Phys. Res. Sect. A 429, 243",
            "year": 1999
        },
        {
            "authors": [
                "O Chubar"
            ],
            "title": "https:// github. com/ ochub ar",
            "venue": "SRW",
            "year": 2013
        },
        {
            "authors": [
                "X Wang"
            ],
            "title": "Angular dispersion enhanced prebunch for seeding ultrashort and coherent EUV and soft X-ray free-electron laser in storage rings",
            "venue": "J. Synchrotron Rad",
            "year": 2019
        },
        {
            "authors": [
                "C Li"
            ],
            "title": "Lattice design for angular dispersion enhanced microbunching in storage rings",
            "venue": "JINST 16,",
            "year": 2021
        },
        {
            "authors": [
                "Nuhn",
                "H. D"
            ],
            "title": "Short wavelength FELs on large storage rings",
            "venue": "Nucl. Instrum. Methods A 319,",
            "year": 1992
        },
        {
            "authors": [
                "S.D. Mitri",
                "M. Cornacchia"
            ],
            "title": "Operating synchrotron light sources with a high gain free electron laser",
            "venue": "New J. Phys. 17,",
            "year": 2015
        }
    ],
    "sections": [
        {
            "text": "1 Vol.:(0123456789) Scientific Reports | (2022) 12:9437 | https://doi.org/10.1038/s41598-022-13702-3\nwww.nature.com/scientificreports"
        },
        {
            "heading": "Optimization of echo\u2011enabled",
            "text": "harmonic generation toward coherent EUV and soft"
        },
        {
            "heading": "X\u2011ray free\u2011electron laser at NSLS\u2011II",
            "text": "X. Yang1*, G. Penn2*, L. H. Yu1, V. Smaluk1 & T. Shaftan1\nPrebunching via echo\u2011enabled harmonic generation (EEHG) is an efficient way to reduce the radiator length and improve the longitudinal coherence as well as output stability in storage\u2011ring\u2011based free\u2011 electron lasers. We propose a conceptual design, which uses two straight sections to seed coherent extreme\u2011ultraviolet (EUV) and soft X\u2011ray emission with nearly MHz repetition rate. To take the large energy spread (10\u22123) of a storage ring into account and utilize the existing bending magnets between the two straight sections as the first chicane, we implement a special modeling tool, named EEHG optimizer. This tool has been successfully applied to maximize the prebunching with a reasonably low energy modulation, thereby generating intense coherent X\u2011ray pulses within a short undulator length (a few meters) limited by the available space of a storage ring. Numerical simulations confirm that the optimized EEHG parameters can be directly applied to generate a 10 MW scale peak power with fully coherent ultrafast EUV to soft X\u2011ray pulses based on the NSLS\u2011II parameters. This method can be easily extended to other types of diffraction\u2011limited storage rings.\nCompared to conventional high-gain harmonic generation (HGHG)1\u20134, the echo-enabled harmonic generation (EEHG) scheme is significantly less sensitive to energy spread, which is typically large in storage rings. Recently, to overcome such large energy spread, the use of transverse gradient undulators (TGUs) has been proposed for a high-gain short wavelength FEL driven by a diffraction-limited synchrotron light source5; however, this approach requires bunches to be diverted into an additional ring with its own rf cavities. Since the EEHG seeding option requires no change of the storage ring lattice and is fully compatible with other beamlines, the compact design currently studied could enable synchrotron light source based free-electron lasers (FELs) to produce intense coherent radiation pulses with short durations6\u201311. Such fully coherent ultrafast photon pulses up to the carbon K-edge offers unique opportunities to conduct high resolution spectroscopy on organic materials that are important in environmental science, medicine, biology, and bio-renewable energy materials12. Also, extending the pump-probe approach known from ultraviolet/visible spectroscopy to shorter wavelengths allows detailed studies of excited-state dynamics in organic molecules or biomolecular structures on a nanosecond to femtosecond time scale. Optical pump soft X-ray probe spectroscopy is a relatively new approach to detect and characterize optically dark states in organic molecules, to explore exciton dynamics, or to observe transient charge transfer states. Recent developments on extreme-ultraviolet (EUV) and soft X-ray sources based on EEHG storage-ring FELs open new opportunities for studying excited-state dynamics in organic molecules, together with the tremendous increase of computing power, allows understanding the excited-stage behavior even of very complex organic molecules in more detail13,14.\nDriven by those scientific applications, the implementations of EEHG at the NSLS-II and the future diffraction-limited upgrade (NSLS-IIU)15 are presently studied as an option to improve the longitudinal coherence and output stability, toward fully coherent storage ring-based FELs. To take the unique challenge and characteristic of storage-ring-based EEHG FELs into account, we have developed a modeling tool, named EEHG optimizer. This toolkit has been successfully applied to the NSLS-II storage ring with an up to two orders of magnitude improvement of the spectral brightness regarding the 12\u00a0nm wavelength. This scheme can be easily extended to any other type of 4th generation diffraction-limited storage ring15\u201320.\nOPEN\n1National Synchrotron Light Source II, Brookhaven National Laboratory, Upton, NY 11973, USA. 2Lawrence Berkeley National Laboratory, Berkeley, CA 94720, USA. *email: xiyang@bnl.gov; gepenn@lbl.gov\n2 Vol:.(1234567890) Scientific Reports | (2022) 12:9437 | https://doi.org/10.1038/s41598-022-13702-3"
        },
        {
            "heading": "Results",
            "text": "Development of storage\u2011ring\u2011based EEHG optimizer. Tuning echo parameters. Starting with two seed lasers, we aim to produce a large harmonic through EEHG21,22. There are two modulation stages, each followed by a chicane or a dogleg23. These stages are labeled as 1 and 2. In a storage-ring-based EEHG seeding scheme, since the first chicane is determined by the bending magnets (BM) between two straight sections, it is convenient to take the momentum compaction R56 as a fixed quantity23, denoted R1 . Here, the momentum compaction, defined as the derivative of normalized path length difference to normalized momentum ( pL dL dp ), is a measure of the momentum dependence of path length23. The convention used here is that a typical chicane of four bend magnets has a negative value of R56 . The second parameter to choose is the energy modulation of the first stage, \u03b7M1 . It may also be characterized by its value relative to the energy spread (see below). Fixing a different parameter such as the second R56 involves coupling with other parameters and is difficult to select an optimal value without detailed analysis.\nThe output wavelength, r , is also an important criterion since it can result from microbunching at that wavelength or a sub-harmonic. Together with the wavelengths of external lasers and thus the modulations, these choices will determine the parameters in stage 2, with two possible solutions (see \u201cAppling optimizer to NSLS-II\u201d section). Given the external laser wavelength 1 and 2 , the output wavelength ideally has the form:\nwhere k1,2 = 2\u03c0/ 1,2 , and m and p must be integers. Usually, we assume 1 , 2 , and thus r are integer harmonics of a single wavelength, although it may not matter too much in either way. This constrains the choices of possible output wavelengths. Often m is small, so p \u226b 1 roughly determines the wavelength. We can treat m as an additional choice (or knob) related to the dominant wavelength of the bunched beam, which is close to m \u00b7 r . The other main parameter is the energy spread, \u03c3\u03b7 , which is fixed in a storage-ring-based FEL (e.g., 10\u22123 for NSLS-II) by the equilibrium between radiation damping and energy diffusion.\nAppling optimizer to NSLS\u2011II. Based upon the procedures described in \u201cMethod\u201d section, we have implemented an EEHG optimizer for the purpose of tuning all important parameters toward the ideal performance of an EEHG beamline in a synchrotron light source.\nTo cover the soft X-ray spectrum up to the carbon K-edge (4.13\u201312.4\u00a0nm), the harmonics of EEHG regarding the wavelength of stage 1, 1 = 800\u00a0nm, should be optimized in the range of 65\u2013191. As example, we apply our newly developed storage-ring-based EEHG optimizer to the NSLS-II lattice. Since the EEHG layout will be discussed in \u201cDesiging an EEHG FEL in a synchrotron light source\u201d section with greater detail, we only show the maximum bunching (b), the final root mean square (RMS) energy spread (\u2206Etot), the C parameter (defined by Eq.\u00a05 in \u201cMethod\u201d section), the optimal momentum compaction of chicane 2 with an opposite sign (\u2212 R2), the powers of laser 1 (Plaser1) and laser 2 (Plaser2) as functions of the harmonic (y axis) and the energy modulation of stage 1 (x axis) as the contour plots in Fig.\u00a01a\u2013f, respectively. The C parameter decreases with the increase of the modulation amplitude and is about two orders of magnitude smaller than the two terms, krR2 and k1R1 , which are around 7.5 \u00d7 104. The reasons why we choose the harmonic and the energy modulation of stage 1 as the input variables are:\n\u2022 Once the harmonic, the momentum compaction of chicane 1 ( R1 ), and the energy modulation of stage 1 ( A1 ) are fixed, the Bessel functions with the maximal values of the bunching determine the optimal values of the momentum compaction of chicane 2 and the energy modulation of stage 2. \u2022 The momentum compaction of chicane 1 is fixed by the momentum compaction of the storage ring lattice. \u2022 The upper and lower limits of harmonics are determined by the user interested spectrum. \u2022 The energy modulation of stage 1 must be optimized for maximum coherent radiation (CR) power. The goal\ncan be achieved via maximizing the prebunching as well as mitigating the de-bunching effect through the radiator (see \u201cSimulation for generating intense EUV and soft X-ray radiation\u201d section for details).\nPrebunching produced by EEHG is quite different from that produced from HGHG1\u20134. From harmonic 65 to harmonic 191, only about 30% decrease in the bunching factor is observed, as shown in Fig.\u00a01g. There is still a significant amount of bunching (0.08) at harmonic 191 with A1 = 5 . From Fig.\u00a01h, we see that the maximal value of the bunching increases linearly with A1 when A1 is smaller than 2. When A1 becomes larger than 3, the growth of maximal values slows down. This feature turns the storage-ring-based EEHG application into an attractive option via improving the longitudinal coherence with a moderate energy modulation. A small energy modulation is desired since the relative energy spread of a storage ring is a few to ten times larger compared to\n(1)kr = p \u00b7 k1 +m \u00b7 k2\nFigure\u00a01. (a) The maximum bunching, (b) the final RMS energy spread, (c) the C parameter defined by Eq.\u00a05 in \u201cMethod\u201d section, (d) the optimal momentum compaction of chicane 2, (e) the powers of laser 1 and (f) laser 2 as functions of the harmonic (y axis) and the energy modulation of stage 1 (x axis) are shown as contours, respectively. R2 of chicane 2 should have the opposite sign relative to R1 of chicane 1, which is + 9.6\u00a0mm, hence, we plot the absolute value of R2. (g) Maximum bunching versus harmonic number is plotted for two cases: A1 = 1 (black) and A1 = 5 (red). (h) Maximum bunching versus modulation amplitude of stage 1 is plotted for two cases: harmonic 65 (red) and 191 (black). (i) With a fixed A1 = 3 and R1 = +9.6\u00a0mm at harmonic 67, prebunching as functions of the energy modulation of stage 2 ( A2 ) and the momentum compaction of chicane 2 ( R2 ) is shown as the contour plot. It is evident that there are two optimal solutions with slightly different values of R2 and A2. \u25b8\n3 Vol.:(0123456789) Scientific Reports | (2022) 12:9437 | https://doi.org/10.1038/s41598-022-13702-3\n4 Vol:.(1234567890) Scientific Reports | (2022) 12:9437 | https://doi.org/10.1038/s41598-022-13702-3\n10\u22124 often associated with linear-based accelerators. It is evident that there are two optimal solutions with the same bunching but slightly different values of R2 and A2 , as shown in Fig.\u00a01i.\nDesiging an EEHG FEL in a synchrotron light source. Design strategy. EEHG scheme enables the possibility for synchrotron light source based FELs to produce intense CR pulses with short durations. To achieve fully coherent storage ring-based FELs15,24,25, the implementations of EEHG at the NSLS-II and the future upgrade diffraction-limited NSLS-IIU are presently studied. We plan to use two straight sections for seeding the coherent EUV and soft X-ray emission at the repetition rate up to MHz.\nThere are a few important issues associated with the design of the EEHG beamline in the NSLS-II case25. They are:\n\u2022 BM section between two straight sections provides the momentum compaction R1 of the first chicane with + 9.6\u00a0mm. \u2022 Modulation stage 1 and 2 must be separated by the BM section between the two straight sections. \u2022 To maximize the CR power, the radiator needs to be positioned in the short straight section where the beta\nfunctions are small, hence the beam sizes are small. \u2022 Large energy spread in RMS (10\u22123) limits the highest harmonic (e.g., 191 for carbon K-edge at 4.13\u00a0nm). \u2022 The wavelength of laser 1 is fixed to 800\u00a0nm. \u2022 The wavelength of laser 2 (\u03bb2 = 400\u00a0nm) is chosen to be the second harmonic of laser 1. \u2022 Selecting different parts of an electron bunch may extend the repetition rate from ~ 10\u00a0kHz up to 1\u00a0MHz.\nComparing \u03bb2 = 400\u00a0nm with \u03bb2 = 800\u00a0nm, the modulation amplitude of stage 2 can be reduced to half while keeping the same bunching factor regarding a specific harmonic. This can greatly benefit prebunching at high harmonics, with less energy modulation, thus, less beam heating. Also, repetition rate can surpass the limit that is set by the radiation damping time of a storage ring, ~ 10\u00a0ms for the NSLS-II25. The original 10\u00a0kHz repetition rate (1/10\u00a0ms \u00d7 100 bunches/turn) can be increased by a factor up to 100, which is approximately determined by the ratio of the electron bunch length and the modulated slice duration.\nFor this wavelength range, wake fields and stochastic energy scatter should not significantly impact the achieved bunching parameter.\nDesign of EEHG beamline. A schematic layout of the EEHG beamline at the NSLS-II storage ring is shown in Fig.\u00a02. Stage 1, including modulator 1 and laser 1, is positioned downstream of the long straight section. Instead, stage 2, including modulator 2, laser 2, and chicane 2, locates upstream of the short straight section. The radiator is positioned downstream of the short straight section. The resonant wavelengths for modulator 1 and modulator 2 are 800\u00a0nm and 400\u00a0nm, respectively. The resonant wavelength of the radiator must cover the entire spectral range up to the carbon K-edge, from 4.13 to 12.4\u00a0nm, via varying the undulator gap.\nThe required seed laser power scales as the square of energy modulation amplitude and beam size, and the inverse square of undulator K parameter and length. To minimize the seed laser power of stage 2, the modulator 2 will be placed in the short straight section where the beta functions are small. The short straight section has a limited usable space, around 5\u00a0m, and will be occupied by three main elements of the EEHG beamline, including\nFigure\u00a02. Schematic layout of EEHG at NSLS-II. Horizontal and vertical beta functions are plotted as the blue and the green curves, respectively. Horizontal dispersion is plotted as the red curve of the secondary y axis.\n5 Vol.:(0123456789) Scientific Reports | (2022) 12:9437 | https://doi.org/10.1038/s41598-022-13702-3\nmodulator 2, chicane 2, and the radiator. The magnetic field as a function of the undulator gap for a permanent magnet undulator (PMU) is given by\nwhere M = 4 is the number of magnets per period, hB(5 cm) is the height of magnets, and Bmax is the maximum B field26. The K parameter as a function of the gap is given by\nThe EEHG beamline parameters are listed in Table\u00a01. The turnabilities of the minimum and maximum wavelengths are set by the maximum and minimum allowed undulator gaps, respectively. To avoid the radiation damage, the maximum B field is limited to be less than 1.3T . For the radiator with the period of 6.4\u00a0cm and the maximum B field of 0.90T , the gap can be allowed to vary in the range of 6\u201350\u00a0mm. The vertical red line with arrow ends in Fig.\u00a03a indicates the entire spectrum of the carbon K-edge. K parameter versus gap is shown in Fig.\u00a03b. To cover the wavelength range of 4.13\u201312.4\u00a0nm, the gap needs to be varied in the range of 20.9 down to 8.5\u00a0mm, corresponding to K values of 3.50 and 6.38, respectively.\nSimulation for generating intense EUV and soft X\u2011ray radiation. One expects that a smaller energy modulation becomes more critical for long undulators. A small energy modulation begins with a low energy spread as well as a small prebunching. The radiation power and the bunching are continuously growing through the undulator, eventually reaching the saturation power determined by the FEL Pierce parameter. Instead, a large energy modulation is often associated with a large prebunching, hence, allows a much faster growth of the CR power, even within a short undulator distance (e.g., a few meters). This is the case of the storage-ring-based EEHG FEL. The radiator length is limited to be \u2264 3.5\u00a0m in the NSLS-II.\n(2)B0 ( gap, u,Bmax ,M, hB ) = 2 \u00b7 Bmax \u00b7 M\n\u03c0 \u00b7 sin\n( \u03c0\nM\n)\n\u00b7\n(\n1\u2212 e \u22122\u00b7\u03c0 \u00b7hB u\n)\n\u00b7 e \u2212\u03c0 \u00b7gap u ,\n(3)K ( gap, u,Bmax ) = B0 ( gap, u,Bmax ,M, hB ) \u00b7 (e0 \u00b7 u)\n2 \u00b7 \u03c0 \u00b7 (m0c) .\nEelement Period Length unit Bmax (T)\nGap (mm) Resonant wavelength (nm) K (T\u2219cm)\nmin max operation min max operation min max operation\nMOD1 64 256 cm 0.34 17.3 800 13.05\nMOD2 20 100 cm 0.9 24.0 400 16.55\nRadiator 6.4 352 cm 0.9 8.5 21 [8.5 21] 4.13 12.4 [4.13 12.4] 3.5 6.38 [3.5 6.38]\nFigure\u00a03. For the radiator with the period of 6.4\u00a0cm and the maximum B field of 0.90\u00a0T, the gap can be varied in the range of the minimum 6\u00a0mm to the maximum 50\u00a0mm. (a) (left) Wavelength versus undulator period is plotted with the minimum gap (upper blue line) and the maximum gap (lower blue line). The wavelength in the range of [4.13 12.4] nm determines the optimum period of 6.4\u00a0cm. (b) (right) Modulator K parameter versus gap. The radiation wavelengths ([4.13 12.4]) nm corresponds to the gap between 20.9 and 8.5\u00a0mm and the K parameter between 3.5 and 6.4.\n6 Vol:.(1234567890) Scientific Reports | (2022) 12:9437 | https://doi.org/10.1038/s41598-022-13702-3\nThe purpose of optimization becomes searching an optimal energy modulation, which provides the fastest growth of the CR power and simultaneously mitigates the effect of the rapid de-bunching induced by the large energy spread ( \u223c 2 \u00b7 Nu \u00b7 EtotE \u2248 2 \u00b7 3.52m 0.064m \u00b7 2\u00d7 10\n\u22123 \u2248 0.2 for the nominal energy modulation). Here, Nu refers to the number of undulator periods in the radiation stage. The optimal energy modulations depend on the harmonics; thus, we apply the optimization to the low (67) and high (183) harmonics. One expects that the optimal energy modulations of other harmonics should be bounded between the results of these two harmonics.\nGENESIS simulations are applied to the optimization process27. The input parameter to the EEHG optimizer is the targeted harmonic number. Then, the beamline parameters, A1,2 and R2 , are predicted by the EEHG optimizer. Other parameters, 1,2 and R1 , are fixed. A 6D phase space distribution with the longitudinally bunched and transversely matched beam profile are generated as the GENESIS input. The transverse profile of the electron beam is determined by the NSLS-II lattice parameters in the short straight section, as shown in Table\u00a02.\nSimulation of harmonic 67. For the case of harmonic 67, the scaled energy modulation of stage 1 has been varied from 0.667 to 5.000. The evolutions of the peak power and the bunching factor through the undulator are plotted in Fig.\u00a04a and b, respectively. One extreme is to start with a large initial bunching but at the expense of the large energy spread induced fast de-bunching, hence, less CR gain at the exit of the undulator. The other extreme is to begin with a small initial bunching that slowly increases through the undulator. In-between these two cases, there is an optimal initial energy modulation of stage 1, which is around A1 = 3.00 . The maximum bunching is achieved near the middle point of the undular length. Such optimized initial bunching allows a reasonably fast growth of the CR power as well as the bunching factor till the middle point of the undulator, then, the de-bunching process is mitigated and only mildly slows down the CR growth in the rest of the undulator, shown in Fig.\u00a04a as the purple dashed line. The longitudinal phase spaces regarding these energy modulations of stage 1 with the values from 0.667 to 5.000 are shown in Fig.\u00a05a\u2013h, respectively. The final effective RMS energy spread, maximal bunching, momentum compaction of chicane 2, and energy modulation of stage 2 as a function of the energy modulation of stage 1 are plotted in Fig.\u00a06a\u2013d, respectively. From Fig.\u00a06a, the optimal energy modulation A1 = 3 brings 130% increase of the energy spread for the modulated beam slice. We will discuss how this increased slice energy spread influences other beamline experiments in \u201cRequired mode for EEHG\u201d section.\nSimulation of harmonic 183. Similarly, for the case of harmonic 183, the energy modulation of stage 1 has been varied among the values from 0.667 to 5.000. Peak power and prebunching evolving through the undulator distance are plotted in Fig.\u00a07a and b, respectively. The longitudinal phase spaces corresponding to the energy modulations of stage 1 with the values from 0.667 to 5.000 are plotted in Fig.\u00a08a\u2013h, respectively. The final effec-\nRelative energy spread \u03c3E/E\nBeam energy E (MeV)\nEnergy spread \u03c3E (MeV)\nx emittance \u03b5x (m rad) y emittance \u03b5y (m rad) Ipeak (A) \u03b2x (m) \u03b1x \u03b2y (m) \u03b1y Radiator period \u03bbu (cm)\n0.001 3000 3 5.87 \u00d7 10\u22126 5.87 \u00d7 10\u22128 300 3.77 0 4.20 0 6.40\nFigure\u00a04. For the case of harmonic 67, the energy modulation of stage 1 is scanned with the values of 0.667 (red), 1.000 (magenta), 1.333 (orange), 1.667 (green), 2.000 (grey), 3.000 (purple), 4.000 (cyan), and 5.000 (blue). (a) Peak power versus undulator position. (b) Bunching factor versus undulator position.\n7 Vol.:(0123456789) Scientific Reports | (2022) 12:9437 | https://doi.org/10.1038/s41598-022-13702-3\ntive RMS energy spread, maximal bunching, momentum compaction of chicane 2, and energy modulation of stage 2 as a function of the energy modulation of stage 1 are plotted in Fig.\u00a09a\u2013d, respectively. The optimal energy modulation of stage 1 happens at A1 = 2.00 , which causes 95% increase of the energy spread for the modulated beam slice. As one expects, shorter the radiator wavelength is, less tolerance the de-bunching process has.\nStudies of energy spread induced de\u2011bunching. Usually, the energy modulation and the initial bunching factor are correlated. A higher energy modulation yields a higher initial bunching, but at the cost of a worse de-bunching effect. To solely study the energy spread induced de-bunching effect, we deliberately vary the effective energy spread while keeping the initial bunching constant. Larger initial energy spread causes faster de-bunching, which limits the CR power at the exit of the radiator. Higher harmonics usually require smaller energy modulation for\nFigure\u00a05. Longitudinal phase spaces corresponding to the energy modulations of stage 1 with the values of 0.667 (a), 1.000 (b), 1.333 (c), 1.667 (d), 2.000 (e), 3.000 (f), 4.000 (g), and 5.000 (h) are plotted respectively.\nFigure\u00a06. (a) The final effective RMS energy spread, (b) the maximal bunching, (c) the momentum compaction of chicane 2, and (d) the energy modulation of stage 2 as a function of the energy modulation of stage 1 are plotted, respectively.\n8 Vol:.(1234567890) Scientific Reports | (2022) 12:9437 | https://doi.org/10.1038/s41598-022-13702-3\na fixed undulator length. As one expects, the de-bunching becomes faster with the increase of the initial energy modulation. The optimal energy modulation happens while the maximum bunching is achieved in the middle point of the undulator length, shown as the red curves in Fig.\u00a010a and b. Because the undulator is short and the initial bunching is substantial, FEL gain is not a concern and even higher harmonics can be produced until the de-bunching effect becomes strong for a length scale of about one meter.\nLaser power and CR properties. The required powers of laser 1 and laser 2 as functions of the harmonic number and the energy modulation of stage 1 are shown as the contour plots in Fig.\u00a01e and f, respectively. Those required maximal laser powers, a few GW and ten GW regarding laser 1 and 2, can be achieved with the current laser technologies.\nFigure\u00a07. For the case of harmonic 183, the energy modulation of stage 1 is scanned with the values of 0.667 (red), 1.000 (magenta), 1.333 (orange), 1.667 (green), 2.000 (grey), 3.000 (purple), 4.000 (cyan), and 5.000 (blue). (a) Peak power versus undulator position. (b) Bunching versus undulator position.\nFigure\u00a08. Longitudinal phase spaces corresponding to the energy modulations of stage 1 with the values of 0.667 (a), 1.000 (b), 1.333 (c), 1.667 (d), 2.000 (e), 3.000 (f), 4.000 (g), and 5.000 (h) are plotted.\n9 Vol.:(0123456789) Scientific Reports | (2022) 12:9437 | https://doi.org/10.1038/s41598-022-13702-3\nThe CR is estimated for the shorter and longer wavelengths of carbon K-edge, 4.37\u00a0nm, and 11.94\u00a0nm, including the peak power, the number of photons per pulse, and the RMS spectral bandwidth regarding three different pulse durations in RMS, 0.43\u00a0ps, 0.85\u00a0ps, and 1.23\u00a0ps. For each case, those output properties are estimated in two different radiator lengths, 2.5\u00a0m, and 3.5\u00a0m, as shown in Table\u00a03.\nFor the case of 3.5\u00a0m long radiator and 0.85\u00a0ps pulse duration, the maximum number of photons per pulse is 1.8 \u00d7 1012 regarding 11.9\u00a0nm. The repetition rate can be up to 1\u00a0MHz, hence, the correspond spectral brightness is 1.3 \u00d7 1021, which is more than two orders of magnitude higher than the current brightest source U (100) PMU (~ 1.1 \u00d7 1019) at the NSLS-II28,29.\nRequired mode for EEHG. The EEHG scheme requires that the NSLS-II storage ring is operated at an alternative mode with one hundred 5\u00a0mA electron bunches, equally spaced around the ring. Such a 5-mA electron bunch has the RMS bunch length > 20\u00a0ps, thus, the modulated slice only occupies a few percent of the entire bunch. Besides, the modulation only causes a local energy spread increase in the level of around 100%. One expects that the EEHG influences all other beamlines on the spectral brightness and the photon flux at the level of a few percent or less (this has been confirmed by Synchrotron Radiation Workshop simulations)30, hence, most beamlines can simultaneously operate in this EEHG mode.\nFigure\u00a09. (a) The final effective RMS energy spread, (b) the maximal bunching, (c) the momentum compaction of chicane 2, and (d) the energy modulation of stage 2 as a function of the energy modulation of stage 1 are plotted, respectively.\nFigure\u00a010. The energy modulation of stage 1 is scanned among the values of 2 (red), 3 (magenta), 4 (green), and 5 (grey) while the initial bunching is kept constant. (a) Peak power versus undulator position. (b) Bunching versus undulator position.\n10\nVol:.(1234567890)\nScientific Reports | (2022) 12:9437 | https://doi.org/10.1038/s41598-022-13702-3"
        },
        {
            "heading": "Method",
            "text": "Implementing EEHG optimizer with ideal performance. After m is chosen (usually to be \u2212 1)8,9, setting the parameters is comparatively straightforward. The EEHG process produces microbunching at many different wavelengths, but wavelengths corresponding to different m are either far apart or yield negligible bunching at nearby harmonics. Thus, only one m for a given optimized configuration needs to be considered.\nThe ideal bunching at a given wavelength is br = < exp(\u2212ickr t) > , and is given by\nwhere\nR1 and R2 are the two momentum compactions, and \u03b7M1 and \u03b7M2 are the amplitudes of the two energy modulations. This assumes an initial Gaussian energy distribution.\nWhen \u03b7M1 \u226b \u03c3\u03b7 , the bunching has an optimal value of |br | = \u2223 \u2223 \u2223 Jp ( \u00b1j \u2032\np,1\n)\nJm\n(\n\u00b1j\u0302m,1\n)\u2223\n\u2223 \u2223 , where the arguments\nof the Bessel functions give the maximum values. Defining A1,2 = \u03b7M1,2/\u03c3\u03b7 , when A1 is reduced and the exponential damping terms becomes relevant, the optimum bunch is given by\nwhere j\u2032p,1 is the location of the first maximum of the Bessel function Jp . A rough estimate for j\u0302 is given by\nA good asymptotic expansion for large values of p is\nFor the lowest indices (e.g., p \u2264 10 ), it is better to just use a table of values for j\u2032p,1 , and the optimal settings can also be calculated directly.\nThe final energy spread can approximately be given by\nTo make EEHG effective, the value of C should be much smaller than the two terms krR2 and k1R1 (see Fig.\u00a01c in \u201cAppling optimizer to NSLS-II\u201d section). This is equivalent to requiring that \u03b7M1k1R1 \u226b 1 . There are two distinct solutions that generate the same bunching, since C can either be positive or negative, and either choice yields the same bunching (see Fig.\u00a01i in \u201cAppling optimizer to NSLS-II\u201d section). This is true even when all dispersive sections have the normal sign for R56 . Comparing the form of optimization, we find C = \u00b1\nj\u0302 \u03b7M1 , which implies\nThe two optimal solutions have slightly different values for R2 and A2 . The first term in R2 is going to be small, so R2 \u2248 \u2212mk1R1kr ; however, such small correction cannot be ignored when evaluating C.\n(4)br = Jp(krR2\u03b7M2) \u00b7 Jm(C\u03b7M1) \u00b7 exp ( \u22121\n2 C2\u03c3 2\u03b7\n)\n,\n(5)C = krR2 +mk1R1.\n(6)|br | =\n\u2223\n\u2223\n\u2223\n\u2223\n\u2223\nJp\n(\n\u00b1j \u2032\np,1\n)\nJm\n( \u00b1j\u0302 ) exp\n(\n\u22121\n2\nj\u03022\nA21\n)\u2223\n\u2223\n\u2223\n\u2223\n\u2223\n,\n(7) j\u0302 \u223c=\nj \u2032\nm,1\n1+ \u03c3 2\u03b7\n\u03b72M1\n[\n1\u2212\n(\nm\nj \u2032 m,1\n)2 ]\u22121\n.\n(8)j \u2032 p,1 \u223c= p+ 0.80861 \u00b7 p1/3 + 0.07249 \u00b7 p\u22121/3 \u2212 0.05097 \u00b7 p\u22121.\n(9)\u03c3 2\u03b7f = \u03c3 2 \u03b7 +\n1 2 A21 + 1 2 A22.\n(10) R2 =\nC \u2212mk1R1\nkr =\n\u00b1 j\u0302\n\u03b7M1 \u2212mk1R1\nkr ,\n\u03b7M2 = j \u2032 p,1\nkr \u00b7 R2 .\nTable 3. CR for the lower and upper wavelengths of carbon k-edge 4.37\u00a0nm and 11.94\u00a0nm, including the peak power, the number of photon pulse, and the RMS spectral bandwidth in three different pulse durations in RMS, 0.43\u00a0ps, 0.85\u00a0ps, and 1.23\u00a0ps are listed. For each case, those output properties are calculated at two different radiator lengths, 2.5\u00a0m, and 3.5\u00a0m.\nTRMS (ps)\nPpk at Lr = 2.5\u00a0m (MW) Photon per pulse at Lr = 2.5\u00a0m Ppk at Lr = 3.5\u00a0m (MW) Photon per pulse at Lr = 3.5\u00a0m RMS bandwidth Spectral brightness at 1\u00a0MHz\n\u03bb67 = 11.94\u00a0nm \u03bb183 = 4.37\u00a0nm \u03bb67 = 11.94\u00a0nm \u03bb183 = 4.37\u00a0nm \u03bb67 = 11.94\u00a0nm \u03bb183 = 4.37\u00a0nm \u03bb67 = 11.94\u00a0nm \u03bb183 = 4.37\u00a0nm \u03bb67 = 11.94\u00a0nm \u03bb183 = 4.37\u00a0nm 11.94\u00a0nm 4.37\u00a0nm\n0.426\n10.14 2.03\n6.51 \u00d7 1011 4.77 \u00d7 1010\n14.2 3.27\n9.12 \u00d7 1011 7.69 \u00d7 1010 4.13 \u00d7 10\u22125 1.50 \u00d7 10\u22125 3.25 \u00d7 1020 7.54 \u00d7 1019\n0.851 1.30 \u00d7 1012 9.54 \u00d7 1010 1.82 \u00d7 1012 1.54 \u00d7 1011 2.10 \u00d7 10\u22125 7.60 \u00d7 10\u22126 1.28 \u00d7 1021 2.98 \u00d7 1020\n1.277 1.95 \u00d7 1012 1.43 \u00d7 1011 2.73 \u00d7 1012 2.31 \u00d7 1011 1.40 \u00d7 10\u22125 5.00 \u00d7 10\u22126 2.87 \u00d7 1021 6.78 \u00d7 1020\n11\nVol.:(0123456789)\nScientific Reports | (2022) 12:9437 | https://doi.org/10.1038/s41598-022-13702-3\nBased on these procedures, we have implemented EEHG optimizer for tuning all important parameters to achieve the ideal performance of an EEHG beamline in a synchrotron light source."
        },
        {
            "heading": "Discussion",
            "text": "The EEHG seeding option could offer very narrow bandwidths and extremely high brightness, realized by diffraction-limited short pulses in transverse planes and Fourier-limited bandwidth in the EUV to soft X-ray spectrum. The attractive FEL features are negligible heat load on the beamline optics due to the narrow bandwidth and a potential capability to generate short pulses using a short pulse seeding. The advantage of a storage ring FEL compared to a linac-based one is much better pulse-to-pulse beam stability.\nFor the storage-ring-based EEHG FELs, we have implemented a complete set of tools, named EEHG optimizer, which can provide the optimized parameters for generating the longitudinal bunched and transverse matched 6D phase space distribution. Then, GENESIS simulation is applied to search the optimal energy modulation regarding each specific harmonic, aiming the highest CR gain as well as mitigated energy-spread induced de-bunching. This toolkit has been successfully applied to the NSLS-II storage ring as an example, with an up to two orders of magnitude improvement of the spectral brightness for the wavelength of 12\u00a0nm. Furthermore, the EEHG scheme can expand the capability of the NSLS-II with a fully coherent time-resolved tunable EUV and soft X-ray radiation source, also, such scheme is compatible with other beamlines with the minimum impact of NSLSII routine operation. Compared to other storage-ring-based FELs, e.g., angular dispersion enhanced prebunching scheme for seeding coherent EUV and soft X-ray FEL6,7,31\u201335, the EEHG approach holds a great promise, not only for its simplicity (no need of any lattice change) but also for the accessibility to much higher harmonics, toward the soft X-ray spectrum. This is because for the EEHG approach8,9, the maximal bunching (bn) decreases with the harmonic n as n \u22121 3 , as shown in Fig.\u00a01g; instead, for the angular dispersion enhanced prebunching scheme7, like HGHG, bn decreases much faster with n, as n\u22121. Thanks to our compact design, modulator 2 (1\u00a0m), chicane 2 (< 0.5\u00a0m), and radiator (3.5\u00a0m) can all be fit into the 5\u00a0m short straight section.\nSince the toolkit is designed and generalized to any type of a synchrotron light source based EEGH beamline, it can be easily extended to the 4th generation storage rings with the expected much better performances because of the diffraction-limited ultrasmall emittances.\nThere are usually three types of effects, which can impact the performance of an EEHG FEL. Wake fields and noise in the laser peak power can disrupt the coherence of the output radiation pulse, although they should not influence the total power produced. Incoherent energy scattering can reduce the bunching as well as the output power, but for the parameters used here, this should not be a concern, in particular because of the large amplitude of the energy modulations required by the bunching process. For a storage ring, however, there is the additional possibility of collective effects disrupting the electron beam after many turns around the ring.\nA combination of the high bunch intensity and perturbations of the bunch over short scale lengths can result in strong collective effects, which may affect the electron bunch parameters. Beam interaction with the machine impedance could lead to the bunch lengthening and excitation of the microwave instability, which increases the energy spread. The bunch slicing will enhance the effects of coherent synchrotron radiation (CSR) including 3D emittance growth and possible excitation of the CSR burst instability. Quantitative analysis of the collective effects requires further investigation including extensive numerical simulations using specific parameters of the ring lattice, light-generating insertion devices, and vacuum chamber.\nReceived: 7 April 2022; Accepted: 26 May 2022"
        },
        {
            "heading": "Acknowledgements",
            "text": "The authors are extremely grateful for the valuable discussion and great help from A. Cavalieri, L. Giannessi and W. Wan. This work was supported by the Director, Office of Science, Office of Basic Energy Sciences, of the U.S. Department of Energy under Contract No. DE-AC02-05CH11231, and by Brookhaven National Laboratory Directed Research and Development Program, Projects No. 22-028. This manuscript has been authored by Brookhaven Science Associates under Contract No. DE-SC0012704 with the U.S. Department of Energy. The United States Government retains and the publisher, by accepting the article for publication, acknowledges that the United States Government retains a non-exclusive, paid-up, irrevocable, worldwide license to publish or reproduce the published form of this manuscript, or allow others to do so, for United States Government purposes."
        },
        {
            "heading": "Author contributions",
            "text": "G.P. developed the EEHG optimizer. X.Y. implemented a compact EEHG beamline design for a synchrotron light source using NSLS-II as example. X.Y. and G.P. developed the tool for generating the bunched beam distribution and performed the GENESIS simulation. X.Y. defined the criteria for optimizing the CR emission. X.Y. and G.P. prepared the figures. L.Y., V.S., T.S., G.P., and X.Y. contributed to the writing of the manuscript."
        },
        {
            "heading": "Competing interests",
            "text": "The authors declare no competing interests."
        },
        {
            "heading": "Additional information",
            "text": "Correspondence and requests for materials should be addressed to X.Y.\u00a0or\u00a0G.P.\nReprints and permissions information is available at www.nature.com/reprints.\nPublisher\u2019s note Springer Nature remains neutral with regard to jurisdictional claims in published maps and institutional affiliations.\nOpen Access This article is licensed under a Creative Commons Attribution 4.0 International License, which permits use, sharing, adaptation, distribution and reproduction in any medium or\nformat, as long as you give appropriate credit to the original author(s) and the source, provide a link to the Creative Commons licence, and indicate if changes were made. The images or other third party material in this article are included in the article\u2019s Creative Commons licence, unless indicated otherwise in a credit line to the material. If material is not included in the article\u2019s Creative Commons licence and your intended use is not permitted by statutory regulation or exceeds the permitted use, you will need to obtain permission directly from the copyright holder. To view a copy of this licence, visit http:// creat iveco mmons. org/ licen ses/ by/4. 0/.\n\u00a9 The Author(s) 2022"
        }
    ],
    "title": "Optimization of echo\u2010enabled harmonic generation toward coherent EUV and soft X\u2010ray free\u2010electron laser at NSLS\u2010II",
    "year": 2022
}
{
    "abstractText": "The Green's function approach of Giles and Pierce is used to build the lift and drag based analytic adjoint solutions for the two-dimensional incompressible Euler equations around irrotational base flows. The drag-based adjoint solution turns out to have a very simple closed form in terms of the flow variables and is smooth throughout the flow domain, while the lift-based solution is singular at rear stagnation points and sharp trailing edges owing to the Kutta condition. This singularity is propagated to the whole dividing streamline (which includes the incoming stagnation streamline and the wall) upstream of the rear singularity (trailing edge or rear stagnation point) by the sensitivity of the Kutta condition to changes in the stagnation pressure.",
    "authors": [
        {
            "affiliations": [],
            "name": "Carlos Lozano"
        },
        {
            "affiliations": [],
            "name": "Jorge Ponsin"
        }
    ],
    "id": "SP:246f751627be7c1ada65fff9efd5f1e4a558031f",
    "references": [
        {
            "authors": [
                "W.K. Anderson",
                "V. Venkatakrishnan"
            ],
            "title": "Aerodynamic Design Optimization on Unstructured Grids with a Continuous Adjoint Formulation",
            "venue": "Comput. Fluids,",
            "year": 1999
        },
        {
            "authors": [
                "E. Chadwick",
                "J.M. Christian",
                "A. Kapoulas",
                "K. Chalasani"
            ],
            "title": "Systematic Continuous Adjoint Approach to Viscous Aerodynamic Design on Unstructured Grids",
            "venue": "AIAA J.,",
            "year": 2007
        },
        {
            "authors": [
                "M.C. Delfour",
                "Zol\u00e9sio",
                "J.-P"
            ],
            "title": "Shape and Geometries: Analysis, Differential Calculus and Optimization, 2nd Edition",
            "venue": "eulerlets. Phys. Fluids,",
            "year": 2011
        },
        {
            "authors": [
                "K. Fidkowski",
                "D. Darmofal"
            ],
            "title": "Review of Output-Based Error Estimation and Mesh Adaptation in Computational Fluid Dynamics",
            "venue": "AIAA Journal,",
            "year": 2011
        },
        {
            "authors": [
                "M.B. Giles",
                "N.A. Pierce"
            ],
            "title": "Adjoint Equations in CFD: Duality, Boundary Conditions and Solution Behavior. 13th Computational Fluid Dynamics Conference, Snowmass Village, CO, U.S.A., AIAA Paper 97\u20131850",
            "year": 1997
        },
        {
            "authors": [
                "M.B. UK. Giles",
                "N.A. Pierce"
            ],
            "title": "Analytic adjoint solutions for the quasi-onedimensional Euler equations",
            "venue": "J. Fluid Mechanics,",
            "year": 2001
        },
        {
            "authors": [
                "M. Giles",
                "R. Haimes"
            ],
            "title": "Advanced Interactive Visualization for CFD",
            "venue": "Computational Fluid Dynamics (Lecture Notes in Computer Science and Engineering,",
            "year": 1990
        },
        {
            "authors": [
                "M. Giles",
                "N. Pierce"
            ],
            "title": "An Introduction to the Adjoint Approach to Design",
            "venue": "Computational Fluid Dynamics Conference,",
            "year": 2000
        },
        {
            "authors": [
                "J. Katz",
                "A. Plotkin"
            ],
            "title": "Low Speed Aerodynamics, 2nd edition",
            "year": 2001
        },
        {
            "authors": [
                "G.K. Kenway",
                "C.A. Mader",
                "P. He",
                "J.R. Martins"
            ],
            "title": "Effective adjoint approaches for computational fluid dynamics",
            "venue": "Comput. Phys.,",
            "year": 2019
        },
        {
            "authors": [
                "N. K\u00fchl",
                "P. M\u00fcller",
                "T. Rung"
            ],
            "title": "Hydrodynamic Optimisation of Ships",
            "venue": "Ship Technology Research,",
            "year": 2021
        },
        {
            "authors": [
                "C. Lozano"
            ],
            "title": "On Mesh Sensitivities and Boundary Formulas for Discrete Adjointbased Gradients in Inviscid Aerodynamic Shape Optimization",
            "venue": "Comput. Fluids,",
            "year": 2017
        },
        {
            "authors": [
                "C. Lozano"
            ],
            "title": "Singular and Discontinuous Solutions of the Adjoint Euler Equations",
            "venue": "AIAA Journal,",
            "year": 2018
        },
        {
            "authors": [
                "C. Lozano",
                "J. Ponsin"
            ],
            "title": "Remarks on the Numerical Solution of the Adjoint QuasiOne-Dimensional Euler Equations",
            "venue": "Solutions. AIAA J.,",
            "year": 2012
        },
        {
            "authors": [
                "C. Lozano",
                "J. Ponsin"
            ],
            "title": "On the Mesh Divergence of Inviscid Adjoint Solutions. ECCOMAS2020 (Virtual event), WCCM-ECCOMAS2020",
            "year": 2021
        },
        {
            "authors": [
                "J. Ponsin"
            ],
            "title": "Singularity and Mesh Divergence of Inviscid Adjoint Solutions at Solid Walls",
            "venue": "Adjoint Equations in Stability Analysis. Ann. Rev. Fluid Mech., Volume",
            "year": 2022
        },
        {
            "authors": [
                "A.C. Marta",
                "S. Shankaran",
                "Q. Wang",
                "P. Venugopal"
            ],
            "title": "Interpretation of Adjoint Solutions for Turbomachinery Flows",
            "venue": "AIAA J.,",
            "year": 2013
        },
        {
            "authors": [
                "J. Peter",
                "F. Renac",
                "C. Labb\u00e9"
            ],
            "title": "Analysis of finite-volume discrete adjoint fields for two-dimensional compressible Euler flows",
            "venue": "A survey of approaches. Comput. Fluids,",
            "year": 2022
        }
    ],
    "sections": [
        {
            "text": "The Green's function approach of Giles and Pierce is used to build the lift and drag based analytic adjoint solutions for the two-dimensional incompressible Euler equations around irrotational base flows. The drag-based adjoint solution turns out to have a very simple closed form in terms of the flow variables and is smooth throughout the flow domain, while the lift-based solution is singular at rear stagnation points and sharp trailing edges owing to the Kutta condition. This singularity is propagated to the whole dividing streamline (which includes the incoming stagnation streamline and the wall) upstream of the rear singularity (trailing edge or rear stagnation point) by the sensitivity of the Kutta condition to changes in the stagnation pressure."
        },
        {
            "heading": "1. Introduction",
            "text": "The aim of this paper is to apply the program developed in (Giles & Pierce, 1997; Giles & Pierce, 1998; Giles & Pierce, 2001) to the 2D incompressible adjoint Euler equations in order to obtain the analytic adjoint solutions corresponding to aerodynamic lift and drag. The idea of the method is based upon the observation that, with appropriate boundary conditions for the linearized and adjoint problems, the adjoint variables at a particular point correspond to the functional of interest (typically, though not exclusively, aerodynamic lift or drag) evaluated using the Green\u2019s function for that point (Giles & Pierce, 2000). In the analysis in (Giles & Pierce, 1997; Giles & Pierce, 2001) for the quasi-1D and 2D Euler equations, the approach in each case was to construct d linearly independent source vectors ( ) 0( ) jf x which produced Green\u2019s functions ( ) 0( , ) jU x x of a simple form as solutions to the equations\n( ) ( )0 0 0( , ) ( ) ( ), 1,..., , j jL U x x f x x x j d    (1)\nwhere L are the linearized flow equations, 0( )x x  is the Dirac delta function and d is the number of flow equations, 3 for quasi-1D flow and 4 for 2D compressible inviscid flow, respectively. If ( ) 0( ) jI x is the value of the linear functional evaluated with\n( ) 0( , ) jU x x and \u03c8 is the adjoint state associated to that functional then, by definition, and provided that suitable boundary conditions hold,\n( ) ( )0 0( ) ( ) j T jI x f x (2)\nand hence the adjoint variables can be computed from ( ) 0( ) jI x by inverting Eq. (2).\nThe above program allows to gain insight into the nature of the Green's function and the adjoint solution, making it possible in particular to locate singularities and discontinuities in the adjoint variables. Furthermore, given a numerical adjoint solution and a set of source vectors ( )jf , the corresponding linear functionals ( )jI can be evaluated\nusing Equation (2), providing a means of verifying a number of the adjoint solution properties.\nThe adjoint equations were introduced for design optimization in the field of computational aerodynamics by Jameson (Jameson, 1988), and have been since extended to a variety of applications such as error estimation and mesh adaptation (Venditti & Darmofal, 2002) and stability analysis (Luchini & Bottaro, 2014), among many others. From the computational viewpoint, adjoint methods can be devised in two ways (Nadarajah & Jameson, 2000), which differ in how the discretized adjoint equations are obtained. In the continuous approach, one discretizes the adjoint p.d.e., while in the discrete approach the adjoint equations are obtained directly from the discretized flow equations. An important step in the application of adjoint methods is the development and verification of adjoint codes. This task is complicated by the lack of benchmark test cases, including exact solutions, and verification is usually done indirectly by comparing sensitivities with finite differences, which may lead to erroneous conclusions (Lozano & Ponsin, 2012), or (in the case of discrete adjoint solvers) by cross-checking with the linearized solver (Giles, et al., 2003).\nFrom a very early stage, and starting with Jameson\u2019s groundbreaking work, developments in adjoint methods have traditionally focused on the application of the method to the optimal design (Peter & Dwight, 2010) of aircrafts (Kenway, et al., 2019), ships (Kroger, et al., 2018) and automobiles (Othmer, 2014), or to goal-oriented mesh adaptation (Fidkowski & Darmofal, 2011). Comparatively less effort has been put on analyzing the properties of the adjoint solutions, with some notable exceptions starting with the work of Giles and Pierce (Giles & Pierce, 1997) (Giles & Pierce, 1998) (Giles & Pierce, 2001) (see also (Baeza, et al., 2009) (Marta, et al., 2013) (Lozano, 2018) (Lozano, 2019) (Peter, et al., 2022)). A few exact solutions to the adjoint equations are known. For quasi-1D inviscid flows, the Green\u2019s function approach has provided a tool to generate exact adjoint solutions (Giles & Pierce, 2001) (Lozano, 2018) in terms of the base flow solution. In inviscid 2D/3D flows, the entropy variables provide another exact solution for an output measuring net entropy flux across boundaries (Fidkowski & Roe, 2010) (Lozano, 2019). A closely related solution, corresponding to a nearfield computation of aerodynamic drag, has been recently discovered by the authors (Lozano & Ponsin, 2021). Finally, an exact solution for the adjoint Navier-Stokes equations corresponding to Blasius laminar boundary layer has been derived in (K\u00fchl, et al., 2021).\nIn this paper, we present a closed-form adjoint solution for the two-dimensional incompressible Euler equations for irrotational base flows based on the Green\u2019s function approach. This solution provides a cheap adjoint field for design or adaptation purposes\nthat, perhaps more importantly in practical terms, can also serve for verification and debugging of adjoint solvers. But they can also serve to disentangle the properties of the solutions to the adjoint equations, which, despite being linear partial differential equations, give rise to a rich zoo of structures comprising singularities along stagnation streamlines, stagnation points and sharp trailing edges (Giles & Pierce, 1997) (Lozano, 2019) (Giles & Pierce, 2002) (Giles & Pierce, 1999), and also to confirm the existence of an adjoint singularity at solid walls suggested by recent results (Peter, et al., 2022) that could explain the numerical divergence first observed in (Lozano, 2019)."
        },
        {
            "heading": "2. 2D incompressible adjoint Euler equations",
            "text": "In order to be as self-contained as possible, and to fix notations, we begin by recalling a few facts regarding the adjoint equations. In the present paper, we will concentrate on the incompressible Euler equations and consider linearizations around an irrotational base flow. It is well known that in such case the base flow can be derived either from a potential or a stream function that obey Laplace\u2019s equation. We could consider perturbations to this Laplace equation which would lead to an adjoint solution obeying the Laplace equation as well (as in e.g. (Giles & Pierce, 1999)). We will not follow this approach here. Instead, we will consider perturbations to the full incompressible Euler equations and obtain the corresponding full incompressible adjoint Euler equations, and specialize later to perturbations around an irrotational base flow.\nWe will focus, for definiteness, on steady, two-dimensional, incompressible, inviscid\nflow on a domain  with far-field boundary S  and wall boundary S (typically an airfoil profile). The flow is governed by the incompressible Euler equations\n( ) ( ) 0,R U F U  (3)\nwhere\n\u02c6, .\n\u02c6\np v\nU u F vu px\nv vv py\n\n \n \n                     \n(4)\nHere,  is the (constant) density, ( , ) ( cos , sin )v u v q q   is the velocity (where\n2 2 2q u v  and  is the local flow angle), p is the pressure and \u02c6 \u02c6,x y are the Cartesian\nunit vectors. The flow obeys a non-transpiration boundary condition \u02c6 0v n  on S (where\nn\u0302 is the outward-pointing unit normal vector at the boundary) and it is assumed to approach the far-field state ( cos , sin )q q   at the far-field S  , \u03b1 being the angle of attack.\nIn order to set-up the adjoint problem, an objective function needs to be defined, which\nis taken to be the lift or drag coefficient\n\u02c6( ) ,p S I C n d ds  (5)\nwhere (cos ,sin )Dd d    for drag and ( sin ,cos )Ld d     for lift, 1( )pC c p p     is the non-dimensional pressure coefficient, p is the pressure of the free-stream state at the far-field and 2 / 2c q   is a normalization factor ( is a reference length). We also need to consider linear perturbations to (3) and (5). For definiteness, we will focus on design applications, for which perturbations in the flow solution, ( , , )TU p u v    , arise as a result of changes, x , in the geometry of the\nboundary S. Linearizing (3) with respect to U yields\n( ) ,A U f  (6)\nwhere\n\u02c6 \u02c60\n\u02c6 \u02c6 \u02c6 \u02c6 ( , , )\n\u02c6 \u02c6 \u02c6 \u02c6\nv x y\nA uv px x v ux uy p u v\nvv py y vx v vy\n\n  \n\n        \n               \n(7)\nare the flux Jacobians and the residual f is typically zero for shape optimization problems. U obeys the following boundary condition at solid walls:\n\u02c6 on ,v n w S   (8)\nwhere \u02c6 \u02c6[( ) ]w v n x v n       , with n\u0302 being the variation in the boundary normal\ninduced by the deformation of the geometry. In the far-field, U is chosen such that there is no perturbation to the flow far-field boundary conditions, unless one is specifically considering the effect of perturbations in far-field parameters such as angle of attack.\nThe variation of the cost function (5) with respect to perturbations in the flow and the geometry is (Castro, et al., September 2007; Anderson & Venkatakrishnan, 1999; Delfour & Zol\u00e9sio, 2011),\n1 1\u02c6 \u02c6( ) ( )( ) .\nS S\nI c d n pds c x n d p ds          (9)\nwhere p reflects the variation of the solution in response to the changing geometry.\nEq. (9) can be efficiently computed with the adjoint approach (Jameson, 1988), where\nadjoint variables 1( , ) , T   with 2 3( , )   , are introduced over the entire flow domain, and the objective function I is reformulated as\n( ) .TL I R U d     (10)\nLinearizing the Lagrangian (10) with respect to flow and geometry perturbations gives\n1 1\u02c6 \u02c6( ) ( )( ) ( ) .T T\nS S L c d n pds c x n d p ds A U d fd                      (11)\nAfter integration by parts and rearrangement, this yields (Castro, et al., September 2007; Anderson & Venkatakrishnan, 1999):\n1 1\n1\n1\n1\n\u02c6 \u02c6( ) ( )( )\n\u02c6 \u02c6\n\u02c6 \u02c6 \u02c6( ( ) )\n\u02c6 \u02c6( )( ) ( )\nT\nS S\nT T T\nS S\nT T\nS S\nT\nS"
        },
        {
            "heading": "L c d n pds c x n d p ds A Ud",
            "text": "n A Uds n A Uds fd\nA Ud c d n n pds n A Uds\nc x n d p ds fd n v v ds\n    \n    \n     \n     \n\n\n \n \n\n\n\n\n\n\n\n\n        \n      \n        \n      \n  \n  \n  \n  . S \n(12)\nFrom Eq. (12) it follows that if the adjoint state obeys the following adjoint equations and boundary conditions\n1\n0 in\n\u02c6 \u02c6( ) at\n\u02c6 0 at\nT\nT\nA\nn c d n S\nn A U S\n\n\n \n\n\n\n  \n  \n \n(13)\nthen the last two lines in Eq. (12) yield the (continuous) adjoint-based sensitivity derivatives\n  1 1\u02c6 \u02c6( )( ) ( ) .Tp S S S C n d ds fd c x n d p ds w v ds                   (14)\nEq. (14) lacks the Leibniz term \u02c6( ) T S x n Fds    , first introduced in (Kavvadias, et al., 2015) (see also (Lozano, 2017)), which is zero analytically. Finally, when far-field parameters (such as angle of attack) are considered as design variables, the contribution from the far-field integral \u02c6T S n A Uds    should also be included in Eq. (14)."
        },
        {
            "heading": "3. Using Green\u2019s functions to compute the analytic adjoint solution",
            "text": "The Green\u2019s function approach was completed with a closed-form solution for the adjoint quasi-1D Euler equations in (Giles & Pierce, 2001) and outlined for the 2D Euler equations in (Giles & Pierce, 1997), where four linearly independent source vectors representing mass, normal force, enthalpy and stagnation pressure perturbations, respectively, were considered. The first two reduce, for incompressible flow, to point mass sources and point vortices, respectively, which are well-known elementary solutions in potential flow; the third one yields zero lift or drag perturbation, and the final one was shown to lead to a non-uniform mass perturbation along the streamline downstream of the insertion point that would be responsible for an adjoint singularity along the incoming stagnation streamline.\nFocusing now on 2D incompressible flow, suppose that we have three point\nperturbations ( ) 0( , ) jU x x , 1,...,3j  , that obey the linearized equations\n( ) ( ) 0 0 0( ( , )) ( ) ( ), j jA U x x f x x x     (15)\nwith the following wall boundary conditions\n( ) 0 \u02c6( , ) 0,jv x x n x S    (16)\nand far-field boundary conditions such that there is no perturbation to the inflow state. In\n(15), x is a generic point in the fluid domain, 0x is the location of the singularity and the gradient operator on the LHS of the equation acts on x . If\n( ) 1 ( ) 0 0 \u02c6( ) ( , )j jU\nS\nI x c d n p U x x ds   (17)\nis the value of the linearized functional (lift or drag) corresponding to ( ) 0( , ) jU x x , then we can apply eqs. (12)-(14) to ( ) 0( , ) jU x x and we get\n( ) ( )0 0 0( ) ( ) ( ). j T jI x x f x (18)\nIf the source vectors ( ) 0( ) jf x are linearly independent, Eq. (18) can be inverted to obtain the adjoint variables in terms of the linearized cost functions\n    1 (1) (2) (3) (1) (2) (3) 0( ) , , | | , T x I I I f f f    (19)\nwhere  (1) (2) (3)| |f f f is a matrix whose columns are the vectors ( )jf .\nFollowing (Giles & Pierce, 1997), we now define 3 linearly independent perturbations, which we take to be a point source, a point vortex and a stagnation pressure perturbation at fixed pressure and local flow angle.\n3.1. Point source\nThe first perturbation is a point mass source located at 0x . In unbounded space, the\nresponse to this perturbation is given by the free-space solution\n(1)\n(1)(1)\n(1)\n( )(ln )\nln 2\nln\nfree x y\nxfreefree\nyfree\np u v r\nruU\nrv\n \n \n\n                       \n(20)\n( 0r x x  and  is an arbitrary constant point singularity strength that we introduce for\nconvenience and that we will set to 1 in the end), which obeys the following linearized equations\n \n(1)\n(1) (1) (1) (1) (1)\n(1) (1) (1) (1)\n0\n1 0\n( ) ( ) ln 2\n(\nfree\nfree free free free x free\nfree free free y free\ny x y\ny x\nv\nA U v u u v v u p\nv v v v v v p\nu x x u v r\nv u\n \n      \n     \n  \n\n    \n                     \n                  \n,\n) lnxv r         \n(21)\nwhere the second term on the right-hand side vanishes if the base flow is irrotational. Hence, the source vector is\n(1)\n1\n.f u\nv\n\n          \n(22)\nNotice that (1) 1( ) T f v      , so (1)I is related to the (continuous) adjoint-based lift/drag gradient (14).\nThe Green\u2019s function approach requires the value of the linearized functionals (1)I , which are the lift and drag forces exerted by the point source on a body. In the presence of a body, the above functional form (20) only holds locally near the singularity, such that (22) still holds, but needs to be modified globally to account for the wall boundary condition. This is particularly simple in 2D potential flow using complex variable and the method of images, and allows us to compute the force on immersed bodies using Blasius theorem (Milne-Thomson, 1962). The simplest problem where the body is a circle is a standard academic exercise, and more general situations can be derived from this with suitable conformal transformations. The complex force on the cylinder turns out to be i\nIw q e   , where wI is the induced velocity at the point singularity and iq e  is the\nfree-stream complex velocity (here 2 2q u v    ). An interesting fact is that the same\nexpression yields the force on a body of arbitrary shape (Milne-Thomson, 1962), a result that is known as Lagally\u2019s theorem. Hence, the force exerted by the point source on the body is, keeping only terms linear in the source strength  ,\n(1) (1) 2( ) ( ).i iD i L e u iv q e O         (23)\nHere, \u03b4D(1) and \u03b4L(1) stand for the linear perturbations to drag and lift, respectively, due to the point source. Eq. (23) thus gives the linearized force exerted by a point source on a rigid body of arbitrary shape in terms of the undisturbed velocity at the source, u iv . This is not the end of the story, though. Potential flows contain circulation, which can be freely adjusted a priori. For bodies with sharp trailing edges, the value of the circulation is fixed by the Kutta condition that asserts that the flow contains the precise amount of circulation to make the flow smooth at the trailing edge. The introduction of a point source disturbs the flow at the trailing edge, so the circulation has to be adjusted accordingly to preserve the smooth flow at the trailing edge. The extra circulation contributes an\nadditional term to Eq. (23) that we shall calculate shortly. For blunt bodies, on the other hand, the circulation is not fixed by any smoothness requirement. However, it turns out that, in order to obtain consistent adjoint solutions, a Kutta condition has to be imposed as well, ensuring no perturbation to the position of the rear stagnation point (see section 3.2.1).\nIn order to obtain explicit formulae, we will consider an airfoil in the complex z plane with a sharp trailing edge at z = 1. Let us suppose that the airfoil is transformed into a circle of radius R and centered at 0 in the auxiliary complex  -plane by a conformal\nmapping ( )z F  (with ( ) 1 as F    ), such that the point te on the circle is\ntransformed into the trailing edge of the airfoil at z = 1. The (irrotational) base flow around the circle can be derived from the complex potential\n2\n0 0 0\n0\n( ) ( ) ln( ). 2 i i iRq e q e                    (24)\nThe corresponding potential at a point z on the airfoil plane is precisely ( ( ))z . In the\nunperturbed flow, the circulation 0 around the circle has to be fixed to the value\n2\n0 0\n0 2 ( ) 2i ite te\nR iq e iq e    \n \n\n      \n(25)\nsuch that the flow around the circle has a stagnation point at te , i.e.,\n2\n0\n2\n0 0\n1 ( ) / 0.\n( ) 2te i i te\nte te\niR W d d q e q e \n   \n    \n\n \n      \n  (26)\nAfter inserting a point source at s , the potential picks an extra contribution from the point source and its images with respect to the circle (Milne-Thomson, 1962)\n    2\n0 0\n0\n( ) ln ln ln , 2 2 2 s s\ns\nR     \n \n\n                   (27)\nwhere  denotes the complex conjugate of  . ( )s  induces a non-zero velocity at\n,te\n   2 0 0\n0\n1 ( ) ,\n2 2 2 s te\nte s te te\ns\nW R\n  \n       \n\n\n \n    \n  \n(28)\nwhich has to be cancelled with additional circulation\n0 02 ( ) ( ).t s ee tWi        (29)\nThis extra circulation produces an extra force that has to be added to (23)\n(1) (1) 2\n0\n0\n0 0\n2\n2\n( ) ( )\n( ) ( )\n( ) ( )\n(2 ( ) )te s te\nte te\ns te s te\ni i\ni i\ni i\nD i L q e u iv q e O\nq e u iv q e O\nq e u i q e\ni\nv O\nW\n \n \n \n    \n\n\n   \n   \n\n \n    \n\n \n\n \n\n \n     \n   \n  \n \n \n      \n   \n(30)\nNotice that the extra term is purely imaginary, so it only affects lift. Separating the real and imaginary parts, setting 1  and dividing by c to normalize, we get the following linearized functionals due to the point source\n \n  0(\n(1)\n01)\n1) ) cos ) sin ,\n1) ) cos ) sin .\n( ( ) ( ( ) ( (\n)\n)\n( ( ) ( ( ( ) ( ( ) ) (\nD\nte te\nte e\nL\nt\nI z z z q\nq I z\nu v c\nv u i c z z z c z\n    \n        \n   \n\n \n\n  \n      \n    \n(31)\nNotice that the extra contribution is independent of the initial circulation and blows up at the trailing edge, thus providing a precise mechanism (and an explanation) for the adjoint singularity at the trailing edge.\n3.2. Point vortex\nThe second perturbation is a point vortex. In unbounded space it is simply\n(2)\n(2)(2)\n(2)\n( )(ln )\nln . 2\nln\nfree x y\nyfreefree\nxfree\np v u r\nruU\nrv\n \n \n\n                      \n(32)\nThis solution obeys the linearized equation\n \n(2)\n(2) (2) (2) (2) (2)\n(2) (2) (2) (2)\n0\n0 0\n( ) ( ) ln 2\n(\nfree\nfree free free free x free\nfree free free y free\nx y x\nx y\nv\nA U v u u v v u p\nv v v v v v p\nv x x v u r\nu v\n \n      \n     \n  \n\n    \n                     \n                 \n,\n) lnyu r         \n(33)\nwhere the extra term vanishes if the base flow is irrotational. Hence, the source vector is\n(2)\n0\n.f v\nu\n\n         \n(34)\nNotice that (2) 2 3( ) T f v u     , so (2)I approaches Sqn  as the vortex approaches the wall. Its value is thus constrained by the adjoint wall b.c. 1\u02c6 \u02c6( )S Sn c d n     (Giles & Pierce, 1997).\nOnce again, in the presence of a body the above functional form needs to be modified to account for the wall boundary condition. The correct expression can then be used to compute the force exerted by the vortex on a body, which poses no significant difficulties relative to the source case, so we just quote the results. The linearized complex force, taking into account the Kutta condition, is\n)\n0\n(2) (2\n0 0\n2\n2\n( ) ( )\n( ) ( ),\n2 ( ) ( )te te\nte te\ns te s te\ni i\ni i\nq i e u iv q e O\ni q i e\nD i L W\ne u iv q O \n\n \n\n \n  \n    \n   \n  \n\n \n\n \n   \n      \n\n\n\n  \n  \n (35)\nwhere ( )teW  is the complex velocity induced by the vortex (and its images) at te . Hence, the properly normalized linearized functionals due to the vortex are (setting 1  )\n \n (2)\n(2)\n0 0\n( ) ( ( ))cos ( ( ))sin\n( ( )) ( ( )) .1 cos ( ( )) n\n1\nsi\nD\nte te\ns te s te\nL\nv u\nq\nI z z c\nzI u vz z q c c\n \n \n  \n      \n   \n\n  \n\n\n   \n\n     \n  \n(36)\nNotice that the extra term diverges as the vortex approaches the wall. However, along the\nwall we have 0s R   and, thus,\n0 0 1,te te s te s te\n   \n   \n  \n \n  (37)\nso that\n (2) cos i1 s nL wallI c u v \n\n   (38)\nas required by the adjoint wall b.c.\n3.2.1. Blunt Bodies\nFor blunt bodies (circle, ellipse) there is no need to impose a Kutta condition, so the circulation is a priori arbitrary and the above extra terms disappear. However, the resulting forces are not consistent with the adjoint approach (as we have discussed above, the force exerted by a point vortex has to approach the wall in a certain fashion so that the adjoint wall b.c. is obeyed) and the Green\u2019s function approach leads to the wrong liftbased adjoint solution. It turns out that to obtain a sensible solution it is necessary to assume that an adjoint-consistent linearization requires a Kutta condition such that the rear stagnation point is not disturbed by the point singularities. This requirement results\nin the extra forces described above, and the linearized functionals are precisely (31) and (36) and lead to an analytic adjoint solution that obeys the adjoint equations and boundary conditions and that agrees with numerical computations (see for example the adjoint solution for a 6:1 ellipse presented in (Lozano & Ponsin, 2021)).\n3.3. Change in stagnation pressure at fixed p\nFor the final perturbation we choose, in analogy with (Giles & Pierce, 1997), a perturbation to the stagnation pressure 210 2p p q  (where 2 2 2q u v  ) at fixed values of the pressure and the local flow angle  . As stagnation pressure is convected\nalong streamlines, we expect the solution to be concentrated along the streamline\ndownstream of the insertion point 0x . Following (Giles & Pierce, 1997), we use curvilinear streamline coordinates in which s is the distance along the streamline downstream of the insertion point and n is the coordinate perpendicular to the streamline. In this coordinates, the perturbation is, in a first approximation,\n3\n0 ,\n0 1\n( ) ( ) ( ) ( ) ( ) ( ),\np\nU H s n x u x H s n\nq p q v\n   \n              \n(39)\nwhere ( )H s is the Heaviside step function and ( )n is the Dirac delta function. However,\nas explained in (Giles & Pierce, 1997), this is not the full form of the solution. This fact can be understood most simply by noting that (39) does not obey the linearized flow equations. In fact,\n(3)\n0 ,\n\u02c6( ) ( ) ( ) ( ) ,\np\nU A H s n sf H s n\nq p \n                 \n(40)\nwhere s\u0302 is the unit vector in the flow direction and\n(3)\n2\n0 ,\n1 \u02c6\n2 .\n2p\nF s f u\nq p q v\n   \n            \n \n(41)\nTo proceed further, we need to express  in streamline coordinates. While for smooth\nfunctions  \u02c6 s nsw w w       , when delta functions are present one needs to proceed\nmore carefully. To this end, we follow (Emanuel, 2000) and define coordinates \u03be1 along the streamline and \u03be2 that parameterizes the lines orthogonal to \u03be1. The \u03bei coordinates are\nrelated to the streamline coordinates as 1 1ds h d and 2 2dn h d , where /i ih x   \nare the scale factors. In terms of 1 2( , )  , the divergence operator acting on a vector w is\n   2 1 1 2 1 2 1 1 2 2\n1 1 \u02c6 \u02c6 ,w h w e h w e\nh h h h \n      \n  (42)\nwhere 1\u02c6 /i i ie h x     are the local curvilinear unit basis vectors (note that 1\u0302 \u02c6e s in earlier notation). Finally, we need to consider the Heaviside and Dirac delta functions. Since\n1 2 1 2dxdy h h d d   , we have\n1 2 1 2( ) ( ) ( ) ( ) ( ) /x x y h h        (43)\nand\n1 2 2( ) ( ) ( ) ( ) / .H s n H h    (44)\nHence,\n (3) (3)1 2 1 2 1\n(3) (3)1 2 1 2\n1 2 2 1 1\n(3) (3)\n0\n1 \u02c6( ( ) ( )) ( ) ( )\n( ) ( )1 1 ( ) ( )\n( ) ( ) ( ) .\nf sH s n H f h h\nH f f\nh h h h\nx x f H s n f s\n    \n      \n\n \n   \n\n  \n\n  \n\n(45)\nUsing ( , ) ( cos , sin )u v q q  , the last term on the right-hand side can be further\nexpanded as\n(3) (1) 2 (2)\n2\n2 ,s sf f q f\ns q \n    \n (46)\nwhere\n(1) (2)\n1 0\n,f u f v\nv u\n \n                    \n(47)\nare the source vectors for the point source and vortex, respectively. Hence, we can write the full solution as\n(3)\n0\n0 ,\n0 0 2 (1)1 1 2 2\n1 2 1 2\n2\n0 0 (2)1 1 2 2\n1 2 1 2 2\n2\n0 ,\n1 ( , ) ( ) ( ) ( )\n( ) ( ) ( ) ( , )\n( ) ( ) 2 ( ) ( , )\n1 ( ) ( ) ( )\np\ns\ns\ns\np\nU U x x H s n x\nq p\nH h h d d q x U x x\nh\nH h h d d x U x x\nh q\nU H s n x ds\nq p\n\n\n  \n       \n        \n \n\n    \n \n       \n        \n      \n\n\n2 (1)\n0\n(2)\n2\n0\n( ( )) ( , ( ))\n2 ( ( )) ( , ( )),s\nq x s U x x s\nds x s U x x s q\n\n \n\n\n\n \n   \n\n\n(48)\nwhere (1)U , (2)U are the complete point source and point vortex Green\u2019s functions (i.e., respecting the wall boundary conditions), which reduce to (20) and (32), respectively, in the vicinity of the singularity. We can check that Eq. (48) obeys\n(3) (3) (3)\n0 0 0 0( ( , )) ( ) ( ) ( ) ( ),A U x x f x x x f x x x        (49)\nas expected. Notice that 0 ,\n1\np\nq\np q \n   \n  so that\n2\n0 ,\n1 s s s\np\nq q m\nq p \n           \n   \nwhere\nm is the linearized mass flux perturbation defined in (Giles & Pierce, 1997), and thus the first integral on the right-hand side of (48) is actually the integral derived in (Giles & Pierce, 1997). The second integral also has an analog in the compressible case, so the solution shown in (Giles & Pierce, 1997) is apparently incomplete.\nFor pressure-based functionals, the first term in (48) does not contribute to the\nlinearized functional, which can then be written as\n(3) 2 (1) (2) 0 2\n0 0\n2 ( ) ( ( )) ( ( )) ( ( )) ( ( ))s sI x ds q x s I x s ds x s I x s\nq \n \n      (50)\nAgain, the first integral on the RHS of (50) is equivalent to the corresponding integral in (Giles & Pierce, 1997), where it was used to argue that there is a potential divergence along the incoming stagnation streamline. Whether this singularity is actually present or not depends on the cost function and the flow conditions. Numerical tests show that liftadjoint solutions seem to have these singularities even in incompressible and irrotational flow, while drag-adjoint solutions only show them in certain transonic cases (Lozano & Ponsin, 2021).\nWe can now substitute (31) and (36) into (50) to compute the linearized functional\ncorresponding to the stagnation pressure point perturbation (48). For drag, we get\n(3) 2\n2\n1 ( ) ,DI v v\nq q c \n \n   (51)\nwhile for lift the result is\n(3)\n0 2\n2 ( ) ( sin cos ) L q I x u v\ncq c   \n\n     (52)\nwhere\n2 (1) (2) 2\n0 0\n1 ( ( )) ( ( )) 2 ( ( ))(1 ( ( ))),s sds q x s x s ds x s x s\nq \n \n          (53)\nand\n     \n   \n         \n   \n0 0 00 0\n2 2\n0 0(\n2 2\n0\n2\n0\n2\n(\n2\n1)\n)\n2 , ( ) ( )\n( ) ( )\n2 .\n( )\n( )\nte te tete te\nte te te te\nte te\nte te\nte te te te\nte te\nX Y Y X Y Y X Y Y i\nz z X X Y Y\nz z\nX X X X Y Y Y Y X X Y Y\nX X\nz\nz\nY Y\n   \n   \n   \n   \n        \n         \n   \n \n       \n \n\n\n\n\n\n(54)\nIn (53), the integration is carried out along the streamline downstream of 0x . Finally, X and Y in (54) are the Cartesian coordinates on the circle plane, in terms of which .X iY  "
        },
        {
            "heading": "4. Analytic adjoint solutions",
            "text": "Using (19), (22), (31), (34), (36), (41), (51) and (52), we can compute the analytic\nadjoint solutions as\n1 2\n(1) (2) (3) 2\n1 2 3\n2\n2 2\n(1) (2) (3) 2 2\n2\n1 0\n( , , ) ( , , ) 2\n2\n2\n( , , ) 0 .\nq\nI I I u v q u\nv u q v\nq u q v\nI I I q v q u\nq u v\n  \n \n\n\n \n \n   \n     \n         \n(55)\nFor drag we get\n2 2\n1\n2\n3\n1 cos\nsin Drag\nq q\nq q\nu\nq c\nv\n\n \n \n\n\n\n\n\n                \n(56)\nwhich is exactly the analytic drag adjoint solution found in (Lozano & Ponsin, 2021). It can be checked that it obeys the adjoint equation and boundary conditions. Notice that no assumption has been made about the lift of the base flow solution. Hence, this twodimensional solution should be valid for lifting and non-lifting flows alike, contrary to what was claimed in (Lozano & Ponsin, 2021), where the validity of the solution was restricted to non-lifting flows based on far-field behavior. In 2D, incompressible flow past a lifting airfoil is still irrotational. The only difference between a lifting and a nonlifting flow is in the order of the subleading terms as r \n2(1/ ) ( ),\n(1/ ) ( ).\nv v O r non lifting\nv v O r lifting\n\n\n     (57)\nAdjoint b.c. at the outer boundary demand\n\u02c6 0T\nS\nn A Uds \n\n  (58)\nfor perturbations U respecting the far-field state. For incompressible flow, we have\n20\u02c6 ( sin cos ) (1/ ), 2 T drag\nq n A U u v O r\nr\n            (59)\nwhere 0 is the circulation of the base flow, so if ,u v  tend to zero at the far-field (which is a reasonable assumption as otherwise the free-stream state would be perturbed), then the above term is at least 2(1/ )O r and the far-field integral vanishes, thus\nguaranteeing that drag is also a valid solution for lifting flows. The discrepancies\nobserved in (Lozano & Ponsin, 2021) can then be attributed to the dependence of the numerical solution on the distance from the body to the far-field (20 chord lengths for the meshes used in (Lozano & Ponsin, 2021)).\nOn the other hand, for lift we get the result\n \n \n2\n2 2\n2\n(1)\n1\n(1) (2)\n2\n3\n(1) (2\n2\n)\n, i\n2\ns n 1\ncos 1\nLift\nq q\nq\nq\nq u v u c q\nu\nq\nv v\nq\n \n\n\n\n\n \n\n                         \n\n    \n   \n\n     \n(60)\nIt can be checked (with a long derivation that can be conveniently alleviated with a symbolic manipulation software) that Eq. (60) obeys the adjoint equations, for which one needs to use the following identities\n(2) (1)\n(2) (1)\n( ) ( ),\n( ) ( ),\nx y\ny x\nz z\nz z\n          (61)\nwhich follow from the holomorphicity of (2) (1)( ) ( )z i z   , as well as\n2 (1) (2) (1) (2)\n2 3 2\n2 2 2 (1 ) (1 )s sv q q q v q v\nq q q                  (62)\nand the incompressibility and irrotationality of the base flow. Likewise, (60) also obeys the wall boundary conditions,\n \n2 3\n(1) (2)2\n2\n\u02c6)\n\u02c6 \u02c6 \u02c6( sin ,cos ) ( )( 1 ( , )\n\u02c6( sin ,cos ) ,\n( ( )\n)\nx yc\nn\nnn c\nq n q v v uq n\nn\nn\nq\n \n \n \n \n  \n \n        \n\n   \n \n\n(63)\nsince \u02c6 0v n  and (2)1 0   at the wall.\n4.1. Behavior of \u039e\nThe streamline integral eq. (53) represents the contribution to lift, due to the Kutta condition, of a unit point perturbation to the stagnation pressure. This perturbation generates secondary point sources and vortices along the streamline downstream of the insertion point. The contributions of these secondary perturbations to the lift (see (31), (36)) diverge near the trailing edge, which gives rise to a singular behavior of \u039e near the dividing streamline upstream of the trailing edge or rear stagnation point (which includes the wall and the incoming stagnation streamline). Along the stagnation streamline upstream of the body, the integral is not defined, as the streamline splits up in two at the stagnation point, while along the wall the integral diverges. For a circle, for example, the integral along the wall is\n0 2 3\n0 0\n( ) cos ( / 2)cot csc ,x d \n     (64)\nwhere 0 0 0( cos sin ),x R R  , which diverges as\n3  at the rear stagnation point ( 0 \n). Away from the dividing streamline, the integral grows unbounded as the corresponding streamline approaches the dividing streamline. In order to investigate the character of the divergence, we consider a simplified setup involving flow past a wedge of half-angle / 2 (Figure 1).\nThe asymptotic form of the complex potential for this case is 2/kz , where 2 /k    , so that stream function reads, in polar coordinates, 2/ sin(2 / )kr k  , from which it\nfollows that the minimum distance from a particular streamline to the trailing edge is /2\nmin\nkr  , while the distance from a given point on the streamline to the dividing\nstreamline is 2/\nmin\nkd r . Likewise, the flow speed behaves as 2 1 ( )kq O r   , so\n2 2 ( ),ksq O r    and likewise 1( )s O r   . Finally, 1/kz and, thus, 1 (1) ( )kO r    and\n1 (2) ( )kO r    , so integrating along a streamline,\n5 2 / 1 2 / 2\nmin min , kr r\n       \n (65)\nwhich depends on the trailing edge wedge angle  . Notice that the exponent is always negative for 0    . It is thus clear that  has a potential divergence as the streamline approaches the dividing streamline. Let us consider three different scenarios in terms of\nthe relative position of 0x .\n1. 0x approaching the rear singularity (trailing edge or rear stagnation point). As 0x approaches the rear singularity (Figure 2), the distance to the rear singularity behaves as minr r asymptotically. Hence, 0( )x diverges as 5 2 / 1 2 / 2 kr r         as 0x approaches the rear singularity. This singular behavior had been already anticipated (including the dependence on the trailing edge angle) in (Giles & Pierce, 1997), but no concrete predictions were made for the exponent. A 1/rmin singularity at the rear stagnation point was predicted in (Lozano & Ponsin, 2021) for blunt bodies in potential flow using the form of the streamline integral derived in (Giles & Pierce, 1997), while the actual value for this case (for which 1k    ) is 3r .\n2. 0x upstream of the rear singularity (Figure 3). As 0x approaches the dividing streamline\nupstream of the rear singularity, 0( )x diverges as\n52 5/2 / 1/2\nmin 1/ k kr d d     , where d is\nthe distance from 0x to the dividing streamline (incoming stagnation streamline or wall). Notice that the singularity exponent is not universal since it depends on the trailing edge angle  , and reduces to the inverse square-root behavior predicted in (Giles & Pierce, 1997) for cusped trailing edges (for which 0  ).\n3. As 0x approaches the rear stagnation streamline downstream of the rear singularity\n(Figure 4), 0( )x does not diverge (the minimum distance from the streamline to the\ntrailing edge is now 0 tex x , which is always greater than zero) but rather behaves as\nThe results of this asymptotic analysis are confirmed by actual computations (see section 5). This suggests that the origin of the divergence along the dividing streamline is the singularity at the trailing edge/rear stagnation point. This can be put on a firmer basis by noting that, as it will be shown later on, while the integral does get a small contribution from the leading edge region, it is very approximately constant upstream of the rear singularity and vanishingly small downstream. Likewise, the integral behaves in exactly the same fashion at both the incoming stagnation streamline and the wall, with an exponent that depends on the local geometry around the rear singularity.\n4.1.1. Influence of  on the sensitivity derivatives and the adjoint boundary conditions\nThe divergences of  (and (1) and (2) ) are propagated to the lift-based adjoint\nvariables (60). However, two linear combinations of the adjoint variables,\n(1) (1)\n1 2 3\n(2) (2)\n2 3\n( , ) ,\n( ) ,\n( sin cos ) /\nsin cos (1 ) /\nI v\nI v\nq u v c\nvu u q c\n  \n\n \n\n \n \n   \n  \n \n     (66)\nwhich yield the linearized perturbations to the lift due to a point source and a point vortex, respectively (Giles & Pierce, 1997), remain finite except at the trailing edge. This fact is relevant since the adjoint variables enter the (continuous) adjoint-based sensitivity derivatives (14) precisely through (1)I , which protects the sensitivities from diverging with mesh refinement (a fact that is well established numerically, see e.g. (Lozano, 2019) (Lozano, 2017) (Lozano, 2012) (Lozano & Ponsin, 2022)). Likewise, (2)I approaches 2 3 \u02c6 ( , )qn   as the point approaches the wall and is thus directly related to the adjoint boundary condition, which is thus respected by the analytical solution and protected upon mesh refinement (Lozano, 2019). Finally, the divergence along the dividing streamline is encapsulated into a third (linearly independent) combination\n2\n23) 2(\n1 3 22( 2 2 ) / ( ,sin 2 cos ) /I cu v qq q u q v           (67)\nwhich yields the linearized perturbation to the lift due to a unit stagnation pressure point perturbation.\nIt is important to point out, however, that the above split of the adjoint solution space into protected and unprotected terms (as regards the dividing streamline singularity) is arbitrary and based on our choice of point perturbations (inherited from (Giles & Pierce, 1997)). In fact, it turns out that any linear combination\n1 2 3,a b c    (68)\nwhich corresponds to a point perturbation with source vector ( , , )Tf a b c , obeying\n2 0q bu ca v   , does not contain the streamline integral \u039e and is thus protected from\nthe dividing streamline singularity. Conversely, if 2 0q bu ca v   then the\ncorresponding perturbation is singular along the dividing streamline. One such example is (0, , )Tf u v , which is related to the drag Eulerlet (Chadwick, et al., 2019), a Green\u2019s\nfunction of the incompressible Euler equations linearized around a uniform flow which carries one unit of drag."
        },
        {
            "heading": "5. Sample solutions",
            "text": "In order to illustrate the results presented above, we present now the results of direct evaluation of the adjoint analytical solutions in two cases: blunt body (a circle) and an airfoil with a sharp non-cusped trailing edge.\n5.1. Circle\nAs explained above, obtaining meaningful adjoint solutions for bodies without sharp trailing edges such as the circle requires a Kutta condition to guarantee that the perturbations preserve the location of the rear stagnation point. As a consequence of this fact, the solutions (56) and (60) are applicable here, resulting in the analytic drag-based adjoint solution shown in Figure 5\nx\n\n-0.4 -0.2 0 0.2 0.4\n-4\n-2\n0\n2\n4\n6\n8\n10\n12\n 1  2  3\nFigure 5. Analytic drag-based adjoint solution at the wall for incompressible, inviscid flow past a circle with 0 0  .\nHere and in what follows, the normalization of the adjoint variables is given by (56)\nand (60). For the flow variables, dimensions are fixed such that 1 q   , while spatial coordinates are normalized with the reference length (the diameter of the circle in this case).\nTo obtain the analytic lift-based adjoint solution, the streamline integral 0( )x has to be evaluated at each point of the domain. As with Giles and Pierce\u2019s analytic quasi-1D adjoint solution (Giles & Pierce, 2001), this cannot be done in analytic form in general, so the solution has to be evaluated numerically instead. In the present case, there is the additional complication that the integration requires prior determination of the streamline\npassing through 0x . Thus, in order to produce sample solutions, a numerical procedure must be assembled to trace the streamline and perform the integration. Streamline tracing is carried out by direct numerical integration of the equation / ( )dx dt v x with a fourth-\norder Runge-Kutta method (see e.g. (Giles & Haimes, 1990)). The integration is carried out concurrently with a simple trapezoidal rule. Contour maps of the analytic lift-adjoint solution obtained in this way are shown in Figure 6, while Figure 7 shows the adjoint solution along three vertical lines crossing the stagnation streamline upstream and downstream the circle and impinging the wall as indicated in Figure 6. It is clear from both figures that the solution is singular along the dividing streamline upstream of the rear stagnation point (the circle wall and the incoming stagnation streamline), but not across the rear stagnation streamline.\nThese singularities are caused by the streamline integral  . In section 4 we argued\nthat the streamline integral behaves as 5 2 / 1 2 / 2\nmin min kr r\n       \n in terms of the distance of the\nstreamline to the rear stagnation point/trailing edge. Since k = 1 for the circle, we expect that 3minr  at the rear stagnation point and 3/2d  at the wall and the incoming stagnation streamline, which is confirmed in Figure 8, Figure 9 and Figure 10. Figure 8 plots the value of the integral  at several points placed along a vertical line crossing the incoming stagnation streamline (the x axis) as indicated in Figure 6. This value is fitted against the distance d to the stagnation streamline, yielding 1.47d  , which is close to the theoretical prediction and to the value 1.46d  obtained at the wall (Figure 9), but\nalso against the minimum distance of the streamline to the rear stagnation point minr , yielding 2.9minr  , which is close to the theoretical value and to the value of the exponent obtained for the rear stagnation point (Figure 10). Finally, the integral vanishes linearly d across the rear stagnation streamline (Figure 11), which is not singular.\n\nWe have argued above that the behavior at the wall and stagnation streamline is essentially governed by the singularity exponent at the rear singularity, which is thus the primary singularity. The results in Figure 8, Figure 9 do support this idea, which is further illustrated with Figure 12 and Figure 13. Figure 12 (left) shows the value of \u039e along the streamlines shown on the right plot. It can be clearly seen that the integral is quite approximately constant upstream of the trailing edge region and negligible downstream, and that the upstream value grows as the streamline approaches the dividing streamline\n(the downstream value, on the other hand, approaches zero), as expected. Figure 13, which focuses on the outermost streamline of Figure 12, plots the running value of \u039e along the streamline, as well as 2 (1) 2 (2)2 (1 )s sI q q          , which is the integrand in \u039e. It is clear that the main contribution to the integral comes from the region near the rear stagnation point, with a negligible contribution from the leading edge region.\nFigure 12. Left: running value of\n0( )x along the streamlines indicated on the right plot. The\nforward and rear stagnation points are located at 0.5x  and 0.5x  , respectively.\n      and\nx -1 -0.8 -0.6 -0.4 -0.2 0 0.2 0.4 0.6 0.8 1\n10 -3\n10 -2\n10 -1\n10 0\n10 1\n10 2\n10 3\n10 4\n10 5\n\nx\ny\n-0.8 -0.7 -0.6 -0.5 -0.2\n-0.15\n-0.1\n-0.05\n0\n0.05\n0.1\n0.15\n0.2\nx\nI\n-0.8 -0.6 -0.4 -0.2 0 0.2 0.4 0.6 0.8 1\n0\n10\n20\n0\n0.0003\n0.0006\n0.0009\n0.0012\n I 1 +I 2 I 1 I 1\n\nFinally, Figure 14 plots the value of the linearized functionals (1) 1 2 3( , )I v    \nand (2) 2 3I v u   on the circle wall. These quantities have a finite value throughout the wall (except (1)I , which diverges at the trailing edge), as expected.\nFigure 14. (1)\n1 2 3( , )I v     and\n(2) 2 3I v u   at the wall computed with the analytic lift-\nbased adjoint solution for incompressible, inviscid flow past a circle.\n5.2. Airfoil with Finite Trailing-Edge Angle\nThe second case involves incompressible, inviscid flow at angle of attack \u03b1 = 0\u00ba past a symmetrical van de Vooren airfoil given by the conformal transformation (Katz & Plotkin, 2001)\n1\n( ) 1,\n( )\nk\nk\nR z\nR\n       \n(69)\nwhere 1(1 ) / 2k kR    ,  is a thickness parameter and k is related to the trailing-edge\nangle  as 2 /k    . The transformation (69) maps the airfoil in the z plane to a circle of radius R centered at the origin in the  plane. In this paper, we set 0.0371  and\n86 / 45k  , resulting in an airfoil with 12% thickness and finite trailing edge angle 16   that is shown in Figure 15, where the analytic flow solution obtained with conformal transformation techniques is also depicted. The analytic flow solution can be found in (Katz & Plotkin, 2001) and can be obtained from the solution in the circle plane\n(24) and the transformation (69) as      / / / . airfoil u iv d d dz d   \nx\n 1 +\nu \nx +\nv \ny\n-0.5 -0.25 0 0.25 0.5\n-50\n0\n50\nx\nv \nx -\nu \ny\n-0.5 -0.25 0 0.25 0.5\n-7\n-6\n-5\n-4\n-3\n-2\n-1\n0\nUsing this analytic flow solution, the corresponding analytic adjoint solutions can be computed using Eq. (56) and (60). Figure 16 shows the analytic drag-based adjoint solution. This solution has been compared to numerical solutions obtained by discretizing the adjoint equation directly in (Lozano & Ponsin, 2021) (Lozano & Ponsin, 2022).\nAs for lift, the computation of the analytic adjoint solution is carried out with the fourth-order Runge-Kutta integrator described above. The streamline tracing is performed\nin the circle plane and then translated into the airfoil plane via the conformal transformation (69). Contour maps of the analytic lift adjoint solution obtained in this way are shown in Figure 17. Again, a comparison of this solution to numerical adjoint solutions can be found in (Lozano & Ponsin, 2022).\nAs in the circle case, the analytic solution shows singularities at the wall, across the incoming stagnation streamline and at the trailing edge, but not across the rear stagnation streamline. This is more clearly illustrated in Figure 18, Figure 19, Figure 20 and Figure 21, which plot the streamline integral  along lines approaching the stagnation streamline upstream of the airfoil, the wall, the trailing edge and the rear stagnation streamline, respectively, as indicated in Figure 17. In all cases, the behavior of the integral has been illustrated by fitting the curves to a power of the distance to the dividing streamline or the trailing edge as appropriate. At both the incoming stagnation streamline\nand the wall, the integral diverges as roughly 0.581/ d , where d is the distance to the\nstagnation streamline or to the wall. Noting that 86 / 45k  for the present case, the exponent is close to the theoretical prediction 53/90 0.5891/ 1/d d  . At the trailing edge, the integral shows a 0.611/ r singularity (where r is the distance to the trailing edge)\nregardless of the inclination of the line, which is again in agreement with the theoretical prediction 53/86 0.6161/ 1/r r  . Finally, the streamline integral vanishes as d at the\nstagnation streamline downstream of the trailing edge.\nFigure 22 shows the value of 2 (1) 2 (2)2 (1 )s sI q q          along a streamline originating near the stagnation streamline upstream of the airfoil. It is clear, as in the previous case, that the main contribution to the integral comes from the region near the trailing edge, with a negligible contribution from the leading edge region.\n\nTo end the analysis of the airfoil solution, Figure 23 focuses on the behavior of the adjoint solution near the airfoil profile. In the plot, the first component of the analytic adjoint solution is shown for a succession of O-shaped curves surrounding the van der Vooren airfoil profile and progressively closer to it, clearly demonstrating the divergence of the analytic solution at the wall. It is clear that the anomaly observed in numerical computations (Lozano, 2019) (Peter, et al., 2022) (Lozano & Ponsin, 2022) is caused by a divergence of the analytic solution at the wall. On the numerical side, the numerical viscosity of the solver stabilizes the divergence, producing a finite value at the profile which nevertheless varies continually as the grid spacing or the intensity of the numerical dissipation change (Lozano & Ponsin, 2021). At any rate, while the adjoint variables diverge at the wall, the linearized functionals (1)I and (2)I (66) are again finite across the profile (except (1)I which diverges at the trailing edge) as shown in Figure 24.\nFrame 001  28 Jul 2021 \nFigure 24. (1)\n1 2 3( , )I v     and\n(2) 2 3I v u   on the airfoil profile computed with the\nanalytic lift-based adjoint solution for incompressible, inviscid flow at \u03b1 = 0\u00ba past a van de Vooren airfoil with trailing-edge angle 16   and 12% thickness."
        },
        {
            "heading": "6. Conclusions",
            "text": "In this paper, we have investigated the adjoint solutions for the two-dimensional incompressible Euler equations. By restricting to irrotational base flows, it is possible to derive a closed form solution to the adjoint equations using the Green's function approach developed by Giles and Pierce (Giles & Pierce, 2001). Drag-based and lift-based analytic\nx\n 1 +\nu \nx +\nv \ny\n0 0.2 0.4 0.6 0.8 1 -20\n-15\n-10\n-5\n0\n5\n10\n15\n20\nx\nv \nx -\nu \ny\n0 0.2 0.4 0.6 0.8 1\n-1\n-0.5\n0\nadjoint solutions have been obtained in this way, and they should be of help as test cases for verification of numerical adjoint solvers.\nThe drag-based adjoint solution is smooth and has a particularly simple closed-form expression in terms of the flow variables. For the type of flows considered in this paper, drag is zero for the analytic solution and has thus no practical application for shape design. The drag-based adjoint solution is, however, non-trivial and can be used for verification purposes. Likewise, if drag fails to vanish in a discrete flow solution, the drag-adjoint solution can be used to build a cheap mesh adaptation indicator that will identify those flow regions responsible for the failure, in analogous fashion to the entropy adjoint approach (Fidkowski & Roe, 2010).\nThe lift-based adjoint solution, on the other hand, is considerably more complex, and exhibits a number of distinctive features, some of which had been already anticipated in the literature (Giles & Pierce, 1997) but are now fully clarified. The lift adjoint solution shows a singularity at the trailing edge/rear stagnation point that corresponds to perturbations to the Kutta condition. The sensitivity of the Kutta condition to perturbations to the stagnation pressure gives rise to an additional singularity structure along the dividing streamline upstream of the rear singularity, resulting in adjoint singularities at the wall and the incoming stagnation streamline, where the adjoint solution diverges with identical exponents that nevertheless depend on the trailing edge angle. Since the analytic lift-adjoint solution is singular at walls, this finally settles the issue of the mesh divergence of inviscid adjoint solutions at solid walls (Lozano, 2019) (Peter, et al., 2022).\nIt would be interesting to extend this analysis to compressible flow. The task was initiated in (Giles & Pierce, 1997), where four linearly independent source terms were defined and a preliminary analysis was carried out. However, obtaining the exact adjoint solutions would require to compute the Green\u2019s functions corresponding to these source terms or, at least, their effect on drag and lift. To the best of our knowledge, this is an open problem which appears very difficult to solve exactly, particularly for transonic flows. At any rate, preliminary analysis (Giles & Pierce, 1997) (Peter, et al., 2022) shows that adjoint variables are continuous at shocks, albeit with discontinuous derivatives, and at sonic lines, as long as they are not orthogonal to the flow. On the other hand, numerical compressible adjoint solutions do show singularities along the incoming stagnation streamline (Giles & Pierce, 1997) (Peter, et al., 2022), at the trailing edge/rear stagnation point (Giles & Pierce, 1997) (Lozano, 2018) (Lozano, 2019) (Peter, et al., 2022), and at walls (in the form of mesh-diverging adjoint solutions) (Lozano, 2019) (Peter, et al., 2022), which are the analog of the singularities found in incompressible flow, but also along certain supersonic characteristics (Lozano, 2018) (Peter, et al., 2022) without an analog in the incompressible case. The former singularities are likely governed by a mechanism similar to the one described in this paper (this has already been proven for the incoming stagnation streamline in (Giles & Pierce, 1997)), and probably with the same exponents, at least for subsonic flows.\nGiles and Pierce\u2019s seminal work (Giles & Pierce, 2001) has just turned 20 years old. We would like to finish by quoting their closing remarks which are still as valid today as they were then: \u201cAn improved understanding of the behavior of adjoint solutions is necessary both to rigorously establish the theoretical basis for engineering optimal design methods and to illuminate the role of the adjoint solution in numerical error analysis. (\u2026) Future developments along these lines will lead to great improvements in accuracy for key engineering quantities such as lift and drag.\u201d We couldn\u2019t agree more.\nFunding\nThe research described in this paper has been supported by INTA and the Ministry of Defence of Spain under grants Termofluidodin\u00e1mica (IGB99001) and IDATEC (IGB21001).\nDeclaration of Interests\nThe authors report no conflict of interest."
        }
    ],
    "title": "Analytic Adjoint Solutions for the 2D Incompressible Euler Equations Using the Green\u2019s Function Approach",
    "year": 2022
}
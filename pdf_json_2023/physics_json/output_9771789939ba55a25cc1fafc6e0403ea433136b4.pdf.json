{
    "abstractText": "Following the assumption that chemically similar molecules exhibit similar biologcial properties, ligand-based virtual screening can be a valuable starting point in drug discovery projects. While 2D-based similarity metrics generally focus on similar scaffolds or substructures, 3D-based methods can capture the shape of a molecule, allowing for the identification of compounds with different scaffolds. We recently published a proof-of-concept study which demonstrated how a Transformer model can be adapted to preserve 2D similarities in latent space in the form of Euclidean distances. In this work, we extend this research and prove that the approach can be adapted to 3D similarities. We use pharmacophorebased shape similarity as 3D similarity measure. We show that the model is able to enrich the predicted most similar hits with compounds with different scaffolds that are indeed similar in 3D space. Whereas classical pharmacophoreor shape-based 3D similarity methods rely on expensive alignment processes, in our approach, we identify similar compounds directly by the Euclidean distances in latent space. This enables for the first time the 3D screening of ultra-large databases with high efficiency.",
    "authors": [
        {
            "affiliations": [],
            "name": "Manuel S. Sellner"
        },
        {
            "affiliations": [],
            "name": "Amr H. Mahmoud"
        },
        {
            "affiliations": [],
            "name": "Markus A. Lill"
        }
    ],
    "id": "SP:c1fd1c90cd141c8a1e7575a7501f46f7b2787831",
    "references": [
        {
            "authors": [
                "A. Luttens",
                "H. Gullberg",
                "E. Abdurakhmanov",
                "D.D. Vo",
                "D. Akaberi",
                "V.O. Talibov",
                "N. Nekhotiaeva",
                "L. Vangeel",
                "S. De Jonghe",
                "D. Jochmans",
                "J. Krambrich",
                "A. Tas",
                "B. Lundgren",
                "Y. Gravenfors",
                "A.J. Craig",
                "Y. Atilaw",
                "A. Sandstr\u00f6m",
                "L.W.K. Moodie",
                "A. Lundkvist",
                "M.J. Hemert",
                "J. Neyts",
                "J. Lennerstrand",
                "J. Kihlberg",
                "K. Sandberg",
                "U.H. Danielson",
                "J. Carlsson"
            ],
            "title": "Ultralarge Virtual Screening Identifies SARS-CoV-2 Main Protease Inhibitors with Broad-Spectrum Activity against Coronaviruses",
            "venue": "Journal of the American Chemical Society",
            "year": 2022
        },
        {
            "authors": [
                "P.A. Bonilla",
                "C.L. Hoop",
                "K. Stefanisko",
                "S.G. Tarasov",
                "S. Sinha",
                "M.C. Nicklaus",
                "N.I. Tarasova"
            ],
            "title": "Virtual screening of ultra-large chemical libraries identifies cell-permeable small-molecule inhibitors of a \u201cnon-druggable\u201d target, STAT3",
            "venue": "Nterminal domain. Frontiers in Oncology",
            "year": 2023
        },
        {
            "authors": [
                "C. Gorgulla",
                "K.M. Padmanabha Das",
                "K.E. Leigh",
                "M. Cespugli",
                "P.D. Fischer",
                "Wang",
                "Z.-F",
                "G. Tesseyre",
                "S. Pandita",
                "A. Shnapir",
                "A. Calderaio",
                "M. Gechev",
                "A. Rose",
                "N. Lewis",
                "C. Hutcheson",
                "E. Yaffe",
                "R. Luxenburg",
                "H.D. Herce",
                "V. Durmaz",
                "T.D. Halazonetis",
                "K. Fackeldey",
                "J.J. Patten",
                "A. Chuprina",
                "I. Dziuba",
                "A. Plekhova",
                "Y. Moroz",
                "D. Radchenko",
                "O. Tarkhanova",
                "I. Yavnyuk",
                "C. Gruber",
                "R. Yust",
                "D. Payne",
                "A.M. N\u00e4\u00e4r",
                "M.N. Namchuk",
                "R.A. Davey",
                "G. Wagner",
                "J. Kinney",
                "H. Arthanari"
            ],
            "title": "A multi-pronged approach targeting SARS-CoV- 2 proteins using ultra-large virtual screening",
            "venue": "iScience",
            "year": 2021
        },
        {
            "authors": [
                "C. Gorgulla",
                "A. Boeszoermenyi",
                "Wang",
                "Z.-F",
                "P.D. Fischer",
                "P.W. Coote",
                "K.M. Padmanabha Das",
                "Y.S. Malets",
                "D.S. Radchenko",
                "Y.S. Moroz",
                "D.A. Scott",
                "K. Fackeldey",
                "M. Hoffmann",
                "I. Iavniuk",
                "G. Wagner",
                "H. Arthanari"
            ],
            "title": "An open-source drug discovery platform enables ultra-large virtual screens",
            "year": 2023
        },
        {
            "authors": [
                "T.S. Chisholm",
                "M. Mackey",
                "C.A. Hunter"
            ],
            "title": "Discovery of High-Affinity Amyloid Ligands Using a Ligand-Based Virtual Screening Pipeline",
            "venue": "Journal of the American Chemical Society",
            "year": 2023
        },
        {
            "authors": [
                "D. Zhu",
                "S. Johannsen",
                "T. Masini",
                "C. Simonin",
                "J. Haupenthal",
                "B. Illarionov",
                "A. Andreas",
                "M. Awale",
                "R.M. Gierse",
                "T. Laan",
                "R. Vlag",
                "R. Nasti",
                "M. Poizat",
                "E. Buhler",
                "N. Reiling",
                "R. M\u00fcller",
                "M. Fischer",
                "Reymond",
                "J.-L",
                "Hirsch"
            ],
            "title": "A.K.H.: Discovery of novel drug-like antitubercular hits targeting the MEP pathway enzyme DXPS by strategic application of ligand-based virtual screening",
            "venue": "Chemical Science",
            "year": 2022
        },
        {
            "authors": [
                "S. Zhao",
                "X. Li",
                "W. Peng",
                "L. Wang",
                "W. Ye",
                "Y. Zhao",
                "W. Yin",
                "Chen",
                "W.-D",
                "W. Li",
                "Wang",
                "Y.-D"
            ],
            "title": "Ligand-based pharmacophore modeling, virtual screening and biological evaluation to identify novel TGR5 agonists",
            "venue": "RSC Advances",
            "year": 2021
        },
        {
            "authors": [
                "D. M\u00e9ndez-\u00c1lvarez",
                "M.F. Torres-Rojas",
                "E.E. Lara-Ramirez",
                "L.A. Marchat",
                "G. Rivera"
            ],
            "title": "Ligand-Based Virtual Screening, Molecular Docking, and Molecular Dynamic Simulations of New \u03b2-Estrogen Receptor Activators with Potential for Pharmacological Obesity Treatment",
            "year": 2023
        },
        {
            "authors": [
                "I. Muegge",
                "P. Mukherjee"
            ],
            "title": "An overview of molecular fingerprint similarity search in virtual screening",
            "venue": "Expert Opinion on Drug Discovery",
            "year": 2016
        },
        {
            "authors": [
                "A. Kumar",
                "Zhang"
            ],
            "title": "K.Y.J.: Advances in the Development of Shape Similarity Methods and Their Application in Drug Discovery",
            "venue": "Frontiers in Chemistry",
            "year": 2018
        },
        {
            "authors": [
                "M.P. Seddon",
                "D.A. Cosgrove",
                "M.J. Packer",
                "V.J. Gillet"
            ],
            "title": "Alignment-Free Molecular Shape Comparison Using Spectral Geometry: The Framework",
            "venue": "Journal of Chemical Information and Modeling",
            "year": 2019
        },
        {
            "authors": [
                "G.M. Sastry",
                "S.L. Dixon",
                "W. Sherman"
            ],
            "title": "Rapid Shape-Based Ligand Alignment and Virtual Screening Method Based on Atom/Feature-Pair Similarities and Volume Overlap Scoring",
            "venue": "Journal of Chemical Information and Modeling",
            "year": 2011
        },
        {
            "authors": [
                "M. Michino",
                "A. Beautrait",
                "N.A. Boyles",
                "A. Nadupalli",
                "A. Dementiev",
                "S. Sun",
                "J. Ginn",
                "L. Baxt",
                "R. Suto",
                "R. Bryk",
                "S.V. Jerome",
                "D.J. Huggins",
                "J. Vendome"
            ],
            "title": "Shape-Based Virtual Screening of a Billion-Compound Library Identifies Mycobacterial Lipoamide Dehydrogenase Inhibitors",
            "venue": "ACS Bio & Med Chem Au",
            "year": 2023
        },
        {
            "authors": [
                "D. Stumpfe",
                "J. Bajorath"
            ],
            "title": "Similarity searching",
            "venue": "WIREs Computational Molecular Science",
            "year": 2011
        },
        {
            "authors": [
                "O. Laufk\u00f6tter",
                "T. Miyao",
                "J. Bajorath"
            ],
            "title": "Large-Scale Comparison of Alternative Similarity Search Strategies with Varying Chemical Information Contents",
            "venue": "ACS Omega",
            "year": 2019
        },
        {
            "authors": [
                "Y. Bengio",
                "A. Courville",
                "P. Vincent"
            ],
            "title": "Representation Learning: A Review and New Perspectives",
            "venue": "IEEE Transactions on Pattern Analysis and Machine Intelligence",
            "year": 2023
        },
        {
            "authors": [
                "K.T. Baghaei",
                "A. Payandeh",
                "P. Fayyazsanavi",
                "S. Rahimi",
                "Z. Chen",
                "S.B. Ramezani"
            ],
            "title": "Deep representation learning: Fundamentals, Perspectives, Applications, and Open Challenges",
            "year": 2022
        },
        {
            "authors": [
                "X. Liu",
                "J. Gao",
                "X. He",
                "L. Deng",
                "K. Duh",
                "Wang",
                "Y.-Y"
            ],
            "title": "Representation Learning Using Multi-Task Deep Neural Networks for Semantic Classification and Information Retrieval. In: Proceedings of the 2015 Conference of the North American Chapter of the Association for Computational Linguistics: Human Language Technologies, pp. 912\u2013921",
            "venue": "Association for Computational Linguistics,",
            "year": 2015
        },
        {
            "authors": [
                "Q. Meng",
                "H. Qian",
                "Y. Liu",
                "Y. Xu",
                "Z. Shen",
                "L. Cui"
            ],
            "title": "Unsupervised Representation Learning for Time Series: A Review",
            "year": 2023
        },
        {
            "authors": [
                "J. Qian",
                "Z. Song",
                "Y. Yao",
                "Z. Zhu",
                "X. Zhang"
            ],
            "title": "A review on autoencoder based representation learning for fault detection and diagnosis in industrial processes",
            "venue": "Chemometrics and Intelligent Laboratory Systems",
            "year": 2022
        },
        {
            "authors": [
                "A. Suhaimi",
                "A.W.H. Lim",
                "X.W. Chia",
                "C. Li",
                "H. Makino"
            ],
            "title": "Representation learning in the artificial and biological neural networks underlying sensorimotor integration",
            "venue": "Science Advances 8(22),",
            "year": 2022
        },
        {
            "authors": [
                "X. Fang",
                "L. Liu",
                "J. Lei",
                "D. He",
                "S. Zhang",
                "J. Zhou",
                "F. Wang",
                "H. Wu",
                "H. Wang"
            ],
            "title": "Geometry-enhanced molecular representation learning for property prediction",
            "venue": "Nature Machine Intelligence",
            "year": 2022
        },
        {
            "authors": [
                "P.H. Le-Khac",
                "G. Healy",
                "A.F. Smeaton"
            ],
            "title": "Contrastive Representation Learning: A Framework and Review",
            "venue": "IEEE Access",
            "year": 2020
        },
        {
            "authors": [
                "S. Chopra",
                "R. Hadsell",
                "Y. LeCun"
            ],
            "title": "Learning a Similarity Metric Discriminatively, with Application to Face Verification",
            "venue": "IEEE Computer Society Conference on Computer Vision and Pattern Recognition (CVPR\u201905),",
            "year": 2005
        },
        {
            "authors": [
                "F. Schroff",
                "D. Kalenichenko",
                "J. Philbin"
            ],
            "title": "FaceNet: A unified embedding for face recognition and clustering",
            "venue": "IEEE Conference on Computer Vision and Pattern Recognition (CVPR),",
            "year": 2015
        },
        {
            "authors": [
                "H.O. Song",
                "Y. Xiang",
                "S. Jegelka",
                "S. Savarese"
            ],
            "title": "Deep Metric Learning via Lifted Structured Feature Embedding",
            "venue": "IEEE Conference on Computer Vision and Pattern Recognition (CVPR),",
            "year": 2016
        },
        {
            "authors": [
                "K. Sohn"
            ],
            "title": "Improved Deep Metric Learning with Multi-class N-pair Loss Objective",
            "venue": "Advances in Neural Information Processing Systems",
            "year": 2016
        },
        {
            "authors": [
                "M. Gutmann",
                "A. Hyv\u00e4rinen"
            ],
            "title": "Noise-contrastive estimation: A new estimation principle for unnormalized statistical models",
            "venue": "JMLR Workshop and Conference Proceedings",
            "year": 2010
        },
        {
            "authors": [
                "M.S. Sellner",
                "A.H. Mahmoud",
                "M.A. Lill"
            ],
            "title": "Efficient virtual high-content screening using a distance-aware transformer model",
            "venue": "Journal of Cheminformatics 15(1),",
            "year": 2023
        },
        {
            "authors": [
                "S. Budd",
                "E.C. Robinson",
                "B. Kainz"
            ],
            "title": "A survey on active learning and human-inthe-loop deep learning for medical image analysis",
            "venue": "Medical Image Analysis",
            "year": 2021
        },
        {
            "authors": [
                "S.U. Amin",
                "A. Hussain",
                "B. Kim",
                "S. Seo"
            ],
            "title": "Deep learning based active learning technique for data annotation and improve the overall performance of classification models",
            "venue": "Expert Systems with Applications 228,",
            "year": 2023
        },
        {
            "authors": [
                "H.S. Seung",
                "M. Opper",
                "H. Sompolinsky"
            ],
            "title": "Query by committee",
            "venue": "Proceedings of the Fifth Annual Workshop on Computational Learning Theory,",
            "year": 1992
        },
        {
            "authors": [
                "Y. Freund",
                "H.S. Seung",
                "E. Shamir",
                "N. Tishby"
            ],
            "title": "Selective Sampling Using the Query by Committee Algorithm",
            "venue": "Machine Learning",
            "year": 1997
        },
        {
            "authors": [
                "H. Hino",
                "S. Eguchi"
            ],
            "title": "Active learning by query by committee with robust divergences",
            "venue": "Information Geometry",
            "year": 2023
        },
        {
            "authors": [
                "M. Ducoffe",
                "F. Precioso"
            ],
            "title": "QBDC: Query by dropout committee for training deep supervised architecture",
            "year": 2015
        },
        {
            "authors": [
                "W. Cai",
                "Y. Zhang",
                "J. Zhou"
            ],
            "title": "Maximizing Expected Model Change for Active Learning in Regression",
            "venue": "IEEE 13th International Conference on Data Mining, pp. 51\u201360",
            "year": 2013
        },
        {
            "authors": [
                "S.H. Park",
                "S.B. Kim"
            ],
            "title": "Robust expected model change for active learning in regression",
            "venue": "Applied Intelligence",
            "year": 2020
        },
        {
            "authors": [
                "J.J. Irwin",
                "K.G. Tang",
                "J. Young",
                "C. Dandarchuluun",
                "B.R. Wong",
                "M. Khurelbaatar",
                "Y.S. Moroz",
                "J. Mayfield",
                "R.A. Sayle"
            ],
            "title": "ZINC20\u2014A Free Ultralarge-Scale Chemical Database for Ligand Discovery",
            "venue": "Journal of Chemical Information and Modeling",
            "year": 2020
        },
        {
            "authors": [
                "K.S. Watts",
                "P. Dalal",
                "R.B. Murphy",
                "W. Sherman",
                "R.A. Friesner",
                "J.C. Shelley"
            ],
            "title": "ConfGen: A Conformational Search Method for Efficient Generation of Bioactive Conformers",
            "venue": "Journal of Chemical Information and Modeling",
            "year": 2010
        },
        {
            "authors": [
                "D.S. Wishart",
                "Y.D. Feunang",
                "A.C. Guo",
                "E.J. Lo",
                "A. Marcu",
                "J.R. Grant",
                "T. Sajed",
                "D. Johnson",
                "C. Li",
                "Z. Sayeeda",
                "N. Assempour",
                "I. Iynkkaran",
                "Liu"
            ],
            "title": "CC-BY-NC 4.0 International license perpetuity. It is made available under a preprint (which was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in The copyright holder for this this version posted November 17, 2023",
            "venue": "Nucleic Acids Research 46(D1),",
            "year": 2023
        },
        {
            "authors": [
                "W. Shelly",
                "M.W. Draper",
                "V. Krishnan",
                "M. Wong",
                "R.B. Jaffe"
            ],
            "title": "Selective Estrogen Receptor Modulators: An Update on Recent Clinical Findings",
            "venue": "Obstetrical & Gynecological Survey",
            "year": 2008
        },
        {
            "authors": [
                "D.J. Cada",
                "D.E. Baker"
            ],
            "title": "Conjugated Estrogens and Bazedoxifene",
            "venue": "Hospital Pharmacy 49(3),",
            "year": 2014
        },
        {
            "authors": [
                "M.B. Sporn"
            ],
            "title": "Arzoxifene: A Promising New Selective Estrogen Receptor Modulator for Clinical Chemoprevention of Breast Cancer",
            "venue": "Clinical Cancer Research",
            "year": 2004
        },
        {
            "authors": [
                "J. Liu",
                "H. Liu",
                "R.B. Breemen",
                "G.R.J. Thatcher",
                "J.L. Bolton"
            ],
            "title": "Bioactivation of the Selective Estrogen Receptor Modulator Acolbifene to Quinone Methides",
            "venue": "Chemical Research in Toxicology 18(2),",
            "year": 2005
        },
        {
            "authors": [
                "T.A. Blizzard",
                "F. DiNinno",
                "J.D. Morgan",
                "J.Y. Wu",
                "H.Y. Chen",
                "S. Kim",
                "W. Chan",
                "E.T. Birzin",
                "Y.T. Yang",
                "Pai",
                "L.-Y",
                "Z. Zhang",
                "E.C. Hayes",
                "C.A. DaSilva",
                "W. Tang",
                "S.P. Rohrer",
                "J.M. Schaeffer",
                "M.L. Hammond"
            ],
            "title": "Estrogen receptor ligands. Part 8: Dihydrobenzoxathiin SERAMs with heteroatom-substituted side chains",
            "venue": "Bioorganic & Medicinal Chemistry Letters",
            "year": 2004
        },
        {
            "authors": [
                "T.H. Pham",
                "Y.L. Page",
                "F. Percevault",
                "F. Ferri\u00e8re",
                "G. Flouriot",
                "F. Pakdel"
            ],
            "title": "Apigenin, a Partial Antagonist of the Estrogen Receptor (ER), Inhibits ER-Positive Breast Cancer Cell Proliferation through Akt/FOXM1 Signaling",
            "venue": "International Journal of Molecular Sciences",
            "year": 2201
        },
        {
            "authors": [
                "T.T.Y. Wang",
                "N. Sathyamoorthy",
                "J.M. Phang"
            ],
            "title": "Molecular effects of genistein on estrogen receptor mediated pathways. Carcinogenesis",
            "year": 1996
        },
        {
            "authors": [
                "C. Montani",
                "M. Penza",
                "M. Jeremic",
                "G. Biasiotto",
                "G. La Sala",
                "M. De Felici",
                "P. Ciana",
                "A. Maggi",
                "D. Di Lorenzo"
            ],
            "title": "Genistein is an Efficient Estrogen in the Whole-Body throughout Mouse Development",
            "venue": "Toxicological Sciences",
            "year": 2008
        },
        {
            "authors": [
                "W. Zhang",
                "J. Chen",
                "I. Aguilera-Barrantes",
                "C. Shiau",
                "X. Sheng",
                "L. Wang",
                "G.D. Stoner",
                "Y. Huang"
            ],
            "title": "Urolithin A suppresses the proliferation of endometrial cancer cells by mediating estrogen receptor-\u03b1-dependent gene expression",
            "venue": "Molecular Nutrition & Food Research",
            "year": 2016
        },
        {
            "authors": [
                "K.K.L. Chan",
                "M.K.Y. Siu",
                "Jiang",
                "Y.-x",
                "Wang",
                "J.-j",
                "T.H.Y. Leung",
                "H.Y.S. Ngan"
            ],
            "title": "Estrogen receptor modulators genistein, daidzein and ERB-041 inhibit cell migration, invasion, proliferation and sphere formation via modulation of FAK and PI3K/AKT signaling in ovarian cancer",
            "venue": "Cancer Cell International 18(1),",
            "year": 2018
        },
        {
            "authors": [
                "A.K. Death",
                "K.C.Y. McGrath",
                "R. Kazlauskas",
                "D.J. Handelsman"
            ],
            "title": "Tetrahydrogestrinone Is a Potent Androgen and Progestin. The Journal of Clinical 18 . CC-BY-NC 4.0 International license perpetuity. It is made available under a preprint (which was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in The copyright holder for this this version posted November 17, 2023",
            "year": 2004
        },
        {
            "authors": [
                "A. Gillon",
                "E.N.M. Ho",
                "G.H.M. Chan",
                "A. Kauff",
                "G. Hughes",
                "R.A. Lund",
                "Z. Ashley",
                "T.S.M. Wan",
                "A.K. Heather"
            ],
            "title": "Unravelling androgens in sport: Altrenogest shows strong activation of the androgen receptor in a mammalian cell bioassay",
            "venue": "Drug Testing and Analysis",
            "year": 2021
        },
        {
            "authors": [
                "C. Bonne",
                "Raynaud",
                "J.-P"
            ],
            "title": "Methyltrienolone, a specific ligand for cellular androgen receptors",
            "venue": "Steroids",
            "year": 1975
        },
        {
            "authors": [
                "H. Rozenbaum"
            ],
            "title": "Relationships between chemical structure and biological properties of progestogens",
            "venue": "American Journal of Obstetrics and Gynecology 142(6),",
            "year": 1982
        },
        {
            "authors": [
                "H. Tian",
                "R. Liu",
                "S. Zhang",
                "S. Wei",
                "W. Wang",
                "S. Ru"
            ],
            "title": "17\u03b2-Trenbolone binds to androgen receptor, decreases number of primordial germ cells, modulates expression of genes related to sexual differentiation, and affects sexual differentiation in zebrafish (Danio rerio)",
            "venue": "Science of The Total Environment",
            "year": 2022
        },
        {
            "authors": [
                "H.J. Kloosterboer",
                "C.A. Vonk-Noordegraaf",
                "E.W. Turpijn"
            ],
            "title": "Selectivity in progesterone and androgen receptor binding of progestagens used in oral contraceptives",
            "venue": "Contraception 38(3),",
            "year": 1988
        },
        {
            "authors": [
                "D.L.J. Thorek",
                "A.T. Ku",
                "N. Mitsiades",
                "D. Veach",
                "P.A. Watson",
                "D. Metha",
                "Strand",
                "S.-E",
                "S.K. Sharma",
                "J.S. Lewis",
                "D.S. Abou",
                "H.G. Lilja",
                "S.M. Larson",
                "M.R. McDevitt",
                "D. Ulmert"
            ],
            "title": "Harnessing Androgen Receptor Pathway Activation for Targeted Alpha Particle Radioimmunotherapy of Breast Cancer",
            "venue": "Clinical Cancer Research",
            "year": 2019
        },
        {
            "authors": [
                "H. Kuhl"
            ],
            "title": "Pharmacology of estrogens and progestogens: influence of different routes of administration",
            "venue": "Climacteric 8(sup1),",
            "year": 2005
        },
        {
            "authors": [
                "M. Shamseddin",
                "F. De Martino",
                "C. Constantin",
                "V. Scabia",
                "A. Lancelot",
                "C. Laszlo",
                "A. Ayyannan",
                "L. Battista",
                "W. Raffoul",
                "M. Gailloud-Matthieu",
                "P. Bucher",
                "M. Fiche",
                "G. Ambrosini",
                "G. Sflomos",
                "C. Brisken"
            ],
            "title": "Contraceptive progestins with androgenic properties stimulate breast epithelial cell proliferation",
            "venue": "EMBO Molecular Medicine",
            "year": 2021
        },
        {
            "authors": [
                "M. Krenn",
                "F. H\u00e4se",
                "A. Nigam",
                "P. Friederich",
                "A. Aspuru-Guzik"
            ],
            "title": "Self-referencing embedded strings (SELFIES): A 100% robust molecular string representation",
            "venue": "Machine Learning: Science and Technology",
            "year": 2020
        },
        {
            "authors": [
                "M. Krenn",
                "Q. Ai",
                "S. Barthel",
                "N. Carson",
                "A. Frei",
                "N.C. Frey",
                "Friederich"
            ],
            "title": "International license perpetuity. It is made available under a preprint (which was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in The copyright holder for this this version posted November 17, 2023",
            "year": 2022
        },
        {
            "authors": [
                "N.M. O\u2019Boyle",
                "M. Banck",
                "C.A. James",
                "C. Morley",
                "T. Vandermeersch",
                "G.R. Hutchison"
            ],
            "title": "Open Babel: An open chemical toolbox",
            "venue": "Journal of Cheminformatics 3(1),",
            "year": 2011
        },
        {
            "authors": [
                "A. Vaswani",
                "N. Shazeer",
                "N. Parmar",
                "J. Uszkoreit",
                "L. Jones",
                "A.N. Gomez",
                "L. Kaiser",
                "I. Polosukhin"
            ],
            "title": "Attention Is All You Need",
            "venue": "Advances in Neural Information Processing Systems 2017-December,",
            "year": 2023
        }
    ],
    "sections": [
        {
            "text": "Keywords: Similarity search, Deep learning, Transformer model, High throughput screening, Virtual screening"
        },
        {
            "heading": "1 Introduction",
            "text": "Virtual screenings of ultra-large compound libraries are receiving increasing attention in the scientific community[1\u20133]. While some virtual screening strategies rely on structure-based approaches [4], most use ligand-based methods due to their simplicity and computational efficiency [5\u20138]. In this work, we explore a novel method to accelerate 3D ligand-based ultra-large virtual screening using a Transformer-based deep neural network."
        },
        {
            "heading": "1.1 Similarity Search",
            "text": "Ligand-based similarity methods are widely used because of their computational efficiency, which is orders of magnitude faster than classical structure-based virtual screening methods. Ligand-based similarity concepts assume that chemically similar molecules exhibit similar biological activity [9, 10]. Common 2D similarity search consists of the extraction and comparison of molecular features. Usually, these features are stored in binary vectors (fingerprints) which can be easily compared using, e.g., the Tversky index, Tanimoto, or Dice coefficient. Due to the simplicity of this approach, these methods are usually fast enough to allow the screening of more than a billion compounds in a matter of hours.\nOn the other hand, 3D similarity methods are usually more computationally demanding. While alignment-free methods may still be computationally feasible [11], the usually more accurate alignment-based methods, such as pharmacophore or shape screening, come with an increased computational cost [12]. Nevertheless, it has been shown that even these computationally demanding methods can be used to screen billions of compounds with the right hardware. For example, Michino et al. screened approximately 1.12 billion compounds in 19.5 hours using 216 GPUs [13]. Given that not everyone has access to such significant computational resources, we believe it is essential to accelerate these accurate yet comparatively slow ligand-based screening methods."
        },
        {
            "heading": "1.2 Representation Learning",
            "text": "In the field of similarity search, a recurring issue is the maximization of the information content in a molecular fingerprint [14, 15]. Since in this work we focus on the use of deep neural networks, this problem falls into the domain of representation learning. Representation learning aims to transform raw high-dimensional data into a reduced set of features that can be used to optimally represent the data and enable their use in downstream tasks [16, 17]. Representation learning has been used in various fields such as language processing [18], time series [19], optimization of industrial processes [20], investigation of biological sensorimotor integration [21], and molecular property prediction [22].\nA common approach is contrastive representation learning, in which similar samples are trained to be close together in embedding space, while dissimilar samples should be farther apart [23]. Thus, in contrastive learning, input samples are compared to each other. This allows for the use of unsupervised learning as long as input samples can be compared with a defined similarity metric. One of the earliest contrastive loss functions was developed by Chopra et al. and is used to cluster samples of the same class in a similar location in embedding space [24]. Other important loss functions used in contrastive representation learning include the triplet loss [25], lifted structured loss [26], N-pair loss [27], and noise contrastive estimation (NCE) loss [28].\nGenerative representation learning is another important category of representation learning [23]. In generative representation learning, a model is trained to generate new samples (or reconstruct samples from the input). The concept is that, for a model to generate realistic samples, it must learn the fundamental structure of the data."
        },
        {
            "heading": "1.3 Previous Work",
            "text": "In a proof-of-concept study, we recently demonstrated that it is possible to train a deep neural network model to create a similarity conserving latent space [29]. We demonstrated that the latent space can be shaped in such a way that allows to use the Euclidean distance between embedded molecules as a measure of their similarity. This was done using a combination of generative and contrastive representation learning. The utilized Transformer-based model reconstructed SMILES strings that were given as input. At the same time, it used a custom similarity loss for contrastive learning of continuous molecular similarities (see Equation 2).\nUsing this model, it was possible to reduce the search space for virtual screening by several orders of magnitude. For simplicity, we used a simple 2D similarity measure based on Morgan fingerprints. However, due to the low computational cost of calculating 2D similarities, training such a model does not give a significant benefit over directly using the underlying similarity metric. Here, we extend this work and adapt the model to computationally expensive alignment-based 3D similarity metrics, which results in significant improvements in efficiency compared to other 3D similarity methods."
        },
        {
            "heading": "1.4 Challenges Going From 2D to 3D",
            "text": "To utilize 3D similarity metrics, the architecture of the model needs to be modified to allow for 3D structural data as input instead of 1D SMILES strings. Here, we represent molecules in the form of graphs, where atoms are nodes, and bonds are edges. This approach also allows to include 3D distance information as part of the edge featurization. A detailed description of this process can be found in Section 3.3.\nArguably, the biggest challenge is the computational cost of complex 3D similarity calculations. For the model trained on 2D similarities in our previous proof-of-concept study, it was possible to either calculate all pairwise similarities in the training set before training or using online learning by calculating the similarities on the fly during training. When using alignment-based 3D similarity metrics, it is not feasible to calculate all pairwise similarities for a large dataset. Also, online learning would be simply too slow. One way to overcome this problem is to use active learning methods. Active learning is a technique to sample from unlabeled data and choose new samples to annotate and add to the training set based on a certain algorithm in order to maximize the model\u2019s improvement [30, 31]. There are several algorithms (acquisition functions) that are often used in active learning. Regardless of the specific algorithm, their goal is always to select the best data to learn from in order to boost the model\u2019s performance as efficiently as possible. The use of active learning therefore allows to start training on a small training set which is iteratively grown based on the selection of the implemented algorithm(s). In our case, this has the advantage that only a small portion of the data has to be annotated (i.e. similarities have to be calculated) before the training. Each active learning cycle only adds new samples that are beneficial for the model\u2019s training, thus making the whole training process more efficient.\nOne commonly used active learning acquisition function is called query by committee (QBC). This algorithm employs a committee of models (so-called students). New samples for annotation are selected based on the maximum disagreement in prediction between the student models [32\u201334]. Therefore, a normal QBC algorithm requires multiple models to be trained in parallel. Since this comes with an additional computational cost, a committee can also be simulated by using the same model with activated dropout for the predictions. This method is also called query by dropout committee [35].\nAnother popular active learning algorithm is expected model change maximization (EMC). In this algorithm, the gradient of the loss with respect to an input sample is used to estimate the expected change of the model when learning from the sample [36, 37]. In practice, a set of unlabeled samples is passed through the model. For each sample, the gradient of the loss with respect to the input is calculated and the samples with the largest gradient are chosen for annotation. Since it is necessary to calculate the loss for unlabeled samples, this method cannot be used for loss functions that require labels."
        },
        {
            "heading": "1.5 Our Contribution",
            "text": "In this work, we extend our previous proof-of-concept study using 2D similarities to the use of 3D similarity metrics for efficient high-content virtual screening. We present the necessary modifications to the model architecture and the training process to enable the training on computationally expensive alignment-based similarity metrics; here\nshape screening implemented within the Schro\u0308dinger software suite. We also show that our model is indeed capable of conserving 3D similarities in latent space and that it can be used to efficiently identify compounds with similar 3D features. In our opinion, such a model can be very valuable in the early stages of hit identification, where the main focus is the reduction of the search space."
        },
        {
            "heading": "2 Results and Discussion",
            "text": "There are several performance criteria that our model must meet. First, since the intended use for this model is ligand-based virtual screening, it should be able to actually predict similar compounds (according to the underlying similarity metric) within the top-ranked predictions. Second, the model should actually capture 3D features and not rely solely on 2D similarities. This means that the model should be able to identify similar compounds with different chemical scaffolds. Finally, the model should prove its usefulness in a \u201creal-world example\u201d such as successfully reproducing known binders to a given target protein based on a reference molecule."
        },
        {
            "heading": "2.1 General Analysis",
            "text": "With this general analysis, we tested the model\u2019s ability to find similar compounds and capture 3D information. We did this by screening several query molecules against a database of structurally diverse compounds and comparing the identified hits with the hits from the pharmacophore-based 3D shape screening. This test had two desired outcomes: 1) the model\u2019s predictions correlate with the baseline similarities and the model is able to identify a high percentage of the top-ranked hits according to the baseline similarity method. 2) the top-ranked predictions have a high shape overlap with the query molecules.\nTo construct the dataset for the screening, we randomly selected a subset of approximately 50,000 compounds from the ZINC database [38]. Only compounds that were not part of the training set were selected. We then clustered the compounds using the Butina algorithm implemented in RDKit based on Tanimoto similarities based on Morgan fingerprints [39]. For clustering, we used a similarity cutoff of 0.7. In total, there were 31,856 clusters, of which only 5,234 contained more than one compound. This shows that the compounds had high structural diversity. We used the centroids of the 10 largest clusters as reference compounds for our analysis. This ensured that the screening set contained compounds with 2D structures similar to those of the reference compounds. For these reference compounds, we generated a single 3D conformer using Schro\u0308dinger\u2019s LigPrep [40]. To create a dataset to screen, we took up to 10 compounds from the created clusters until we had a set of 10,000 compounds. For the selected 10,000 compounds, we then created up to 5 conformers each using Schro\u0308dinger\u2019s ConfGen [41, 42]. This resulted in a total of 49,495 structures to screen. To create our baseline, we used Schro\u0308dinger\u2019s pharmacophore-based GPU shape screening tool to screen the 10 selected references against the created dataset [12, 43]. Our model was used to screen the same 10 query molecules against the same dataset. Because there were multiple conformations per compound, the best score (highest similarity or shortest distance in latent space) was used for both methods. Table 1 shows an overview of the model\u2019s performance. The mean Pearson correlation coefficient (PCC) was \u22120.73 \u00b1 0.13. Note that the correlation should be negative because the model predicts distances and not similarities. Thus, the smaller the predicted distance, the higher the estimated similarity. Figure 1 shows the correlation between the predicted distances and the calculated shape similarities for A) ZINC001763434742 (one of the best performing queries) and B) ZINC001183157671 (one of the worst performing queries). For ZINC001763434742, the true similarities are mostly in the range from 0.15 to 0.65 while the similarities for ZINC001183157671 are mainly in a comparable small range from 0.15 to 0.5. Thus, there seem to be no compounds that are highly similar to the query in 1B). This small range in similarity values contributes to the rather low correlation coefficient.\nUsing the latent space distance d and the scaling factor a used to train the model (see Equation 2), it is possible to approximate the similarity s\u0302 to s\u0302 = 1 \u2212 da . We used this equation to calculate the similarity for the top 100 predictions and compare their mean with the mean similarity of the top 100 hits from the baseline. Ideally, these two means are the same, as this would indicate that the model was able to reproduce the true similarity values. According to Table 1, the difference between these values ranged from 0.03 to 0.10, indicating that the performance depends on the chosen query compound. It can also be seen that it correlates nicely with the PCC. The precision shows the fraction of the top N predicted hits that are actually among the top N according to the baseline method. For N = 100, these values were generally quite low, indicating that the model was not very good at reproducing the top 100 hits among the top 100 predictions. However, the values seem to correlate with the overall performance for the specific queries, as indicated by the PCC. With some exceptions, these values are better for queries with a higher similarity to the top\nhits (represented by the mean similarity of the top 100 hits). This indicates that the model may generally perform better when there are compounds in a database that are highly similar to the query. Since reproducing the top 100 hits is a very difficult task and we did not expect the model to actually excel at it, we also calculated the precision for the top 1000 hits. There, the performance is generally higher, but varies greatly between the different queries, and again seems to correlate quite nicely with the PCC. On average, 53% \u00b1 15% of the top 1000 predicted compounds were actually among the top 1000 hits according to shape screening.\nTo assess the screening performance of the model in more detail, we calculated the receiver operating characteristics (ROC) curves and enrichment factors (EF) for the 10 queries in Table 1. To calculate the ROC curves, we defined the first 100 hits from the shape screening as active and the rest as inactive. The goal of the model should be to accurately replicate the 100 hits as early as possible. The results of this analysis are shown in Table 2 and detailed ROC curves and reproduction plots can be found in the Supporting Information in Figures S1-10. The average area under the ROC curve was 0.93\u00b1 0.04, indicating a very good screening performance. Also, the mean 1% EF was 27.5 \u00b1 13.0. This means that on average the model was able to reproduce 27.5 times more active compounds than random selection when considering only the 1% top ranked predictions.\nTo get a full picture of the performance of the model, it is important to analyze examples in which the model predicted very wrong values. Therefore, we picked examples that had a short predicted distance while having a low calculated shape similarity. Figure 2 shows one of the cases where there is a large discrepancy between the predicted and calculated rank of the compound. Although the model ranked this compound 3680 ranks too high, the shape overlap with the query molecule seems to\nbe high. In this case, the calculated similarity may be reduced due to few matching pharmacophores. This would indicate that the model has problems learning the pharmacophore information while being able to capture the 3D shape information well. Indeed, while the pharmacophore-based shape similarity between the two molecules was 0.35, the shape-only similarity (without pharmacophore information) was 0.63.\nAnother example in which the model overestimated a compound by 1571 ranks is given in Figure 3. It can again be seen that the overlap between the two compounds is rather high. In this example, the 2D similarity between the two compounds is low (0.35) and it can be seen that the predicted similar compound has a scaffold different from the query. Instinctively, one may say that this is actually a good hit, but nevertheless the model did not reproduce the correct rank as calculated by the baseline. Comparing the pharmacophore-based shape similarity (0.41) with the shapeonly similarity (0.63) shows again that the discrepancy of the ranks was caused by the model\u2019s inability to capture the pharmacophore information while nicely reproducing the 3D shape overlap.\nThere are, however, also instances where the model very nicely reproduced hits, even if the 2D structure was very different from the query. One such example is shown in Figure 4. In this case, the shape overlap appears to be worse than in the previous examples, even though this compound was highly rated by the baseline. The shape similarities with and without pharmacophore information were very similar at 0.58 and 0.59, respectively. This indicates that the score was mainly influenced by the 3D shape and that the pharmacophore information did not contribute much. Since our model performed very well on this example, it again suggests that the model is good at finding compounds with a similar shape, but not as good at capturing pharmacophore information.\nIn these experiments, we could show that the model is able to produce hits with a high overlap with the query molecules in 3D space. However, there may still be some shortcomings in certain cases in reproducing the exact similarity metric, especially if the similarity goes beyond \u201csimple\u201d 3D overlap. Nevertheless, the model proved to be able to capture 3D similarities independent of the 2D structure of the molecules."
        },
        {
            "heading": "2.2 Real-World Examples",
            "text": "To simulate a real-world example of a possible screening study, we selected 2 cocrystallized ligands as queries to screen the drugs contained in the Drugbank [44]. In a first trial, we selected raloxifene (co-crystallized to the estrogen receptor (ER) in PDB ID 1ERR). This compound has not been seen by the model before. The precision of the top 100 predictions was 53%, which is much higher than for most of the examples in Subsection 2.1. However, the precision of the top 1000 predictions was slightly lower at 49%. The PCC of all predicted distances with calculated similarities was -0.77. Interestingly, the model was able to reproduce the top 10 most similar compounds according to the baseline within the top 47 ranked hits. Since we wanted to know if\nthe model can be used to find other compounds that modulate the ER, we investigated the top 10 predictions. Table 3 shows the results of the analysis. All 10 predicted most similar compounds have literature confirmation of ER modulating activity. While this is a very promising result, one also needs to keep in mind that the Drugbank is a biased database in that it contains not only mostly drug-like molecules, but also many known ER modulators.\nFigure 5 shows the 2D structures of raloxifene and the 9 most similar compounds predicted by the model. It also contains the 3D structures of selected top-ranked compounds aligned with raloxifene. We further calculated the 2D similarity between the reference and the hits. While the 5 top ranked compounds were structurally quite similar (2D similarity between 0.44 and 0.66), the next 4 hits had scaffolds very different from raloxifene. They consisted of 3 isoflavonoids and 1 benzo-coumarin. The 3D alignment shows that even the compounds with different scaffolds share similar features, which could reproduce the binding mode of raloxifene. This analysis clearly shows that the model is able to find structurally dissimilar compounds by learning 3D features.\nNext, we wanted to test a compound with a different chemical scaffold than raloxifene. We decided to screen tetrahydrogestrinone against the drugs contained in the Drugbank. Like before, this compound has not been seen by the model before. The 10 highest ranked compounds predicted by our model are shown in Table 4. The precision of the top 100 predictions was 72%, which is exceptionally high. We believe that this is because steroidal compounds have a very unique shape and therefore it may be easier for the model to find similar compounds. The precision of the first 1000 hits was equally high with 69% and the correlation between all predicted distances and the calculated shape similarities was \u22120.82. The model was able to reproduce the top 10 hits\nfrom shape screening within the top 27 predictions. Eight of the 9 hits listed in Table 4 have been shown in the literature to have androgenic or anti-androgenic activity. Nevertheless, we still acknowledge the fact that the Drugbank may be a biased database in that molecules with androgenic or anti-androgenic properties are overrepresented compared to other databases.\nSince steroidal compounds have such a distinct chemical structure (and shape), we wanted to see if the model can also find non-steroidal compounds as easily as shape screening. This would show that the model indeed learns from the provided 3D information instead of relying on 2D similarity. The first non-steroidal compound we identified in the baseline hits was borneol at rank 123. Despite the fact that borneol has a very different 2D structure than steroids, the model predicted this compound to be at rank 95. This underlines the model\u2019s ability to capture 3D similarities in latent space.\nBased on these examples, we believe that our model is indeed suitable for use in real-world virtual screening applications. Although it is not able to perfectly reproduce\nthe similarities found in the chosen baseline, its predictions are reasonable and useful in finding compounds with similar 3D features."
        },
        {
            "heading": "2.3 Investigation of Computational Cost",
            "text": "To assess whether our method actually allows screening (ultra) large databases at reduced computational cost, we screened 27 query compounds against databases of different sizes. We chose to screen 27 query compounds to be able to directly compare the results with those of Michino et al. [13] (as introduced in Section 1.1). We\nemployed faiss, a tool created by Meta, to scan the databases [64]. Faiss allows to create searchable indexes from vectors. Several indexes with varying levels of accuracy and speed are available. We chose IndexFlatL2, an index that computes the exact squared L2 norm between the queries and all elements in the database. This index is the most accurate, but also the slowest. Thus, it would be possible to further increase the performance of the screening by choosing other more approximating indexes.\nWe tested databases containing 1k, 10k, 100k, and 1M compounds for screening. A screening consists of 3 steps: encoding into latent space, generation of the index, and screening of the index. Encoding into latent space is the most time-consuming task followed by the index generation (cf. Figure 6). However, these two tasks only need to be completed once, and the encoded data and index created can be reused for any future screenings. Figure 6 shows that the screening times required increase linearly with the size of the database. This allows for easy extrapolation to larger databases. Therefore, screening 27 queries against 1 billion conformers would require roughly 7.8 hours on a single CPU core. Michino et al. screened approximately 1.12 billion compounds with 10 conformers each (i.e. 11.2 billion conformers) in 19.5 hours using 216 GPUs. Extrapolating our tests to 11.2 billion conformers would result in approximately 87 hours or 3.6 days on a single CPU core. When parallelized to 8 cores (which is very reasonable for standard consumer-grade computers), the screening could be completed within 10.9 hours. If more powerful hardware is available, for example a CPU with 64 cores, the screening could be performed in only 82 minutes. We deliberately ran all experiments on a regular desktop computer with one RTX 2080 Super GPU. The GPU was used only to encode the conformers into latent space. Thus,\nwe show that this technology enables the screening of ultra-large databases without the need for expensive hardware.\nAnother advantage of this method is that it allows parallel search of multiple queries. It took only an additional 2.35 seconds to screen 100 queries instead of 27 against a database containing 1 million conformers. Thus, the gain in speed over the classical shape screening increases with the number of query compounds."
        },
        {
            "heading": "3 Methods",
            "text": ""
        },
        {
            "heading": "3.1 Dataset Preparation",
            "text": "Like in our proof-of-concept study, we used a randomly selected subset from the ZINC database containing around 500k compounds to train our model [29]. From this dataset, we selected the 25k molecules that best cover the chemical space of the complete dataset using the Kennard-Stone algorithm [65]. From this narrowed-down subset, we again applied the Kennard-Stone algorithm to isolate the most diverse 5k compounds for use as our validation set. The remaining 20k compounds were used as the initial training set. The initially unused 475k compounds were split into an external test set, consisting of 10k compounds, and a pool of molecules that were used as an unlabeled set to sample from during the active learning cycles."
        },
        {
            "heading": "3.2 Data Handling",
            "text": "In this work, the model was trained to encode 3D molecules into latent space and decode them to SELFIES [66, 67]. In order to enable the model to learn from 3D structures, the first step was to calculate atom features to be used as nodes. This was done using RDKit. For each atom in a molecule, we encoded the atom type, the atom degree (i.e. the number of neighbors), the number of connected hydrogen atoms, the implicit valence, the hybridization, and the aromaticity in a vector that could later be used in a learnable embedding.\nThe second step in encoding 3D information was to create edges between nodes in a way that conserved the 3D topology. This was done by passing the Euclidean distance matrix of a molecule through an exponential decay function and combining the result with the adjacency matrix. This is described in Equation 1.\nE = max(A, exp (\u2212D)) (1)\nWhere A is the adjacency- and D the Euclidean distance matrix of a molecule. This approach allows 3D information to be encoded in a translation and rotation invariant way while also preserving information about atom connectivity.\nGiven the vast amount of data and the expense of training, we chose to train the model in this initial 3D-enabled version with only one conformation per molecule. However, we think that including multiple conformations could enhance the model\u2019s capacity to learn 3D similarities.\nThe SELFIES used in this work were converted from canonical SMILES which were created using Openbabel version 3.0.0 [68]. Each SELFIES that was passed through the model was tokenized based on its individual components. We decided to use SELFIES instead of SMILES strings due to their robustness.\nAs our baseline similarity method, we used Schro\u0308dinger\u2019s pharmacophore-based shape similarity shipped with their 2023-2 release [43]. Unless otherwise stated, all molecules were processed with LigPrep prior to shape screening. We chose to generate protonation states at pH 7.4 and for each molecule, we created one 3D conformation using the OPLS4 force field."
        },
        {
            "heading": "3.3 Model Architecture",
            "text": "The architecture of the model had to be only minimally adapted from our proof-ofconcept study. Since the 3D- and connectivity information of the molecules are fully\nencoded by their edges, no positional encoding is needed in the encoder. In fact, removing the positional encoding is required for permutation equivariance because the order of the nodes does not matter, and thus a positional encoding would give incorrect information. The rest of the model is still based on the original implementation of the Transformer model by Vaswani et al. [69]. In the previous study, a masked mean was\nused to combine the nodes to generate a latent vector, whereas this work utilizes a weighted sum pooling technique. In this method, the weights are calculated using two linear layers with a tanh activation between them.\nTo train the model, we used the same combination of the reconstruction (i.e. cross-entropy) loss and our custom similarity loss as in the proof-of-concept study. Equation 2 shows this loss function in detail where A is an anchor sample, X is some other sample in the mini batch, sim(\u00b7, \u00b7) is a similarity function (in this case Schro\u0308dinger\u2019s pharmacophore-based shape similarity), and f(\u00b7) is the encoder of the model, encoding a molecule into latent space. To decrease the density of the latent space, the scaling factor a is used. This scaling factor was set to 10 in this work.\nL(A,X) = \u2223\u2223a \u00b7 \u2225(1\u2212 sim(A,X))\u2225 \u2212 \u2225f(A)\u2212 f(X)\u2225\u2223\u2223 (2)\nLike in our proof-of-concept study, we used scaled dot-product attention as described in Equation 3, where Q, K, and V are tensors containing the queries, keys, and values, and dk is the dimensionality of the keys [69].\nattention(Q,K, V ) = softmax ( QKT\u221a\ndk\n) V (3)\nThe complete model architecture is depicted in Figure 7. The model was trained with a batch size of 64, a latent space dimensionality of 252, a learning rate of 1e\u22124, and 4 encoder and decoder layers each. Each attention module consisted of 4 heads\nand the model was trained for a minimum of 200 and a maximum of 800 epochs per active learning cycle.\nBecause we used an active learning approach, the initial training set was much smaller compared to the training set used in the proof-of-concept study. However, from the two implemented loss terms, only the similarity loss depends on labeled data, whereas the reconstruction term is completely unsupervised. Therefore, for each mini batch, we created an additional mini batch containing random samples from the unlabeled dataset. This mini batch was used to train only the reconstruction. We chose this approach to improve the reconstruction abilities of the model while preventing overfitting on the small datasets.\nSince calculating the 3D similarities is comparatively expensive, we precomputed pairwise similarities for our initial training and validation set. During training, we used a similarity sampler to ensure that each molecule in a mini batch contained at least one similar compound. This was accomplished by randomly sampling 3 compounds from the 100 most similar to a given anchor molecule and adding them to the mini batch. This step is imperative for the model to conserve similarities in latent space and has already been described in our proof-of-concept study."
        },
        {
            "heading": "3.4 Active Learning",
            "text": "In this work, we used an active learning approach using a combination of QBC and EMC acquisition functions. Calculating the EMC involves calculating the gradient of the loss with respect to the input. Thus, one needs to be able to calculate the loss of a sample. Since the point of active learning is to select samples from unlabeled data to be labeled, this approach cannot be applied to the similarity loss. However, it is possible to use EMC for the reconstruction loss. For each active learning cycle, we encoded and decoded all unlabeled samples and calculated the gradient of the reconstruction loss with respect to the input. The gradients were then normalized using the L2 norm and squared to ensure positivity. This is described in Equation 4 where \u2207xL is the gradient of the reconstruction loss L with respect to the input sample x.\nEMC = \u2225\u2207xL\u22252 (4)\nThe EMC was mixed with QBC in order to also sample based on the similarity loss. To achieve this, we predicted the latent vector for each unlabeled sample 100 times using a dropout rate of 10%. We then calculated the mean over the variance of the predictions. This is shown in Equation 5 where P is a matrix containing N predictions and Var(\u00b7) is the variance.\nQBC = 1\nN N\u2211 i=1 Var(Pi) (5)\nThe sampling of the unlabeled data was performed on the basis of the magnitude of the EMC and QBC values. Starting from the samples with the highest values, an equal number of samples were drawn based on the EMC and QBC values. This was done until a total of 5k unique molecules were sampled from the unlabeled dataset. These samples were then labeled by calculating pairwise similarities (including the existing labeled samples) and added to the training set. Thus, for each active learning cycle, the training set grew by 5k compounds. Because we calculated pairwise similarities, the time used to label the newly sampled compounds increased exponentially. The model in this work was trained for 5 active learning cycles, resulting in a final training set containing 45k compounds."
        },
        {
            "heading": "4 Conclusion",
            "text": "We previously demonstrated that a distance-aware transformer model can be used to preserve 2D similarities in latent space. We claimed that this method can be used\nindependent of the underlying similarity metric, allowing to efficiently estimate highly complex 3D similarities.\nIn this work, we show how a slightly adapted model is capable of capturing such 3D similarities. We demonstrated that our model, which uses a translation and rotation invariant molecular representation, is able to recognize 3D features of molecules and identify molecules with similar shapes in a virtual screening context. Although the model cannot perfectly reproduce the underlying pharmacophore-based shape similarity, it is still capable of enriching the top hits with highly similar compounds. In fact, we believe that using a shape-only similarity metric would lead to much better performance because the model does not seem to be able to fully capture the pharmacophore information. Thus, for such special similarity metrics, the model might need to be further adapted to better reproduce the baseline similarity.\nThe approach described herein enables the use of the Euclidean distance in latent space as an approximation of computationally expensive 3D similarity metrics. It therefore allows researchers to run quick and efficient (pre)screenings on ultra-large databases using regular low-cost computer hardware.\nSupplementary information. This article has an accompanying supplementary file.\nAcknowledgments. We gratefully acknowledge the support of NVIDIA Corporation with the donation of two RTX A5000 GPUs used for this research."
        }
    ],
    "title": "Enhancing Ligand-Based Virtual Screening with 3D Shape Similarity via a Distance-Aware Transformer Model",
    "year": 2023
}
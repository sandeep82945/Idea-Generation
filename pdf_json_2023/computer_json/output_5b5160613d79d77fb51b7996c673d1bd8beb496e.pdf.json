{
    "abstractText": "1 Tissue Image Analytics Center, University of Warwick 2 Institute of Biomedical Engineering, University of Oxford 3 School of Cancer and Pharmaceutical Sciences, King\u2019s College London 4 Dept. of Computer Science, University of Middlesex 5 Queen Mary University of London 6 College of Health, Medicine and Life Sciences, Brunel University London 7 Manchester University 8 Medizinische Hochschule Hannover 9 National Heart and Lung Institute, Imperial College London 10 Joint last authors",
    "authors": [
        {
            "affiliations": [],
            "name": "Mark Eastwood"
        },
        {
            "affiliations": [],
            "name": "Heba Sailem"
        },
        {
            "affiliations": [],
            "name": "Silviu Tudor Marc"
        },
        {
            "affiliations": [],
            "name": "Xiaohong Gao"
        },
        {
            "affiliations": [],
            "name": "Judith Offman"
        },
        {
            "affiliations": [],
            "name": "Emmanouil Karteris"
        },
        {
            "affiliations": [],
            "name": "Angeles Montero Fernandez"
        },
        {
            "affiliations": [],
            "name": "Danny Jonigk"
        },
        {
            "affiliations": [],
            "name": "William Cookson"
        },
        {
            "affiliations": [],
            "name": "Miriam Moffatt"
        },
        {
            "affiliations": [],
            "name": "Sanjay Popat"
        },
        {
            "affiliations": [],
            "name": "Fayyaz Minhas"
        },
        {
            "affiliations": [],
            "name": "Jan Lukas Robertus"
        }
    ],
    "id": "SP:364dd11bcb1baf40f5606597aad493e9739823d3",
    "references": [
        {
            "authors": [
                "J. Ai",
                "J.P. Stevenson"
            ],
            "title": "Current issues in malignant pleural mesothelioma evaluation and management",
            "venue": "The oncologist 19(25061089), 975\u2013984",
            "year": 2014
        },
        {
            "authors": [
                "P. Bankhead"
            ],
            "title": "Qupath: Open source software for digital pathology image analysis",
            "venue": "Scientific reports vol. 7,1 16878.",
            "year": 2017
        },
        {
            "authors": [
                "M. Bilal",
                "S.E.A. Raza",
                "A Azam"
            ],
            "title": "Novel deep learning algorithm predicts the status of molecular pathways and key mutations in colorectal cancer from routine histology images",
            "venue": "medRxiv",
            "year": 2021
        },
        {
            "authors": [
                "G. Campanella",
                "M.G. Hanna",
                "L Geneslaw"
            ],
            "title": "Clinical-grade computational pathology using weakly supervised deep learning on whole slide images",
            "venue": "Nature Medicine pp. 1\u20139",
            "year": 2019
        },
        {
            "authors": [
                "P. Courtiol",
                "C. Maussion",
                "M Moarii"
            ],
            "title": "Deep learning-based classification of mesothelioma improves prediction of patient outcome",
            "venue": "Nature Medicine 25, 1519\u20131525",
            "year": 2019
        },
        {
            "authors": [
                "P. Courtiol",
                "E.W. Tramel",
                "M. Sanselme",
                "G. Wainrib"
            ],
            "title": "Classification and disease localization in histopathology using only global labels: A weakly-supervised approach",
            "venue": "ArXiv abs/1802.02212",
            "year": 2018
        },
        {
            "authors": [
                "S. Dacic",
                "N. Le Stang",
                "A. Husain",
                "B. Weynand",
                "M.B. Beasley",
                "K. Butnor",
                "D. Chapel",
                "A. Gibbs",
                "S. Klebe",
                "S Lantuejoul"
            ],
            "title": "Interobserver variation in the assessment of the sarcomatoid and transitional components in biphasic mesotheliomas",
            "venue": "Modern Pathology 33(2), 255\u2013262",
            "year": 2020
        },
        {
            "authors": [
                "T.G. Dietterich",
                "R.H. Lathrop",
                "T. Lozano-P\u00e9rez"
            ],
            "title": "Solving the multiple instance problem with axis-parallel rectangles",
            "venue": "Artificial Intelligence 89(1), 31\u201371",
            "year": 1997
        },
        {
            "authors": [
                "T. Durand",
                "N. Thome",
                "M. Cord"
            ],
            "title": "Weldon: Weakly supervised learning of deep convolutional neural networks",
            "venue": "2016 IEEE Conference on Computer Vision and Pattern Recognition (CVPR). pp. 4743\u20134752",
            "year": 2016
        },
        {
            "authors": [
                "M. Eastwood",
                "S. Marc",
                "X. Gao",
                "H. Sailem",
                "J. Offman",
                "E. Karteris",
                "A. Fernandez",
                "D. Jonigk",
                "W. Cookson",
                "M. Moffatt",
                "S. Popat",
                "F. Minhas",
                "J. Robertus",
                "M. Michalowski",
                "S. Abidi",
                "S. Abidi"
            ],
            "title": "Malignant mesothelioma subtyping of tissue images via sampling driven multiple instance prediction",
            "venue": "pp. 263\u2013272",
            "year": 2022
        },
        {
            "authors": [
                "S. Graham",
                "Q.D. Vu",
                "S.E.A. Raza",
                "A. Azam",
                "Y.W. Tsang",
                "J.T. Kwak",
                "N. Rajpoot"
            ],
            "title": "Hover-net: Simultaneous segmentation and classification of nuclei in multi-tissue histology images",
            "venue": "Medical Image Analysis p. 101563",
            "year": 2019
        },
        {
            "authors": [
                "R.M. Haralick",
                "K. Shanmugam",
                "I. Dinstein"
            ],
            "title": "Textural features for image classification",
            "venue": "IEEE Transactions on Systems, Man, and Cybernetics SMC-3(6), 610\u2013621",
            "year": 1973
        },
        {
            "authors": [
                "A Hjerpe",
                "S D.K. Abd-Own"
            ],
            "title": "Cytopathologic diagnosis of epithelioid and mixed-type malignant mesothelioma: Ten years of clinical experience in relation to international guidelines",
            "venue": "Arch Pathol Lab Med. (142(8)), 893\u2013901",
            "year": 2018
        },
        {
            "authors": [
                "D.P. Kingma",
                "J. Ba"
            ],
            "title": "Adam: A method for stochastic optimization",
            "year": 2017
        },
        {
            "authors": [
                "B. Li",
                "Y. Li",
                "K.W. Eliceiri"
            ],
            "title": "Dual-stream multiple instance learning network for whole slide image classification with self-supervised contrastive learning",
            "venue": "Proceedings of the IEEE/CVF Conference on Computer Vision and Pattern Recognition (CVPR). pp. 14318\u201314328",
            "year": 2021
        },
        {
            "authors": [
                "M.Y. Lu",
                "D.F.K. Williamson",
                "T.Y. Chen",
                "R.J. Chen",
                "M. Barbieri",
                "F. Mahmood"
            ],
            "title": "Data efficient and weakly supervised computational pathology on whole slide images",
            "year": 2020
        },
        {
            "authors": [
                "W. Lu",
                "M. Toss",
                "E. Rakha",
                "N. Rajpoot",
                "F. Minhas"
            ],
            "title": "Slidegraph+: Whole slide image level graphs to predict her2status in breast cancer",
            "year": 2021
        },
        {
            "authors": [
                "A.S. Mansfield",
                "J. Symanowski",
                "T.D. Peikert"
            ],
            "title": "Systematic review of response rates of sarcomatoid malignant pleural mesotheliomas in clinical trials",
            "venue": "Lung cancer 86 2, 133\u20136",
            "year": 2014
        },
        {
            "authors": [
                "L. McInnes",
                "J. Healy",
                "N. Saul",
                "L. Gro\u00dfberger"
            ],
            "title": "Umap: Uniform manifold approximation and projection",
            "venue": "Journal of Open Source Software 3(29), 861",
            "year": 2018
        },
        {
            "authors": [
                "R.R. Meyerhoff",
                "C.F.J. Yang",
                "P.J. Speicher",
                "B.C. Gulack",
                "M.G. Hartwig",
                "T.A. D\u2019amico",
                "D.H.J. Harpole",
                "M.F. Berry"
            ],
            "title": "Impact of mesothelioma histologic subtype on outcomes in the surveillance, epidemiology, and end results database",
            "venue": "The Journal of surgical research 196 1, 23\u201332",
            "year": 2015
        },
        {
            "authors": [
                "J.R. Naso",
                "A.B. Levine",
                "H Farahani"
            ],
            "title": "Deep-learning based classification distinguishes sarcomatoid malignant mesotheliomas from benign spindle cell mesothelial proliferations",
            "venue": "Modern Pathology 34(11), 2028\u20132035",
            "year": 2021
        },
        {
            "authors": [
                "R.C. Rintoul",
                "D.M. Rassl",
                "J. Gittins",
                "S.J. Marciniak"
            ],
            "title": "Mesobank uk: an international mesothelioma bioresource",
            "venue": "Thorax 71(4), 380\u2013382",
            "year": 2016
        },
        {
            "authors": [
                "U. Schmidt",
                "M. Weigert",
                "C. Broaddus",
                "G. Myers"
            ],
            "title": "Cell detection with star-convex polygons",
            "venue": "Medical Image Computing and Computer Assisted Intervention - MICCAI 2018 - 21st International Conference, Granada, Spain, September 16-20, 2018, Proceedings, Part II. pp. 265\u2013273",
            "year": 2018
        },
        {
            "authors": [
                "L.N. Smith"
            ],
            "title": "Cyclical learning rates for training neural networks",
            "venue": "CoRR abs/1506.01186",
            "year": 2015
        },
        {
            "authors": [
                "W.C. of Tumours Editorial Board"
            ],
            "title": "Thoracic Tumours",
            "venue": "WHO Classification of Tumours, 5th Edition, Volume 5",
            "year": 2021
        },
        {
            "authors": [
                "M. Turk",
                "A. Pentland"
            ],
            "title": "Face recognition using eigenfaces",
            "venue": "Proceedings. 1991 IEEE Computer Society Conference on Computer Vision and Pattern Recognition. pp. 586\u2013591",
            "year": 1991
        },
        {
            "authors": [
                "A. Vahadane",
                "T. Peng",
                "A Sethi"
            ],
            "title": "Structure-preserving color normalization and sparse stain separation for histological images",
            "venue": "IEEE transactions on medical imaging 35, 1962\u201371",
            "year": 2016
        },
        {
            "authors": [
                "J.C. Wagner",
                "C.A. Sleggs",
                "P. Marchand"
            ],
            "title": "Diffuse pleural mesothelioma and asbestos exposure in the north western cape province",
            "venue": "British journal of industrial medicine 17(13782506), 260\u2013271",
            "year": 1960
        },
        {
            "authors": [
                "J. Wang",
                "R.J. Chen",
                "M.Y. Lu",
                "A. Baras",
                "F. Mahmood"
            ],
            "title": "Weakly supervised prostate tma classification via graph convolutional networks",
            "year": 2019
        },
        {
            "authors": [
                "Y. Wang",
                "Y. Sun",
                "Z. Liu",
                "S.E. Sarma",
                "M.M. Bronstein",
                "J.M. Solomon"
            ],
            "title": "Dynamic graph CNN for learning on point clouds",
            "venue": "CoRR abs/1801.07829",
            "year": 2018
        },
        {
            "authors": [
                "K. Xu",
                "W. Hu",
                "J. Leskovec",
                "S. Jegelka"
            ],
            "title": "How powerful are graph neural networks",
            "year": 2018
        },
        {
            "authors": [
                "K. Xu",
                "C. Li",
                "Y. Tian",
                "T. Sonobe",
                "Kawarabayashi",
                "K.i.",
                "S. Jegelka"
            ],
            "title": "Representation learning on graphs with jumping knowledge networks",
            "venue": "Dy, J., Krause, A. (eds.) Proceedings of the 35th International Conference on Machine Learning. Proceedings of Machine Learning Research, vol. 80, pp. 5453\u20135462. PMLR",
            "year": 2018
        }
    ],
    "sections": [
        {
            "text": "MesoGraph: Automatic Profiling of Malignant Mesothelioma Subtypes from Histological Images\nMark Eastwood1, Heba Sailem2,3, Silviu Tudor Marc4, Xiaohong Gao4, Judith Offman5, Emmanouil Karteris6, Angeles Montero Fernandez7, Danny Jonigk8, William Cookson9, Miriam Moffatt9, Sanjay\nPopat9, Fayyaz Minhas1,10, and Jan Lukas Robertus9,10\n1 Tissue Image Analytics Center, University of Warwick 2 Institute of Biomedical Engineering, University of Oxford\n3 School of Cancer and Pharmaceutical Sciences, King\u2019s College London 4 Dept. of Computer Science, University of Middlesex\n5 Queen Mary University of London 6 College of Health, Medicine and Life Sciences, Brunel University London\n7 Manchester University 8 Medizinische Hochschule Hannover\n9 National Heart and Lung Institute, Imperial College London 10 Joint last authors\nSummary\nMalignant mesothelioma is classified into three histological subtypes, Epithelioid, Sarcomatoid, and Biphasic according to the relative proportions of epithelioid and sarcomatoid tumor cells present. Biphasic tumors display significant populations of both cell types. Current guidelines recommend that the sarcomatoid component of each mesothelioma is quantified, specifically, as a higher percentage of sarcomatoid pattern in biphasic mesothelioma shows poorer prognosis. It is therefore important to accurately diagnose morphological subtypes. However, this subtyping is subjective and limited by current diagnostic guidelines. This can affect the reproducibility even between expert thoracic pathologists when characterising the continuum of relative proportions of epithelioid and sarcomatoid components using a three class system. In this work, we develop a novel dual-task Graph Neural Network (GNN) architecture with ranking loss to learn a model capable of scoring regions of tissue down to cellular resolution. This allows quantitative profiling of a tumor sample according to the aggregate sarcomatoid association score of all the cells in the sample. The proposed approach uses only core-level labels and frames the prediction task as a dual multiple instance learning (MIL) problem. Tissue is represented by a cell graph with both cell-level morphological and regional features. We introduce a dataset of 234 mesothelioma tissue micro-array cores, and use an external multi-centric test set from Mesobank, on which we demonstrate the predictive performance of our model. We validate our model predictions through an analysis of the typical morphological features of cells according to their predicted score, finding that some of the morphological differences identified by our model match known differences used by pathologists. We further show that the model score is predictive of patient survival with a hazard ratio of 2.30. The ability to quantitatively score tissue on how much sarcomatoid component is present, and overlay cell-level instance scores, will assist pathologists in assessing a sample more quickly and consistently by defining the sarcomatoid component, particularly in biphasic mesothelioma. This ultimately will improve treatment decisions for patients with mesothelioma. The code for the proposed approach, along with the dataset, is available at: https://github.com/measty/MesoGraph.\nOur contributions include releasing a new dataset, introduction of the MesoGraph architecture providing accurate subtype predictions, and insightful analysis of morphological differences between sarcomatoid and epithelioid components.\nKeywords: Graph Neural Networks \u00b7 Multiple Instance Learning \u00b7 Mesothelioma \u00b7 Cancer subtyping \u00b7 Digital Pathology\nar X\niv :2\n30 2.\n12 65\n3v 1\n[ cs\n.C V\n] 2\n3 Fe\nb 20\n23"
        },
        {
            "heading": "1 Introduction",
            "text": "Malignant mesothelioma (MM) is an aggressive cancer of malignant mesothelial cells of the pleural lining, primarily associated with asbestos exposure [29]. It has a poor prognosis with less than 10% five year survival rates due to late diagnosis ([14] ; [1]). It has a long latency period from initial exposure to eventual carcinogenesis, and is difficult to diagnose due to its nonspecific clinical manifestations. MM is classified into 3 subtypes [2], epithelioid, biphasic and sarcomatoid mesothelioma (EM, BM and SM respectively), with BM characterised by a mix of epithelioid and sarcomatoid components. The Histological subtype of malignant mesothelioma is essential for prognosis and clincial decisions on treatment pathways for patients [21]. Stratification of a given sample into a particular subtype informs treatment and can help gain a more in-depth understanding of disease pathology and outcome. The benefit of surgical treatment has prognostic implications for epithelioid mesothelioma with median survival of 19 months but less so for SM and BM with respective median survival of 4 months and 12 months after surgical treatment [19].\nEpithelioid mesothelioma is characterised by malignant cells that are cytologically round with varying grading of atypia. Sarcomatoid mesothelioma cells are generally recognised as malignant elongated spindle cells [26] and are associated with worse prognosis in comparison to EM. Sarcomatoid mesothelial cells may also include transitional features that are intermediate between epithelioid and sarcomatoid. Although transitional cells are now classified under sarcomatoid mesothelioma, their presence is associated with worse prognosis [6].\nWhile the distinction of these three histological subtypes of MM is crucial to patient treatment, management and prognosis, it is challenging to differentiate EM, SM and BM through visual analysis. Currently, there are no clear guidelines on how to perform this stratification in an objective and reproducible manner [8]. Furthermore, even though mesotheliomas are divided into these three broad categories, in reality there is a continuous spectrum from EM to SM dependent upon the relative proportion of epithelioid and sarcomatoid cells in a given sample. As a consequence, existing approaches are unable to objectively quantify where on this spectrum a given sample falls based on profiling of cellular morphological patterns in it.\nA number of deep learning methods for analyzing mesothelioma images have been developed recently. For example, SpindleMesoNET [22] can separate malignant SM from benign spindle cell mesothelial proliferations. A recent approach for survival prediction of MM patients called MesoNet [6] uses a Mulitple Instance Learning (MIL) solver originally developed for computer vision applications [7] and classification of lymph node metastases [10]. However, automated subtyping of malignant mesothelioma from hematoxylin and eosin (H&E) stained tissue sections remains an open problem.\nOne challenge in the characterization of mesothelioma is that pathologist-assigned ground-truth labels of mesothelioma subtypes are typically available only at the case level as it is very difficult for pathologists to associate tumor micro-environment or cellular morphometric patterns with image or case level labels in an objective manner. Moreover, it can be very time-consuming to obtain detailed cellular or regional annotations, and those annotations may not be very reliable due to significant inter- and intra-observer variation.\nThe aim of this study was to develop a GNN approach to predict subtypes of malignant mesothelioma in a MIL setting. This was achieved considering Tissue Micro-array (TMA) cores as bags and individual cells as instances. On these we have built a weakly-supervised machine learning model to characterize mesothelioma subtypes using only case level labels in its training. The proposed approach can generate a quantitative assessment of where the sample stands in terms of the aforementioned epithelioid to sarcomatoid spectrum, enabling pathologists to perform a more in-depth characterization of tumor samples. A high level overview of the approach presented in the paper can be found in Fig. 1."
        },
        {
            "heading": "2 Results and Discussion",
            "text": "We have developed a custom Graph Neural Network based pipeline called MesoGraph that can predict mesothelioma subtypes using H&E stained tissue images. MesoGraph uses pathologist assigned case-level labels without any cellular or regional annotations in its training. The proposed approach models each cell in a given sample as a node in the graph, which is connected to neighbouring cells. Each node is associated with various features, which can be broadly classified into four types: 1) nuclear morphometric features, 2) stain intensity features of nuclear and cytoplasmic components of the cell, 3) cellular counts\nin the neighbourhood of node and 4) deep neural network and haralick based texture features. For a given test sample, it generates two probability scores (collectively called MesoScore) representing the probabilities of the sample being epithelioid or sarcomatoid. As a biphasic mesothelioma tumor is composed of both epithelioid and sarcomatoid components, the two outputs in MesoScore allow precise quantification of the two components in the sample. In addition to predicting mesothelioma subtype, MesoGraph also generates cell-level quantitative scores representing the association of each cell with the mesothelial subtype of the given sample. MesoGraph has been trained and independently validated on two datasets: St. George\u2019s Hospital (SGH, n = 234) and the multi-centric MesoBank collection (MB, n = 258).\nIn this section, we present the results of the proposed method in terms of its predictive performance in comparison to existing approaches, as well as its ability to identify histological features and morphological characteristics of cells associated with different types of malignant mesothelioma. We also demonstrate the ability of the proposed approach to stratify mesothelioma patients based on their expected survival."
        },
        {
            "heading": "2.1 Predictive Performance",
            "text": "Test results from the MesoGraph pipeline for both MesoBank and SGH datasets are shown in Figure 2 and Table 1. Here, the Receiver Operating Characteristic (ROC) curve is obtained by considering both sarcomatoid and biphasic samples as the positive class, whereas the epithelioid samples are associated with the negative label. As can be seen from these results, the proposed approach offers high predictive quality over both cross-validation and independent testing in comparison to other existing approaches. In the table, PINS refers to the Positive Instance Sampling Patch-based MIL approach as detailed in [11] whereas CLAM is the Clustering-constrained Attention Multiple Instance Learning method described in [17], a deep-learning-based weakly-supervised method that uses attention in combination with clustering-based constraints to identify the most predictive areas of the image. Max-MIL and naive-MIL are simple patch based baseline multiple instance learning (MIL) methods detailed further in the methods Section 3.6. As can be seen from Table 1, the max-based MIL strategy performs poorly. This is likely due to the relatively small size of the training dataset, as learning only on the maximally scoring instance per bag exacerbates this. Naive MIL performs surprisingly well. This may be due to the relatively high proportion of positive instances that are expected\nto be present in many of the positive bags (for example a sarcomatoid core should contain mostly positive instances). This makes the implicit assumption this model makes, namely that all instances share the label of the bag, less wrong for this dataset compared to other MIL tasks. PINS and CLAM, as two patch based methods with a mechanism for focussing on the most relevant region of an image, perform similarly with solid performance. However, as patch based methods, the spatial resolution of the prediction maps they can provide is lower than that of our cell graph based model.\nOur model outperforms other models tested, achieving an internal cross-validation performance of 0.90\u00b1 0.01. It performs particularly well in terms of its average precision (AP) of 0.86 \u00b1 0.02, indicating that its performance on the positive class (which is the minority class) is very good. While performance drops slightly on the external validation set, an AUROC of 0.86 and AP of 0.8 as seen in Fig 2, panels C and D shows these results generalize well. We attribute the performance improvements achieved by our model firstly to the cell graph representation, with cells and their morhpological features as instances, which is far more natural than an arbitrary division into patch instances. Secondly, our formulation of the learning as a dual task problem with a ranking loss. This acknowledges both the ordering we know exists between EM, BM and SM cores in terms of how much sarcomatoid component is present, and also the possibility that some regions of tissue may not be strongly associated with either a sarcomatoid or epithelioid core label."
        },
        {
            "heading": "2.2 Visualization of Model Output",
            "text": "The output of our model can be visualised in a zoomable, interactive Graphical User Interface (GUI) we have developed. A demo of results from our model can be found at (https://mesograph.dcs.warwick.ac.uk). Examples of the cell level scoring output by the model are shown in Fig. 3. For each cell in a given sample, the proposed model generates two prediction scores signifying the probability of the cell being associated with sarcomatoid or epithelioid labels. These scores can be combined and visualized in a colourmap showing cells that are associated with epithelioid (blue) and sarcomatoid (red) subtypes as well as a histogram (called MesoGram) showing the relative distributions of epithelioid and sarcomatoid components.\nFrom the zoomed-in masks, we can see the model can distinguish between regions with typical rounded morphology of the Epithelioid subtype and the more elongated morphology displayed in Sarcomatoid regions. The MesoGram plots of most samples tend to be bimodal to some extent, with epithelioid and sarcomatoid cores more heavily skewed toward low and high scores, respectively. This continuum of distribution between sarcomatoid and epithelioid is demonstrated further in Fig. 4, where thumbnails of model output on all cores are shown, grouped by subtype and ordered within each subtype by model score. This ability to give a more precise, fine-grained characterisation of a tumor beyond the current three poorly defined and subjective subtypes is a strength of our approach."
        },
        {
            "heading": "2.3 Explainability of model predictions",
            "text": "To gain an understanding of the predictions generated by the proposed approach, we have applied GNNExplainer [34] to the trained graph neural network model. This allows us to understand what node level features are contributing to the prediction of a given sample for each subtype. The top 10 features identified in this analysis are shown in Fig. 5.\nThe most important feature overall is the circularity, which confirms the expected distinction between the rounder morphology of the epithelioid subtype, compared to the more spindle-shaped sarcomatoid morphology. There are also a number of features describing the intensity and texture in the Eosin channel around the nucleus. Looking at the feature importances on specific subtypes, the resnet features are most useful on epithelioid cores. Circularity is specifically important in Epithelioid and sarcomatoid subtypes, as they tend to be composed of more homogeneous populations and therefore are expected to contain mostly either rounded or more elongated cells. In both Biphasic and Sarcomatoid cores, nearby detection counts seem to be an important feature. This may reflect a tendency for non-epithelioid tumors to display a slightly more spread out and disorganised cell distribution. We also notice that the importance of most of the top features has far more spread when considering Epithelioid cores, indicating a wide variety of features can contribute to an epithelioid score, with few features being universally important across all epithelioid cores.\nTo determine the separation between classes based on top scoring features, in the lower half of Fig. 6 (C and D) we plotted the prediction of each core against the assigned label by a pathologist. While Epithelioid cores and Sarcomatoid cores are mostly well-separated, we observe there can be overlap between some of the cases in terms of morphology. We also observe that Biphasic is not very distinct from Sarcomatoid cores."
        },
        {
            "heading": "2.4 Characterization of Cellular Morphologies",
            "text": "Pathologists assess cell morphology when diagnosing and scoring mesothelioma tumours. Therefore, we sought to investigate differences in nuclear morphology between mesothelioma tumours with different diagnoses. We focused on key features assessed qualitatively by pathologists including nuclear area, elongation\n(width and length) and nucleus shape regularity as measured by both circularity (how close it is to a circular shape), and solidity (which reflects overall concavity of a shape). Interestingly, in Figure 6, we found sarcomatoid tumours tend to have larger nuclei on average compared to epithelioid tumours. As expected these nuclei are more elongated and have less circular shapes. For almost all features, measures of nucleus\nshape in biphasic tumours fall in between epithelioid and sarcomatoid tumours. These results already confirm that our image analysis pipeline reflects inherent differences between these types even when only considering the average measures of each tumour which is consistent with pathological features. This motivates the development of more sophisticated AI methods to detect these differences.\nNext, we investigated the extent of variability in morphological measurements across different tumour types. We measured the standard deviation of cell features for each single tumour core as a proxy of heterogeneity. We found that Sarcomatoid tumours exhibit higher morphological heterogeneity in all nuclear features. These analyses motivate the investigation of single cell phenotypes to identify the most relevant subpopulations.\nWe can gain further insight into the differences in morphology that the model is associating with each subtype by looking at the principal components of cells assigned the highest and lowest scores (i.e most and least likely to be associated with a sarcomatoid core, respectively).\nComparing the first principal component for each subtype in supplementary Fig. 2, we can see that the model has learnt to assign a higher score to cells with a more elongated morphology. This reflects a known distinguishing feature of the sarcomatoid morphology, validating our model scoring. This is further illustrated in the scatter plot in the upper half of Fig. 6, where we show a supervised UMAP [20] of the principal components of high and low scoring cells. The supervisory signal is provided by the output of our model, as a binary label of whether it is in the top or bottom 10% of cells by score. Each point in the map represents a cell, colored red if it is in the top 10% of model scores, or blue if in the bottom 10%. UMAP attempts to learn an embedding in which examples with similar features are closer together. Thus, by looking at groups of cells in this map we can understand how high scoring and low scoring cell populations look. From Fig 6, sarcomatoid groups B and E we can see elongated cells are scored highly sarcomatoid, as are groups C and D showing large, irregular cells. Cells scored in the bottom 10% tend to be much smaller, as can be seen in groups F, H, I and J. They also are rounder and more regular in their shape. As can be seen comparing epithelioid group G to sarcomatoid group C, while large cells may also be scored as epithelioid, they have a round shape with less texture to the staining."
        },
        {
            "heading": "2.5 Survival Analysis using MesoScores",
            "text": "Survival analysis using Kaplan Meier plots are shown in Figure 7. Patients were divided into two groups based on model score. The median survival time of patients predicted more sarcomatoid was significantly shorter compared to non-sarcomatoid patients (190 vs 402 days, p < 0.002) for both. This difference in survival can be observed in the Kaplan Meier plot (a), where the predicted non-sarcomatoid curve in orange is less steep than the blue predicted sarcomatoid curve. In a Cox-proportional hazard model adjusted for sex and age at diagnosis, the hazard ratio for sarcomatoid cases was 2.43 (95% CI 1.44 \u2013 4.12, p < 0.005), indicating that patients with sarcomatoid morphology were 2.43 times more likely to have died at a specific time point than non-sarcomatoid cases. In comparison, the HR for both gender and age were both much smaller, at < 1.1. Very similar findings were obtained with censoring at 3 years (see supplementary material, Fig. 1)."
        },
        {
            "heading": "2.6 General Discussion and Future Work",
            "text": "We have developed a model capable of learning a cell-level indication of sarcomatoid and epithelioid regions of a TMA core tissue sample, which enables quantitative characterisation of a core according to the relative proportions of S and E components present. In summary:\n1. We have developed a Graph Neural Network (GNN) model (called MesoGraph) that can predict the mesothelioma subtype of the given patient sample with high accuracy (AUC-ROC > 0.85) over independent multi-centric validation using only H&E stained images of tumor samples. 2. For a given sample, the proposed approach can generate a quantitative assessment (called MesoScore) of where the sample stands in terms of the epithelioid to sarcomatoid spectrum. 3. Model predictions can be mapped onto individual cells in a given sample to generate histograms (called MesoGrams) showing the relative densities of epithelioid and sarcomatoid components within the tumor. 4. MesoGraph generated scores can be used as a prognostic marker for predicting disease specific survival. 5. We show that the weakly-supervised model is able to characterize known morphological patterns of cells\nassociated with epithelioid and sarcomatoid mesothelioma. 6. The code and the dataset used in this study is made publicly available for further development at\nhttps://github.com/measty/meso graph.\nThe developed approach could help pathologists to subtype a core more accurately, consistently and efficiently, and paves the way to move beyond the three type system of characterising a tumor, towards a more fine-grained characterisation that matches the underlying continuous biological expression of mesothelial tumour cells on a spectrum between epithelioid and sarcomatoid morphology.\nMost MIL based methods introduced in the literature have been patch based. One such MIL approach was introduced in [16]. Here, a dual stream approach was used where the final bag score is the mean of max instance pooling and an attention based weighted average of instances attended to by the max instance. In another approach [5] large scale datasets are used to train a MIL model for tumor detection, backpropagating only the top K instances per bag. The CLAM algorithm [17] is a further patch-based MIL method with attention that has been applied to a variety of computational pathology tasks. As a final example of patchbased approaches, in the IDaRS algorithm proposed in [4] to detect key mutations on colorectal cancer, learning occurs on patches drawn using a ranking-based sampling scheme. While these MIL approaches have been developed for patch-level instances, we develop our method treating each cell as an instance, allowing us to investigate the differences in cell morphology between subtypes. This also removes the limitation on spatial resolution of predictions imposed by a patch-based approach.\nGraph Neural Networks (GNNs) have also been applied in this domain. In [30], a GNN is used on prostate cancer TMA cores with self-supervised and morphological features for the task of classifying examples as high or low risk according to the Gleason score. GNNs are applied to whole slide images in [18] by spatially clustering cells to form agglomerate nodes from which to build a slide-level graph to predict HER2 status in breast cancer. Our approach uses a dual-task formulation with ranking loss, on a cell graph, to allow better identification of regions associated with the two components that may be present in a mesothelioma core.\nThe results for this study show a potential for clinical implications when applied to routine diagnosis of MM. As shown in our work, there is a gradient between epithelioid and sarcomatoid MM and the various cell populations are identifiable and can be quantified using our approach. Improving identification of mesothe-\nlioma subtypes, is an essential part of diagnosis for MM. The behavior of biphasic MM is dependant on the ratio of epithelioid and sarcomatoid cells and may also be extended to other biphasic tumours.\nOne limitation of our method is that, while we have taken care to validate our model by looking at the features that influence its predictions, and the typical morphology of cells found in epithelioid and sarcomatoid regions, we still have some issues with the interpretability of the model outputs. Not all of the features our model learns on have an obvious histomorphological counterpart. For example, if we see from a feature importance analysis that a particular resnet feature is important, it is not clear how that translates into a histomorphological biomarker that a pathologist can look for in a tissue sample. Haralick texture features are a little better as they are constructed to capture specific, well defined properties of textures, but they are still difficult to interpret in comparison to morphological features.\nFuture work could involve the incorporation of cell classifications, via a segmentation method such as Hovernet [12] capable of simultaneous cell segmentation and classification. This would provide a further informative feature that may help identify cell-type specific patterns such as an association of tumor-infiltrating lymphocytes to a specific subtype. Such features could also help move away from difficult to interpret features such as resnet features, without sacrificing performance. A more extensive evaluation considering a larger dataset and including pathologist concordance studies to identify whether pathologists using such a tool would make more consistent and more accurate subtyping could also be considered.\nIn conclusion, we provide a novel method for more precisely characterising epithelioid and sarcomatoid cell subtypes in a quantifiable and reproducible way. Given the importance of sarcomatoid subtypes for prognosis and deciding on treatment pathway, our method may potentially offer clinical implications for patient care. Improved subtyping of MM allows for gains in both the efficiency and reliability of assessment of mesothelioma tumour cell classification by a reporting pathologist. The method we present and future work using our approach to further define epithelioid and sarcomatoid spectrum of MM, may ultimately form a basis for improving treatment and prognosis for the patient."
        },
        {
            "heading": "Acknowledgements",
            "text": "This project was funded by CRUK-STFC Early Detection Innovation Award. FM and ME also acknowledge funding support from EPSRC EP/W02909X/1. We are grateful to The London Asbestos Support Awareness Group: https://www.lasag.org.uk/, National Mesothelioma Virtual Bank: http://www.mesotissue.org/ and MesoBank UK: http://www.mesobank.com/for their support.\nAuthor Contributions and Funding\nME: Conceptualization, Machine Learning Model Design and Implementation, Analysis, Writeup. FM: Conceptualization, Lead for Machine Learning Model and Experiment Design, Analysis, Paper Write-up, Funding acquisition, Project Supervision and Management. JO: Conceptualization, statistical analysis, paper writing up and revisions JLR: Conceptualization, Clinical Lead, Paper Write-up, Funding acquisition, Project Supervision and Management. HS: Conceptualization and study design, result analysis, paper writeup and revisions, Funding acquisition. STM and XG: Conceptualization, paper writeup and revisions. EK: Conceptualization, Paper structuring and revisions. AMF, DJ, WC, MF, SP: Data Provision.\nDeclaration of Interests\nThe authors declare no competing interests."
        },
        {
            "heading": "3.1 Data Aquisition and Patient Characteristics",
            "text": ""
        },
        {
            "heading": "3 Star Methods",
            "text": "Two independent MM patient cohorts were obtained retrospectively (see Fig. 8 panel A): The training cohort was from St. Georges Hospital and consisted of 102 patients. The validation cohort, of 82 patients, was obtained from Mesobank [23], a UK mesothelioma biobank. Mesobank collects samples from multiple UK hospitals. The date of death for Mesobank patients had been provided by the UK National Cancer Registration and Analysis Service (NCRAS).\nThe primary dataset used in this work is a collection of H&E stained Tissue Micro-arrays (TMAs) of tumor tissue biopsies collected from St. Georges Hospital, London. It consists of 4 Tissue Micro-array (TMA) slides scanned using a Hamamatsu Nanozoomer S360 scanner at 20\u00d7 (0.4415 microns per pixel) with a total of 279 cores covering 102 separate cases (patients). After the removal of dropped and severely damaged/incomplete cores, we are left with 234 cores over 90 patients, of which 148 are EM, 61 BM, and 25 SM. We additionally use a validation set of TMA cores over two slides provided by Mesobank, scanned at 20\u00d7 (0.5015 microns per pixel) using a Leica Aperio AT2. The class counts after removal of dropped/damaged cores were 258 cores over 77 patients, with 155 EM, 68 BM, and 35 SM. Only core-level labels are available. We first perform Vahadane stain normalisation [28] to minimise systematic stain variability between slides and cores. To represent a TMA core as a graph suitable for learning a GNN, we detect cells and extract features from these as described in Section 3.3."
        },
        {
            "heading": "3.2 Problem formulation",
            "text": "As the biphasic subtype is a mix of epithelioid and sarcomatoid components, and subtype labels are only available at the core level, we model the subtype prediction task as a binary Multiple Instance Learning (MIL) problem. Under the MIL paradigm [9], an example is represented by a bag of instances, and a bag is considered positive if it contains at least one positive sample. We express the subtyping problem as a dual MIL prediction task. In the first task, SM is considered the positive instance, whereas in the second task EM is considered the positive instance. Formulating the problem as two parallel MIL tasks allows the possibility for some instances to be negative instances in both tasks, in contrast to viewing any instance that is not sarcomatoid as being epithelioid which would be implicitly assumed in any single-task MIL formulation.\nThe goal of a MIL predictor is to use training data consisting of bags with bag level labels only to predict both bag and instance level labels in testing. Formally, let B = {X1, ..., XnB} be a bag corresponding to a single TMA core in our dataset, where Xi are instances (cells) within the bag. The number of instances nB can vary across bags. Each core, represented by bag B, is associated with a label YB \u2208 {0, 1, 2} in the training dataset. In our formulation, considering SM as the positive instance, epithelioid-labelled cores take the label (YB = 0), and biphasic and sarcomatoid cores take the label (YB = 1, YB = 2) respectively, as we expect progressively more sarcomatoid instances in BM and SM examples. Conversely, in the dual task (where EM is considered the positive class), biphasic and epithelioid cores take the bag labels (YB = 1, YB = 2), with sarcomatoid becoming the negative example (YB = 0). This labelling system, by predominance of positive instances, is a departure from that typically used in the MIL setting, where only positive (YB = 1) and negative (YB = 0) bags exist. We deal with this with our use of a ranking-based loss, as detailed in Section 3.4. Our goal is then to build a machine learning model F (B;\u03a6) with trainable parameters \u03a6 that can use a labelled training dataset D = {(B1, Y1), (B2, Y2), ..., (BM , YM )} to generate a predicted label for a test core B. This is done by aggregating instance level predictions zi = g(Xi;\u03c6) to give ZB = F (B;\u03a6) = Agg({zi = g(Xi;\u03c6)|Xi \u2208 B}) through an appropriate aggregation function Agg(\u00b7) such as max or average across top most positive instances.\nModelling the mesothelioma subtyping problem through MIL allows us to use core-level labels to learn an instancelevel scoring, with which we can identify predominantly EM or SM regions in a core. This enables us to quantify where each tissue sample falls in the EM-to-SM continuum according to the relative proportions of SM and EM instances. This fine-grained and natural characterisation of a tumor can lead to more informed decisions regarding treatment."
        },
        {
            "heading": "3.3 Building Graph Neural Networks on Tissue Cores",
            "text": "A tissue sample can be described by its individual component cells and their spatial arrangement within the sample. Their physical proximity will result in nearby cells affecting each other, through their shared micro-environment and interaction via various biological processes. Therefore, a natural way to represent the sample is as a graph, with each cell being a node in the graph, connected to other nearby cells in its neighbourhood. Let G = (V,E) denote a graph, where V and E are the sets of nodes and edges respectively. Each node v \u2208 V is associated with a feature vector Xv. In our case, each node v is a cell, with features Xv describing characteristics of the cell and its immediate surroundings.\nWe use Stardist [24] within QuPath [3] to perform cell detection on the TMA cores. Stardist is an approach to cell detection which uses star-convex polyhedra to represent objects. For each pixel, the distances to the boundary of its containing object along a set number of radial directions are learnt.\nFor each detected cell, we use QuPath to extract features describing both the cell, and the region surrounding it, including some haralick texture features as described in [13], for a total of 157 features as described below.\n\u2013 Shape features: Area, length, circularity, Max and Min diameter for both nucleus and whole cell \u2013 Intensity features: Mean, Median and Standard Deviation for hematoxylin and eosin channels over cell nucleus,\ncell cytoplasm and whole cell \u2013 Shape/intensity smoothed: Above features smoothed over nearby cells using a gaussian kernel of diameter 50 \u00b5m \u2013 Delaunay cluster features: number of neighbours, edge length statistics, cluster means of above features. \u2013 Haralick texture features on a small circular region around detection: calculated on the eosin channel, the hema-\ntoxylin channel and on the OD sum.\nIn addition to these features, we extract 72 \u00d7 72 image patches centred at the centroid of each cell and use a resnet34 (imagenet pretrained weights) to extract a further 512 features for each cell, taken from the penultimate layer output of the resnet model. We then construct the graph by connecting cells to each other cell whose centroid lies within a small radius, which we set at 30 \u00b5m. The process of building the cell graph is illustrated in Fig. 8B."
        },
        {
            "heading": "3.4 GNN Model Architecture",
            "text": "Graph neural networks (GNNs) are a powerful tool for representation learning on graphs. GNNs typically follow a neighbourhood aggregation strategy [32], where we update the representation of a node iteratively by a learned aggregation of the representations of its neighbours. To learn the dual MIL task as described in Section 3.2, our architecture branches after the neighborhood aggregation layers. We denote the branches as Sarcomatoid (S) and Epithelioid (E) branch after the instances considered as positive in each task. An illustration of our GNN architecture can be found in panel C of Fig. 8.\nDifferent GNN implementations vary in how they perform this aggregation, and how they combine the aggregation with the nodes current representation. We use the EdgeConv approach to aggregation from [31], which at layer k > 1 takes the form:\nh(k)v = 1 |Nv| \u2211\nu\u2208Nv f\u0398k\n( hk\u22121v ||h(k\u22121)v \u2212 h(k\u22121)u ) (1)\nhere, Nv is the neighbourhood of node v (i.e the set of all nodes to which v is connected), || denotes concatenation, and f\u0398k is chosen to be a multi-layer perceptron (MLP) with parameters \u0398k. The feature representation at each layer is h (k) v \u2208 Rdk and the initial representation of the node is the feature vector, h(0)v = Xv \u2208 Rd0 . The output of the first layer is a purely local transformation h (1) v = f\u03981(Xv), where again f\u03981 is an MLP with parameters \u03981. At each layer we choose f\u0398k to be an MLP with one hidden layer, MLP(dk\u22121, dk) with input dimension dk\u22121 and hidden layer and output dimension dk. Rather than computing the final output zv at a node from the representation in the final layer only, we follow the concatenation approach in Jumping Knowledge Networks [33] to combine the representation at different layers.\nThis combined representation from the graph convolution layers is passed to the E and S branches, to give for the S branch:\nz(s)v = \u03c3 ( \u03b1(s)f\u0398s([h (1) v ||...||h(K)v ]) + \u03b2(s) ) (2)\nHere \u03c3(\u00b7) denotes a sigmoid function, and both \u03b1(s) = f (s)\u03b1 (X\u0304) and \u03b2(s) = f (s)\u03b2 (X\u0304) are the output of further small MLPs taking as input a core-level feature mean X\u0304 = 1\nN \u2211 v\u2208V Xv. In a similar way, we also obtain z (e) v for the E\nbranch. We take the graph level prediction to be Z = 1|V | \u2211 v\u2208V (z (s) v \u2212 z(e)v ), the mean of the cell-level scores.\nTo train our model, we use a pairwise ranking loss:\nL = \u2211\ni\u2208Batch\n\u2211\nj\u2208Batch max (0, 1\u2212 (Yi \u2212 Yj)(Zi \u2212 Zj)) (3)\nwhere one prediction head (treating S as the positive instance) is trained to rank bags S > B > E and the second is trained to rank E > B > S, i.e treating E as the positive instance. Our model is implemented using the PyTorch geometric framework. We used 5 EdgeConv layers, each learning a feature representation of dimension 10. We use the Adam optimiser [15] and a decaying cyclic learning rate scheme [25] with min and max learning rate 2 \u00d7 10\u22125 and 1 \u00d7 10\u22124. The cycle length is 50 epochs and at each cycle, the max lr decays by a factor of 0.8. We train for a maximum of 500 epochs with early stopping."
        },
        {
            "heading": "3.5 Cell Morphology Characterization",
            "text": "To investigate the typical cell morphologies and morphological differences of cells assigned high and low scores by the model, our approach is similar in concept to the \u2018eigenfaces\u2019 decomposition in [27]. We have taken the highest\nscoring 10% of cells from sarcomatoid cores, and the lowest scoring 10% of cells from epithelioid cores, and aligned the images of all the cells so that the major axis is oriented vertically. We have then masked out all but a small region around the cell so that as little background as possible remains. Finally, we have taken the H channel of the aligned cell images, and performed Principal Component Analysis (PCA) on the pixel values. This process, and some of the resulting components are illustrated in supplementary Fig. 2.\nWe use this analysis to illustrate the differences in morphology between cells scored highly sarcomatoid or nonsarcomatoid by our model, as presented in Section 2.4."
        },
        {
            "heading": "3.6 Model Performance and Evaluation",
            "text": "For performance evaluation on the primary cohort, we employ a hold-one-out cross-validation strategy over slides, so that for each fold all cores of a single slide are held out as the test set. This is done to avoid any potential bias from systematic differences between slides, and to ensure no mixing of cores from the same patient occurs between the training and testing sets. The cores to be used for training are split 75%-25% into train and validation sets, respectively. We compared our model with CLAM [17], and PINS [11], two patch-based methods which attempt to focus training in an adaptive way on the most important instances. We additionally compared with two simple MIL approaches, max-MIL and naive-MIL. Max-MIL is a patch-based method where we backpropagate only on the maximal instance during training. This has been used in for example [5]. Naive-MIL is a naive approach whereby we simply assign the bag level label to all instances in a bag, and treat all instances equally during training. For both of these methods we used a resnet34 pre-trained on imagenet as the base patch level model. To evaluate performance on the external validation cohort, we have trained our model on the entire St. Georges cohort, and evaluated model predictions on the Mesobank cohort. Conversely, we also present results obtained training on Mesobank data and evaluate that model on the St. Georges data. Model performance is summarized in Table 1, and Fig. 2. as described in Section 2.1.\nSupplementary material for paper entitled \u2018MesoGraph: Automatic Profiling of Malignant Mesothelioma\nSubtypes from Histological Images\u2019\nFig. 1. Kaplan-Meier curves for survival prediction when stratifying by model output score. Data right censored at 3 years.\nar X\niv :2\n30 2.\n12 65\n3v 1\n[ cs\n.C V\n] 2\n3 Fe\nb 20\n23"
        }
    ],
    "title": "MesoGraph: Automatic Profiling of Malignant Mesothelioma Subtypes from Histological Images",
    "year": 2023
}
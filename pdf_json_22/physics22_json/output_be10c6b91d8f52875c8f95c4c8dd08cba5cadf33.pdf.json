{
    "abstractText": "Applied Physics Program, Northwestern University, 2145 Sheridan Road, Evanston, IL 60208, USA, Advanced Photon Source, Argonne National Laboratory, 9700 South Cass Avenue, Argonne, IL 60439, USA, Department of Physics and Astronomy, Northwestern University, 2145 Sheridan Road, Evanston, IL 60208, USA, and Chemistry of Life Processes Institute, Northwestern University, 2170 Campus Drive, Evanston, IL 60208, USA. *Correspondence e-mail: cjacobsen@anl.gov",
    "authors": [
        {
            "affiliations": [],
            "name": "Everett Vacek"
        },
        {
            "affiliations": [],
            "name": "Chris Jacobsen"
        }
    ],
    "id": "SP:cdd17f7b879995da6ea7442964b85991c7585f59",
    "references": [
        {
            "authors": [
                "G. Goertzel"
            ],
            "title": "Am",
            "venue": "Math. Mon. 65, 34\u201335.",
            "year": 1958
        },
        {
            "authors": [
                "T. K\u00f6hler"
            ],
            "title": "IEEE Nucl",
            "venue": "Sci. Symp. Conf. Rec. 6, 3961\u20133965.",
            "year": 2004
        },
        {
            "authors": [
                "B. M\u00fcnch"
            ],
            "title": "Opt",
            "venue": "Eng. 50, 123201.",
            "year": 2011
        }
    ],
    "sections": [
        {
            "text": "488 https://doi.org/10.1107/S1600577521012777 J. Synchrotron Rad. (2022). 29, 488\u2013495\nReceived 3 September 2021 Accepted 1 December 2021\nEdited by A. Momose, Tohoku University, Japan\nKeywords: X-ray tomography; center of rotation; tomogram alignment.\nFast and noise-tolerant determination of the center of rotation in tomography\nEverett Vaceka and Chris Jacobsenb,c,d*\naApplied Physics Program, Northwestern University, 2145 Sheridan Road, Evanston, IL 60208, USA, bAdvanced Photon Source, Argonne National Laboratory, 9700 South Cass Avenue, Argonne, IL 60439, USA, cDepartment of Physics and Astronomy, Northwestern University, 2145 Sheridan Road, Evanston, IL 60208, USA, and dChemistry of Life Processes Institute, Northwestern University, 2170 Campus Drive, Evanston, IL 60208, USA. *Correspondence e-mail: cjacobsen@anl.gov\nHigh-quality tomographic reconstruction is not possible without the accurate localization of the center of rotation. Poor localization leads to artifacts in the data and can even cause reconstructions to fail. There are many approaches to solving this problem, some of which involve the collection of full sinograms, or even provisional tomographic reconstructions, in order to determine the center of rotation. Here, a simple method based on the expected symmetry of the Fourier transform of summed projections approximately 180 apart is presented; unlike cross-correlation methods, it requires only a single Fourier transform to compute, and uses mainly low spatial frequency information which is less susceptible to noise. This approach is shown to be fast, and robust against poor signal-to-noise as well as to projection images acquired at angles that are not exactly 180 apart. This rapid method can be useful as a first step in the processing of tomographic data.\n1. Introduction\nIn single-tilt-axis projection tomography, a set of 2D slices of the object are reconstructed, with each slice arising from a set of line projections obtained as the object is rotated as shown in Fig. 1. [Some electron microscopes have double-tilt-axis specimen stages (Penczek et al., 1995); hence our use of the term \u2018single-tilt-axis\u2019 tomography which describes most tomography experiments at synchrotron light source facilites, and most commercial X-ray microtomography systems.] However, if one uses an incorrect value for the position of the actual axis of rotation, objects appear to \u2018wobble\u2019 about the correct axis, resulting in \u2018tuning fork\u2019 artifacts in the reconstructed slice if projections are acquired over 180 (Shepp et al., 1979), or one type of ring artifact for 360 data. A number of approaches have been developed to find and correct for this center-of-rotation (COR) shift error:\n(i) One approach is to compare a 0 image with the mirrored version of an image taken 180 apart, and find the COR shift to be half the distance between the phase correlation offset between these two images (Gullberg et al., 1986; Donath et al., 2006). This operation requires a total of three Fourier transforms, as well as identification of the crosscorrelation peak. Alternatively, one can use the shift of the center of mass between these two images for the same purpose (Donath et al., 2006; Dong et al., 2013).\n(ii) One simple approach is to fit a sine function to the sinogram\u2019s angle-by-angle center of mass and use this to calculate the COR shift (Hogan et al., 1993). This approach can also be used on the raw sinogram data (Azevedo et al., 1990; Donath et al., 2006). One can also track the center\nISSN 1600-5775\ncrossing points of identified features in the sinogram (Li et al., 2010). These carry the added benefit that, for low noise data sets, individual projections can be shifted such that features follow a sinusoidal path. When taking the Fourier transform of the sinogram, COR errors lead to the presence of aliasing errors at high spatial frequencies (Edholm et al., 1986), which can be minimized in an alignment strategy (Vo et al., 2014).\n(iii) Because of the effects on the reconstructed slice image, one can carry out reconstructions with a range of choices for the COR shift and manually select the one with the best appearance (Walls et al., 2005). Automated approaches include maximizing the number of positive, non-zero pixels in the reconstructed slice (Brunetti & De Carlo, 2004), or the contrast of the slice image (Birk et al., 2010), or minimizing the image\u2019s total variation (Cheng et al., 2018). One can also train a neural network to recognize ring-like artifacts and use this network to identify the image with the correct COR shift (Yang et al., 2017).\n(iv) In an iterative reprojection approach, one first obtains a provisional 3D image and then aligns projection images to this volume, repeating until convergence is achieved (Dengler, 1989; Owen & Landis, 1996; Birk et al., 2010; Parkinson et al., 2012). This approach can also be applied in reciprocal space (Pryor et al., 2017), and to a single slice in the reconstructed object. Iterative reprojection can correct for additional errors beyond the COR shift, and speedups can be obtained by alternating between alignment steps and reconstruction steps in iterative reconstruction approaches (Gu\u0308rsoy et al., 2017).\nOf these approaches, the first involves minimal data and computation. The second requires full sinogram data, and somewhat longer computation time.\nThe third and fourth approaches require numerous reconstructions, either of a single slice with varying COR guesses (the third approach) or of the entire 3D data set (the fourth approach) with consequent costs in data storage and compute time.\nWe present here a rapid approach for determination of the COR shift based on phase symmetry in the frequency domain of two projection images obtained approximately 180 apart. This resembles the first approach listed above with some distinct differences. First, while phase correlation finds the shift between a projection and the mirror of its 180 counterpart, it normally involves three two-dimensional Fourier transforms, whereas the phase symmetry approach requires only a single one-dimensional Fourier transform. Second, we make use of the fact that this phase symmetry is quite insensitive to noise at low spatial frequencies of the projection images, as well as being insensitive as to whether the images were taken exactly 180 apart. This rapid COR shift determination method can be used alone, or to provide a highly accurate starting point for correction of additional errors in the third and fourth approaches described above."
        },
        {
            "heading": "2. Method",
            "text": "For an object rotated along the z\u0302 axis as shown in Fig. 1, single point features will produce sinusoids in the sinogram p(t, ) (using the notation from Fig. 1); therefore R p\u00f0t; \u00de d for a single feature will result in an arcsine distribution for emission tomography and an inverted arcsine distribution in the case of transmission tomography. This distribution has even symmetry about the rotation axis as shown in Fig. 2(c). Since we collect a discrete number of projections, the integral becomes a sum\nover those projections, P\np\u00f0t; \u00de, which we will call the -sum of a sinogram. We may also consider a reflection pair, which we define as the sum of one projection taken at 0 and another\nJ. Synchrotron Rad. (2022). 29, 488\u2013495 Vacek and Jacobsen Center of rotation in tomography 489\ntaken at 0 + 180 . For single point features, these projection pairs will sample portions of the arcsine distribution on opposite ends of the rotation axis, resulting in the same even symmetry as shown in Fig. 2(d).\nA continuous object can be thought of as an ensemble of single point features. This will result in a linear combination of arcsine distributions in the -sum which will necessarily retain the same symmetry about the rotation axis. If, however, the actual rotation axis is shifted from the center of the recorded projection due to a COR error (as shown in Fig. 3), the distribution will be offset; one will instead have a noncentrosymmetric distribution.\nA simple way to determine whether a function is noncentrosymmetric is to examine its Fourier transform, since the shift theorem relates an offset center in real space to a phase ramp in Fourier space. If one did this row by row in the reflection pair, one could separate out erroneous contributions to the phase ramp from rows with no features (but only noise), or rows with other types of errors. When taking the Fourier transform of the sum of all rows in the reflection sum, these erroneous contributions would contribute equally to the phase ramp, whereas, if one were to take the Fourier transform of individual rows one by one and then obtain the summation of these complex vectors, the non-erroneous rows would\ncontribute to the phase ramp in a correlated fashion while the noise- or error-corrupted rows would presumably contribute in a non-correlated fashion. Therefore for Nt pixels across the detector for each of Ny detector rows, one is best off either adding the contributions of a total of Ny Fourier transforms each of dimension Nt , or a single Fourier transform of the (Nt , Ny) data array rearranged as a 1D array of dimension N 0 = Nt Ny ; we chose to use the latter approach.\nThe fast Fourier transform of this N 0 = Nt Ny reflection sum array will contain information about the phase ramp resulting from a COR error. However, the magnitudes in the Fourier transforms of images tend to decline as a function of increasing spatial frequency (Burton & Moorhead, 1987; van der Schaaf & van Hateren, 1996), while uncorrelated noise due to photon statistics is equally present at all spatial frequencies. In addition, the appearance of different features in different instances of projection pairs will affect higher spatial frequencies in the -sum. Therefore one will have the highest fidelity measurement of the presence of any phase ramp at the lowest non-zero spatial frequency fmin in the FFT of the N 0 reflection sum array, as shown in Fig. 3(d) and in Fig. 4(b) below. In principal we could improve the speed of this method by calculating this lowest spatial frequency value only, such as by using the Goertzel algorithm (Goertzel, 1958) with only N 0 multiplications and 2N 0 additions. However, the optimizations coded into standard FFT routines [which require N 0 log\u00f0N 0\u00de operations] make the full 1D FFT calculation quite fast enough. Thus we calculate the phase ramp\n(fmin) from the real R and imaginary I parts of the lowest spatial frequency of the FFT of the projection pair -sum as\nfmin \u00bc arctan 2 sgn Rfmin Ifmin ; sgn Rfmin Rfmin : \u00f01\u00de\nwhere sgn\u00f0Rfmin \u00de is the sign of the real component, which accounts for transmission or emission tomography. We convert the phase shift fmin to a position shift t 0 away from the center of our sinogram (the COR error) using\nt 0 \u00bc Nt 1\n2 fmin 2 ; \u00f02\u00de\nthus yielding a rapid approach to finding the COR error t 0.\nSome practical considerations to include are that the method requires the object to be totally within the frame of the image for all exposures. Otherwise, the entire arcsine distribution is not collected and the center finding will begin to fail. Also since we are using only the lowest spatial frequency the method is strongly effected by illumination gradients along the t -axis. More often than not, normalization to the flat- and dark-field projections corrects for illumination gradients, a standard step in any tomographic reconstruction. Further improvement can be had by normalizing the background visible on the right and left sides of the projection images to be equal. These techniques are both accessible in the TomoPy Python package.\n490 Vacek and Jacobsen Center of rotation in tomography J. Synchrotron Rad. (2022). 29, 488\u2013495"
        },
        {
            "heading": "3. Demonstration",
            "text": "We compared the above phase symmetry method with two other popular center-finding algorithms: phase correlation between the reflection pair of projections at 0 and 0 + 180 , and the sinogram FFT method which involves taking the Fourier transform of a complete sinogram. We tested the phase symmetry and phase correlation methods as a function of departures from a perfect projection pair at angles of 0 and 0 + 180 + . We also compared all three approaches against the signal-to-noise ratio (SNR) of the acquired projection images.\nWe compared these approaches by using a data set from TomoBank (De Carlo et al., 2018) of phase contrast tomography of duplex stainless steel taken at the European Synchrotron Radiation Facility (ESRF; TomoBank data set tomo_00064). This data set consists of 450 projections acquired over a 360 range, with a high density of features such that one cannot easily see individual features in the"
        },
        {
            "heading": "3.1. Phase correlation method",
            "text": "The phase correlation method performs phase correlation\nin the Fourier domain on two projections separated by 180 (Gullberg et al., 1986; Donath et al., 2006). Since the object has been rotated 180 , the second projection image is mirrored about the z\u0302 axis before processing. The cross-correlation between the two images will then give a peak at a position that is offset from the array center by twice the COR error t 0 along the t\u0302 axis (it will also provide a measure of sample drift along the z\u0302 axis during data acquisition). One can further increase the accuracy of this method by correlating only on the phase of the two Fourier transforms (Shaw et al., 1989). Sub-pixel accuracy can be obtained by embedding the product of the Fourier transforms of the two images in a larger array before inverse FFT, either based on the entire array or on a sub-array (Guizar-Sicairos et al., 2008; van der Walt et al., 2014). In our\nJ. Synchrotron Rad. (2022). 29, 488\u2013495 Vacek and Jacobsen Center of rotation in tomography 491\nTable 1 Assumed values of fluence n in photons per pixel used in the tests of Figs. 4 and 5, along with the resulting values of the signal-to-noise ratio (SNR) in projection images.\ncase we used a sub-pixel accuracy of a tenth of a pixel (i.e. m = 10). Conventional sub-pixel phase correlation would require the Nt Ny array be embedded in an mNt mNy array before inverse FFT. A less memory intensive approach obtains a coarse estimate of the correlation peak on an Nt Ny, then obtains a sub-pixel estimate of the correlation peak using matrix-multiplication discrete Fourier transform (DFT) only on a sub-array around the coarse estimate. Thus while the phase symmetry approach requires only a single 1D FFT of length Nt Ny, the phase correlation method requires either two Nt Ny FFTs and one mNt mNy inverse FFT (for the conventional approach) or two Nt Ny FFTs, one Nt Ny inverse FFT, and one matrix-multiplication DFT on a small array."
        },
        {
            "heading": "3.2. Sinogram FFT method",
            "text": "When one has a complete 360 sinogram over a wide range of projection angles and no COR error, its Fourier transform should only have significant values inside a double wedge region of the transform (Edholm et al., 1986). Therefore the sinogram FFT method (Vo et al., 2014) finds the COR error by taking a 180 sinogram and mirroring it about the t\u0302 axis so as to form a 360 sinogram prior to taking its FFT. By shifting the latter 180 of the sinogram along the t\u0302-axis, one can find where the signal outside of the double wedge is lowest, and thus recover the COR error. Since this sinogram FFT method requires repeated sinogram shifting and FFT calculation over a range of test values for the COR error, it tends to be slower than both the phase symmetry and phase correlation methods."
        },
        {
            "heading": "3.3. Test versus projection data SNR",
            "text": "The phase symmetry method is able to determine the COR error from using the overall phase ramp in the Fourier transform of a reflection pair, which can be measured from the lowest non-zero spatial frequency. As noted in Section 2, because signal in the FFT tends to decline with spatial frequency while the effects of Poisson noise do not, we first tested reproducibility of the three methods in the presence of noise while also examining the power spectrum of the sinogram pair FFT. The results given in Fig. 4(a) show that the phase symmetry method is the most robust of the three tested approaches against low SNR. The reason is made clear in Fig. 4(b), which shows the power spectrum from the FFT of the reflection pair of projections used in the phase symmetry and phase correlation methods. In this test, the phase symmetry method calculation\nwas 32 times faster than phase correlation, and 640 times faster than the sinogram FFT approach."
        },
        {
            "heading": "3.4. Test against non-180 projection pairs",
            "text": "The phase symmetry and phase correlation methods require only two projections acquired exactly 180 apart, which we term a \u2018reflection pair\u2019. To examine the robustness of these approaches, we tested them against angular departures between this reflection pair relationship; that is, we tested the methods using one projection at 0 against a second projection at 0 + 180 + . These rotation errors can occur for multiple reasons:\n(i) Pure projections separated by exactly 180 carry redundant information, so they are not always collected. One might instead collect N rotations over an angular range of 180(1 1/N ) . (ii) Some non-sequential projection acquisition schemes do not inherently collect 180 projections (Ko\u0308hler, 2004; Mu\u0308nch, 2011).\n(iii) Angular errors in rotation stages can result in un-\nintentional deviations from 180 .\nTherefore, for each value of and of SNR (Table 1), we generated 100 projection pairs with different instances of simulated Poisson noise, and averaged the COR error determined using each method. The results shown in Fig. 5 indicate that the phase symmetry approach outperforms phase correlation. This is true both for producing more accurate results\n492 Vacek and Jacobsen Center of rotation in tomography J. Synchrotron Rad. (2022). 29, 488\u2013495\neven with relatively large values of of 30 , and also at lower SNR values."
        },
        {
            "heading": "3.5. Dose fractionation in full-rotation data sets",
            "text": "Dose fractionation states that the total number of photons required to generate a 3D tomographic reconstruction is the same as the number of photons required to produce a 2D projection image of a given sample at the same SNR; that is, one can divide the required dose among N projection angles (Hegerl & Hoppe, 1976). Success in tomographic dose fractionation requires the alignment of low-dose projections (McEwen et al., 1995). We have previously shown that the phase correlation method using differential phase contrast images provides good alignment for both transmission and X-ray fluorescence tomographic data sets (Hong et al., 2014). Given that Figs. 4 and 5 show that the phase symmetry method works well at low SNR, we also tested its ability to accommodate dose fractionation.\nTo test this, we generated sinograms from a 3D Shepp\u2013 Logan phantom (Shepp & Logan, 1974) available in TomoPy (Gu\u0308rsoy et al., 2014). With this 5123 voxel data set, we would expect to require N = 512( /2) = 800 rotation angles to fulfill the Crowther criterion (Crowther et al., 1970) for full sampling of the 3D volume. The created object had a median transmission of 0.989, so that detecting this change in transmission relative to the incident beam would suggest an object contrast parameter = |Imax Imin|/(Imax + Imin)1/2 of = 0.0078, leading to an expectation that the cumulative incident fluence should be about n = SNR2= 2 = 52=\u00f00:0078\u00de2 = 410000 photons per pixel. Using a slightly lower cumulative fluence of n = 300000 photons per pixel for a somewhat more challenging test, we distributed this cumulative fluence over N = 360, 720, 1440, and 2880 angles as one would do if they were collecting a dose-fractionated data set (yielding a fluence per projection of n = 833, 417, 208, and 104 photons per pixel, respectively). The resulting sinograms shown in Fig. 6(a) illustrate the low SNR of the individual projection images at low fluence, with the\nJ. Synchrotron Rad. (2022). 29, 488\u2013495 Vacek and Jacobsen Center of rotation in tomography 493\nper-projection SNR shown in Fig. 6(c). The -sum plots in Fig. 6(b) and the -sum SNR shown in Fig. 6(c) show that the cumulative fluence of n = 300000 is identical for all the dosefractionated data sets. As shown in Fig. 6(d), the phase symmetry method finds the center of rotation (COR) from a reflection pair of projections quite well when dose fractionation is employed, even for the N = 2880 case of per-projection fluence of n = 360 and per-projection SNR = 0.09, while the phase correlation and sinogram FFT methods perform less well."
        },
        {
            "heading": "3.6. Comparison testing with additional data sets",
            "text": "In order to make sure that the phase symmetry method can be more broadly applied, we examined a number of additional data sets. Since TomoBank (De Carlo et al., 2018) has only a few 360 data sets but several 180 data sets, we chose two projections not 180 apart but instead two that were 179 apart, such as 0 and 179 in one test and then 1 and 180 in a second test. As shown in Table 2, near-consistency in the center of rotation calculated for these two independent (near) reflection pairs of projections indicates repeatability of the approach."
        },
        {
            "heading": "4. Conclusion",
            "text": "Phase symmetry provides a way to find the center of rotation (COR) error t 0 of a tomographic data set in a rapid and noisetolerant fashion. By adding together a reflection pair of projection images (two projections acquired approximately 180 apart, with some tolerance for departures from exactly 180 as shown in Fig. 5) and examination of the lowest non-zero spatial frequency of their Fourier transform, one can obtain the COR error t 0 using equation (2). Because signal from the object tends to be much larger than Poisson noise at low spatial frequencies in Fourier transforms of images, the phase symmetry approach is robust at low exposure, which is an important consideration for dose fractionation as demonstrated in Fig. 6. However, the method does require that the object is within the field of view at all projection angles so that\nthe reflection pair arcsine distribution is not obscured, and it also assumes that the rotation axis is aligned to the axis of the 2D detector used to acquire projection images. Lastly, it is important to note that the method is sensitive to illumination gradients in the t\u0302 axis direction, though such gradients are normally removed as part of illumination normalization and background normalization."
        },
        {
            "heading": "4.1. Code",
            "text": "The Python code for this method can be found at https://\ngithub.com/everettvacek/PhaseSymmetry."
        },
        {
            "heading": "Acknowledgements",
            "text": "We thank Francesco De Carlo and Dog\u0306a Gu\u0308rsoy for helpful conversations on this work, and assistance with TomoPy and TomoBank. This research used resources of the Advanced Photon Source (APS), a US Department of Energy (DOE) Office of Science User Facility operated for the DOE Office of Science by Argonne National Laboratory under Contract No. DE-AC02-06CH11357.\nFunding information\nFunding for this research was provided by: National Institute of General Medical Sciences (award No. R01-GM104530); Basic Energy Sciences (contract No. DE-AC02-06CH11357)."
        }
    ],
    "title": "Fast and noise-tolerant determination of the center of rotation in tomography",
    "year": 2022
}
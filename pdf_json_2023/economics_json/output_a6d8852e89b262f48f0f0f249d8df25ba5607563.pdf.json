{
    "abstractText": "This paper examines the marginal value of mobile energy storage, i.e., energy storage units that can be efficiently relocated to other locations in the power network. In particular, we formulate and analyze the joint problem for operating the power grid and a fleet of mobile storage units. We use two different storage models: rapid storage, which disregards travel time and power constraints, and general storage, which incorporates them. By explicitly connecting the marginal value of mobile storage to locational marginal prices (LMPs), we propose efficient algorithms that only use LMPs and transportation costs to optimize the relocation trajectories of the mobile storage units. Furthermore, we provide examples and conditions under which the marginal value of mobile storage is strictly higher, equal to, or strictly lower than the sum of marginal value of corresponding stationary storage units and wires. We also propose faster algorithms to approximate the optimal operation and relocation for our general mobile storage model, and illustrate our results with simulations of an passenger EV and a heavy-duty electric truck in the PJM territory.",
    "authors": [
        {
            "affiliations": [],
            "name": "Utkarsha Agwan"
        },
        {
            "affiliations": [],
            "name": "Junjie Qin"
        },
        {
            "affiliations": [],
            "name": "Kameshwar Poolla"
        },
        {
            "affiliations": [],
            "name": "Pravin Varaiya"
        }
    ],
    "id": "SP:e440a241d9b8115906b01f6c0dfcd7c36ed6649f",
    "references": [
        {
            "authors": [
                "Wood Mackenzie"
            ],
            "title": "US energy storage market shatters records in Q3 2020",
            "venue": "2020, https://www.woodmac.com/press-releases/ us-energy-storage-market-shatters-records-in-q3-2020/.",
            "year": 2020
        },
        {
            "authors": [
                "P. Sterchele",
                "A. Palzer",
                "H. Henning"
            ],
            "title": "Electrify everything?: Exploring the role of the electric sector in a nearly CO2-neutral national energy system",
            "venue": "IEEE Power and Energy Magazine, vol. 16, no. 4, pp. 24\u201333, 2018.",
            "year": 2018
        },
        {
            "authors": [
                "L. Gacitua",
                "P. Gallegos",
                "R. Henriquez-Auba",
                "A. Lorca",
                "M. Negrete- Pincetic",
                "D. Olivares",
                "A. Valenzuela",
                "G. Wenzel"
            ],
            "title": "A comprehensive review on expansion planning: Models and tools for energy policy analysis",
            "venue": "Renewable and Sustainable Energy Reviews, vol. 98, pp. 346\u2013360, 2018. [Online]. Available: https://www.sciencedirect.com/ science/article/pii/S1364032118306269",
            "year": 2018
        },
        {
            "authors": [
                "National Regulatory Research Institute"
            ],
            "title": "Getting the signals straight: Modeling, planning, and implementing nontransmission alternatives",
            "venue": "2015, https://pubs.naruc.org/pub/ FA86CD02-A0F1-EADA-2240-D4932060892F.",
            "year": 2015
        },
        {
            "authors": [
                "Yahoo Finance"
            ],
            "title": "Con Edison Storing the Future for Energy Customers",
            "venue": "2017, https://finance.yahoo.com/news/ con-edison-storing-future-energy-161632992.html.",
            "year": 2017
        },
        {
            "authors": [
                "C. Steitz"
            ],
            "title": "Nissan Leaf gets approval for vehicle-to-grid use in Germany",
            "venue": "2018, https:// www.reuters.com/article/us-autos-electricity-germany/ nissan-leaf-gets-approval-for-vehicle-to-grid-use-in-germany-idUSKCN1MX1AH.",
            "year": 2018
        },
        {
            "authors": [
                "Z. Liu",
                "M. Lin",
                "A. Wierman",
                "S.H. Low",
                "L.L. Andrew"
            ],
            "title": "Greening geographical load balancing",
            "venue": "Proceedings of the ACM SIGMETRICS Joint International Conference on Measurement and Modeling of Computer Systems, ser. SIGMETRICS \u201911. New York, NY, USA: Association for Computing Machinery, 2011, p. 233\u2013244. [Online]. Available: https://doi.org/10.1145/1993744.1993767",
            "year": 2011
        },
        {
            "authors": [
                "U. Agwan",
                "J. Qin",
                "K. Poolla",
                "P. Varaiya"
            ],
            "title": "Marginal value of mobile energy storage in power network",
            "venue": "2021 60th IEEE Conference on Decision and Control (CDC). IEEE, 2021, pp. 4936\u20134943.",
            "year": 2021
        },
        {
            "authors": [
                "S. Bose",
                "E. Bitar"
            ],
            "title": "The marginal value of networked energy storage",
            "venue": "arXiv preprint arXiv:1612.01646, 2016.",
            "year": 2016
        },
        {
            "authors": [
                "J. Qin",
                "I. Yang",
                "R. Rajagopal"
            ],
            "title": "Submodularity of storage placement optimization in power networks",
            "venue": "IEEE Transactions on Automatic Control, vol. 64, no. 8, pp. 3268\u20133283, 2019.",
            "year": 2019
        },
        {
            "authors": [
                "E. Bitar",
                "P. Khargonekar",
                "K. Poolla"
            ],
            "title": "On the marginal value of electricity storage",
            "venue": "Systems & Control Letters, vol. 123, pp. 151\u2013159, 2019.",
            "year": 2019
        },
        {
            "authors": [
                "J. Qin",
                "K. Poolla",
                "P. Varaiya"
            ],
            "title": "Mobile storage for demand charge reduction",
            "venue": "Under Review at IEEE Transactions on Intelligent Transportation Systems, 2019.",
            "year": 2019
        },
        {
            "authors": [
                "F. Rossi",
                "R. Iglesias",
                "M. Alizadeh",
                "M. Pavone"
            ],
            "title": "On the interaction between autonomous mobility-on-demand systems and the power network: Models and coordination algorithms",
            "venue": "IEEE Transactions on Control of Network Systems, vol. 7, no. 1, pp. 384\u2013397, 2019.",
            "year": 2019
        },
        {
            "authors": [
                "G. He",
                "J. Michalek",
                "S. Kar",
                "Q. Chen",
                "D. Zhang",
                "J.F. Whitacre"
            ],
            "title": "Utility-scale portable energy storage systems",
            "venue": "Joule, vol. 5, no. 2, pp. 379\u2013392, 2021.",
            "year": 2021
        },
        {
            "authors": [
                "J.A. Taylor"
            ],
            "title": "Financial storage rights",
            "venue": "IEEE Transactions on Power Systems, vol. 30, no. 2, pp. 997\u20131005, 2015.",
            "year": 2015
        },
        {
            "authors": [
                "F. Wu",
                "P. Varaiya",
                "P. Spiller",
                "S. Oren"
            ],
            "title": "Folk theorems on transmission access: Proofs and counterexamples",
            "venue": "Journal of Regulatory Economics, vol. 10, no. 1, pp. 5\u201323, 1996.",
            "year": 1996
        }
    ],
    "sections": [
        {
            "text": "I. INTRODUCTION\nWith the increasing penetration of variable renewable energy resources, a fast growing amount of energy storage will be connected to the electric power network in the future. This is driven by profound technological and economic trends including the dramatic reduction in cost of battery systems and the advance of power electronics for programmable inverters. Meanwhile, mandates and goals for storage deployment have been proposed in many states including California and Massachusetts. As a result, new storage capacity is being connected to the grid at a record pace [1]. On the other hand, transportation electrification and more generally the trend to \u201celectrify everything\u201d [2] are expected to significantly increase the peak load for power systems. When the peak load reaches transmission or distribution capacity, the conventional wisdom is to install more wires or reinforce existing ones [3]. However, such wire-based solutions have high capital costs, are usually time-consuming to implement, and can face public opposition [4]. Therefore, non-wire alternatives that can avoid or delay the need for capacity expansion are highly valued by system operators and utility companies.\nU. Agwan, K. Poolla and P. Varaiya are with the Department of Electrical Engineering and Computer Science, University of California at Berkeley {uagwan, poolla, varaiya}@berkeley.edu\nJ. Qin is with the School of Electrical and Computer Engineering, Purdue University jq@purdue.edu\nThis work was supported in part by the C3.ai Digital Transformation Institute.\nMobile energy storage can simultaneously serve the role of energy storage and wires as it can help balance the supply and demand in both time and space. Mobile energy storage comes in many forms. Truck-mounted mobile energy storage units have been tested by Con Edison [5] for utility-scale applications. Electric vehicles and electric trucks together with bidirectional chargers can be used as mobile energy storage [6]. Internet data centers whose load can be shifted across space (among data centers located at different geographical areas) and time [7] behave as a form of virtual mobile storage. Understanding the value of mobile storage, particularly with respect to the value of stationary storage and wires is an essential first step in assessing the potential of this technology for future power systems."
        },
        {
            "heading": "A. Contribution and paper organization",
            "text": "In this paper, we analyze the value of mobile storage from the point of view of a power system operator through a stylized formulation for joint operation of the power network and a fleet of mobile storage units. Given the relocation pattern of mobile storage, we show that the marginal value of mobile storage can be computed analytically using locational marginal prices. We first focus on rapid mobile storage that can both charge/discharge instantly and travel instantly between nodes, and use the analytical expression for the marginal value of mobile storage to compare it with corresponding stationary storage and wires. Examples/conditions where the marginal value of mobile storage is strictly higher, lower, or equal to the sum of the marginal values of stationary storage and wires are presented, which offer insights on when mobile storage is preferred over stationary storage. We then propose efficient algorithms for the optimal storage relocation problem based on analytical expressions for the marginal value of rapid mobile storage. We then extend our analysis to a general mobile storage model which includes power constraints and travel time between nodes in the power network, and propose an algorithm to solve the optimal storage relocation problem. We also propose an approximate optimal storage relocation algorithm for the general mobile storage model to improve the solution time complexity. We illustrate our results with simulations of a passenger EV and an electric truck in a power network in the PJM territory.\nThe paper is organized as follows: Section II describes our model for the power network, mobile storage and transport. Section III introduces the problem of multi-period economic dispatch with storage, and formulates the optimal relocation\nA shorter version of this article is under review at IEEE Transactions on Smart Grids. An earlier version of this work was presented at the 60th IEEE Conference on Decision and Control (CDC) in 2021.\nar X\niv :2\n30 3.\n09 70\n4v 1\n[ ee\nss .S\nY ]\n1 7\nM ar\n2 02\n3\n2 problem for mobile storage. Section IV studies the rapid mobile storage case, where storage can relocate and charge rapidly. Section V treats the general mobile storage case. Section VI illustrates our results with numerical examples, and Section VII concludes the paper. Due to space constraints, all proofs can be found in the appendix.\nPreliminary results related to this paper appeared in the conference version [8], where the value of mobile storage was quantified in terms of the LMPs, and algorithms were devised to optimally move and operate mobile storage. However, the algorithm proposed for the general mobile storage case had a time complexity which was exponential in the number of time steps in the decision horizon. This paper significantly builds on work in [8] by devising an approximate relocation algorithm which can be solved in polynomial time, whose solution converges to the true optimal solution, and by conducting case studies of passenger and heavy-duty electric vehicles providing mobile storage in a power network."
        },
        {
            "heading": "B. Related Literature",
            "text": "Several papers address the question of quantifying the marginal value of stationary storage. Bose and Bitar [9] develop an expression for locational marginal value of storage in a stochastic setting, i.e., when the system operator has to meet uncertain demand by dispatching generation and storage, and the marginal value is determined to be a function of the expected locational marginal prices (LMPs). Qin et al. [10] derive an expression for the locational marginal value of stationary storage in terms of LMPs determined by the economic dispatch problem, and propose a discrete optimization framework for optimal siting from the system operator perspective. Bitar et al. [11] explore the economic value of storage colocated with a wind producer. Each of these papers adds a level of complexity to the problem of valuing stationary storage, but considers an ideal storage model with no power constraints. Our results in Section V, when applied to stationary storage, generalize the state of the art stationary storage model by incorporating power constraints.\nCompared to stationary storage, mobile storage can add extra value by relocating across the power network. Qin et al. [12] propose using EV batteries to reduce demand charges, and justify the value proposition through a numerical case study. [13] models the coupling between transportation and power networks for on-demand transport services, and develop a joint optimization problem for the combined network. The economic value of truck mounted mobile storage is evaluated using numerical simulation in [14]."
        },
        {
            "heading": "II. MODELLING GRID, STORAGE, AND TRANSPORTATION",
            "text": ""
        },
        {
            "heading": "A. Notations",
            "text": "For any natural number n, let [n] := {1, . . . , n}. We use 1 to denote all-one vectors of appropriate dimensions, ei \u2208 Rn to denote the i-th elementary vector whose i-th element is one and all other elements are zeros. For any time dependent vector x(t) \u2208 Rn with t \u2208 [T ] and T \u2208 N, we use xi \u2208 RT to denote [xi(1), . . . , xi(T )]>."
        },
        {
            "heading": "B. Power network",
            "text": "We consider the operation of a power network with n buses and m lines over a finite horizon of length T . For each time slot t \u2208 [T ], we denote the power generation and inelastic load over different buses in the power network by g(t) \u2208 Rn and `(t) \u2208 Rn, respectively. The generation cost function for generator at bus i is denoted by Ci(\u00b7) and so the total generation cost in time period t is\nC(g(t)) = n\u2211 i=1 Ci(gi(t)), t \u2208 [T ].\nFor simplicity, we assume Ci(\u00b7) is strictly convex quadratic. This assumption can be replaced with other conditions that ensure differentiability of the optimal value function.\nDenote the net power injection vector in time period t by p(t) \u2208 Rn. The net power injection vector needs to satisfy the linearized AC power flow constraints:\n1>p(t) = 0, Hp(t) \u2264 f , t \u2208 [T ],\nwhere 1 denotes the all-one vector, H \u2208 R2m\u00d7n refers to the shift-factor matrix of the power network, and f \u2208 R2m models the thermal constraints of the lines (cf. [10] for a derivation of this version of the linearized AC power constraints)."
        },
        {
            "heading": "C. Mobile energy storage",
            "text": "Consider a fleet of K mobile energy storage units. We denote the charging and discharging operation of storage unit k in time period t by uk(t), with the convention that uk(t) > 0 models charging and uk(t) < 0 models discharging. We assume each storage unit starts empty at the beginning of the decision horizon, so the state of charge (SoC) of storage k at the beginning of time period t+1 is \u2211t \u03c4=1 uk(\u03c4) for k \u2208 [K], t \u2208 [T ]. The SoC of each storage unit must satisfy the energy capacity constraint. In particular, denote the energy capacity of storage k by sk. Then we have\n0 \u2264 t\u2211\n\u03c4=1\nuk(\u03c4) \u2264 sk, k \u2208 [K], t \u2208 [T ]. (1)\nDenote the vector of charging and discharging operation of storage k by uk \u2208 RT . Then constraint (1) can be written as\n0 \u2264 Luk \u2264 sk1, k \u2208 [K],\nwhere L is a lower triangular matrix defined as Lij = 1, if i \u2265 j, and 0 otherwise.\nIn addition to the energy capacity constraint, storage units often have a power capacity rating which limits the amount of energy that can be charged or discharged for each unit of time. Denote the power rating of storage k by uk. In general, when we vary the energy capacity of a storage units (e.g. by adding more battery packs), the power rating will also vary. Thus we write uk = uk(sk) when we want to highlight this dependence, where uk(\u00b7) is continuously differentiable. 1\nThe amount of energy a storage unit can charge or discharge in a time period also depends on the time that is available for\n1If uk is determined by the power rating of the charger, uk is a constant and \u2202uk\n\u2202s\u0304k is 0.\n3 storage operation. Denote the length of each time period in our discrete time model by \u2206. Since it takes time for mobile storage units to move between different buses in the power network, the time that is available for storage k to charge or discharge in time period t, denoted by \u2206Sk(t), satisfies 0 \u2264 \u2206Sk(t) \u2264 \u2206. As a result, the power capacity leads to the following constraint\n\u2212\u2206Sk(t)uk \u2264 uk(t) \u2264 \u2206Sk(t)uk, k \u2208 [K], t \u2208 [T ].\nDenote the bus at which storage k is located at the beginning of time period t by ik(t), and define matrix E(t) \u2208 Rn\u00d7K as\nE(t) = [ ei1(t) . . . eiK(t) ] , t \u2208 [T ], (2)\nwhere ei is the i-th elementary vector with a one at the i-th element and zeros elsewhere. Note that the sequence {ik(t)}t\u2208[T ] characterizes the relocation process (i.e., the trajectory) of storage k, while E(t) provides a snapshot of the locations of all mobile storage units in the power network in time period t. We denote the collections of trajectories and snapshots by\nI = {Ik}t\u2208[T ] := {ik(t)}k\u2208[K],t\u2208[T ], E := {E(t)}t\u2208[T ],\nrespectively, where we use Ik to denote the trajectory of mobile storage k. Since (2) defines a one-to-one mapping between I and E, we will use them interchangeably."
        },
        {
            "heading": "D. Transportation model",
            "text": "The system operator can determine whether to relocate storage k in each time period. If storage k is relocated in time period t, a portion of time period t is used to move the storage from one bus to another. Let D \u2208 Rn\u00d7n be a matrix whose (i, j)-th element is the travel time from bus i to bus j. We assume that the length of the time intervals \u2206 is selected so that Di,j \u2264 \u2206 for all i, j. Denote the time needed for moving storage k in time period t by \u2206Mk (t). Since storage k is moved from bus ik(t) to bus ik(t+ 1) in time period t, we have\n\u2206Mk (t) = e > ik(t) Deik(t+1), k \u2208 [K], t \u2208 [T ]. (3)\nThus the time left for storage to charge or discharge in time period t is\n\u2206Sk(t) = \u2206\u2212\u2206Mk (t), k \u2208 [K], t \u2208 [T ]. (4)\nWe adopt the convention that if a storage k is moved in time period t, it will first use \u2206Sk(t) time to charge/discharge at bus ik(t) and then use \u2206Mk (t) time to relocate to bus ik(t+ 1).\nTransporting energy storage between buses is costly. For example, truck mounted mobile storage consumes fuel to travel between buses. Denote the relocation cost per unit of travel time by \u03ba. Then the total cost for relocation is\nJR(I) := K\u2211 k=1 JRk (Ik) := \u03ba K\u2211 k=1 T\u2211 t=1 e>ik(t)Deik(t+1), (5)\nwhere JRk (Ik) is the relocation cost for the k-th mobile storage unit."
        },
        {
            "heading": "III. OPTIMAL DISPATCH AND RELOCATION",
            "text": "In a centralized optimization setting, the system operator controls both the power grid and the mobile storage fleet. Given the locations of the mobile storage units E, the operation of the grid and the charging/discharging of the storage units can be formulated as the following optimization problem:\nmin g,u T\u2211 t=1 Ct(g(t)) (6a)\ns.t. 1>(g(t)\u2212 d(t)\u2212 E(t)u(t)) = 0, t \u2208 [T ], (6b) H(g(t)\u2212 d(t)\u2212 E(t)u(t)) \u2264 f , t \u2208 [T ], (6c) 0 \u2264 Luk \u2264 sk1, k \u2208 [K], (6d) \u2212 uk(sk)\u2206Sk \u2264 uk \u2264 uk(sk)\u2206Sk, k \u2208 [K]. (6e)\nwhere {\u2206Sk}k\u2208[K] is calculated via (3) and (4), and the locations of mobile storage units summarized by E(t) are given. We refer to this problem as multi-period economic dispatch problem with storage (MPED-S). The optimal value of this problem characterizes the total generation cost of meeting the loads when generators and storage charging/discharging are optimized. Denote the optimal value as a function of the storage locations and storage capacities by JED(E, s).\nRemark 1 (Stationary storage): It is easy to incorporate stationary storage into our model by disallowing relocation of a subset of mobile storage units. In other words, if storage unit k\u0303 is a stationary storage, we require ik\u0303(t) or the k\u0303-th row of matrix E(t) to stay constant over time. Alternatively, stationary storage can be modeled using a separate set of variables and constraints in the MPED-S problem (cf. [10]).\nThe problem of optimizing the movements of the mobile storage fleet is then\nmin I\nJED(E(I), s) + JR(I), (7)\nwhere the initial locations of the mobile storage units {ik(1)}k\u2208[K] are given, and the decision variable I := {ik(t)}k\u2208[K],t\u2208[T ] is optimized such that each ik(t) \u2208 ISk \u2286 [n] and ISk is the set of buses with which mobile storage unit k can be connected.\nNote that unlike the multi-period economic dispatch problem (6) which is a convex program, the optimal storage relocation problem (7) is a combinatorial optimization problem."
        },
        {
            "heading": "IV. RAPID MOBILE STORAGE",
            "text": "We first consider storage that can both charge and move rapidly: it does not require any time to move between buses, and the power limit for charging and discharging is large enough that the power constraints (6e) are never binding. This analysis serves two purposes: (a) it provides a theoretical account of the problem focusing on the relocation aspect while omitting the complexity associated with travel times (which is addressed in Section V), and (b) it offers a good model for virtual mobile storage, including storage capabilities derived from flexible loads that are geographically shiftable such as a collection of Internet data centers. Given the locations of the\n4 mobile storage units E, the MPED-S problem is given by (6) without the power constraint (6e):\nmin g,u T\u2211 t=1 Ct(p(t)) (8a)\ns.t. 1>(g(t)\u2212 d(t)\u2212 E(t)u(t)) = 0, t \u2208 [T ], (8b) H(g(t)\u2212 d(t)\u2212 E(t)u(t)) \u2264 f , t \u2208 [T ], (8c) 0 \u2264 Luk \u2264 sk1, k \u2208 [K]. (8d)\nWhile we do not model the travel times in this case, we can still capture the cost of moving storage from one bus to another. In particular, we use \u03baDij to model the cost of relocating from bus i to bus j. For the example of Internet data centers, this cost may model the loss of quality of service from moving energy consuming data-processing loads from one data center to another. With relocation cost defined as (5), the optimal relocation problem still takes the form of (7)."
        },
        {
            "heading": "A. Marginal value of rapid mobile storage",
            "text": "Tackling the optimal relocation problem requires a good understanding of the optimal value of MPED-S problem (8), which in turn depends on the spatial and temporal distribution of storage capacities. One way to characterize such dependence is through analyzing the marginal value of mobile storage with fixed relocation pattern E.\nDefinition 1 (Marginal value of mobile storage): Given storage relocation pattern E, the marginal value of mobile storage k is defined as\nMVmsk (E, s) = \u2212 \u2202JED(E, s)\n\u2202sk , k \u2208 [K]. (9)\nMVmsk (E, s) characterizes the reduction in the operation cost of the grid when we marginally increase the storage capacity of mobile storage k, given the relocation pattern E. As the objective function of (8) is strictly convex quadratic, we can check that the partial derivatives in (9) indeed exist.\nIt turns out that we can obtain an explicit and intuitive characterization of MVmsk (E, s) via the dual variables of (8). Denote the (optimal) dual variables associated with constraints (8b), (8c), and (8d) by \u03b3(t) \u2208 R, \u03b2(t) \u2208 R2m, and (\u03bdk,\u00b5k) \u2208 RT \u00d7RT , respectively, where \u03bdk is associated with the lower bound in (8d) and \u00b5k is associated with the upper bound. We can also calculate the locational marginal prices (LMPs), denoted by \u03bbi(t), for each bus i and time period t using these dual variables (cf. [10]):\n\u03bb(t) = \u03b3(t)1\u2212H>\u03b2(t), t \u2208 [T ]. (10) Notice that the dual variables and LMPs depend implicitly on the relocation pattern E and storage capacities s.\nTheorem 1 (Marginal value of mobile storage): The marginal value of mobile storage k with relocation E is\nMVmsk (E, s) = 1>\u00b5k = T\u2211\nt=1\n( \u03bbik(t+1)(t+ 1)\u2212 \u03bbik(t)(t) ) + , (11)\nwhere \u03bb(T + 1) := 0. The following observations are immediate. First, the marginal value of mobile storage is non-negative. In other words, increasing the capacities of mobile storage will weakly\ndecrease the optimal cost for the dispatch problem. This is a consequence of the fact that JED(E, s) is a convex and nonincreasing function of s. Second, the marginal value of mobile storage can be directly obtained by summing up the dual variables associated with the upper bound in storage capacity constraints (8d). Indeed, the dual variable \u00b5k characterizes the improvement in the objective function (generation costs) per unit relaxation of the constraint, i.e., per unit increase in the storage capacity. Finally, the marginal value of mobile storage k can be calculated from the sum of (non-negative) increases in LMPs along the relocation path of the mobile storage unit."
        },
        {
            "heading": "B. Comparison to stationary storage and wires",
            "text": "Theorem 1 not only provides a way to relate the marginal value of a mobile storage unit to its relocation path, but also offers insights for understanding the value of mobile storage through well-understood quantities in electricity markets. In particular, we can compare the marginal value of a mobile storage to the marginal value of wires and stationary energy storage. To this end, we denote the marginal value of the capacity associated with e-th line capacity constraint by MVwe , and denote the marginal value of stationary energy storage located at bus i by MVssi . These quantities are related to the dual variables as follows [10], [15]:\nMVwe = T\u2211 t=1 \u03b2e(t), MV ss i = T\u2211 t=1 ( \u03bbi(t+ 1)\u2212 \u03bbi(t) ) + .\nFor convenience, we also define the marginal values for each time period t \u2208 [T ] as\nMVwe (t) = \u03b2e(t), MV ss i (t) = ( \u03bbi(t+ 1)\u2212 \u03bbi(t) ) + ,\nMVmsk (t) = \u00b5k(t) = ( \u03bbik(t+1)(t+ 1)\u2212 \u03bbik(t)(t) ) + ,\nfor each e \u2208 [2m], i \u2208 [n] and k \u2208 [K], where we have omitted the dependence on E and s as they are fixed in this subsection.\nWe provide three illustrative examples highlighting the role of mobile storage with different power network topologies and congestion patterns.\n1) Example 1: \u201cmobile storage = storage + wire\u201d: Consider a two-bus network operated across two time periods. This is illustrated in Fig. 1a using a time-extended graph of the network. Here each node in time period t represents a bus in the power network, black solid lines represent electric wires, the blue solid line and the blue dashed line represent the \u201cpower flow links\u201d created by a mobile storage unit moving from bus 1 to bus 2 and a stationary storage unit located at bus 2, respectively.\n5 Suppose for this network we have \u03bb2(2) > \u03bb2(1) > \u03bb1(1). Then we can obtain (see e.g., [15] for the relation between LMPs and dual variables associated with transmission constraints for a radial network) that MVw(1) = \u03bb2(1) \u2212 \u03bb1(1), MVss(1) = \u03bb2(2) \u2212 \u03bb2(1), and MVms(1) = \u03bb2(2) \u2212 \u03bb1(1), where we have omitted the subscripts for the marginal values as they are clear from the context. As a result,\nMVms(1) = MVw(1) + MVss(1),\nin this case. This is intuitive as both flow paths (i = 1, t = 1) \u2192 (i = 2, t = 2) and (i = 1, t = 1) \u2192 (i = 2, t = 1) \u2192 (i = 2, t = 2) enable sending energy from (i = 1, t = 1) to (i = 2, t = 2). We can generalize this observation to other radial power networks, and make a statement about the value of mobile storage in a radial network where the power flow is along a directed flow path.\nLemma 1 (Radial network): Consider a radial network where the power flow between node i at time t and node j at time t + 1 is along the directed flow path (i, t) \u2192 (k1, t) \u2192 ... \u2192 (kp, t) \u2192 (j, t) \u2192 (j, t + 1) connecting them in the time-extended graph, where k1, ...kp are nodes on the power network, and each edge represents a wire or a stationary storage unit. The marginal value of a mobile storage that moves from node i at time t to node j at time t+1 is equal to the sum of marginal values of wires on the path from bus i to bus j on the power network for period t and the marginal value of stationary storage located at bus j for period t.\n2) Example 2: \u201cmobile storage > storage + wire\u201d: Now we consider the operation of a three bus network across 2 periods as depicted in Fig. 1b. The mobile storage unit moves from bus 3 to bus 1. Suppose that \u03bb1(2) > \u03bb1(1) > \u03bb3(1), and the line 3\u2192 1 and another line in the loop (i.e., 3\u2192 2 or 2\u2192 1 in power network) are congested in period 1. Here we have \u03b23\u21921(1) < \u03bb1(1) \u2212 \u03bb1(3), where \u03b23\u21921(1) is the dual variable associated with the line capacity constraint for the flow from bus 3 to bus 1 in time period 1. Appendix A provides the data for a problem instance where this holds. In this case, we have MVms(1) = \u03bb1(2)\u2212\u03bb3(1), MVss(1) = \u03bb1(2)\u2212\u03bb1(1), and MVw(1) = \u03b23\u21921(1) < \u03bb1(1)\u2212 \u03bb1(3), and\nMVms(1) > MVw(1) + MVss(1),\nwhere MVw(1) denotes the marginal value of the line connecting bus 3 and bus 1 in time period 1. The gap stems from the fact that the flow paths (i = 3, t = 1) \u2192 (i = 1, t = 2) and (i = 3, t = 1)\u2192 (i = 1, t = 1)\u2192 (i = 1, t = 2) are not equivalent. This is because the flow on a line in a loop cannot be freely determined for power networks with loops due to Kirchhoff\u2019s voltage law. When another line in the loop is also congested, increasing the capacity of link 3\u2192 1 in the power network by one unit does not let us increase flow on the link due to the binding capacity constraint of the other congested line. This effect is referred to as loop externality [16].\n3) Example 3: \u201cmobile storage < storage + wire\u201d: Consider the same network and storage configuration in Example 2 (Fig. 1b). Now we require that \u03bb1(2) > \u03bb1(1) > \u03bb2(1) > \u03bb3(1), and the line 3\u2192 1 is the only line congested in period 1. In this case, increasing the capacity of line 3 \u2192 1 can increase not only the flow on the link 3 \u2192 1, but also allow\nthe flow along the links 3 \u2192 2 \u2192 1 to be increased. As a result, we can have \u03b23\u21921 > \u03bb1(1)\u2212 \u03bb3(1). It follows that in this case, we have\nMVms(1) < MVw(1) + MVss(1),\nwhere MVw(1) denotes the marginal value of the line connecting bus 3 and bus 1 in time period 1. Appendix A provides a numerical example where this holds."
        },
        {
            "heading": "C. Optimal relocation of small mobile storage",
            "text": "Solving the optimal relocation problem for rapid mobile storage using brute-force methods is computationally intractable because the computation time scales with the problem size as O(nKT ). However, in practice, we can simplify the optimal relocation problem for a mobile storage fleet because we expect that the storage capacities of such fleets will be relatively small in the near future. This is motivated by the fact that the total storage capacity is still a tiny fraction of the total power load. To get a sense, the estimated total capacity of storage deployed in 2020 is about 0.296% of the estimated load in the same year [1]. We formalize this concept in the following assumption:\nAssumption 1 (Small storage): We assume that the storage capacities s are small in either of the following two senses: A1.a Then arg minI{JED(E(I), s) + JR(I)} =\narg minI{J\u0302ED(E(I), s) + JR(I)}, where J\u0302ED(E, s) is the first order Taylor approximation of JED(E, s): J\u0302ED(E, s) = JED(E,0)\u2212 \u2211K k=1 MV ms k (E,0)sk.\nA1.b Suppose the load is such that the LMPs for each node and time with s = 0 are distinct. Then a small capacity s does not change the relative ordering of LMPs. 2\nNote that Assumption 1 does not rule out the possibility that there is a significant amount of stationary storage connected to the system. Stationary storage can be modeled using a separate set of variables and constraints in the MPED-S problem.\nUnder the small storage assumption, the optimal relocation problem for the fleet decouples. In other words, solving the optimal relocation problem for a fleet is equivalent to solving K optimal relocation problems for individual units:\nmax Ik\nMVmsk (E,0)sk \u2212 JRk (Ik), k \u2208 [K], (12)\nwhere the initial locations of the mobile storage units {ik(1)}k\u2208[K] are given, and the decision variable Ik = {ik(t)}t\u2208[T ] is optimized such that each ik(t) \u2208 ISk \u2286 [n] and ISk is the set of buses with which mobile storage unit k can be connected. The optimal trajectory for different storage units may be different because they have different storage capacities, initial locations and sets of admissible buses ISk .\nThe optimal relocation problem (12) can be converted into a shortest path problem and thus solved efficiently in polynomial time (O(n2T )) with a range of algorithms including the Bellman-Ford algorithm and linear programming. Indeed, we can construct a time-extended graph G(V, E), where the set of nodes V includes T copies of all the nodes in the power\n2This holds for almost every load d(t) \u2208 Rn for each t. In other words, the set of loads for which this does not hold has Lebesgue measure 0.\n6 network [n], and a dummy sink node. The set of edges E includes directed edges from every node i in the t-th copy to every node j in the (t+ 1)-th copy, with edge weight\nwij(t) = \u03baDij \u2212 sk(\u03bbj(t+ 1)\u2212 \u03bbi(t))+, t \u2208 [T \u2212 1],\nand directed edges from every node in the T -th copy to the dummy sink node, with edge weight 0. The LMPs are calculated using dual variables for (8) with s = 0. By solving the shortest path problem from source node ik(1) to the dummy sink node in the time extended graph, we can identify the optimal trajectory {ik(t)}t\u2208[T ] for storage k. Fig. 2 provides an example of the graph G(V, E)."
        },
        {
            "heading": "V. GENERAL MOBILE STORAGE",
            "text": "In general, the time needed for relocating mobile storage units is not negligible, and both energy limits and power limits should be considered for mobile storage operation. In this case, we need to solve the general version of the MPED-S problem (6) and the optimal relocation problem (7)."
        },
        {
            "heading": "A. Marginal value of mobile storage",
            "text": "Similar to Section IV-A, we quantify the marginal value of mobile storage for a fixed relocation pattern E. Denote the (optimal) dual variables associated with constraints (6b) and (6c) by \u03b3(t) \u2208 R and \u03b2(t) \u2208 R2m. \u03bdk and \u00b5k are associated with the lower bound and upper bound in (6d), and \u03c9k and \u03c6k are associated with the lower bound and upper bound in (6e), respectively. We define the LMPs \u03bb(t) as in (10).\nWhen the power limits depend on the energy limits (i.e., u\u0304k is a function of s\u0304k), it is necessary for us to keep track of whether energy or power constraints are binding at each time. For simplicity, we introduce the the following standard assumption for the MPED-S problem under consideration.\nAssumption 2 (LICQ): Given any relocation pattern E, the constraints binding at the solution of the MPED-S problem (6) are linearly independent.\nWhen optimizing the movement of mobile storage in a power network, we may be able to forecast the LMPs ahead of time. These prices will not be affected by the movement of mobile storage under the small storage assumption (Assumption 1). Meanwhile, we can identify the set of binding storage constraints for each storage k using a simpler optimization involving LMPs and the parameters for the storage unit.\nLemma 2: Suppose that for each storage k, the price arbitrage problem given by\nmax uk \u2212 T\u2211 t=1 \u03bbik(t)(t)uk(t)\ns.t. 0 \u2264 Luk \u2264 sk1;\u2212uk(sk)\u2206Sk \u2264 uk \u2264 uk(sk)\u2206Sk.\n(13)\nhas a unique solution. Then the optimal operation uk for storage k in a solution of the MPED-S problem (6) is the same as the solution of the price arbitrage problem (13).\nCorollary 1: Since the optimal operation of storage k in the MPED-S problem (6) coincides with the solution of the price arbitrage problem (13), they will lead to the same collection of binding constraints for storage k.\nUnder Assumption 2, the binding constraints in (13) can then be used to partition [T ] into two disjoint sets:\nT ek (E) = {ter}r\u2208[T ek ], T p k (E) = {t p s}s\u2208[Tpk ]\nwhere T ek (E) and T p k (E) represent the times when energy capacity and power capacity constraints are binding, and T ek and T pk are the number of time periods within T ek (E), T p k (E), respectively. Henceforth we omit the dependence on E and k to simplify the notation. Let \u03c3 : T p 7\u2192 T e denote the mapping from each power capacity constrained time to the next energy capacity constrained time, i.e., \u03c3(tp) = inf\u03c4{\u03c4 \u2208 T e : \u03c4 > tp}. Fig. 3 provides an illustration of \u03c3. The \u03c3 mapping is defined for all tp \u2208 T p when T \u2208 T e. This is the case when we have nonnegative LMPs since the optimal state of charge (SoC) in the terminal time period T will be empty.\nTheorem 2 (Marginal value of mobile storage): The\nmarginal value of mobile storage k with relocation E is\nMVmsk (E, s\u0304) = 1 >\u00b5k + u\u0304 \u2032 k(s\u0304k)(\u2206 S k) >(\u03c9k + \u03c6k), (14)\nwhere for each ter \u2208 T e,\n\u00b5k(t e r) = ( \u03bbik(ter+1)(t e r+1)\u2212 \u03bbik(ter)(t e r) ) + , \u03c9k(t e r) + \u03c6k(t e r) = 0,\nfor each tps \u2208 T p,\n\u00b5k(t p s) = 0, \u03c9k(t p s) + \u03c6k(t p s) = \u2223\u2223\u03bbik(\u03c3(tps))(\u03c3(tps))\u2212 \u03bbik(tps)(tps)\u2223\u2223 , and we define teT e+1 := T + 1 and \u03bb(T + 1) := 0.\nSimilar to the rapid storage case, the marginal value of mobile storage is non-negative, i.e., increasing the storage capacity s\u0304k will weakly decrease the optimal cost for the dispatch problem. The marginal value is obtained by summing the dual variable associated with the upper bound in the storage capacity constraint (6d), and the dual variables associated with the power constraints (6e) weighted by the time available to charge \u2206Sk and the dependence of power capacity on storage capacity u\u0304\u2032k(s\u0304k). The dual variable \u03c9k characterizes the value of increasing the discharging power capacity, and the dual\n7 variable \u03c6k characterizes the value of increasing the charging power capacity. Comparing the marginal value expression in (14) to that of rapid mobile storage (11), we observe that the new expression uses LMP increases across consecutive energy capacity-constrained time periods as well as LMP differences across power constrained and energy constrained time periods. The price arbitrage across ter \u2208 T e is not a complete measure of the marginal value, as charge/discharge also occurs at intermediate time steps (tpr \u2208 T p).\nCorollary 2: In the case that power constraints have no dependence on sk, i.e. u\u2032k(sk) = 0, the marginal value is\nMVmsk (E, s\u0304) = 1 >\u00b5k\nwith \u00b5k(t) defined as in Theorem 2. This is similar to the case in Theorem 1, as any increase in storage capacity will not alleviate power constraints. However, the expression for \u00b5k here is different from that in Theorem 1 due to the storage power constraints. Stationary storage can also be viewed as a special case of mobile storage where the battery is located at a single bus at all times.\nCorollary 3 (Marginal value of stationary storage): The marginal value of stationary storage k located at bus i, i.e., ik(t) = i for all t, is\nMVssk (\u0304s) = 1 >\u00b5k + u\u0304 \u2032 k(s\u0304k)\u22061 >(\u03c9k + \u03c6k)\nwhere for each ter \u2208 T e,\n\u00b5k(t e r) = ( \u03bbi(t e r+1)\u2212 \u03bbi(ter) ) + , \u03c9k(t e r) + \u03c6k(t e r) = 0,\nfor each tps \u2208 T p,\n\u00b5k(t p s) = 0, \u03c9k(t p s) + \u03c6k(t p s) = |\u03bbi(\u03c3(tps))\u2212 \u03bbi(tps)| ,\nand we define teT e+1 := T + 1 and \u03bb(T + 1) := 0. This result generalizes existing results on the locational marginal value of stationary storage [9], [10] by incorporating storage power constraints."
        },
        {
            "heading": "B. Comparison to stationary storage and wires",
            "text": "Since the rapid mobile storage model discussed in Section IV is a special case of the general mobile storage model, the examples discussed in Section IV-B remain valid for the general mobile storage model. However, Lemma 1 does not generalize to the general mobile storage case as the storage power constraints and time taken to travel can impact the marginal value of mobile storage. Intuitively, with a nonzero travel time, the time available for mobile storage to charge/discharge is strictly less than that for stationary storage. As a result, in scenarios where the storage power constraints are binding and the reduced charging/discharging time matters, the marginal value of mobile storage can be strictly less than the sum of marginal values of the corresponding stationary storage unit and wires even if the network does not have loops."
        },
        {
            "heading": "C. Optimal relocation of small mobile storage",
            "text": "Under Assumption 1, the optimal relocation problem for the mobile storage fleet decouples as in the case of rapid mobile storage, and we can use LMPs for s = 0 in the marginal value calculation. However, the marginal value of general mobile\nstorage depends on the order of binding constraints. When the constraint binding pattern (T e, T p) is given, we can identify the optimal relocation associated with (T e, T p) by solving a shortest path problem referred to as SP-E(T e, T p) over all energy constrained time periods. We construct a time-extended graph G(V, E) where the set of nodes V includes T e copies of all the nodes in the power network [n], and a dummy sink node. The set of edges E includes directed edges from every node i in the copy corresponding to ter to every node j in the copy corresponding to ter+1, with an edge weight wij(t e r) = (15){\n\u2212sk ( \u03bbj(t e r+1)\u2212 \u03bbi(ter) ) + + \u03baDij , if ter+1 = t e r + 1,\n\u2212sk ( \u03bbj(t e r+1)\u2212 \u03bbi(ter) ) + + JSP-Pij (t e r), otherwise,\nand directed edges from every node in the T e-th copy to the dummy sink node, with edge weight 0. If ter+1 6= ter +1, there are power constrained time periods between ter and t e r+1, and the edge weight will depend on the cost of traveling along an optimal path for all intermediate power constrained time periods tps \u2208 {ter + 1, . . . , ter+1 \u2212 1} denoted by JSP-Pij (ter).\n1) Calculating JSP-Pij (t e r): The optimal path for the power constrained time periods between ter and t e r+1 can be found by formulating a shortest path problem referred to as SPPij(ter). For each i, j \u2208 [n], ter \u2208 T e, we construct a shortest path problem on a time-extended graph G\u0303(V\u0303, E\u0303) where we omit the dependence on i, j and ter to simplify notation. The set of nodes V\u0303 include a source node (representing node i in time ter), a sink node (representing node j in time t e r+1), and a copy of all the nodes in the power network [n] for each tps \u2208 {ter + 1, . . . , ter+1\u2212 1}. The set of edges E\u0303 includes (a) a directed edge from the source node i to every node j\u0303 \u2208 [n] in the first copy (which corresponds to tps = t e r + 1), with weight wi j\u0303 = \u03baDi j\u0303 , (b) if |{t e r + 1, . . . , t e r+1 \u2212 1}| > 1, a directed edge from every node i\u0303 \u2208 [n] in the copy corresponding to each tps \u2208 {ter + 1, . . . , ter+1 \u2212 2} to every node j\u0303 \u2208 [n] in the copy corresponding to tps+1, with weight\nw i\u0303 j\u0303(t p s) = \u03baD i\u0303 j\u0303 \u2212 sku \u2032 k(sk)\u2206 S i\u0303 j\u0303 |\u03bbj(ter+1)\u2212 \u03bb i\u0303(t p s)|, (16)\nand (c) a directed edge from each node i\u0303 \u2208 [n] in the last copy (corresponding to tps = t e r+1 \u2212 1) to the sink node j, with weight defined in (16). We overload the notation \u2206Sij to represent the time available for battery operation if it travels from node i to j in that time period. JSP-Pij (t e r) is the cost of traveling along the shortest path in this extended graph. 2) Solving SP-E(T e, T p): In order to solve SPE(T e, T p), we first solve JSP-Pij (ter) for each i, j \u2208 [n], ter \u2208 T e and determine the edge weights of the time-extended graph G(V, E). We then solve the shortest path problem SPE(T e, T p) using the edge weights determined by (15).\n3) Identifying optimal relocation E: First, from the solution of SP-E(T e, T p), we obtain the sequence of nodes where mobile storage is located at each time in T e. We use this to obtain the nodes (i, j) at which the mobile storage is located for each pair of non-consecutive energy constrained time periods (ter, t e r+1 such that t e r+1 6= ter+1), and the solution to SP-Pij(ter) provides the relocation pattern for the storage during the power constrained time periods between ter and\n8 ter+1. Piecing together the locations of the storage in energy constrained times and power constrained times results in the optimal relocation pattern E(T e, T p) given (T e, T p).\nIn practice, we do not know the constraint binding patterns (T e, T p) without knowing the optimal relocation, as moving along different relocation paths will change the optimal storage operation. One approach is to enumerate all possible constraint binding patterns (T e, T p) and solve SP-E(T e, T p) for each constraint binding pattern. This will result in an optimal relocation pattern E(T e, T p), whose consistency with the assumed constraint binding pattern needs to be checked by computing the actual constraint binding pattern under this relocation pattern and comparing with the assumed (T e, T p). If they are the same, this relocation pattern is an admissible solution. After going through all O(2T ) possibilities, we can find the optimal relocation pattern by finding the admissible solution with the lowest cost. Since for small storage either energy or power constraint is binding at every time step, this amounts to solving the shortest path problem described above O(2T ) times. As our model focuses on daily operation with every time period long enough for mobile storage to relocate, T is usually relatively small (e.g., T = 12 for 2 hour time periods). Algorithm 1 summarizes the steps to generate an optimal relocation path for general mobile storage.\nAlgorithm 1: Optimal relocation for general mobile storage\nfor each possible (T e, T p) do for ter \u2208 T e, i, j \u2208 [n] do\nCompute JSP-Pij (t e r) by solving SP-Pij(ter);\nCompute weights in SP-E(T e, T p) with (15); end Compute E(T e, T p) by solving SP-E(T e, T p); if E(T e, T p) is admissible then\nStore E(T e, T p) end\nend return E? with the minimum cost among all the\nstored E(T e, T p)"
        },
        {
            "heading": "D. Approximate optimal relocation of small mobile storage",
            "text": "The algorithm in Section V-C is conceptually simple and leverages the analytical insight derived in Section V-A. However, due to the dependence on constraint binding patterns it has a time complexity that is exponential in T , and therefore is not practical when the optimal relocation problem is solved over a large number of time periods. In order to eliminate this exponential dependence, we propose an alternative algorithm in the supplementary material which achieves a near-optimal solution and eliminates the need to know the constraint binding patterns. We discretize the state-of-charge (SoC) space to create \u2018nodes\u2019 which have an associated SoC and location tuple. We construct a time extended graph across these nodes, and calculate edge weights based on the value of moving from one SoC and location pair to another. We then solve a longest path problem over the graph, and find that the\nFig. 4: Average LMP of the selected nodes in May 2021\napproximate solution converges to the true optimal solution as our discretization becomes finer. The approximate algorithm can be solved in polynomial time, and the error bound is linear in the discretization step size.\nVI. ILLUSTRATIONS\nWe now illustrate our results on optimal relocation for storage. In Lemma 2 we showed that the optimal operation of a mobile storage unit in the solution of the MPED-S problem coincides with the solution of the price arbitrage problem. We do not have access to network topology and constraints, but we do have access to historical and forecast LMPs, and we use the solution of the price arbitrage problem to illustrate the optimal operation and movement of mobile storage.\nData: We consider a subset of price nodes in Maryland within PJM territory, shown in Fig. 4, which are intended to be representative of LMP zones. The LMPs for nodes are obtained from the PJM DataMiner [17] for the month of May 2021. LMP node names are used to identify locations on a map, and we model the entirety of an LMP zone as a single interconnection point. The travel time between nodes is modeled using the straight line distance and a speed of 50 miles per hour, and travel cost is taken to be 4 cents/mile from the US DoE estimate [18] for passenger EVs, and 16 cents/mile for an electric truck. While we do not explicitly model driver wages as a part of the cost, we will discuss the question of how to incentivize drivers to participate in Section VI-C. We consider a time horizon of 24 hours, with a time step of 1 hour. We model two mobile storage units: a Tesla Model 3 with a 50 kWh battery and a maximum power throughput of 11 kW (level 2 AC charging power), and a Tesla Semi with a 500kWh battery and maximum power throughput of 100 kW.\nThe selected nodes exhibit spatial price differences, illustrated by variation in the average LMP in Fig. 4. They also exhibit temporal price variation, i.e., the LMP at a single node varies over the course of the day. In Fig. 5 we show the spread of prices over two days in the month of May. At each hour, the LMPs across all nodes are used to make a boxplot to illustrate how the LMPs are spread out. A longer boxplot height indicates that there is high spatial variance in LMP at that hour, which is the case on 4 May 2021 at 4 pm. A\n9\nshorter boxplot indicates that the LMP across nodes is largely similar, which is the case on 8 May 2021.\nThe spatial variation in prices can change significantly from one day to the next, depending on the grid constraints in force on either day. A mobile storage unit, e.g., an EV can capitalize on these differences as discussed previously. We use the algorithm proposed in Section V-D to optimize the movement and operation of an EV over the price nodes in Fig. 4 on 4 May 2021, a day of high spatial LMP variation."
        },
        {
            "heading": "A. Tesla Model 3",
            "text": "The EV is initially charged to 40%, and starts the day at the LANHAM node. Fig. 6 illustrates the movement of the EV over the course of 4 May 2021. The arrows indicate the optimized movement of the EV over time, and the circles indicate the change in state-of-charge (SoC) at each node with a radius proportional to the magnitude of the net energy charge or discharge at that node. Red circles indicate discharging and green circles indicate charging. The EV starts at 40% charge from a node in the bottom-right corner of the figure, and continues to move across nodes over the course of the day, ending the day at a node in the top-left corner with 0% charge.\nThe EV\u2019s movement is optimized to maximize the value of mobile storage, and as it moves across nodes it experiences an effective LMP as shown in Fig. 7. The value gained from arbitrage is $7.12, and the travel costs work out to $0.78, making the net profit $6.34 for 4 May 2021. The EV battery is power constrained through most hours of operation, which indicates that faster bidirectional charging could enable higher value. Most of the value is captured by discharging at BELLSMIL node at 5 pm and 6 pm. This indicates that there are a few high-value hours when we can prioritize dispatch.\nIf we compare this value to the value of a stationary battery at any of the nodes, we find that though the mobile storage does better than a stationary storage located at the same starting node (LANHAM), but worse than a stationary battery located at BELLSMIL. However, a mobile storage starting at BELLSMIL does better than a stationary battery at the same node. The value of mobile storage comes from its mobility, but is also affected by the starting location and state-of-charge."
        },
        {
            "heading": "B. Tesla Semi truck",
            "text": "We now consider a Tesla Semi that moves across the power network to maximize its price arbitrage value. A Tesla Semi has a significantly higher battery capacity, and can consequently generate more value. The optimal movement for a truck starting at 40% capacity is illustrated in Fig. 9, and the value gained from arbitrage is 69.8$. The travel costs work out to 3.23$ over the course of the day. The net profit from operating this EV on 4 May 2021 is 66.56$, and the battery is power constrained for most hours through the day. This indicates that faster bidirectional charging could unlock more value from the same battery resource. Most of the value is generated by discharging during 5-7 pm, i.e., there are a few high-value hours when we can prioritize dispatch."
        },
        {
            "heading": "C. Effect of fast bidirectional charging",
            "text": "In our simulation, the EV batteries are power constrained for multiple time periods and faster bidirectional charging can help generate more value. We now consider a situation where the power rating of the chargers is significantly increased. For the Tesla Model 3, we model fast charging with a 100 kW bidirectional charging speed (which is an average fast charger power throughput). For the Tesla Semi, we model fast charging\n10\nwith a 750 kW charge/discharge rate. These modifications ensure that the battery is almost never power constrained, and boost the net profit from arbitrage to 17.32$ for the Tesla Model 3 and 182.38$ for the Tesla Semi, starting from the same SoC and initial location as in the previous simulations.\nWhile putting these numerical results in perspective, we need to consider that all days will not look the same for an EV conducting price arbitrage. We chose a date which had high inter-node price variability which led to higher revenue from spatial price arbitrage. We also modeled an EV that could be controlled completely, i.e., could be moved around and charged/discharged at will. In reality, operators will likely not be able to control EV movement without giving monetary incentives, and may have to work with existing EV movement patterns (e.g., people driving their EVs to work and back). They will also not be able to charge/discharge the full battery capacity, and will have to reserve a portion of the battery to move the EV itself. Charging and discharging the battery will accelerate its degradation, and there will be associated costs that the operator will have to incur.\nAt the same time, there are a number of ways that mobile storage could provide value to the grid while also garnering enough compensation to incentivize the driver. As seen in Table I, most of the day\u2019s value is captured in a few hours, and mobile storage operators could be strategically incentivized to capture arbitrage value in those few hours. There are also a few high value nodes within the network which have a larger difference in LMPs across the day as compared to other nodes. If mobile storage is initially located near those nodes, it will be able to generate more value. The system operator can also capitalize on existing movement patterns, e.g., people commuting from their homes to workplaces and optimize storage operation with fixed movement patterns. Larger mobile storage like battery-mounted trucks will tip the profit vs. cost scale further, as these resources will transport larger amounts of energy with lower labor input. A large scale simulation of EV movement patterns and LMPs across a longer timescale will help answer questions on the practicality of this scheme."
        },
        {
            "heading": "VII. CONCLUSION",
            "text": "This paper formalizes the marginal value of mobile storage from a system operator\u2019s perspective and develops analytical expressions for two storage models: a simplified rapid storage model and a general storage model that incorporates travel time and power constraints. We developed illustrative examples to demonstrate the value of mobile storage as compared to stationary storage and wires. Efficient algorithms for the\noptimal storage relocation problem are then proposed based on analytical expressions for the marginal value of mobile storage. We also propose an approximate optimal relocation algorithm which is more tractable than the exact solution algorithm for the general mobile storage model. We illustrate this algorithm with a simulation of an EV moving across nodes in PJM territory, and calculate the value of optimizing operations across the power network."
        },
        {
            "heading": "APPENDIX A NUMERICAL EXAMPLES FOR SECTION IV-B",
            "text": "Numerical case for Example 2: Consider a two-period economic dispatch problem for a three bus network, with nodes 1, 2, 3 as in Fig. 1b. Assume the system is equipped with a stationary battery of capacity 0.5 at node 1, and a mobile battery of capacity 0.5 which is located at node 3 in the first period and at node 1 in the second period. Further, assume each node has power generation with a quadratic cost function Ci(gi(t)) = gi(t)2, and each of the lines has an identical susceptance value and capacity of 0.5. The energy demand of this system is concentrated at node 1, with a demand of 5 in the first period, and 10 in the second period. In this situation, both line 2 \u2192 1 and line 3 \u2192 1 are congested in time period 1. The LMPs for the two periods are \u03bb1(1) = 9, \u03bb3(1) = 2, \u03bb1(2) = 16, which means that MVms(1) = \u03bb1(2) \u2212 \u03bb3(1) = 14, MVss(1) = \u03bb1(2)\u2212\u03bb1(1) = 7. Meanwhile, MVw(1) = \u03b23\u21921(1) = 6, and MVw(1) + MVss(1) = 13 < MVms(1).\nNumerical case for Example 3: Consider the same setup as in a) but with a different demand. The demand of the system in the first time period is 5 units each at node 1 and 2, and 10 units at node 1 in the second period. In this situation, both line 3 \u2192 1 and line 3 \u2192 2 are congested in time period 1. The LMPs for the two periods are \u03bb1(1) = 10, \u03bb3(1) = 3, \u03bb1(2) = 16, which means that MV\nms(1) = \u03bb1(2)\u2212\u03bb3(1) = 13, MVss(1) = \u03bb1(2) \u2212 \u03bb1(1) = 6. Meanwhile, MVw(1) = \u03b23\u21921(1) = 8, and MV w(1) + MVss(1) = 14 > MVms(1)."
        },
        {
            "heading": "APPENDIX B PROOFS FOR SECTION IV",
            "text": "Proof for Theorem 1: From the Lagrangian of the economic dispatch problem in (8), we get that MVmsk (E, s) = 1>\u00b5k. Further, from the stationarity KKT condition with respect to uk(t), we get L>t (\u00b5k \u2212 \u03bdk) = \u2212\u03b3(t) + Ek(t)>H>\u03b2(t), where L>t is the t\nth column of L>, and Ek(t) is the kth column of E(t). At any time, only one of the pair of constraints in (8d) will be binding. Hence, either \u00b5k(t) = 0 or \u03bdk(t) = 0. Using the definition of \u03bb(t) from (10), we get the expression in (11).\nProof for Lemma 1: A radial power network can be represented as a tree, and there is a unique path between any two nodes. Consider two nodes i, j with a path i \u2192 k1 \u2192 k2 \u2192 ...kp \u2192 j, where k1, ...kp are nodes in the power network. The LMP difference across i, j at any time can be written as\n\u03bbj \u2212 \u03bbi = (\u03bbj \u2212 \u03bbkp) + ...+ (\u03bbk2 \u2212 \u03bbk1) + (\u03bbk1 \u2212 \u03bbi), i.e. the sum of LMP differences across nodes in the path between i, j. For any edge in the power network, we will have two \u03b2 values (one in each direction) out of which only one can be non-zero - the \u03b2 value corresponding to the direction of power flow, since the line can only be congested in that direction. From [15] we have that \u03b2i,j(t)\u2212\u03b2j,i(t) = \u03bbj(t)\u2212\u03bbi(t), and if the power flow is i\u2192 j, then\nMVwi\u2192j(t) = \u03b2i,j(t) = \u03bbj(t)\u2212 \u03bbi(t) \u2265 0.\nThe value of stationary storage located at j at time t is MVssj (t) = ( \u03bbj(t+ 1)\u2212 \u03bbj(t) ) + ,\nwhere \u03bbj(t+1)\u2212\u03bbj(t) \u2265 0 since the stationary storage would only transfer energy across time if it had a positive value from doing so. The marginal value of mobile storage that moves from node i at time t to node j at time t+1 can be expressed as\nMVms = ( \u03bbj(t+ 1)\u2212 \u03bbi(t) ) +\n= ( \u03bbj(t+ 1)\u2212 \u03bbj(t) + \u03bbj(t)\u2212 \u03bbkp(t)+\n...+ \u03bbk1(t)\u2212 \u03bbi(t) ) +\n= MVssj (t) + MV w kp\u2192j + ...+ MV w i\u2192k1 ."
        },
        {
            "heading": "APPENDIX C APPROXIMATE OPTIMAL RELOCATION OF SMALL MOBILE STORAGE",
            "text": "1) Mobile storage operator perspective: We first consider the optimal relocation problem from the perspective of a storage operator that knows the LMPs \u03bb over the time horizon T in advance, and wishes to optimize the operation and movement of the mobile storage. We will show that solving this problem is equivalent to solving MPED-S. At each time t \u2208 [T ], say the storage unit k is moved from node ik(t) to ik(t+ 1) and charged by uk(t). The total value of the mobile storage over T is\nT\u2211 t=1 \u2212\u03bbik(t)(t)uk(t)\u2212 \u03baDik(t)ik(t+1),\nwhich is price arbitrage revenue net of travel costs. Lemma 3: Suppose that for each storage k, the price arbitrage profit maximization problem given by\nmax uk T\u2211 t=1 \u2212\u03bbik(t)(t)uk(t)\u2212 \u03baDik(t)ik(t+1)\ns.t. 0 \u2264 Luk \u2264 sk1, \u2212 uk(sk)\u2206Sk \u2264 uk \u2264 uk(sk)\u2206Sk\n(17)\nfor a specific path ik has a unique solution. Then the optimal operation uk for storage k moving along path ik (defined in the kth column of matrices E(t)) in a solution of the MPED-S problem (6) is the same as the solution of the price arbitrage problem (17).\nProof: From Lemma 2, we know that the optimal solution of (13) coincides with the optimal solution of the MPED-S problem (6). (17) differs from (13) in having an additional term corresponding to travel cost. However, this term is independent of the optimization variable uk, and does not affect the optimal solution.\nThe combined optimization has a mix of continuous (uk) and discrete (ik) variables, which makes it hard to solve. We now develop an algorithm that uses a discretization of the state of charge sk(t) to optimize uk, ik in polynomial time where uk(t) = sk(t)\u2212 sk(t\u2212 1).\n12\n2) Algorithm introduction and discretization set up: A discretization parameter h is used to discretize the SoC space sk(t) \u2208 [0, s\u0304], such that s\u0302k(t) is an integral multiple of h, with s\u0304 = zh and z \u2208 N. The allowable states-of-charge (SoC) are now s\u0302k(t) \u2208 {0, h, ..., zh}. At each time t, the kth mobile storage is located at a node ik(t) and has an SoC s\u0302k(t).\nWe can couple ik(t), s\u0302k(t) to create [(z+1)K] nodes, each of which has an SoC and location tuple associated with it. At any time, the storage is located at one of these [(z + 1)K] nodes. We use the h-floor of the continuous variable s to map it to its discretized version, i.e.,\nbsc = mh, such that mh \u2264 s < (m+ 1)h.\nThe algorithm is able to achieve a value that converges to the true optimum as the discretization density is increased, i.e., as the discretization parameter h is made smaller.\n3) Directed graph description: The value maximization problem can be solved by solving a longest-path problem over T . We construct a time-extended graph G(V, E) where the set of nodes V includes T copies of all the [(z+1)K] nodes corresponding to tuples of power network locations and SoC levels, and z + 1 dummy sink nodes, each corresponding to an SoC level in {0, h, ..., zh}. The set of edges E includes directed edges from every node (i, s\u03021) in the copy corresponding to t to every node (j, s\u03022) in the copy corresponding to t+1 which satisfies (6d), (6e) with u(t) = s\u03022 \u2212 s\u03021, with an edge weight\n\u2212\u03bbi(t)(s\u03022 \u2212 s\u03021)\u2212 \u03baDij ;\nand directed edges from every node (i, s\u0302(T )) in the T -th copy to dummy sink nodes (j, s\u0302) which satisfy (6d), (6e) with u(t) = s\u0302\u2212 s\u0302(T ), with an edge weight\n\u2212\u03bbi(t)(s\u0302\u2212 s\u0302(T )).\nAn example graph is illustrated in Fig. 10, and a few example weights are labeled in the figure.\n4) Algorithm: In order to find the optimal operation and movement schedule, we solve the longest path problem over the directed graph. Starting from t = T , we assign each node a value equal to the maximum value that can be attained when starting from that node, which is the longest path (sum of edge weights). This problem can be solved in polynomial time (O(K2z2T )), but is an approximation of the actual optimal solution since it approximates a continuous variable with discrete steps. However, the difference between the discretizedstate polynomial time solution and the true optimal solution can be reduced to an arbitrarily small number by reducing the discretization parameter h, i.e., increasing z.\n5) Convergence to true optimal solution: We will now state and prove the convergence of our discrete-space solution to the true optimal solution. We use the following result to prove that the discretized algorithm will converge to the true optimum.\nProposition 1: Consider two optimization problems P1, P2\nP1 : J (1) = max s f(bsc) and P2 : J (2) = max s f(bsc)\ns.t. 0 \u2264 s \u2264 s\u0304 s.t. 0 \u2264 bsc \u2264 s\u0304\nthen J (1) = J (2). Proof: The constraint set of P2 is equivalent to 0 \u2264 s < s\u0304+h, which we get by enlarging the constraint set of P1. Let s\u22172 be the optimal argument for P2. Then, either\n1) 0 \u2264 s\u22172 \u2264 s\u0304. In this case, s\u22172 satisfies the constraints of P1 and will be the optimal argument for P1 as well, and J (1) = J (2). 2) s\u0304 < s\u22172 < s\u0304 + h. In this case, J (2) = f(bs\u22172c) = f(s\u0304) \u2265\nf(bsc), for all 0 \u2264 s \u2264 s\u0304. Thus, the optimal argument s\u22171 of P1 will be such that J (1) = f(bs\u22171c) = f(s\u0304) = J (2).\nTo compare the discrete-space solution with the true optimal solution, we adopt the following notation. Let Jt := J(t, s(t), i) be the true maximum value that can be achieved when starting with a mobile battery at time t with SoC s(t) and at location i, i.e., the true optimal solution with a continuous charge/discharge space. Here, Jt is shorthand notation adopted for convenience, and Jt has an underlying dependence on s(t) and i. Similarly, let J\u0302t := J\u0302(t, s(t), i) be the maximum value that can be achieved when the battery operator is only able to make discrete charge/discharge decisions, i.e., choose u\u0302(t) \u2208 {0, h, ..., zh} that also satisfies operational constraints (6d), (6e), where bs(t)c is the discrete SoC. We now analyze the difference between the two solutions at time t = 1, i.e., at the start of the decision horizon.\nTheorem 3: Let J1 denote the maximum value that can be achieved by the mobile storage starting with state of charge s(1) at node i(1), and let J\u03021 denote the maximum value that can be achieved with the same initial conditions but discrete charge/discharge decisions. Then\n|J1 \u2212 J\u03021| \u2264 h [ |\u03bbi(1)(1)|+\nT\u2211 \u03c4=2 max i(\u03c4) |\u03bbi(\u03c4)(\u03c4)|\n] , (18)\nfor each possible s(1) and i(1), and the right hand side converges to 0 as the discretization step size h\u2192 0.\nProof: At each time step, the battery operator can move the battery to a new location j, and charge the battery by any\n13\namount u(t) that satisfies the battery operational constraints (6d), (6e). By definition,\n|s(t)\u2212 bs(t)c| \u2264 h.\nWe prove the statement in (18) using induction. First, note that\nJ(T, s(T ), i(T )) = \u2212\u03bbi(T )(T ) max{\u2212s(t),\u2212u\u0304(s\u0304)}, and J\u0302(T, s(T ), i(T )) = \u2212\u03bbi(T )(T ) max{\u2212bs(t)c,\u2212u\u0304(s\u0304)},\nas the battery operator will choose to maximize the value by discharging at the maximum possible rate at a positive LMP, as it can derive no value from the remaining charge after T . Then we have that\n|JT \u2212 J\u0302T | \u2264 |\u03bbi(T )(T )|h.\nFor time T \u22121, consider a state of charge s(T \u22121). The maximum value that can be attained through continuous battery operation is given by\nJ(T \u2212 1, s(T \u2212 1), i(T \u2212 1)) = max\ni(T ) max s(T )\nJ(T, s(T ), i(T ))\u2212 \u03baDi(T )i(T\u22121)\n\u2212 \u03bbi(T\u22121)(T \u2212 1){s(T )\u2212 s(T \u2212 1)} s.t. u = s(T )\u2212 s(T \u2212 1) satisfies (6d), (6e),\nand the maximum value attainable through discrete battery operation is given by\nJ\u0302(T \u2212 1, s(T \u2212 1), i(T \u2212 1)) = max\ni(T ) max s(T )\nJ\u0302(T, s(T ), i(T ))\u2212 \u03baDi(T )i(T\u22121)\n\u2212 \u03bbi(T\u22121)(T \u2212 1){bs(T )c \u2212 s(T \u2212 1)} s.t. u\u0302 = bs(T )c \u2212 s(T \u2212 1) satisfies (6d), (6e).\nThen define the optimal solutions to the inner optimization problems as\ng(T \u2212 1, s(T \u2212 1), i(T \u2212 1)) = max\ns(T ) J(T, s(T ), i(T ))\u2212 \u03bbi(T\u22121)(T \u2212 1)s(T )\ns.t. u = s(T )\u2212 s(T \u2212 1) satisfies (6d), (6e), and g\u0302(T \u2212 1, s(T \u2212 1), i(T \u2212 1))\n= max s(T )\nJ\u0302T \u2212 \u03bbi(T\u22121)(T \u2212 1)bs(T )c\ns.t. u\u0302 = bs(T )c \u2212 s(T \u2212 1) satisfies (6d), (6e) = max\ns(T ) J\u0302T \u2212 \u03bbi(T\u22121)(T \u2212 1)bs(T )c\ns.t. u = s(T )\u2212 s(T \u2212 1) satisfies (6d), (6e)\nfrom Proposition 1. Then\n|g\u0302T\u22121 \u2212 gT\u22121| \u2264 max\ns(T ) |JT \u2212 J\u0302T \u2212 \u03bbi(T\u22121)(T \u2212 1)(s(T )\u2212 bs(T )c)|\ns.t. u = s(T )\u2212 s(T \u2212 1) satisfies (6d), (6e) \u2264 |\u03bbi(T\u22121)(T \u2212 1)|h+ |\u03bbi(T )(T )|h\nusing the fact that for two functions f(s) and g(s),\n|max s f(s)\u2212max s g(s)| \u2264 max s |f(s)\u2212 g(s)|,\nand the triangle inequality. This leads to\n|JT\u22121 \u2212 J\u0302T\u22121|\n= \u2223\u2223\u2223\u2223maxi(T ) ( gT\u22121 \u2212\u03baDi(T )i(T\u22121) ) \u2212max i(T ) ( g\u0302T\u22121 \u2212\u03baDi(T )i(T\u22121) )\u2223\u2223\u2223\u2223 \u2264 max\ni(T ) |gT\u22121 \u2212 g\u0302T\u22121|\n= |\u03bbi(T\u22121)(T \u2212 1)|h+ max i(T ) |\u03bbi(T )(T )|h\nwhich satisfies our induction statement. Now assuming that the statement holds for a specific t, we will show that it also holds for t\u2212 1. We know from our induction hypothesis that\n|Jt \u2212 J\u0302t| \u2264 h [ |\u03bbi(t)(t)|+\nT\u2211 \u03c4=t+1 max i(\u03c4) |\u03bbi(\u03c4)(\u03c4)| ] Defining Jt\u22121, J\u0302t\u22121, gt\u22121, g\u0302t\u22121 like their analogues for T \u22121, we have\n|g\u0302t\u22121 \u2212 gt\u22121| \u2264h|\u03bbi(t\u22121)(t\u2212 1)|\n+ h [ |\u03bbi(t)(t)|+\nT\u2211 \u03c4=t+1 max i(\u03c4) |\u03bbi(\u03c4)(\u03c4)| ] which gives us\n|Jt\u22121 \u2212 J\u0302t\u22121| \u2264 max i(t) |gt\u22121 \u2212 g\u0302t\u22121|\n= [ |\u03bbi(t\u22121)(t\u2212 1)|h+\nT\u2211 \u03c4=t max i(\u03c4) |\u03bbi(\u03c4)(\u03c4)| ] thus proving our induction hypothesis."
        },
        {
            "heading": "APPENDIX D PROOFS FOR SECTION V",
            "text": "1) Proof for Lemma 2: Consider the Lagrangian of the MPED-S problem, specifically the terms involving uk\nL = f(p) + \u2211 k min uk \u2211 t \u03bbik(t)(t)uk(t) + \u00b5 > k (Luk \u2212 sk)\n\u2212 \u03bd>k Luk + \u03c9>k (\u2212uk \u2212 uk(sk)\u2206Sk) + \u03c6>k (uk \u2212 uk(sk)\u2206Sk).\nThe Lagrangian can be decomposed over uk, and each inner minimization problem over uk is equivalent to the Lagrangian of (13), which proves that their optimal solutions will coincide.\n2) Proof for Theorem 2: From the Lagrangian of the economic dispatch problem in (6), we get that MVmsk (E, s\u0304) = 1>\u00b5k+u\u0304 \u2032 k(s\u0304k)(\u2206 S k) >(\u03c9k+\u03c6k). Further, from the stationarity KKT condition with respect to uk(t), we get\nL>(\u00b5k \u2212 \u03bdk) + \u03c9k \u2212 \u03c6k = \u2212\u03bbik . Under Assumption 2, only one of the dual variables is non-zero at any given time. We can construct a dummy variable zk = \u00b5k\u2212\u03bdk +\u03c9k\u2212\u03c6k and T \u00d7T dimensional diagonal matrices A,B such that Azk = \u00b5k\u2212\u03bdk;Bzk = \u03c9k\u2212\u03c6k. Matrix A has diagonal entries equal to 1 corresponding to times when the capacity constraint is active, and 0 otherwise. Similarly, B has diagonal entries equal to 1 corresponding to times when the power constraint is active, and 0 otherwise, i.e., A+B = I . As\n14\ndefined previously, L is a lower triangular matrix defined as Lij = 1 if i \u2265 j, and 0 otherwise. L> then becomes an upper triangular matrix. The matrix L>A has a 1 at indices (t1, t2) where t1 \u2264 t2 and At2t2 = 1, i.e., if the energy capacity constraint is active at time t = t2. This ensures that L>A has a rank equal to the rank of matrix A, since it has nonzero linearly independent rows for all times when the energy capacity constraint is active. Since B has linearly independent rows for power capacity constrained periods, we can see that L>A+B is full rank with all the diagonal elements being 1, and the elements at (t1, t2) being 1 if t1 \u2264 t2 and At2t2 = 1. Then, we can obtain an expression for zk\nzk = (L >A+B)\u22121(\u2212\u03bbik).\nIt is easy to verify that the structure of matrix (L>A+B)\u22121 is such that the tp-th column (corresponding to a power constrained time) is an elementary vector e>tp , and the te-th column (corresponding to an energy capacity constrained time) is [\u22121, ...,\u22121, 1, 0, ..., 0]> where \u22121 appears te\u22121 times, and the 1 is at the te-th location. We can use this equation to obtain expressions for \u00b5k\u2212\u03bdk,\u03c9k\u2212\u03c6k. Replacing these expressions into the marginal value formulation leads us to the result in Theorem 2."
        }
    ],
    "title": "Mobile Energy Storage in Power Network: Marginal Value and Optimal Operation",
    "year": 2023
}
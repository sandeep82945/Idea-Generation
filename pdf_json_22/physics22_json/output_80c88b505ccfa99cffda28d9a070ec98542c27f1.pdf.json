{
    "abstractText": "The local consistency of the method of Smoothed Particle Hydrodynamics (SPH) is proved for a multidimensional continuous mechanical system in the context of measure theory. The Wasserstein distance of the corresponding measure-valued evolutions is used to show that full convergence is achieved in the joint limit N \u2192 \u221e and h \u2192 0, where N is the total number of particles that discretize the computational domain and h is the smoothing length. Using an initial local discrete measure given by \u03bcN0 = \u2211N b=1m(xb, h)\u03b40,xb(0), where mb = m(xb, h) is the mass of particle with label b at position xb(t) and \u03b40,xb(t) is the xb(t)-centered Dirac delta distribution, full consistency of the SPH method is demonstrated in the above joint limit if the additional limit N \u2192 \u221e is also ensured, where N is the number of neighbors per particle within the compact support of the interpolating kernel.",
    "authors": [
        {
            "affiliations": [],
            "name": "Jos\u00e9 Tadeu Lunardi"
        },
        {
            "affiliations": [],
            "name": "Otto Rend\u00f3n"
        },
        {
            "affiliations": [],
            "name": "Gilberto D. Avenda\u00f1o"
        },
        {
            "affiliations": [],
            "name": "Jaime Klapp"
        },
        {
            "affiliations": [],
            "name": "Leonardo Di G. Sigalotti"
        },
        {
            "affiliations": [],
            "name": "Carlos A. Vargas"
        }
    ],
    "id": "SP:c0e0a119af2fdaf7616270070f80514221e78e00",
    "references": [
        {
            "authors": [
                "Gingold RA",
                "Monaghan JJ. Smoothed particle hydrodynamics"
            ],
            "title": "theory and application to non-spherical stars",
            "venue": "Monthly Not R Astron Soc.",
            "year": 1977
        },
        {
            "authors": [
                "Lucy LB"
            ],
            "title": "A numerical approach to the testing of the fission hypothesis",
            "venue": "Astron J. (1977) 82:1013\u201324",
            "year": 1977
        },
        {
            "authors": [
                "M Sayeb",
                "L Blecha",
                "LZ Kelley",
                "D Gerosa",
                "M Kesden",
                "J. Thomas"
            ],
            "title": "Massive black hole binary inspiral and spin evolution in a cosmological framework",
            "venue": "Monthly Not R Astron Soc",
            "year": 2020
        },
        {
            "authors": [
                "Lind SJ",
                "Stansby PK"
            ],
            "title": "High-order Eulerian incompressible smoothed particle hydrodynamics with transition to Lagrangian free-surface motion",
            "venue": "J Comput Phys. (2016) 326:290\u2013311",
            "year": 2016
        },
        {
            "authors": [
                "R Di Lisio",
                "E Grenier",
                "M. Pulvirenti"
            ],
            "title": "On the regularization of the pressure field in compressible Euler equations",
            "venue": "Annali della Scuola Normale Superiore di Pisa, Classe di Scienze",
            "year": 1997
        },
        {
            "authors": [
                "R Di Lisio",
                "E Grenier",
                "M. Pulvirenti"
            ],
            "title": "The convergence of the SPH method",
            "venue": "Comput Math Appl",
            "year": 1998
        },
        {
            "authors": [
                "Ben Moussa B",
                "Vila JP"
            ],
            "title": "Convergence of SPH method for scalar nonlinear conservation laws",
            "venue": "SIAM J Num Anal",
            "year": 2000
        },
        {
            "authors": [
                "NJ Quinlan",
                "M Basa",
                "M. Lastiwka"
            ],
            "title": "Truncation error in mesh-free particle methods",
            "venue": "Int J Num Methods Eng",
            "year": 2006
        },
        {
            "authors": [
                "GL Vaughan",
                "TR Healy",
                "KR Bryan",
                "AD Sneyd",
                "RM. Gorman"
            ],
            "title": "Completeness, conservation and error in SPH for fluids",
            "venue": "Int J Num Methods Fluids",
            "year": 2008
        },
        {
            "authors": [
                "JI Read",
                "T Hayfield",
                "O. Agertz"
            ],
            "title": "Resolving mixing in smoothed particle hydrodynamics",
            "venue": "Monthly Not R Astron Soc",
            "year": 2010
        },
        {
            "authors": [
                "Fatehi R",
                "Manzari MT"
            ],
            "title": "Error estimation in smoothed particle hydrodynamics and a new scheme for second derivatives",
            "venue": "Comput Math Appl",
            "year": 2011
        },
        {
            "authors": [
                "Q Zhu",
                "L Hernquist",
                "Y. Li"
            ],
            "title": "Numerical Convergence in smoothed particle hydrodynamics",
            "venue": "Astrophys J",
            "year": 2015
        },
        {
            "authors": [
                "JHM Evers",
                "IA Zisis",
                "BJ van der Linden",
                "systems Duong MH. From continuum mechanics to SPH particle",
                "back"
            ],
            "title": "Systematic derivation and convergence",
            "venue": "J Appl Math Mech.",
            "year": 2018
        },
        {
            "authors": [
                "LDG Sigalotti",
                "O Rendon",
                "J Klapp",
                "CA Vargas",
                "F. Cruz"
            ],
            "title": "A new insight into the consistency of the SPH interpolation formula",
            "venue": "Appl Math Comput",
            "year": 2019
        },
        {
            "authors": [
                "Liu MB",
                "Liu GR"
            ],
            "title": "Restoring particle consistency in smoothed particle hydrodynamics",
            "venue": "Appl Num Math",
            "year": 2006
        },
        {
            "authors": [
                "da Silva LP",
                "Marchi CH",
                "ManeguetteM",
                "Foltran AC"
            ],
            "title": "Robust RRE technique for increasing the order of accuracy of SPH numerical solutions",
            "venue": "Math Comput Simul",
            "year": 2022
        },
        {
            "authors": [
                "Monaghan JJ"
            ],
            "title": "Smoothed particle hydrodynamics",
            "venue": "Rep Prog Phys",
            "year": 2005
        },
        {
            "authors": [
                "Price DJ"
            ],
            "title": "Smoothed particle hydrodynamics and magnetohydrodynamics",
            "venue": "J Comput Phys",
            "year": 2012
        },
        {
            "authors": [
                "Landau LD",
                "Lifshitz EM"
            ],
            "title": "Fluid Mechanics. Volume 6 of Course of Theoretical Physics",
            "year": 1987
        },
        {
            "authors": [
                "SJ Lind",
                "BD Rogers",
                "hydrodynamics Stansby PK. Review of smoothed particle"
            ],
            "title": "towards converged Lagrangian flow modelling",
            "venue": "Proc R Soc A Math Phys Eng Sci.",
            "year": 2020
        },
        {
            "authors": [
                "Liu GR",
                "Liu MB. Smoothed Particle Hydrodynamics"
            ],
            "title": "A Meshfree Particle Method",
            "venue": "Singapore: World Scientific",
            "year": 2003
        },
        {
            "authors": [
                "W Dehnen",
                "H. Aly"
            ],
            "title": "Improving convergence in smoothed particle hydrodynamics simulations without pairing instability",
            "venue": "Monthly Not R Astron Soc",
            "year": 2012
        },
        {
            "authors": [
                "Fulk DA",
                "Quinn DW"
            ],
            "title": "An analysis of 1-D smoothed particle hydrodynamics kernels",
            "venue": "J Comput Phys",
            "year": 1996
        },
        {
            "authors": [
                "VM Panaretos",
                "Y. Zemel"
            ],
            "title": "Statistical aspects ofWasserstein",
            "venue": "distances.Annu Rev Stat Appl",
            "year": 2022
        }
    ],
    "sections": [
        {
            "text": "ORIGINAL RESEARCH published: 22 June 2022\ndoi: 10.3389/fams.2022.907604\nFrontiers in Applied Mathematics and Statistics | www.frontiersin.org 1 June 2022 | Volume 8 | Article 907604\nEdited by:\nJos\u00e9 Tadeu Lunardi,\nUniversidade Estadual de Ponta\nGrossa, Brazil\nReviewed by:\nLuciano Pereira Da Silva,\nUniversidade Federal Do Paran\u00e1\n(UFPR), Brazil\nAppanah Rao Appadu,\nNelson Mandela University, South\nAfrica\n*Correspondence:\nOtto Rend\u00f3n\nottorendon@gmail.com\nSpecialty section:\nThis article was submitted to\nStatistical and Computational Physics,\na section of the journal\nFrontiers in Applied Mathematics and\nStatistics\nReceived: 29 March 2022\nAccepted: 23 May 2022 Published: 22 June 2022\nCitation:\nRend\u00f3n O, Avenda\u00f1o GD, Klapp J,\nSigalotti LDG and Vargas CA (2022)\nLocal Consistency of Smoothed Particle Hydrodynamics (SPH) in the\nContext of Measure Theory.\nFront. Appl. Math. Stat. 8:907604.\ndoi: 10.3389/fams.2022.907604\nLocal Consistency of Smoothed Particle Hydrodynamics (SPH) in the Context of Measure Theory Otto Rend\u00f3n 1,2*, Gilberto D. Avenda\u00f1o 2, Jaime Klapp 3, Leonardo Di G. Sigalotti 1 and Carlos A. Vargas 1\n1Departamento de Ciencias B\u00e1sicas, Universidad Aut\u00f3noma Metropolitana - Azcapotzalco, Ciudad de M\u00e9xico, Mexico, 2Centro de F\u00edsica, Instituto Venezolano de Investigaciones Cient\u00edficas, Caracas, Venezuela, 3Departamento de F\u00edsica, Instituto Nacional de Investigaciones Nucleares, Salazar, Mexico\nThe local consistency of the method of Smoothed Particle Hydrodynamics (SPH) is\nproved for a multidimensional continuous mechanical system in the context of measure\ntheory. The Wasserstein distance of the corresponding measure-valued evolutions is\nused to show that full convergence is achieved in the joint limit N \u2192 \u221e and h \u2192 0,\nwhere N is the total number of particles that discretize the computational domain and h is the smoothing length. Using an initial local discrete measure given by \u00b5N0 = \u2211N\nb=1m(xb, h)\u03b40,xb(0), where mb = m(xb, h) is the mass of particle with label b at position xb(t) and \u03b40,xb(t) is the xb(t)-centered Dirac delta distribution, full consistency of the SPH method is demonstrated in the above joint limit if the additional limit N \u2192 \u221e is also\nensured, where N is the number of neighbors per particle within the compact support of\nthe interpolating kernel.\nKeywords: particle method, SPH interpolation, consistency, scaling laws, similarity relation, convergence of the SPH method, measure theory, Wasserstein distance\n1. INTRODUCTION\nIn the late 1970s, the method of Smoothed Particle Hydrodynamics (SPH) was introduced independently by Gingold and Monaghan [1] and Lucy [2] as a tool for the simulation of astrophysical flows. SPH is a Lagrangian method for solving the equations of hydrodynamics, where the continuum is represented by a finite collection of point masses, or particles, which, in addition to mass, carry information of any other properties of the physical system. Since 1993, after being widely used in different applications in astrophysics, the method has found applications in a ever increasing number of areas in science and engineering. As an example, it has been used in such dissimilar problems as the friction dynamics of massive black holes [3] and the Taylor-Green vortex problem [4], just to mention a few. Even though the method is always gaining more practitioners, there still remain important drawbacks related to its poor convergence properties and loss of mathematical consistency. However, in the course of the years a notable amount of work has been devoted to solve the problem of SPH consistency [5\u201314]. In particular, the loss of consistency in standard SPH occurs because of zeroth-order truncation errors that arise when passing from the kernel to the particle approximation [12, 14]. Different sources of particle inconsistency have been previously identified by Liu et al. [15] to be associated with irregular particle distributions, kernel deficiencies at physical boundaries, and variable smoothing lengths. A new source related to the traditionally low number of neighbors\nwithin the kernel support was more recently discovered by Zhu et al. [12]. An alternative methodology that decreases the SPH discretization error to machine precision was introduced by da Silva et al. [16]. The method uses a post-processing technique based on repeated Richardson extrapolation (RRE) to improve the accuracy of the numerically obtained SPH solution. With an almost null cost in CPU time and memory usage, they obtained truncation error magnitudes of the same level of the machine round-off error for both a steady and unsteady heat diffusion model. Such level of error implies that consistency is actually restored to machine precision.\nMeasure theory has provided a powerful mathematical framework to successfully address the convergence of SPH by estimating the distance between a discrete measure and a smoothed measure of the continuum, when the total number of particles approaches infinity [5, 6, 13]. An early attempt to prove the convergence of SPH was reported by Di Lisio et al. [6], who used measures in combination with the Wasserstein distance. In particular, they employed the Wasserstein distance between a discrete measure and a regularized measure adopting a kernel function of extended domain and developed a proof of convergence for the regularized version of Euler\u2019s equations for a polytropic fluid model. Recently, Evers et al. [13] generalized the formalism of Di Lisio et al. and obtained a convergence proof for standard SPH [17]. They provided the order of convergence of SPH for a general class of force fields, including external and internal conservative forces, frictional dissipation, and nonlocal interactions. In this paper, we extend the convergence theorems derived by Evers et al. [13] to interpolation kernel functions of local finite (i.e., compact) support. We demonstrate that it is possible to limit the Wassertein distance between the initial discrete measure, associated with a non-uniform distribution of particles, and a continuous measure, associated with a regularization of a kernel with compact support.\nThe paper is organized as follows. The fundamentals of the SPH method are briefly described in Section 2. The convergence theorems of SPH in the context of measure theory are derived in Section 3. The Wasserstein distance between the discrete and the continuous measures is calculated for a non-uniform particle distribution and the convergence theorems proved by Evers et al. [13] are extended to interpolation kernel functions of compact support. The main conclusions are summarized in Section 4."
        },
        {
            "heading": "2. THE SPH METHOD",
            "text": ""
        },
        {
            "heading": "2.1. Action for a Continuous Setting",
            "text": "In the standard SPH formalism [17], the derivation of the SPH equations of motion for a system of point masses starts from the discrete version of the Lagrangian L(t) for a continuous setting [13, 18], namely\nL(t) : =\n\u222b\ns,t\n[\n1 2 u \u00b7 u\u2212 e ( \u03c1(y, t), y )\n]\n\u03c1(y, t)dny, (1)\nwhere u is the velocity field and \u03c1 is the density, both defined as a function of time, t \u2208 R+ \u2261 [0,\u221e), and position, y \u2208 Rn, where Rn denotes an n-dimensional Eulerian space, while e is\nthe internal energy, defined as a function of density and position. The integration is performed over a volume domain s,t \u2282 R\nn, which may deform during the time evolution of the system. As the integration is carried over space, the Lagrangian is only a function of time.\nThe trajectory of a material particle of the system, initially located at x = 8(x, 0), can be defined by the coordinate transformation y = 8(x, t) so that\nu ( 8(x, t), t ) = d\ndt 8(x, t). (2)\nAccording to this motion mapping, the integral above can be transformed into\nL[8](t) :\n=\n\u222b\ns,0\n[\n1\n2\n\u2223 \u2223 \u2223 \u2223 d\ndt 8(x, t)\n\u2223 \u2223 \u2223 \u2223 2 \u2212 e(\u03c1(8(x, t), t),8(x, t))\n]\n\u03c1(x, 0)dnx,\n(3)\nwhere the coordinate transformation 8(x, t) is such that s,t = 8( s,0), where s,0 denotes the initial domain. In writing Equation (3), it has been assumed that \u03c1(x, t) and \u03c1(x, 0), as defined in the initial domain (s, 0), are related by the same transformation mapping 8(x, t). Invoking mass conservation, this relation reads as follows [19].\n\u03c1(x, 0) = \u03c1(8(x, t), t) \u2223 \u2223J8(x, t) \u2223 \u2223 , (4)\nwhere |J8(x, t)| denotes the determinant of the Jacobian matrix of the coordinate transformation (2) and the integration is performed over the entire initial volume s,0 occupied by the continuous system. The action of the continuous system is given by the integral\nS[8] =\n\u222b T\n0 L[8] (t) dt. (5)\nThe equations of motion in SPH form can be derived by the principle of least action, that is, by minimizing the action (5) [17, 18]. The minimization of the action leads to the EulerLagrange equations, which for the particle discrete version of the Lagrangian, lead to the particle discretization of the equations of hydrodynamics. The smoothing and discretization procedure applied on a smooth function is called SPH function interpolation, or simply particle estimate of the function [14, 20]. The SPH discretization of the governing differential equations is performed in a two-step process. The first step is known as the kernel or smoothing approximation and the second step is the particle or SPH approximation. In what follows we shall provide a brief description of both approximations."
        },
        {
            "heading": "2.2. Kernel Approximation",
            "text": "The smoothing, or kernel approximation, consists of a weighted average of a field A(x) via an interpolation function or kernel W(|x\u2212 x\u2032|, h)\nA\u0303(x) =\n\u222b\nn\nA(x\u2032)W(|x\u2212 x\u2032|, h)dnx\u2032, (6)\nFrontiers in Applied Mathematics and Statistics | www.frontiersin.org 2 June 2022 | Volume 8 | Article 907604\nwhere A\u0303(x) is the kernel estimate of the fieldA(x) and n \u2286 R n is the volume of the integration domain. The parameter h is called the smoothing length and determines the volume of influence of the smoothing function [21]. It is operationally defined as twice the standard deviation of the kernel [22], i.e.,\nh = 2n1/2 [\u222b\nRn (x \u00b7 x)W(|x|, h)dnx\n]1/2\n, (7)\nwhere as before n denotes the dimension of the Euclidean space. The kernel function W must satisfy the following conditions [14, 18, 20, 22, 23]:\n(i) It must be positive definite, symmetric, and depend on the smoothing kernel and the distance between the field point and its neighbors.\n(ii) In the limit h \u2192 0, the kernel must tend to the Dirac delta distribution.\n(iii) The kernel must be doubly continuous and differentiable. Furthermore, for all h it takes its maximum value at the location of the field point (x = 0) andmust be amonotonically decreasing function everywhere. (iv) It must satisfy the normalization condition\n\u222b\nn\nW(|x\u2212 x\u2032|, h)dnx\u2032 = 1.\n(v) In modern applications most kernels have compact support, n,x \u2282 R\nn centered at x, so that only the attributes of neighboring particles contained within the sphere of influence of radius H and volume Vn,x are taken into account in the interpolation procedure. HenceW = 0 if |x\u2212 x\u2032| \u2265 H, where H = kh and k is a constant factor that determines the size of the kernel support."
        },
        {
            "heading": "2.3. Particle Approximation",
            "text": "In the particle approximation the domain is divided into N Lagrangian subdomains, or cells, in much the same way as for traditional grid-based methods. A particle is placed at the center of each cell and the boundaries of the cells are such that the particle masses remain always constant. Using the mean value theorem, the particle estimate of the smoothed field A\u0303(x) defined by Equation (6) at the position xa of particle a is given by the approximation\nAa =\nN(xa ,h) \u2211\nb=1\nAbW(|xa \u2212 xb|, h)1Vb, (8)\nwhere xb (for b = 1 \u00b7 \u00b7 \u00b7N(xa, h)) denotes the positions of neighboring particles within the compact support n,xa \u2282 R\nn of particle a,1Vb is the volume associated to particle b, andN(xa, h) is the average number of particles enclosed by the compact support of the kernel. It is common practice in SPH to replace the volume 1Vb by the ratiomb/\u03c1b, wheremb is the mass of particle b and \u03c1b is its density. For a non-uniform distribution of particles N(xa, h) can be expressed as [14],\nN(xa, h) = Vn,a \u03c1(xa)\nm(xa, h) + O\n( hn+2 ) , (9)\nwhen h \u226a 1. Kernels with a compact support are characterized by two parameters: h and H = kh, where H is the effective radius of the spherical support [14, 22]. Therefore, the dependence of N(xa, h) on kh is evident. The dominant term in Equation (9) is just the quotient between the volume of the compact support, Vn,a, and the volume 1Va of particle a. This ratio defines the total number of neighbors of particle a up to order n + 2 in the smoothing length. For sufficiently small values of h this provides a very good approximation to determine the average number of neighbors per particle.\nIf the positions xb (with b = 1, 2, . . .,N(xa, h)) of all neighbors of particle a are known then we can obtain maximum information on their number and distribution. For example, the distance between pairs of particles, 1(xa, xb), which is a scalar correlation measure of how the particles are distributed within the compact support, is a set ofN(xa, h) [ N(xa, h)\u2212 1 ]\n/2 elements over which we can construct as measures the minimum distance, 1min, the maximum distance, 1max, and the average distance, 1mean, between all countable pairs of neighbors within the compact support of the kernel. The mean distance 1mean between pairs of particles can be defined as\n1mean =\n[\nVn,a\nN(xa, h)\n]1/n\n. (10)\nThe position xb of particle identified by label b can be interpreted as a mapping between a Euclidean space Rn of configurations, where the particles take their possible positions, and a vector label space b \u2208 Rn. The determinant of the Jacobian matrix Jxb (b) of the mapping xb in the context of the SPH interpolation is given by [14].\n\u2223 \u2223Jxb (b) \u2223 \u2223 =\n\u2223 \u2223 \u2223 \u2223 \u2202(x1b, x2b, \u00b7 \u00b7 \u00b7 , xnb)\n\u2202(b1, b2, \u00b7 \u00b7 \u00b7 , bn)\n\u2223 \u2223 \u2223 \u2223 = mb\n\u03c1b 6= 0, (11)\nwhere b = b(xb) is a bijective map that admits the inverse xb = xb(b) and the kernel of the transformation is of zero dimension. Therefore, two particles xa and xb, with labels a 6= b, are two disjoint particles without interstices between them (see Figure 1). If kernel functions of compact support are used to perform the SPH interpolation, Sigalotti et al. [14] demonstrated that partition of unity can be achieved only up to the order O ( hn+2 ) , i.e.,\n1\nVn,a\n\n\nN(xa ,h) \u2211\nb=1\n1Vb\n\n = 1+ O ( hn+2 ) . (12)\nThat is, the ratio of the sum of the volumes of all neighbors over the volume of the kernel support is exactly unity only when h \u2192 0 andN(xa, h) \u2192 \u221e, in which case N \u2192 \u221e also. This can be easily observed from Figure 1, where neighbors located close to the border of the compact support may contribute by excess or defect to the sum of the particle volumes 1Vb."
        },
        {
            "heading": "2.4. Scaling Laws and Resolution of the",
            "text": "SPH Interpolation In most SPH simulations it has been a common practice to fix the resolution by simply choosing the value of h as a factor\nFrontiers in Applied Mathematics and Statistics | www.frontiersin.org 3 June 2022 | Volume 8 | Article 907604\nFIGURE 1 | Schematic drawing illustrating the SPH interpolation in two-space dimensions (n = 2). The circle of radius H = kh defines the compact support of the kernel functionW(|xa \u2212 xb|, h) centered at the position xa of the observation particle a. Although the particles are depicted as point-like masses, their geometrical shape corresponds to an irregular rectangular cell of area mb/\u03c1b. Due to the Lagrangian nature of SPH, the rectangles deform during the evolution. However, they do not overlap and do not have empty interstices between them, which is consistent with the requirement that mb/\u03c1b 6= 0.\nof the interparticle distance. However, Zhu et al. [12] derived scaling relations complying with the resolution limit h \u2192 0 when N \u2192 \u221e. If a kernel of compact support is employed, then full consistency for the SPH interpolation is achieved when the limit N(xa, h) \u2192 \u221e is also satisfied. Only when this joint limit is met the particle approximation, defined by Equation (8), converges locally to the kernel approximation, defined by Equation (6).\nAccording to Equation (9) and for a non-uniform distribution of particles, the limit N(xa, h) \u2192 \u221e is achieved for h \u2192 0 if the mass, m(xa, h), of particles scales with h as h\n\u03b2 with \u03b2 > n [14]. Consequently, a local scaling law is obtained for the number of neighborsN(xa, h) within the compact support n,a of the kernel as\nN(xa, h) \u223c h n\u2212\u03b2 , for \u03b2 > n. (13)\nThis is the same scaling law obtained by Zhu et al. [12] for the case when n = 3. A global scaling law for the total number of particles N is obtained by invoking a relation of similarity between the average particle density in the compact support n,a of the kernel and the particle density in the full computational domain of total volume V :\nN(xa, h)\nVn,a =\nN V . (14)\nSince the volume V of the computational domain does not depend on the parameters of the SPH interpolation, the global scaling law is obtained as follows\nN \u223c h\u2212\u03b2 , for \u03b2 > n, (15)\nwhich complies with the joint limit for full particle consistency."
        },
        {
            "heading": "3. SPH CONVERGENCE THEOREM",
            "text": "A measure-value formulation was used by Evers et al. [13] to prove the convergence of SPH as a special case of a class of approximating measures that is much broader than just a sum of weighting kernel functions. In their case the proof was obtained in the limit when N \u2192 \u221e for kernel functions of extended support. Here we generalize the measure-value formulation implemented by Evers et al. [13] to prove the theorem of SPH convergence for kernel functions of locally finite support n,y \u2282 R\nn, where y is the coordinate in a Eulerian description. The analysis applies equally well to regularly and irregularly distributed particles. For a fixed instant of time t \u2208 [0,T], where T defines the evolution time, the compact support of the kernel will be denoted by y,t . Motion mapping, y = 8(x, t), is invoked (with the initial condition x = 8(x, 0)), in order to transform from Eulerian (y) to Lagrangian (x) coordinates (see Equation 2)."
        },
        {
            "heading": "3.1. SPH Interpolation in the Context of Measure Theory",
            "text": "In the context of measure theory, the mass differential \u03c1(y, t)dny is associated with the measure \u00b5t(d\nny) for a given time t, while at time t = 0 the mass differential \u03c1(x, 0)dnx is associated to the measure \u00b50(d\nnx). Therefore, the kernel approximation for the mass density of the fluid is\n\u03c1\u0303h(y, t) =\n\u222b\ny,t\nW (\u2223 \u2223y\u2212 y\u2032 \u2223 \u2223 , h ) \u00b5t(d ny). (16)\nIn this regularization process the kernel function W(|y \u2212 y\u2032|, h) has compact support y,t and meets the conditions listed in Section 2.2. Note that the regularized density depends on the smoothing length h. If we invoke the motion mapping y = 8(x, t) (or motion push-forward) in the context of measure theory, then the kernel approximation of themass density \u03c1\u0303h(y, t) becomes\n\u03c1\u0303h(8(x, t), t) =\n\u222b\nx,0\n(\u2223\n\u22238(x, t) \u2212 8 ( x\u2032, t )\u2223 \u2223 , h ) \u00b50 ( dnx\u2032 ) . (17)\nEquation (16) for \u03c1\u0303h(y, t) is a functional of \u00b5t(\u2022), while Equation (17) for \u03c1\u0303h(8(x, t), t) is a functional of 8(x, t).\nThe particle approximation is obtained by substituting the measure \u00b50(\u2022) by the discrete measure \u00b5 N 0 (\u2022) so that\n\u00b5N0 =\nN \u2211\nb=1\nmb\u03b4xb ,0, (18)\nwhere the mass mb of particle b scales with h as h \u03b2 , with \u03b2 > n [14]. The discrete measure \u00b5Nt (\u2022) is constructed using the Dirac delta measures \u03b40,xb(t) centered at xb(t), which evolve according to the push-forward motion, xb(t) = 8(xb, t), with xb(0) = xb. Substitution of the initial discrete measure \u00b5 N 0 (\u2022) given by Equation (18) into the Lagrangian L(t) of the continuous system given by Equation (3) and in the regularized density \u03c1\u0303h(8(x, t), t) defined by Equation (17), we obtain the discrete version of the\nFrontiers in Applied Mathematics and Statistics | www.frontiersin.org 4 June 2022 | Volume 8 | Article 907604\nLagrangian for a system of point masses as it applies to the traditional SPH method [17, 22], i.e.,\nL(t) =\nN \u2211\nb=1\nmb\n[\n1\n2\n\u2223 \u2223x\u0307b(t) \u2223 \u2223 2 \u2212 e (\u03c1\u0303h (xb (t) , t) , xb (t))\n]\n, (19)\nwith\n\u03c1\u0303h (xa (t)) =\nN(xa(t),h) \u2211\nb=1\nmbW ( |xa (t) \u2212 xb (t)| , h ) ,\nwhere N is the total number of particles that discretize the computational volume and N(xa(t), h) is the number of neighbors within the compact support of the kernel W(|xa(t) \u2212 xb(t)|, h) centered at the position xa(t) of the observation particle a."
        },
        {
            "heading": "3.2. The Limit \u00b5N0 \u2192 \u00b50 When N \u2192 \u221e",
            "text": "In order to compute the limit of the discrete measure \u00b5N0 when N \u2192 \u221e it is necessary to define eigenobjects in the measure theory, such as the push-forward, the joint representation, and the Wasserstein distance [13].\nDefinition 3.1 (Push-forward). For a map8 :A1 \u2192 A2 between twomeasurable spaces (A1, \u03c31) and (A2, \u03c32) the push-forward for the measure \u00b5 : \u03c31 \u2192 0 \u222a R\n+ is the measure that is constructed by means of the map 8:\n[8#\u00b5] (B) = \u00b5 [ 8\u22121 (B) ]\n\u2200B \u2208 \u03c32,\nor in its integral form\n\u222b\nB f (y) [8#\u00b5]\n( dny ) =\n\u222b\n8\u22121(B) f (8 (x)) \u00b5\n( dnx ) ,\nwhere the map 8 defines the change of coordinates y = 8(x, t).\nThe push-forward definition contains the change of variables in the integration methods, as observed in the change from the Eulerian to the Lagrangian representation through the motion mapping y = 8(x, t) (see Equations 1\u20133, 16, and 17). In particular, the particle approximation can be expressed as\n8SphPA :V \u2282 R n \u2212\u2192\n{ 1Vb , with b = 1, 2, . . . ,N } , (20a)\nwith\n8SphPA(x) = xb if x \u2208 1Vb for some b \u2208 {1, 2, . . . ,N} , (20b)\nwhere 1Vb is the volume of particle b and xb is its position. Then\n\u222b\nV f (x)\n[ 8SphPA#\u00b50 ] ( dnx ) =\n\u222b\nV f ( 8SphPA (x) ) \u00b50 ( dnx ) ,\nwith . . . \u00b5n0 ( dnx )\n= . . . [ 8SphPA#\u00b50 ] ( dnx )\n= \u2211N\nb=1mb\u03b4xb ,0 . . . d nx.\nNote that for all x \u2208 V there always exists b that belongs to the set of labels {1, 2, . . . ,N} such that\n\u2223 \u2223x\u2212 8SphPA(x) \u2223 \u2223 = |x\u2212 xb| < \u03b11mean. (21)\nFor bounded V , there exists \u03b1 \u2208 R+ such that 1sup = \u03b11mean, where1sup is themaximumdistance between all pairs of particles 1(xa, xb) for a, b = 1, 2, . . . ,N. In the present analysis we consider the parameter \u03b1 of the distribution of particles and not of the total number of particles N. This is consistent with the similarity relationship (14).\nThe partition of unity as introduced by Sigalotti et al. [14] can be expressed in the context of measure theory. Let Vn,a be the spherical volume of the compact support n,a of the kernel functionW(|xa \u2212 x\n\u2032|, h), centered at position xa and with smoothing length h, then the partition of unity can be written as\n\u222b\nVn,a dnx\nVn,a =\n\u222b\nVn,a\n[\n1 \u03c10(x)\n]\n\u00b50 ( dnx )\nVn,a = 1, (22)\nwhere the domain of integration is taken over the volume of the kernel support. When passing from the smoothed to the particle approximation, the partition of unity will then take the form [14]:\n\u222b\nVn,a\n[\n1 \u03c10 ( 8SphPA(x) )\n]\n\u00b50 ( dnx )\nVn,a \u2192\n\u2211N(xa ,h) b=1 1Vb\nVn,a = 1\n+O ( hn+2 ) , (23)\nwhere N(xa, h) is the number of neighbors that belong to n,a and 1Vb = mb/\u03c1(xb) is the volume of particle b located at the point xb, with xb \u2208 n,a. In the particle approximation the partition of unity is reproduced only approximately to order O ( hn+2 )\n. In Figure 1, where the kernel support is represented schematically in the plane (n = 2), the partition of unity deviates from one due to those particle volumes that are intersected by the circular compact support.\nDefinition 3.2 (Joint representation). Let two measures be \u00b51 : \u03c3 \u2192 0 \u222a R + and \u00b52 : \u03c3 \u2192 0 \u222a R + of a space of measure (A, \u03c3 ). The joint representation of \u00b51 and \u00b52 is the measure \u03c0 : \u03c3 \u00d7 \u03c3 \u2192 0 \u222a R+ such that\n\u222b\n\u03c3\u00d7\u03c3\nf (xi)\u03c0 ( dx1, dx2 ) =\n\u222b\n\u03c3\nf (x)\u00b5i(dx), i = 1, 2.\nDefinition 3.3 (Wasserstein distance). Let 5(\u00b51,\u00b52) be the set of all joint representations of \u00b51 and \u00b52. The Wasserstein distance between two measures \u00b51 and \u00b52 of a measurable space (A, \u03c3 ) is\nW (\u00b51,\u00b52) : = inf \u03c0\u22085(\u00b51 ,\u00b52)\n\u222b\n\u03c3\u00d7\u03c3 |x\u2212 y|\u03c0(dx, dy).\nFrontiers in Applied Mathematics and Statistics | www.frontiersin.org 5 June 2022 | Volume 8 | Article 907604\nUsing Equation (21), the Wasserstein distance between the discrete measure \u00b5N0 and the continuous measure \u00b50 is\nW ( \u00b5N0 ,\u00b50 ) \u2264\n\u222b\nV\n\u2223 \u2223x\u2212 8SphPA(x) \u2223 \u2223 \u00b50 ( dnx ) <\n\u03b11mean\n\u222b\nV \u00b50\n( dnx )\n< \u03b1V1mean. (24)\nIn the limit N \u2192 \u221e, the result of Evers et al. [13] is obtained from the above inequality provided that the similarity relation (14) holds. Hence\nW ( \u00b5N0 ,\u00b50 ) \u2264\n\u222b\nV\n\u2223 \u2223x\u2212 8SphPA(x) \u2223 \u2223 \u00b50 ( dnx ) < \u03b1\n[\nVn\u22121\nN\n]1/n\n,(25)\nand therefore taking the limit when N \u2192 \u221e gives\nlim N\u2192\u221e\nW ( \u00b5N0 ,\u00b50 ) \u2212\u2192 0. (26)\nFurthermore, if we add the necessary requirement to satisfy the global scaling (15), we immediately find that\nW ( \u00b5N0 ,\u00b50 )\n= W (\n\u00b5h0 ,\u00b50\n)\n< h\u03b2/n with \u03b2 > n, (27)\nso that in the limit when h \u2192 0\nlim h\u21920 W\n(\n\u00b5h0 ,\u00b50\n)\n\u2212\u2192 0. (28)"
        },
        {
            "heading": "3.3. Dynamics of the Regularized Continuous System",
            "text": "According to Evers et al. [13] the Lagrangian L(t) (see Equation 3) is regularized as follows. First, \u03c1(x, 0)dnx is replaced by \u00b5 ( dnx ) and then the density is regularized according to Equation (17) for \u03c1\u0303h ( 8(x, t), t )\n, where now the kernel function W(|8(x, t) \u2212 8(x\u2032, t)|, h) has compact support initially centered at x.\nThe dynamics of the regularized system is obtained by generalizing the principle of least action [13]. The dynamics obtained this way describe the evolution of two fields: the trajectory of the material point 8(x, t) and the measure \u00b5t . The dynamic state is well-defined if the initial position of each material point, namely 8(x, 0) = x, its initial velocity field 8\u03070 = v0(x), and the initial measure \u00b50, which is associated with the geometry of the space where the continuous system evolves, are all known.\nThen the dynamical system to be described is: Given T > 0, we have a V \u2282 Rn and a \u03c3 -algebra, denoted by 6, of the set V with the initial measure \u00b50 over the Measurable Space (V ,6) that satisfies \u00b50 :6 \u2212\u2192 [0,+\u221e) and an initial velocity field v0 \u2208 C\n1 (Rn;Rn). The evolution is then governed by the following set of equations\n\n     \n     \n8\u0308(x, t) = \u2212 \u2202e \u2202\u03c1\u0303\n[ \u03c1\u0303h ( 8(x, t) )] \u2207\u03c1\u0303h ( 8(x, t) ) \u2212 ( \u2207Wh \u2217 [( \u2202e \u2202\u03c1\u0303 \u25e6 \u03c1\u0303h ) \u00b5t ]) ( 8(x, t) )\n\u2212\u2207U ( 8(x, t) ) \u2212 \u03b7 ( 8(x, t)8\u0307(x, t) ) + (K \u2217 \u00b5h) ( 8(x, t) )\n, \u03c1\u0303h : = Wh \u2217 \u00b5t , \u00b5t = 8(x, t) #\u00b50, 8(x, 0) = x ; 8\u0307(x, 0) = v0(x).\n(29)\nFor all x \u2208 V and all t \u2208 (0,T] the notationWh \u2217 \u00b5t emphasizes that the evolution in the regularization is caused by the pushforward 8(x, t) #\u00b50, where U \u2208 C\n2 (Rn;R) is the potential due to external fields. The internal energy e(\u03c1) \u2208 C2 ( R +;R ) is associated only with the thermodynamic properties of the continuum, with e(\u03c1, y) = U(y)+e(\u03c1). The field \u03b7 \u2208 C1 ( R n R + ) describes the viscosity and the field K \u2208 C1 (Rn Rn) represents a non-local internal interaction in the continuous system."
        },
        {
            "heading": "3.4. The Theorem of Existence-Uniqueness and Continuity With Respect to the Initial Conditions",
            "text": "The main theorem of Evers et al. [13] ensures that the regularized dynamical system given by Equation (29), with the initial conditions of 8(x, 0) = x and 8\u0307(x, 0) = v0(x), has a unique solution ( \u00b5t ,8(x, t) )\nfor all x \u2208 V and t \u2208 (0,T], if the initial measure \u00b50 is known. Also the solutions of Equation (29) are continuous with respect to the initial measure. The following theorems hold:\nTheorem 3.1 (Existence-uniqueness). For all t \u2208 (0,T], let h > 0 and the initial conditions8(x, 0) = x and 8\u0307(x, 0) = v0(x) known for the regularized continuous system of Equation (29). Then for each initial measure \u00b50 over the measurable space (V ,6) there is a unique pair solution ( \u00b5t ,8(x, t) )\nto the dynamical system defined by Equation (29).\nTheorem 3.2 (Continuity with respect to \u00b50). For all t \u2208 (0,T], let be h > 0 and the initial conditions 8(x, 0) = x and 8\u0307(0, x) = v0(x) known for the regularized continuous system of Equation (29). Given two initial measures \u00b510 and \u00b520 over the measurable space (V ,6), the supremum of the Wasserstein distance between the two solutions (\n\u00b51t ,8 1(x, t)\n)\nand ( \u00b52t ,8 2(x, t) )\nof the regularized dynamical system given by Equation (29) is bounded by:\nsup t\u2208[0,T]\nW ( \u00b51t ,\u00b5 2 t ) 6 ( 1+ T ( \u2016\u2207v0\u2016\u221e + \u2016\u03b7\u2016\u221e ))\nexp\n(\n\u2016\u03b7\u2016\u221e T + 1\n2 (M4 +M5)T\n2\n)\nW ( \u00b510,\u00b5 2 0 ) ,\nwhereM4 andM5 are both positive and independent of the initial measurements \u00b510 and \u00b5 2 0.\nCorollary 3.1 (Convergence of the particle approximation to the smoothing approximation). For all t \u2208 (0,T], let be h > 0 and the initial conditions be 8(x, 0) = x and 8\u0307(0, x) = v0(x) known for the regularized continuous system of Equation (29). Consider a sequence of initial discrete measures {\n\u00b5N0\n}\nN\u2208N over\nthe measurable space (V ,6) that converge to measure \u00b50 over (V ,6), then\nFrontiers in Applied Mathematics and Statistics | www.frontiersin.org 6 June 2022 | Volume 8 | Article 907604\nW ( \u00b5N0 ,\u00b50 ) N\u2192\u221e \u2212\u2212\u2212\u2212\u2192 0.\nFor each sequence of initial discrete measures, ( \u00b5N0 ,8(x, 0) ) , there is a unique sequence (\n\u00b5Nt ,8 N(x, t)\n)\nsolution of the dynamical system given by Equation (29). Let ( \u00b5t ,8(x, t) )\nbe the solution of the dynamical system of Equation (29) with initial conditions ( \u00b50,8(x, 0) ) . Then \u00b5Nt converges to \u00b5t as\nsup t\u2208[0,T]\nW ( \u00b5Nt ,\u00b5t ) N\u2192\u221e \u2212\u2212\u2212\u2212\u2192 0. (30)\nRemark (On the convergence of the particle approximation to the kernel approximation when h \u2192 0). Corollary 3.1 ensures that in the limit h \u2192 0 the SPH particle approximation, 8SphPA (see Equation 20), converges to the kernel approximation. This is true if the local scaling law (13) and the similarity relation (14) are satisfied [or equivalently, the similarity relation (14) and the global scaling law (15) are both satisfied]."
        },
        {
            "heading": "4. ANALYTICAL PROOF OF CONVERGENCE",
            "text": "Full consistency of the particle approximation is guaranteed only when the joint limit N \u2192 \u221e, h \u2192 0 and N \u2192 \u221e is achieved [12]. Previous studies on the SPH consistency were mostly based on how well the discrete kernel normalization condition is reproduced [12, 14]. For low discrepancy sequences of particles, the standard deviation of the density field approximately varies as N\u22121 when N is larger than about 200 [12]. According to Corollary 3.1, the Wasserstein distance can be used to measure how the particle approximation converges to the continuous kernel approximation. Let us first consider the case of an n-dimensional system of volume V , for which the kernel approximation is implemented using a non-local kernel function (i.e., without compact support). The Wasserstein distance between a discrete measure \u00b5Nt and a continuous measure \u00b5t can be estimated from its upper bound given by Equation (25) as\nW ( \u00b5Nt ,\u00b5t ) \u2248 \u03b1\n[\nVn\u22121\nN\n]1/n\n. (31)\nIf, on the other hand, the kernel approximation is implemented using an interpolation function of compact support, from Equation (27) it follows that\nW\n(\n\u00b5ht ,\u00b5t\n)\n\u2248 h\u03b2/n with \u03b2 > n. (32)\nFrom the triangular inequality, the convergence properties of W (\n\u00b5Nt ,\u00b5t ) , with t \u2208 [0,T], can be studied by assessing that \u00b5Nt is a Cauchy sequence, that is\nW\n(\n\u00b5 N1 t ,\u00b5 N2 t\n) \u2264 W (\n\u00b5 N1 t ,\u00b5t\n) +W (\n\u00b5 N2 t ,\u00b5t\n)\n,\nwhere N2 > N1 \u2192 \u221e. Numerical calculations to assess that \u00b5Nt is a Cauchy sequence under the Wasserstein distance must\nrequire using finite linear programming techniques. However, the numerical calculation of the Wasserstein distance is a rather hard task because the computational complexity scales poorly as N. According to Panaretos and Zemel [24], the best algorithms to compute the optimal solution have the prohibitive complexity N3 logN. Therefore, a proper numerical three-dimensional test showing the SPH convergence in terms of the Wasserstein distance for high values of N and N and sufficiently low values of h will be the subject of a further research paper in this line.\nWhen the SPH interpolation is performed using a kernel function of compact support, the Wasserstein distance between discrete measures, namely \u00b52 k\nt and \u00b5 2k+1 t , for k \u226b 1 is given\nasymptotically by the relation\nWk,k+1 : =\n(\n\u03b1V n\u22121 n\n) (\n2 1 n + 1\n)\n2 k+1 n\n\u2265 W ( \u00b52 k t ,\u00b5 2k+1 t ) , (33)\nwhile the convergence rate for an n-dimensional system is given by\nCnk+1 : = log2\n(\nWk+1,k+2\nWk,k+1\n)\n= \u2212 (1/n) , (34)\nwhere n is the dimension of the Euclidean spaceRn. In particular, Evers et al. [13] have obtained numerically the convergence rate for n = 1 and 2, but using SPH parameters, i.e., low values of N and h, for which consistency cannot be guaranteed.\nFor a kernel function of a compact support, the Wasserstein distance between the two discrete measures \u00b5ht and \u00b5 h+1h t approaches asymptotically the form\nWh,h+1h : = h \u03b2/n +\n( h+ 1h )\u03b2/n \u2265 W (\n\u00b5ht ,\u00b5 h+1h t\n)\n, (35)\nfor \u03b2 > n when 1h \u226a h \u2192 0. Hence, the rate of convergence obeys the relation\nd\ndh Wh,h+1h : = (\u03b2/n) h\n(\u03b2/n)\u22121 {\n1+ ( 1+ 1h/h )(\u03b2/n)\u22121\n}\n,(36)\nwhich embodies a rather slow convergence even when 1h/h << 1 and h \u2192 0."
        },
        {
            "heading": "5. CONCLUSIONS",
            "text": "In this paper the formulation introduced by Evers et al. [13] to prove the convergence of the method of Smoothed Particle Hydrodynamics (SPH) in the Wasserstein distance of the corresponding measure-valued evolutions is extended to kernel functions of locally finite support and irregular particle distributions. The present analysis has demonstrated the convergence and consistency of SPH in the joint limit h \u2192 0 and N \u2192 \u221e. In this limit consistency of the particle approximation solution of the equations of motion of the regularized continuum system is obtained when the number of neighbors within the compact support of the kernel, N, tends simultaneously to infinity, albeit at a rate slower than N so that N/N \u2192 0. It is important to recall that, in contrast to previous proofs of\nFrontiers in Applied Mathematics and Statistics | www.frontiersin.org 7 June 2022 | Volume 8 | Article 907604\nSPH convergence in the framework of measure theory, here the continuous system considered is regularized by means of a kernel function of compact support. The particle approximation of the exact differential equations has been done in compliance with the similarity relation N/V = N/V , where V is the volume enclosed by the kernel support and N is the total number of particles that discretize the computational domain, and the global scaling law N \u223c h\u2212\u03b2 for \u03b2 > n, where h is the smoothing length and n is the dimension of the Euclidean space Rn. Convergence is also achieved if the above global scaling law is replaced by the local scaling N \u223c hn\u2212\u03b2 for \u03b2 > n, as was first derived by Zhu et al. [12] and later on by Sigalotti et al. [14] following different methodologies. Since most modern SPH simulations employ interpolation functions of compact support, the present analysis demonstrate that in the most favorable case when both N \u2192 \u221e and h \u2192 0 simultaneously, then full consistency is achieved only when alsoN \u2192 \u221e.\nDATA AVAILABILITY STATEMENT\nThe original contributions presented in the study are included in the article/supplementary material, further inquiries can be directed to the corresponding author.\nAUTHOR CONTRIBUTIONS\nOR, GA, JK, LS, and CV have contributed intellectually to the form and content of this manuscript. The writing was done by OR and LS. All authors agree with the version submitted for publication, contributed to the article, and approved the submitted version.\nFUNDING\nWe acknowledge funding from the European Union\u2019s Horizon 2020 Programme under the ENERXICO Project, grant agreement No. 828947 and from the Mexican CONACYT-SENER Hidrocarburos Programme under grant agreement B-S-69926."
        },
        {
            "heading": "ACKNOWLEDGMENTS",
            "text": "We acknowledge financial support from the Departamento de Ciencias B\u00e1sicas of the Universidad Aut\u00f3noma Metropolitana - Azcapotzalco through internal funds."
        }
    ],
    "title": "Local Consistency of Smoothed Particle Hydrodynamics (SPH) in the Context of Measure Theory",
    "year": 2022
}
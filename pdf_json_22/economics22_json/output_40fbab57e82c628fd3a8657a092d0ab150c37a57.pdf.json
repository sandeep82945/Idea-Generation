{
    "abstractText": "This paper aims to combine both economic and network user equilibrium for ride-sourcing and ride-pooling services, while endogenously optimizing the pooling sequence of two origin-destination (OD) pairs. With the growing popularity of ride-sourcing and ride-pooling services provided by transportation network companies (TNC), there lacks a theoretical network equilibrium model that accounts for the emerging ride-pooling service, due to the challenge in enumerating all possible combinations of OD pairs pooling and sequencing. This paper proposes a unified network equilibrium framework that integrates three modules, including travelers\u2019 modal choice between e-pooling and e-solo services, e-platforms\u2019 decision on vehicle dispatching and driver-passenger matching, and network congestion. To facilitate the representation of vehicle and passenger OD flows and pooling options, a layered OD graph is created encompassing ride-sourcing and ride-pooling services over origins and destination nodes. Numerical examples are performed on both small and large road networks to demonstrate the efficiency of our model. The proposed equilibrium framework can efficiently assist policymakers and urban planners to evaluate the impact of TNCs on traffic congestion, and also help TNCs with pricing and fleet sizing optimization.",
    "authors": [
        {
            "affiliations": [],
            "name": "Xu Chena"
        },
        {
            "affiliations": [],
            "name": "Xuan Dia"
        }
    ],
    "id": "SP:75b66f3cd342dcb18a36c04719ff6ddd08248c1d",
    "references": [
        {
            "authors": [
                "R.K. Ahuja",
                "T.L. Magnanti",
                "J.B. Orlin"
            ],
            "title": "Network Flows: Theory, Algorithms, and Applications",
            "year": 1993
        },
        {
            "authors": [
                "O. Bahat",
                "S. Bekhor"
            ],
            "title": "Incorporating ridesharing in the static traffic assignment model. Networks and Spatial Economics",
            "venue": "Proceedings of the National Academy of Sciences",
            "year": 2016
        },
        {
            "authors": [
                "S. Banerjee",
                "R. Johari",
                "C. Riquelme"
            ],
            "title": "Dynamic pricing in ridesharing platforms",
            "venue": "congestion. Transportation Research Part B: Methodological",
            "year": 2016
        },
        {
            "authors": [
                "G.P. 77\u2013117. Cachon",
                "K.M. Daniels",
                "R. Lobel"
            ],
            "title": "The Role of Surge Pricing on a Service Platform with Self-Scheduling Capacity",
            "year": 2017
        },
        {
            "authors": [
                "J.C. Castillo",
                "D. Knoepfle",
                "G. Weyl"
            ],
            "title": "Surge pricing solves the wild goose chase",
            "venue": "Service Operations Management",
            "year": 2017
        },
        {
            "authors": [
                "X. Di"
            ],
            "title": "Ridesharing user equilibrium with nodal matching cost and its implications for congestion tolling and platform pricing",
            "year": 2021
        },
        {
            "authors": [
                "X.M. Chen",
                "H. Zheng",
                "J. Ke",
                "H. Yang"
            ],
            "title": "Dynamic optimization strategies for on-demand ride services platform: Surge pricing, commission",
            "year": 2020
        },
        {
            "authors": [
                "R. Cottle",
                "J. Pang",
                "R. Stone"
            ],
            "title": "The linear complementarity problem",
            "venue": "rate, and incentives. Transportation Research Part B: Methodological",
            "year": 2009
        },
        {
            "authors": [
                "X. 50\u201378. Di",
                "H.X. Liu"
            ],
            "title": "Boundedly rational route choice behavior: A review of models and methodologies",
            "venue": "Transportation Research Part B,",
            "year": 2016
        },
        {
            "authors": [
                "X. 142\u2013179. Di",
                "H.X. Liu",
                "X. Ban",
                "H. Yang"
            ],
            "title": "Ridesharing user equilibrium and its implications for high-occupancy toll lane pricing",
            "year": 2017
        },
        {
            "authors": [
                "Research Record",
                "X. 39\u201350. Di",
                "H.X. Liu",
                "X.J. Ban"
            ],
            "title": "Second best toll pricing within the framework of bounded rationality",
            "venue": "Transportation Research Part B,",
            "year": 2016
        },
        {
            "authors": [
                "Research Part B",
                "X. 300\u2014-313. Di",
                "R. Ma",
                "H.X. Liu",
                "X.J. Ban"
            ],
            "title": "A link-node reformulation of ridesharing user equilibrium with network design",
            "venue": "Transportation Research",
            "year": 2018
        },
        {
            "authors": [
                "J.P. Dickerson",
                "K.A. Sankararaman",
                "A. Srinivasan",
                "P. Xu"
            ],
            "title": "Allocation problems in ride-sharing platforms: Online matching with offline",
            "venue": "Part B: Methodological",
            "year": 2018
        },
        {
            "authors": [
                "F. Press. Emma"
            ],
            "title": "Uber hit with cap as new york city takes lead in crackdown",
            "year": 2018
        },
        {
            "authors": [
                "accessed 08.08.2018]. Enzi",
                "Parragh",
                "S.N",
                "Pisinger",
                "Prandtstetter"
            ],
            "title": "Modeling and solving the multimodal car- and ride-sharing problem",
            "venue": "Eur. J. Oper",
            "year": 2021
        },
        {
            "authors": [
                "Res",
                "G.D. 290\u2013303. Erhardt",
                "S. Roy",
                "D. Cooper",
                "B. Sana",
                "M. Chen",
                "J. Castiglione"
            ],
            "title": "Do transportation network companies decrease or increase congestion",
            "year": 2019
        },
        {
            "authors": [
                "M. Ferris"
            ],
            "title": "GAMS/NLPEC solver manual",
            "year": 2009
        },
        {
            "authors": [
                "J. Jacob",
                "R. Roet-Green"
            ],
            "title": "Ride solo or pool: Designing price-service menus for a ride-sharing platform",
            "venue": "European Journal of Operational Research",
            "year": 2021
        },
        {
            "authors": [
                "M. Joshi",
                "N. Cowan",
                "O. Limone",
                "K. McGuinness",
                "R. Rao"
            ],
            "title": "E-hail regulation in global cities",
            "year": 2019
        },
        {
            "authors": [
                "J. Transportation . Ke",
                "H. Yang",
                "X. Li",
                "H. Wang",
                "J. Ye"
            ],
            "title": "2020a. Pricing and equilibrium in on-demand ride-pooling markets",
            "venue": "Transportation Research Part B:",
            "year": 2020
        },
        {
            "authors": [
                "Richland",
                "SC"
            ],
            "title": "A restricted path-based ridesharing user equilibrium",
            "venue": "Journal of Intelligent Transportation Systems",
            "year": 2019
        },
        {
            "authors": [
                "X. 1\u201321. Li",
                "J. Bai"
            ],
            "title": "A ridesharing choice behavioral equilibrium model with users of heterogeneous values of time",
            "venue": "Transportation Research Part B: Methodological 138,",
            "year": 2021
        },
        {
            "authors": [
                "G. 373\u2013405. Lyu",
                "W.C. Cheung",
                "C. Teo",
                "H. Wang"
            ],
            "title": "Multi-objective online ride-matching",
            "venue": "SSRN Electronic Journal",
            "year": 2019
        },
        {
            "authors": [
                "J. Moody",
                "S. Middleton",
                "J. Zhao"
            ],
            "title": "Rider-to-rider discriminatory attitudes and ridesharing behavior. Transportation Research Part F: Traffic",
            "venue": "Part B: Methodological",
            "year": 2019
        },
        {
            "authors": [
                "M. Noruzoliaee",
                "B. Zou"
            ],
            "title": "Variational inequalities: Geometric interpretation, existence and uniqueness",
            "venue": "Psychology and Behaviour",
            "year": 2008
        },
        {
            "authors": [
                "E. Ozkan",
                "A. Ward"
            ],
            "title": "Dynamic matching for real-time ride sharing",
            "venue": "Research Part B: Methodological",
            "year": 2020
        },
        {
            "authors": [
                "Z. Board. Shou",
                "X. Di"
            ],
            "title": "Reward design for driver repositioning using multi-agent reinforcement learning. Transportation Research Part C",
            "year": 2020
        },
        {
            "authors": [
                "A. Simonetto",
                "J. Monteil",
                "C. Gambella"
            ],
            "title": "Transportation Research Part C: Emerging Technologies",
            "venue": "Transportation Research Part C",
            "year": 2019
        },
        {
            "authors": [
                "H. 29.2018]. Wang"
            ],
            "title": "Routing and scheduling for a last-mile transportation system",
            "venue": "Transportation Science",
            "year": 2017
        },
        {
            "authors": [
                "K.I. Wong",
                "S.C. Wong",
                "H. Yang",
                "J.H. Wu"
            ],
            "title": "Modeling urban taxi services with multiple user classes and vehicle",
            "year": 2008
        },
        {
            "authors": [
                "J.S. Pang",
                "F. Ord\u00f3nez",
                "M. Dessouky"
            ],
            "title": "Complementarity models for traffic equilibrium with ridesharing",
            "venue": "Research Part B: Methodological",
            "year": 2015
        },
        {
            "authors": [
                "Y. Yin",
                "J. Ye"
            ],
            "title": "On the supply curve of ride-hailing systems",
            "venue": "Part B,",
            "year": 2020
        },
        {
            "authors": [
                "C. Shao",
                "H. Wang",
                "J. Ye"
            ],
            "title": "Integrated reward scheme and surge pricing in a ridesourcing market",
            "venue": "Research Part B,",
            "year": 2020
        },
        {
            "authors": [
                "L. 575\u2013587. Zha",
                "Y. Yin",
                "Y. Du"
            ],
            "title": "Surge pricing and labor supply in the ride-sourcing market",
            "venue": "Transportation Research Procedia",
            "year": 2017
        },
        {
            "authors": [
                "L. 58\u201375. Zha",
                "Y. Yin",
                "H. Yang"
            ],
            "title": "Economic analysis of ride-sourcingmarkets",
            "venue": "Transportation Research Part C: Emerging Technologies",
            "year": 2016
        }
    ],
    "sections": [
        {
            "text": "This paper aims to combine both economic and network user equilibrium for ride-sourcing and ride-pooling services, while endogenously optimizing the pooling sequence of two origin-destination (OD) pairs. With the growing popularity of ride-sourcing and ride-pooling services provided by transportation network companies (TNC), there lacks a theoretical network equilibrium model that accounts for the emerging ride-pooling service, due to the challenge in enumerating all possible combinations of OD pairs pooling and sequencing. This paper proposes a unified network equilibrium framework that integrates three modules, including travelers\u2019 modal choice between e-pooling and e-solo services, e-platforms\u2019 decision on vehicle dispatching and driver-passenger matching, and network congestion. To facilitate the representation of vehicle and passenger OD flows and pooling options, a layered OD graph is created encompassing ride-sourcing and ride-pooling services over origins and destination nodes. Numerical examples are performed on both small and large road networks to demonstrate the efficiency of our model. The proposed equilibrium framework can efficiently assist policymakers and urban planners to evaluate the impact of TNCs on traffic congestion, and also help TNCs with pricing and fleet sizing optimization. Keywords: Ride-pooling, Network equilibrium, TNC platform operation, Customer choice"
        },
        {
            "heading": "1. Introduction",
            "text": "E-hail or ride-sourcing service provided by transportation network companies (TNC) has gained growing popularity in recent years (National Academies of Sciences et al., 2016). However, the emergence of TNCs likely increases vehicle deadhead miles traveled (Erhardt et al., 2019), which thus catalyzes public agencies to consider enforcing policies and regulation to TNCs for congestion mitigation (Joshi et al., 2019). To counteract the adversarial effect of offering single rides, TNCs begin offering shared rides, called \u201cfor-profit pooling\" or \u201cridesplitting\" (UberPool and LyftLine for instance), which allegedly reduces the total number of vehicles on public roads and thus relieve traffic congestion. However, pooling service only accounts for 20% of total trips (Uber). Such a smaller than expected market could likely hinder the benefits of congestion mitigation claimed by TNC companies. Thus, we need to investigate the relationship among TNC service, customers\u2019 mode choices, and traffic efficiency. However, there lacks a theoretical network equilibrium model that accounts for the emerging pooling service so as to assess its long-term impact on network wide congestion and help promote such service. This paper aims to develop a generic equilibrium model that integrates economic equilibrium into the framework of traffic assignment problem (TAP) and lay a theoretical ground for regulation of TNCs.\nThe for-profit pooling service has been controversial since its inception. On one hand, it could reduce the number of vehicles needed to serve demands; on the other hand, inefficient matching between drivers and riders and improper operation of detouring could lengthen passengers\u2019 waiting time and worsen social welfare. It is thus crucial to quantify the impact of the for-profit pooling service on transportation system performance, so that pricing or regulation policies\n\u2217Corresponding author, Tel.: +1-212-853-0435. Email address: sharon.di@columbia.edu (Xuan Di )\nar X\niv :2\n20 3.\n04 86\n5v 2\n[ ee\nss .S\nY ]\n1 1\nM ar\n2 02\n3\ncan be selected to not only profit TNC service providers, but also benefit the society as a whole. This paper is mainly focused on the long-term planning that inspects how interventions impact service operations in terms of supply and demand, as well as road congestion."
        },
        {
            "heading": "1.1. Literature Review",
            "text": "The ridesourcing services face a bilateral market where its supply and demand need to be matched under a certain market clearance mechanism. Depending on how such a supply-demand imbalance is modeled, the existing literature bifurcates into two steams: the first stream of research is focused on the economic analysis of the shared mobility market, while the second is on the spatial network equilibrium of various shared mobility modes.\nThe first school of studies analyze the relation between supply and demand in order to understand how surge pricing (Castillo et al., 2017; Ke et al., 2020a) or commission (Shou et al., 2020; Shou and Di, 2020) can be used as a lever to balance supply and demand. There are a large body of studies on modeling supply-demand equilibria (Yang and Wong, 1998; Banerjee et al., 2016; Xu et al., 2020; Ke et al., 2020a). These studies, however, assume that the experienced travel time of vehicles remains constant and thus the spatial imbalance is omitted. With a growing number of ridesourcing service vehicles brought to public roads, their presence could influence traffic congestion and thus cannot be ignored in network equilibriummodeling. Plus, vehicles\u2019 routing behavior in congested networks would impact travel time and waiting time of passengers and thus should be accounted for.\nThe above concerns lead to the second school of studies that integrate newmobility modes into the TAP framework, in which not only the matching between drivers and passengers in a two-sided market is modeled, so is the movement of vehicles on congested networks. In other words, drivers and passengers not only face an imbalance in sizes, but also an imbalance in space. When drivers and passengers are distributed in a spatial network with imbalanced magnitudes, it is not only the economic imbalance of supply and demand that influences the market equilibrium. The spatial imbalance could also impact travel times and thus passengers\u2019 waiting time, resulting in different modal choice distributions, market economic equilibria, and network user equilibria.\nAlong this line of research, a group of pioneers integrated modal choice and taxi movements in congested road networks (Wong et al., 2001, 2008; Yang et al., 2010, 2014). Bearing the same characteristics of two-sided markets for both traditional taxi and TNC services, the network equilibrium models initially developed for traditional taxi markets have gained increasing attentions in ride-sourcing markets (Chen et al., 2020; Ke et al., 2020b) on congested road networks. Recent studies (Ban et al., 2019; Di and Ban, 2019) incorporated e-hailing taxis and TNC services into TAP and developed a generalized Nash game leveraging the market economic clearance mechanism. These studies have opened up the field of modeling the interactions among multiple traffic entities into one game-theoretic framework. However, the e-pooling service is not in the picture. In other words, these studies are primarily focused on one-to-one driver-passenger matching, without considering the pooling service provided by TNCs.\nThe existing literature on ridesouring services is primarily focused on order dispatch in on-demand platforms (Wang and Yang, 2019). Some literature investigates the single-ride service, in other words, one passenger is matched to one driver (Wang, 2017; Dickerson et al., 2018; Ozkan and Ward, 2020; Bertsimas et al., 2019; Lyu et al., 2019). There are many studies focusing on multi-rider trips where passengers can split a ride (i.e., ride-splitting services) in ride-sourcing systems (Alonso-Mora et al., 2017; Moody et al., 2019; Simonetto et al., 2019; Fielbaum et al., 2021; Jacob and Roet-Green, 2021). We acknowledge that the dynamic nature of on-demand services renders dynamic operations, but it is still important to perform equilibrium analysis that assists city planners and policymakers in understanding and assessing the systematic impact of emerging shared mobility.\nTable 1 summarizes the related work that employs the equilibria framework for various ridesharing services and indicates where this paper is positioned. The related work is categorized into three branches based on the equilibrium concepts: the economic equilibrium, the network user equilibrium, and the fusion of these two equilibria. The majority of literature regarding economic market equilibrium focuses on pricing of ride-sourcing services from supply and demand curves (Zha et al., 2016, 2017, 2018; Cachon et al., 2017; Castillo et al., 2017; Yan et al., 2019; Chen et al., 2020; Ke et al., 2020a; Zhou et al., 2021; Yang et al., 2020; Xu et al., 2020). However, these studies normally do not account for traffic flows on real road networks. Recent years have seen a growing number of studies on network equilibria for ride-sharing markets (Xu et al., 2015; Bahat and Bekhor, 2016; Di et al., 2017, 2018; Di and Ban, 2019; Ban et al., 2019; Li et al., 2019, 2020; Chen and Di, 2021; Li and Bai, 2021), which account for travelers\u2019 mode and route choice as well as user equilibria. These studies, however, do not include ride-splitting and are primarily focused\non self-organized carpooling or peer-to-peer organized ridesharing (Chen and Di, 2021). There exist a few studies that model ride-splitting with network equilibria. Noruzoliaee and Zou (2022) proposes a section-based formulation of user equilibrium for ride-splitting services, but it predetermines the sequence of travelers\u2019 origins and destinations. This paper aims to combine both economic and network user equilibrium for ride-sourcing and ride-splitting services, while endogenously optimizing the OD pooling sequence.\nNote. Subsequently, for the sake of simplicity, we call the single rides provided by TNC companies as e-solo and the shared rides as e-pooling. TNCs are simplified as e-platforms."
        },
        {
            "heading": "1.2. Contributions of this paper",
            "text": "The goal of this paper is to understand how two types of e-hailing vehicles interact with one another on a congested traffic network and how traffic congestion influences passengers\u2019 mode choices, as well as the platform\u2019s pickup plan. Accordingly, we need to consider a large number of TNC vehicles moving on a network simultaneously, whose actions would collectively influence the network traffic pattern, customers\u2019 mode choices, and the platform\u2019s matching decision, and vehicles\u2019 OD sequencing. Building on such a framework, we would like to evaluate the impact of e-platforms\u2019 operational strategies (including vehicle dispatching, order matching, pricing, fleet sizing) on system performances (including deadhead miles traveled, total system travel time).\nThis paper can be regarded as a significant extension of Ban et al. (2019); Di and Ban (2019) that only model the single ride service provided by TNCs. A major difference of this paper from our previous papers (Di et al., 2017, 2018; Li et al., 2019; Chen and Di, 2021) is that here we include the e-pooling service, which requires to explicitly pair ODs and match two orders and thus, exhibits distinction from ad hoc ridesharing.\nBefore delving into our contributions, we would like to first explain the computational complexity involving ridepooling vehicle flows. In an e-haling system, the sequence of pick-ups and drop-offs of two ODs is a permutation problem, which is, P 22 = 4 possible cases. When there areN pairs, the total possible permutation isN(N\u22121)\u00d7P 22 witha time complexity of O(N2). Direct brute force is practically infeasible, especially asN grows, not mentioning when 3 or more rides can be shared in one trip. We believe that a quite different and innovative framework is warranted to accommodate the e-pooling service. The core contribution of this paper is the characterization of pooled trips without explicit enumeration of order pooling and sequencing.\nIn a nutshell, the contributions of the paper include: 1. Rather than formulating vehicle dispatching and vehicle-passenger matching as combinatorial problems, we\nestablish an equivalence of these two problems to two sequential network flow problems over properly defined OD graphs, in order to avoid enumeration of matching and routing plans for TNC vehicles in pooling service;\n2. The topology and structure of a layered OD graph is designed over which vehicle dispatching and vehiclepassenger matching can be simplified as link-node based minimum-cost flow problems;\n3. Extensive numerical examples in small and large road networks are performed to illustrate the efficiency of our model, and offer insights into e-platform operation, planning and policymaking.\nThe remainder of the paper is organized as follows. Section 2 presents the problem statement and lays out three modules: e-platform optimization, customer mode choice, and network congestion. Section 3 proposes the structure of the layered OD graph that will be used to efficiently solve combination and sequencing of vehicle and passenger flows. Section 4-6 detail each module. Section 7 discusses solution properties. In Section 8, numerical examples are presented to demonstrate the developed model on a simple 3-node network and on the Sioux Falls network. Section 9 concludes this study."
        },
        {
            "heading": "2. Problem statement",
            "text": ""
        },
        {
            "heading": "2.1. Game-theoretic scheme for the e-hailing system",
            "text": "An e-hailing system consists of multiple agents, including customers, e-hailing platforms, and traffic entities on roads. Customers select e-solo or e-pooling tomove fromA toB. E-haling platformsmatch idle vehicles and customers, once orders are placed. For an e-solo order, one vehicle is matched to one passenger; while for an e-pooling order, one vehicle is matched to two passengers. Traffic entities are comprised of passengers and vehicles in e-solo and epooling modes. For vehicles, they can be vacant or occupied, of which the occupancy ratio of passengers can be one or two, depending on whether a vehicle serves an e-solo or e-pooling order, and if e-pooling, whether it carries one or already pools two passengers. Each agent has its objective (or disutility or payoff) function, strategy, and constraints. At equilibrium,\n1. an e-platform cannot improve its net profit by unilaterally switching its vehicle dispatching nor vehicle-passenger matching plans;\n2. the e-hailing fleet size is no less than the order requests. In other words, supply and demand reaches an equilibrium;\n3. no traveler can reduce her generalized travel disutility by unilaterally switching her travel mode choice; 4. no vehicle can reduce its travel time by unilaterally switching its route choice. An equilibrium state is achieved during a long term planning horizon. That being said, we are not interested in a transient period with the dynamic operation of TNCs. Instead, we are focused on a stead state when customer order arrival rates, platform operational strategies, and traffic congestion remain stationary. Moreover, the supply would fulfill the demand at the equilibrium. In other words, the vehicle number is no less than the order number.\nWe make the following modeling assumptions: (A1) One idle vehicle can pick up passengers from at maximum two different origin-destination (OD) pairs in a single trip. In other words, a maximum of two groups of riders are allowed to pool. (A2) One idle driver can only carry one group of passengers from the same OD pair. Remark. (A1) This assumption is made for both practical and computational reasons. First, according to empirical\nevidence (Uber), pooling service only accounts for 20% of total trips, not mentioning pooling three or more rides. The challenge of matching rides persists in the real-world, given that the probability of more than two incoming order requests within the same time window with spatial proximity could be small. Moreover, pooling more than two rides usually refers to as on-demand shuttle service, rather than ride-sourcing. Second, From the computational perspective, pooling more than two rides involves solving a more complex problem over a higher-dimensional OD graphs. Thus, it is left for future research.\n(A2) This assumption is proposed not to simplify the model, rather to make it less trivial to model. Allowing riders from the same OD to share rides is the central focus of a series of work in ridesharing user equilibrium (RUE) cited in Table 1. Since RUE has been extensively studied, we impose such an assumption to avoid repeating similar modeling."
        },
        {
            "heading": "2.2. Three modules: Coupling among e-platform operation, customer choice, and network congestion",
            "text": "This paper develops a methodological framework encompassing three methodological modules, which are (1) ehailing platform operation including vehicle dispatching and passenger-vehicle matching, (2) network congestion, and (3) customer choice. Fig. 1 demonstrates the linkage and logical order among these three modules.\nM1. E-hailing platform operation\nVehicle dispatching\nVehicle-passenger matching M3. Customer choice\nM2. Network congestion"
        },
        {
            "heading": "2.3. Notations",
            "text": "Remark. We will explain our naming conventions here. 1. Letters w, k: represent OD pairs, and the bar or underline of w, k to represent its origin or destination node. 2. Letters u, v: denote generic nodes in an OD graph, can be origin or destination nodes. 3. Sub- or superscripts m: represent travel modes associated with nodes.\n\u2022 Vehicle flow on edge z[m]uv \u225c zu[m]v[m] : if both nodes of an edge contain a subscript of mode, we move themode to the superscript. \u2022 Vehicle flow on virtual edge zuu[m] : if only one node contains a subscript of mode, we leave the mode asthe subscript of the node index. \u2022 Vehicle flow on rebalancing edge zuv \u225c zuv: we place the origin as the subscript and the destination as thesuperscript."
        },
        {
            "heading": "2.4. Overview of the unified model",
            "text": "Before delving into the mathematical details of each module, we first provide an overview of the unified model. Fig. 2, a mathematical expansion of Fig. 1, depicts all the modules and their relations, as well as variables exchange across modules. The layout of three modules enclosed by solid boxes and their connection by directed arrows follow the same pattern as in Fig. 1. The variables on each arrow represent variable exchange between two modules. The top variables in red are travel demand or traffic flow variables, and the bottom ones in green are auxiliary multiples. Within each module, we only highlight the constraints that contain variables linked to those from other modules, and leave the rest denoted by Equation indices for simplicity. Let us now introduce the flow within three modules. Given travel time and cost, (M3. Customer choice) outputs travel demands across available travel modes. Once receiving passengers orders, the e-hailing platform dispatches idle vehicles from destination nodes (based on (M1.1. Vehicle Dispatch)) to pick up orders and determines the sequence of e-pooling order pick-up. (M1.1) outputs vehicle flows, depicting which origin nodes the idle vehicles move to, what OD pairs are pooled, and in what sequence. The vehicle\nflows, along with passenger orders from (M3), are fed into (M1.2. Vehicle-Passenger Matching) to solve passenger flows by vehicle-passenger matching. (M1.1. Vehicle dispatch) generates traffic congestion on a road network. The vehicle flows from (M1.1) are sources of vehicle demands to the traffic assignment problem in (M2) and update flowdependent travel time on each road segment, which are fed back to (M3. Customer Choice). Meanwhile, the way vehicles are dispatched in (M1.1. Vehicle dispatch) influences passengers\u2019 waiting time, which is also fed back to (M3. Customer Choice) for customers to account for additional waiting cost while making mode choices."
        },
        {
            "heading": "3. Origin-destination (OD) graphs",
            "text": "In this section, we will introduce an important tool developed in this paper, namely, origin-destination (OD) graphs, which is the building block for solving passenger and vehicle pooling flows. The description of traffic entities on roads including passenger flows and vehicle flows are detailed in Appendix A.2. We introduce notations in a road network: The road network is denoted by a directed graph (net) = {\n(net),(net) } where(net) is the node set and (net) is thelink set. Origin and destination sets are denoted by O and D, respectively. We have O,D \u2282(net).We now demonstrate how to construct layered OD graphs according to origins and destinations on a road network."
        },
        {
            "heading": "3.1. Layered OD graphs",
            "text": "To model the complex vehicle and passenger flows and simplify enumerating permutations for e-pooling vehicle flows, we develop a layered OD graph, demonstrated in Fig. 3. Before introducing vehicle and passenger flows in the OD graph, we first look into augmented OD pairs generated from the original node sets in the road network."
        },
        {
            "heading": "3.1.1. Augmented OD pairs",
            "text": "An OD graph, denoted as  = { ,}, is constructed by origin and destination node sets O and D. Todistinguish nodes in an OD graph from those on the road network, in the OD graph, we use +(m) and \u2212(m) to denote the origin and destination sets regarding travel mode m, respectively. With this mapping, we then have +(m) = O,\u2212(m) = D. We further denote the virtual origin and destination node sets by + and \u2212,respectively. Summarizing the above notations, in a layered OD graph, we have = +(m)\u22c3\u2212(m)\u22c3+\u22c3\u2212 and  \u2282 \u00d7 .\nLet  denote a node pair set for e-hailing orders. To simplify notations, define the origin node of OD pair w by adding a bar over the letter, denoted as w\u0304, and the destination node of OD pair w by adding an underline below the letter, denoted as w. Accordingly, we can write OD pair w as a pair of nodes composed of its origin w\u0304 \u2208 +(m)\nand destination w \u2208 \u2212(m), denoted as (w\u0304, w),\u2200w \u2208  . The total number of orders or the aggregate OD demand between OD pair w is qw > 0. We summarize all the possible OD pairs needed in an e-hailing system in Tab. 3.\nRemark. \u2022 One edge in the OD graph e = (u, v) \u2208 ,\u2200u, v \u2208  represents a path connecting two nodes (either origin or destination) on a road network, which links a sequence of nodes on a road network.\n\u2022 We have +(m) = {w\u0304[m],\u2200w \u2208 }, \u2212(m) = {w[m],\u2200w \u2208 },\u2200m \u2208 {e, p}. + = {w\u0304,\u2200w \u2208 } and \u2212 = {w,\u2200w \u2208 }.\nThe OD graph consists of four layers described below in the order from top to bottom, namely, e-solo passenger flow, e-solo vehicle flow, e-pooling vehicle flow, and e-pooling passenger flow. An e-hailing platform solves optimal vehicle flow dispatching based on two vehicle flow layers, namely, solo and pooling vehicle flows; while driver-order matching is solved on two passenger flow layers, namely, solo and pooling passenger flows. Passenger orders requesting solo q[e]w or pooling q[p]w ,\u2200w \u2208  service induce vehicle movement and cause traffic congestion. Thus, the couplingbetween one vehicle flow layer and its corresponding passenger flow layer is reflected in demand-supply constraints. For solo passenger orders, the demand-supply constraint is quite straightforward, which is the vehicle flow on one OD path needs to be no less than the passenger flow on that path. However, for pooling passenger orders, the demandsupply constraint is not straightforward to formulate, which requires to solve passenger-vehicle matching to be detailed in Sec. 4.2. The algorithm to generate a layered OD graph is summarized in Algorithm 1.\nAlgorithm 1 Layered OD graph generation Require: The node pair set for e-hailing orders  . Each w \u2208  represents an OD pair in the road network. 1: Step 1. Generate the vehicle flow subgraph for e-pooling service.\nNodes: Origins w\u0304[p] and destinations w[p],\u2200w \u2208  . Edges: Origins are fully connected by edges (w\u0304[p], k\u0304[p]),\u2200w, k \u2208  , w \u2260 k.Destinations are fully connected by edges (w[p], k[p]),\u2200w, k \u2208  , w \u2260 k.Origins and destinations are connected by edges (w\u0304[p], k[p]),\u2200w, k \u2208  .\n2: Step 2. Generate the vehicle flow subgraph for e-solo service. Nodes: Origins w\u0304[e] and destinations w[e],\u2200w \u2208  .Edges: Origins and destinations are connected by edges (w\u0304[e], w[e]),\u2200w \u2208  . 3: Step 3. Link the e-pooling and e-solo vehicle flow subgraphs. Nodes: Virtual origins w\u0304 and virtual destinations w,\u2200w \u2208  . Origins w\u0304[m] and destinations w[m],\u2200w \u2208  , m \u2208 {e, p}.Edges: Virtual origins and origins are connected by edges (w\u0304, w\u0304[m]),\u2200w \u2208  , m \u2208 {e, p}.Destinations and virtual destinations are connected by edges (w[m], w),\u2200w \u2208  , m \u2208 {e, p}. 4: Step 4. Generate the vehicle subgraph for rebalancing.\nNodes: Virtual origins w\u0304 and virtual destinations w,\u2200w \u2208  . Edges: Virtual destinations and virtual origins are connected by edges (w, k\u0304),\u2200w, k \u2208  .\nBased on the layered OD graph generated by Algorithm 1, we then discuss vehicle and passenger flows sequentially."
        },
        {
            "heading": "3.1.2. Vehicle flow on vehicle OD graph",
            "text": "We first describe how e-haling vehicles flow within the OD graph. To ensure that the total number of vehicles is conserved according to Assumption (A3), e-hailing vehicles move within a closed, integrated e-solo and e-pooling vehicle OD graphs, denoted as [e], and [p], respectively. Let us start with vehicles waiting at an arbitrary drop-off node k after dropping off passengers of OD pair k \u2208  . For vehicles that are matched to e-solo orders of OD pair w \u2208  , w \u2260 k, these cars need to first rebalance themselves to the pick-up node w\u0304 and then enter the e-solo vehicle OD graph [e] where they pick up e-solo passengers and move directly to drop-off nodes. For vehicles that are matched to e-pooling orders of OD pairw \u2208  , w \u2260 k, these cars also need to rebalance themselves and then enter the e-pooling vehicle OD graph [p], where these cars need to visit a sequence of two pick-up nodes before moving on to drop-off nodes. After dropping off all passengers, vehicles move on to virtual drop-off nodes and wait to be matched again.\nNote that two vehicle OD graphs [e] and [p] are coupled both at virtual pick-up nodes and virtual drop-off nodes. In other words, two vehicle OD graphs form a closed system and vehicles flow through these two layers without exiting the graph."
        },
        {
            "heading": "3.1.3. Passenger flow on passenger OD graph",
            "text": "First, let us focus on how passengers of an arbitrary OD pair w \u2208  flow within the OD graph. Prior-trip, passengers determine to use e-solo or e-pooling service. Those who select e-solo service enter the e-solo OD graph [e], move directly to the destination node, and then leave the graph. Those who select e-pooling service move to the e-pooling passenger OD graph [p], where one passenger is the first or the second picked up by an e-haling vehicle and then move to drop-off nodes in sequence. After being dropped off, passengers leave the graph. Moreover, two passenger OD graphs [e] and [p] are coupled only at virtual pick-up nodes and left open at drop-off nodes."
        },
        {
            "heading": "3.1.4. Typical vehicle and passenger flows on OD graph",
            "text": "To further demonstrate how vehicles and passengers move over their respective OD graphs, we develop a simplified example on a 3-node network with 2-OD pair in Fig. 4, with only e-pooling demands and vehicles. The original road network, vehicle and passenger OD graphs, and feasible vehicle and passengers paths are indicated. In Fig. 4, we will demonstrate a typical e-pooling vehicle trip and a typical e-pooling passenger\nA typical e-pooling vehicle trip is an enclosed circulation path. It starts from a destination where an empty car first repositions to an origin, after dropping off a past passenger. At the origin, it picks up a passenger and moves to the\nnext origin. After carrying 2 groups of passengers from 2 origins, it moves to their respective destinations in sequence. After dropping off these passengers, it restarts the cycle, namely, repositioning, picking up passenger 1, picking up passenger 2, dropping off them one by one.\nA typical e-pooling passenger (let us call it Passenger 1) can experience a trip of O1 \u2212 D1, O1 \u2212 O2 \u2212 D1, or O1 \u2212 O2 \u2212D2 \u2212D1. The same is applied to Passenger 2 due to symmetry.\n1. O1 \u2212D1: When Passenger 1 is picked up, another passenger from a different origin is already on board. AfterPassenger 1 is picked up, she is the first one to be dropped off. 2. O1 \u2212 O2 \u2212 D1: When Passenger 1 is picked up, another passenger from a different origin is already on board.However, Passenger 1 is dropped off after the other passenger. 3. O1 \u2212 O2 \u2212D2 \u2212D1: Passenger 1 is the first to be picked up and the last to be dropped off.\nIn summary, with vehicle and passenger OD graphs defined, solving vehicle and passenger flows is equivalent to solving network flow problems over correspondingOD graphs. That is why properly definingOD graphs for each entity is crucial. In the next section, we will elaborate on how to model our problems using the network flow formulation. Vehicle and passenger OD graphs will be revisited."
        },
        {
            "heading": "4. Module 1: E-haling platform choice on OD graphs",
            "text": "Assuming that customers select their respective mode choices and place orders, the e-platform needs to first dispatch idle vehicles and then match them to orders. As mentioned before, Module 1 can be essentially transformed into variants of minimum-cost flow problems, when the customer choice is fixed and when travel cost is not flow-dependent. However, constructing Module 1 directly using network flow problems is non-trivial and can be tricky, because of the need for properly represented OD graphs (to be introduced in Secs. 4.1.1,4.2.1), as well as the e-pooling constraints (to be introduced in Secs. 4.1.4,4.2.2). In the next two subsections, we will specify how to compute edge cost and the objective function, as well as how to formulate flow conservation and other constraints. Remark. 1. In principle, e-hailing vehicle dispatching and vehicle-passengermatching are combinatorial problems.\nThe major contribution of this paper is that, these two problems can be reformulated as network flow problems, if isolated from other modules, in other words, when the modal demands and travel cost are given.\n2. To establish such an equivalence, the challenges lie in the construction and representation of a graph that encodes flow conservation for e-pooling vehicle and passenger flows. We need an appropriate graph representation and carefully defined flow conservation constraints.\n3. The overall unified model is not minimum-cost flow model for two reasons: (1) the elastic demand is subject to a customer choice model, and (2) edge cost is congestion-dependent, thus, depends on a network congestion model."
        },
        {
            "heading": "4.1. Module 1.1: Vehicle dispatching",
            "text": "Finding an optimal vehicle dispatching plan is essentially equivalent to solving aminimum-cost circulation network flow problem. Analogously, an e-platform e-hailing vehicles circulate in a network continuously between origins and destinations. When vehicles move from origins to destinations, they are occupied by 1 or 2 passengers. When vehicles move from destinations to origins, which is the rebalancing phase, these vehicles are vacant and need to reposition to match new orders. In summary, e-hailing vehicle dispatching is a minimum-cost circulation network flow problem (MCCNFP) (introduced in Appendix A.5), provided with riders\u2019 requests and travel cost as input.\nModule 1.1 solves the optimal dispatch of idle vehicles (from destination to origin nodes) on the basis of vehicle OD graphs. Subsequently, we will introduce the graph, specify edge cost that leads to an objective function, and describe flow constraints, which ultimately complete the picture of the formulation of MCCNFP."
        },
        {
            "heading": "4.1.1. Vehicle OD graph",
            "text": "Vehicle dispatching is essentially a minimum cost flow circulation problem over a vehicle OD graph, when edge cost is given. To formulate the vehicle dispatching problem as a circulation problem, we need to inspect the coupled e-solo and e-pooling vehicle OD subgraphs altogether, rather than on individual modal subgraph."
        },
        {
            "heading": "4.1.2. Cost specification",
            "text": "Traversing edges incur travel time based cost. Profit is only earned when an order is dropped of at its destination w,\u2200w \u2208  . Thus, cost on those edges that connect a destination node is the negative net profit, which is travel cost minus the fare. Below we define the net cost on each edge in the vehicle OD graph.\nOD edge in e-solo: C [e]w\u0304w = \u2212r[e]w + (in\u2212ve\u210e)tw\u0304w + c[e](se\u2212ve\u210e)w\u0304 ,\u2200w \u2208  , (4.1a) OO edge in e-pooling: C [p]\nw\u0304k\u0304 = (in\u2212ve\u210e)tw\u0304k\u0304 + c [p](se\u2212ve\u210e) w\u0304 ,\u2200w, k \u2208  , w \u2260 k, (4.1b)\nOD edge in e-pooling: C [p]w\u0304k = \u2212r[p]w + (in\u2212ve\u210e)tw\u0304k + c[p](se\u2212ve\u210e)w\u0304 ,\u2200w, k \u2208  , (4.1c) DD edge in e-pooling: C [p]wk = \u2212r[p]w + (in\u2212ve\u210e)twk,\u2200w, k \u2208  , w \u2260 k. (4.1d) Virtual source edge: Cw\u0304w\u0304[p] = 0,\u2200w \u2208  , (4.1e) Virtual sink edge: Cw[p]w = 0,\u2200w \u2208  , (4.1f) Rebalancing edge: Cw\u0304k = (in\u2212ve\u210e)tkw\u0304,\u2200w, k \u2208  , (4.1g)\n(4.1h) where, (in\u2212ve\u210e) is a coefficient converting travel time to the value of time. r[e]w , r[p]w are fares of using e-solo or epooling service for OD pair w, which will be defined subsequently. c[e](se\u2212ve\u210e)w\u0304 , c[p](se\u2212ve\u210e)w\u0304 denote search friction ofdrivers at origins to be detailed in Sec. 6.2.1.\nIn a ride-sourcing market, one widely used assumption about cost-sharing protocols between riders is that, trip fare should be proportional to the actual travel time of a single trip (Wang et al., 2018; Chen et al., 2020). In addition, e-pooling services usually can get a discount (Ke et al., 2020a). Some studies use travel distances between users\u2019 origins and destinations to decide trip fares for each rider (Enzi et al., 2021). Game theory has also been applied to split the cost among travellers: Shapley values, representing riders\u2019 trip fares, can be calculated based on vehicles\u2019 travel distance and riders\u2019 priorities (Levinger et al., 2020). Auction-based prices offered by riders is another tool to split cost in on-demand systems (Bian et al., 2020). In our work, we assume that trip fare is proportional to travel time\nand travel distance and the fare for e-pooling is discounted by a multiplier. Define the base fare for orders of OD pair w \u2208  as Rw, which consists of a fixed fare, time-based and distanced-based rates,\nRw = Fw + 1(tw\u0304w \u2212 t\u0302w\u0304w) \u23df\u23de\u23de\u23de\u23de\u23de\u23de\u23df\u23de\u23de\u23de\u23de\u23de\u23de\u23df\ntime\u2212based\n+ 2lw\u0304w \u23df \u23df\ndistance\u2212based\n, (4.2)\nwhere, 1 and 2 are coefficients of time-based and distance-based fares, respectively. tw\u0304w is the travel time, t\u0302w\u0304w is thefree-flow travel time and lw\u0304w is the distance between node w\u0304 and w. Assume that the fare for e-pooling is discountedby a multiplier, p \u2208 (0, 1). The fares for e-solo and e-pooling are computed as below: r[e]w = Rw, (4.3a) r[p]w = pRw (4.3b)\nRemark. We use disutility or cost instead of profit or utility. So the earnings are regarded as negative cost."
        },
        {
            "heading": "4.1.3. Objective function",
            "text": "The objective function consists of two components: the transport cost for idle vehicle dispatching (computed as the product of travel cost on rebalancing edges and the rebalancing flow), and the total negative net profit earned by an e-hailing platform (computed as the product of a single ride\u2019s negative net profit and the occupied vehicle flow). Mathematically,\nIdle vehicle dispatch: \u2211 w,k\u2208 Cw\u0304k z w\u0304 k , (4.4a)\nPassenger-carrying: \u2211 m\u2208 \u2211 u,v\u2208 (m) C [m]vu z [m] vu , (4.4b)"
        },
        {
            "heading": "4.1.4. Vehicle flow constraints",
            "text": "Fig. 5 illustrates the constraints associated with vehicle flows on a vehicle OD graph. In this figure, we indicate links involved in each constraint with a specific symbol. The symbol type associated with each equation is indicated before each equation. When defining constraints, we will usew as the primary OD pair index, and k as the auxiliary OD pair index. As aforementioned, w\u0304, k\u0304 \u2208 +(m) represent the origin nodes of OD w, k, respectively, and w, k \u2208 \u2212(m) represent the destination nodes, respectively. All the involved edges are marked with the same symbols. To separate in- and out-edge, the in-edge is marked with a shallow symbol, while the out-edge with a solid symbol. Flow conservation at origin from virtual origin edge to pick-up edges for e-pooling. To ensure that e-pooling vehicles visit two origins, the e-pooling vehicle flow entering an origin node, w\u0304 \u2208 +(p), can only be allowed to visit from w\u0304 a second origin, i.e., \u2200k\u0304 \u2260 w\u0304 \u2208 +(p), before they head to a destination node. In other words, vehicles coming from virtual edges need to visit two origin nodes and are not allowed to directly go to drop-off edges.\n(\u2605) zw\u0304w\u0304[p] = \u2211 k\u2208 ,k\u2260w z[p] w\u0304k\u0304 ,\u2200w \u2208  ,\nFlow conservation at origin from pick-up edges to drop-off edges for e-pooling. Let us focus on the e-pooling vehicles that visit the origins of other OD pairs, i.e., \u2200k\u0304 \u2208 +(p), k \u2260 w prior to w\u0304 \u2208 +(p). After these vehicles visit origin node w\u0304, they would need to visit the destinations of other ODs than w, i.e., \u2200k \u2208 \u2212(p), k \u2260 w, as well as the destination w \u2208 \u2212(p), regardless of the visiting sequence of destination nodes.\n(\u25cb) \u2211 k\u2208 ,k\u2260w z[p] k\u0304w\u0304 = \u2211 k\u2208 ,k\u2260w z[p]w\u0304k + z [p] w\u0304w,\u2200w \u2208  ,\nFlow conservation at destination associated with drop-off edges for e-pooling. All the e-pooling vehicle flows originating from origins into the destination of the OD pair w \u2208 \u2212(p) need to visit the corresponding destinations of these OD pairs, i.e., \u2200k \u2208 \u2212(p), k \u2260 w.\n(\u2605) z[p]w\u0304w + \u2211 k\u2208 ,k\u2260w z[p] k\u0304w = \u2211 k\u2208 ,k\u2260w z[p]wk,\u2200w \u2208  ,\nFlow conservation at destination from drop-off edges to virtual edge for e-pooling. All the e-pooling vehicle flows originating from other destinations into the destination of OD pair w[p] \u2208 \u2212(p) end at its associated virtual destination node w \u2208 \u2212. In other words, when the e-pooling vehicle flows already visit one destination before visiting the destination of OD pair w[p] \u2208 \u2212(p), it means that w is the second destination to visit. According to our assumptionA1 that only two OD pairs are allowed to pool, these vehicles should not visit a third destination and thus w is their final destination.\n(\u25ad) \u2211 k\u2260w z[p]kw = zw[p]w,\u2200w \u2208  ,\nDemand conservation at origin or destination for e-pooling.. The total e-pooling vehicle supply originating from the virtual origin of OD pair w\u0304 \u2208 + needs to be no less than the total e-pooling demand for OD pair \u2200w \u2208  . This is the supply demand equilibrium condition described in Sec. 2.1.\n(\u25b3) zw\u0304w\u0304[p] + \u2211 k\u2208 ,k\u2260w z[p] k\u0304w\u0304 \u2a7e q[p]w ,\u2200w \u2208  ,\nThe total e-pooling vehicle supply ending at the destination of the OD pair w \u2208 \u2212(p) needs to be no less than the total e-pooling demand for the OD pair \u2200w \u2208  .\n(\u2b26) zw[p]w + \u2211 k\u2208 ,k\u2260w z[p]wk \u2a7e q [p] w ,\u2200w \u2208  ,\nFlow conservation at origin or destination for e-solo. Demand conservation conditions for e-solo are relatively simple. Over the e-solo layer, at origin \u2200w\u0304[e] \u2208 +(e) of OD pair w \u2208  , the inflow from the virtual origin w\u0304 \u2208 + equalsthe outflow to the associated destination w[e] \u2208 \u2212(e). Similarly, at destination \u2200w[e] \u2208 \u2212(e) of OD pair w \u2208  , the inflow from its associated origin w\u0304[e] \u2208 +(e) equals the outflow to the virtual destination w \u2208 \u2212.\n(\u25b3) zw\u0304w\u0304[e] = z [e] w\u0304w,\u2200w \u2208  ,\n(\u25b3) z[e]w\u0304w = zw[e]w,\u2200w \u2208  ,\nDemand conservation at origin for e-solo. Over the e-solo layer, the inflow into the origin node \u2200w\u0304[e] \u2208 +(e) ofOD pair w \u2208  needs to be no less than the total e-solo demand for OD pair w \u2208  . (\u25b3) zw\u0304w\u0304[e] \u2a7e q [e] w ,\u2200w \u2208  ,\nDemand conservation at virtual origin or destination. At the virtual origin node \u2200w\u0304 \u2208  of OD pair w \u2208  , the inflow from all the destination nodes (for rebalancing) needs to be equal to the outflows to the corresponding origins across all travel modes. In other words, all the unoccupied vehicles that are rebalanced to origin w\u0304 \u2208  of OD pair w \u2208  need to pick up passengers of the same OD pair who select various travel modes.\n(+) \u2211 k\u2208 zw\u0304k = \u2211 m\u2208 zw\u0304w\u0304[m] ,\u2200w \u2208  ,\nSimilarly, at a virtual destination nodew \u2208  , the inflow from its associated destination node across travel modes needs to be equal to the outflows to all virtual origins.\n(+) \u2211\nm\u2208 zw[m]w =\n\u2211\nk\u2208 zk\u0304w,\u2200w \u2208  ,\nTotal flow conservation on virtual links. Vehicle flows on virtual origin links flowing into all origin nodes across all travel modes need to be equal to those on virtual destination links flowing out of all destination nodes across all travel modes.\n(+) \u2211\nm\u2208\n\u2211\nw\u2208 zw\u0304w\u0304[m] =\n\u2211\nm\u2208\n\u2211\nw\u2208 zw[m]w,\nFleet Sizing. The total fleet hours, including both rebalancing and occupied fleets, should be no more than a predefined total fleet size.\n\u2211 k,w\u2208 z w\u0304 k tkw\u0304 + \u2211 m\u2208 \u2211 (v,u)\u2208(m) z [m] vu tvu \u2a7d S,"
        },
        {
            "heading": "4.1.5. Nonlinear complementarity formulation",
            "text": "We reformulate vehicle dispatching as a nonlinear complementarity problem (NCP). We introduce \u27c2 as the orthogonal sign representing the inner product of two vectors. Mathematically [M1.1.NCP-VehDispatch] Profit optimization for e-pooling: 0 \u2a7d zw\u0304k \u27c2 C w\u0304 k \u2212 w\u0304 + k + fleet \u2a7e 0,\u2200w \u2208  , (4.5a)\n0 \u2a7d z[p] w\u0304k\u0304 \u27c2 C [p] w\u0304k\u0304 + [p]+w\u0304 \u2212 [p]\u2212 k\u0304 \u2212 [p] k\u0304 \u2212 [p] w\u0304k\u0304 + fleet \u2a7e 0,\u2200w, k \u2208  , k \u2260 w, (4.5b) 0 \u2a7d z[p]\nk\u0304w \u27c2 C [p] k\u0304w + [p]\u2212 k\u0304 \u2212 [p]+w \u2212 [p] k\u0304w + fleet \u2a7e 0,\u2200w, k \u2208  , k \u2260 w, (4.5c)\n0 \u2a7d z[p]w\u0304w \u27c2 C [p] w\u0304w + [p]\u2212 w\u0304 \u2212 [p]+ w \u2212 [p] w\u0304w + fleet \u2a7e 0,\u2200w \u2208  , (4.5d)\n0 \u2a7d z[p]wk \u27c2 C [p] wk + [p]+ w \u2212 [p] wk \u2212 [p]\u2212 k \u2212 [p] w + fleet \u2a7e 0,\u2200w, k \u2208  , k \u2260 w, (4.5e)\n0 \u2a7d zw\u0304w\u0304[p] \u27c2 Cw\u0304w\u0304[p] \u2212 [p]+ w\u0304 \u2212 [p] w\u0304 \u2212 w\u0304 \u2212 \u2a7e 0,\u2200w \u2208  , (4.5f)\n0 \u2a7d zw[p]w \u27c2 Cw[p]w + [p]\u2212 w \u2212 [p] w + w + \u2a7e 0,\u2200w \u2208  , (4.5g)\nProfit optimization for e-solo: 0 \u2a7d z[e]w\u0304w \u27c2 C [e] w\u0304w + [e] w\u0304 \u2212 [e] w \u2212 [e] w\u0304w + fleet \u2a7e 0,\u2200w \u2208  , (4.5h)\n0 \u2a7d zw\u0304w\u0304[e] \u27c2 Cw\u0304w\u0304[e] \u2212 [e] w\u0304 + w\u0304 \u2212 [e] w \u2212 \u2a7e 0,\u2200w \u2208  , (4.5i)\n0 \u2a7d zw[e]w \u27c2 Cw[e]w + [e] w \u2212 w + \u2a7e 0,\u2200w \u2208  , (4.5j)\nFlow conservation at origins for e-pooling: 0 = zw\u0304w\u0304[p] \u2212 \u2211\nk\u2208 ,k\u2260w z[p] w\u0304k\u0304 \u27c2 [p]+w\u0304 free,\u2200w \u2208  , (4.5k)\n0 = \u2211 k\u2208 ,k\u2260w z[p] k\u0304w\u0304 \u2212 \u2211 k\u2208 ,k\u2260w z[p]w\u0304k \u2212 z [p] w\u0304w \u27c2 [p]\u2212 w\u0304 free,\u2200w \u2208  , (4.5l)\nFlow conservation at destination for e-pooling: 0 = z[p]w\u0304w + \u2211\nk\u2208 ,k\u2260w z[p] k\u0304w \u2212 \u2211 k\u2208 ,k\u2260w z[p]wk \u27c2 [p]+ w free,\u2200w \u2208  , (4.5m)\n0 = \u2211 k\u2260w z[p]kw \u2212 zw[p]w \u27c2 [p]\u2212 w free,\u2200w \u2208  , (4.5n)\nDemand conservation at origin/destination for e-pooling: 0 \u2a7d zw\u0304w\u0304[p] + \u2211\nk\u2208 ,k\u2260w z[p] k\u0304w\u0304 \u2212 q[p]w \u27c2 [p] w\u0304 \u2a7e 0,\u2200w \u2208  , (4.5o)\n0 \u2a7d zw[p]w + \u2211 k\u2208 ,k\u2260w z[p]wk \u2212 q [p] w \u27c2 [p] w \u2a7e 0,\u2200w \u2208  , (4.5p)\nFlow conservation at origin/destination for e-solo: 0 = zw\u0304w\u0304[e] \u2212 z [e] w\u0304w \u27c2 [e] w\u0304 free,\u2200w \u2208  , (4.5q)\n0 = z[e]w\u0304w \u2212 zw[e]w \u27c2 [e] w free,\u2200w \u2208  , (4.5r)\nDemand conservation at origin for e-solo: 0 \u2a7d zw\u0304w\u0304[e] \u2212 q [e] w \u27c2 [e] w \u2a7e 0,\u2200w \u2208  , (4.5s)\nDemand conservation at virtual origin/destination: 0 = \u2211\nk\u2208 zw\u0304k \u2212\n\u2211 m\u2208 zw\u0304w\u0304[m] \u27c2 w\u0304 free,\u2200w \u2208  , (4.5t)\n0 = \u2211\nm\u2208 zw[m]w \u2212\n\u2211 k\u2208 zk\u0304w \u27c2 w free,\u2200w \u2208  , (4.5u)\nTotal flow conservation on virtual links: 0 = \u2211\nm\u2208\n\u2211 w\u2208 zw\u0304w\u0304[m] \u2212 \u2211 m\u2208 \u2211 w\u2208 zw[m]w \u27c2 free, (4.5v)\nFleet sizing: 0 \u2a7d S \u2212 \u2211\nk,w\u2208 zw\u0304k tkw\u0304 \u2212\n\u2211\nm\u2208\n\u2211 (v,u)\u2208(m) z[m]vu tvu \u27c2 fleet \u2a7e 0, (4.5w)\nHere we would like to discuss the economic interpretation of the multiplier associated with the demand conservation constraints defined in Equs. (4.5o,4.5s). The multiplier [e]w , [p]w\u0304 can be deemed as \u201cdemand price\" or \u201csurgeprice,\" which is a fee that an e-hailing passenger pays to drivers. In other words, when there is a surplus of e-hailing vehicles, the passengers do not need to wait; when there is no surplus of e-hailing vehicles, the passengers have to wait. We summarize the above two conditions in Equ. (4.6) for e-solo and e-pooling, respectively. Equ. (4.6) will be\nrevisited in Sec. 6 for the computation of passengers\u2019 waiting cost. {\nzw\u0304w\u0304[e] > q [e] w \u21d2 [e] w = 0, (e-solo passengers no waiting) zw\u0304w\u0304[e] = q [e] w \u21d2 [e] w > 0. (e-solo passengers waiting)\n(4.6a) {\nzw\u0304w\u0304[p] + \u2211 k\u2208 ,k\u2260w z [p] k\u0304w\u0304 > q[p]w \u21d2 [p] w\u0304 = 0, (e-pooling passengers no waiting)\nzw\u0304w\u0304[p] + \u2211 k\u2208 ,k\u2260w z [p] k\u0304w\u0304 = q[p]w \u21d2 [p] w\u0304 > 0. (e-pooling passengers waiting)\n(4.6b)\nLikewise, the economic meaning of the multiplier fleet associated with the fleet sizing constraint defined inEqu. (4.5w) can be regarded as the incentive paid by the e-platform to drivers and imposed as an extra cost to the platform, shown in Equs (4.5a-4.5e). When there are more drivers than needed, the e-platform does not have to invest. When there are fewer drivers, the e-platform pays an extra bonus to incentivize more drivers to join. Accordingly,\n{\nS > \u2211 k,w\u2208 z w\u0304 k tkw\u0304 + \u2211 m\u2208 \u2211 (u,v)\u2208(m) z [m] vu tvu \u21d2 fleet = 0, (underworking, e-platform no incentive)\nS = \u2211 k,w\u2208 z w\u0304 k tkw\u0304 + \u2211 m\u2208 \u2211 (v,u)\u2208(m) z [m] vu tvu \u21d2 fleet > 0. (total work hours reached, e-platform pays)\n(4.7) To demonstrate how to apply the vehicle dispatching module to the 3-node network (Fig. 4), we lay out all the\nequations shown in Appendix A.6."
        },
        {
            "heading": "4.2. Module 1.2: Vehicle-passenger matching",
            "text": "How would passengers move along with vehicle flows? Because passengers do not get to choose which e-hailing vehicles to take, the passenger flow is determined by the driver-passenger matching plan devised by the e-hailing platform, not chosen by passengers. Given an optimal vehicle dispatch plan {z[m]uv ,\u2200u, v \u2208 +(m) \u222a \u2212(m), m \u2208 } \u22c3\n{zuv,\u2200u \u2208  +, v \u2208 \u2212}, the e-platform needs to match driver-passenger and output passenger flows through\na flow network. E-pooling vehicle-passenger matching is essentially a minimum-cost flow problem, provided with dispatched vehicle flow, riders\u2019 requests, and travel cost as input. In other words, the e-platform aims to find a matching strategy to send all passengers from their origins to destinations with the minimum cost over all edges on a passenger OD graph. Below we will introduce in sequence the structure of the passenger OD graph, the platform\u2019s objective, and passenger flow constraints."
        },
        {
            "heading": "4.2.1. Passenger OD graph",
            "text": "The components of a passenger OD graph is illustrated in Fig. 6. A passenger OD graph is a subgraph of its vehicle OD graph counterpart. The e-pooling layer resembles the topology of its associated e-pooling vehicle OD graph, except that there is no virtual origin nor virtual destination for a passenger OD graph. In the e-pooling layer, all the origins are aligned on the left-hand side and all the destinations are aligned on the right-hand side. All origins are connected with one another, and all destinations are connected with one another. Directed edges also emanate from all origins to all destinations. Different from the vehicle OD graph, however, the feasible path set on a passenger OD graph is smaller. First, there does not exist any e-pooling passenger flow of OD pair \u2200w \u2208  prior to its origin w\u0304 nor post its destination w. Second, there does not exist rebalancing flows for passengers and passenger flows end at their associated destinations. Thus, for passenger flow y(w)[m]uv of OD pair \u2200w \u2208  , there only exist outgoing links from itsorigin w\u0304 and only incoming links to its destination w from other destinations. Fig. 6 demonstrates the passenger OD graph from the perspective of OD pair \u2200w \u2208  .\nRemark. Note that on each edge in the passenger OD graph, there exist passenger flows for at maximum two OD pairs. For example, on edge (w\u0304[p], k[p]), there only exist two types of passenger flows, namely, y(w)[p]w\u0304k , y(k)[p]w\u0304k . In other words, there does not exist any other passenger flows associated with OD pairs than w, k \u2208  on this edge."
        },
        {
            "heading": "4.2.2. Passenger flow constraints",
            "text": "Define y(w)[m]uv ,\u2200u, v \u2208  (m), w \u2208  as the passenger flow on an edge (u, v) in the passenger OD graph belongingto OD pair w and mode m. The e-solo passenger flow only exists when u = w\u0304, v = w and it should be equal to its demand. In addition, the driver-passenger matching simply satisfies the supply demand constraint that the e-solo passenger flow needs not to exceed its vehicle flow on the same edge. Mathematically,\ny(w)[e]uv\n{\n= q[e]w , u = w\u0304, v = w = 0,\u2200u \u2260 w\u0304 and v \u2260 w ,\ny(w)[e]w\u0304w \u2a7d z [e] w ,\u2200w \u2208  .\nHowever, e-pooling passengers of OD pairw can visit nodes other than their own origins and destinations. In other words, it is likely that y(w)[p]uv > 0,\u2200u \u2260 w\u0304 and v \u2260 w. Thus, we need to further solve the vehicle-passenger matchingproblem, other than the demand-supply constraint defined in Equation (4.5). Subsequently, we will primarily focus on defining e-pooling passenger flow constrains.\nSimilar to how vehicle flow constraints are demonstrated in Fig. 5, the constraints associated with e-pooling passenger flows on a passenger OD graph are illustrated in Fig. 6. The symbols used to represent constrains follow the same style as in Fig. 5. Flow conservation at origin/destination. If the e-pooling passenger flow of OD pair \u2200w \u2208  visit a second origin of OD pair \u2200k \u2208  , k \u2260 w, they can only move to its own destination w or the associated destination k.\n(\u25cb) y(w)[p] w\u0304k\u0304 = y(w)[p] k\u0304w + y(w)[p] k\u0304k ,\u2200w, k \u2208  , w \u2260 k,\nSimilarly, if the e-pooling passenger flow of OD pair \u2200w \u2208  move to its own destination w from a second destination of OD pair \u2200k \u2208  , k \u2260 w, at the associated destination k, passenger flows can only originate from either its own origin w\u0304 or the origin of the second OD pair, i.e., k\u0304.\n(\u25b3) y(w)[p]kw = y (w)[p] w\u0304k + y (w)[p] k\u0304k ,\u2200w, k \u2208  , w \u2260 k,\nDemand conservation at origin/destination. E-pooling passengers of OD pairw need to be all picked up at its origin. In other words, the sum of these passenger flows needs to be distributed to outgoing links from its origin.\n(\u2605) y(w)[p]w\u0304w + \u2211\nk\u2208 ,k\u2260w\n[\ny(w)[p] w\u0304k\u0304 + y(w)[p]w\u0304k ] = q[p]w ,\u2200w \u2208  , w\u0304 \u2208 +(p).\nSimilarly, e-pooling passengers of OD pair w need to be all dropped off at its destination. In other words, the sum of these passenger flows needs to be collected from incoming links to its destination.\n(\u2605) y(w)[p]w\u0304w + \u2211\nk\u2208 ,k\u2260w\n[\ny(w)[p] k\u0304w + y(w)[p]kw\n]\n= q[p]w ,\u2200w \u2208  , w \u2208 \u2212(p).\nPrior to an origin or post a destination. The e-pooling passenger flow of OD pair \u2200w \u2208  does not exist prior to its origin nor post its destination.\ny(w)[p]vw\u0304 = 0,\u2200w \u2208  , v \u2208  +(p), v \u2260 w\u0304,\ny(w)[p]wv = 0,\u2200w \u2208  , v \u2208 \u2212(p), v \u2260 w,\nOrigin or destination edges. The e-pooling passenger flow of OD pair \u2200w \u2208  on an origin edge is zero if it does not start from its own origin.\ny(w)[p]uv = 0,\u2200w \u2208  , u \u2208 +(p), u \u2260 w\u0304, v \u2208 +(p),\nSimilarly, the e-pooling passenger flow of OD pair \u2200w \u2208  on a destination edge is zero if it does not end at its own destination.\ny(w)[p]vu = 0,\u2200w \u2208  , v, u \u2208 \u2212(p), u \u2260 w.\nSupply demand constraint. The e-pooling passenger flow of OD pair \u2200w \u2208  , v, u \u2208  (m) on an edge should not exceed the vehicle flow on that edge and is always non-negative. Note that we assume each car has a capacity of two. Thus, we just need to ensure that the passenger flow from one OD is no greater than the vehicle flow on the same edge. Accordingly, the passenger flows from two ODs are automatically no greater than twice the vehicle flow, which is the vehicle capacity. Recall that on each edge in the passenger OD graph, there exist passenger flows for at maximum two OD pairs. Thus, we have\n0 \u2a7d y(w)[p]vu \u2a7d z [p] vu ,\u2200w \u2208  , v, u \u2208  (p),"
        },
        {
            "heading": "4.2.3. Objective function",
            "text": "In the passenger OD graph, the edge cost is the travel time of traversing that edge, c[m]vu = tvu. The nodal cost is the waiting cost at a pick-up node w\u0304,\u2200w \u2208  , denoted as c[m](wt)w\u0304 , which will be detailed in Equs. (6.5) and (6.7).The platform determines a driver-passenger matching plan, with a goal of optimizing customer satisfaction, represented by minimizing passengers\u2019 total in-vehicle travel cost plus waiting cost. Mathematically, the objective function is the sum of the following two components:\nTravel time: (in\u2212ve\u210e) \u2211\nv,u\u2208 (m),(v,u)\u2208 tvu \u22c5\n\u2211 w\u2208 y(w)[m]vu , (4.9a)\nWaiting cost: c[m](wt)w\u0304 \u22c5 \u2211 u\u2208 (m) y(w)[m]vu . (4.9b)\nRemark. 1. The first term of travel time is time-based and the second term of waiting cost is cost based. Thus, a coefficient (in\u2212ve\u210e) representing the value of time for passengers in-vehicle is multiplied in front of the firstterm.\n2. In this paper, \u201cvehicle dispatching\" and \u201cvehicle-passenger matching\u201d are separated into two sequential modules. When the platform determines where to dispatch idle vehicles to meet demands, it is profit-driven. After vehicles are dispatched to reach passengers, the platform aims to move passengers to their destinations as fast as possible to increase passenger satisfaction, thus it is time-based."
        },
        {
            "heading": "4.2.4. Nonlinear complementarity formulation",
            "text": "We formulate the minimum-cost flow problem to match e-pooling vehicles and passengers on the e-pooling passenger OD graph as an NCP. Mathematically, [M1.2.NCP-VehPassMatch]: Cost minimization for passengers: 0 \u2a7d y(w)[p]\nw\u0304k\u0304 \u27c2 (in\u2212ve\u210e)tw\u0304k\u0304 + c [p](wt) w\u0304 \u2212 [p]+ w \u2212 (w)[p] k\u0304 + (w)[p] w\u0304k\u0304 \u2a7e 0,\u2200w\u0304, k\u0304 \u2208  +(p), k \u2260 w,\u2200w \u2208  , (4.10a) 0 \u2a7d y(w)[p]w\u0304k \u27c2 (in\u2212ve\u210e)tw\u0304k + c [p](wt) w\u0304 \u2212 [p]+ w + (w)[p] k + (w)[p] w\u0304k \u2a7e 0,\u2200w\u0304 \u2208 \n+(p), k \u2208  \u2212(p),\u2200w \u2208  , (4.10b) 0 \u2a7d y(w)[p]kw \u27c2 (in\u2212ve\u210e)tkw \u2212 [p]\u2212 w \u2212 (w)[p] k + (w)[p] kw \u2a7e 0,\u2200w, k \u2208 \n\u2212(p),\u2200w \u2208  , (4.10c) 0 \u2a7d y(w)[p]w\u0304w \u27c2 (in\u2212ve\u210e)tw\u0304w \u2212 [p]+ w \u2212 [p]\u2212 w + (w)[p] w\u0304w \u2a7e 0,\u2200w\u0304 \u2208 \n+(p),\u2200w \u2208  , (4.10d) 0 \u2a7d y(w)[p]\nk\u0304w \u27c2 (in\u2212ve\u210e)tk\u0304w \u2212 [p]\u2212w + (w)[p] k\u0304 + (w)[p] k\u0304w \u2a7e 0,\u2200k\u0304 \u2208  +(p), w \u2208  \u2212(p),\u2200w \u2208  , (4.10e) 0 \u2a7d y(w)[p]\nk\u0304k \u27c2 (in\u2212ve\u210e)tk\u0304k + (w)[p] k\u0304 + (w)[p]k + (w)[p] k\u0304k \u2a7e 0,\u2200k\u0304 \u2208  +(p), k \u2208  \u2212(p),\u2200k \u2208  , k \u2260 w, (4.10f) Demand conservation at origin/destination: 0 = y(w)[p]w\u0304w + \u2211\nk\u2208 ,k\u2260w\n[\ny(w)[p] w\u0304k\u0304 + y(w)[p]w\u0304k ] \u2212 q[p]w \u27c2 [p]+ w free,\u2200w \u2208  , w\u0304 \u2208  +(p), (4.10g)\n0 = y(w)[p]w\u0304w + \u2211\nk\u2208 ,k\u2260w\n[\ny(w)[p] k\u0304w + y(w)[p]kw ] \u2212 q[p]w \u27c2 [p]\u2212 w free,\u2200w \u2208  , w \u2208  \u2212(p), (4.10h)\nFlow conservation at origin/destination: 0 = y(w)[p]\nw\u0304k\u0304 \u2212 y(w)[p] k\u0304w \u2212 y(w)[p] k\u0304k \u27c2 (w)[p] k\u0304 free,\u2200w, k \u2208  , w \u2260 k, (4.10i)\n0 = y(w)[p]kw \u2212 y (w)[p] w\u0304k \u2212 y (w)[p] k\u0304k \u27c2 (w)[p]k free,\u2200w, k \u2208  , w \u2260 k, (4.10j)\nNominal constraints: y(w)[p]vw\u0304 = 0,\u2200w \u2208  , v \u2208 \n+(p), v \u2260 w\u0304, (4.10k) y(w)[p]wv = 0,\u2200w \u2208  , v \u2208 \n\u2212(p), v \u2260 w, (4.10l) y(w)[p]vu = 0,\u2200w \u2208  , v, u \u2208 \n+(p), v, u \u2260 w\u0304, (4.10m) y(w)[p]vu = 0,\u2200w \u2208  , v, u \u2208 \n\u2212(p), v, u \u2260 w. (4.10n) Supply demand constraint: 0 \u2a7d z[p]vu \u2212 y (w)[p] vu \u27c2 (w)[p] vu \u2a7e 0,\u2200w \u2208  , v, u \u2208  (p). (4.10o)\nFollowing suit with the economic interpretation of the multiplier in Equ. (4.6), here we discuss the multipliers (w)[m]vu ,\u2200w \u2208  , v, u \u2208  (m),\u2200m \u2208  associated with the supply-demand constraints. For all \u2200w \u2208  , v, u \u2208  (m),\u2200m \u2208 ,\n{\ny(w)[m]vu < z [m] vu \u21d2 (w)[m] vu = 0, (demand < supply (oversupply), no extra fee) y(w)[m]vu = z [m] vu \u21d2 (w)[m] vu > 0. (demand = supply (undersupply), fee paid by passengers to drivers))\n(4.11)\nTo demonstrate how to apply the vehicle-passenger matching module to the 3-node network (Fig. 4), we also write out the equations related to passenger flows in Appendix A.6."
        },
        {
            "heading": "5. Module 2: E-hailing vehicle route choice on congested networks",
            "text": "E-solo, e-pooling, and rebalancing vehicles contribute to traffic congestion. Compared to conventional traffic assignment problems, route choice for e-hailing vehicles depends on the corresponding vehicle flow. To define vehicle flows for each augmented OD pair, we first introduce a list of binary node-OD incidence indicators.\n(o)uw\u0304 =\n{\n0, node u is not the origin node of OD pair w, u \u2260 w\u0304, 1, node u is the origin node of OD pair w, u = w\u0304, \u2200u \u2208  , w \u2208  .\n(d)uw =\n{\n0, node u is not the destination node of OD pair w, u = w, 1, node u is the destination node of OD pair w, u \u2260 w, \u2200u \u2208  , w \u2208  .\nBuilding on two indicators, we define a list of node-OD incidence matrices below: (od)(u,v)w = (o) uw\u0304 (d) vw = { 0, node pair (u, v) is not OD pair w, u \u2260 w\u0304, v \u2260 w, 1, node pair (u, v) is OD pair w, u = w\u0304, v = w, \u2200u, v \u2208  , w \u2208  .\n(oo)(u,v)wk = (o) uw\u0304 (o) vk\u0304 =\n{\n0, node pair (u, v) is not OO pair (w\u0304, k\u0304), u \u2260 w\u0304, j \u2260 k\u0304, 1, node pair (u, v) is OO pair (w\u0304, k\u0304), u = w\u0304, v = k\u0304, \u2200u, v \u2208  , w, k \u2208  .\n(od)(u,v)wk = (o) uw\u0304 (d) vk =\n{\n0, node pair (u, v) is not OD pair (w\u0304, k), u \u2260 w\u0304, v \u2260 k, 1, node pair (u, v) is OD pair (w\u0304, k), u = w\u0304, v = k, \u2200u, v \u2208  , w, k \u2208  .\n(dd)(u,v)wk = (d) uw (d) vk =\n{\n0, node pair (u, v) is not DD pair (w, k), u \u2260 w, v \u2260 k, 1, node pair (u, v) is DD pair (w, k), u = w, v = k, \u2200u, v \u2208  , w, k \u2208  .\n(do)(u,v)wk = (d) uw (o) vk\u0304 =\n{\n0, node pair (u, v) is not DO pair (w, k\u0304), u \u2260 w, v \u2260 k\u0304, 1, node pair (u, v) is DO pair (w, k\u0304), u = w, v = k\u0304, \u2200u, v \u2208  , w, k \u2208  .\nFrom now on, we will replace the OD pair w = (u, v) by (i, d) to align notations used in this module. With the above node-OD incidence indicators, the vehicle demand on an arbitrary node pair (i, d) is computed as:\nq(i,d) = \u2211 w\u2208 (od)(i,d)wq [e] w\n\u23df\u23de\u23df\u23de\u23df e-solo vehicles for OD pair\n+ \u2211\nw,k\u2208\n\u239b\n\u239c\n\u239c\n\u239c\n\u239c\n\u239d\n(oo)(i,d)wkz [p] w\u0304k\u0304\n\u23df\u23de\u23de\u23df\u23de\u23de\u23df e-pool vehicles for OO pair\n+ (od)(i,d)wkz [p] w\u0304k\n\u23df\u23de\u23de\u23df\u23de\u23de\u23df e-pool vehicles for OD pair\n+ (dd)(i,d)wkz [p] wk\n\u23df\u23de\u23de\u23df\u23de\u23de\u23df e-pool vehicles for DD pair\n\u239e\n\u239f\n\u239f\n\u239f\n\u239f\n\u23a0\n+ \u2211 w,k\u2208 (do)(i,d)wkz k\u0304 w\n\u23df\u23de\u23df\u23de\u23df rebalancing vehicles for DO pair\n."
        },
        {
            "heading": "5.1. Traffic assignment problem",
            "text": "Traffic assignment problem can be path, link, link-OD, or link-node based. We will use link-node based formulation. In a road network, define xdij as the flow on road segment or link (i, j) \u2208 (net) destined to node d \u2208  . Then the link flow on link (i, j) \u2208 (net) is denoted as xij = \u2211d\u2208(net) xdij . Accordingly, define di \u2265 0 as node potentials. At user equilibrium, on link (i, j) \u2208 (net) destined to node d \u2208  , no driver can reduce her travel time byunilaterally switching routes (Di et al., 2018). The corresponding link-node based complementarity conditions for route choice are formulated as:\n0 \u2a7d xdij \u27c2 d j + tij(x) \u2212 d i \u2a7e 0,\u2200(i, j) \u2208 (net), d \u2208  .\nThe complementarity conditions of flow conservation at intermediate nodes are: 0 \u2a7d \u2211\nj\u2236(i,j)\u2208(net)\nxdij \u2212 \u2211\nk\u2236(k,i)\u2208(net)\nxdki \u27c2 d i \u2a7e 0,\u2200i \u2208 (net) \u29f5 , d \u2208  .\nDemand conservation conditions are satisfied at augmented origin nodes corresponding to di ,\u2200i \u2208 +, v \u2208 \u2212: 0 \u2a7d \u2211\nj\u2236(i,j)\u2208(net)\nxdij \u2212 \u2211\nk\u2236(k,i)\u2208(net)\nxdki \u2212 q(i,d) \u27c2 d i \u2a7e 0,\u2200i, d \u2208  ."
        },
        {
            "heading": "5.2. Module summary",
            "text": "Summarizing the route choice equilibrium conditions in Equ. 5.1 and the conservation constraints in Equs. 5.1-5.1 and 5.1, the complementarity problem of Module 2 is denoted as [M2.NCP-VehRoute]: [M2.NCP-VehRoute] Route choice: 0 \u2a7d xdij \u27c2 d j + tij(x) \u2212 d i \u2a7e 0,\u2200(i, j) \u2208 (net), d \u2208  , (5.1a)\nFlow conservation at intermediate Nodes: 0 \u2a7d \u2211\nj\u2236(i,j)\u2208(net)\nxdij \u2212 \u2211\nk\u2236(k,i)\u2208(net)\nxdki \u27c2 d i \u2a7e 0,\u2200i \u2208 (net) \u29f5 , d \u2208  , (5.1b)\nDemand conservation at augmented origin nodes: 0 \u2a7d \u2211\nj\u2236(i,j)\u2208(net)\nxdij \u2212 \u2211\nk\u2236(k,i)\u2208(net)\nxdki \u2212 q(i,d) \u27c2 d i \u2a7e 0,\u2200i, d \u2208  , (5.1c)\nVehicle demand on augmented OD pairs: q(i,d) = \u2211\nw\u2208aug (od)(i,d)wq [e] w +\n\u2211\nw,k\u2208aug\n(\n(oo)(i,d)wkz [p] w\u0304k\u0304 + (od)(i,d)wkz [p] w\u0304k + (dd) (i,d)wkz [p] wk\n)\n+ \u2211 w,k\u2208aug (do)(i,d)wkz k\u0304 w. (5.1d)"
        },
        {
            "heading": "6. Module 3: TNC customer mode choice",
            "text": ""
        },
        {
            "heading": "6.1. Demand conservation",
            "text": "A traveler faces two mode choices: taking e-hailing alone or pooling with another passenger. Denote the traffic demand between OD pair w = (i, d) as qw > 0. For the fixed travel demand case, the total travel demand qw is split into available modes, denoted as q[m]w ,\u2200m \u2208 . The demand conservation condition needs to be satisfied for each ODpair \u2200w \u2208  across modes \u2200m \u2208 , namely,\n\u2211 m\u2208 q[m]w = qw,\u2200w \u2208  . (6.1)"
        },
        {
            "heading": "6.2. Mode choice",
            "text": "The travel disutility of being e-solo passengers for OD pair w = (w\u0304, w) \u2208  is the sum of e-solo fare (sum of a fixed fare, a distance-based, and a time-based pricing), nodal cost (including waiting cost and matching friction), edge cost (i.e., supply-demand surplus cost), and OD cost (including in-vehicle travel cost):\nU [e]w = \u2212r [e] w\n\u23df \u23df e-solo fare + c[e](nod)w\u0304 \u23df\u23df\u23df nodal cost + c[e](surp\u2212pas)w \u23df\u23de\u23de\u23de\u23de\u23df\u23de\u23de\u23de\u23de\u23df edge cost + c(in\u2212ve\u210e)w \u23df\u23df\u23df OD cost . (6.2)\nThe travel disutility of being e-pooling passengers for OD pair w is the sum of e-pooling fare (sum of a fixed cost, a distance-based, and a time-based cost), nodal cost (including waiting cost and matching friction), edge cost (i.e., supply-demand surplus cost), and OD cost (including en-route travel cost and inconvenience cost arising from sharing rides with others in an enclosed space):\nU [p]w = \u2212r [p] w\n\u23df \u23df e-pooling fare + c[p](nod)w\u0304 \u23df\u23df\u23df nodal cost + c[p](surp\u2212pas)w \u23df\u23de\u23de\u23de\u23de\u23df\u23de\u23de\u23de\u23de\u23df edge cost + c(in\u2212ve\u210e)w + c [p](inc) w \u23df\u23de\u23de\u23de\u23de\u23de\u23de\u23de\u23de\u23de\u23df\u23de\u23de\u23de\u23de\u23de\u23de\u23de\u23de\u23de\u23df OD cost . (6.3)\nAt an origin node \u2200w\u0304 \u2208 +(m), travelers who are desirable for e-hailing choose either taking e-hailing alone or pooling with another passenger."
        },
        {
            "heading": "6.2.1. Cost specification: Nodal cost",
            "text": "The nodal cost denotes the total waiting time for passengers to be picked up at a node. It consists of two parts: the time drivers spend on reaching the node and the waiting time caused by drivers\u2019 search friction at the node. Mathematically, the nodal cost at origin \u2200w\u0304 \u2208 + for travel mode m \u2208  is formulated as below:\nc[m](nod)w\u0304 = c [m](wt) w\u0304 \u23df \u23df waiting: vehicles reach the node + c[m](se\u2212pas)w\u0304 \u23df\u23de\u23de\u23de\u23df\u23de\u23de\u23de\u23df search friction: vehicle-passenger match at the node , (6.4)\nWaiting cost. An e-solo and an e-pooling passenger could experience different waiting time to be picked up by an e-hailing vehicle. Thus, we will compute waiting cost for two types of passengers separately. E-solo. For an e-solo passenger of OD pair w \u2208  , her waiting time to be picked up is the vacant vehicles\u2019 average travel time to the origin w\u0304 from any drop-off node \u2200v \u2208 \u2212, v \u2208  , which is formulated as:\nc[e](wt)w\u0304 = [e] (wt) \u22c5\n\u2211\nv\u2208\u2212\nzw\u0304v \u2211\nv\u2032\u2208\u2212 z w\u0304 v\u2032 tvw\u0304\n\u23df\u23de\u23de\u23de\u23de\u23de\u23de\u23de\u23de\u23de\u23de\u23de\u23de\u23df\u23de\u23de\u23de\u23de\u23de\u23de\u23de\u23de\u23de\u23de\u23de\u23de\u23df vacant vehicles\u2019 average travel time to w\u0304, cw\u0304\n\u225c [e](wt) \u22c5 \u2211 v\u2208\u2212 ovw\u0304tvw\u0304, (6.5)\nwhere [e](wt) is the weight of waiting cost. We define ovw\u0304 \u2261 zw\u0304v \u2211\nv\u2032\u2208\u2212 z w\u0304 v\u2032 \u2265 0 as the vacant vehicle percentage flowing into the virtual origin node w\u0304 \u2208 + from a specific virtual destination node v, and it satisfied that: \u2211v\u2208\u2212 ovw\u0304 = 1. The complementarity conditions associated with ovw\u0304 are:\n0 \u2a7d ovw\u0304 \u27c2 \u2211 v\u2032\u2208\u2212 zw\u0304v\u2032 \u22c5 ovw\u0304 \u2212 z w\u0304 v + \u2212 vw\u0304 \u2a7e 0,\u2200v \u2208  \u2212, w\u0304 \u2208 +, (6.6a)\n0 \u2a7d \u2212vw\u0304 \u27c2 1 \u2212 ovw\u0304 \u2a7e 0,\u2200v \u2208  \u2212, w\u0304 \u2208 +. (6.6b)\nDerivation of complementarity conditions in Equ. 6.6 is shown in Appendix A.7. E-pooling. There are two scenarios to compute the waiting cost of an e-pooling passenger. For an e-pooling passenger of OD pair w \u2208  , if she is the first passenger to be picked up, her waiting time is the vacant vehicles\u2019 average travel time to the origin w\u0304 from any drop-off node \u2200v \u2208 \u2212, v \u2208  . If she is the second passenger to be picked up, her waiting time consists of two parts, namely, the vacant vehicles\u2019 average travel time to an origin k\u0304 \u2208 +, k \u2208  from a drop-off node \u2200v \u2208 \u2212, v \u2208  and the 1-passenger occupied vehicles\u2019 average travel time to her pick-up node w\u0304 from a previous pick-up location. Considering the fact that an e-pooling passenger can be picked up as either the first passenger or the second passenger, we calculate the weighted average waiting time according to the probability of being the first or second passenger to get picked up. Mathematically, \u2200w \u2208  :\nc[p](wt)w\u0304 = [p] (wt) \u22c5\n{ \u2211 k\u2208 ,k\u2260w y (w)[p] w\u0304k\u0304\n\u2211 k\u2208 ,k\u2260w y (w)[p] w\u0304k\u0304 + \u2211 k\u2208 y (w)[p] w\u0304k\n\u22c5 \u2211\nv\u2208\u2212\nzw\u0304v \u2211\nv\u2032\u2208\u2212 z w\u0304 v\u2032 tvw\u0304\n\u23df\u23de\u23de\u23de\u23de\u23de\u23de\u23de\u23de\u23de\u23de\u23de\u23df\u23de\u23de\u23de\u23de\u23de\u23de\u23de\u23de\u23de\u23de\u23de\u23df vacant vehicles\u2019 average travel time to w\u0304, cw\u0304\n+ y(w)[p]w\u0304w\n\u2211 k\u2208 ,k\u2260w y (w)[p] w\u0304k\u0304 + \u2211 k\u2208 y (w)[p] w\u0304k\n\u22c5 \u2211\nk\u0304\u2208+(p),k\u2208 ,k\u2260w\n{\n\u2211\nv\u2208\u2212\nzk\u0304v \u2211\nv\u2032\u2208\u2212 z k\u0304 v\u2032\ntvk\u0304\n\u23df\u23de\u23de\u23de\u23de\u23de\u23de\u23de\u23de\u23de\u23de\u23de\u23df\u23de\u23de\u23de\u23de\u23de\u23de\u23de\u23de\u23de\u23de\u23de\u23df vacant vehicles\u2019 average travel time to k\u0304, cvk\u0304\n+tk\u0304w\u0304\n}\n,\n+ \u2211\nk\u0304\u2208+(p),k\u2208 ,k\u2260w\ny(w)[p]w\u0304k \u2211\nk\u2208 ,k\u2260w y (w)[p] w\u0304k\u0304 + \u2211 k\u2208 y (w)[p] w\u0304k\n\u22c5\n{\n\u2211\nv\u2208\u2212\nzk\u0304v \u2211\nv\u2032\u2208\u2212 z k\u0304 v\u2032\ntvk\u0304\n\u23df\u23de\u23de\u23de\u23de\u23de\u23de\u23de\u23de\u23de\u23de\u23de\u23df\u23de\u23de\u23de\u23de\u23de\u23de\u23de\u23de\u23de\u23de\u23de\u23df vacant vehicles\u2019 average travel time to k\u0304, cvk\u0304\n+tk\u0304w\u0304\n}}\n\u225c [p](wt) \u22c5\n{\n\u2211\nk,k\u2260w o(w)[p] w\u0304k\u0304\n\u2211\nv ovw\u0304tvw\u0304 + o\n(w)[p] w\u0304w\n\u2211\nk,k\u2260w\n{\n\u2211\nv ovk\u0304tvk\u0304 + tk\u0304w\u0304\n}\n+ \u2211 k,k\u2260w o(w)[p]w\u0304k\n{\n\u2211\nv ovk\u0304tvk\u0304 + tk\u0304w\u0304\n}}\n(6.7)\nwhere [p](wt) is the weight of waiting cost. The vacant vehicles\u2019 average travel time to the passenger\u2019s pick-up node w\u0304 \u2208 +(p) or a different pick-up node k\u0304 \u2208 +, is similar to that defined in Equation (6.5). Following suit, we can introduce new variables ovw\u0304, ovk\u0304 to reformulate these two terms. We introduce two new variables, namely, o(w)[p]w\u0304k\u0304 =\ny(w)[p] w\u0304k\u0304\n\u2211 k\u2208 ,k\u2260w y (w)[p] w\u0304k\u0304 + \u2211 k\u2208 y (w)[p] w\u0304k\nas the proportion of the first passenger picked up at origin w\u0304, o(w)[p]w\u0304k = y(w)[p]w\u0304k \u2211\nk\u2208 ,k\u2260w y (w)[p] w\u0304k\u0304 + \u2211 k\u2208 y (w)[p] w\u0304k as the proportion of the second passenger picked up at origin w\u0304. Their complementarity conditions are:\n0 \u2a7d o(w)[p] w\u0304k\u0304 \u27c2 ( \u2211 k\u2208 ,k\u2260w y(w)[p] w\u0304k\u0304 + \u2211 k\u2208 y(w)[p]w\u0304k ) \u22c5 o (w)[p] w\u0304k\u0304 \u2212 y(w)[p] w\u0304k\u0304 + (w)[p]\u2212 w\u0304k\u0304 \u2a7e 0,\u2200k\u0304, w\u0304 \u2208 +(p), k \u2260 w \u2208  , (6.8a)\n0 \u2a7d (w)[p] w\u0304k\u0304 \u27c2 1 \u2212 o(w)[p] w\u0304k\u0304 \u2a7e 0,\u2200k\u0304, w\u0304 \u2208 +, k \u2260 w \u2208  , (6.8b)\n0 \u2a7d o(w)[p]w\u0304k \u27c2 ( \u2211 k\u2208 ,k\u2260w y(w)[p] w\u0304k\u0304 + \u2211 k\u2208 y(w)[p]w\u0304k ) \u22c5 o (w)[p] w\u0304k \u2212 y (w)[p] w\u0304k + (w)[p]\u2212 w\u0304k \u2a7e 0,\u2200w\u0304 \u2208  +(p), k\u0304 \u2208 \u2212(p), (6.8c)\n0 \u2a7d (w)[p]w\u0304k \u27c2 1 \u2212 o (w)[p] w\u0304k \u2a7e 0,\u2200w\u0304 \u2208  +(p), k\u0304 \u2208 \u2212(p). (6.8d) Search friction. Search friction is incurred when e-hailing drivers seek passengers at origins. We use c[m](se\u2212ve\u210e)w\u0304 to denote the time drivers spend seeking passengers and c\u0303[m](se\u2212pas)w\u0304 to denote the time passengers spend waiting tobe picked up by drivers. Following the Douglas form of matching functions (Yang et al., 2010), we have A(c\u0303[e](se\u2212pas)w\u0304 \u22c5 q[e]w ) 1 (c[e](se\u2212ve\u210e)w\u0304 \u22c5z [e] w\u0304w)\n2 = q[e]w andA(c\u0303[p](se\u2212pas)w\u0304 \u22c5q[p]w ) 1 (c[p](se\u2212ve\u210e)w\u0304 \u22c5\u2211u\u2208+(p)\u222a+ z[p]uw\u0304) 2 = q[p]w , where c\u0303[m](mf )w\u0304 ,\u2200w \u2208  , m \u2208  is waiting time of passengers at origins when matched with drivers. z[e]w\u0304w and \u2211 u\u2208+(p)\u222a+ z [p] uw\u0304 represent the e-solo and e-pooling vehicle flow at origin w\u0304, respectively. They fulfill the travel demand of OD pair w,w \u2208  . 1 and 2are matching elasticity and A is a constant representing properties of a matching zone. Accordingly, we can calculate search friction of drivers,\nc[e](se\u2212ve\u210e)w\u0304 = (se\u2212ve\u210e) \u22c5 A \u2212 1 2 (z[e]w\u0304w) \u22121(q[e]w ) 1\u2212 1 2 (c\u0303[e](se\u2212pas)w\u0304 ) \u2212 1 2 . (6.9a)\nc[p](se\u2212ve\u210e)w\u0304 = (se\u2212ve\u210e) \u22c5 A \u2212 1 2 (\n\u2211 u\u2208+(p)\u222a+ z[p]uw\u0304)\n\u22121(q[p]w ) 1\u2212 2 2 (c\u0303[p](se\u2212pas)w\u0304 ) \u2212 1 2 , (6.9b)\nwhere, (se\u2212ve\u210e) is the cost coefficient. Note that c[m](se\u2212ve\u210e)w\u0304 and c\u0303[m](se\u2212pas)w\u0304 depend on each other, meaning that tocompute one we need to specify the other first. In this paper, we assume passengers\u2019 waiting time to be matched with drivers c\u0303[m](se\u2212pas)w\u0304 as constants. We have\nc[m](se\u2212pas)w\u0304 = (se\u2212pas) \u22c5 [c\u0303 [m](se\u2212pas) w\u0304 + [m] w\u0304 ] (6.10)\nwhere, (se\u2212pas) is the cost coefficient and [m]w\u0304 is the multiplier associated with the demand constraints, denoting theextra waiting time of passengers (Equ. 4.6)."
        },
        {
            "heading": "6.2.2. Cost specification: Edge cost",
            "text": "Supply-demand surplus for passenger flows. Supply-demand surplus cost for passenger flows is a fee depicting the gap between the demand and supply of passengers, according to the economic interpretation in Equ. (4.11). Thus, passenger flow supply-demand surplus cost for OD pair w \u2208  , denoted as c[m](surp\u2212pas)w , is proportional to the multiplier (w)[m]vu ,\u2200w \u2208  , v, u \u2208  (m),\u2200m \u2208 . Mathematically,\nc[m](surp\u2212pas)w = [m] (surp\u2212pas) \u2211\n(u,v)\u2208(m)\n\u2211 \u210e\u2208w (ed\u2212pa)(u,v)\u210e (pa\u2212od) \u210ew (w)[m] vu . (6.11)\nwhere [m](surp\u2212pas) is the weight of edge cost."
        },
        {
            "heading": "6.2.3. Cost specification: OD cost",
            "text": "In-vehicle travel cost. The in-vehicle travel cost is the value of time for passengers to stay within an e-hail vehicle:\nc(in\u2212ve\u210e)w = (in\u2212ve\u210e)tw\u0304w. (6.12) where (in\u2212ve\u210e) is the weight of in-vehicle travel cost. Inconvenience cost. The inconvenience cost only exists for e-pooling customers. It is proportional to the travel time and distance and can be defined as: c[p](inc)w = 1(inc)tw\u0304w + 2(inc)lw\u0304w. (6.13) where 1(inc) and 2(inc) are weights of time-based and distance-based inconvenience costs, respectively."
        },
        {
            "heading": "6.2.4. Mode choice condition",
            "text": "Define w,\u2200w \u2208  as the minimum mode disutility for OD pair \u2200w \u2208  . At equilibrium, no traveler (i.e.,e-solo, e-pooling) can reduce her modal disutility by unilaterally switching travel modes, i.e., the cost of utilized mode is equal, less than that of unused modes:\nq[m]w\n{\n> 0 \u21d2 U [m]w = w = 0 \u21d2 U [m]w > w ,\u2200w \u2208  , m \u2208 .\nThis equilibrium condition can be formulated as a complementarity problem: 0 \u2a7d U [m]w \u2212 w \u27c2 q [m] w \u2a7e 0,\u2200w \u2208  , m \u2208 . (6.15)"
        },
        {
            "heading": "6.3. Module summary",
            "text": "Summarizing the demand conservation Equ. 6.1 and the mode choice Equs. 6.15, the complementarity problem of Module 3 is denoted as [M3.NCP-CustChoice]: [M3.NCP-CustChoice] Demand conservation: 0 = \u2211\nm\u2208 q[m]w \u2212 qw \u27c2 w free,\u2200w \u2208  . (6.16a)\nMode choice: 0 \u2a7d U [m]w \u2212 w \u27c2 q [m] w \u2a7e 0,\u2200w \u2208  , m \u2208 . (6.16b) Travel disutility: U [e]w = \u2212r [e] w + [e] (wt) \u22c5 \u2211\nv\u2208\u2212 ovw\u0304tvw\u0304 + (se\u2212pas) \u22c5 [c\u0303\n[e](se\u2212pas) w\u0304 + [e] w\u0304 ] + [e] (surp\u2212pas)\n\u2211\n(u,v)\u2208(e)\n\u2211\n\u210e\u2208w (ed\u2212pa)(u,v)\u210e (pa\u2212od) \u210ew (w)[e] vu + (in\u2212ve\u210e)tw\u0304w,\n(6.16c) U [p]w = \u2212r [p] w + [p] (wt) \u22c5 [p] (wt) \u22c5 { \u2211\nk,k\u2260w o(w)[p] w\u0304k\u0304\n\u2211\nv ovw\u0304tvw\u0304 + o\n(w)[p] w\u0304w\n\u2211\nk,k\u2260w\n{\n\u2211\nv ovk\u0304tvk\u0304 + tk\u0304w\u0304\n}\n+ \u2211 k,k\u2260w o(w)[p]w\u0304k\n{\n\u2211\nv ovk\u0304tvk\u0304 + tk\u0304w\u0304\n}}\n+ (se\u2212pas) \u22c5 [c\u0303 [p](se\u2212pas) w\u0304 + [p] w\u0304 ] + [p] (surp\u2212pas)\n\u2211\n(u,v)\u2208(p)\n\u2211\n\u210e\u2208w (ed\u2212pa)(u,v)\u210e (pa\u2212od) \u210ew (w)[p] vu + (in\u2212ve\u210e)tw\u0304w + 1(inc)tw\u0304w + 2(inc)lw\u0304w. (6.16d)\nNodal cost: 0 \u2a7d ovw\u0304 \u27c2 \u2211\nv\u2032\u2208\u2212 zw\u0304v\u2032 \u22c5 ovw\u0304 \u2212 z w\u0304 v + \u2212 vw\u0304 \u2a7e 0,\u2200v \u2208  \u2212, w\u0304 \u2208  +, (6.16e)\n0 \u2a7d \u2212vw\u0304 \u27c2 1 \u2212 ovw\u0304 \u2a7e 0,\u2200v \u2208  \u2212, w\u0304 \u2208  +. (6.16f)\n0 \u2a7d o(w)[p] w\u0304k\u0304 \u27c2 (\n\u2211\nk\u2208 ,k\u2260w y(w)[p] w\u0304k\u0304 + \u2211 k\u2208 y(w)[p]w\u0304k ) \u22c5 o (w)[p] w\u0304k\u0304 \u2212 y(w)[p] w\u0304k\u0304 + (w)[p]\u2212 w\u0304k\u0304 \u2a7e 0,\u2200k\u0304, w\u0304 \u2208  +(p), k \u2260 w \u2208  , (6.16g)\n0 \u2a7d (w)[p] w\u0304k\u0304 \u27c2 1 \u2212 o(w)[p] w\u0304k\u0304 \u2a7e 0,\u2200k\u0304, w\u0304 \u2208  +, k \u2260 w \u2208  , (6.16h)\n0 \u2a7d o(w)[p]w\u0304k \u27c2 ( \u2211 k\u2208 ,k\u2260w y(w)[p] w\u0304k\u0304 + \u2211 k\u2208 y(w)[p]w\u0304k ) \u22c5 o (w)[p] w\u0304k \u2212 y (w)[p] w\u0304k + (w)[p]\u2212 w\u0304k \u2a7e 0,\u2200w\u0304 \u2208  +(p), k\u0304 \u2208  \u2212(p), (6.16i)\n0 \u2a7d (w)[p]w\u0304k \u27c2 1 \u2212 o (w)[p] w\u0304k \u2a7e 0,\u2200w\u0304 \u2208  +(p), k\u0304 \u2208  \u2212(p). (6.16j)"
        },
        {
            "heading": "7. Equilibrium properties",
            "text": "Summarizing the three modules specified in Sections 4-6, including [M1.1.NCP-VehDispatch] (corresponding to Equs. 4.5), [M1.2.NCP-VehPassMatch] (corresponding to Equs. 4.10), [M2.NCP-VehRoute] (corresponding to Equs. 5.1), [M3.NCP-CustChoice] (corresponding to Equs. 6.16). we have a system of coupled NCPs, denoted as [All.NCP-ESys], that describe the equilibrium state where e-platform optimizes vehicle dispatching and vehiclepassenger matching, customers select travel modes, and vehicles select best routes.\nWe will introduce two propositions to prove the existence of equilibrium (Ban et al., 2019). Proposition 1 demonstrates conditions regarding the boundedness of feasible set in [All.NCP-ESys]. In Proposition 2, we first construct a variational inequality (VI) with an unbounded feasible set based on [All.NCP-ESys], and then demonstrate conditions for the solution existence of the proposed VI. The proof of Proposition 1 and 2 is detailed in Appendix A.8. Proposition 1. If \u2203 > 1, s.t. \u2211\nk,k\u2260w z [m] k\u0304w\u0304 + \u2211 k,k\u2260w z [m] w\u0304k\u0304 \u2a7d \u22c5 q[m]w ,\u2200w \u2208  , m \u2208  and the travel time function on a road network tij(x) > 0 is continuous and monotone, then xij , (i, j) \u2208 net and di , i \u2208 net, d \u2208  are bounded.\nProposition 2. If \u2203 > 0, s.t. \u2200q \u2a7e 0 satisfying (7.3) and \u2200 , \u2203 z, s.t. (z,q, ) satisfies (7.1, 7.4) and S \u2212 \u2211\n(u,v)\u2208 zuvtuv \u2a7e , a solution of [All.NCP-ESys] under assumptions in Proposition 1 is then recovered by a variational inequality V (H , ) when \u2192 \u221e. The VI is constructed as:\n[V (H , )]\nH (F ) =\n\u23a7\n\u23aa\n\u23aa\n\u23aa\n\u23aa\n\u23aa\n\u23a8\n\u23aa\n\u23aa\n\u23aa\n\u23aa\n\u23aa\n\u23a9\nCuv + ztuv [ \u2211 (u,v) zuvtuv \u2212 S ]\n+ ,\u2200(u, v) \u2208 \nC (w)uv + y [ \u2211 v y (w) uv \u2212 \u2211 w o uw\u0304[m] q[m]w ] + ,\u2200w \u2208  , (u, v) \u2208 +(m) \u222a \u2212(m)\nU [m]w ,\u2200w \u2208  , m \u2208  tij(x) \u2212 ( di \u2212 d j ),\u2200(i, j) \u2208 (net), d \u2208 \n\u2211 j\u2236(i,j)\u2208(net) x d ij \u2212 \u2211 k\u2236(k,i)\u2208(net) x d ki \u2212 q(i,d),\u2200i \u2208 net, d \u2208 \n\u2211 u zuv \u22c5 ouv \u2212 zuv,\u2200(u, v) \u2208 , u \u2208 \u2212 \u2211\nu y (w) uv \u22c5 o (w) uv \u2212 y (w) uv ,\u2200w \u2208  , (u, v) \u2208 , u \u2208 +(m)\n\u23ab\n\u23aa\n\u23aa\n\u23aa\n\u23aa\n\u23aa\n\u23ac\n\u23aa\n\u23aa\n\u23aa\n\u23aa\n\u23aa\n\u23ad\n is the feasible set of F = (z, y,q, x, , o) and (z, y,q, o) \u2a7e 0 satisfy: \u2211\nv\u2032 zv\u2032u =\n\u2211 v zuv,\u2200u \u2208  (7.1)\n\u2211 v\u2032 y(w)v\u2032u \u2212 \u2211 v y(w)uv = 0,\u2200w \u2208  , u \u2208  +(m) \u222a\u2212(m) (7.2) \u2211 m\u2208 q[m]w = qw,\u2200w \u2208  (7.3)\n\u2211\nv\u2032 zv\u2032u \u2a7e\n\u2211\nw ouw\u0304[m]q [m] w ,\u2200u \u2208  +(m) (7.4)\nywuv \u2a7d zuv,\u2200w \u2208  , (u, v) \u2208  +(m) \u222a \u2212(m) (7.5) ouv \u2a7d 1,\u2200(u, v) \u2208 , u \u2208 \u2212 (7.6) o(w)uv \u2a7d 1,\u2200w \u2208  , (u, v) \u2208 , u \u2208 \n+(m). (7.7) Remark. It is challenging to prove the uniqueness of the equilibrium in [All.NCP-ESys] due to the nonlinearity in the product of decision variables. There are many ways dealing with multiple equilibria. Characterizing a solution set (Di et al., 2013; Di and Liu, 2016) may not work when there exist nonlinearity in the NCP. Another way is to utilize a bi-level model (Ban et al., 2009; Di, 2014; Di et al., 2016; Chen and Di, 2021) where the upper level is to select a risk-averse or risk-neutral equilibrium and the lower level is [All.NCP-ESys], which will be left for future research."
        },
        {
            "heading": "8. Numerical examples",
            "text": "In this section, we will apply [All.NCP-ESys] to the small network (3-node network 2-OD pair) and the Sioux Falls network to demonstrate our model. The numerical results on the small network are in Appendix A.9.\nThe Sioux Falls network includes 24 nodes and 76 links. The topology of the network, node indexes, link indexes, and the link performance functions are downloadable from the github (https://github.com/bstabler/ TransportationNetworks). Parameter values for Sioux Falls network are in Appendix A.10. To solve the coupled system - [All.NCP-ESys], we first generate a layered OD graph in Python3.6 (Algorithm 1) based on OD pairs on road networks. We then combine all the three modules as a large system of NCPs and solve it in GAMS (Ferris, 2009).\nWe would like to investigate three scenarios shown in Table (4). For Scenario 1 (2 ODs), we investigate two cases: travel time is congestion-independent (Case 1) and congestion-dependent (Case 2). For Scenario 2 (6 ODs), we also focus on two cases: search friction is small (Case 1) or large (Case 2). For Scenario 3 (more ODs), we look into the computation time and problem scale regarding the number of OD pairs."
        },
        {
            "heading": "8.1. 2 ODs",
            "text": "For 2 OD pairs (1,20) (indexed as OD 1) and (2,20) (indexed as OD 2), we aim to compare 2 cases: Case 1 where the network links have large capacities and Case 2 where the network links have smaller capacities and thus link travel times are more sensitive to link traffic flow. We deliberately assign different OD demands to these two OD pairs (i.e., q(1,20) = 500, q(2,20) = 200), so that readers can easily distinguish quantities of these two ODs. In addition, it representsan asymmetric demand scenario when OD demands of two ODs are different and matching all the e-pooling orders would not be guaranteed.\nIn both cases, we vary the fare of the e-pooling service while fixing that of the e-solo service. Thus, we define the pooling-solo fare ratio as the ratio of e-pooling relative to e-solo pricing. The higher, the closer the e-pooling fare to the e-solo fare, the fewer orders select e-pooling, and the more vehicles are needed to move the demands.\nCase 1. We plot the OD demand in Fig. 7. In Figs. 7a, x-axis is the e-pooling fare coefficient increasing from 0 to 1, while y-axis represents the OD demands fulfilled by e-pooling for OD (1,20) in blue dashed line and OD (2,20) in red line, respectively. Note that in the fixed total demand case, a decrease in the e-pooling demand indicates an increase in the e-solo demand. That is why we only plot the e-pooling demand. As the pooling-solo fare ratio increases, the\nnumber of e-pooling orders decrease to zero step-size. All orders are e-pooling when its fare is lower than 75% of e-solo for OD (1,20) and 25% of e-solo for OD (2,20), respectively. That being said, if the e-hailing company wants to promote e-pooling, the e-pooling fare discount should be higher than 25% for OD (1,20) or 75% for OD (2,20). Note that the e-pooling fare for OD pair (2,20) is much more sensitive to a discount than that for OD pair (1,20). Thus targeting the origin node 2 is the key. An option is to offer differential discounts to orders originating from nodes 1 and 2. In Fig. 7b, the y-axis indicates the OD demand proportion between e-pooling (in yellow bar) and e-solo (in blue bar) for OD (1,20) (left) and OD (2,20) (right), respectively. Across the x-axis is demands sampled at three e-pooling fare ratios of 0,0.5,1, meaning that the e-pooling fare is 0, half of e-solo, and same as e-solo, respectively. When the ratio is zero, it represents an extreme case that e-pooling service is free. Thus all orders select e-pooling. When the ratio is 0.5, it indicates that e-pooling is half price of e-solo service. All orders from OD (2,20) abandon e-pooling and switch to e-solo entirely. This is because of the high inconvenience cost to pool rides. For OD (1,20), all the orders still select e-pooling due to the half fare despite of a higher pooling cost. Undoubtedly, When the ratio is one, in other words, when e-pooling has no difference from e-solo, all customers switch to e-solo due to high inconvenience cost of sharing rides with others.\nTo compare the total and itemized disutility of two travel modes, we plot the modal disutility, fare, and supplydemand surplus cost in Figs. 8. In Fig. 8a, the x-axis is the pooling-solo fare ratio, and the y-axis is the customer disutility. The disutility of selecting e-solo for OD (1,20) is represented by a dotted blue line with plus markers, that of selecting e-pooling for OD (1,20) by a dotted orange line with cross markers, that of selecting e-solo for OD (2,20)\nby a solid red line with plus markers, and that of selecting e-pooling for OD (2,20) in a solid purple line with cross markers. As the pooling-solo fare ratio increases, disutilities of travel modes for both OD pairs increase generally. In particular, the disutilities of e-pooling increase faster than that of e-solo, because the pooling-solo fare ratio impacts the e-pooling fare directly. The disutility of e-solo also rises because of the indirect effect of the increasing number of vehicles on roads. For OD (1,20), the e-pooling disutility is lower than the e-solo one when the pooling-solo fare ratio is less than 0.75. Similarly, for OD (2,20), the e-pooling disutility is lower than that of e-solo when the ratio is less than 0.25. These trends are consistent with those in modal demands analyzed above. Fig. 8b demonstrates fare for each mode. For OD (1,20), the e-solo fare is indicated in a dotted blue line with plus markers and that of e-pooling is in a dotted orange line with cross markers, respectively. For OD (2,20), the e-solo fare is in a solid red line with plus markers and e-pooling is shown in a solid purple line with cross markers, respectively. As the pooling-solo fare ratio grows, the fares of e-pooling for both OD pairs go up, while those of e-solo remain constant. In other words, the e-pooling service becomes more and more expensive as the ratio increases and loses its competitiveness over the e-solo service, which repels more passengers to e-solo. In Fig. 8c, we examine the extra waiting time of e-pooling riders to be matched with drivers, represented by the supply-demand surplus that constitutes part of the mode choice disutility. For e-solo, the surplus costs at origins 1 and 2 are represented by blue dotted and red solid lines with circular markers, respectively. The costs increase as the pooling-solo fare ratio increases, and that at node 1 increases at a faster rate than that at node 2. This is because more passengers select e-solo, and the e-solo supply is less than the demand, and thus the \u201csurge price\" increases for the e-solo service. For e-pooling, the surplus costs at origins 1 and 2 are represented by orange dotted and purple solid lines with cross markers, respectively. The surplus cost at origin 2 is always zero, meaning that the e-pooling vehicle size is always larger than the demand. When the pooling-solo fare ratio is lower than 0.25, surplus cost is non-zero and is reduced to zero when the ratio bypasses 0.25. This is because of the drop in the e-pooling demand relative to the supply.\nTo examine the systematic impact of pricing, we inspect DHM and total fleet size in Fig. 9a and equilibrium travel time in Fig. 9b. In Fig. 9a, the dashed blue line with plus markers represents DHM (the left y-axis) and the dotted red line represents total fleet size (the right y-axis). Both increase step-wise, the first one at 0.25 and the second one at 0.75, as the pooling-solo fare ratio increases. This is because the passengers\u2019 modal switch from e-pooling to e-solo. The more vehicles on road, the higher DHM and the larger fleet size are. In Fig. 9b, the x-axis is two OD indices and the y-axis is the equilibrium travel time. Each bar represents the equilibrium travel time at one selected pooling-solo fare ratio. The equilibrium travel time reflects the traffic congestion level. All scenarios with three fare ratios share the same equilibrium travel time for the same OD. That means that even when every passenger uses e-solo service, it does not worsen the network traffic condition and traffic still runs at free flow. That leads us to move on to Case 2 when all the link capacities are compromised by a factor of 50, which makes modal utilities more sensitive to traffic congestion and travel time. Case 2. We discount the capacity of each link by 50 and see how a congestion prone road network would impact people\u2019s mode choice and performances. A congestion prone road network refers to one that has limited capacity and is thus sensitive to congestion. In other words, a few additional vehicles on a link can trigger a much higher delay. Our hypothesis is that due to the longer travel time on roads, passengers are more sensitive to traffic congestion and are thus prone to pool rides.\nThe OD demands (in Fig. 10), total and itemized disutility (in Fig. 11), and performance measures (in Fig. 12) correspond to those presented in Case 1 sequentially. Fig. 10 corresponds to Fig. 7. There are two major differences between Case 1 and Case 2: (1) When p \u2a7d 0.5, the total demand fulfilled by the e-pooling services in Case 2 (withcongestion) is lower than that in Case 1 (without congestion). This is because the travel time of an e-pooling driver heading to pick up the second passenger increases in a congested network, which leads to the decreasing usage of e-pooling services. (2) When p \u2a7e 0.5, the curve of OD demands served by e-pooling in Case 2 decreases slower thanthat in Case 1. This is because the total travel disutility is more sensitive to traffic congestion and less on fare. The more people who select e-solo, the more severe the traffic congestion becomes.\nFig. 11 corresponds to Fig. 8. In Fig. 11a, the utilities of both e-solo and e-pooling increase as the pooling-to-solo fare ratio increases. So is fare in Fig. 11b. Such a trend is in contrast to that in Case 1 (without congestion) when only pooling utilities increase. Compared to Case 1, the supply-demand surplus cost of e-solo service in Case 2 significantly increases (Fig. 11c) when p \u2a7e 0.75. This is because, as the pooling-to-solo fare ratio increases, more vehicles aredispatched to serve the growing e-solo orders and thus incur higher congestion cost and as a result, a relatively lower supply because vehicles have to spend more time on roads.\nFig. 12 corresponds to Fig. 9. In Fig. 12a, DHM and total fleet size increase faster as the pooling-to-solo fare ratio increases, compared to Case 1 (without congestion). In Fig. 12b, equilibrium travel time increases as the pooling-tosolo fare ratio increases for each OD pair. In particular, the equilibrium travel time at the pooling-to-solo fare ratio of one is much higher than when the ratio is less one, which is caused by the increasing vehicles on roads."
        },
        {
            "heading": "8.2. 6 ODs",
            "text": "For 6 OD pairs (1, 18), (1, 20), (2, 18), (2, 20), (3, 18) and (3, 20), we vary the weight of search friction (se) in orderto compare 2 cases: Case 1 with a small search friction coefficient (se) = 1 and Case 2 with a large search frictioncoefficient (se) = 10. The demands of all 6 OD pairs are the same as 300.\nCase 1. We plot the vehicle flow when the weight of search friction is (se) = 1. In Fig. 13, the traffic flow on theroad map (blue links) represents the vehicle flow on the Sioux Falls network. Origins {1, 2, 3} are red solid dots and destinations {18, 20} are light red ones. Intermediate nodes on the Sioux Falls network are denoted by light blue dots. The 3D arrows (green and grey arrows) represent the vehicle OD flow in the OD graph. The green one is the vehicle OD flow dispatched along OD sequences. The grey one is the rebalancing flow from destinations to origins. Note that the vehicle OD flow in the OD graph (3D arrows) can be projected onto the Sioux Falls network. For example, in the OD graph, 432 vehicles are dispatched from origin 2 to origin 1 along the link (2 \u2192 1). 650 vehicles are dispatched from origin 2 to origin 3 along the link (2 \u2192 1 \u2192 3). Therefore, the vehicle flow on the link (2 \u2192 1) is 432 + 650 = 1082, denoted by the blue arrow from node 2 to 1 on the Sioux Falls network.\nWe inspect details of the vehicle OD flow and analyze the OD sequences. Vehicle Dispatch (green arrows). E-pooling:\n\u2022 2 \u2192 1 \u2192 18 \u2192 20 : 432 vehicles are dispatched from node 2 to node 1 in order to fulfill demands of OD pairs: (1,18), (1,20) ,(2,18) and (2,20). In other words, vehicles pick up one passenger at node 2, move to node 1 along the link (2 \u2192 1) on the network and pick up the other passenger at node 1. After visiting origins 2 and 1, vehicles move to node 18 along the link (1 \u2192 3 \u2192 12 \u2192 11 \u2192 10 \u2192 16 \u2192 18) on the Sioux Falls network, and drop off passengers whose destination is node 18. Vehicles then move to node 20 along the link (18 \u2192 20) and drop off passengers whose destination is node 20.\n\u2022 2 \u2192 3 \u2192 20 : 650 vehicles are dispatched from node 2 to node 3 in order to fulfill demands of OD pairs: (2,20) and (3,20). In other words, vehicles pick up one passenger at node 2, move to node 3 along the link (2 \u2192 1 \u2192 3) on the network and pick up the other passenger at node 3. After visiting origins 2 and 3, vehicles move to node 20 along the link (3 \u2192 12 \u2192 13 \u2192 24 \u2192 21 \u2192 20) on the Sioux Falls network, and drop off all passengers at node 20.\n\u2022 1 \u2192 3 \u2192 20 : 168 vehicles are dispatched from node 1 to node 3 in order to fulfill demands of OD pairs: (1,20) and (3,20). Vehicles pick up one passenger at node 1, move to node 3 along the link (1 \u2192 3) on the network and pick up the other passenger at node 3. After visiting origins 1 and 3, vehicles move to node 20 along the link (3 \u2192 12 \u2192 13 \u2192 24 \u2192 21 \u2192 20) on the Sioux Falls network, and drop off all passengers at node 20.\n\u2022 2 \u2192 18 \u2192 20 : There are 442 vehicles dispatched from node 2 in order to fulfill demands of OD pairs: (2,18) and (2,20). At node 2, vehicles pick up passengers whose destinations are node 18 and 20. After visiting origin 2, vehicles first move to node 18 along links (2 \u2192 6 \u2192 8 \u2192 16 \u2192 18) and (2 \u2192 6 \u2192 8 \u2192 7 \u2192 18) on the Sioux Falls network, and drop off passengers at node 18. Vehicles then move to node 20 along the link 18 \u2192 20 and drop off the remaining passengers.\n\u2022 2 \u2192 20 \u2192 18 : Similar to vehicles in the OD sequence 2 \u2192 18 \u2192 20, 1312 vehicles are dispatched from node 2 in order to fulfill demands of OD pairs: (2,18) and (2,20). These vehicles choose to first drop off passengers at destination 20 and then drop off the remaining passengers at destination 18.\nE-solo: \u2022 3 \u2192 18 : There are 149 vehicles dispatched from node 3 to 18 to fulfill the travel demand of OD pair (3,18).\nThese vehicles only visit one OD pair in the OD graph and pick up one rider during the trip. We summarize our findings about vehicle dispatch: at origin 1, the majority of travel demand (432 out of 600) is fulfilled by vehicles dispatched from origin 2 and the remaining passengers are picked up by vehicles dispatched from origin 1. At origin 2, all travel demand is fulfilled by vehicles dispatched from origin 2. At origin 3, the majority of travel demand is fulfilled by vehicles dispatched from origin 2 and the remaining demand is fulfilled by the e-solo service where vehicles are dispatched from origin 3 to destination 18.\nRebalancing Flow (grey arrows): \u2022 20 \u2192 2: 2836 vehicles at destination 20 plan to pick up passengers at origin 2 (i.e., travel demands of OD pair\n(2, 18) and (2, 20)). These vehicles are dispatched from node 20 to node 2 along the link (20 \u2192 18 \u2192 7 \u2192 8 \u2192 6 \u2192 2) on the Sioux Falls network. It is shown that the majority of vehicles at destinations are dispatched to node 2, which incurs heavy traffic at this origin.\n\u2022 20 \u2192 3: 149 vehicles at destination 20 plan to pick up passengers at origin 3 (i.e., travel demands of OD pair (3, 18) and (3, 20)) and they are dispatched from node 20 to node 3 along the link (20 \u2192 21 \u2192 24 \u2192 13 \u2192 12 \u2192 3).\n\u2022 18 \u2192 1: 168 vehicles at destination 18 are dispatched to origin 1 along the link (18 \u2192 16 \u2192 10 \u2192 11 \u2192 12 \u2192 3 \u2192 1) in order to pick up passengers at node 1.\nCase 2. We now investigate another case when cost coefficient (se) of search friction is changed from 1 to 10. Thevehicle OD flow is demonstrated in Appendix A.10. By making a comparison of Case 1 and 2, we find that: When incurring higher search friction, the number of vehicles in e-pooling service decreases while the number of vehicles in e-solo service increases. To better understand this, we plot OD demands by different modes when varying search friction for drivers in Fig. 14. Left bars demonstrate the scenario when the cost coefficient of search friction is 1 and right bars represent the scenario when the cost coefficient of search friction is 10. It is shown that when search friction increases, the usage of e-pooling service decreases."
        },
        {
            "heading": "8.3. More ODs",
            "text": "Figs. 15 demonstrates the computational time against the problem size represented by the OD pair size."
        },
        {
            "heading": "8.4. Implication for policies and planning",
            "text": "Relying on the proposed equilibrium framework that depicts the interaction between e-hailing operation, customer modal choice, and network congestion, we hope to shed light on policy making and planning for more efficient pooling service.\nSummarizing findings from all the numerical experiments, we find that high e-pooling price and high matching friction could lead to higher e-solo demands, which makes roads more congested and in turn hurt e-pooling demands further. To promote pooling service, policy makers and planners should consider taking a series of countermeasures, including subsidy to pooling customers or to e-hailing platforms, congestion pricing to e-solo customers, and regulation. In particular, in a competitive e-hailing market with multiple companies, one could consider expanding its fleet sizing for a larger market share. However, an increase in fleet size could result in rising deadhead miles and system travel cost in a transportation system, which in turn leads to worsening congestion and emission. Capping e-hailing companies\u2019 fleet size could be one instrument for regulators (Emma, 2018; Tarduno, 2021).\nOn the other hand, this paper could offer insights into the e-hailing operation strategies, such as improvingmatching mechanism and optimizing pricing and fleet sizing while accounting for congested networks and customer choice."
        },
        {
            "heading": "9. Conclusions and future research",
            "text": "This paper proposes a unified network equilibrium framework that integrates 3 modules, including travelers\u2019 modal choice between e-pooling and e-solo services, e-platforms\u2019 decision on vehicle dispatching and driver-passenger matching, and network congestion. The first two components are coupled via passengers\u2019 waiting cost computed from a market clearance mechanism, and the latter two are coupled via equilibrium travel time. To model e-platforms\u2019 decision on vehicle dispatching and driver-passenger matching, the challenge lies in the permutation of potentially pooled OD pairs and the order of pick-up and drop-off among these two pairs. The existing literature usually predetermines a combination of OD pairs and fixes the sequence of chaining OD pairs, which limits the flexibility of the pooling service. To address the challenge, this paper develops a layered OD graph over which vehicle and passenger OD flows are modeled and computed. The minimum-cost circulation network flow problems are formulated to solve optimal vehicle OD flows and passenger OD flows, respectively. The total model is tested on a small-sized network and the Sioux Falls network based on the performance measures including deadhead miles, system travel time, and total fleet sizing. Sensitivity analysis is performed on parameters associated with fleet sizing, service pricing, and search friction. We demonstrate the performance of our model on a much larger OD graph. In particular, on the small network, we extend our model to two competing TNCs in the market and evaluate the impact of fleeting sizing on each company\u2019s market share. Our key finding is, high e-pooling price and high matching friction could lead to more e-solo customers, which makes roads more congested and in turn hurt e-pooling demands due to the increasing time of seeking multiple riders. Government subsidies or congestion pricing could help promote pooling and mitigate congestion.\nThis paper will be generalized in the following directions: (1) relax the assumption of fixed demands for e-hailing service by incorporating private cars into the framework, so that the unmet orders switch to private driving. And relax the assumption of fixed demands for each OD pair by introducing a demand curve for each OD as a function of its average total travel cost. (2) integrate emerging shared travel modes, including ad hoc ridesharing of personal vehicles. (3) pooling more than two rides and providing a on-demand shuttle like service will be considered using more complex OD graphs. (4) incorporate drivers\u2019 choices including working hours. TNC service providers, in other words, drivers, are a crucial type of game players whose entry choice into the TNC market can influence the fleet sizing, customers\u2019 waiting time and mode choice. Thus incorporation of the driver side will complete the game-theoretic picture of the TNC ecosystem."
        },
        {
            "heading": "Acknowledgements",
            "text": "This work is sponsored by NSF under CAREER award number CMMI-1943998."
        },
        {
            "heading": "Appendix A. Appendices",
            "text": ""
        },
        {
            "heading": "Appendix A.1. Performance measures",
            "text": "We propose the following countermeasures to describe the performance of an e-hailing system:\nDeadhead miles: DHM \u2261 \u2211 v\u2208\u2212 \u2211 u\u2208+ lvuz u v + \u2211 u\u2208+ \u2211 u\u2208\u2212 luuz u u, (A.1a)\nSystem travel cost: STC \u2261 \u2211 v,u\u2208 (m) tvu\n(\n\u2211\nw\u2208\n\u2211\nm\u2208 y(w)[m]vu\n)\n, (A.1b)\nTotal vehicle-hour: TVH \u2261 \u2211 v\u2208\u2212 \u2211 u\u2208+ tvuz u v + \u2211 v\u2208\u2212(m) \u2211 u\u2208+(m) \u2211 m\u2208 tvuz [m] vu , (A.1c)\nDHM measures the miles traveled by vacant e-hailing vehicles. STC measures the total hours consumed by vehicles including service vehicle-hour, which is the total hours both occupied and vacant vehicles spend on road. TVH measures the total service vehicle hours, which cannot exceed the fleet size."
        },
        {
            "heading": "Appendix A.2. Traffic entities on roads",
            "text": "In an e-hailing system, we will first introduce how passengers and vehicles move along a road network. Assume there is a set of e-hailing service providers that offers both e-solo and e-pooling modes in the market. The network flows include the passenger flow selecting e-solo or e-pooling modes from the provider set and its induced vehicle flow."
        },
        {
            "heading": "Appendix A.2.1. Passenger flow",
            "text": "Prior to a trip, one traveler selects travel mode with the minimum travel disutility: e-solo or e-pooling. These travel modes are denoted as  = {\nec , pc\n}\n, where ec denotes being an e-solo passenger served by the c-th provider and pcdenotes being an e-pooling passenger served by the c-th provider. An e-solo passenger is picked up at her origin and directly moved along with the e-solo vehicle to be dropped off at her destination. An e-pooling passenger is picked up at her origin. If she is the first order in the vehicle, she is moved to a second origin with the e-pooling vehicle to pick up a second passenger order. After the second passenger is picked up, she is either dropped off at her destination and has to visit the destination of the second passenger before being dropped off at her own destination. If she is the second order in the vehicle meaning that there is already a passenger inside the vehicle, she is moved to either her destination or the first passenger\u2019s destination before being dropped off. Remark. Throughout the paper, we drop the e-hailing provider subscript c for notation simplicity. In other words, our mathematical framework is primarily focused on one e-hailing provider, but it can be easily generalized to multiple providers without loss of generality. The generalized model for multiple providers can be found in Appendix A.9. We will also demonstrate it on a numerical example in Sec. 8."
        },
        {
            "heading": "Appendix A.2.2. Vehicle flow",
            "text": "Passenger flows induce vehicle flows and thus traffic congestion. After an vacant e-hailing vehicle is matched an order, it selects the paths with minimum travel time to rebalance itself for pick-up. Occupied vehicle flows consist of e-solo and e-pooling flows. For a vacant e-solo vehicle, once it picks up an order and thus becomes occupied, it aims to move to the destination of the order along the paths with minimum travel time. For a vacant e-pooling vehicle, once it knows the dispatching and matching plan, it needs to determine in what sequence to visit two origin nodes, so are two destination nodes. The routing plan aims to find the paths with minimum travel time connecting these two OD pairs.\nIn summary, the vehicle flow on roads (or en route) include the occupied e-solo flow (with a passenger occupancy of one), the 1-passenger occupied e-pooling flow (with a passenger occupancy of one), the 2-passenger occupied flow (with a passenger occupancy of two), and vacant rebalancing flow (with a passenger occupancy of zero), respectively. E-hailing vehicle and passenger flows are summarized in Appendix A.3."
        },
        {
            "heading": "Appendix A.3. Table of vehicle and passenger flows",
            "text": ""
        },
        {
            "heading": "Appendix A.4. Relation between an OD graph and a road network",
            "text": "Both an OD graph and a road network consist of nodes, links, flows, and ODs, but carry different meanings. To clarify, we compare their differences in Table A.6.\nComputation wise, an OD graph only depends on the number of OD pairs, in other words, the cardiality ofaug . Thus, it is agnostic of a real transportation network topology. That being said, as long as two road networks share the same number of OD pairs, the topology of their OD graphs remains the same. Difference between a vehicle and a passenger OD graph. Vehicle OD graphs are closed, meaning that vehicle flows circulate between origins and destinations without leaving the graphs. Thus, the coupled e-solo and e-pooling vehicle OD graph is closed, assuming that no e-hailing vehicle would drop out of the system. Solving vehicle flows is formulated as a minimum cost multi-commodity circulation problem as a generalization of network flow problems. In contrast, passenger OD graphs are open-ended and those across solo and pooling modes are only connected at virtual origins when a total travel demand is split between e-hailing modes. Thus, e-solo and e-pooling passenger OD graphs are only connected at origin nodes. Solving a passenger flow in each layer is formulated as a minimum cost network flow problem."
        },
        {
            "heading": "Appendix A.5. Preliminaries on minimum-cost circulation network flow problem (MCCNFP)",
            "text": "Network flow problems, a branch of combinatorial optimization, solve optimal edge flows on a graph that respect flow conservation and other designated constraints. In particular, the minimum-cost circulation network flow problem\n(MCCNFP) aims to find a set of edge flows circulating on a graph that can minimize the total flow cost (Ahuja et al., 1993). Given a network represetend by a directed graph  = ( ,), where each edge (v, u) \u2208  is associated with flow zvu and cost Cvu. Denote z and C as the flow and cost vectors over the graph, respectively. The flow z is boundedbelow by bL and above bU . The total cost is CT \u22c5 z. In summary, the MCCNFP is formulated as:\nmin CT \u22c5 z\ns.t. \u2211\nv\u2236(u,v)\u2208 zvu \u2212\n\u2211 k\u2236(u,k)\u2208 zuk = 0,\u2200u \u2208  (circulation flow conservation),\nbL \u2264 z \u2264 bU (capacity constraint). In Sec. 4, we will specify the graph, edge cost, and capacity bounds for the problem formulation of Module 1."
        },
        {
            "heading": "Appendix A.6. 3-node network with 2-OD pair",
            "text": "We demonstrate Module 1 on a 3-node network with 2-OD pair (Fig. 4). The layered OD graph corresponding to the 3-node network with 2-OD pair is shown in Fig. A.16.\nMathematically, the vehicle dispatching module on the OD graph is: min\nz1\u03041 ,z 2\u0304 1 ,z 1\u0304 2 ,z 2\u0304 2\nC 1\u03041z 1\u0304 1 + C 2\u0304 1z 2\u0304 1 + C 1\u0304 2z 1\u0304 2 + C 2\u0304 2z 2\u0304 2 + min\nz[e] 1\u03041 ,z[e] 2\u03042 ,z[p] 1\u03041 ,z[p] 2\u03042 ,z[p] 1\u03042\u0304 ,z[p] 2\u03041\u0304 ,z[p] 1\u03042 ,z[p] 2\u03041 ,z[p]12 ,z [p] 21\nC [e] 1\u03041 z[e] 1\u03041 + C [e] 2\u03042 z[e] 2\u03042\n+ C [p] 1\u03041 z[p] 1\u03041 + C [p] 2\u03042 z[p] 2\u03042 + C [p] 1\u03042\u0304 z[p] 1\u03042\u0304 + C [p] 2\u03041\u0304 z[p] 2\u03041\u0304 + C [p] 1\u03042 z[p] 1\u03042 + C [p] 2\u03041 z[p] 2\u03041 + C [p]12 z [p] 12 + C [p] 21 z [p] 21 ,\ns.t. (\u2605) z1\u03041\u0304[p] = z [p] 1\u03042\u0304 , z2\u03042\u0304[p] = z [p] 2\u03041\u0304 ,\n(\u25cb) z[p] 1\u03042\u0304 = z[p] 2\u03041 + z[p] 2\u03042 , z[p] 2\u03041\u0304 = z[p] 1\u03041 + z[p] 1\u03042 ,\n(\u2605) z[p] 1\u03041 + z[p] 2\u03041 = z[p]12 , z [p] 1\u03042 + z[p] 2\u03042 = z[p]21 ,\n(\u25ad) z[p]12 = z2[p]2, z [p] 21 = z1[p]1,\n(\u25b3) z1\u03041\u0304[p] + z [p] 2\u03041\u0304 \u2a7e q[p]1 , z2\u03042\u0304[p] + z [p] 1\u03042\u0304 \u2a7e q[p]2 ,\n(\u2b26) z1[p]1 + z [p] 12 \u2a7e q [p] 1 , z2[p]2 + z [p] 21 \u2a7e q [p] 2 ,\n(\u25b3) z1\u03041\u0304[e] = z [e] 1\u03041 , z2\u03042\u0304[e] = z [e] 2\u03042 , z[e] 1\u03041 = z1[e]1, z [e] 2\u03042 = z2[e]2, z1\u03041\u0304[e] \u2a7e q [e] 1 , z2\u03042\u0304[e] \u2a7e q [e] 2 ,\n(+) z1\u03041 + z 1\u0304 2 = z1\u03041\u0304[p] + z1\u03041\u0304[e] , z 2\u0304 1 + z 2\u0304 2 = z2\u03042\u0304[p] + z2\u03042\u0304[e] , z1[e]1 + z1[p]1 = z 1\u0304 1 + z 2\u0304 1, z2[e]2 + z2[p]2 = z 1\u0304 2 + z 2\u0304 2,\nz1\u03041\u0304[p] + z1\u03041\u0304[e] + z2\u03042\u0304[p] + z2\u03042\u0304[e] = z1[e]1 + z1[p]1 + z2[e]2 + z2[p]2.\nThe vehicle-passenger matching module on the OD graph is: min\ny(1)[p] 1\u03042\u0304 ,...,y(2)[p]12\n(in\u2212ve\u210e){t1\u03042\u0304y (1)[p] 1\u03042\u0304 + t2\u03041\u0304y (2)[p] 2\u03041\u0304 + t21y (1)[p] 21 + t12y (2)[p] 12 + t1\u03041(y (1)[p] 1\u03041 + y(2)[p] 1\u03041 ) + t2\u03042(y (1)[p] 2\u03042 + y(2)[p] 2\u03042 ) + t1\u03042(y (1)[p] 1\u03042 + y(2)[p] 1\u03042 )\n+ t2\u03041(y (1)[p] 2\u03041 + y(2)[p] 2\u03041 )} + c[p](wt) 1\u0304 (y(1)[p] 1\u03042\u0304 + y(1)[p] 1\u03041 + y(1)[p] 1\u03042 ) + c[p](wt) 2\u0304 (y(2)[p] 2\u03041\u0304 + y(2)[p] 2\u03041 + y(2)[p] 2\u03042 ),\n(\u2605) y(1)[p] 1\u03042\u0304 + y(1)[p] 1\u03041 + y(1)[p] 1\u03042 = q[p]1 , y (2)[p] 2\u03041\u0304 + y(2)[p] 2\u03041 + y(2)[p] 2\u03042 = q[p]2 ,\n(\u2605) y(1)[p] 2\u03041 + y(1)[p] 1\u03041 + y(1)[p]21 = q [p] 1 , y (2)[p] 1\u03042 + y(2)[p]12 + y (2)[p] 2\u03042 = q[p]2 ,\n(\u25cb) y(1)[p] 1\u03042\u0304 = y(1)[p] 2\u03041 + y(1)[p] 2\u03042 , y(2)[p] 2\u03041\u0304 = y(2)[p] 1\u03041 + y(2)[p] 1\u03042 ,\n(\u25cb) y(1)[p]21 = y (1)[p] 2\u03042 + y(1)[p] 1\u03042 , y(2)[p]12 = y (2)[p] 2\u03041 + y(2)[p] 1\u03041 ,\n0 \u2a7d y(2)[p] 2\u03041\u0304 \u2a7d z[p] 2\u03041\u0304 , 0 \u2a7d y(1)[p] 1\u03042\u0304 \u2a7d z[p] 1\u03042\u0304 , 0 \u2a7d y(1)[p]21 \u2a7d z [p] 21 , 0 \u2a7d y (2)[p] 12 \u2a7d z [p] 12 ,\n0 \u2a7d y(1)[p] 1\u03041 , y2\u0304[p] 1\u03041 \u2a7d z[p] 1\u03041 , 0 \u2a7d y(1)[p] 2\u03042 , y(2)[p] 2\u03042 \u2a7d z[p] 2\u03042 , 0 \u2a7d y(1)[p] 1\u03042 , y(2)[p] 1\u03042 \u2a7d z[p] 1\u03042 , 0 \u2a7d y(1)[p] 2\u03041 , y(2)[p] 2\u03041 \u2a7d z[p] 2\u03041 ."
        },
        {
            "heading": "Appendix A.7. Derivation of complementarity conditions for Equ. 6.6",
            "text": "The formulation of complementarity conditions (Equ. 6.6) are shown as follows: The denominator in ovw\u0304 can be zero when there is no vacant vehicle flowing into w\u0304, which causes the waiting cost tobe indefinite. To prevent the denominator from being zero, we propose to solve ovw\u0304 using a quadratic program:\novw\u0304 \u2261 zw\u0304v \u2211\nv\u2032\u2208\u2212 z w\u0304 v\u2032\n= arg min o\u2208[0,1]\n\u23a7\n\u23aa\n\u23a8\n\u23aa\n\u23a9\n\u2211 v\u2032\u2208\u2212 z w\u0304 v\u2032\n2 \u22c5 o2 \u2212 zw\u0304v \u22c5 o\n\u23ab\n\u23aa\n\u23ac\n\u23aa\n\u23ad\n. (A.4)\nTo solve the above program defined in Equ. A.4, we formulate a Lagrangian function as: L(\u22c5) = \u2211 v\u2032\u2208\u2212 z w\u0304 v\u2032\n2 \u22c5 o 2 \u2212\nzw\u0304v \u22c5 o \u2212 \u2212 vw\u0304 \u22c5 (1 \u2212 o). It can be solved by the following KKT conditions:\n)L )o = \u2211 v\u2032\u2208\u2212 zw\u0304v\u2032 \u22c5 o \u2212 z w\u0304 v + \u2212 vw\u0304 = 0, (A.5a)\no \u2a7e 0, (A.5b) 1 \u2212 o \u2a7e 0, \u2212vw\u0304 \u2a7e 0, \u2212 vw\u0304 \u22c5 (1 \u2212 o) = 0. (A.5c)\nSummarizing these KKT conditions, we get Equ. 6.6."
        },
        {
            "heading": "Appendix A.8. Solution existence",
            "text": "Before proving Proposition 1 and 2, we introduce theorems and lemmas to better prepare for the proof. Theorem 1. (Nagurney, 2008) In a finite-dimensional variational inequality problem V (H, ), if  is a compact convex set and H(F ) is continuous on  , then V (H, ) has at least one solution.\nTheorem 2. (Nagurney, 2008) V (H, ) has a solution if and only if there exists a bound  > 0 and a solution of"
        },
        {
            "heading": "V (H, ), denoted by \u2217, satisfies: ||\u2217|| < .",
            "text": "Lemma 1. (Cottle et al., 2009) Consider the following mixed complementarity conditions: 0 \u2a7d 1 \u27c2 G( 1) + AT 2 + BT 3 \u2a7e 0 2 free \u27c2 C 1 \u2212 E = 0 0 \u2a7d 3 \u27c2 D 1 \u2212 F \u2a7e 0\nwhere, G is continuous. Let { k1 , k2 , k3} be a sequence of solutions corresponding to the convergent sequence {(Ek, F k)} with limk\u2192\u221e Ek = E\u221e and limk\u2192\u221e F k = F\u221e. If limk\u2192\u221e k1 = \u221e1 , then there exists ( \u221e2 , \u221e3 ) suchthat ( \u221e1 , \u221e2 , \u221e3 ) is a solution corresponding to (E\u221e, F\u221e). Proof of Proposition 1\nProof. \u2211 k,k\u2260w z [m] k\u0304w\u0304 + \u2211 k,k\u2260w z [m] w\u0304k\u0304 \u2a7d \u22c5 q[m]w implies that the dispatched vehicle flow in the OD graph is bounded by travel demand qw,\u2200w \u2208  . Therefore, the vehicle flow on the road network is also bounded. We have xij \u2a7d \u22c5 \u2211\nw\u2208 qw,\u2200(i, j) \u2208 net and di \u2a7d \u2211 (i,j)\u2208net tij( \u22c5 \u2211 w\u2208 qw),\u2200i \u2208 net, d \u2208  . The network flow and nodepotential are bounded. Proof of Proposition 2\nProof. Note that the coupled system consists of different modules. We first obtain the whole mixed complementarity problem (MCP) formulation of [All.NCP-ESys] as follows: In the vehicle layer, we have\n\u2211\nw\u2208 zw\u0304w\u0304[p] =\n\u2211\nw\u2208\n\u2211 k\u2236k\u2260w z[p] w\u0304k\u0304 = \u2211 w\u2208 \u2211 k\u2236k\u2260w z[p] k\u0304w\u0304 = \u2211 w\u2208 \u2211 k z[p]w\u0304k = \u2211 w\u2208 \u2211 k z[p] k\u0304w\n= \u2211\nw\u2208\n\u2211 k\u2260w z[p]wk = \u2211 w\u2208 \u2211 k\u2260w z[p]kw = \u2211 w\u2208 zw[p]w\nSimilarly,\u2211w\u2208 zw\u0304w\u0304[e] = \u2211 w\u2208 zw[e]w holds. Therefore, we have \u2211\nm\u2208\n\u2211\nw\u2208 zw\u0304w\u0304[m] =\n\u2211\nw\u2208 zw\u0304w\u0304[p] +\n\u2211\nw\u2208 zw\u0304w\u0304[e] =\n\u2211\nw\u2208 zw[p]w +\n\u2211\nw\u2208 zw[e]w =\n\u2211\nm\u2208\n\u2211\nw\u2208 zw[m]w\nIt means the total flow conservation on virtual nodes holds if the flow conservation on origins and destinations holds. Accordingly, in [M1.1.NCP-VehDispatch], vehicle flow constraints can be generalized as the flow conservation on each node over the layered OD graph. Mathematically,\n\u2211\nv\u2032 zv\u2032u =\n\u2211 v zuv,\u2200u \u2208  (A.6)\nWe look into the demand constraint: q[p]w \u2a7d zw\u0304w\u0304[p] + \u2211\nk\u0304\u2208+(p),k\u2260w z[p] k\u0304w\u0304 = \u2211 k\u2236k\u2260w z[p] w\u0304k\u0304 + \u2211 k\u2208\u2212(p),k\u2260w z[p]w\u0304k + z [p] w\u0304w\n= \u2211 k\u2236k\u2260w (z[p] k\u0304w + z[p],w k\u0304k ) + \u2211 k\u2208\u2212(p),k\u2260w z[p]w\u0304k + z [p] w\u0304w\n= \u2211 k\u2236k\u2260w z[p] k\u0304w + z[p]w\u0304w + \u2211 k\u2260w (z[p]w\u0304k + z [p],w k\u0304k )\n= \u2211 k\u2208\u2212(p),k\u2260w z[p]wk + \u2211 k\u2260w z[p]kw =\n\u2211 k\u2208\u2212(p),k\u2260w z[p]wk + zw[p]w\nIt means that in the layered OD graph, the demand constraint at destinations holds if the demand constraint at origins and flow conservation at nodes hold. In [M1.1.NCP-VehDispatch], demand constraints are generalized as:\n\u2211 k,k\u2260w z[m] k\u0304w\u0304 + \u2211 k,k\u2260w z[m] w\u0304k\u0304 \u2212 q[m]w \u2a7e 0,\u2200w \u2208  , m \u2208  (A.7)\nTherefore, we reformulate [M1.1.NCP-VehDispatch] as: 0 \u2a7d zuv \u27c2 Cuv + u \u2212 v + fleettuv \u2212 v \u2a7e 0,\u2200(u, v) \u2208 \n0 \u2a7d fleet \u27c2 S \u2212 \u2211\n\u2200(u,v)\u2208 zuvtuv \u2a7e 0\nu free \u27c2 \u2211\nv\u2032 zv\u2032u \u2212\n\u2211\nv zuv = 0,\u2200u \u2208 \n0 \u2a7d u \u27c2 \u2211\nv\u2032 zv\u2032u \u2212\n\u2211\nw ouw\u0304[m]q [m] w \u2a7e 0,\u2200u \u2208  +(m).\nIn the passenger layer, we have\nq[p]w = y (w)[p] w\u0304w + \u2211\nk\u2208 ,k\u2260w\n[\ny(w)[p] w\u0304k\u0304 + y(w)[p]w\u0304k ] = y(w)[p]w\u0304w + \u2211\nk\u2208 ,k\u2260w\n[\ny(w)[p] k\u0304w + y(w)[p] k\u0304k + y(w)[p]w\u0304k\n]\n= y(w)[p]w\u0304w + \u2211\nk\u2208 ,k\u2260w\n[\ny(w)[p] k\u0304w + y(w)[p]kw\n]\nTherefore, the demand constraint at destinations holds if the demand constraint at origins and flow conservation at nodes hold. We also have\nq[p]w \u2a7d y (w)[p] w\u0304w + \u2211\nk\u2208 ,k\u2260w\n[\ny(w)[p] w\u0304k\u0304 + y(w)[p]w\u0304k ] \u2a7d z[p]w\u0304w + \u2211\nk\u2208 ,k\u2260w\n[\nz[p] w\u0304k\u0304 + z[p]w\u0304k ]\n\u2a7d \u2211 k\u2208 ,k\u2260w z[p] w\u0304k\u0304 + (z[p]w\u0304w + \u2211 k\u2208 ,k\u2260w z[p]w\u0304k) = zw\u0304w\u0304[p] + \u2211 k\u2260w z[p] k\u0304w\u0304\nThis implies that demand constraints in the vehicle layer hold if supply demand constraints in the passenger layer hold. We now generalize [M1.2.NCP-VehPassMatch] as:\n0 \u2a7d y(w)uv \u27c2 C (w) uv + (w) u \u2212 (w) v + (w) uv \u2212 + u \u2a7e 0,\u2200w \u2208  , (u, v) \u2208  +(m) \u222a \u2212(m),\n(w)u free \u27c2 \u2211 v\u2032 y(w)v\u2032u \u2212 \u2211 v y(w)uv = 0,\u2200w \u2208  , u \u2208  +(m) \u222a\u2212(m)\n0 \u2a7d (w)uv \u27c2 zuv \u2212 y (w) uv \u2a7e 0,\u2200w \u2208  , (u, v) \u2208  +(m) \u222a \u2212(m)\n+u free \u27c2 \u2211 v y(w)uv \u2212 \u2211 w ouw\u0304[m]q [m] w = 0,\u2200u \u2208  +(m).\nAccordingly, [All.NCP-ESys] is formulated as [All.MCP]: [All.MCP] 0 \u2a7d zuv \u27c2 Cuv + u \u2212 v \u2212 uv + fleettuv \u2212 v \u2a7e 0,\u2200(u, v) \u2208  (A.8) 0 \u2a7d y(w)uv \u27c2 C (w) uv + (w) u \u2212 (w) v + (w) uv \u2212 + u \u2a7e 0,\u2200w \u2208  , (u, v) \u2208 \n+(m) \u222a \u2212(m) (A.9) 0 \u2a7d q[m]w \u27c2 U [m] w \u2212 w \u2a7e 0,\u2200w \u2208  , m \u2208  (A.10)\n0 \u2a7d fleet \u27c2 S \u2212 \u2211 \u2200(u,v)\u2208 zuvtuv \u2a7e 0 (A.11)\n0 \u2a7d xdij \u27c2 d j + tij(x) \u2212 d i \u2a7e 0,\u2200(i, j) \u2208 (net), d \u2208  (A.12)\n0 \u2a7d di \u27c2 \u2211\nj\u2236(i,j)\u2208(net)\nxdij \u2212 \u2211\nk\u2236(k,i)\u2208(net)\nxdki \u2212 q(i,d) \u2a7e 0,\u2200i \u2208 net, d \u2208  (A.13)\n0 \u2a7d ouv \u27c2 \u2211 u zuv \u22c5 ouv \u2212 zuv + uv \u2a7e 0,\u2200(u, v) \u2208 , u \u2208 \u2212 (A.14)\n0 \u2a7d o(w)uv \u27c2 \u2211 u y(w)uv \u22c5 o (w) uv \u2212 y (w) uv + (w) uv \u2a7e 0,\u2200w \u2208  , (u, v) \u2208 , u \u2208  +(m) (A.15)\nu free \u27c2 \u2211\nv\u2032 zv\u2032u \u2212\n\u2211 v zuv = 0,\u2200u \u2208  (A.16)\n(w)u free \u27c2 \u2211 v\u2032 y(w)v\u2032u \u2212 \u2211 v y(w)uv = 0,\u2200w \u2208  , u \u2208  +(m) \u222a\u2212(m) (A.17)\nw free \u27c2 \u2211 m\u2208 q[m]w \u2212 qw = 0,\u2200w \u2208  (A.18)\n+u free \u27c2 \u2211 v y(w)uv \u2212 \u2211 w ouw\u0304[m]q [m] w = 0,\u2200u \u2208  +(m) (A.19)\n0 \u2a7d u \u27c2 \u2211\nv\u2032 zv\u2032u \u2212\n\u2211\nw ouw\u0304[m]q [m] w \u2a7e 0,\u2200u \u2208  +(m) (A.20)\n0 \u2a7d (w)uv \u27c2 zuv \u2212 y (w) uv \u2a7e 0,\u2200w \u2208  , (u, v) \u2208  (A.21) 0 \u2a7d uv \u27c2 1 \u2212 ouv \u2a7e 0,\u2200(u, v) \u2208 , u \u2208 \u2212 (A.22) 0 \u2a7d (w)uv \u27c2 1 \u2212 o (w) uv \u2a7e 0,\u2200w \u2208  , (u, v) \u2208 , u \u2208 \n+(m). (A.23) To handle the lack of symmetry of multipliers fleet (A.11) and +w (A.19), we add penalties z and y to constraints S \u2212 \u2211\n\u2200(u,v)\u2208 zuvtuv \u2a7e 0 and \u2211 v y (w) uv = \u2211 w o uw\u0304[m] q[m]w , respectively. We then have a variational inequality V (H , ) where = [ z, y]. We denote s+ = max(0, s) for any scalar s. Mathematically,\n[V (H , )]\nH (F ) =\n\u23a7\n\u23aa\n\u23aa\n\u23aa\n\u23aa\n\u23aa\n\u23a8\n\u23aa\n\u23aa\n\u23aa\n\u23aa\n\u23aa\n\u23a9\nCuv + ztuv [ \u2211 (u,v) zuvtuv \u2212 S ]\n+ ,\u2200(u, v) \u2208 \nC (w)uv + y [ \u2211 v y (w) uv \u2212 \u2211 w o uw\u0304[m] q[m]w ] + ,\u2200w \u2208  , (u, v) \u2208 +(m) \u222a \u2212(m)\nU [m]w ,\u2200w \u2208  , m \u2208  tij(x) \u2212 ( di \u2212 d j ),\u2200(i, j) \u2208 (net), d \u2208 \n\u2211 j\u2236(i,j)\u2208(net) x d ij \u2212 \u2211 k\u2236(k,i)\u2208(net) x d ki \u2212 q(i,d),\u2200i \u2208 net, d \u2208 \n\u2211 u zuv \u22c5 ouv \u2212 zuv,\u2200(u, v) \u2208 , u \u2208 \u2212 \u2211\nu y (w) uv \u22c5 o (w) uv \u2212 y (w) uv ,\u2200w \u2208  , (u, v) \u2208 , u \u2208 +(m)\n\u23ab\n\u23aa\n\u23aa\n\u23aa\n\u23aa\n\u23aa\n\u23ac\n\u23aa\n\u23aa\n\u23aa\n\u23aa\n\u23aa\n\u23ad\n is the feasible set of F = (z, y,q, x, , o) and (z, y,q, o) \u2a7e 0 satisfy: \u2211\nv\u2032 zv\u2032u =\n\u2211\nv zuv,\u2200u \u2208 \n\u2211 v\u2032 y(w)v\u2032u \u2212 \u2211 v y(w)uv = 0,\u2200w \u2208  , u \u2208  +(m) \u222a\u2212(m)\n\u2211\nm\u2208 q[m]w = qw,\u2200w \u2208 \n\u2211\nv\u2032 zv\u2032u \u2a7e\n\u2211\nw ouw\u0304[m]q [m] w ,\u2200u \u2208  +(m)\nywuv \u2a7d zuv,\u2200w \u2208  , (u, v) \u2208  +(m) \u222a \u2212(m) ouv \u2a7d 1,\u2200(u, v) \u2208 , u \u2208 \u2212\no(w)uv \u2a7d 1,\u2200w \u2208  , (u, v) \u2208 , u \u2208  +(m).\nWe now demonstrate the solution existence of V (H , ). Note that the feasible set  is unbounded. We first consider a modified variational inequality V (H , ) with assumptions in Proposition 1. We have\nywuv \u2a7d zuv \u2a7d \u2211 w\u2208 \u22c5qw,\u2200w \u2208  , (u, v) \u2208 +(m) \u222a \u2212(m) (A.24)\nThe feasible set  of F = (z, y,q, x, , o) is closed and bounded (i.e., compact) polyhedron. According to Thm 1, V (H , ) has a solution for every > 0. Therefore, V (H , ) at least has one solution \u2200 > 0 (Thm 2).We then show the solution of [All.MCP] is recovered by [V (H , )] when z, y \u2192 \u221e. An MCP formulation of V (H , ) is obtained as follows: We denote fleet = z [ \u2211 (u,v) zuvtuv \u2212 S ] + and +w = y [ \u2211 v y(w)uv \u2212 \u2211 w ouw\u0304[m]q [m] w ] + . Mathematically, [All.MCP-V (H , )] 0 \u2a7d zuv \u27c2 Cuv + u \u2212 v \u2212 uv + fleettuv \u2212 v \u2a7e 0,\u2200(u, v) \u2208 \n0 \u2a7d y(w)uv \u27c2 C (w) uv + (w) u \u2212 (w) v + (w) uv \u2212 + u \u2a7e 0,\u2200w \u2208  , (u, v) \u2208  +(m) \u222a \u2212(m) 0 \u2a7d q[m]w \u27c2 U [m] w \u2212 w \u2a7e 0,\u2200w \u2208  , m \u2208 \n0 \u2a7d xdij \u27c2 d j + tij(x) \u2212 d i \u2a7e 0,\u2200(i, j) \u2208 (net), d \u2208 \n0 \u2a7d di \u27c2 \u2211\nj\u2236(i,j)\u2208(net)\nxdij \u2212 \u2211\nk\u2236(k,i)\u2208(net)\nxdki \u2212 q(i,d) \u2a7e 0,\u2200i \u2208 net, d \u2208 \n0 \u2a7d ouv \u27c2 \u2211 u zuv \u22c5 ouv \u2212 zuv + uv \u2a7e 0,\u2200(u, v) \u2208 , u \u2208 \u2212\n0 \u2a7d o(w)uv \u27c2 \u2211 u y(w)uv \u22c5 o (w) uv \u2212 y (w) uv + (w) uv \u2a7e 0,\u2200w \u2208  , (u, v) \u2208 , u \u2208  +(m)\nu free \u27c2 \u2211\nv\u2032 zv\u2032u \u2212\n\u2211\nv zuv = 0,\u2200u \u2208 \n(w)u free \u27c2 \u2211 v\u2032 y(w)v\u2032u \u2212 \u2211 v y(w)uv = 0,\u2200w \u2208  , u \u2208  +(m) \u222a\u2212(m)\nw free \u27c2 \u2211 m\u2208 q[m]w \u2212 qw = 0,\u2200w \u2208 \n0 \u2a7d u \u27c2 \u2211\nv\u2032 zv\u2032u \u2212\n\u2211\nw ouw\u0304[m]q [m] w \u2a7e 0,\u2200u \u2208  +(m)\n0 \u2a7d (w)uv \u27c2 zuv \u2212 y (w) uv \u2a7e 0,\u2200w \u2208  , (u, v) \u2208  0 \u2a7d uv \u27c2 1 \u2212 ouv \u2a7e 0,\u2200(u, v) \u2208 , u \u2208 \u2212\n0 \u2a7d (w)uv \u27c2 1 \u2212 o (w) uv \u2a7e 0,\u2200w \u2208  , (u, v) \u2208 , u \u2208  +(m).\nWe follow (Ban et al., 2019) by applying a limit argument to the penalization b = [ bz, by]. F b = (zb, yb,qb, xb, b, ob) represents a solution of [V (H b , )] for each b. We have \u2200F \u2208  , H b (F b)T (F \u2212 F b) \u2a7e 0. We denote F\u0304 b = (z\u0304b, y\u0304b,qb, xb, b, ob), F\u0304 b \u2208  . z\u0304b and y\u0304b satisfy\nS \u2212 \u2211 \u2200(u,v)\u2208 z\u0304buvt b uv \u2a7e\n\u2211\nv y\u0304(w),buv \u2212\n\u2211\nw ouw\u0304[m]q [m],b w = 0,\u2200w \u2208  , u \u2208  +(m) \u222a\u2212(m)\nTherefore, 0 \u2a7dH b (b)T (\u0304b \u2212 b)\n=bounded term + \u2211 (u,v) bztuv\n[\n\u2211 (u,v) zbuvt b uv \u2212 S\n]\n+\n(z\u0304buv \u2212 z b uv) +\n\u2211\nw\n\u2211 (u,v) by( \u2211 v y\u0304(w),buv \u2212 \u2211 w ouw\u0304[m]q [m],b w ) (y\u0304 (w),b uv \u2212 y (w),b uv )\n=bounded term + bz [ \u2211\n(u,v) zbuvt b uv \u2212 S\n]\n+\n\u2211 (u,v) tbuv(z\u0304 b uv \u2212 z b uv) \u2212 b y \u2211 w ( \u2211 v y(w),buv \u2212 \u2211 w ouw\u0304[m]q [m],b w ) 2\nWe have\u2211(u,v) tbuv(z\u0304buv \u2212 zbuv) = \u2211 (u,v) t b uvz\u0304 b uv \u2212 \u2211 (u,v) t b uvz b uv \u2a7d S \u2212 \u2211 (u,v) t b uvz b uv \u2212 . Accordingly,\n0 \u2a7dbounded term \u2212 bz [ \u2211\n(u,v) zbuvtuv \u2212 S\n]2\n+\n\u2212 \u22c5 bz\n[\n\u2211 (u,v) zuvtuv \u2212 S\n]\n+\n\u2212 by \u2211 w ( \u2211 v y(w),buv \u2212 \u2211 w ouw\u0304[m]q [m] w ) 2\nWhen limb\u2192\u221e bz = \u221e and limb\u2192\u221e by = \u221e, we have bfleet = bz [ \u2211 (u,v) z b uvt b uv \u2212 S ] + is bounded and\nlim b\u2192\u221e\n[\n\u2211\n\u2200(u,v)\u2208 zbuvt b uv \u2212 S\n]\n+\n= 0\nlim b\u2192\u221e\n( \u2211 v y(w),buv \u2212 \u2211 w ouw\u0304[m]q [m],b w ) = 0,\u2200w \u2208  , u \u2208  +(m) \u222a\u2212(m)\nLet E(w),bu denote\u2211v y(w),buv \u2212 \u2211 w o uw\u0304[m] q[m],bw and ab denote [ \u2211 \u2200(u,v)\u2208 z b uvt b uv \u2212 S ] + . We have the following MCP:\n[All.MCP-V (H b , )] 0 \u2a7d zbuv \u27c2 C b uv + b u \u2212 b v \u2212 b uv + b fleett b uv \u2212 b v \u2a7e 0,\u2200(u, v) \u2208 \n0 \u2a7d y(w),buv \u27c2 C (w),b uv + (w),b u \u2212 (w),b v + (w),b uv \u2212 b+ u \u2a7e 0,\u2200w \u2208  , (u, v) \u2208  +(m) \u222a \u2212(m) 0 \u2a7d q[m],bw \u27c2 U [m],b w \u2212 b w \u2a7e 0,\u2200w \u2208  , m \u2208 \n0 \u2a7d bfleet \u27c2 a b + S \u2212\n\u2211\n\u2200(u,v)\u2208 zbuvt b uv \u2a7e 0\n0 \u2a7d xd,bij \u27c2 d,b j + t b ij(x) \u2212 d,b i \u2a7e 0,\u2200(i, j) \u2208 (net), d \u2208 \n0 \u2a7d d,bi \u27c2 \u2211\nj\u2236(i,j)\u2208(net)\nxd,bij \u2212 \u2211\nk\u2236(k,i)\u2208(net)\nxd,bki \u2212 q b (i,d) \u2a7e 0,\u2200i \u2208 net, d \u2208 \n0 \u2a7d obuv \u27c2 \u2211 u zbuv \u22c5 o b uv \u2212 z b uv + b uv \u2a7e 0,\u2200(u, v) \u2208 , u \u2208  \u2212\n0 \u2a7d o(w),buv \u27c2 \u2211 u y(w),buv \u22c5 o (w),b uv \u2212 y (w),b uv + (w),b uv \u2a7e 0,\u2200w \u2208  , (u, v) \u2208 , u \u2208  +(m)\nbu free \u27c2 \u2211 v\u2032 zbv\u2032u \u2212 \u2211 v zbuv = 0,\u2200u \u2208 \n(w),bu free \u27c2 \u2211 v\u2032 y(w),bv\u2032u \u2212 \u2211 v y(w),buv = 0,\u2200w \u2208  , u \u2208  +(m) \u222a\u2212(m)\nbw free \u27c2 \u2211 m\u2208 q[m],bw \u2212 qw = 0,\u2200w \u2208 \nb+ u free \u27c2 \u2211 v y(w),buv \u2212 \u2211 w ouw\u0304[m]q [m],b w = E (w),b u ,\u2200u \u2208  +(m)\n0 \u2a7d bu \u27c2 \u2211 v\u2032 zbv\u2032u \u2212 \u2211 w ouw\u0304[m]q [m],b w \u2a7e 0,\u2200u \u2208  +(m)\n0 \u2a7d (w),buv \u27c2 z b uv \u2212 y (w),b uv \u2a7e 0,\u2200w \u2208  , (u, v) \u2208 \n0 \u2a7d buv \u27c2 1 \u2212 o b uv \u2a7e 0,\u2200(u, v) \u2208 , u \u2208  \u2212\n0 \u2a7d (w),buv \u27c2 1 \u2212 o (w),b uv \u2a7e 0,\u2200w \u2208  , (u, v) \u2208 , u \u2208  +(m).\nTherefore, [All.MCP-V (H b , )] when b \u2192 \u221e satisfies assumptions of Lemma 1. The solution of [All.NCP-ESys] exists. Proposition 2 holds."
        },
        {
            "heading": "Appendix A.9. Numerical results on the small network",
            "text": "Goal: There are two TNC companies (Company 1 and Company 2) in the market and each provides both e-solo and e-pooling services. We would like to investigate how fleet sizing of companies impacts their market shares. The competition between e-hailing providers is not modeled directly. Instead, e-hailing providers select their revenue structures and fleet sizing first and leave it for travelers to decide which provider to take. Once the demand for each provider is determined, the role each platform plays is simply to match orders to vacant vehicles. Before delving into the example, we first present the generalized model to multiple e-platforms. Denote a set of e-hailing service providers that offers both e-solo and e-pooling modes as  = {c}c\u2208\u2115+ . Then the vehicle flows, passenger flows, and customermode choice are augmented with an additional subscript c (from m to mc) for all the modules.\n[M1.1.NCP-VehDispatch-c] 0 \u2a7d zw\u0304,ck \u27c2 C w\u0304,c k \u2212 w\u0304,c + k,c + fleet,c \u2a7e 0,\u2200w \u2208  , c \u2208 \n0 \u2a7d z[pc ] w\u0304k\u0304 \u27c2 C [pc ] w\u0304k\u0304 + [pc ]+w\u0304 \u2212 [pc ]\u2212 k\u0304 \u2212 [pc ] k\u0304 \u2212 [pc ] w\u0304k\u0304 + fleet,c \u2a7e 0,\u2200w, k \u2208  , k \u2260 w, c \u2208 \n0 \u2a7d z[pc ] k\u0304w \u27c2 C [pc ] k\u0304w + [pc ]\u2212 k\u0304 \u2212 [pc ]+w \u2212 [pc ] k\u0304w + fleet,c \u2a7e 0,\u2200w, k \u2208  , k \u2260 w, c \u2208 \n0 \u2a7d z[pc ]w\u0304w \u27c2 C [pc ] w\u0304w + [pc ]\u2212 w\u0304 \u2212 [pc ]+ w \u2212 [pc ] w\u0304w + fleet,c \u2a7e 0,\u2200w \u2208  , c \u2208 \n0 \u2a7d z[pc ]wk \u27c2 C [pc ] wk + [pc ]+ w \u2212 [pc ] wk \u2212 [pc ]\u2212 k \u2212 [pc ] w + fleet,c \u2a7e 0,\u2200w, k \u2208  , k \u2260 w, c \u2208 \n0 \u2a7d zw\u0304w\u0304[pc ] \u27c2 Cw\u0304w\u0304[pc ] \u2212 [pc ]+ w\u0304 \u2212 [pc ] w\u0304 \u2212 w\u0304,c \u2212 c \u2a7e 0,\u2200w \u2208  , c \u2208 \n0 \u2a7d zw[pc ]w \u27c2 Cw[pc ]w + [pc ]\u2212 w \u2212 [pc ] w + w,c + c \u2a7e 0,\u2200w \u2208  , c \u2208 \n0 \u2a7d z[ec ]w\u0304w \u27c2 C [ec ] w\u0304w + [ec ] w\u0304 \u2212 [ec ] w \u2212 [ec ] w\u0304w + fleet,c \u2a7e 0,\u2200w \u2208  , c \u2208 \n0 \u2a7d zw\u0304w\u0304[ec ] \u27c2 Cw\u0304w\u0304[ec ] \u2212 [ec ] w\u0304 + w\u0304,c \u2212 [ec ] w \u2212 c \u2a7e 0,\u2200w \u2208  , c \u2208 \n0 \u2a7d zw[ec ]w \u27c2 Cw[ec ]w + [ec ] w \u2212 w,c + c \u2a7e 0,\u2200w \u2208  , c \u2208 \n0 = zw\u0304w\u0304[pc ] \u2212 \u2211 k\u2208 ,k\u2260w z[pc ] w\u0304k\u0304 \u27c2 [pc ]+w\u0304 free,\u2200w \u2208  , c \u2208 \n0 = \u2211 k\u2208 ,k\u2260w z[pc ] k\u0304w\u0304 \u2212 \u2211 k\u2208 ,k\u2260w z[pc ]w\u0304k \u2212 z [pc ] w\u0304w \u27c2 [pc ]\u2212 w\u0304 free,\u2200w \u2208  , c \u2208 \n0 = z[pc ]w\u0304w + \u2211 k\u2208 ,k\u2260w z[pc ] k\u0304w \u2212 \u2211 k\u2208 ,k\u2260w z[pc ]wk \u27c2 [pc ]+ w free,\u2200w \u2208  , c \u2208 \n0 = \u2211 k\u2260w z[pc ]kw \u2212 zw[pc ]w \u27c2 [pc ]\u2212 w free,\u2200w \u2208  , c \u2208 \n0 \u2a7d zw\u0304w\u0304[pc ] + \u2211 k\u2208 ,k\u2260w z[pc ] k\u0304w\u0304 \u2212 q[pc ]w \u27c2 [pc ] w\u0304 \u2a7e 0,\u2200w \u2208  , c \u2208 \n0 \u2a7d zw[pc ]w + \u2211 k\u2208 ,k\u2260w z[pc ]wk \u2212 q [pc ] w \u27c2 [pc ] w \u2a7e 0,\u2200w \u2208  , c \u2208 \n0 = zw\u0304w\u0304[ec ] \u2212 z [ec ] w\u0304w \u27c2 [ec ] w\u0304 free,\u2200w \u2208  , c \u2208 \n0 = z[ec ]w\u0304w \u2212 zw[ec ]w \u27c2 [ec ] w free,\u2200w \u2208  , c \u2208 \n0 \u2a7d zw\u0304w\u0304[ec ] \u2212 q [ec ] w \u27c2 [ec ] w \u2a7e 0,\u2200w \u2208  , c \u2208 \n0 = \u2211 k\u2208 zw\u0304,ck \u2212 \u2211 m\u2208 zw\u0304w\u0304[mc ] \u27c2 w\u0304,c free,\u2200w \u2208  , c \u2208 \n0 = \u2211\nm\u2208 zw[mc ]w \u2212\n\u2211 k\u2208 zk\u0304,cw \u27c2 w,c free,\u2200w \u2208  , c \u2208 \n0 = \u2211\nmc\u2208\n\u2211 w\u2208 zw\u0304w\u0304[mc ] \u2212 \u2211\nmc\u2208\n\u2211 w\u2208 zw[mc ]w \u27c2 c free,\u2200c \u2208 \n0 \u2a7d Sc \u2212 \u2211 k,w\u2208 zw\u0304,ck tkw\u0304 \u2212 \u2211\nmc\u2208\n\u2211\n(v,u)\u2208(mc ) z[mc ]vu tvu \u27c2 fleet,c \u2a7e 0,\u2200c \u2208 \nThe parameter values are shown in Table (A.7).\nwhere xij is the vehicular flow, t0ij is the free-flow travel time, A,B are coefficients, and CAPACITYij is the linkcapacity (i.e., maximum vehicular flow). The coefficients in the BPR link cost functions are listed in Table (A.8).\nRemark. 1. With this parameter setting, all passengers select e-solo and there is no e-pooling order. 2. Company 1 offers service at a lower fare rate than Company 2. Thus, as long as Company 1 has capacity, it\nserves orders first. Only when Company 1\u2019s fleet sizing is limited (i.e., less than the required fleets), passengers have no option but to select Company 2 for service.\nRunning GAMS 24.4.6 on a DELL desktop with Intel i7 CPU 3.40GHz and 16GB RAM. The algorithm stops with a residual less than 10\u22127. The demands, cost, and performances are demonstrated in Fig. A.17.\nIn Fig.A.17a, the x-axis is the fleet coefficient of Company 1 growing from 0 to 3 and the y-axis is the demand level served by Company 1. Travel demands fulfilled by Company 1 increase as its fleet size increases. Now let us focus on two extremes. When Company 1 does not contain any fleet, no demand is fulfilled by Company 1. When its fleet size increases to the maximum, all orders are served by Company 1.\nIn Fig.A.17b, each stacked bar indicates the market share of 2 companies for OD (1,3) and OD (2,3), respectively. Each subfigure plots the both OD shares given a specified fleet size of Company 1, of which the value is indicated in the title. The market share of Company 1 is depicted by a blue bar and that of Company 2 by a yellow bar. As the fleet size of Company 1 increases (from left to right subfigures), the market share of Company 1 for OD (1,3) increases accordingly.\nIn Fig.A.17c, the x-axis is the fleet size of Company 1, and the y-axis lists fare (the dotted blue linewith crossmakers for Company 1 and the solid red line with cross markers for Company 2), supply-demand surplus (the orange dotted line with circle makers for Company 1 and the purple line with circle markers for Company 2), and fleet size surplus (the green dotted line with diamond makers for Company 1 and the blue line with diamond markers for Company 2). The fares for both companies remain constant across the fleet size coefficient. This is because total travel time and distance that factor into the fare computation stay the same. The fare of Company 1 is lower than that of Company 2, because its overall fare coefficients are smaller. With a zero fleet size of Company 1, passengers are forced to choose Company 2 paying higher fares. The supply-demand surplus represents the fee paid by passengers to drivers when the demand is higher than the supply. A zero value means that the vehicle supply can fulfill the demand. As the fleet size of Company 1 increases, Company 1\u2019s supply-demand surplus is always greater than zero, meaning that all its fleet size is used to serve the demand and there is no extra supply. The fleet surplus represents the incentive from a company\nto its drivers to expand the supply size. Because Company 2 has a sufficient fleet size, its fleet surplus is always zero. For Company 1, when its fleet size coefficient is less than 2 (i.e., insufficient fleet sizes), its fleet surplus is positive (indicating that Company 1 struggles with recruiting drivers and needs to pay incentives to drivers) and is reduced to zero when greater than 2.\nIn Fig.A.17d, the x-axis is the fleet size coefficient, and the y-axis lists DHM (with the blue dotted line with cross makers for Company 1 and the solid red line with cross markers for Company 2), STC (with the orange dotted line with circular makers for Company 1 and the purple line with circular markers for Company 2), and TVH (with the green dotted line with diamond makers for Company 1 and the blue line with diamond markers for Company 2). Consistent with the common sense, as Company 1\u2019s fleet size rises, DHM, STC, and TVH all increase, while those of Company 2\u2019s taper down."
        },
        {
            "heading": "Appendix A.10. Numerical results of 6 ODs in Sioux Falls network",
            "text": "We inspect details of the vehicle OD flow and analyze the OD sequences. Vehicle Dispatch (green arrows). E-pooling:\n\u2022 2 \u2192 1 \u2192 18 \u2192 20 : 103 vehicles are dispatched from node 2 to node 1 in order to fulfill demands of OD pairs: (1,18), (1,20), (2,18) and (2,20). Compared to the traffic flow in Fig. 13, the number of vehicles in e-pooling service decreases.\n\u2022 2 \u2192 3 \u2192 20 : 316 vehicles are dispatched from node 2 to fulfill demands of OD pairs: (2,20) and (3,20). Compared to the traffic flow in Fig. 13, the number of vehicles in e-pooling service decreases.\n\u2022 1 \u2192 3 \u2192 20 : 260 vehicles are dispatched from node 1 to node 3 in order to fulfill demands of OD pairs: (1,20) and (3,20). Compared to the traffic flow in Fig. 13, the number of vehicles in e-pooling service increases.\n\u2022 2 \u2192 18 \u2192 20 : 487 vehicles are dispatched from node 2 in order to fulfill demands of OD pairs: (2,18) and (2,20). Compared to the traffic flow in Fig. 13, the number of vehicles in e-pooling service increases.\n\u2022 2 \u2192 20 \u2192 18 : 1110 vehicles are dispatched from node 2 in order to fulfill demands of OD pairs: (2,18) and (2,20). Compared to the traffic flow in Fig. 13, the number of dispatched vehicles decreases.\nE-solo: \u2022 1 \u2192 18 : 300 vehicles are dispatched to fulfill the travel demand of OD pair (1,18). \u2022 3 \u2192 18 : 300 vehicles are dispatched to fulfill the travel demand of OD pair (3,18). \u2022 3 \u2192 20 : 300 vehicles are dispatched to fulfill the travel demand of OD pair (3,20). Rebalancing Flow (grey arrows): \u2022 20 \u2192 2: 2016 vehicles at destination 20 plan to pick up passengers at origin 2. \u2022 20 \u2192 3: 600 vehicles at destination 20 plan to pick up passengers at origin 3. \u2022 18 \u2192 1: 678 vehicles at destination 18 plan to pick up passengers at origin 1."
        }
    ],
    "title": "A Unified Network Equilibrium for  E-Hailing Platform Operation and Customer Mode Choice",
    "year": 2023
}
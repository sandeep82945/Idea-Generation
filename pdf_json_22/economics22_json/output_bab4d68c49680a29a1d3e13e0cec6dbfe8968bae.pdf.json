{
    "abstractText": "We study a repeated game between a supplier and a retailer who want to maximize their respective profits without full knowledge of the problem parameters. After characterizing the uniqueness of the Stackelberg equilibrium of the stage game with complete information, we show that even with partial knowledge of the joint distribution of demand and production costs, natural learning dynamics guarantee convergence of the joint strategy profile of supplier and retailer to the Stackelberg equilibrium of the stage game. We also prove finite-time bounds on the supplier\u2019s regret and asymptotic bounds on the retailer\u2019s regret, where the specific rates depend on the type of knowledge preliminarily available to the players. In the special case when the supplier is not strategic (vertical integration), we prove optimal finite-time regret bounds on the retailer\u2019s regret (or, equivalently, the social welfare) when costs and demand are adversarially generated and the demand is censored.",
    "authors": [
        {
            "affiliations": [],
            "name": "Nicol\u00f2 Cesa-Bianchi"
        },
        {
            "affiliations": [],
            "name": "Tommaso Cesari"
        },
        {
            "affiliations": [],
            "name": "Takayuki Osogami"
        },
        {
            "affiliations": [],
            "name": "Marco Scarsini"
        }
    ],
    "id": "SP:6c4c1a863e39d7facc494b789c4c366d67e962ed",
    "references": [
        {
            "authors": [
                "Elodie Adida",
                "Victor DeMiguel"
            ],
            "title": "Supply chain competition with multiple manufacturers and retailers",
            "venue": "Oper. Res.,",
            "year": 2011
        },
        {
            "authors": [
                "Noga Alon",
                "Nicolo Cesa-Bianchi",
                "Claudio Gentile",
                "Shie Mannor",
                "Yishay Mansour",
                "Ohad Shamir"
            ],
            "title": "Nonstochastic multi-armed bandits with graph-structured feedback",
            "venue": "SIAM Journal on Computing,",
            "year": 2017
        },
        {
            "authors": [
                "Peter Auer",
                "Nicolo Cesa-Bianchi",
                "Yoav Freund",
                "Robert E Schapire"
            ],
            "title": "The nonstochastic multiarmed bandit problem",
            "venue": "SIAM journal on computing,",
            "year": 2002
        },
        {
            "authors": [
                "Yu Bai",
                "Chi Jin",
                "Huan Wang",
                "Caiming Xiong"
            ],
            "title": "Sample-efficient learning of stackelberg equilibria in general-sum games",
            "venue": "Advances in Neural Information Processing Systems,",
            "year": 2021
        },
        {
            "authors": [
                "Maria-Florina Balcan",
                "Avrim Blum",
                "Nika Haghtalab",
                "Ariel D Procaccia"
            ],
            "title": "Commitment without regrets: Online learning in stackelberg security games",
            "venue": "In Proceedings of the sixteenth ACM conference on economics and computation,",
            "year": 2015
        },
        {
            "authors": [
                "Omar Besbes",
                "Alp Muharremoglu"
            ],
            "title": "On implications of demand censoring in the newsvendor problem",
            "venue": "Management Science,",
            "year": 2013
        },
        {
            "authors": [
                "Cl\u00e9ment Bouttier",
                "Tommaso Cesari",
                "S\u00e9bastien Gerchinovitz"
            ],
            "title": "Regret analysis of the Piyavskii-Shubert algorithm for global Lipschitz optimization, 2022",
            "year": 2022
        },
        {
            "authors": [
                "G\u00e9rard P. Cachon",
                "Martin A. Lariviere"
            ],
            "title": "Supply chain coordination with revenue-sharing contracts: Strengths and limitations",
            "venue": "Management Science,",
            "year": 2005
        },
        {
            "authors": [
                "G\u00e9rard P. Cachon",
                "Serguei Netessine"
            ],
            "title": "Game theory in supply chain analysis, chapter Chapter 8, pages 200\u2013233",
            "year": 2006
        },
        {
            "authors": [
                "Nicol\u00f2 Cesa-Bianchi",
                "Pierre Gaillard",
                "Claudio Gentile",
                "S\u00e9bastien Gerchinovitz"
            ],
            "title": "Algorithmic chaining and the role of partial feedback in online nonparametric learning",
            "venue": "In Conference on Learning Theory,",
            "year": 2017
        },
        {
            "authors": [
                "Tsan-Ming Choi",
                "editor"
            ],
            "title": "Handbook of Newsvendor Problems. Models, Extensions and Applications",
            "year": 2012
        },
        {
            "authors": [
                "Yuan Deng",
                "Jon Schneider",
                "Balasubramanian Sivan"
            ],
            "title": "Strategizing against no-regret learners",
            "venue": "Advances in Neural Information Processing Systems,",
            "year": 2019
        },
        {
            "authors": [
                "Kaan Gokcesu",
                "Hakan Gokcesu"
            ],
            "title": "Regret analysis of global optimization in univariate functions with lipschitz derivatives",
            "venue": "arXiv preprint arXiv:2108.10859,",
            "year": 2021
        },
        {
            "authors": [
                "Woonghee Tim Huh",
                "Paat Rusmevichientong"
            ],
            "title": "A nonparametric asymptotic analysis of inventory planning with censored demand",
            "venue": "Mathematics of Operations Research,",
            "year": 2009
        },
        {
            "authors": [
                "Robert Kleinberg",
                "Tom Leighton"
            ],
            "title": "The value of knowing a demand curve: Bounds on regret for online posted-price auctions",
            "venue": "In 44th Annual IEEE Symposium on Foundations of Computer Science,",
            "year": 2003
        },
        {
            "authors": [
                "Martin A. Lariviere",
                "Evan L. Porteus"
            ],
            "title": "Selling to the newsvendor: An analysis of price-only contracts",
            "venue": "Manufacturing & Service Operations Management,",
            "year": 2001
        },
        {
            "authors": [
                "Steven A. Lippman",
                "Kevin F. McCardle"
            ],
            "title": "The competitive newsboy",
            "venue": "Operations Research,",
            "year": 1997
        },
        {
            "authors": [
                "Gabor Lugosi",
                "Mihalis Markakis",
                "Gergely Neu"
            ],
            "title": "On the hardness of learning from censored demand",
            "venue": "Available at SSRN 3509255,",
            "year": 2021
        },
        {
            "authors": [
                "Siddharth Mahajan",
                "Garrett van Ryzin"
            ],
            "title": "Inventory competition under dynamic consumer choice",
            "venue": "Oper. Res.,",
            "year": 2001
        },
        {
            "authors": [
                "Yishay Mansour",
                "Mehryar Mohri",
                "Jon Schneider",
                "Balasubramanian Sivan"
            ],
            "title": "Strategizing against learners in bayesian games, 2022",
            "year": 2022
        },
        {
            "authors": [
                "Serguei Netessine",
                "Nils Rudi",
                "Yunzeng Wang"
            ],
            "title": "Inventory competition and incentives to back-order",
            "venue": "IIE Transactions,",
            "year": 2006
        },
        {
            "authors": [
                "Mahmut Parlar"
            ],
            "title": "Game theoretic analysis of the substitutable product inventory problem with random demands",
            "venue": "Naval Res. Logist.,",
            "year": 1988
        },
        {
            "authors": [
                "S.A. Piyavskii"
            ],
            "title": "An algorithm for finding the absolute extremum of a function",
            "venue": "USSR Computational Mathematics and Mathematical Physics,",
            "year": 1972
        },
        {
            "authors": [
                "Pier Giuseppe Sessa",
                "Ilija Bogunovic",
                "MaryamKamgarpour",
                "Andreas Krause"
            ],
            "title": "Learning to play sequential games versus unknown opponents",
            "venue": "Advances in Neural Information Processing Systems,",
            "year": 2020
        },
        {
            "authors": [
                "Bruno O Shubert"
            ],
            "title": "A sequential method seeking the global maximum of a function",
            "venue": "SIAM Journal on Numerical Analysis,",
            "year": 1972
        },
        {
            "authors": [
                "Yunzeng Wang",
                "Yigal Gerchak"
            ],
            "title": "Capacity games in assembly systems with uncertain demand",
            "venue": "Manufacturing & Service Operations Management,",
            "year": 2003
        }
    ],
    "sections": [
        {
            "text": "ar X\niv :2\n20 7.\n04 05\n4v 1\n[ cs\n.G T"
        },
        {
            "heading": "1 Introduction",
            "text": "The newsvendor problem is a central topic in inventory theory and, more generally, in the analysis of supply chains. In its classical version Arrow et al. [1951], a retailer orders a certain quantity of a perishable good from a supplier. The decision of how much to order is made before the realization of the unknown demand for the good. If all costs are linear, the optimal decision is a quantile of the demand distribution that depends on the parameters of the model (i.e., the wholesale price charged by the supplier and the retail market price). Even in this simple framework, it is clear that the retailer can compute the optimal quantity only if the demand distribution and the model parameters are known.\nIn a practical newsvendor scenario, it is rarely the case that the retailer is the only decision maker. For instance, the wholesale price could be determined by a supplier incurring exogenous production costs that are unknown to the retailer. These multi-agent versions of the newsvendor problem can be analyzed via a game-theoretic approach, where the optimal choices are expressed in terms of equilibria of a game. As it is unreasonable to assume that supplier and retailer have full knowledge of the distributions of production costs and demand, it is important to find strategies that perform well even when only partial knowledge of these quantities is available to each player.\n\u2217Partially supported by the Italian MIUR PRIN 2017 Project ALGADIMAR Algorithms, Games, and Digital Markets. Marco Scarsini is a member of INdAM-GNAMPA.\nOur contribution. In this paper we consider a competitive newsvendor model where players do not have full knowledge of the relevant parameters. The problem is modeled as a repeated game between a supplier and a retailer, whose goal is to minimize their regret.\nWe start by considering the stage game with complete information, which we model as a Stackelberg game. Here, the supplier chooses a wholesale price and reveals it to the retailer, who in turn chooses a quantity to order by solving a newsvendor problem. Under weak conditions (see Assumption 1) on the joint distribution of production costs C, retail price P , and demand D, we characterize (Theorem 1) the uniqueness of the Stackelberg equilibrium (SE) of the game, which we show to be in pure strategies.\nWe then consider a repeated game in which the supplier only knows the marginal distribution of C, and the retailer only knows the marginal of (P,D). Assuming that, at each time t, the retailer chooses the quantity qt by best responding to the supplier\u2019s choice of wholesale price wt, in Theorem 2, we show that the supplier\u2019s average regret vanishes at rate T\u22121/2, while the players\u2019 strategy profile (wt, qt) converges to the SE of the stage game asymptotically at the same T\u22121/2 rate. If the supplier is given an upper bound on the Lipschitz constant of their own utility, then the supplier\u2019s average regret vanishes at a faster rate (lnT )/T . Notably, in this case the rate of convergence to the SE of the players\u2019 strategy profile can be arbitrarily slow (Theorem 4). Finally, if in the previous setting we drop the assumption that the retailer knows (P,D), then the supplier\u2019s regret vanishes at rate T\u22121/3 provided the retailer best responds to wt based on the empirical distribution of past realizations (Ps, Ds) for all s < t (Theorem 5).\nThe last part of this work deals with vertical integration, a setting in which the retailer is the only decision-maker because the supplier always sells at production cost. This can happen for a number of reasons; for instance, because the supply chain is owned by the same company, or because both parties preliminarily agreed on a revenue-sharing contract. In Theorem 6 we prove finite-time regret bounds for adversarial (as opposed to stochastic) sequences of production costs and demand functions. Our result applies to a setting in which the retailer is simultaneously optimizing the order quantity and the retail price in the presence of censored feedback. Our bounds show that the average regret vanishes at rate T\u22121/3 (ignoring logarithmic factors). As this setting includes posted-price auctions as a special case, this rate is not significantly improvable.\nOur analyses of convergence of the learning dynamics to the SE borrow ideas from online learning and bandits (e.g., Follow-The-Leader and Explore-Then-Commit), and use zeroth-order optimization (e.g., the Piyavskii\u2013Shubert algorithm). The adversarial analysis in the vertical integration setting builds on the techniques developed in Cesa-Bianchi et al. [2017], which in turn are an adaptation of the general framework introduced by Alon et al. Alon et al. [2017].\nRelated work. The newsvendor problem, also known as the newsboy problem, goes back to Edgeworth Edgeworth [1888]. The formalization used in this work is due to Arrow et al. Arrow et al. [1951]; we refer the reader to the handbook Choi [2012] for a survey of the many variants of Arrow\u2019s model.\nA game-theoretic formulation of the newsvendor problem with competing retailers is proposed by Parlar Parlar [1988]\u2014see also Lippman and McCardle [1997], Mahajan and van Ryzin [2001], Netessine et al. [2006]. Wang and Gerchak Wang and Gerchak [2003] use a Stackelberg game to model a situation where an assembler has to buy components from different suppliers. Lariviere and Porteus Lariviere and Porteus [2001] study a model where a supplier and a retailer interact through a price-only contract, and compare its efficiency with the efficiency of an integrated system. Adida and DeMiguel Adida and DeMiguel [2011] consider a competitive inventory model with several suppliers and several retailers, and prove equilibrium uniqueness under some symmetry conditions. We refer the reader to Cachon and Netessine Cachon and Netessine [2006] for a survey of the literature on game-theoretic models in supply chain analysis.\nThe problem of learning equilibria is investigated by Balcan et al. Balcan et al. [2015] for Stackelberg security games. They prove bounds on the leader\u2019s regret when the follower has a type that changes over time in a known and finite class. Their results hold in both the full information setting (where the leader can observe the type of the follower) and in the bandit setting (where the follower\u2019s type is not observed). Sessa et al. Sessa et al. [2020] study general repeated games between a leader with a finite number of actions and an follower with a finite number of types which may adversarialy change over time. They prove bounds\non the leader\u2019s regret in the full information setting when the utility of each follower (which is determined by its type) is only known to satisfy certain regularity assumptions. Bai et al. Bai et al. [2021] show that in the bandit setting with finitely many actions for leader and follower, there exist expected utility functions such that any leader\u2019s algorithm suffers non-vanishing regret with probability at least 1/3. They also show leader algorithms that converge to SE up to a certain suboptimality gap. Deng et al. Deng et al. [2019] prove some interesting non-constructive results. Let V be the utility of the leader in a SE. Under some mild assumptions, they show that for any \u03b5 > 0 the leader can always obtain a utility of at least (V \u2212 \u03b5)T \u2212 o(T ) in T rounds, against any no-regret algorithm of the follower (note that the convergence rate is not explicit in their results). Mansour et al. Mansour et al. [2022] extend these results to Bayesian games.\nNote that our results take advantage of the specific structure of the utility functions to obtain good rates for the leader\u2019s regret in a bandit setting. Note also that, unlike previous works, the follower\u2019s best response in our setting is not determined by a type, but rather learned from observed data. This allows us to prove that the follower\u2019s regret vanishes too. As a consequence, we are also able to prove convergence to SE of the players\u2019 strategy profile.\nOften, quantities and prices between suppliers and retailers are determined by contracts. Cachon and Lariviere Cachon and Lariviere [2005] study revenue-sharing contracts in general supply chain models, and show that such contracts result in the same overall efficiency as vertical integration. Note that under vertical integration the retailer is the only decision-maker, and our setting becomes similar to a singleagent newsvendor model. Among the many works investigating learning approaches to the newsvendor model, the ones most relevant to our work are the regret minimization analyses of Huh and Rusmevichientong Huh and Rusmevichientong [2009] and of Besbes and Muharremoglu Besbes and Muharremoglu [2013]. However, to the best of our knowledge, the adversarial newsvendor problem with censored demand is only studied by Lugosi et al. Lugosi et al. [2021]. The reason why their regret rates are better than ours is a different choice of the retailer\u2019s decision space. In their setting, the retailer only chooses the order quantity (while we also have control on the retail price, which affects the demand). Moreover, their decision space is finite while ours is continuous."
        },
        {
            "heading": "2 Stage game and unique Stackelberg equilibrium",
            "text": "In this section, we analyze a (one-shot) stage game of supply chain and characterize the uniqueness of its SE (formally defined below). We also provide some insights on the learning results proven in the following sections.\nThe stage game. An instance of the stage game is characterized by a known distribution D on [0,\u221e)3 that governs the (possibly correlated) production cost C of the supplier, the retail price P dictated by the market, and the demand D. We make the following assumption on D.\nAssumption 1. The distribution D of (C,P,D) \u2208 [0,\u221e)3 satisfies the following:\n1. E[C], E[P ], E[D], and E[PD] are all finite.\n2. E[C] < E[P ].\n3. The conditional distribution of D given (C,P ) admits a density (w.r.t. the Lebesgue measure) such that f(d | c, p) > 0, for all (c, p, d) \u2208 [0,\u221e)3.\nItem 1 guarantees that the expected utilities of the supplier and the retailer (see below for a definition) are well-defined and finite for any action profile. Item 2 is an economic assumption stating that, on average, the supplier\u2019s cost is lower than the retail price, thus eliminating trivial scenarios. Item 3 is a mild technical condition that simplifies the presentation of the proof of Theorem 1.\nWe denote the conditional cumulative distribution function and survival function of the demand, given the supplier\u2019s cost and retail price, by\nF (d | c, p) := \u222b d\n0\nf(x | c, p) dx and F\u0304 (d | c, p) := 1\u2212 F (d | c, p) \u2200c, p, d \u2265 0.\nIn this section, we assume that the structure of the model (namely, D in Assumption 1) is common knowledge to both players. The game proceeds as follows. First, the supplier (S) selects a wholesale price w \u2208 [0,\u221e) and reveals it to the retailer. Then, the retailer (R) selects a quantity q \u2208 [0,\u221e). Their expected utilities are respectively defined, for any (w, q) \u2208 [0,\u221e)2, by\nuS(w, q) := qw \u2212 qE [ C ] and uR(w, q) := E [ min{q,D}P ] \u2212 qw.\nwhere the expectations are with respect to (C,P,D) \u223c D. Finally, the Stackelberg equilibria of this game are defined as strategy pairs (w\u22c6, q\u22c6) \u2208 [0,\u221e)2 such that\nw\u22c6 \u2208 argmax w\u2208[0,\u221e)\nuS ( w,BR(w) ) and q\u22c6 = BR(w\u22c6).\nwhere BR is a best-response of the retailer, i.e., BR(w) \u2208 argmaxq\u2208[0,\u221e) uR(w, q).\nUniqueness of the Stackelberg equilibrium. We can now state our characterization of the uniqueness of the SE in the stage game1.\nTheorem 1. Under Assumption 1, let g(w) := h\u22121(w) be the inverse of\nh(x) := E [ PF\u0304 (x | C,P ) ] . (1)\nThen the following conditions are equivalent:\n1. The stage game in Section 2 admits a unique SE ( w\u22c6, g(w\u22c6) ) . 2. {w\u22c6} \u2261 argmaxw\u2208A g(w) ( w \u2212 E[C] ) , where\nA := { w \u2208 ( E[C],E[P ] ) : \u2212g \u2032(w)\ng(w) =\n1\nw \u2212 E[C]\n} .\nTo prove the theorem, we begin with a simple but key lemma, whose proof we defer to Appendix A.1.\nLemma 1. Under Assumption 1, the function h in Equation (1) is differentiable on x \u2208 (0,\u221e) and has a strictly negative derivative. and therefore is invertible, and h\u22121(w) is differentiable and strictly decreasing on w \u2208 ( 0, E[P ] ) .\nWe are now ready to prove Theorem 1.\nProof of Theorem 1. We prove the theorem by backward induction. First, we show that under Assumption 1, the retailer has a unique best response. Then, we show that given that the retailer best responds, the supplier has a unique optimal move w\u22c6 if and only if the condition of the theorem holds. Retailer\u2019s move. Fix an arbitrary wholesale price w \u2265 0. The retailer\u2019s utility is, for any q \u2265 0,\nuR(w, q) = E\n[ P E [\u222b q\n0\nxf(x | C,P ) dx + q ( 1\u2212 F (q | C,P ) ) | C,P ]] \u2212 qw.\n1For example, the SE is unique when D has a Weibull distribution with nondecreasing failure rate and (C, P ) is deterministic (see Proposition 1 in the appendix).\nTo maximize it, we compute its derivative, which is justified by Assumption 1 combined with the Leibniz integral rule. For any q > 0, we obtain\n\u2202\n\u2202q uR(w, q) = E\n[ P E [ F\u0304 (q | C,P ) | C,P ]] \u2212 w, (2)\nwhich is non-negative if and only if E [ PF\u0304 (q | C,P ) ] \u2265 w. By the arbitrariness of w and Lemma 1, we can conclude that, for any choice of the wholesale price w > 0, there exists a unique maximizer q\u22c6w = BR(w) of q 7\u2192 uR(w, q) where\nBR(w) :=\n{ g(w) if w < E[P ],\n0 if w \u2265 E[P ]. (3)\nSupplier\u2019s move. Given the retailer\u2019s best response q\u22c6w = BR(w), the supplier\u2019s utility is, for any w > 0,\nuS(w, q \u22c6 w) = q \u22c6 w\n( w \u2212 E[C] ) . (4)\nSince q\u22c6w = 0 for all w \u2265 E[P ] and w\u2212E[C] \u2264 0 for all w \u2264 E[C], to maximize the supplier\u2019s expected utility, we can restrict our search to w \u2208 ( E[C], E[P ] ) , where uS(w, q \u22c6 w) = g(w) ( w \u2212 E[C] ) is strictly positive and differentiable. To find the maximum, then, we can study the sign of the derivative of the supplier\u2019s expected utility, obtaining, for all w \u2208 ( E[C], E[P ] ) ,\n\u2202\n\u2202w uS(w, q\n\u22c6 w) = g\n\u2032(w) ( w \u2212 E[C] ) + g(w). (5)\nThus, the set A in the statement of the theorem is the set of all stationary points of uS(w, q \u22c6 w) and the\ncondition that argmaxw\u2208A g(w) ( w\u2212E[C] ) is a singleton is exactly stating that there exists a unique maximizer\nof g(w) ( w \u2212 E[C] ) = uS(w, q \u22c6 w), which coincides with the existence of a unique SE.\nIn general, the payoffs under SE may be unique under weaker conditions than the ones for the uniqueness of the SE, but such weaker conditions do not appear to be simply stated in our case.\nWe also note that efficiency of the Stackeleberg equilibrium can be measured using the price of anarchy. Some preliminary results can be found in Appendix A.3."
        },
        {
            "heading": "3 Learning the Stackelberg equilibrium",
            "text": "A limitation of Theorem 1 is that, even when a stage game has a unique SE, in order to compute it, both players need to know the underlying distribution D. In this section, we show how to circumvent this issue and achieve convergence to the unique SE without relying on the knowledge of D. We do this by reconstructing the salient features of D through a learning technique in a repeated game. An instance of the repeated game is characterized by a distribution D on2 [0, 1]3, that governs the (possibly correlated) production cost, retail price, and demand.\nWe study the following online protocol. At each round t = 1, 2, . . . :\n1. Nature draws (Ct, Pt, Dt) i.i.d. according to D.\n2. The supplier (S) selects a wholesale price Wt \u2208 [0, 1] and reveals it to the retailer (R).\n3. The production cost Ct is revealed to S.\n4. R buys a quantity Qt \u2208 [0, 1] paying QtWt to S.\n5. The retail price Pt and the demand Dt are revealed to R.\n2In contrast to Section 2, we assume here that D is bounded (without loss of generality, by 1). This assumption is for simplifying the presentation; all the following results can be extended to the unbounded case simply by assuming subgaussianity.\n6. The market buys a quantity min{Qt, Dt}, paying min{Qt, Dt}Pt to R. The individual goals of the supplier and the retailer are to maximize, for any time horizon T , their\nindividual long-term expected utilities\nT\u2211\nt=1\nE [ \u03c3(Wt;Qt, Ct) ] and T\u2211\nt=1\nE [ \u03c1(Qt;Wt, Pt, Dt) | Wt ] ,\nwhere we define \u03c3(w; q, c) := qw\u2212qc and \u03c1(q;w, p, d) := min{q, d}p\u2212qw for (w, q, c) \u2208 [0, 1]3 and (q, w, p, d) \u2208 [0, 1]4. The conditional expected utility of the retailer is to be maximized with high probability with respect to (Wt)t\u2208N. The asymmetry in the objectives of the supplier (S) and retailer (R) is due to the fact that R is revealed Wt before making a decision at time t, while S has to act before observing Qt.\nConvergence to SE with partial information. In Section 2, we showed that the stage game admits a unique SE under the assumptions in Theorem 1, and one can obtain the SE if D is known by both the supplier (S) and the retailer (R). We now show that a repeated interaction between S and R who act rationally and selfishly can lead to a convergence to the SE, even assuming that S and R have only partial information on D. In Section 3, we will show that the same result can be obtained when S and R have essentially no information on D at a cost of a slower convergence rate. We make the following assumption. Assumption 2. The distribution D of (C,P,D) \u2208 [0, 1]3 satisfies the following:\n1. E[C] < E[P ].\n2. D and C are conditionally independent, given P .\n3. The conditional distribution of D given P admits a density (with respect to the Lebesgue measure) such that f(d | p) > L, for some L > 0 and all (p, d) \u2208 [0, 1]2.\n4. Condition 2 of Theorem 1 holds (i.e., the SE is unique).\nCondition 1 states that, on average, the supplier\u2019s cost is lower than the retail price, eliminating trivial scenarios. Condition 2 states that the demand D may depend on the supplier\u2019s cost C only via the retail price P . Condition 3 is a mild technical condition guaranteeing that the learning problem is at least Lipschitz (see below). Essentially Assumption 2 implies that the conditions corresponding to Assumption 1 are satisfied for D with bounded support and guarantees that Theorem 1 can be applied, so that the learning problem is tractable.\nThe partial knowledge of the supplier and the retailer is formalized as follows.\nAssumption 3. The supplier has access to the marginal distribution of C, but not to that of (P,D); the retailer has access to the marginal of (P,D), but not to that of C.\nNamely, the supplier has more information on the production cost, while the retailer has more information about the direct interaction with the market.\nThe retailer\u2019s strategy is to best-respond to any wholesale price. Note that q\u22c6w = BR(w) can be computed exactly via Equation (3) thanks to Assumptions 2 and 3.\nUnder these assumptions, and given that the retailer best-responds, the supplier can compute their expected cost E[C] and is left with solving a zeroth-order Lipschitz optimization problem (i.e., maximizing Equation (4)) without the knowledge of the Lipschitz constant of its objective. This can be done with a simple explore-then-commit algorithm (Algorithm 1), which we assume to be the supplier\u2019s strategy.\nTheorem 2. Under Assumptions 2 and 3, for any horizon T , if the supplier runs Algorithm 1 with input T and the retailer best responds, then\nE [ \u03c3(w\u22c6; q\u22c6, C) ] \u2212 1\nT\nT\u2211\nt=1\nE [ \u03c3(wt; qt, Ct) ] \u2264 ( 1\u2212 E[C] E[P ]L + 2 ) T\u22121/2, (6)\nwhere (w\u22c6, q\u22c6) is the unique SE of the stage game. Also, for all sufficiently large T :\ninput: Time horizon T for t = 1, . . . , \u230aT 1/2\u230b do Select the wholesale price wt := t/ ( \u230aT 1/2\u230b+ 1 )\nObserve the quantity qt end for t = \u230aT 1/2\u230b+ 1, . . . , T do Select a wholesale price wt = ws\u22c6 , where s\n\u22c6 \u2208 argmax s=1,...,\u230aT 1/2\u230b\nqs ( ws \u2212 E[C] )\nObserve the quantity qt end\nAlgorithm 1: Explore-Then-Commit\n1. E [ \u03c1(q\u22c6;w\u22c6, P,D) ] \u2212 1T \u2211T t=1 E [ \u03c1(qt;wt, Pt, Dt) ] \u2264 ( L\u22121 + 2 ) T\u22121/2. 2. \u2225\u2225(w\u22c6, q\u22c6)\u2212 (wT , qT ) \u2225\u2225 1 \u2264 ( (E[P ]L)\u22121 + 1 ) T\u22121/2.\nItem 2 shows last-iterate convergence to the unique SE (in contrast to the weaker time-average convergence that is typically obtained in regret minimization). Equation (6) and Item 1 give regret guarantees for both the supplier and the retailer. This shows that not only the utilities of both the supplier and the retailer converge to that of the SE, but that both their cumulative utilities match (up to lower-order terms) those that would be gathered by consistently selecting the SE (w\u22c6, q\u22c6) at all time steps with full knowledge of D. Crucially, note that while for the supplier it is possible to obtain finite-time regret guarantees, for the retailer these only hold asymptotically.\nProof. By Theorem 1, under Assumption 2, the best response function BR defined in (3) maps each wholesale price w into its unique best-response q\u22c6w = BR(w), which the retailer (R) can compute by Assumption 3. Since R is best responding, the utility of the supplier (S), for any w > 0, is q\u22c6w ( w \u2212 E[C] ) . Note that, under Assumption 2, the unique SE is (w\u22c6, q\u22c6w\u22c6), where w \u22c6 is the unique maximizer of q\u22c6w ( w \u2212 E[C] ) , which S cannot compute directly because Assumption 3 is not sufficient for S to determine q\u22c6w. However, S can calculate E[C] with the knowledge of the marginal distribution of C. Hence, S gets a noise-free evaluation q\u22c6wt ( wt \u2212 E[C] ) at each round t, after selecting the wholesale price wt for the round.\nNow, note that S\u2019s objective w 7\u2192 q\u22c6w ( w \u2212 E[C] ) is Lipschitz. Indeed, recalling (4), (5), (15), and\nAssumption 2, we get that, for any w \u2208 (0, 1), \u2223\u2223\u2223\u2223 \u2202 \u2202w q\u22c6w ( w \u2212 E[C] )\u2223\u2223\u2223\u2223 \u2264 1 E[P ]L \u00b7 ( 1\u2212 E[C] ) + 1.\nSince for any time horizon T , S selects the best point in a grid of step-size at most T\u22121/2, we have that\nlim T\u2192\u221e |wT \u2212 w\u22c6| \u2264 lim T\u2192\u221e T\u22121/2 = 0. (7)\nThen, using again (5), (15) and Assumption 2, we get that R\u2019s best response function BR is 1/(E[P ]L)Lipschitz. Recalling (2), we also have that for any fixed wholesale price w, R\u2019s instantaneous utility at time t, q 7\u2192 E [ \u03c1(q;w,Pt, Dt) ] is 1-Lipschitz. Hence, for any time horizon T , we have that\nlim T\u2192\u221e |qT \u2212 q\u22c6w\u22c6 | \u2264 lim T\u2192\u221e T\u22121/2/(E[P ]L) = 0. (8)\nPutting (8) and (7) together, gives Item 2. Equation (6) is an immediate consequence of the ( (1 \u2212 E[C])/(E[P ]L)+1 ) -Lipschitzness of S\u2019s objective w 7\u2192 q\u22c6w ( w\u2212E[C] ) . Item 1 is an immediate consequence of\nthe (L\u22121+1)-Lipschitzness of R\u2019s utility w 7\u2192 E [ \u03c1(q\u22c6w;w,Pt, Dt) ] as a function of the wholesale price (which follows directly from the chain rule).\nThe previous result yields sublinear regret guarantees for the supplier even when S is oblivious to the expected retail price E[P ] and the lower bound L on the conditional density of the demand given the retail price. Since the Lipschitz constant of S\u2019s objective is a deterministic function of E[C], L, and E[P ], the reader might wonder if improved regret guarantees could be achieved if these quantities were known to S. We show now that this is indeed the case.\nWe refine Assumption 3 as follows.\nAssumption 4. The supplier has access to the E[C], L, and E[P ]. Moreover, the retailer has access to the marginal distribution of (P,D).\nUnder Assumptions 2 and 4, and given that the R best-responds to any wholesale price w, the supplier can compute their expected cost and solve their zeroth-order Lipschitz optimization problem with the knowledge of (an upper bound of) the Lipschitz constant of its objective. This can be done with the Piyavskii\u2013Shubert algorithm (Algorithm 2). We now assume that this is S\u2019s strategy.\ninput: Time horizon T , Lipschitz constant M > 0 initialization: Let w1 := 1 for t = 1, . . . , T do\nSelect the wholesale price wt Observe the quantity qt Update the proxy function \u03c1\u0302t(\u00b7) := mins\u2208[t] { qt ( (\u00b7)\u2212 E[C] ) +M \u2225\u2225ws \u2212 (\u00b7) \u2225\u2225}\nLet wt+1 \u2208 argmaxw\u2208[0,1] \u03c1\u0302t(w) end\nAlgorithm 2: Piyavskii\u2013Shubert\nThe Piyavskii\u2013Shubert algorithm has been known for half a century Piyavskii [1972], Shubert [1972], but only recently it was proven that it enjoys outstanding theoretical guarantees for its query complexity, regret, and robustness Bouttier et al. [2022], Gokcesu and Gokcesu [2021]. In particular, the following theorem follows directly by specializing [Bouttier et al., 2022, Theorem 3.5] and [Gokcesu and Gokcesu, 2021, Theorem 1] to our setting.\nTheorem 3 (Bouttier et al. [2022], Gokcesu and Gokcesu [2021]). Under Assumptions 2 and 4, for any horizon T , if the supplier runs Algorithm 2 with inputs T and M := (1\u2212E[C])/(E[P ]L)+ 1, and the retailer best responds, then the function w 7\u2192 q\u22c6w ( w \u2212 E[C] ) is M -Lipschitz and, for all t \u2208 [T ],\nmax w\u2208[0,1]\n{ q\u22c6w ( w \u2212 E[C] )} \u2212 q\u22c6wt ( wt \u2212 E[C] ) \u2264 9M log2(Mt)\nt\nmax w\u2208[0,1]\n{ q\u22c6w ( w \u2212 E[C] )} \u2212 1\nT\nT\u2211\nt=1\nq\u22c6wt ( wt \u2212 E[C] ) \u2264 2M ln(4T )\nT\nTheorem 3 allows us to prove the following result.\nTheorem 4. Under Assumptions 2 and 4, for any horizon T , if the supplier runs Algorithm 2 with inputs T and M := (1\u2212 E[C])/(E[P ]L) + 1, and the retailer best responds, then:\nE [ \u03c3(w\u22c6; q\u22c6, C) ] \u2212 1\nT\nT\u2211\nt=1\nE [ \u03c3(wt; qt, Ct) ] \u2264 2M ln(4T )\nT (9)\nwhere (w\u22c6, q\u22c6) is the unique SE of the stage game. Moreover,\n1. limT\u2192\u221e\n( E [ \u03c1(q\u22c6;w\u22c6, P,D) ] \u2212 1T \u2211T t=1 E [ \u03c1(qt;wt, Pt, Dt) ]) = 0\n2. limT\u2192\u221e \u2225\u2225(w\u22c6, q\u22c6)\u2212 (wT , qT ) \u2225\u2225 1 = 0\nProof. Proceeding as in the proof of Theorem 2 and applying Theorem 3, we get that the retailer\u2019s instantaneous utility at time t, q 7\u2192 E [ \u03c1(q;w,Pt, Dt) ] is 1-Lipschitz for any fixed wholesale price w, and the supplier\u2019s\ninstantaneous utility at time t, w 7\u2192 q\u22c6w ( w \u2212 E[Ct] ) is M -Lipschitz, where q\u22c6w is defined as in (3), for all w \u2208 [0, 1]. As above, under Assumption 2, the unique SE is precisely (w\u22c6, q\u22c6w\u22c6), where w\u22c6 is the unique maximizer of q\u22c6w ( w \u2212 E[C] ) . Applying again Theorem 3, we obtain immediately the result.\nConvergence to SE with no information. If the retailer had access to the distribution D, or at least to the marginal distribution of (P,D), they could best-respond to the retailer\u2019s move wt at each time t, as described in Sections 2 and 3. Since, in this section, none of these is available to R, we assume that the retailer acts according to the next-best available strategy, i.e., best-responding to an empirical distribution that can be maintained by gathering samples. In the online learning literature, this strategy is known as Follow-the-Leader (FTL) and is detailed in Algorithm 3. For t = 1, R picks a quantity at random and\ninput: Time horizon T \u2265 12 initialization: Let Q := { 1/(\u2308T 1/3\u2309+ 1), . . . , \u2308T 1/3\u2309/(\u2308T 1/3\u2309+ 1) } Observe the wholesale price W1 Draw a quantity Q1 from Q uniformly at random Observe the demand D1 and the retail price P1 for t = 2, 3, . . . do\nObserve the wholesale price Wt Select a quantity Qt \u2208 argmaxq\u2208Q ( 1 t\u22121 \u2211t\u22121 s=1 min{q,Ds}Ps \u2212 qWt )\nObserve the demand Dt and the retail price Pt end\nAlgorithm 3: Follow-the-Leader (FTL)\nobserves the demand D1. During each time step t \u2265 2, define, for all w, q \u2208 [0, 1], the auxiliary function\n\u03c1\u0302t(w, q) := 1\nt\u2212 1\nt\u22121\u2211\ns=1\nmin{q,Ds}Ps \u2212 qw.\nNote that this is not built to maximize the empirical average of the utility gained in last t\u22121 interactions, i.e., it differs from q 7\u2192 1t\u22121 \u2211t\u22121 s=1 ( min{q, Ds}Ps\u2212qWs ) . Indeed, the retailer is not interested in maximizing their expected utilities at time steps t but rather, their expected utility givenWt. Equivalently stated, the retailer is not maximizing an expected revenue computed with respect to the empirical distribution of (C1, P1, D1,W1), . . . , (Ct\u22121, Pt\u22121, Dt\u22121,Wt\u22121) at time t, but rather, that of (C1, P1, D1,Wt), . . . , (Ct\u22121, Pt\u22121, Dt\u22121,Wt) given Wt. This way, \u03c1\u0302t(w, q) is an unbiased estimate of E [ \u03c1(q;w,Pt, Dt) ] for all w, q \u2265 0 and t \u2265 2, which in turn implies that E [ \u03c1\u0302t(Wt, q) | Wt ] = E [ uS(q;Wt, Pt, Dt) | Wt ] for all q \u2265 0 and t \u2265 2. This corresponds precisely to the instantaneous objective of the retailer. Therefore, naturally, the choice of a discretized retailer at time t \u2265 2 is\nQt \u2208 argmax q\u2208Q\n( \u03c1\u0302t(Wt, q) ) = argmax\nq\u2208Q\n( 1\nt\u2212 1\nt\u22121\u2211\ns=1\nmin{q, Ds}Ps \u2212 qWt ) .\nSimilarly to the previous section, we assume here that the supplier adopts an Explore-Then-Commit strategy (Algorithm 4), with the caveat that, in this section, the expected production cost E[C] is not available to S but has to be estimated.\nTheorem 5. Under Assumption 2, for any horizon T \u2265 12, if the supplier runs Explore-Then-Commit (Algorithm 4) with input T and the retailer runs Follow-the-Leader (Algorithm 3) with input T , then:\nE [ \u03c3(w\u22c6; q\u22c6, C) ] \u2212 1\nT\nT\u2211\nt=1\nE [ \u03c3(Wt;Qt, Ct) ] \u2264 ( 16 +\n1\u2212 E[C] E[P ]L + 7 \u221a lnT\n) T\u22121/3, (10)\ninput: Time horizon T \u2265 12 for t = 1, . . . , \u2308T 1/3 + 1\u2309 do\nfor s = 1, . . . , \u2308T 1/3\u2309 do Select the wholesale price W(t\u22121)\u2308T 1/3\u2309+s := s/ ( \u2308T 1/3\u2309+ 1 )\nObserve the quantity Q(t\u22121)\u2308T 1/3\u2309+s and production cost C(t\u22121)\u2308T 1/3\u2309+s end\nend Compute S\u22c6 \u2208 argmaxs=\u2308T 1/3\u23092+1,...,\u2308T 1/3+1\u2309\u2308T 1/3\u2309 Qs ( Ws \u2212 1\u2308T 1/3\u23092 \u2211\u2308T 1/3\u23092 j=1 Cj ) for t = \u2308T 1/3 + 1\u2309\u2308T 1/3\u2309+ 1, . . . , T do Select the wholesale price Wt := WS\u22c6\nObserve the quantity Qt end\nAlgorithm 4: Explore-Then-Commit (without knowledge of E[C])\nwhere (w\u22c6, q\u22c6) is the unique SE of the stage game. Moreover:\n1. limT\u2192\u221e\n( E [ \u03c1(q\u22c6;w\u22c6, P,D) ] \u2212 1T \u2211T t=1 E [ \u03c1(Qt;Wt, Pt, Dt | Wt) ]) = 0 w.p. 1.\n2. limT\u2192\u221e \u2225\u2225(w\u22c6, q\u22c6)\u2212 (WT , QT ) \u2225\u2225 1 = 0 with probability 1.\nProof. Fix any time horizon T \u2265 12. Proceeding as in the proof of Theorem 2 and applying Theorem 3, we get that the retailer\u2019s instantaneous utility at time t, q 7\u2192 E [ \u03c1(q;w,Pt, Dt) ] is 1-Lipschitz for any fixed wholesale price w, and the supplier\u2019s instantaneous utility at time t, w 7\u2192 q\u22c6w ( w\u2212E[Ct] ) isM -Lipschitz, where\nq\u22c6w is defined as in (3), for all w \u2208 [0, 1], and M := ( 1\u2212 E[C] ) / ( E[P ]L ) + 1. As above, under Assumption 2, the unique SE is precisely (w\u22c6, q\u22c6w\u22c6), where w \u22c6 is the unique maximizer of w 7\u2192 q\u22c6w ( w \u2212 E[C] ) . Now, fix an\narbitrary \u03b4 \u2208 ( 0, 1/\u2308T 1/3 + 1\u2309 ) . Observing that for any t \u2265 2, given Wt, the retailer\u2019s quantity Qt is the argmax of an empirical average translated by a constant, applying Hoeffding\u2019s inequality \u2308T 1/3 + 1\u2309 times and the fact that the retailer\u2019s discretization has step-size 1/\u2308T 1/3 + 1\u2309, we obtain that\n\u2223\u2223\u2223Qs \u2212 q\u22c6s/(\u2308T 1/3\u2309+1) \u2223\u2223\u2223 \u2264\n\u221a ln 2/\u03b4\n2\u2308T 1/3\u23092 + 1 \u2308T 1/3 + 1\u2309 (11)\nfor all s = \u2308T 1/3\u23092 + 1, . . . , \u2308T 1/3 + 1\u2309\u2308T 1/3\u2309 \u2223\u2223\u2223\u2223\u2223\u2223 1 \u2308T 1/3\u23092 \u2308T 1/3\u23092\u2211\nj=1\nCj \u2212 E[C] \u2223\u2223\u2223\u2223\u2223\u2223 \u2264 \u221a ln 2/\u03b4 2\u2308T 1/3\u23092 (12)\nhold simultaneously with probability at least 1\u2212 \u2308T 1/3 + 1\u2309\u03b4. Thus, \u2223\u2223\u2223\u2223\u2223\u2223 Qs  Ws \u2212 1 \u2308T 1/3\u23092 \u2308T 1/3\u23092\u2211\nj=1\nCj  \u2212 q\u22c6Ws ( Ws \u2212 E[C] ) \u2223\u2223\u2223\u2223\u2223\u2223 \u2264 2 \u221a 2 ln 2/\u03b4 \u2308T 1/3\u23092 + 3 \u2308T 1/3 + 1\u2309\nhold simultaneously for all s = \u2308T 1/3\u23092 + 1, . . . , \u2308T 1/3 + 1\u2309\u2308T 1/3\u2309, with probability at least 1\u2212 \u2308T 1/3 + 1\u2309\u03b4. Consequently, letting\nw\u0303 \u2208 argmax w\u2208{1/\u2308T 1/3+1\u2309,...,\u2308T 1/3\u2309/\u2308T 1/3+1\u2309}\nq\u22c6w ( w \u2212 E[C] )\nand given that the supplier\u2019s discretization has a step size 1/\u2308T 1/3+1\u2309 and w 7\u2192 q\u22c6w ( w\u2212E[C] ) is M -Lipschitz,\nthe triangular inequality yields, for any t \u2265 \u2308T 1/3 + 1\u2309\u2308T 1/3\u2309+ 1, \u2223\u2223\u2223\u2223\u2223\u2223 Qt  Wt \u2212 1 \u2308T 1/3\u23092 \u2308T 1/3\u23092\u2211\nj=1\nCj\n \u2212 E [ \u03c3(w\u22c6, q\u22c6, C) ] \u2223\u2223\u2223\u2223\u2223\u2223 \u2264\n\u2264 \u2223\u2223\u2223\u2223\u2223\u2223 Qt  WS\u22c6 \u2212\n1 \u2308T 1/3\u23092 \u2308T 1/3\u23092\u2211\nj=1\nCj  \u2212 q\u22c6WS\u22c6 ( WS\u22c6 \u2212 E[C] ) \u2223\u2223\u2223\u2223\u2223\u2223\n+ \u2223\u2223\u2223q\u22c6WS\u22c6 ( WS\u22c6 \u2212 E[C] ) \u2212 q\u22c6w\u0303 ( w\u0303 \u2212 E[C] )\u2223\u2223\u2223+ \u2223\u2223\u2223q\u22c6w\u0303 ( w\u0303 \u2212 E[C] ) \u2212 E [ \u03c3(w\u22c6, q\u22c6, C) ]\u2223\u2223\u2223 \u2264 6 \u221a 2 ln 2/\u03b4\n\u2308T 1/3\u23092 + 9 +M \u2308T 1/3 + 1\u2309\nwith probability at least 1 \u2212 \u2308T 1/3 + 1\u2309\u03b4. Charging regret 1 to the supplier for the first \u2308T 1/3 + 1\u2309\u2308T 1/3\u2309 rounds, then summing the previous bound over all remaining rounds and upper bounding T\u2212\u2308T 1/3+1\u2309\u2308T 1/3\u2309 with T yields\nE [ \u03c3(w\u22c6; q\u22c6, C) ] \u2212 1\nT\nT\u2211\nt=1\n\u03c3(Wt;Qt, Ct)\n\u2264 \u2308T 1/3 + 1\u2309\u2308T 1/3\u2309\nT + 6\n\u221a 2 ln 2/\u03b4\n\u2308T 1/3\u23092 + 9 +M\n\u2308T 1/3 + 1\u2309 \u2264 ( 15 +M + 6 \u221a 2 ln 2/\u03b4 ) T\u22121/3\nwith probability at least 1\u2212\u2308T 1/3+1\u2309\u03b4. Thus, (10) follows directly by choosing, e.g., \u03b4 = 2T\u22122/3 and upper bounding 12/ \u221a 3 with 7. The proof of Item 2 is a simple consequence of (11) and the fact that the retailer\u2019s best response function BR is Lipschitz. Finally, Item 1 follows directly by (11), (12), and Lipschitzness of the retailer\u2019s utility w 7\u2192 E [ \u03c1(q\u22c6w;w,Pt, Dt) ] as a function of the wholesale price (which is implied by the chain rule).\nAgain, the previous result shows last-iterate convergence of the supply chain to the unique SE (in contrast to the weaker time-average convergence that is typically obtained in regret minimization). In contrast to our previous results, this theorem holds under much weaker assumptions on the prior knowledge of R and S. Indeed, we do not assume anything other than the knowledge that the support of D is included in [0, 1]3."
        },
        {
            "heading": "4 Vertical Integration",
            "text": "Our supply chain model can be cast in different market scenarios. For example, the supply chain can be vertically integrated or not, and the retailer can be a price-taker or a price-maker. In Sections 2 and 3 we studied the case of a price-taking retailer without vertical integration. In this section, instead, we study a model with a price-making retailer and a vertically integrated supply chain. This means that the supplier sells to the retailer at production cost, and the entire burden of maximizing the utility of the pair is delegated to the retailer, who is also choosing the retail price. Note that vertical integration goes beyond the case of a company controlling their supply chain. Indeed, as we mentioned in the introduction, a popular strategy in supply-chain revenue-maximization is to sign revenue-sharing contracts in which the supplier sells to the retailer at production cost, but then the profit of the retailer is split between the two according to previously-agreed percentages Cachon and Lariviere [2005].\nThe vertical integration assumption simplifies the interactions between the supplier and retailer, and allows in turn to generalize the learning protocol we discussed in Section 3 to a more challenging setting. In particular, we are be able to study an adversarial (rather than a stochastic) environment and a censored\nfeedback (where the retailer does not get to see the demand if it was higher than the quantity they purchased). Moreover, we consider the more complex case of a price-taking retailer, who is simultaneously optimizing both the quantity and the retail price (in contrast to the previous sections, where the retail price was determined exogenously and the retailer only had to optimize over one variable).\nMore precisely, each instance of our problem is characterized by two arbitrarily chosen unknown sequences. The first one is a sequence (ct)t\u2208N of real numbers in [0, 1], representing the production costs of the supplier, and the second one is a sequence (dt)t\u2208N of non-increasing [0, 1]-valued functions defined on [0, 1], representing the demand of the market as a function of the retail price.\nWe study the following online protocol. At each round t = 1, 2, . . . :\n1. The supplier (S) reveals the wholesale price wt := ct to the retailer (R).\n2. R buys a (possibly random) quantity Qt \u2208 [0, 1] paying Qtct to S.\n3. R selects a (possibly random) retail price Pt \u2208 [0, 1].\n4. The market buys a quantity min{Qt, dt(Pt)}, paying min{Qt, dt(Pt)}Pt to R.\nSimilarly to Section 3, we define the auxiliary function\n\u03c1(p, q;w, d) := min{q, d}p\u2212 qw \u2200(p, q, w, d) \u2208 [0, 1]4.\nNote that, in this case, we do not require an auxiliary function to compute the utility of the supplier because their individual utility is zero by definition. Crucially, this implies that the social welfare coincides with the utility of the retailer. The goal of the supply-chain is then to minimize, for any time horizon T , the regret\nRT := sup (p,q)\u2208[0,1]2\nT\u2211\nt=1\nE [ \u03c1 ( p, q; ct, dt(p) )] \u2212 T\u2211\nt=1\nE [ \u03c1 ( Pt, Qt; ct, dt(Pt) )] ,\nwhere the expectation is with respect to the algorithm\u2019s internal randomization. In words, this corresponds to a long-term social welfare that is as close as possible to what an omniscient learner could achieve, if they had perfect a priory knowledge of the sequences (ct)t\u2208N, (dt)t\u2208N and unlimited computing power.\nConsider now a special case of the above protocol, where the demand function dt at each round t takes the form\ndt(p) = { 1 if p \u2264 vt, 0 if p > vt.\nHere (vt)t\u2208N is an unknown arbitrary sequence of real numbers in [0, 1], representing the market valuation for a unit quantity of the good. In this case, the choice q = 1 is trivially optimal, and so the retailer must only choose the retail price pt. When qt = 1, the terms qtct cancels out in the regret, and so we can write the social welfare as\n\u03c1(p, 1; ct, dt) = p min{1, dt(p)} = { p if p \u2264 vt, 0 if p > vt.\nThis shows that a special case of our online protocol is the adversarial posted-price problem studied in Kleinberg and Leighton [2003], where they prove a lower bound on the regret of order \u2126(T 2/3).\nWorst-case analysis of the retailer\u2019s regret. In this section, we show that for adversarial demand and production cost, the supply-chain regret is RT = O\u0303 ( T 2/3 ) , thus matching (up to logarithmic factors) the lower bound for the posted-price problem.\nIt is easy to see that the function \u03c1 satisfies the following Lipschitz conditions for all p, q, c, d \u2208 [0, 1],\n\u03c1(p+ \u03b4, q; c, d) \u2264 \u03c1(p, q; c, d) + \u03b4 \u2200\u03b4 \u2208 [0, 1\u2212 p], \u03c1(p, q + \u03b4; c, d) \u2264 \u03c1(p, q; c, d) + \u03b4 \u2200\u03b4 \u2208 [0, 1\u2212 q].\nWe introduce the Exp3-VI algorithm, a variant of the Exp3 algorithm for multi-armed bandits Auer et al. [2002] adapted to exploit the richer feedback available in the supply chain setting\u2014see also Cesa-Bianchi et al. [2017] for a similar application of Exp3 to second-price auctions. The algorithm uses a discretization of the action space [0, 1]2 in K(K +1) actions (p\u2032i, q \u2032 j), where i \u2208 [K], j \u2208 [K +1], and K = \u23081/\u03b3\u2309, for some \u03b3 > 0. We set p\u2032k, q \u2032 k = (k \u2212 1)\u03b3 for k \u2208 [K] and q\u2032K+1 = 1. Because of the Lipschitz conditions, for any c, d \u2208 [0, 1],\nmax p,q\u2208[0,1]\nT\u2211\nt=1\n\u03c1(p, q; c, d) \u2264 max 1\u2264i,j\u2264K\nT\u2211\nt=1\n\u03c1(p\u2032i, q \u2032 j ; c, d) + 2\u03b3 T. (13)\nIn order to simplify the presentation of the analysis, [\u22121, 1]-valued revenues are turned into [0, 1]-valued losses. We set, for all t \u2208 N, i \u2208 [K], and j \u2208 [K + 1]\n\u2113t(i, j) := 1\u2212 \u03c1t\n( p\u2032i, q \u2032 j , ct, dt(p \u2032 i) )\n2 .\nNote that Exp3-VI (Algorithm 5) chooses (pt, qt) without using the knowledge of ct; as a consequence, it\ninput: Time horizon T , exploration parameter \u03b3 > 0, learning rate \u03b7 > 0 initialization: Set K := \u23081/\u03b3\u2309 and the uniform distribution \u03c01 over the decision space V := [K]\u00d7 [K + 1] for t = 1, . . . , T do\nObserve the supplier\u2019s cost c1 Draw (It, Jt) \u223c \u00b5t, where the distribution \u00b5t is defined by\n\u00b5t(i, j) := (1\u2212 \u03b3)\u03c0t(i, j) + \u03b3\nK I{j = K + 1} \u2200(i, j) \u2208 V\nSelect the retail price Pt := (It \u2212 1)\u03b3 and the quantity Qt := (Jt \u2212 1)\u03b3 Observe the censored demand min { Qt, dt(Pt) } For each (i, j) \u2208 V , compute the estimated loss\n\u2113\u0302t(i, j) = \u2113t(i, j)\u2211K+1\nk=j \u00b5t(i, k) I{i = It, j \u2264 Jt}\nFor each (i, j) \u2208 V , compute the new probability assignment\n\u03c0t+1(i, j) = exp\n( \u2212 \u03b7\u2211ts=1 \u2113\u0302s(i, j) ) \u2211\n(m,n)\u2208V exp ( \u2212\u03b7\u2211ts=1 \u2113\u0302s(m,n) )\nend\nAlgorithm 5: Exp3-VI\ncould be that pt < ct. In words, it is possible that the supply chain sells at a loss in some time steps. This is a common occurrence that sharply distinguishes repeated from one-shot settings, especially in non-stochastic environments in which some unpredictability of the learner is necessary to combat the adversarial behavior of Nature.\nWe are now ready to prove the main theorem of this section.\nTheorem 6. For any time horizon T , the Exp3-VI algorithm run with inputs T , \u03b3 > 0, and \u03b7 > 0 satisfies\nRT \u2264 \u03b7KT ln eK\n\u03b3 +\n4 ln(K + 1)\n\u03b7 + 4\u03b3T. (14)"
        },
        {
            "heading": "In particular, if \u03b3 := T\u22121/3 and \u03b7 := T\u22122/3 , then",
            "text": "RT \u2264 3(4 + 3 lnT )T 2/3\n(more accurate choices of \u03b3 and \u03b7 could lead to better leading constants).\nThe proof follows the same lines as the regret analysis of Exp3. The key change is a tighter control of the variance term allowed by the feedback structure. For all technical details, see Appendix A.4."
        },
        {
            "heading": "A Missing proofs and technical details",
            "text": ""
        },
        {
            "heading": "A.1 Proof of Lemma 1",
            "text": "By Assumption 1 combined with the Leibniz integral rule, the function x 7\u2192 E [ PF\u0304 (x | C,P ) ] is differentiable, with derivative\nx 7\u2192 \u2202 \u2202x\nE [ PF\u0304 (x | C,P ) ] = \u2212E [ Pf(x | C,P ) ] (15)\nTo verify that the derivative is strictly negative, simply note that Assumption 1 states that f(d | c, p) > 0 for all (c, p, d) \u2208 [0,\u221e)3 and E[P ] > E[C] \u2265 0; hence the random variable P is strictly positive on a set with strictly positive measure. This implies that h(x) in (1) is strictly decreasing, and therefore invertible. By the inverse function theorem, we conclude that the inverse h\u22121 is also differentiable with strictly negative derivative, hence strictly decreasing."
        },
        {
            "heading": "A.2 A sufficient condition for Theorem 1",
            "text": "Proposition 1. The second condition of Theorem 1 is satisfied when (C,P ) is deterministic (i.e., (C,P ) = (c, p) for 0 < c < p) and D has a Weibull distribution with nondecreasing failure rate. That is, the cumulative distribution function of D is\nF (x) = 1\u2212 e\u2212(\u03bb/x)k\nfor x \u2265 0, where \u03bb > 0 and k \u2265 1.\nProof. It suffices to show that the following L(w) is concave for w \u2208 (c, p):\nL(w) = g(w) (w \u2212 c)\nSince the second derivative is\nL\u2032\u2032(w) = g\u2032\u2032(w) (w \u2212 c) + 2 g\u2032(w)\nand\nh(x) = p F\u0304 (x) = p e\u2212(x/\u03bb) k\ng(w) = h\u22121(w) = \u03bb (ln(p/w))1/k\ng\u2032(w) = \u2212 \u03bb k w (ln(p/w))1/k\u22121\ng\u2032\u2032(w) = \u03bb k w2 (ln(p/w))1/k\u22121 \u2212 \u03bb (k \u2212 1) k2 w2 (ln(p/w))1/k\u22122,\nwe have\nL\u2032\u2032(w) = \u2212 \u03bb k2w2 (ln(p/w))1/k\u22122 (k (w + c) ln(p/w) + (k \u2212 1) (w \u2212 c))\n\u2264 0\nwhere the last inequality holds when \u03bb > 0, k \u2265 1, w \u2208 (c, p)."
        },
        {
            "heading": "A.3 Price of anarchy of the Stackelberg Equilibrium",
            "text": "In Section 3, we presented several algorithmic ideas that allow supplier and retailer to gain an amount of revenue close to that of the SE. This is possible despite the two players not cooperating with each other but trying to instead maximize their own individual utilities. Given that, even in this circumstance, the utility\nat the equilibrium is achievable, it is now natural to investigate if the equilibrium is efficient. In this section, we will show that, in general, this is not the case.\nConsider the supply-chain stage game introduced in Section 2. Fix any 0 < c < p < 1 and let D := \u03b4c \u2297 \u03b4p \u2297 U be the product distribution of a Dirac at c, a Dirac at p, and a uniform distribution U on [0, 1]. Note that D satisfies our base Assumption 1, with f(d) \u2261 f(d | c, p) \u2261 1 , for all d \u2208 [0, 1]. Let, as usual, F (d) = \u222b d 0 f(x) dx = d, for all d \u2208 [0, 1].\nIn words, we are considering the one-shot supply-chain game, where the supplier\u2019s cost c and the retail price p are deterministic and the demand D is uniform on [0, 1], and we are assuming that c, p,U and D are common knowledge to both players.\nIn this instance, the function h \u2014recall (1)\u2014 is defined, for any x \u2208 [0, 1], by h(x) = p \u2212 px and its inverse g \u2261 h\u22121 is given, for any w \u2208 [0, p], by g(w) = (p\u2212 w)/p.\nWe show now that the condition in Item 2 of Theorem 1 holds. Indeed, for any w \u2208 (c, p),\n\u2212 \u22121/p (p\u2212 w)/p\ufe38 \ufe37\ufe37 \ufe38\n\u2212g\u2032(w)/g(w)\n= 1 w \u2212 c \u21d0\u21d2 w \u2212 c p = p\u2212 w p \u21d0\u21d2 w = c+ p 2 \u2208 (c, p)\nHence, the set argmaxw\u2208{(c+p)/2} g(w)(w \u2212 c) is trivially a singleton, and, applying Theorem 1, the supplychain stage game admits the unique SE\n(w\u22c6, q\u22c6) =\n( c+ p\n2 , p\u2212 c 2p\n)\nThe expected social welfare is, for any strategy profile (w, q) \u2208 [0, 1]2,\nuS(w, q) + uR(w, q) = pE[min(q,D)]\u2212 cq = pq(1\u2212 q/2)\u2212 cq\nwhich, under vertical integration, is maximized at (w\u0303, q\u0303), where w\u0303 is any wholesale price in [0, 1] and\nq\u0303 = p\u2212 c p\nNote that, in equilibrium, the retailer orders a quantity that is smaller than the quantity that would be ordered under vertical integration. Moreover, under vertical integration, the optimal social welfare would be\nuS(w\u0303, q\u0303) + uR(w\u0303, q\u0303) = (p\u2212 c)2\n2p\nwhile the equilibrium social welfare is\nuS(w \u22c6, q\u22c6) + uR(w \u22c6, q\u22c6) = 3\n4 (p\u2212 c)2 2p .\nThus, in this game the price of anarchy is 4/3."
        },
        {
            "heading": "A.4 Proof of Theorem 6",
            "text": "Before stating the main result of this section, we prove an auxiliary lemma.\nLemma 2. Let T \u2208 N, V be a finite set of cardinality K, and fix any sequence \u21131, . . . , \u2113T of nonnegative functions \u2113t : V \u2192 R. Fix \u03b7 > 0 and let w1, . . . , wT be functions wt : V \u2192 R such that, for any i \u2208 V ,\nwt(i) =\n{ 1 if t = 1\nexp ( \u2212\u03b7\u2211t\u22121s=1 \u2113s(i) ) otherwise"
        },
        {
            "heading": "Then, for all k \u2208 V ,",
            "text": "T\u2211\nt=1\n\u2211\ni\u2208V\npt(i)\u2113t(i)\u2212 T\u2211\nt=1\n\u2113t(k) \u2264 lnK\n\u03b7 +\n\u03b7\n2\nT\u2211\nt=1\n\u2211\ni\u2208V\npt(i)\u2113t(i) 2\nwhere pt(i) = wt(i)/Wt and Wt = \u2211\nj\u2208V wt(j) for all i \u2208 V and t \u2208 [T ]. Proof. For all t \u2208 [T ], we have\nWt+1 Wt\n= \u2211\ni\u2208V\nwt+1(i) Wt = \u2211\ni\u2208V\nwt(i) Wt exp ( \u2212\u03b7 \u2113t(i) ) = \u2211\ni\u2208V\npt(i) exp ( \u2212\u03b7 \u2113t(i) )\n\u2264 \u2211\ni\u2208V\npt(i) ( 1\u2212 \u03b7 \u2113t(i) + ( \u03b7 \u2113t(i) )2\n2\n) (using e\u2212x \u2264 1\u2212 x+ x2/2 for all x \u2265 0)\n\u2264 1\u2212 \u03b7 \u2211\ni\u2208V\npt(i)\u2113t(i) + \u03b72\n2\n\u2211\ni\u2208V\npt(i)\u2113t(i) 2\nTaking logs, upper bounding x 7\u2192 log(1 + x) with x 7\u2192 x, and summing over t \u2208 [T ] yields\nln WT+1 W1\n\u2264 \u2212\u03b7 T\u2211\nt=1\n\u2211\ni\u2208V\npt(i)\u2113t(i) + \u03b72\n2\nT\u2211\nt=1\n\u2211\ni\u2208V\npt(i)\u2113t(i) 2 (16)\nMoreover, we also have, for any k \u2208 V ,\nln WT+1 W1 \u2265 ln wT+1(k) W1\n= \u2212\u03b7 T\u2211\nt=1\n\u2113t(k)\u2212 lnK (17)\nPutting (16) and (17) together, dividing both sides by \u03b7 > 0, and rearranging gives the desired result.\nWe can now prove Theorem 6.\nProof of Theorem 6. We first control the regret associated with actions drawn from \u03c0t (the regret associated with \u00b5t will be studied as a direct consequence). Fix a time horizon T , any (m,n) \u2208 V , and an arbitrary sequence of realizations (I1, J1), . . . , (IT , JT ). This determines the nonnegative estimated losses \u2113\u0302t(i, j) and we can apply Lemma 2 to the probabilities \u03c0t to get\nT\u2211\nt=1\n\u2211\n(i,j)\u2208V\n\u03c0t(i, j)\u2113\u0302t(i, j)\u2212 T\u2211\nt=1\n\u2113\u0302t(m,n) \u2264 \u03b7\n2\nT\u2211\nt=1\n\u2211\n(i,j)\u2208V\n\u03c0t(i, j)\u2113\u0302t(i, j) 2 +\n2 ln(K + 1)\n\u03b7 (18)\nWriting Et\u22121[\u00b7] for the expectation conditioned on (I1, J1), . . . , (It\u22121, Jt\u22121), we note that, for any (i, j) \u2208 V , Et\u22121 [ \u2113\u0302t(i, j) ] = \u2113t(i, j) (i.e., \u2113\u0302t(i, j) is an unbiased estimate of \u2113t(i, j)) and\nEt\u22121 [ \u03c0t(i, j)\u2113\u0302t(i, j) 2 ] = \u03c0t(i, j)\u2113t(i, j) 2\n\u2211K+1 k=j \u00b5t(i, k) \u2264 \u00b5t(i, j) (1 \u2212 \u03b3)\u2211K+1k=j \u00b5t(i, k)\nwhere we used the definition of \u00b5t and the fact that \u2113t(i, j) 2 \u2264 1 by construction. Therefore, taking expectations on both sides of (18) implies\nE\n  T\u2211\nt=1\n\u2211\n(i,j)\u2208V\n\u03c0t(i, j)\u2113t(i, j)\n \u2212 T\u2211\nt=1\n\u2113t(m,n)\n\u2264 \u03b7 2(1\u2212 \u03b3)\nT\u2211\nt=1\nK\u2211\ni=1\nE\n  K+1\u2211\nj=1 \u00b5t(i, j)\u2211K+1 k=j \u00b5t(i, k)\n + 2 ln(K + 1)\n\u03b7\nFor any t \u2208 [T ], i \u2208 [K], j \u2208 [K + 1], set st(j) := \u2211K+1\nk=j \u00b5t(i, k). Using st(j), we can upper bound the sum inside the expectation with an integral. For any fixed i \u2208 [K], we have\nK+1\u2211\nj=1 \u00b5t(i, j)\u2211K+1 k=j \u00b5t(i, k) = 1 +\nK\u2211\nj=1\nst(j)\u2212 st(j + 1) st(j) = 1 +\nK\u2211\nj=1\n\u222b st(j)\nst(j+1)\ndx\nst(j)\n\u2264 1 + K\u2211\nj=1\n\u222b st(j)\nst(j+1)\ndx\nx = 1 +\n\u222b st(1)\n\u00b5t(i,K+1)\ndx\nx \u2264 1\u2212 ln\u00b5t(i,K + 1) \u2264 1 + ln\nK\n\u03b3\nwhere we used st(1) \u2264 1 and \u00b5t(i,K + 1) \u2265 \u03b3/K. Therefore, substituting into the previous bound, we get\nE\n  T\u2211\nt=1\n\u2211\n(i,j)\u2208V\n\u03c0t(i, j)\u2113t(i, j)\n \u2212 T\u2211\nt=1\n\u2113t(m,n) \u2264 \u03b7KT 2(1\u2212 \u03b3) ln eK \u03b3 + 2 ln(K + 1) \u03b7 (19)\nWe now control the regret of (It, Jt) drawn from \u00b5t. We have\nE\n[ T\u2211\nt=1\n\u2113t(It, Jt)\n] \u2212 T\u2211\nt=1\n\u2113t(m,n)\n= E T\u2211\nt=1\n  K\u2211\ni=1\n (1\u2212 \u03b3) K+1\u2211\nj=1\n\u03c0t(i, j)\u2113t(i, j) + \u03b3\nK \u2113t(i,K + 1)\n   \u2212 T\u2211\nt=1\n\u2113t(m,n)\n\u2264 (1\u2212 \u03b3)E\n  T\u2211\nt=1\n\u2211\n(i,j)\u2208V\n\u03c0t(i, j)\u2113t(i, j)\n + \u03b3T \u2212 T\u2211\nt=1\n\u2113t(m,n)\n\u2264 \u03b7KT 2 ln eK \u03b3 + 2 ln(K + 1) \u03b7 + \u03b3T\nwhere the last inequality is by (19). Translating back from losses to revenues, and using (13), gives\nRT \u2264 \u03b7KT ln eK\n\u03b3 +\n4 ln(K + 1)\n\u03b7 + 4\u03b3T\nRecalling that K = \u23081/\u03b3\u2309, and choosing \u03b3 = T\u22121/3 and \u03b7 = T\u22122/3 concludes the proof."
        }
    ],
    "title": "Online Learning in Supply-Chain Games\u2217",
    "year": 2022
}
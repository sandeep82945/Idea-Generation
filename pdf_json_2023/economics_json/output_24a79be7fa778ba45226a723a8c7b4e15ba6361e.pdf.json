{
    "abstractText": "Mobility-as-a-Service (MaaS) systems are two-sided markets, with two mutually exclusive sets of agents, i.e., travelers/users and operators, forming a mobility ecosystem in which multiple operators compete or cooperate to serve customers under a governing platform provider. This study proposes a MaaS platform equilibrium model based on many-to-many assignment games incorporating both fixed-route transit services and mobility-on-demand (MOD) services. The matching problem is formulated as a convex multicommodity flow network design problem under congestion (modeling the cost of accessing MOD services). The local stability conditions reflect a generalization of Wardrop\u2019s principles that include operator decisions. Due to the presence of congestion, the problem may result in non-stable designs, and a subsidy mechanism from the platform is proposed to guarantee local stability. A new exact solution algorithm to the matching problem is proposed based on a branch and bound framework with a FrankWolfe algorithm integrated with Lagrangian relaxation and subgradient optimization, which guarantees the optimality of the matching problem but not stability. A heuristic which integrates stability conditions and subsidy design is proposed, which reaches either the optimal MaaS platform equilibrium solution with global stability, or a feasible locally stable solution that may require subsidy. For the heuristic, a worst-case bound and condition for obtaining an exact solution are both identified. Two sets of reproducible numerical experiments are conducted. The first, on a toy network, verifies the model and algorithm, and illustrates the differences between local and global stability. The second, on an expanded Sioux Falls network with 82 nodes and 748 links, derives generalizable insights about the model for coopetitive interdependencies between operators sharing the platform, handling congestion effects in MOD services, effects of local stability on investment impacts, and illustrating inequities that may arise under heterogeneous populations.",
    "authors": [
        {
            "affiliations": [],
            "name": "Bingqing Liu"
        },
        {
            "affiliations": [],
            "name": "Joseph Y. J. Chow"
        }
    ],
    "id": "SP:c901bad686b53a8c67ee30a03208dda1fbe0945b",
    "references": [
        {
            "authors": [
                "T.G. Crainic",
                "A. Frangioni",
                "B. Gendron"
            ],
            "title": "Bundle-based relaxation methods for multicommodity capacitated fixed charge network design",
            "venue": "Discrete Applied Mathematics,",
            "year": 2001
        },
        {
            "authors": [
                "T.G. Crainic",
                "J.M. Rousseau"
            ],
            "title": "Multicommodity, multimode freight transportation: A general modeling and algorithmic framework for the service network design problem",
            "venue": "Transportation Research Part B: Methodological,",
            "year": 1986
        },
        {
            "authors": [
                "J.Y.J. Chow"
            ],
            "title": "Informed Urban transport systems: Classic and emerging mobility methods toward smart cities",
            "year": 2018
        },
        {
            "authors": [
                "D. Correa",
                "J.Y. Chow",
                "K. Ozbay"
            ],
            "title": "Spatial-Dynamic Matching Equilibrium Models of New York City Taxi and Uber Markets",
            "venue": "Journal of Transportation Engineering, Part A: Systems,",
            "year": 2021
        },
        {
            "authors": [
                "F. Dandl",
                "R. Engelhardt",
                "M. Hyland",
                "G. Tilg",
                "K. Bogenberger",
                "H.S. Mahmassani"
            ],
            "title": "Regulating mobility-on-demand services: Tri-level model and Bayesian optimization solution approach",
            "venue": "Transportation Research Part C: Emerging Technologies,",
            "year": 2021
        },
        {
            "authors": [
                "S. Djavadian",
                "J.Y. Chow"
            ],
            "title": "An agent-based day-to-day adjustment process for modeling \u2018Mobility as a Service\u2019with a two-sided flexible transport market",
            "venue": "Transportation research part B: methodological,",
            "year": 2017
        },
        {
            "authors": [
                "J.J.M. Derks",
                "S.H. Tijs"
            ],
            "title": "Stable outcomes for multi-commodity flow games (No. f643e6a4cf4e-4892-8f00-ca8a1a337dd9)",
            "venue": "Tilburg University, School of Economics and Management",
            "year": 1985
        },
        {
            "authors": [
                "M. Frank",
                "P. Wolfe"
            ],
            "title": "An algorithm for quadratic programming",
            "venue": "Naval research logistics quarterly,",
            "year": 1956
        },
        {
            "authors": [
                "D. Gale",
                "L.S. Shapley"
            ],
            "title": "College admissions and the stability of marriage",
            "venue": "The American Mathematical Monthly,",
            "year": 1962
        },
        {
            "authors": [
                "B. Gendron",
                "M. Larose"
            ],
            "title": "Branch-and-price-and-cut for large-scale multicommodity capacitated fixed-charge network design",
            "venue": "EURO Journal on Computational Optimization,",
            "year": 2014
        },
        {
            "authors": [
                "R. Kucharski",
                "O. Cats"
            ],
            "title": "Simulating two-sided mobility platforms with MaaSSim",
            "venue": "PloS one,",
            "year": 2022
        },
        {
            "authors": [
                "A.H. Land",
                "A.G. Doig"
            ],
            "title": "An automatic method for solving discrete programming problems",
            "venue": "Years of Integer Programming",
            "year": 2010
        },
        {
            "authors": [
                "L.J. LeBlanc",
                "E.K. Morlok",
                "W.P. Pierskalla"
            ],
            "title": "An efficient approach to solving the road network equilibrium traffic assignment problem",
            "venue": "Transportation Research",
            "year": 1975
        },
        {
            "authors": [
                "T.L. Magnanti",
                "R.T. Wong"
            ],
            "title": "Network design and transportation planning: Models and algorithms",
            "venue": "Transportation science,",
            "year": 1984
        },
        {
            "authors": [
                "T.Y. Ma",
                "J.Y. Chow",
                "S. Klein",
                "Z. Ma"
            ],
            "title": "A user-operator assignment game with heterogeneous user groups for empirical evaluation of a microtransit service in Luxembourg",
            "venue": "Transportmetrica A: Transport Science,",
            "year": 2021
        },
        {
            "authors": [
                "A. Najmi",
                "T.H. Rashidi",
                "T. Waller"
            ],
            "title": "A multimodal multi-provider market equilibrium model: A game-theoretic approach",
            "venue": "Transportation Research Part C: Emerging Technologies,",
            "year": 2023
        },
        {
            "authors": [
                "T.P. Pantelidis",
                "J.Y. Chow",
                "S. Rasulkhani"
            ],
            "title": "A many-to-many assignment game and stable outcome algorithm to evaluate collaborative mobility-as-a-service platforms",
            "venue": "Transportation Research Part B: Methodological,",
            "year": 2020
        },
        {
            "authors": [
                "D.C. Paraskevopoulos",
                "S. G\u00fcrel",
                "T. Bekta\u015f"
            ],
            "title": "The congested multicommodity network design problem",
            "venue": "Transportation Research Part E: Logistics and Transportation Review,",
            "year": 2016
        },
        {
            "authors": [
                "S. Rasulkhani",
                "J.Y. Chow"
            ],
            "title": "Route-cost-assignment with joint user and operator behavior as a many-to-one stable matching assignment game",
            "venue": "Transportation Research Part B: Methodological,",
            "year": 2019
        },
        {
            "authors": [
                "J.C. Rochet",
                "J. Tirole"
            ],
            "title": "Two\u2010sided markets: a progress report",
            "venue": "The RAND journal of economics,",
            "year": 2006
        },
        {
            "authors": [
                "A.E. Roth",
                "M. Sotomayor"
            ],
            "title": "Two-sided matching",
            "venue": "Handbook of game theory with economic applications,",
            "year": 1992
        },
        {
            "authors": [
                "S. Shaheen",
                "A. Cohen",
                "N. Chan",
                "A. Bansal"
            ],
            "title": "Sharing strategies: carsharing, shared micromobility (bikesharing and scooter sharing), transportation network companies, microtransit, and other innovative mobility modes. In Transportation, land use, and environmental planning (pp. 237-262)",
            "year": 2020
        },
        {
            "authors": [
                "L.S. Shapley",
                "M. Shubik"
            ],
            "title": "The assignment game I: The core",
            "venue": "International Journal of game theory,",
            "year": 1971
        },
        {
            "authors": [
                "Y. Sheffi"
            ],
            "title": "Urban transportation networks (Vol",
            "year": 1985
        },
        {
            "authors": [
                "M.J. Smith"
            ],
            "title": "Two alternative definitions of traffic equilibrium",
            "venue": "Transportation Research Part B: Methodological,",
            "year": 1984
        },
        {
            "authors": [
                "M. Sotomayor"
            ],
            "title": "The multiple partners game. In Equilibrium and dynamics (pp. 322-354)",
            "year": 1992
        },
        {
            "authors": [
                "M. Sotomayor"
            ],
            "title": "The lattice structure of the set of stable outcomes of the multiple partners assignment",
            "venue": "game. International Journal of Game Theory,",
            "year": 1999
        },
        {
            "authors": [
                "M. Sotomayor"
            ],
            "title": "Connecting the cooperative and competitive structures of the multiple-partners assignment game",
            "venue": "Journal of Economic Theory,",
            "year": 2007
        },
        {
            "authors": [
                "A. Tafreshian",
                "N. Masoud"
            ],
            "title": "Using subsidies to stabilize peer-to-peer ridesharing markets with role assignment",
            "venue": "Transportation Research Part C: Emerging Technologies,",
            "year": 2020
        },
        {
            "authors": [
                "V.A. van den Berg",
                "H. Meurs",
                "E.T. Verhoef"
            ],
            "title": "Business models for Mobility as an Service (MaaS)",
            "venue": "Transportation Research Part B: Methodological,",
            "year": 2022
        },
        {
            "authors": [
                "D. Vignon",
                "Y. Yin",
                "J. Ke"
            ],
            "title": "Regulating the ride-hailing market in the age of uberization",
            "venue": "Transportation Research Part E: Logistics and Transportation Review,",
            "year": 2023
        },
        {
            "authors": [
                "J.G. Wardrop"
            ],
            "title": "Road paper. some theoretical aspects of road traffic research",
            "venue": "Proceedings of the institution of civil engineers,",
            "year": 1952
        },
        {
            "authors": [
                "Y.Z. Wong",
                "D.A. Hensher",
                "C. Mulley"
            ],
            "title": "Mobility as a service (MaaS): Charting a future context",
            "venue": "Transportation Research Part A: Policy and Practice,",
            "year": 2020
        },
        {
            "authors": [
                "H. Xi",
                "D. Aussel",
                "W. Liu",
                "S.T. Waller",
                "D. Rey"
            ],
            "title": "Single-leader multi-follower games for the regulation of two-sided mobility-as-a-service markets",
            "venue": "European Journal of Operational Research",
            "year": 2022
        },
        {
            "authors": [
                "Z. Xu",
                "Y. Yin",
                "X. Chao",
                "H. Zhu",
                "J. Ye"
            ],
            "title": "2021a. A generalized fluid model of ride-hailing systems",
            "venue": "Transportation Research Part B: Methodological,",
            "year": 2021
        },
        {
            "authors": [
                "Z. Xu",
                "Z. Chen",
                "Y. Yin",
                "J. Ye"
            ],
            "title": "2021b. Equilibrium analysis of urban traffic networks with ridesourcing services",
            "venue": "Transportation science,",
            "year": 2021
        },
        {
            "authors": [
                "H. Yang",
                "Y.W. Lau",
                "S.C. Wong",
                "H.K. Lo"
            ],
            "title": "A macroscopic taxi model for passenger demand, taxi utilization and level of services",
            "year": 2000
        },
        {
            "authors": [
                "H. Yang",
                "S.C. Wong",
                "K.I. Wong"
            ],
            "title": "Demand\u2013supply equilibrium of taxi services in a network under competition and regulation",
            "venue": "Transportation Research Part B: Methodological,",
            "year": 2002
        },
        {
            "authors": [
                "H. Yang",
                "C.W. Leung",
                "S.C. Wong",
                "M.G. Bell"
            ],
            "title": "Equilibria of bilateral taxi\u2013customer searching and meeting on networks",
            "venue": "Transportation Research Part B: Methodological,",
            "year": 2010
        },
        {
            "authors": [
                "H. Yang",
                "T. Yang"
            ],
            "title": "Equilibrium properties of taxi markets with search frictions",
            "venue": "Transportation Research Part B: Methodological,",
            "year": 2011
        },
        {
            "authors": [
                "L. Zha",
                "Y. Yin",
                "Z. Xu"
            ],
            "title": "Geometric matching and spatial pricing in ride-sourcing markets",
            "venue": "Transportation Research Part C: Emerging Technologies,",
            "year": 2018
        },
        {
            "authors": [
                "K. Zhang",
                "Y.M. Nie"
            ],
            "title": "Inter-platform competition in a regulated ride-hail market with pooling",
            "venue": "Transportation Research Part E: Logistics and Transportation Review,",
            "year": 2021
        },
        {
            "authors": [
                "J. Zhou",
                "W.H. Lam",
                "B.G. Heydecker"
            ],
            "title": "The generalized Nash equilibrium model for oligopolistic transit market with elastic demand",
            "venue": "Transportation Research Part B: Methodological,",
            "year": 2005
        },
        {
            "authors": [
                "Y. Zhou",
                "H. Yang",
                "J. Ke",
                "H. Wang",
                "X. Li"
            ],
            "title": "Competition and third-party platform-integration in ride-sourcing markets",
            "venue": "Transportation Research Part B: Methodological,",
            "year": 2022
        }
    ],
    "sections": [
        {
            "text": "Mobility-as-a-Service (MaaS) systems are two-sided markets, with two mutually exclusive sets of agents, i.e., travelers/users and operators, forming a mobility ecosystem in which multiple operators compete or cooperate to serve customers under a governing platform provider. This study proposes a MaaS platform equilibrium model based on many-to-many assignment games incorporating both fixed-route transit services and mobility-on-demand (MOD) services. The matching problem is formulated as a convex multicommodity flow network design problem under congestion (modeling the cost of accessing MOD services). The local stability conditions reflect a generalization of Wardrop\u2019s principles that include operator decisions. Due to the presence of congestion, the problem may result in non-stable designs, and a subsidy mechanism from the platform is proposed to guarantee local stability. A new exact solution algorithm to the matching problem is proposed based on a branch and bound framework with a FrankWolfe algorithm integrated with Lagrangian relaxation and subgradient optimization, which guarantees the optimality of the matching problem but not stability. A heuristic which integrates stability conditions and subsidy design is proposed, which reaches either the optimal MaaS platform equilibrium solution with global stability, or a feasible locally stable solution that may require subsidy. For the heuristic, a worst-case bound and condition for obtaining an exact solution are both identified. Two sets of reproducible numerical experiments are conducted. The first, on a toy network, verifies the model and algorithm, and illustrates the differences between local and global stability. The second, on an expanded Sioux Falls network with 82 nodes and 748 links, derives generalizable insights about the model for coopetitive interdependencies between operators sharing the platform, handling congestion effects in MOD services, effects of local stability on investment impacts, and illustrating inequities that may arise under heterogeneous populations.\nKeywords: many-to-many assignment game, Mobility-as-a-Service, Mobility-on-Demand, Branch and bound, Frank-Wolfe, Lagrange relaxation, subsidy"
        },
        {
            "heading": "1 Introduction",
            "text": "With the development of information and communication technologies (ICT), new mobility services are emerging rapidly in recent years, such as bikeshare, micromobility, carshare, ride-hail and shared taxis, microtransit, and peer-to-peer ridesharing. Urban passenger transportation is being reshaped from a carbased paradigm to a multimodal one (Shaheen et al., 2020; Chow, 2018). The emergence of new mobility services gave rise to the concept of Mobiltiy-as-a-Service (MaaS) (Djavadian and Chow, 2017; Wong et al., 2020; Pantelidis et al., 2020), which provides mobility services through a joint digital or cyberphysical gateway that enables users to plan, book, and pay for multiple types of mobility services. Recent examples of such platforms include Moovit, Moovel, Whim, Masabi, HaCon, Cubic, FlexDanmark, MovePGH, and Cal-ITP, whose roles are not to operate mobility services but to serve as aggregators of different services (van den Berg et at., 2022; Xi et al., 2022; Zhou et al., 2022). A \u201cplatform\u201d refers not to software, but to the broader definition of a type of \u201ctwo-sided\u201d market where buyers and sellers are simultaneously managed (Rochet and Tirole, 2006), which we adopt in this study.\nWith more mobility providers entering the market, there\u2019s a growing need for managing the operation\nof mobility providers in MaaS platforms including Mobility-on-Demand (MOD) services that use ICTs. Existence of traditional transit and MOD providers result in MaaS ecosystems with higher levels of flexibility and volatility (Chow, 2018; Djavadian and Chow, 2017; Wong et al., 2020; Pantelidis et al., 2020), potentially generating greater social welfare (Zhou et al., 2022). MaaS platforms are two-sided markets with two mutually exclusive sets of agents, i.e., users and operators. Evaluation of MaaS platforms depends on both users\u2019 route choices and operators\u2019 pricing and operation decisions. The emergent platform paradigm allows for such analysis.\nRasulkhani and Chow (2019) proposed a game-theoretic platform-based model of MaaS systems with\nunimodal trips, where each route is operated by one operator. Pantelidis et al. (2020) proposed a many-tomany assignment game method to model MaaS systems with multimodal trips, where each route can be operated by one or more fixed-route operators. The model consists of a matching problem modeled as a multicommodity capacitated fixed-charge network design problem (MCND) (Magnanti and Wong, 1984; Gendron and Larose, 2014), minimizing the sum of travel cost and operating cost (i.e. system cost). Corresponding to that problem\u2019s optimal solution is a set of stable outcomes that determines the requirements for different pricing mechanisms between the operators, the users, and the platform to ensure stability corresponding to the assignment.\nThere are three unresolved problems in the earlier work. First, only fixed-route mobility providers are\nmodeled in the research above. MOD providers operate within and between selected service regions with a selected fleet size. Instead of hard capacities, MOD services are characterized by flow-dependent congested wait times. Second, while earlier studies do allow for elastic demand where users choose not to participate in the system, this feature was never explored in depth to understand the consequences. Third, while Sotomayor (1992) has shown that many-to-many assignment games in general exhibit nonempty stable outcome spaces, the proposed problem with MOD services has a more complex structure which makes it unclear whether the nonempty property holds. We show that empty stable outcome spaces are possible, which leads to an empty stable outcome space issue for the optimal assignment. Pantelidis et al. (2020) did not propose any solution method to solve the matching problem, much less address stability constraints.\nWe propose new model extensions that substantially expand the applicability of the framework to\nMaaS analysis and design efforts. The matching model from Pantelidis et al. (2020) is extended into a nonlinear mixed integer programming problem that considers trade-offs between congestion in MOD service, capacities in fixed-route transit, and decisions from travelers and both sets of operators. An exact solution algorithm is proposed to solve the matching problem. The algorithm has a branch and bound framework. Each branch is solved through Lagrangian relaxation and subgradient optimization with a Frank-Wolfe algorithm in each iteration. To deal with nonempty outcome spaces, we modify the algorithm into a bounded heuristic to derive solutions with guaranteed stable outcomes. Two sets of numerical experiments are conducted to verify the model, the algorithms, and evaluate their effectiveness in analyzing a range of MaaS design and analysis scenarios. The larger example is based on an expanded Sioux Falls\nnetwork with 82 nodes and 722 links that includes four fixed-route operators and three MOD operators considering overlapping service regions.\nThe paper is structured as follows. Section 2 is the literature review. Section 3 introduces the\nassignment game models. Section 4 introduces the solution algorithms. Section 5 presents two numerical examples and analyses. Section 6 presents the conclusion."
        },
        {
            "heading": "2 Literature review",
            "text": "MaaS platforms consist of three sets of decision-makers: travelers, mobility operators (which can fall into fixed-route services or MOD services), and the platform regulator. The travelers decide which multimodal paths they want to take; the operators decide which routes or zones to serve, amount of line capacity or fleet sizing, and cost transfers with travelers (e.g. fares, transfers between operating costs and user costs such as using virtual stops with increased access time and reduced routing cost); platform regulators can subsidize different operators or travelers and may have control over the design of the market. In the case of public platform regulators, decisions can further extend to design of the built environment.\nThere are few studies that consider multiple operator settings, much less on MaaS platforms. Network\nflow games (e.g. Derks & Tijs, 1985) tend to consider only noncooperative behavior between operators and ignore traveler route decisions. Generalized Stackelberg games (e.g. Zhou et al., 2005) that have upper level noncooperative games between operators and lower level user equilibrium model also only consider noncooperative decisions, assume leader-follower role between operators and travelers, and lack the platform/regulator role. Dandl et al. (2021) proposed a tri-level modeling approach considering a single operator with equilibrium determined through simulation. The leader-follower role makes less sense in MaaS if the system behaves more as a two-sided market. Other simulation-based methods also exist (Djavadian and Chow, 2017; Kucharski and Cats, 2022). Zhou et al. (2022) study the specific case of multiple MOD (ride-sourcing) providers competing for travelers which does not consider potential for collaboration in a common platform. Van den berg et al. (2022) propose models for different operating structures of MaaS but they lack network effects. Najmi et al. (2023) model the equilibrium of multimodal markets with multiple providers as a noncooperative game where every link in a road network has a cost of being served by a different mode/operator.\nMaaS platforms can be considered as assignment games. Operators are the \u201csellers\u201d, users are the\n\u201cbuyers\u201d, and the platform can find a role in the mechanism to determine the cost allocations, depending on their business model. An assignment game (Shapley and Shubik, 1971; Roth and Sotomayer,1992) is a special case of a stable matching problem (Gale and Shapley, 2013) in which utilities are transferable between buyers and sellers, where the matching is determined such that no one has incentive to break from their match. The availability of transferable utilities results in a space of outcomes of cost transfers between parties that would be stable. The game is defined by a matching problem and its corresponding stability conditions. The matching problem determines optimal matches while the corresponding set of stable cost allocation outcomes ensure that the optimal matching is also stable. Shapley and Shubik (1971) showed for the one-to-one assignment game, the matching problem is a linear program and the stable outcome subproblem is its dual, non-empty, and corresponds to the core. Sotomayor (1992) extended the problem to the \u201cmultiple partners game\u201d, which is a many-to-many assignment game. She showed that the set of stable outcomes for an optimal assignment is nonempty and is a lattice subset of the core (Sotomayor, 1999).\nThe assignment game has been adapted to model transportation services as many-to-one and many-to-\nmany assignment games. Each operator offers a service route that can match with multiple travelers up to a capacity (Rasulkhani and Chow, 2019) while travelers can transfer between multiple operators. The option for a traveler to match with multiple operators adds a layer of cooperation into the behavioral dynamics of this setting. Pantelidis et al. (2020) proposed a many-to-many assignment game model in which each buyer group is a distinct origin-destination-path, while each operator owns one or more links in a fixed-route service network (i.e. a link represents service from one origin to a destination, not a road segment). In that model, the matching problem is expanded from the assignment model in the one-to-one case (Shapley and Shubik, 1971) into a multicommodity network design (MCND) problem where buyers/travelers decide\npaths to take while sellers/operators decide which links to operate. Meanwhile, the complementary stable outcome set is expanded to account for effects of fixed costs of operating a link as well as the binding capacity effects on stability.\nThe model from Pantelidis et al. (2020) does not recognize MOD operators and their unique\ncharacteristics. For example, a MOD service is typically defined as a fleet operating within a service region in which a traveler engages with the system in real time. There can be congestion for users to access the service: the smaller the fleet, the longer it takes for a traveler to access the service. The earliest example models of MOD services involve taxis, using macroscopic cost functions to capture the impedances of matching passengers with drivers (Yang et al., 2000, 2002, 2010; Yang and Yang, 2011) which have been further extended to general ride-hail services (He and Shen, 2015; Zha et al., 2018; Xu et al., 2021a,b; Zhang and Nie, 2021; Correa et al., 2021; Vignon et al., 2023).\nExistence of a stable outcome depends on the complicated relationship between trip utility, travel cost,\noperating cost, and ownership of different parts of the network. If some matching pairs do not provide enough gain to be allocated between users and operators, the users may deviate from the routes selected in optimal matching or just end up unserved. Such issues can be solved by subsidizing the unstable matching pairs. More precisely, the MaaS platform/agencies can intervene by \u201cinjecting\u201d subsidies to the unstable matching pairs to increase their potential gain to make sure that no user deviates from the matching. Tafreshian and Masoud (2020) used a minimum subsidy problem to obtain a stable outcome for a matching with empty core in peer-to-peer ridesharing matching games, which shows that subsidization is an effective way of stabilizing matchings.\nThe most similar prior study is Xi et al. (2022), who proposed a bilevel problem in which the lower-\nlevel model is a two-sided market. Like our study, they make use of a branch-and-bound type algorithm and assume linear wait time functions for MOD services. There are several key differences from our work. First, their model does not consider multimodal collaboration between multiple operators to serve a single passenger; in other words, this assumption likens their model to a \u201ctransportation problem\u201d compared to our \u201cmulticommodity flow problem\u201d with transshipment locations. Second, their model assumes operators and platform regulators that use a specific cost allocation mechanism (NYOP auction) whereas our model is mechanism-agnostic. Third (and most importantly), their model lacks a spatial component: i.e. travelers do not have specific origins and destination; network effects capture only a wait time component that depends on all users without considering link capacities or proximity to other zones and providers. Their model can be an effective tool for high level policy decision support, but limits applicability to network analysis and design."
        },
        {
            "heading": "3 Proposed MaaS platform assignment game model",
            "text": "The goal of this study is to build a model that recognizes congested MOD operations so that trade-offs can be analyzed regarding routes served and capacities, service regions and fleet sizes, market entry, elastic user demand for the platform, and subsidies from the platform. The modeling framework takes the original model in Pantelidis et al. (2020) and significantly expands upon that. As the model considers both traveler assignment as well as operator design decisions and platform policies, we call this more generalized model a \u201cMaaS Platform Assignment Game\u201d. Consider a network managed by the MaaS platform initially defined as a directed graph \ud835\udc3a(\ud835\udc41, \ud835\udc34) serving a set of traveler OD pairs \ud835\udc46 traveling to/from centroids \ud835\udc41\ud835\udc4d \u2282 \ud835\udc41. There exists a set of fixed-route operators \ud835\udc44\ud835\udc39 such that each operator \ud835\udc53 \u2208 \ud835\udc44\ud835\udc39 owns one or more service links, \ud835\udc34\ud835\udc53 \u2286 \ud835\udc34\ud835\udc39. A node connecting two service links owned by different operators can be expanded using transfer links \ud835\udc59 \u2208 \ud835\udc340 owned by no operator. \ud835\udc340\ud835\udc53 denotes the transfer links to the services provided by operator \ud835\udc53 \u2208 \ud835\udc44\ud835\udc39 . Each fixed-route operator \ud835\udc53 decides whether to operate link \ud835\udc59 \u2208 \ud835\udc34\ud835\udc53 between nodes \ud835\udc56 and \ud835\udc57, and at what service frequency to operate on link \ud835\udc59 \u2208 \ud835\udc34\ud835\udc53. To model such decisions, multiple links \ud835\udc59 \u2208 \ud835\udc34\ud835\udc56\ud835\udc57\ud835\udc53 (\ud835\udc34\ud835\udc56\ud835\udc57\ud835\udc53 \u2286 \ud835\udc34\ud835\udc53 , \ud835\udc34\ud835\udc53 \u2286 \ud835\udc34\ud835\udc39) controlled by \ud835\udc66\ud835\udc59 \u2208 {0,1} are created connecting the same two nodes \ud835\udc56 and \ud835\udc57 to represent the frequency or line capacity options. Each parallel link \ud835\udc59 \u2208 \ud835\udc34\ud835\udc56\ud835\udc57\ud835\udc53 connecting \ud835\udc56, \ud835\udc57 is associated with a capacity \ud835\udc64\ud835\udc59, an operating cost \ud835\udc50\ud835\udc59, and\na travel disutility \ud835\udc61\ud835\udc59. Note that link travel disutilities here include disutilities of in-vehicle travel time and average wait time which is determined by service frequency. Parallel links with different frequencies have different travel disutilities and operating costs because increased frequency would reduce average wait time and increase operating cost. At most one of the parallel links can be chosen in each \ud835\udc34\ud835\udc56\ud835\udc57\ud835\udc53 . In practice, additional constraints can be added to fulfill other constraints of capacity selection, for example, ensuring that the same frequency/capacity is selected for service links that belong to the same line.\nMOD operators operate in regions instead of lines. Service region design can be modeled as choices\nof whether to provide service in a set of zones and choices of fleet size to deploy in the chosen zones. We define \ud835\udc44\ud835\udc40 as the set of MOD operators in the MaaS platform. Alternative service zones of MOD operator \ud835\udc53 \u2208 \ud835\udc44\ud835\udc40 are modeled as nodes using zone centroids \ud835\udc56 \u2208 \ud835\udc41\ud835\udc53\ud835\udc67 , \ud835\udc53 \u2208 \ud835\udc44\ud835\udc40. To represent wait/access cost of MOD services, MOD nodes are created separately from the MOD zone centroids; MOD zone centroids and fixed route links are all connected to origin-destination zone centroids through access/wait links.\nMOD services are provided between any pair of zones in the designed service region with a fleet size,\nwhich can be represented as complete subgraphs connecting all served zone centroids in the service region. If different fleet size options \u210e \u2208 \ud835\udc3b\ud835\udc53 are considered by an MOD operator \ud835\udc53 for a service region, different layers of complete subgraphs connecting different layers of MOD nodes are created to represent different fleet size options, each are connected with the MOD zone centroids with MOD access links. An MOD operator \ud835\udc53 operates with fleet size \u210e \u2208 \ud835\udc3b\ud835\udc53 in a complete subgraph of nodes \ud835\udc41\ud835\udc53\u210e connected to every other node via links \ud835\udc34\ud835\udc53\u210e = \ud835\udc41\ud835\udc53\u210e \u00d7 \ud835\udc41\ud835\udc53\u210e . In this case, each MOD node represents the combined choice of a zone and a fleet size as \ud835\udc63\ud835\udc56 \u2208 {0,1}, \ud835\udc56 \u2208 \ud835\udc41\ud835\udc53\u210e. MOD access links \ud835\udc340\ud835\udc53\u210e connect zone centroids \ud835\udc41\ud835\udc53\ud835\udc67 to MOD nodes \ud835\udc41\ud835\udc53\u210e, representing a wait/access cost given fleet size \u210e \u2208 \ud835\udc3b\ud835\udc53. The MOD access link set of operator \ud835\udc53 \u2208 \ud835\udc44\ud835\udc40 is \ud835\udc340\ud835\udc53 = \u22c3 \ud835\udc340\ud835\udc53\u210e\u210e\u2208\ud835\udc3b\ud835\udc53 , where the MOD access link set of all MOD operators is \ud835\udc340\ud835\udc40 = \u22c3 \ud835\udc340\ud835\udc53\ud835\udc53\u2208\ud835\udc44\ud835\udc40 . The MOD link set of MOD operator \ud835\udc53 \u2208 \ud835\udc44\ud835\udc40 is \ud835\udc34\ud835\udc53 = \u22c3 \ud835\udc34\ud835\udc53\u210e\u2208\ud835\udc3b\ud835\udc53 and MOD link set of all MOD operators is \ud835\udc34\ud835\udc40 = \u22c3 \ud835\udc34\ud835\udc53\ud835\udc53\u2208\ud835\udc44\ud835\udc40 . The MOD node set of MOD operator \ud835\udc53 \u2208 \ud835\udc44\ud835\udc40 is \ud835\udc41\ud835\udc53 = \u22c3 \ud835\udc41\ud835\udc53\u210e\u210e\u2208\ud835\udc3b\ud835\udc53 . The MOD link set of all MOD operators is \ud835\udc41\ud835\udc40 = \u22c3 \ud835\udc41\ud835\udc53\ud835\udc53\u2208\ud835\udc44\ud835\udc40 . A link set that consists of all links in the network is defined as \ud835\udc34 = \ud835\udc34\ud835\udc39 \u222a \ud835\udc340 \u222a \ud835\udc34\ud835\udc40 \u222a \ud835\udc340\ud835\udc40 \u222a \ud835\udc34\ud835\udc37. Fig. 1 shows how to develop the network combining different alterantive fixed-route frequency and MOD service fleet designs. If detailed demand with OD pairs of coordinates are modeled, street networks can be used to connect origins, destinations, fixed-route transit stations, and MOD service zone centroids, although computational trade-offs will need to be considered. Fig. 1 shows an example of the latter. Each user group \ud835\udc60 \u2208 \ud835\udc46 consists of a homogeneous population of travelers \ud835\udc51\ud835\udc60 corresponding to an OD pair, which can be further split into different classes of travelers per OD pair to model heterogeneity. Matching involves finding the link flows \ud835\udc65\ud835\udc60\ud835\udc59 of link \ud835\udc59 \u2208 \ud835\udc34 per user group \ud835\udc60 \u2208 \ud835\udc46 such that travelers\u2019 disutilities converge to a user equilibrium and operators\u2019 costs are minimized. Travelers of user group \ud835\udc60 \u2208 \ud835\udc46 are assumed to gain utility \ud835\udc48\ud835\udc60 upon completing their trip. Ma et al. (2021) provides an example of calibrating these utilities from existing travel modes. To allow for users to opt out of the MaaS platform, each OD pair \ud835\udc60 \u2208 \ud835\udc46 is connected by an uncapacitated dummy link \ud835\udc59 \u2208 \ud835\udc34\ud835\udc37 , associated with a travel disutility \ud835\udc61\ud835\udc60 \u2264 \ud835\udc48\ud835\udc60, 0 operating cost, and infinite capacity. Travelers using these links are assumed to be not participating in the platform, instead using external modes, a competing platform, or not traveling. If a choice model was estimated as a logit model and the respective utility functions normalized to the common currency, then the travel disutility \ud835\udc61\ud835\udc60 can be calibrated as the logsum of these external modes\u2019 utility functions.\nFor MOD access links, disutilities of wait/access time are modeled differently from the fixed-route\noperations. Similar to the literature on matching functions for taxi and ride-hailing services, \ud835\udf0f\ud835\udc59 is used for modeling traveler disutility as shown in Definition 1.\nDefinition 1. The matching friction between travelers and MOD services at MOD service zones is modeled as the travel disutilities of MOD access links \ud835\udc59 \u2208 \ud835\udc340\ud835\udc40, representing the steady-state average access/wait times at the MOD service zones. A macroscopic disutility function \ud835\udf0f\ud835\udc59(\u2211 \ud835\udc65\ud835\udc60\ud835\udc59\ud835\udc60 ; \u210e) is defined by Eq.(1).\n\ud835\udf0f\ud835\udc59 (\u2211 \ud835\udc65\ud835\udc60\ud835\udc59 \ud835\udc60 ; \u210e) = \ud835\udc4e1 (\u2211 \ud835\udc65\ud835\udc60\ud835\udc59 \ud835\udc60 )\n\ud835\udc4f1\n\u210e\ud835\udc4f2 (1)\nFor MOD access links, travel disutilities are nonlinear, exhibiting congestion effects due to queueing for MOD service but no capacity effects. For MOD operators, their operating costs include supporting travelers to traverse MOD links and infrastructure cost of MOD nodes. The infrastructure cost of a MOD node represents the cost of setting up a zone for service for a given fleet size \u210e (e.g. bike dock installation for bikesharing services), which is defined as a constant \ud835\udc5e\ud835\udc56 for MOD node \ud835\udc56 \u2208 \ud835\udc34\ud835\udc40.\nOperating costs of links are also defined similarly from the literature as shown in Definition 2.\nDefinition 2. Unit operating cost of MOD link \ud835\udc59 \u2208 \ud835\udc34\ud835\udc40 between two served zones is defined as \ud835\udc5a\ud835\udc59, that is calibrated by the fleet size of the operator and other possible factors (e.g. link travel cost) as shown in Eq. (2), where \ud835\udc4e2 > 0 and \ud835\udc4f3 > 0. The parameters imply that as fleet size and demand increase, the unit operating cost increases.\n\ud835\udc5a\ud835\udc59 (\u2211 \ud835\udc65\ud835\udc60\ud835\udc59 \ud835\udc60\n; \u210e) = \ud835\udc4e2\u210e \ud835\udc4f3 (2)\nSince fleet size \u210e is a constant for a MOD link \ud835\udc59 \u2208 \ud835\udc34\ud835\udc40 given the network structure, the unit operating cost for traversing two zones is a calibrated constant that varies for different fleet sizes.\nSince the assignment game assumes a transferable-utility game, all utility-related parameters use a\ncommon currency exchangeable between travelers and operators (e.g. dollars)."
        },
        {
            "heading": "3.1 Matching model considering fixed-route and MOD operators",
            "text": "The assignment game under these changes has the following nonlinear integer programming problem \ud835\udc3f1 in Eq. (3) as the new equilibrium matching problem.\nMatching problem \ud835\udc73\ud835\udfcf:\nmin \ud835\udc4d\ud835\udc3f1 = \u2211 \u2211 \ud835\udc61\ud835\udc59\ud835\udc65\ud835\udc60\ud835\udc59 \ud835\udc59\u2208\ud835\udc340\u222a\ud835\udc34\ud835\udc39\u222a\ud835\udc34\ud835\udc40\u222a\ud835\udc34\ud835\udc37\ud835\udc60\u2208\ud835\udc46\n+ \u2211 \u222b \ud835\udf0f\ud835\udc59(\ud835\udc64; \u210e)\ud835\udc51\ud835\udc64 \u2211 \ud835\udc65\ud835\udc60\ud835\udc59\ud835\udc60\u2208\ud835\udc46\n0\ud835\udc59\u2208\ud835\udc340\ud835\udc40\n+ \u2211 \ud835\udc50\ud835\udc59\ud835\udc66\ud835\udc59 \ud835\udc59\u2208\ud835\udc34\ud835\udc39 + \u2211 \u2211 \ud835\udc5a\ud835\udc59\ud835\udc65\ud835\udc60\ud835\udc59 \ud835\udc59\u2208\ud835\udc34\ud835\udc40\ud835\udc60\u2208\ud835\udc46\n+ \u2211 \ud835\udc5e\ud835\udc56\ud835\udc63\ud835\udc56 \ud835\udc56\u2208\ud835\udc41\ud835\udc40\n(3a)\nsubject to\n\u2211 \ud835\udc65\ud835\udc60\ud835\udc59 \ud835\udc59\u2208\ud835\udc34\ud835\udc56 + \u2212 \u2211 \ud835\udc65\ud835\udc60\ud835\udc59 \ud835\udc59\u2208\ud835\udc34\ud835\udc56 \u2212\n= { \ud835\udc51\ud835\udc60, \ud835\udc56 \u2208 \ud835\udc42\ud835\udc60,\n0, \ud835\udc5c\ud835\udc61\u210e\ud835\udc52\ud835\udc5f\ud835\udc64\ud835\udc56\ud835\udc60\ud835\udc52, \u2212\ud835\udc51\ud835\udc60, \ud835\udc56 \u2208 \ud835\udc37\ud835\udc60, \u2200\ud835\udc56 \u2208 \ud835\udc41, \u2200\ud835\udc60 \u2208 \ud835\udc46 (3b)\n\u2211 \ud835\udc65\ud835\udc60\ud835\udc59 \ud835\udc60\u2208\ud835\udc46 \u2264 \ud835\udc64\ud835\udc59\ud835\udc66\ud835\udc59 , \u2200\ud835\udc59 \u2208 \ud835\udc34\ud835\udc39 (\ud835\udf07\ud835\udc59) (3c)\n\u2211 \ud835\udc65\ud835\udc60\ud835\udc59 \ud835\udc60\u2208\ud835\udc46 \u2264 \u2211 \ud835\udc51\ud835\udc60 \ud835\udc60\u2208\ud835\udc46\n\ud835\udc63\ud835\udc56, \u2200\ud835\udc56 \u2208 \ud835\udc41\ud835\udc40 , \u2200\ud835\udc59 \u2208 \ud835\udc34\ud835\udc56 + (3d)\n\u2211 \ud835\udc66\ud835\udc59 \ud835\udc59\u2208\ud835\udc34\ud835\udc56\ud835\udc57\ud835\udc53 \u2264 1, \u2200\ud835\udc34\ud835\udc56\ud835\udc57\ud835\udc53 \u2286 \ud835\udc34\ud835\udc39 (3e)\n\ud835\udc63\ud835\udc56 + \ud835\udc63\ud835\udc57 \u2264 1, \u2200\ud835\udc56 \u2208 \ud835\udc41\ud835\udc53\u210e , \u2200\ud835\udc57 \u2208 \ud835\udc41\ud835\udc53\u210e\u2032 , \u2200(\u210e, \u210e \u2032) \u2208 \ud835\udc3b\ud835\udc53 \u00d7 \ud835\udc3b\ud835\udc53 , \u210e \u2260 \u210e\u2032, \u2200\ud835\udc53 \u2208 \ud835\udc44\ud835\udc40 (3f)\n\ud835\udc65\ud835\udc60\ud835\udc59 \u2265 0, \u2200\ud835\udc59 \u2208 \ud835\udc34, \u2200\ud835\udc60 \u2208 \ud835\udc46 (3g) \ud835\udc66\ud835\udc59 \u2208 {0,1}, \u2200\ud835\udc59 \u2208 \ud835\udc34\ud835\udc39 (3h) \ud835\udc63\ud835\udc56 \u2208 {0,1}, \u2200\ud835\udc56 \u2208 \ud835\udc41\ud835\udc40 (3i)\nEq. (3a) includes the term \u2211 \u222b \ud835\udf0f\ud835\udc59(\ud835\udc64; \u210e)\ud835\udc51\ud835\udc64 \u2211 \ud835\udc65\ud835\udc60\ud835\udc59\ud835\udc60\u2208\ud835\udc46\n0\ud835\udc59\u2208\ud835\udc340\ud835\udc40 to capture the user equilibrium under congestion\neffect for using MOD service. The objective represents selfish travelers and operators, where only travelers face congestion effects represented by Beckmann\u2019s formulation and the operating costs are agnostic to the cost allocation mechanism. Such structure allows us to find effective exact solutions for the problem in Section 4. Eq. (3b) are the flow conservation constraints, where the set of outbound links of node \ud835\udc56 is defined as \ud835\udc34\ud835\udc56 +, and the set of inbound links of node \ud835\udc56 is defined as \ud835\udc34\ud835\udc56 \u2212. Eq. (3c) are the capacity constraints with Lagrange multiplier \ud835\udf07\ud835\udc59. Eq. (3d) are the MOD node controlling constraints, which ensure that flows can only exist between two MOD nodes if both nodes are opened. Only when \ud835\udc63\ud835\udc56 = 1, can the flows on the outbound links of MOD node \ud835\udc56 be positive. Eq. (3e) ensures that only one service frequency/capacity is chosen for each fixed-route link (\ud835\udc56, \ud835\udc57) by operator \ud835\udc53. Eq. (3f) ensures that only one fleet size is chosen by each MOD operator. When \ud835\udc63\ud835\udc56 = 1, then \ud835\udc63\ud835\udc57 = 0 for all other nodes \ud835\udc57 owned by the same operator as \ud835\udc56 but associated with different fleet sizes. Eqs. (3g) \u2013 (3i) are non-negativity and binary constraints. The model is a nonlinear integer program; when travel costs are constant, it simplifies to an NP-hard MCND problem (Magnanti and Wong, 1984). This belongs to the class of convex multicommodity network design problems\n(Crainic and Rousseau, 1986; Paraskevopoulos et al., 2016), although those tend to consider a system optimal formulation and include both congestion and capacity effects on the same links whereas Eq. (3) does not."
        },
        {
            "heading": "3.2 Corresponding stability conditions",
            "text": "The stable outcome space corresponding to \ud835\udc3f1 is shown in Eqs. (4a) \u2013 (4f). In this study we focus on linkadditive pricing policy. We denote \ud835\udc5d\ud835\udc59 as the fare of link \ud835\udc59 and \ud835\udc62\ud835\udc60 as the payoff of a user on OD pair \ud835\udc60 \u2208 \ud835\udc46. The variables \ud835\udc65\ud835\udc59\ud835\udc60 \u2217 , \ud835\udc66\ud835\udc59 \u2217, \ud835\udc63\ud835\udc56 \u2217 and \ud835\udf07\ud835\udc59 \u2217 represent the optimal flow on link \ud835\udc59 \u2208 \ud835\udc34 on OD pair \ud835\udc60 \u2208 \ud835\udc46 , optimal operation choice of fixed-route link \ud835\udc59 \u2208 \ud835\udc34\ud835\udc39, optimal operation choice of MOD node \ud835\udc59 \u2208 \ud835\udc41\ud835\udc40, and Lagrange multiplier of fixed-route link \ud835\udc59 \u2208 \ud835\udc34\ud835\udc39 from the matching problem \ud835\udc3f1. \ud835\udc45\ud835\udc60 \u2217 is the set of optimal paths for user \ud835\udc60 \u2208 \ud835\udc46 corresponding to the solution of Eq. (3). \ud835\udc45\ud835\udc60 is the set of all paths connecting OD pair \ud835\udc60 \u2208 \ud835\udc46. \ud835\udc34\ud835\udc5f denotes the set of links that compose of one or more matched paths \ud835\udc5f \u2208 \ud835\udc45\ud835\udc60\n\u2217, \ud835\udc60 \u2208 \ud835\udc46. \ud835\udc34\ud835\udc5f\u2032 denotes the set of links that compose an unmatched path \ud835\udc5f\u2032 \u2208 \ud835\udc45\ud835\udc60\\\ud835\udc45\ud835\udc60\n\u2217, \ud835\udc60 \u2208 \ud835\udc46. Eqs. (4a) \u2013 (4b) represent minimum operator costs. Eq. (4c) ensures utility conservation. Eq. (4d) ensures that an outcome is locally stable, i.e. there is no incentive for a single traveler to switch to another path.\n\u2211 \ud835\udc5d\ud835\udc59 \u2211 \ud835\udc65\ud835\udc60\ud835\udc59 \u2217 \ud835\udc60\u2208\ud835\udc46\ud835\udc59\u2208\ud835\udc34\ud835\udc53 \u2265 \u2211 \ud835\udc50\ud835\udc59 \u2217\ud835\udc66\ud835\udc59 \u2217 \ud835\udc59\u2208\ud835\udc34\ud835\udc53 , \u2200\ud835\udc53 \u2208 \ud835\udc44\ud835\udc39 (4a)\n\u2211 \ud835\udc5d\ud835\udc59 \u2211 \ud835\udc65\ud835\udc59\ud835\udc60 \u2217\n\ud835\udc60\u2208\ud835\udc46\ud835\udc59\u2208\ud835\udc340\ud835\udc53\n\u2265 \u2211 \u2211 \ud835\udc5a\ud835\udc59\ud835\udc65\ud835\udc60\ud835\udc59 \u2217\n\ud835\udc60\u2208\ud835\udc46\ud835\udc59\u2208\ud835\udc34\ud835\udc53\n+ \u2211 \ud835\udc5e\ud835\udc56\ud835\udc63\ud835\udc56 \u2217\n\ud835\udc56\u2208\ud835\udc41\ud835\udc53\n, \u2200\ud835\udc53 \u2208 \ud835\udc44\ud835\udc40 (4b)\n\ud835\udc62\ud835\udc60 + \u2211 \ud835\udc5d\ud835\udc59 \ud835\udc59\u2208\ud835\udc34\ud835\udc5f = \ud835\udc48\ud835\udc60 \u2212 ( \u2211 \ud835\udc61\ud835\udc59 \ud835\udc59\u2208\ud835\udc34\ud835\udc5f\u2229(\ud835\udc340\u2229\ud835\udc34\ud835\udc39\u222a\ud835\udc34\ud835\udc37\u222a\ud835\udc34\ud835\udc40)\n+ \u2211 \ud835\udf0f\ud835\udc59 (\u2211 \ud835\udc65\ud835\udc59\ud835\udc60 \u2217\n\ud835\udc60\u2208\ud835\udc46\n; \u210e)\n\ud835\udc59\u2208\ud835\udc34\ud835\udc5f\u2229\ud835\udc340\ud835\udc40\n) , \u2200\ud835\udc5f \u2208 \ud835\udc45\ud835\udc60 \u2217, \ud835\udc60 \u2208 \ud835\udc46 (4c)\n\ud835\udc62\ud835\udc60 + \u2211 \ud835\udc5d\ud835\udc59 \ud835\udc59\u2208\ud835\udc34\ud835\udc5f\u2032 \u2265 \ud835\udc48\ud835\udc60\n\u2212 ( \u2211 (\ud835\udc61\ud835\udc59 + \ud835\udf07\ud835\udc59 \u2217 + \ud835\udc50\ud835\udc59(1 \u2212 \ud835\udc66\ud835\udc59 \u2217))\n\ud835\udc59\u2208\ud835\udc34\ud835\udc5f\u2032\u2229(\ud835\udc340\u222a\ud835\udc34\ud835\udc39\u222a\ud835\udc34\ud835\udc37\u222a\ud835\udc34\ud835\udc40)\n+ \u2211 \ud835\udf0f\ud835\udc59 (\u2211 \ud835\udc65\ud835\udc59\ud835\udc60 \u2217 + 1\n\ud835\udc60\u2208\ud835\udc46\n; \u210e)\n\ud835\udc59\u2208\ud835\udc34\ud835\udc5f\u2032\u2229\ud835\udc340\ud835\udc40\n+ \u2211 \ud835\udc5a\ud835\udc59 \ud835\udc59\u2208\ud835\udc34\ud835\udc5f\u2032\u2229\ud835\udc34\ud835\udc40\n+ \u2211 \ud835\udc5e\ud835\udc56(1 \u2212 \ud835\udc63\ud835\udc56 \u2217)\n\ud835\udc56\u2208\ud835\udc41\ud835\udc5f\u2032\u2229\ud835\udc41\ud835\udc40\n) , \u2200\ud835\udc5f\u2032 \u2208 \ud835\udc45\ud835\udc60\\\ud835\udc45\ud835\udc60 \u2217, \ud835\udc5f \u2208 \ud835\udc45\ud835\udc60 \u2217, \ud835\udc60 \u2208 \ud835\udc46\n(4d)\n\ud835\udc62\ud835\udc60 \u2265 0, \u2200\ud835\udc60 \u2208 \ud835\udc46 (4e) \ud835\udc5d\ud835\udc59 \u2265 0, \u2200\ud835\udc59 \u2208 \ud835\udc34\ud835\udc5f, \ud835\udc5f \u2208 \ud835\udc45\ud835\udc60 \u2217, \ud835\udc60 \u2208 \ud835\udc46 (4f)\nThe passenger path flow stability condition shown in Eq. (4d) is proven to correspond to the fixed-\nroute operator market assignment in Pantelidis et al. (2020) under a more complex non-additive fare policy. With added MOD operators, the stability condition is trivially extended but stated formally here for sake of completeness.\nProposition 1. Solution stability. An optimal solution (\ud835\udc99, \ud835\udc9a, \ud835\udc97) to Eq. (3) is locally stable if there exists one or more solutions (\ud835\udc96, \ud835\udc91) that satisfy Eqs. (4a) \u2013 (4f), where \ud835\udc96 is the vector of utility transferred to travelers and \ud835\udc91 is the utility vector normalized as the fare payment from travelers to operators.\nProof. The operator cost constraints (Eq.(4a)-(4b)) and utility conservation constraints (Eq.(4c)) are\nfeasibility conditions. Eq. (4d) ensures the local stability of the matched paths. Pantelidis et al. (2020) shows the case for only fixed-route operators, traveler paths may switch to alternative paths. Here we follow the same logic considering two possible conditions of switching one user (local stability consideration) from the matched path to the alternative unmatched path:\nCondition 1: The unmatched path is fully operated, including fixed-route links and MOD nodes and\nlinks. In this case, similar to Pantelidis et al. (2020), if a capacitated fixed-route link \ud835\udc59 on the unmatched path is already at capacity, switching one user in requires pushing someone else off at the capacity price \ud835\udf07\ud835\udc59 \u2217. Condition 2: The unmatched path is not fully operated. If a capacitated fixed-route link \ud835\udc59 on the unmatched path is not operated (\ud835\udc66\ud835\udc59\n\u2217 = 0), the switched user would have to pay for the operating cost of the link (\ud835\udc50\ud835\udc59(1 \u2212 \ud835\udc66\ud835\udc59\n\u2217)) in addition to travel cost. If a MOD segment of the path is not operated, the unoperated MOD segment should include one or more MOD nodes (\ud835\udc63\ud835\udc56\n\u2217 = 0), MOD link \ud835\udc591, MOD access link \ud835\udc592, and MOD egress link \ud835\udc593. The switched user would have to pay for the opening cost of the unopened MOD nodes (\ud835\udc5e\ud835\udc56(1 \u2212 \ud835\udc63\ud835\udc56 \u2217)), the additional cost of operating on link \ud835\udc591 for one more user (\ud835\udc5a\ud835\udc591), as well as the travel cost of the path. For the MOD access link \ud835\udc592, travel cost is changed to \ud835\udf0f\ud835\udc592(\u2211 \ud835\udc65\ud835\udc592\ud835\udc60 \u2217 + 1\ud835\udc60\u2208\ud835\udc46 ; \u210e) due to the switch.\u220e\nLike Shapley and Shubik (1971) and Pantelidis et al. (2020), the proposed assignment game model is\nmechanism-agnostic; it does not output a specific cost allocation but instead outputs the set of all stable outcomes corresponding to the optimal matching by identifying two extreme vertices: buyer- and selleroptimal solutions. This is not to be confused with \u201cuser equilibrium\u201d and \u201csocial optimum\u201d in the transportation assignment literature; in essence every outcome is a \u201cuser equilibrium\u201d with different cost transfers (see Section 3.3). The vertices can be identified by solving \ud835\udc3f2 with either Eq. (5a) (buyer-optimal) or (5b) (seller-optimal), where all solutions in between these vertices are also stable.\nStable outcome problem \ud835\udc73\ud835\udfd0: max \u2211 \ud835\udc62\ud835\udc60\ud835\udc60\u2208\ud835\udc46 (Buyer optimal)\nor\nmax \u2211 \u2211 \ud835\udc5d\ud835\udc59 \u2211 \ud835\udc65\ud835\udc59\ud835\udc60 \u2217 \ud835\udc60\u2208\ud835\udc46\ud835\udc59\u2208\ud835\udc340\ud835\udc53\ud835\udc53\u2208\ud835\udc39 (Seller optimal)\n(5a)\n(5b)\nSubject to Eqs. (4).\nNote that the cost allocation constraints are path-dependent, while the flows solved from \ud835\udc3f1 are linkbased. This will be dealt with in the solution algorithm discussed in Section 4. In addition, not all links are owned by operators in the platform; these include transfer links, access/egress links to stations, and the dummy links connecting OD pairs representing options alternative to the platform."
        },
        {
            "heading": "3.3 Model properties and discussion",
            "text": ""
        },
        {
            "heading": "3.3.1. Instability for an optimal solution to \ud835\udc73\ud835\udfcf",
            "text": "While Sotomayor (1992) proved that basic many-to-many assignment games have non-empty stable outcome sets, the proposed MaaS assignment game features network effects that complicate the problem. With selfish travelers under congestion and the impact on operators, it is possible that the optimal solution to \ud835\udc3f1 may not satisfy one or more of the constraints in Eq. (4) (Lemma 1), since the travel disutility terms in the objective function of \ud835\udc3f1 (Eq. (3a)) are not cost-minimizing but reflect integrals of average cost.\nLemma 1. Empty outcome space. The assignment game in \ud835\udc3f1 (Eqs. (3)) is not guaranteed to be stable, i.e. have a non-empty outcome set from Eqs. (4a) \u2013 (4f). Proof. Denote the matched but unstable path as \ud835\udc5f, and the path that users on \ud835\udc5f have incentives to switch to as \ud835\udc5f\u2032. The two paths connect the same OD pair. Since \ud835\udc5f is chosen over \ud835\udc5f\u2032 by the matching problem \ud835\udc3f1, we have Eq. (6). It means that the total cost of the flow on \ud835\udc5f is less than the cost of allocating the flow to \ud835\udc5f\u2032 (the part of \ud835\udc5f shared with other matched paths still operating, and the part of \ud835\udc5f\u2032 that is not operating starts operating). Flow on path \ud835\udc5f is denoted as \ud835\udc65\ud835\udc5f . Set of links on paths \ud835\udc5f and \ud835\udc5f\u2032 are denoted as \ud835\udc34\ud835\udc5f and \ud835\udc34\ud835\udc5f\u2032 , respectively. The set of operating links on \ud835\udc5f that serves not only users on \ud835\udc5f but also users on other matched paths is denoted as \ud835\udc34\ud835\udc5f,\ud835\udc60\u210e\ud835\udc4e\ud835\udc5f\ud835\udc52\ud835\udc51. Set of links not operated on the unmatched path \ud835\udc5f\u2032 is denoted as \ud835\udc34\ud835\udc5f\u2032,\ud835\udc5b\ud835\udc5c.\n\ud835\udc65\ud835\udc5f \u2211 \ud835\udc61\ud835\udc59 \ud835\udc59\u2208\ud835\udc34\ud835\udc5f + \u2211 \ud835\udc50\ud835\udc59 \ud835\udc59\u2208\ud835\udc34\ud835\udc5f < \ud835\udc65\ud835\udc5f \u2211 \ud835\udc61\ud835\udc59 \ud835\udc59\u2208\ud835\udc34\ud835\udc5f\u2032 + \u2211 \ud835\udc50\ud835\udc59 \ud835\udc59\u2208\ud835\udc34\ud835\udc5f,\ud835\udc60\u210e\ud835\udc4e\ud835\udc5f\ud835\udc52\ud835\udc51 + \u2211 \ud835\udc50\ud835\udc59 \ud835\udc59\u2208\ud835\udc34\ud835\udc5f\u2032,\ud835\udc5b\ud835\udc5c\n(6)\nThe condition of \ud835\udc5f being unstable with respect to \ud835\udc5f\u2032 is shown as Eq. (7), which is derived by solving \ud835\udc62\ud835\udc60 from Eq. (4b) and plugging in the solved \ud835\udc62\ud835\udc60 into Eq. (4c).\n\u2211 \ud835\udc61\ud835\udc59 \ud835\udc59\u2208\ud835\udc34\ud835\udc5f + \u2211 \ud835\udc5d\ud835\udc59 \ud835\udc59\u2208\ud835\udc34\ud835\udc5f\n\u2265 \u2211 (\ud835\udc61\ud835\udc59 + \ud835\udf07\ud835\udc59 \u2217)\n\ud835\udc59\u2208\ud835\udc34\ud835\udc5f\u2032\n+ \u2211 \ud835\udc5d\ud835\udc59 \ud835\udc59\u2208\ud835\udc34\ud835\udc5f\u2032 + \u2211 \ud835\udc50\ud835\udc59 \ud835\udc59\u2208\ud835\udc34\ud835\udc5f\u2032,\ud835\udc5b\ud835\udc5c\n(7)\nMultiplying Eq. (7) by \ud835\udc65\ud835\udc5f and combining with Eq. (6), we have Eq. (8), which is the condition of a matched path \ud835\udc5f being unstable.\n\ud835\udc65\ud835\udc5f \u2211 \ud835\udc5d\ud835\udc59 \ud835\udc59\u2208\ud835\udc34\ud835\udc5f \u2212 \u2211 \ud835\udc50\ud835\udc59 \ud835\udc59\u2208\ud835\udc34\ud835\udc5f\n> \ud835\udc65\ud835\udc5f \u2211 \ud835\udf07\ud835\udc59 \u2217\n\ud835\udc59\u2208\ud835\udc34\ud835\udc5f\u2032\n+ \ud835\udc65\ud835\udc5f \u2211 \ud835\udc5d\ud835\udc59 \ud835\udc59\u2208\ud835\udc34\ud835\udc5f\u2032 \u2212 \u2211 \ud835\udc50\ud835\udc59 \ud835\udc59\u2208\ud835\udc34\ud835\udc5f,\ud835\udc60\u210e\ud835\udc4e\ud835\udc5f\ud835\udc52\ud835\udc51 + (\ud835\udc65\ud835\udc5f \u2212 1) \u2211 \ud835\udc50\ud835\udc59 \ud835\udc59\u2208\ud835\udc34\ud835\udc5f\u2032,\ud835\udc5b\ud835\udc5c\n(8)\n\u220e\nLemma 1 shows that \ud835\udc3f1 on its own may not be stable. As such, we define a more constrained version of \ud835\udc3f1 that includes a local stability guarantee, named as \ud835\udc3f1\ud835\udc36 . The optimal solution to \ud835\udc3f1\ud835\udc36 is a market equilibrium for the platform design that is guaranteed to be stable in Definition 3.\nDefinition 3. Let \ud835\udc3f1\ud835\udc36 be the assignment game defined by \ud835\udc3f1 plus the added constraint of guaranteed local stability. The optimal solution to \ud835\udc3f1\ud835\udc36 is a MaaS platform equilibrium, where \ud835\udc4d\ud835\udc3f1 \u2217 \u2264 \ud835\udc4d\ud835\udc3f1\ud835\udc36 \u2217 . No user can unilaterally switch path without being worse off, and no operator can unilaterally change their decision without being worse off for any outcome in the non-empty stable outcome set, and cooperative behavior between operators is possible in serving a user path together.\nAn example is shown in Fig. 2. There are 2 OD pairs in the network, 1 to 3 and 1 to 2, both with 100\nunits of demand. Link travel costs and operating costs are labeled in Fig. 2. Links (1,3) and (2,3) are walking links without operating cost and not owned by any operator. Dummy links for the two OD pairs are drawn in yellow with dashed lines with travel costs labeled. Utility \ud835\udc48\ud835\udc60 of the 2 OD travelers are both 25. All links have infinite capacity. The optimal matched flows solved from \ud835\udc3f1 are 200 units on link (1,2) and 100 units on link (2,3). However, the matched path for OD1, which is [1,2,3], is an unstable path, despite the equilibration in route assignment in Eq. (3a), because of the subsequent cost transfer. The lowest fare that can be set for link (1,2) is 2.4, so the total cost for one user on path [1,2,3] is 12 + 6 + 2.4 = 20.4, which is greater than the cost of walking path [1,3]. This means that the users on path [1,2,3] have incentives of switching to walking path [1,3]. The condition of Eq. (8) holds in this case (left-hand side = -240, righthand side = -480).\nWhen instability happens, flow on the unstable path have incentive to switch to unmatched paths. In\nthe example shown in Fig. 2, after the first user switches to walking path [1,3], the fare of link (1,2) will increase, which leads to more users switching to walking path [1,3]. The system stabilizes when all the 100 units of flow on path [1,2,3] have switched to walking path [1,3], which is the MaaS platform equilibrium. However, the equilibrium objective increases after the switch (before: \ud835\udc4d\ud835\udc3f1 \u2217 = 3,480; after: \ud835\udc4d\ud835\udc3f1\ud835\udc36 \u2217 = 3,680).\nThe stability condition that we consider is local stability, i.e. there is no incentive for one user to switch\noff his/her current path. It is possible that a locally stable outcome may not be globally stable, i.e. there could be a pair of users that may swap that would lead to a better outcome. This is similar to the difference between a \u201cuser equilibrium\u201d and a \u201cuser optimum\u201d in Smith (1984), where we align the local stability constraints in Eq. (4) with \u201cuser equilibrium\u201d, but seek the \u201cuser optimum\u201d by optimizing \ud835\udc3f1\ud835\udc36 (Proposition 2).\nProposition 2. Local and global stability. A feasible solution to \ud835\udc3f1\ud835\udc36 may be locally stable without being optimal (local stability is a necessary but not sufficient condition); the optimal solution to \ud835\udc3f1\ud835\udc36 is globally stable.\nProof. As proven by Proposition 1, Eqs. (4a) \u2013 (4f) ensures local stability, i.e. there is no incentive for a single traveler to switch to another path.\nGiven only links with fixed link costs (transfer links and fixed-route links), the cost per user on\nunmatched path \ud835\udc5f\u2032 when \ud835\udc5b users switch to unmatched path \ud835\udc5f\u2032 is \u2211 (\ud835\udc61\ud835\udc59 + \ud835\udf07\ud835\udc59 \u2217 + \ud835\udc50\ud835\udc59(1 \u2212 \ud835\udc66\ud835\udc59 \u2217))\ud835\udc59\u2208\ud835\udc34\ud835\udc5f\u2032 + \u2211 \ud835\udc50\ud835\udc59(1\u2212\ud835\udc66\ud835\udc59\n\u2217)\ud835\udc59\u2208\ud835\udc34\ud835\udc5f\u2032 \ud835\udc5b , which monotonically decreases while \ud835\udc5b increases, indicating that more users will switch to path \ud835\udc5f\u2032 if the path \ud835\udc5f\u2032 is worthwhile for the first user to switch to. In this case, local stability ensures global stability.\nGiven links with congestion effects (MOD access links), the cost per user on unmatched path \ud835\udc5f\u2032 when\n\ud835\udc5b users switch to unmatched path \ud835\udc5f\u2032 is \ud835\udc48\ud835\udc60 \u2212 (\u2211 (\ud835\udc61\ud835\udc59 + \ud835\udf07\ud835\udc59 \u2217)\ud835\udc59\u2208\ud835\udc34\ud835\udc5f\u2032\u2229(\ud835\udc340\u222a\ud835\udc34\ud835\udc39\u222a\ud835\udc34\ud835\udc37\u222a\ud835\udc34\ud835\udc40) + \u2211 \ud835\udf0f\ud835\udc59(\u2211 \ud835\udc65\ud835\udc59\ud835\udc60 \u2217 +\ud835\udc60\u2208\ud835\udc46\ud835\udc59\u2208\ud835\udc34\ud835\udc5f\u2032\u2229\ud835\udc340\ud835\udc40 1 ; \u210e) + \u2211 \ud835\udc5a\ud835\udc59\ud835\udc59\u2208\ud835\udc34\ud835\udc5f\u2032\u2229\ud835\udc34\ud835\udc40 + \u2211 \ud835\udc5e\ud835\udc56(1\u2212\ud835\udc63\ud835\udc56 \u2217)\ud835\udc56\u2208\ud835\udc41\ud835\udc5f\u2032\u2229\ud835\udc41\ud835\udc40 +\u2211 \ud835\udc50\ud835\udc59(1\u2212\ud835\udc66\ud835\udc59 \u2217)\ud835\udc59\u2208\ud835\udc34\ud835\udc5f\u2032\u2229(\ud835\udc340\u222a\ud835\udc34\ud835\udc39\u222a\ud835\udc34\ud835\udc37\u222a\ud835\udc34\ud835\udc40) \ud835\udc5b ), in which the last term decrease while \ud835\udc5b increases, while the second term increases while \ud835\udc5b increases. In this latter case, it is possible that the lowest payoff per user switched appears when more than one user switches to the unmatched path \ud835\udc5f\u2032, which means that local stability does not ensure global stability when there are congestion effects. Among all the locally stable solutions, the solution with the lowest objective value (\ud835\udc4d\ud835\udc3f1\ud835\udc36 \u2217 ) is the MaaS platform equilibrium, which is globally stable, since the lowest objective value in Eq. (3) indicates no incentives of switching in the platform. \u220e"
        },
        {
            "heading": "3.3.2. Unique and non-unique variables",
            "text": "As shown in Sotomayor (1999), the many-to-many assignment game has a unique lattice structure for its stable outcome set and there exists a unique optimal stable payoff for each side of the market (buyer- and seller-optimal vertices). From the network properties, however, Pantelidis et al. (2020) also showed that certain variables are unique even if the path flows are not unique.\nProposition 3. Solution uniqueness. A MaaS platform equilibrium solution under a link-additive and separable pricing scheme is unique in link flows, passenger ridership per operator, and the sum of total consumer surplus and total operator revenue.\nProof. Link flows are known to be unique for multicommodity assignment models under congestion\n(Sheffi, 1985). As mentioned, we consider two alternative pricing schemes: a link-based price and a nonadditive price that is paid once to an operator regardless of how many legs of the trip belong to that operator. The latter scheme was studied in Pantelidis et al. (2020). Here we study the former, which is formulated as the conditions in \ud835\udc3f2. Since flow of link \ud835\udc59 is unique (\u2211 \ud835\udc65\ud835\udc59\ud835\udc60 \u2217 \ud835\udc60\u2208\ud835\udc46 ), system travel cost is unique (\u2211 \u2211 \ud835\udc61\ud835\udc59\ud835\udc65\ud835\udc59\ud835\udc60 \u2217 \ud835\udc59\u2208\ud835\udc340\u222a\ud835\udc34\ud835\udc39\u222a\ud835\udc34\ud835\udc40\u222a\ud835\udc34\ud835\udc37\ud835\udc60\u2208\ud835\udc46 + \u2211 \ud835\udf0f\ud835\udc59(\u2211 \ud835\udc65\ud835\udc59\ud835\udc60 \u2217 \ud835\udc60\u2208\ud835\udc46 ; \u210e) \u2211 \ud835\udc65\ud835\udc59\ud835\udc60 \u2217 \ud835\udc60\u2208\ud835\udc46\ud835\udc59\u2208\ud835\udc340\ud835\udc40 ). System total trip utility is unique (\u2211 \ud835\udc51\ud835\udc60\ud835\udc48\ud835\udc60\ud835\udc60\u2208\ud835\udc46 ). Since the sum of system travel cost, system total consumer surplus, and total operator revenue is equal to system total trip utility,\nthe sum of system total consumer surplus and total operator revenue is unique despite the non-uniqueness of path flows. \u220e\n3.3.3. Generalization of Wardrop\u2019s principles\nThe assignment game stability conditions shown in Eq. (4) represent a more generalized form of the\nnoncooperative user equilibrium route choice behavior proposed by Wardrop (1952) with added operator considerations and cooperation for operators in serving a user path together.\nCorollary 1. Generalization of Wardrop\u2019s user equilibrium. When \ud835\udc44 = {}, i.e. there is no operator agent and the platform becomes a one-sided market, the stable outcome space defined by the constraints in Eq. (4) is determined only by \ud835\udc62\ud835\udc60 (\ud835\udc5d\ud835\udc59 \u2019s drop out), which leads to a generalization of the Wardrop\u2019s user equilibrium conditions (1952) with known \ud835\udc48\ud835\udc60 and link capacities.\nProof. Without operators, Eqs. (4a) \u2013 (4b) drop out. Removing the operator terms in the stability\nconstraint in Eqs. (4c) \u2013 (4d) leads to Eqs. (4c\u2019) \u2013 (4d\u2019).\n\ud835\udc62\ud835\udc60 = \ud835\udc48\ud835\udc60 \u2212 ( \u2211 \ud835\udc61\ud835\udc59 \ud835\udc59\u2208\ud835\udc34\ud835\udc5f\u2229(\ud835\udc340\u2229\ud835\udc34\ud835\udc39\u222a\ud835\udc34\ud835\udc37\u222a\ud835\udc34\ud835\udc40)\n+ \u2211 \ud835\udf0f\ud835\udc59 (\u2211 \ud835\udc65\ud835\udc59\ud835\udc60 \u2217\n\ud835\udc60\u2208\ud835\udc46\n; \u210e\ud835\udc59)\n\ud835\udc59\u2208\ud835\udc34\ud835\udc5f\u2229\ud835\udc340\ud835\udc40\n) , \u2200\ud835\udc5f \u2208 \ud835\udc45\ud835\udc60 \u2217, \ud835\udc60 \u2208 \ud835\udc46 (4c\u2019)\n\ud835\udc62\ud835\udc60 \u2265 \ud835\udc48\ud835\udc60 \u2212 ( \u2211 (\ud835\udc61\ud835\udc59 + \ud835\udf07\ud835\udc59 \u2217)\n\ud835\udc59\u2208\ud835\udc34\ud835\udc5f\u2032\u2229(\ud835\udc340\u222a\ud835\udc34\ud835\udc39\u222a\ud835\udc34\ud835\udc37\u222a\ud835\udc34\ud835\udc40)\n+ \u2211 \ud835\udf0f\ud835\udc59 (\u2211 \ud835\udc65\ud835\udc59\ud835\udc60 \u2217 + 1\n\ud835\udc60\u2208\ud835\udc46\n; \u210e\ud835\udc59)\n\ud835\udc59\u2208\ud835\udc34\ud835\udc5f\u2032\u2229\ud835\udc340\ud835\udc40\n) , \u2200\ud835\udc5f\u2032 \u2208 \ud835\udc45\ud835\udc60\\\ud835\udc45\ud835\udc60 \u2217, \ud835\udc5f\n\u2208 \ud835\udc45\ud835\udc60 \u2217, \ud835\udc60 \u2208 \ud835\udc46\n(4d\u2019)\nIf we combine Eqs. (4c\u2019) and (4d\u2019) and assume that all links are uncapacitated, we have Eq. (9), which\nis in fact the KKT conditions corresponding to the user equilibrium as shown in Beckmann et al. (1956). The left-hand side is the travel cost of the matched path \ud835\udc5f. The right-hand side is the cost of switching to an unmatched path \ud835\udc5f\u2032, which is travel cost of the unmatched paths.\n\u2211 \ud835\udc61\ud835\udc59 \ud835\udc59\u2208\ud835\udc34\ud835\udc5f\u2229(\ud835\udc340\u2229\ud835\udc34\ud835\udc39\u222a\ud835\udc34\ud835\udc37\u222a\ud835\udc34\ud835\udc40)\n+ \u2211 \ud835\udf0f\ud835\udc59 (\u2211 \ud835\udc65\ud835\udc59\ud835\udc60 \u2217\n\ud835\udc60\u2208\ud835\udc46\n; \u210e)\n\ud835\udc59\u2208\ud835\udc34\ud835\udc5f\u2229\ud835\udc340\ud835\udc40\n\u2264 \u2211 \ud835\udc61\ud835\udc59 \ud835\udc59\u2208\ud835\udc34\ud835\udc5f\u2032\u2229(\ud835\udc340\u222a\ud835\udc34\ud835\udc39\u222a\ud835\udc34\ud835\udc37\u222a\ud835\udc34\ud835\udc40)\n+ \u2211 \ud835\udf0f\ud835\udc59 (\u2211 \ud835\udc65\ud835\udc59\ud835\udc60 \u2217 + 1\n\ud835\udc60\u2208\ud835\udc46\n; \u210e)\n\ud835\udc59\u2208\ud835\udc34\ud835\udc5f\u2032\u2229\ud835\udc340\ud835\udc40\n, \u2200\ud835\udc5f \u2208 \ud835\udc45\ud835\udc60 \u2217, \ud835\udc60 \u2208 \ud835\udc46, \u2200\ud835\udc5f\u2032\n\u2208 \ud835\udc45\ud835\udc60\\\ud835\udc45\ud835\udc60 \u2217, \ud835\udc5f \u2208 \ud835\udc45\ud835\udc60 \u2217, \ud835\udc60 \u2208 \ud835\udc46\n(9)\n\u220e"
        },
        {
            "heading": "3.4 Subsidy for system stabilization",
            "text": "The MaaS platform assignment game so far does not involve any decisions from the platform. As\nsolving \ud835\udc3f1 may not obtain a solution to \ud835\udc3f1\ud835\udc36, we consider subsidy decisions for the platform to guarantee local stability. We introduce the role of subsidy in stabilizing an unstable assignment as a platform design strategy first considered by Tafreshian and Masoud (2020) for ridesharing markets. When unstable paths are subsidized sufficiently to enlarge the payoff, they can still be stabilized, and the result may even outperform the solution to \ud835\udc3f1\ud835\udc36. In MaaS platforms, users pay one time for a bundle of mobility services which compose a path, so it might make sense for subsidies per user and per path. Consider a path-based subsidy \ud835\udc4e\ud835\udc5f directed to each user on path \ud835\udc5f \u2208 \ud835\udc45\ud835\udc60 \u2217, \ud835\udc60 \u2208 \ud835\udc46, such that the travel disutility is decreased by that amount per user in Definition 4.\nDefinition 4. \ud835\udc73\ud835\udfcf\ud835\udc7a is a variant of the \ud835\udc3f1 assignment game with the added decision variable for the platform decision-maker to provide path-based subsidies \ud835\udc4e\ud835\udc5f for path \ud835\udc5f \u2208 \ud835\udc45\ud835\udc60\n\u2217, \ud835\udc60 \u2208 \ud835\udc46 such that the equilibrium objective is minimized, i.e. in Eq. (10), where \ud835\udc65\ud835\udc5f is the flow on path \ud835\udc5f \u2208 \ud835\udc45\ud835\udc60 \u2217, \ud835\udc60 \u2208 \ud835\udc46.\nmin \ud835\udc4d\ud835\udc3f1\ud835\udc46 = \ud835\udc4d\ud835\udc3f1 + \u2211 \u2211 \ud835\udc4e\ud835\udc5f\ud835\udc65\ud835\udc5f \ud835\udc5f\u2208\ud835\udc45\ud835\udc60 \u2217\ud835\udc60\u2208\ud835\udc46\n(10)\nThe optimal solution to \ud835\udc3f1\ud835\udc46 is called a subsidized MaaS platform equilibrium, where \ud835\udc4d\ud835\udc3f1 \u2217 \u2264 \ud835\udc4d\ud835\udc3f1\ud835\udc46 \u2217 .\nIn the example of Fig. 2, instability of path [1,2,3] happens due to larger cost per user (\u2211 \ud835\udc61\ud835\udc56\ud835\udc57\ud835\udc34\ud835\udc5f + \u2211 \ud835\udc5d\ud835\udc56\ud835\udc57\ud835\udc34\ud835\udc5f ) than the walking path [1,3]. Obviously, such instability can be fixed by injecting subsidies \ud835\udc4e[1,2,3] to lower the cost of the unstable path [1,2,3]. In this example, a subsidy of \ud835\udc4e[1,2,3] = 0.4 is needed for each user on path [1,2,3] to make sure that they don\u2019t switch to walking path [1,3]. Without any intervention, the flow on [1,2,3] will switch to the walking path [1,3], leading to \ud835\udc4d\ud835\udc3f1\ud835\udc36 \u2217 = 3,680. With the subsidy included, the subsidized equilibrium objective is \ud835\udc4d\ud835\udc3f1\ud835\udc46 \u2217 = 3,480 + 40 = 3,520 , which is still lower than the equilibrium objective of 3,680. This means that subsidizing the matchings solved from \ud835\udc3f1 is worthwhile in this case. However, if the cost of link (1,3) is decreased from 20 to 18.5, the flows solved from \ud835\udc3f1 stays the same, while subsidy needed to stabilize path [1,2,3] becomes \ud835\udc4e[1,2,3] = 1.4 per user. The subsidized equilibrium objective becomes \ud835\udc4d\ud835\udc3f1\ud835\udc46 \u2217 = 3,620. In this case, the equilibrium objective is \ud835\udc4d\ud835\udc3f1\ud835\udc36 \u2217 = 3,580, which means that it is not worthwhile to inject subsidies. \ud835\udc3f1\ud835\udc46 is a highly complex problem since the objective (10) and constraints are nonconvex. We can equivalently decompose the problem into finding a solution to \ud835\udc3f1 and solving for \ud835\udc4e\ud835\udc5f\n\u2217 in \ud835\udc3f3 given the variables obtained from \ud835\udc3f1 if they are unstable, i.e. Definition 5.\nDefinition 5. \ud835\udc73\ud835\udfd1 finds the optimum subsidies \ud835\udc4e\ud835\udc5f needed for a given solution (\ud835\udc99 \u2217, \ud835\udc9a\u2217, \ud835\udc97\u2217) with an empty outcome set such that it is no longer empty. Then \ud835\udc4d\ud835\udc3f1\ud835\udc46 \u2217 = min(\ud835\udc4d\ud835\udc3f1(\ud835\udc99 \u2217, \ud835\udc9a\u2217, \ud835\udc97\u2217) + \ud835\udc4d\ud835\udc3f3|(\ud835\udc99\u2217,\ud835\udc9a\u2217,\ud835\udc97\u2217)).\nMinimum Subsidy Problem \ud835\udc73\ud835\udfd1:\nmin \ud835\udc4e\ud835\udc5f,\ud835\udc62\ud835\udc60,\ud835\udc5d\ud835\udc59\n\ud835\udc4d\ud835\udc3f3|(\ud835\udc99\u2217,\ud835\udc9a\u2217,\ud835\udc97\u2217) = \u2211 \u2211 \ud835\udc4e\ud835\udc5f\ud835\udc65\ud835\udc5f \u2217\n\ud835\udc5f\u2208\ud835\udc45\ud835\udc60 \u2217\ud835\udc60\u2208\ud835\udc46\n(11a)\nSubject to\n\u2211 \ud835\udc5d\ud835\udc59 \u2211 \ud835\udc65\ud835\udc60\ud835\udc59 \u2217 \ud835\udc60\u2208\ud835\udc46\ud835\udc59\u2208\ud835\udc34\ud835\udc53 \u2265 \u2211 \ud835\udc50\ud835\udc59 \u2217\ud835\udc66\ud835\udc59 \u2217 \ud835\udc59\u2208\ud835\udc34\ud835\udc53 , \u2200\ud835\udc53 \u2208 \ud835\udc44\ud835\udc39 (11b)\n\u2211 \ud835\udc5d\ud835\udc59 \u2211 \ud835\udc65\ud835\udc59\ud835\udc60 \u2217\n\ud835\udc60\u2208\ud835\udc46\ud835\udc59\u2208\ud835\udc340\ud835\udc53\n\u2265 \u2211 \u2211 \ud835\udc5a\ud835\udc59\ud835\udc65\ud835\udc60\ud835\udc59 \u2217\n\ud835\udc60\u2208\ud835\udc46\ud835\udc59\u2208\ud835\udc34\ud835\udc53\n+ \u2211 \ud835\udc5e\ud835\udc56\ud835\udc63\ud835\udc56 \u2217\n\ud835\udc56\u2208\ud835\udc41\ud835\udc53\n, \u2200\ud835\udc53 \u2208 \ud835\udc44\ud835\udc40 (11c)\n\ud835\udc62\ud835\udc60 + \u2211 \ud835\udc5d\ud835\udc59 \ud835\udc59\u2208\ud835\udc34\ud835\udc5f = \ud835\udc48\ud835\udc60 + \ud835\udc4e\ud835\udc5f \u2212 ( \u2211 \ud835\udc61\ud835\udc59 \ud835\udc59\u2208\ud835\udc34\ud835\udc5f\u2229(\ud835\udc340\u2229\ud835\udc34\ud835\udc39\u222a\ud835\udc34\ud835\udc37\u222a\ud835\udc34\ud835\udc40)\n+ \u2211 \ud835\udf0f\ud835\udc59 (\u2211 \ud835\udc65\ud835\udc59\ud835\udc60 \u2217\n\ud835\udc60\u2208\ud835\udc46\n; \u210e\ud835\udc59)\n\ud835\udc59\u2208\ud835\udc34\ud835\udc5f\u2229\ud835\udc340\ud835\udc40\n) , \u2200\ud835\udc5f \u2208 \ud835\udc45\ud835\udc60 \u2217, \u2200\ud835\udc60\n\u2208 \ud835\udc46\n(11d)\n\ud835\udc62\ud835\udc60 + \u2211 \ud835\udc5d\ud835\udc59 \ud835\udc59\u2208\ud835\udc34\ud835\udc5f\u2032 \u2265 \ud835\udc48\ud835\udc60\n\u2212 ( \u2211 (\ud835\udc61\ud835\udc59 + \ud835\udf07\ud835\udc59 \u2217 + \ud835\udc50\ud835\udc59(1 \u2212 \ud835\udc66\ud835\udc59 \u2217))\n\ud835\udc59\u2208\ud835\udc34\ud835\udc5f\u2032\u2229(\ud835\udc340\u222a\ud835\udc34\ud835\udc39\u222a\ud835\udc34\ud835\udc37\u222a\ud835\udc34\ud835\udc40)\n+ \u2211 \ud835\udf0f\ud835\udc59 (\u2211 \ud835\udc65\ud835\udc59\ud835\udc60 \u2217 + 1\n\ud835\udc60\u2208\ud835\udc46\n; \u210e\ud835\udc59)\n\ud835\udc59\u2208\ud835\udc34\ud835\udc5f\u2032\u2229\ud835\udc340\ud835\udc40\n+ \u2211 \ud835\udc5a\ud835\udc59 \ud835\udc59\u2208\ud835\udc34\ud835\udc5f\u2032\u2229\ud835\udc34\ud835\udc40\n+ \u2211 \ud835\udc5e\ud835\udc56(1 \u2212 \ud835\udc63\ud835\udc56 \u2217)\n\ud835\udc56\u2208\ud835\udc41\ud835\udc5f\u2032\u2229\ud835\udc41\ud835\udc40\n) , \u2200\ud835\udc5f\u2032\n\u2208 \ud835\udc45\ud835\udc60\\\ud835\udc45\ud835\udc60 \u2217, \u2200\ud835\udc5f \u2208 \ud835\udc45\ud835\udc60 \u2217, \u2200\ud835\udc60 \u2208 \ud835\udc46\n(11e)\n\ud835\udc62\ud835\udc60 \u2265 0, \u2200\ud835\udc60 \u2208 \ud835\udc46 (11f)\n\ud835\udc5d\ud835\udc59 \u2265 0, \u2200\ud835\udc59 \u2208 \ud835\udc34\ud835\udc5f, \u2200\ud835\udc5f \u2208 \ud835\udc45\ud835\udc60 \u2217, \u2200\ud835\udc60 \u2208 \ud835\udc46 (11g)\n\ud835\udc4e\ud835\udc5f \u2265 0, \u2200 \ud835\udc5f \u2208 \ud835\udc45\ud835\udc60 \u2217, \u2200\ud835\udc60 \u2208 \ud835\udc46 (11h)\nThere are three sets of decision variables: user\u2019s payoff of user group \ud835\udc60 \u2208 \ud835\udc46 (\ud835\udc62\ud835\udc60), fare of link \ud835\udc59 \u2208 \ud835\udc34\ud835\udc5f, \ud835\udc5f \u2208 \ud835\udc45\ud835\udc60 \u2217, \ud835\udc60 \u2208 \ud835\udc46 (\ud835\udc5d\ud835\udc59), and subsidy to each user on path \ud835\udc5f \u2208 \ud835\udc45\ud835\udc60 \u2217, \ud835\udc60 \u2208 \ud835\udc46 (\ud835\udc4e\ud835\udc5f). Subsidies are injected per path per user to increase trip utilities, which is reflected in the cost allocation constraints (Eq. (11d)). The objective (Eq. (11a)) is to minimize the total amount of subsidies injected. Since subsidy is injected per path per user, path flows are needed for total subsidies in Eq. (11a)."
        },
        {
            "heading": "4 Proposed solution algorithms",
            "text": "The challenge is in solving for a MaaS platform equilibrium with guaranteed local stability, with or without subsidy. We propose a branch and bound algorithm that can obtain the exact solution to the many-to-many matching model \ud835\udc3f1 in Section 4.1, but stability is not guaranteed per Lemma 1. For obtaining a solution with guaranteed stability, i.e. the MaaS platform equilibrium, we integrate \ud835\udc3f2 and \ud835\udc3f3 as shown in Section 4.2."
        },
        {
            "heading": "4.1. Exact solution method to the many-to-many matching model \ud835\udc73\ud835\udfcf",
            "text": "The algorithm is composed of 3 parts nested within each other: branch and bound (Land and Doig, 2010), Lagrangian relaxation with subgradient optimization, and Frank-Wolfe algorithm. An overview of the complete algorithm is presented in Fig. 3 (which also contains parts introduced in 4.2). The integral constraints of \ud835\udc66\ud835\udc56\ud835\udc57 and \ud835\udc63\ud835\udc56\u210e are relaxed in the branch and bound. At each branch, a nonlinear traffic assignment problem with capacity (Eq. (3c)) and MOD node controlling constraints (Eq. (3d)) is solved. The capacity constraints of fixed-route links are removed using a Lagrangian relaxation approach (Algorithm 2). The resulting non-linear traffic assignment problem is solved with a Frank-Wolfe algorithm (Algorithm 3). Feasibility of the original problem in each branch involves checking the binary constraints."
        },
        {
            "heading": "4.1.1. Branch and bound algorithm",
            "text": "For each branch, the set of \ud835\udc66\ud835\udc59 (\ud835\udc63\ud835\udc56) constrained to be 0 forms set \ud835\udc4c0 (\ud835\udc490), the set of \ud835\udc66\ud835\udc59 (\ud835\udc63\ud835\udc56) constrained to be 1 forms set \ud835\udc4c1 (\ud835\udc491). For each branch, we do the following modification to the network to make sure that constraints (3c) and (3e) are met.\n\u2022 For \ud835\udc66\ud835\udc59 \u2208 \ud835\udc4c0, the corresponding link \ud835\udc59 is removed from the network for this branch. \u2022 For \ud835\udc66\ud835\udc59 \u2208 \ud835\udc4c1, all the other links connecting the same nodes owned by the same operator to represent\ndifferent service frequency options are removed from the network for this branch.\n\u2022 For \ud835\udc63\ud835\udc56 \u2208 \ud835\udc490, all the links incident on MOD node \ud835\udc56 are removed for this branch.\n\u2022 For \ud835\udc63\ud835\udc56 \u2208 \ud835\udc491, all the MOD nodes owned by the same operator with a fleet size different from the fleet size associated with node \ud835\udc56 should be added to \ud835\udc490.\nWe denote the integral-relaxed \ud835\udc3f1 of a branch as \ud835\udc35(\ud835\udc4c1 ,\ud835\udc4c0 ,\ud835\udc491 ,\ud835\udc490) . Following the framework of a conventional Branch and Bound algorithm, each \ud835\udc35(\ud835\udc4c1,\ud835\udc4c0,\ud835\udc491,\ud835\udc490) is solved with Algorithm 1. The solution of \ud835\udc35(\ud835\udc4c1,\ud835\udc4c0,\ud835\udc491,\ud835\udc490) includes ?\u0302?\ud835\udc45, ?\u0302?\ud835\udc3f, ?\u0302?, ?\u0302?, ?\u0302?\ud835\udc3f1 , \ud835\udc4e\ud835\udc5b\ud835\udc51 ?\u0302?, which denote a vector of path flows on matched paths \ud835\udc5f \u2208 \ud835\udc45\ud835\udc60 \u2217, \ud835\udc60 \u2208 \ud835\udc46, a vector of link flows on all links \ud835\udc59 \u2208 \ud835\udc34, a vector of values of \ud835\udc66\ud835\udc59 of fixed-route links \ud835\udc59 \u2208 \ud835\udc34\ud835\udc39, a vector of values of \ud835\udc63\ud835\udc56 of MOD nodes \ud835\udc56 \u2208 \ud835\udc41\ud835\udc40 , objective function value, and a vector of Lagrange multipliers of the capacity constraints of fixed links \ud835\udc59 \u2208 \ud835\udc34\ud835\udc39. We denote the solution set which includes all solution variable of a branch as ?\u0302? = [?\u0302?\ud835\udc45, ?\u0302?\ud835\udc3f , ?\u0302?, ?\u0302?, ?\u0302?\ud835\udc3f1 , ?\u0302?, \ud835\udc4c1, \ud835\udc4c0, \ud835\udc491, \ud835\udc490]. For finding a solution to \ud835\udc3f1, the algorithm stops when all branches are closed. A gap between the upper bound and lower bound can be monitored in cases where the maximum run time is exceeded."
        },
        {
            "heading": "4.1.2. Lagrangian Relaxation",
            "text": "To handle the capacity constraints for the fixed-route links, we adopt the Lagrangian relaxation method\nfrom Crainic et al. (2001), which is designed to work with branch and bound algorithms. To improve\naccuracy, a redundant set of constraints Eq. (12) is added, where \ud835\udc4f\ud835\udc60\ud835\udc59 = min{\ud835\udc51\ud835\udc60, \ud835\udc64\ud835\udc60\ud835\udc59}. This set of constraints is named as the strong forcing constraints, with Lagrange multipliers of \ud835\udefd\ud835\udc60\ud835\udc59.\n\ud835\udc65\ud835\udc60\ud835\udc59 \u2264 \ud835\udc4f\ud835\udc60\ud835\udc59\ud835\udc66\ud835\udc59 , \u2200\ud835\udc59 \u2208 \ud835\udc34\ud835\udc39 , \u2200\ud835\udc60 \u2208 \ud835\udc46 (\ud835\udefd\ud835\udc60\ud835\udc59) (12)\nThe strong forcing constraints (12) can be relaxed in a Lagrangian way. The capacity constraints in\nEq. (3c) are replaced by Eq. (13) with a Lagrange multiplier of \ud835\udefe\ud835\udc59 . With the replacement, \ud835\udc66\ud835\udc59 can be computed as Eq. (14), where \ud835\udc50\ud835\udc59(\ud835\udefd) = \ud835\udc50\ud835\udc59 \u2212 \u2211 \ud835\udc4f\ud835\udc60\ud835\udc59\ud835\udefd\ud835\udc60\ud835\udc59\ud835\udc60 .\n\u2211 \ud835\udc65\ud835\udc60\ud835\udc59 \ud835\udc60\u2208\ud835\udc46 \u2264 \ud835\udc64\ud835\udc59 , \u2200\ud835\udc59 \u2208 \ud835\udc34\ud835\udc39 (\ud835\udefe\ud835\udc59) (13)\n\ud835\udc66\ud835\udc59 = { \u2211 \ud835\udc65\ud835\udc60\ud835\udc59\ud835\udc60\u2208\ud835\udc46 \ud835\udc64\ud835\udc60\ud835\udc59 \u2044 , if \ud835\udc50\ud835\udc59(\ud835\udefd) \u2265 0\n1, otherwise (14)\nWe relax Eq. (3d) similarly as relaxing Eq. (3c). First, a redundant set of constraints is added as Eq.\n(15) with Lagrange multipliers \ud835\udf02\ud835\udc60\ud835\udc59. \ud835\udc34\ud835\udc56 + are the outbound links of MOD node \ud835\udc56, which include MOD links and MOD egress links.\n\ud835\udc65\ud835\udc60\ud835\udc59 \u2264 \ud835\udc51\ud835\udc60\ud835\udc63\ud835\udc56 , \u2200\ud835\udc56 \u2208 \ud835\udc41\ud835\udc40 , \ud835\udc59 \u2208 \ud835\udc34\ud835\udc56 +, \ud835\udc60 \u2208 \ud835\udc46 (\ud835\udf02\ud835\udc60\ud835\udc59) (15)\nThen Eq. (15) are relaxed in a Lagrangian way. The node controlling constraints in Eq. (3d) are\nreplaced by Eq. (16) with Lagrange multipliers \ud835\udf06\ud835\udc59. With the replacement, \ud835\udc63\ud835\udc56 can be computed as Eq. (17), where \ud835\udc5e\ud835\udc56(\ud835\udf02) = \ud835\udc5e\ud835\udc56 \u2212 \u2211 \ud835\udc51\ud835\udc60 \u2211 \ud835\udf02\ud835\udc60\ud835\udc59\u2200\ud835\udc59\u2208\ud835\udc34\ud835\udc56 +\ud835\udc60\u2208\ud835\udc46 .\n\u2211 \ud835\udc65\ud835\udc60\ud835\udc59 \ud835\udc60\u2208\ud835\udc46 \u2264 \u2211 \ud835\udc51\ud835\udc60 \ud835\udc60\u2208\ud835\udc46\n, \u2200\ud835\udc56 \u2208 \ud835\udc41\ud835\udc40 , \ud835\udc59 \u2208 \ud835\udc34\ud835\udc56 + (\ud835\udf06\ud835\udc59) (16)\n\ud835\udc63\ud835\udc56 = { \u2211 \ud835\udc65\ud835\udc60\ud835\udc59\ud835\udc60\u2208\ud835\udc46 \u2211 \ud835\udc51\ud835\udc60\ud835\udc60\u2208\ud835\udc46 \u2044 , \ud835\udc56\ud835\udc53 \ud835\udc5e\ud835\udc56(\ud835\udf02) \u2265 0\n1, \ud835\udc5c\ud835\udc61\u210e\ud835\udc52\ud835\udc5f\ud835\udc64\ud835\udc56\ud835\udc60\ud835\udc52 (17)\nThe relaxed objective function is shown in Eq. (18). The relaxation of Eq. (3d) leads to cost changes\nof MOD node outbound links, including MOD links (\ud835\udc34\ud835\udc40) and MOD egress links. MOD egress links are denoted as \ud835\udc59 \u2208 \ud835\udc34\ud835\udc38.\n\ud835\udc4d\ud835\udc3f1(\ud835\udf38, \ud835\udf37, \ud835\udf40, \ud835\udf3c) = \u2211 \u2211 \ud835\udc61\ud835\udc59\ud835\udc65\ud835\udc60\ud835\udc59 \ud835\udc59\u2208\ud835\udc340\u222a\ud835\udc34\ud835\udc37\ud835\udc60\u2208\ud835\udc46\n+ \u2211 \u2211 (\ud835\udc61\ud835\udc59 + \ud835\udefe\ud835\udc59 + \ud835\udc50\ud835\udc59(\ud835\udefd)\n+\n\ud835\udc64\ud835\udc59 \u2044 + \ud835\udefd\ud835\udc60\ud835\udc59) \ud835\udc65\ud835\udc60\ud835\udc59\n\ud835\udc59\u2208\ud835\udc34\ud835\udc39\ud835\udc60\u2208\ud835\udc46\n+ \u2211 \u2211 (\ud835\udc61\ud835\udc59 + \ud835\udc5a\ud835\udc59 + \ud835\udf06\ud835\udc59 + \ud835\udc5e\ud835\udc56(\ud835\udf02)\n+\n\u2211 \ud835\udc51\ud835\udc60\ud835\udc60\u2208\ud835\udc46 \u2044 + \ud835\udf02\ud835\udc60\ud835\udc59)\ud835\udc65\ud835\udc60\ud835\udc59\n\ud835\udc59\u2208\ud835\udc34\ud835\udc40\ud835\udc60\u2208\ud835\udc46\n+ \u2211 \u2211 (\ud835\udf06\ud835\udc59 + \ud835\udc5e\ud835\udc56(\ud835\udf02)\n+\n\u2211 \ud835\udc51\ud835\udc60\ud835\udc60\u2208\ud835\udc46 \u2044 + \ud835\udf02\ud835\udc60\ud835\udc59)\ud835\udc65\ud835\udc60\ud835\udc59\n\ud835\udc59\u2208\ud835\udc34\ud835\udc38\ud835\udc60\u2208\ud835\udc46\n+ \u2211 \u222b \ud835\udf0f\ud835\udc59(\ud835\udc64; \u210e)\ud835\udc51\ud835\udc64 \u2211 \ud835\udc65\ud835\udc60\ud835\udc59\ud835\udc60\u2208\ud835\udc46\n0\ud835\udc59\u2208\ud835\udc340\ud835\udc40\n+ \ud835\udc50\ud835\udc5c\ud835\udc5b\ud835\udc60\ud835\udc61\ud835\udc4e\ud835\udc5b\ud835\udc61\ud835\udc60\n(18)\nIn subgradient optimization, the Lagrange multipliers are updated from 0 when the corresponding\nconstraints are broken. However, constraints Eqs. (15) \u2013 (16) will never be broken after removing \ud835\udc63\ud835\udc56. Hence, (\ud835\udf06\ud835\udc59 + \ud835\udc5e\ud835\udc56(\ud835\udf02) +\n\u2211 \ud835\udc51\ud835\udc60\ud835\udc60\u2208\ud835\udc46 \u2044 + \ud835\udf02\ud835\udc60\ud835\udc59) will always be \ud835\udc5e\ud835\udc56 \u2211 \ud835\udc51\ud835\udc60\ud835\udc60\u2208\ud835\udc46 \u2044 for all concerned MOD and MOD egress links,\nwhich means that the relaxed objective can be rewritten as \ud835\udc3f1 \u2032 in Eq. (19).\n\ud835\udc4d\ud835\udc3f1\u2032 (\ud835\udf38, \ud835\udf37) = \u2211 \u2211 \ud835\udc61\ud835\udc59\ud835\udc65\ud835\udc60\ud835\udc59 \ud835\udc59\u2208\ud835\udc340\u222a\ud835\udc34\ud835\udc37\ud835\udc60\u2208\ud835\udc46\n+ \u2211 \u2211 (\ud835\udc61\ud835\udc59 + \ud835\udefe\ud835\udc59 + \ud835\udc50\ud835\udc59(\ud835\udefd)\n+\n\ud835\udc64\ud835\udc59 \u2044 + \ud835\udefd\ud835\udc60\ud835\udc59) \ud835\udc65\ud835\udc60\ud835\udc59\n\ud835\udc59\u2208\ud835\udc34\ud835\udc39\ud835\udc60\u2208\ud835\udc46\n+ \u2211 \u2211 (\ud835\udc61\ud835\udc59 + \ud835\udc5a\ud835\udc59 + \ud835\udc5e\ud835\udc56\n\u2211 \ud835\udc51\ud835\udc60\ud835\udc60\u2208\ud835\udc46 \u2044 )\ud835\udc65\ud835\udc60\ud835\udc59\n\ud835\udc59\u2208\ud835\udc34\ud835\udc40\ud835\udc60\u2208\ud835\udc46\n+ \u2211 \u2211 \ud835\udc5e\ud835\udc56\ud835\udc65\ud835\udc60\ud835\udc59\n\u2211 \ud835\udc51\ud835\udc60\ud835\udc60\u2208\ud835\udc46 \ud835\udc59\u2208\ud835\udc34\ud835\udc38\ud835\udc60\u2208\ud835\udc46\n+ \u2211 \u222b \ud835\udf0f\ud835\udc59(\ud835\udc64; \u210e)\ud835\udc51\ud835\udc64 \u2211 \ud835\udc65\ud835\udc60\ud835\udc59\ud835\udc60\u2208\ud835\udc46\n0\ud835\udc59\u2208\ud835\udc340\ud835\udc40\n+ \ud835\udc50\ud835\udc5c\ud835\udc5b\ud835\udc60\ud835\udc61\ud835\udc4e\ud835\udc5b\ud835\udc61\ud835\udc60\n(19)\nSubgradient optimization of estimating Lagrange multipliers \ud835\udefe\ud835\udc59 and \ud835\udefd\ud835\udc60\ud835\udc59 are shown in Algorithm 1. Algorithm 1 is stopped when the change of the Lagrange multipliers is small enough, i.e. when the L2 norm of change of the vector [\ud835\udf38, \ud835\udf37] between 2 consecutive iterations is smaller than a pre-set tolerance \ud835\udf16. Algorithm 1. Subgradient optimization for each branch.\nInitialize path sets ?\u0302?\ud835\udc60 = [ ] for all OD pairs \ud835\udc60 \u2208 \ud835\udc46. ?\u0302? = [?\u0302?\ud835\udc60, \u2200\ud835\udc60 \u2208 \ud835\udc46]. Initialize Lagrange multipliers \ud835\udefe\ud835\udc59 = 0, \u2200\ud835\udc59 \u2208 \ud835\udc34\ud835\udc39 and \ud835\udefd\ud835\udc60\ud835\udc59 = 0, \u2200\ud835\udc59 \u2208 \ud835\udc34\ud835\udc39, \u2200\ud835\udc60 \u2208 \ud835\udc46 While the L2 norm of the change of [\ud835\udf38, \ud835\udf37] between 2 consecutive iterations > tolerance \ud835\udf16:\nStep size  = 1/iteration number. Solve \ud835\udc3f1 \u2032 using Algorithm 2 with \ud835\udefe\ud835\udc59 and \ud835\udefd\ud835\udc60\ud835\udc59, obtaining link flows \ud835\udc39\ud835\udc4b and updated path set ?\u0302?. Update \ud835\udefe\ud835\udc59 with \ud835\udc39\ud835\udc4b: \ud835\udefe\ud835\udc59 = max {0, \ud835\udefe\ud835\udc59 + \ud835\udf03(\u2211 \ud835\udc65\ud835\udc60\ud835\udc59 \u2217\n\ud835\udc60\u2208\ud835\udc46 \u2212 \ud835\udc64\ud835\udc59)}. Update \ud835\udefd\ud835\udc60\ud835\udc59 with \ud835\udc39\ud835\udc4b: \ud835\udefd\ud835\udc60\ud835\udc59 = max {0, \ud835\udefd\ud835\udc60\ud835\udc59 + \ud835\udf03(\ud835\udc65\ud835\udc60\ud835\udc59\n\u2217 \u2212 \ud835\udc4f\ud835\udc60\ud835\udc59)}. Return ?\u0302?, \ud835\udc39\ud835\udc4b , \ud835\udf38, \ud835\udf37"
        },
        {
            "heading": "4.1.3. Modified Frank-Wolfe algorithm",
            "text": "After relaxing capacity and MOD node controlling constraints with Lagrange relaxation, \ud835\udc3f1 is reduced to a traffic assignment problem with congestion effects on MOD access links (\ud835\udc3f1 \u2032 ), which can be solved with a Frank-Wolfe algorithm (Frank and Wolfe, 1956; LeBlanc et al., 1975) shown in Algorithm 2. The algorithm is stopped when \ud835\udefc is smaller than a tolerance \ud835\udf00 for \ud835\udc36 consecutive iterations, where \ud835\udc36 and \ud835\udf00 are pre-set parameters.\nAlgorithm 2. Modified Frank-Wolfe algorithm for solving \ud835\udc3f1\n\u2032 .\nInitialize current link flow set \ud835\udc39\ud835\udc4b: demand of each OD pair all assigned to dummy links. Count = 0. For each OD pair \ud835\udc60 \u2208 \ud835\udc46:\nCompute link costs of fixed-route links with \ud835\udf38, \ud835\udf37: \ud835\udc61\ud835\udc60\ud835\udc59 \u2032 = \ud835\udc61\ud835\udc59 + \ud835\udefe\ud835\udc59 +\n\ud835\udc50\ud835\udc59(\ud835\udefd) +\n\ud835\udc64\ud835\udc59 \u2044 + \ud835\udefd\ud835\udc60\ud835\udc59.\nCompute link costs of MOD links: \ud835\udc61\ud835\udc60\ud835\udc59 \u2032 = \ud835\udc61\ud835\udc59 + \ud835\udc5a\ud835\udc59 + \ud835\udc5e\ud835\udc56 \u2211 \ud835\udc51\ud835\udc60\ud835\udc60\u2208\ud835\udc46 \u2044 . Compute link costs of MOD egress links: \ud835\udc61\ud835\udc60\ud835\udc59 \u2032 =\n\ud835\udc5e\ud835\udc56 \u2211 \ud835\udc51\ud835\udc60\ud835\udc60\u2208\ud835\udc46 \u2044 .\nCompute link costs of MOD access links with current link flows: \ud835\udc61\ud835\udc60\ud835\udc59 \u2032 = \ud835\udf0f\ud835\udc59(\u2211 \ud835\udc65\ud835\udc60\ud835\udc59 \u2217 \ud835\udc60\u2208\ud835\udc46 ; \u210e). (Cost of transfer links and walking links are the same as original.)\nWhile Count < \ud835\udc36: Find the shortest path of each OD pair \ud835\udc60 \u2208 \ud835\udc46, save the paths found to path sets ?\u0302?\ud835\udc60, \ud835\udc60 \u2208 \ud835\udc46. Assign all demand each OD pair to the shortest paths.\nAggregate assigned path flows to obtain auxiliary link flows \ud835\udc39\ud835\udc4c. Compute the derivative of Eq. (19) with respect to the vector of \ud835\udc65\ud835\udc60\ud835\udc59 : \ud835\udc51\ud835\udc42(\ud835\udefe,\ud835\udefd)\n\ud835\udc51\ud835\udc65 (\ud835\udc65).\nSolve \ud835\udc51\ud835\udc42(\ud835\udefe,\ud835\udefd)\n\ud835\udc51\ud835\udc65 (\ud835\udc39\ud835\udc4b + \ud835\udefc(\ud835\udc39\ud835\udc4c \u2212 \ud835\udc39\ud835\udc4b)) for \ud835\udefc.\nUpdate \ud835\udc39\ud835\udc4b: \ud835\udc39\ud835\udc4b = \ud835\udc39\ud835\udc4b + \ud835\udefc(\ud835\udc39\ud835\udc4c \u2212 \ud835\udc39\ud835\udc4b). If \ud835\udefc < tolerance \ud835\udf00:\nCount = Count + 1.\nElse:\nCount = 0\nReturn \ud835\udc39\ud835\udc4b, ?\u0302?.\nFor each branch \ud835\udc35(\ud835\udc4c1,\ud835\udc4c0,\ud835\udc491,\ud835\udc490), Algorithm 1 obtains the Lagrange multipliers, but not the flows (?\u0302?\ud835\udc45, ?\u0302?\ud835\udc3f) directly. Path flows ?\u0302?\ud835\udc45 need to be obtained with a linear programming assigning demand to the paths in the path set ?\u0302? = [?\u0302?\ud835\udc60, \u2200\ud835\udc60 \u2208 \ud835\udc46] iteratively updated by Algorithm 2. Path flow solution ?\u0302?\ud835\udc45 of the branch \ud835\udc35(\ud835\udc4c1,\ud835\udc4c0,\ud835\udc491,\ud835\udc490) can be obtained by solving a linear program minimizing system total adjusted travel cost, where adjusted link costs are the coefficients in Eq. (19). Flows of the MOD links should be the same as the MOD flows output from the final iteration of subgradient optimization, which can be formulated as\nequality constraints. OD demand is also formulated as equality constraints. Link flows ?\u0302?\ud835\udc3f can be obtained after having ?\u0302?\ud835\udc45. Then ?\u0302? and ?\u0302? can be obtained using Eq. (14) and Eq. (17). With ?\u0302?\ud835\udc3f , ?\u0302? and ?\u0302? known, the corresponding equilibrium objective value ?\u0302?\ud835\udc3f1 can be computed using Eq. (3a).\nProposition 4. Exact solution algorithm for \ud835\udc3f1. The proposed branch and bound algorithm with branching shown in Fig. 3 is an exact algorithm for finding an optimal solution to \ud835\udc3f1. Proof. The branch and bound relaxes the integral constraints of variables \ud835\udc66\ud835\udc59 and \ud835\udc63\ud835\udc56 . Only branches whose solution satisfies the integral constraints are considered feasible. These feasible solutions are used in updates of the upper bound. Since the nonlinear program after relaxing the set of binary variables is convex and the combinations of binary variables are finite, the Lagrange relaxation and Frank-Wolfe portions will converge to exact upper bounds. \u220e"
        },
        {
            "heading": "4.2. Bounded heuristic for a locally stable solution",
            "text": "Due to Lemma 1, finding a MaaS platform equilibrium requires finding a stable solution (i.e. solving \ud835\udc3f1\ud835\udc36). We propose integrating \ud835\udc3f2 and \ud835\udc3f3 into the exact solution algorithm above that guarantees a locally stable MaaS platform equilibrium that may require subsidy as shown in Fig. 3 with the \u201cStability and Pricing\u201d component.\nProposition 5. The proposed heuristic in Fig. 3 guarantees a locally stable solution that may or may not require subsidy. Proof. A stable integral solution found using \ud835\udc3f2 without subsidy means that a locally stable solution (?\u0303?\ud835\udc3f1\ud835\udc36) is found, where ?\u0303?\ud835\udc3f1\ud835\udc36 \u2265 \ud835\udc4d\ud835\udc3f1\ud835\udc36 \u2217 . The globally stable MaaS platform equilibrium (\ud835\udc4d\ud835\udc3f1\ud835\udc36 \u2217 ) is not ensured to be found. The solution to \ud835\udc3f1\ud835\udc36 may be prematurely pruned in the branch and bound process if the solution is under an integral branch for \ud835\udc3f1. However, if the optimal solution of \ud835\udc3f1 is also locally stable, it is ensured as the MaaS platform equilibrium since no stable solution with lower objective value exists.\nIn the same manner, the optimal \ud835\udc4d\ud835\udc3f1\ud835\udc46 \u2217 may be prematurely pruned, but when all branches are closed\nwe are guaranteed to have a feasible solution to a subsidized MaaS platform equilibrium. We denote this solution as ?\u0303?\ud835\udc3f1\ud835\udc46, where ?\u0303?\ud835\udc3f1\ud835\udc46 \u2265 \ud835\udc4d\ud835\udc3f1\ud835\udc46 \u2217 . In other words, the algorithm in Fig. 3 is guaranteed to obtain either ?\u0303?\ud835\udc3f1\ud835\udc46 (requiring subsidy) or ?\u0303?\ud835\udc3f1\ud835\udc36 (not requiring subsidy), whichever performs better. \u220e\nTwo sets of constraints are relaxed in the branch and bound: the integral constraints of \ud835\udc66\ud835\udc59 and \ud835\udc63\ud835\udc56, and stability constraints. Algorithm 3 shows the process of solving one branch of branch and bound integrating \ud835\udc3f2 and \ud835\udc3f3. We denote the integral-stability-relaxed problem of a branch as \ud835\udc35(\ud835\udc4c1,\ud835\udc4c0,\ud835\udc491,\ud835\udc490), which can be solved with Algorithm 1. When an integral solution is found after solving \ud835\udc35(\ud835\udc4c1,\ud835\udc4c0,\ud835\udc491,\ud835\udc490), we solve the cost allocation problem (\ud835\udc3f2) for the corresponding matching. If \ud835\udc3f2 is feasible, the stable outcome space is nonempty. With a non-empty stable outcome space and an \ud835\udc3f1 objective value lower than the lowest subsidized objective value found yet, the upper bound is updated and a locally stable solution without subsidy (?\u0303?\ud835\udc3f1\ud835\udc36) is found. If an empty stable outcome space is reached, we solve the minimum subsidy problem (\ud835\udc3f3) to find the subsidized objective value (\ud835\udc4d\ud835\udc3f1\ud835\udc46). If the subsidized objective value is lower than the lowest subsidized\nobjective value found yet, the upper bound needs updating. The complete heuristic for \ud835\udc3f1\ud835\udc46 is shown in Fig. 3. When all branches are pruned, the current upper bound (and corresponding stable outcome space) is output as ?\u0303?\ud835\udc3f1\ud835\udc46.\nAlgorithm 3. One branch of branch and bound for bounded heuristic.\nInputs: sets of integer variables constrained to be 1 and 0: \ud835\udc4c1, \ud835\udc4c0, \ud835\udc491, \ud835\udc490; solution of the branch with an integral solution and the lowest subsidized objective value found yet: ?\u0303?\ud835\udc3f , ?\u0303?\ud835\udc45, ?\u0303?, ?\u0303?, ?\u0303?, \ud835\udc48, ?\u0303?, ?\u0303?, \ud835\udc4d\ud835\udc3f1\ud835\udc46, \u211a. Solve \ud835\udc35(\ud835\udc4c1,\ud835\udc4c0,\ud835\udc491,\ud835\udc490) with Algorithm 1 to obtain ?\u0302? = [?\u0302?\ud835\udc45, ?\u0302?\ud835\udc3f , ?\u0302?, ?\u0302?, ?\u0302?\ud835\udc3f1 , ?\u0302?, \ud835\udc4c1, \ud835\udc4c0, \ud835\udc491, \ud835\udc490]. If ?\u0302?, ?\u0302? are all integers: Solve \ud835\udc3f2(?\u0302?) to obtain \ud835\udc48, ?\u0302?.\nIf \ud835\udc3f2(?\u0302?) is feasible: ?\u0302? = []. ?\u0302?\ud835\udc3f1\ud835\udc46 = ?\u0302?\ud835\udc3f1 . # A locally stable solution found Add ?\u0302? to the set of locally stable solutions. Else:\nSolve \ud835\udc3f3(?\u0302?) to obtain ?\u0302?. Total subsidy is ?\u0302?\ud835\udc45?\u0302?. Solve \ud835\udc3f2 \u2032 (?\u0302?, ?\u0302?) to obtain ?\u0302?, ?\u0302?. ?\u0302?\ud835\udc3f1\ud835\udc46 = ?\u0302?\ud835\udc3f1 + ?\u0302?\ud835\udc45?\u0302?.\nIf ?\u0302?\ud835\udc3f1\ud835\udc46 < \ud835\udc4d\ud835\udc3f1\ud835\udc46:\n?\u0303?\ud835\udc45 = ?\u0302?\ud835\udc45 , ?\u0303?\ud835\udc3f = ?\u0302?\ud835\udc3f , ?\u0303? = ?\u0302?, ?\u0303? = ?\u0302?, \ud835\udc4d\ud835\udc3f1\ud835\udc46 = ?\u0302?\ud835\udc3f1 , ?\u0303? = ?\u0302?, \ud835\udc48 = ?\u0302?, ?\u0303? = ?\u0302?, ?\u0303? = ?\u0302?.\nElse:\nIf ?\u0302?\ud835\udc3f1 < \ud835\udc4d\ud835\udc3f1\ud835\udc46:\nAppend ?\u0302? to \u211a. Return ?\u0303?\ud835\udc3f , ?\u0303?\ud835\udc45 , ?\u0303?, ?\u0303?, ?\u0303?, \ud835\udc48, ?\u0303?, ?\u0303?, \ud835\udc4d\ud835\udc3f1\ud835\udc46, \u211a, the set of locally stable solutions. # Updated current best Subsidized MaaS platform equilibrium\nWe denote a cost allocation problem given an integral solution ?\u0302? of \ud835\udc35(\ud835\udc4c1,\ud835\udc4c0,\ud835\udc491,\ud835\udc490) as \ud835\udc3f2(?\u0302?). The solution of \ud835\udc3f2(?\u0302?) includes ?\u0302? and ?\u0302? (buyer optimal or seller optimal or both), which denote a vector of users\u2019 payoffs of users \ud835\udc60 \u2208 \ud835\udc46 and a vector of link fares of matched links \ud835\udc59 \u2208 \ud835\udc34\ud835\udc5f , \ud835\udc5f \u2208 \ud835\udc45\ud835\udc60\n\u2217, \ud835\udc60 \u2208 \ud835\udc46. We denote a subsidy problem given an integral solution ?\u0302? of \ud835\udc35(\ud835\udc4c1,\ud835\udc4c0,\ud835\udc491,\ud835\udc490) as \ud835\udc3f3(?\u0302?). The solution of \ud835\udc3f3 is ?\u0302?, which denotes a vector of optimal subsidies on matched paths \ud835\udc5f \u2208 \ud835\udc45\ud835\udc60\n\u2217, \ud835\udc60 \u2208 \ud835\udc46. We denote the cost allocation with the solved subsidies as \ud835\udc3f\u20322(?\u0302?, ?\u0302?). Solution of \ud835\udc3f2\n\u2032 also includes ?\u0302? and ?\u0302?. We show that the solution has a worst-case bound defined by the subsidized equilibrium objective of\nthe matching solution for \ud835\udc3f1 (Corollary 2).\nCorollary 2. Worst-case bound. The heuristic for \ud835\udc3f1\ud835\udc46 in Fig. 3 has an objective value ?\u0303?\ud835\udc3f1\ud835\udc46 bounded from above, i.e. ?\u0303?\ud835\udc3f1\ud835\udc46 \u2264 \ud835\udc4d\ud835\udc3f1 \u2217 (\ud835\udc99, \ud835\udc9a, \ud835\udc97) + \ud835\udc4d\ud835\udc3f3|(\ud835\udc99,\ud835\udc9a,\ud835\udc97) \u2217 .\nProof. The bound used in the heuristic for \ud835\udc3f1\ud835\udc46 (\ud835\udc4d\ud835\udc3f1(\ud835\udc99, \ud835\udc9a, \ud835\udc97) + \ud835\udc4d\ud835\udc3f3|(\ud835\udc99,\ud835\udc9a,\ud835\udc97)) is greater than or equal to\nthe bound used in the exact algorithm for \ud835\udc3f1 (\ud835\udc4d\ud835\udc3f1(\ud835\udc99, \ud835\udc9a, \ud835\udc97)). The larger bound still ensures that the optimal solution of \ud835\udc3f1 is found in the branch and bound algorithm. Hence the final solution ?\u0303?\ud835\udc3f1\ud835\udc46 found by the heuristic is ensured to have a subsidized objective value smaller than the optimal solution of \ud835\udc3f1, i.e. ?\u0303?\ud835\udc3f1\ud835\udc46 \u2264 \ud835\udc4d\ud835\udc3f1 \u2217 (\ud835\udc99, \ud835\udc9a, \ud835\udc97) + \ud835\udc4d\ud835\udc3f3|(\ud835\udc99,\ud835\udc9a,\ud835\udc97) \u2217 . \u220e\nThe difference between the exact solution to \ud835\udc3f1 and the heuristic for \ud835\udc3f1\ud835\udc46 is the upper bound used in the branch and bound. The difference between the upper bounds is the subsidy. If all the integral solutions in the branch and bound algorithm are stable without subsidy (non-empty), the upper bound used in the heuristic is identical to the exact solution to \ud835\udc3f1, indicating that the final solution found is also the optimal solution to \ud835\udc3f1 and the MaaS platform equilibrium (\ud835\udc4d\ud835\udc3f1\ud835\udc36 \u2217 ) (Corollary 3).\nCorollary 3. Optimal condition. The heuristic for \ud835\udc3f1\ud835\udc46 in Fig. 3 leads to the optimal solution to \ud835\udc3f1 and the MaaS platform equilibrium (\ud835\udc4d\ud835\udc3f1 \u2217 = \ud835\udc4d\ud835\udc3f1\ud835\udc36 \u2217 ) if all the integral solutions found by the branch and bound are stable without subsidy (non-empty).\nProof. The bound used in the heuristic for \ud835\udc3f1\ud835\udc46 (\ud835\udc4d\ud835\udc3f1(\ud835\udc99, \ud835\udc9a, \ud835\udc97) + \ud835\udc4d\ud835\udc3f3|(\ud835\udc99,\ud835\udc9a,\ud835\udc97)) is greater than or equal to\nthe upper bound used in the exact algorithm for \ud835\udc3f1 (\ud835\udc4d\ud835\udc3f1(\ud835\udc99, \ud835\udc9a, \ud835\udc97)) due to the subsidy injected to unstable integer solutions. When all the integer solutions found by the branch and bound are stable without subsidy (non-empty), the upper bound used by the heuristic for \ud835\udc3f1\ud835\udc46 is the same as the exact solution algorithm for \ud835\udc3f1. In this case, the solution found by the heuristic is also the optimal solution to \ud835\udc3f1. Since the optimal solution to \ud835\udc3f1 is also stable without subsidy, there is no other stable solution with a lower objective value, indicating that the optimal solution to \ud835\udc3f1 is also the MaaS platform equilibrium (\ud835\udc4d\ud835\udc3f1 \u2217 = \ud835\udc4d\ud835\udc3f1\ud835\udc36 \u2217 )."
        },
        {
            "heading": "5 Numerical experiments",
            "text": "Two sets of computational experiments are conducted to illustrate the heuristic of finding a guaranteed locally stable solution (a solution to \ud835\udc3f1\ud835\udc46 or \ud835\udc3f1\ud835\udc36). The first is used to verify the methodology and illustrate the differences between locally and globally stable solutions. The second, tested on an expanded version of Sioux Falls, illustrates generalizable insights that can be gained from the use of this model."
        },
        {
            "heading": "5.1 Small Illustrative Case",
            "text": "We use a toy network shown in Fig. 4 to illustrate how the method works. The original network is shown in Fig. 4(a). All costs are in dollars ($). The solid links represent the fixed-route services, links with the same color are operated by the same operator. Link (21,22) and (21,23) are transfer links between lines, which are without capacity and operating cost with no owners. There are 3 MOD operators (blue, green, brown). The circles represent the service zones that MOD operators can choose from to operate (blue: A,B,C; green: B,C; brown: B,D). Zone A covers transit station node 1. Zone B covers transit station nodes 21,22,23. Zone C covers transit station node 3. Zone D covers transit station node 4.\nThe network is expanded into Fig. 4(b) by creating complete subgraphs for each MOD operator and\nadding MOD access links and egress links. Travel cost, operating cost, and capacities are labelled as shown in the legend. The access/wait cost functions of all the MOD operators on all MOD access links \ud835\udc59 are \ud835\udf0f\ud835\udc59(\u2211 \ud835\udc65\ud835\udc60\ud835\udc59\ud835\udc60\u2208\ud835\udc46 ; \u210e) = \u210e \u22122 \u2211 \ud835\udc65\ud835\udc60\ud835\udc59\ud835\udc60\u2208\ud835\udc46 . The MOD operating cost parameter of all the MOD operators at all MOD nodes is \ud835\udc5a\ud835\udc59 = 2\u210e \u22122. Fleet size choices of all MOD operators are 1, 2, and 3. The network is further expanded to Fig. 4(c) to represent the 3 fleet size options. Infrastructure cost of MOD nodes 7, 8, 9, 10, 11, 12, and 13 are 3, 3, 2, 2, 1, 1, and 3, respectively for all fleet size options. Demand is 1,000 from node 1 to 3, and 500 from node 1 to 4. Trip utility \ud835\udc48\ud835\udc60 is $9.50 for both OD pairs. The tolerance \ud835\udf16 for subgradient optimization is 0.05. The tolerance \ud835\udf00 of Frank-Wolfe is 0.01 and the required consecutive number of iterations meeting the tolerance is 5.\nThe branch and bound algorithm is coded in Python 3.8.5. It converged after running 50 branches in\n4h 51min using a laptop with 2.3 GHz Quad-Core Intel Core i7. Three locally stable solutions are found, all without subsidy. The objective values of the 3 solutions are \ud835\udc4d\ud835\udc3f1\ud835\udc36,1 = 11,850, \ud835\udc4d\ud835\udc3f1\ud835\udc36,2 = 11,849.875, and \ud835\udc4d\ud835\udc3f1\ud835\udc36,3 = 11,850.256 Since \ud835\udc4d\ud835\udc3f1\ud835\udc36,2 = \ud835\udc4d\ud835\udc3f1 \u2217 , the second solution is the globally stable MaaS platform equilibrium (\ud835\udc4d\ud835\udc3f1 \u2217 = \ud835\udc4d\ud835\udc3f1\ud835\udc36 \u2217 = \ud835\udc4d\ud835\udc3f1\ud835\udc36,2). Flows and corresponding fares of the solution are shown in Fig. 5.\nIn the MaaS platform equilibrium shown in Fig. 5, fixed-route Operators 2, 4, and 6, and MOD\nOperators 8, 9, do not enter this market. There are travelers choosing not to use the platform (300 on dummy link from (1,4)), and travelers using one of the three MOD operators (Operator 7) with a flow of 3.5 travelers. Operators 1 and 3 cooperate to serve 200 travelers. Operator 1 is required to offer free operation on link (1,21) while Operator 3 has flexibility to adjust their fare between $1 (buyer-optimal) and $4.5 (selleroptimal) for link (23,4). Operator 7 chooses to operate with a fleet size 1 instead of 2 or 3. The fare of link\n(7,13) for the MOD service between (A,C) ranges from $3.71 (buyer-optimal) to $4.50 (seller-optimal). The relatively high cost captures the congestion effect limiting further patronage. Operator revenues under seller-optimal and buyer-optimal allocations are shown in Table 1.\nThe users and operators do not have incentive to unilaterally switch. However, if two users on path [1,3] switch together to path [1,7,13,3], payoff per user becomes \ud835\udc481 \u2212 (\ud835\udf0f(1,7) + \ud835\udc61(7,13) + \ud835\udc61(13,3)) \u2212 \ud835\udc5e7+\ud835\udc5e13\n2 \u2212\n\ud835\udc5a(7,13) = $2, which is positive. The minimum payoff that one user on path [1,3] is allocated is \ud835\udc481 \u2212 \ud835\udc61(1,3) \u2212 \ud835\udc5d(1,3) = $0.5 (seller-optimal), which is smaller than the payoff of switching to path [1,7,13,3], indicating that if two users on path [1,3] switch to path [1,7,13,3] together, they would have the incentive of switching. Hence, considering local stability, both the solutions are stable, but it is not globally stable.\nIn the second locally stable solution (\ud835\udc4d\ud835\udc3f1\ud835\udc36,3), there are 1.75 units of demand on path [1,21,11,12,4] for\nOD pair 1 to 4, and the rest of the flows are the same as the optimal solution \ud835\udc4d\ud835\udc3f1\ud835\udc36,2. MOD operator 9 operates link (11,12) with a fleet size 1. Similar to the first locally stable solution, users and operators do not have incentives to switch to the optimal solution. However, if 1.75 users on path [1,21,23,4] switch to path [1,21,11,12,4], the payoff per user is \ud835\udc482 \u2212 (\ud835\udc61(1,21) + \ud835\udf0f(21,11) + \ud835\udc61(11,12) + \ud835\udc61(12,4)) \u2212 \ud835\udc5d(1,21) \u2212 \ud835\udc5e11+\ud835\udc5e12\n1.75 \u2212\n\ud835\udc5a(11,12) = $0.01 (seller-optimal). The minimum payoff that one user on path [1,21,23,4] is allocated is \ud835\udc482 \u2212 (\ud835\udc61(1,21) + \ud835\udc61(21,23) + \ud835\udc61(23,4)) \u2212 (\ud835\udc5d(1,21) + \ud835\udc5d(23,4)) = $0.01(seller-optimal), which is the same as the payoff of 1.75 users switching to path [1,21,11,12,4], indicating that the 2 paths are equally attractive."
        },
        {
            "heading": "5.2 Sioux Falls Case",
            "text": "The algorithm is further tested on the Sioux Falls network. The traditional Sioux Falls network is modeled as a combination of a walking/transfer network and fixed-route transit service segments. Network parameters (link costs and capacities) are shown in Appendix A. Walking links have 0 operating cost and are not owned by any operator. All fixed transit links have an operating cost of $400. No alternative\ncapacities are modeled for the fixed-route services. There are 4 fixed transit lines in this case, marked in Fig. 6 with blue (Operator 1), pink (Operator 2), yellow (Operator 3), and green (Operator 4). All other links are walking/transfer links. The four fixed-route operators can choose to operate or not on each of the links they own. Three MOD operators operate in the region, marked with purple (Operator 5), light blue (Operator 6), and orange (Operator 7). Candidate service regions that they cover are marked in Fig. 6. The cost of opening each MOD node is $10, $5, and $15 for MOD operator 5, 6, and 7, respectively. Alternative fleet sizes for all 3 MOD operators are 1 and 2. OD demand is shown in Appendix B. The OD pairs are all the combinations between nodes 1, 2, 12, 18, 13, and 20 (30 OD pairs), totaling 9,700 trip demand. Utility \ud835\udc48\ud835\udc60 is $20 for all OD pairs. The access/wait cost function and operating cost function of MOD are the same as the illustrative case. The access/wait cost function is \ud835\udf0f\ud835\udc59(\u2211 \ud835\udc65\ud835\udc60\ud835\udc59\ud835\udc60\u2208\ud835\udc46 ; \u210e) = 2\u210e\n\u22122 \u2211 \ud835\udc65\ud835\udc60\ud835\udc59\ud835\udc60\u2208\ud835\udc46 while the MOD link operating cost function is \ud835\udc5a\ud835\udc59 = 4\u210e 2.\nThe expanded network has 82 nodes and 748 links. All the nodes covered by each MOD operator are\nmutually connected with MOD links as complete subgraphs. The travel costs of MOD links are set to be 75% of the cost of the shortest path between the 2 nodes on the original network. MOD nodes and complete subgraphs are replicated to represent fleet sizes 1 and 2. Corresponding MOD nodes and original nodes are connected with MOD access links and egress links. The tolerance \ud835\udf16 for subgradient optimization is 0.05. The tolerance \ud835\udf00 of Frank-Wolfe and the required consecutive number of iterations is 0.01 and 5. All cases are run on a laptop with 2.3 GHz Quad-Core Intel Core i7 and 32 GB 3733 MHz LPDDR4X memory."
        },
        {
            "heading": "5.2.1. Base Case results",
            "text": "The proposed algorithm converges after solving 131 branches, taking 2h 8min (59 sec per branch on average). Flows and fares of the final solution are shown in Fig. 7. The final solution is the only solution found in the by the branch and bound, hence the optimal solution to \ud835\udc3f1 (i.e. \ud835\udc4d\ud835\udc3f1 \u2217 ). The final solution is stable without subsidy, indicating that it is a MaaS platform equilibrium (i.e. \ud835\udc4d\ud835\udc3f1\ud835\udc36 ) according to Corollary 3. Objective value is $106,400.\nEven if the MOD links are 25% faster than the shortest path of non-MOD links, there is no MOD\noperation due to the high operating and infrastructure costs. Within the 4 transit lines, only the blue line operated by Operator 1 ended up operating. Users who travel on the horizontal direction walk to the stations of the blue line (node 1,3,12,13) and take the blue line. Operator revenue, users\u2019 payoff, and unserved\ndemand are shown in the first column of Table 2. Unserved demand is 1,200 (12.4% of total demand). These users are not able to obtain non-negative payoffs given the current market and built environment."
        },
        {
            "heading": "5.2.2. Reducing MOD Operating cost",
            "text": "We model a scenario where the MOD operating costs are further reduced for Operator 5 (purple) by 50% to \ud835\udc5a\ud835\udc56\ud835\udc57 = 2\u210e 2 . Lower MOD operating costs could mean advances in MOD service technologies. For example, the reduction may be from adoption of better routing and matching algorithms and more efficient rebalancing strategies.\nIn this scenario, the proposed algorithm converges after 165 branches, taking 3h 56 min (86 sec per\nbranch on average). The final solution requires subsidy. The subsidized objective value is $106,377.82. Three other subsidized MaaS platform equilibria are found, whose subsidized objective value are all higher than the final solution. No locally stable solution without subsidy is found. The flows and fares of the final solution are shown in Fig. 8, in which solid lines represent non-MOD flows and dashed links represent MOD flows.\nThe lower cost of Operator 5 leads to market entry for Operator 5 to serve zones (1, 2, 3, 8, 10, 11, 12,\n16) with fleet size 1. Because subsidy is needed, the outcome space is a single solution representing both buyer- and seller-optimal outcomes. Subsidy is required to stabilized path [18,16,1], [18,8,1], and [18,16,12], which are all paths with MOD. Sum of fare and travel cost of a user on path [18,16,1] is $22.51, which exceeds trip utility by $2.51. Hence a $2.51 subsidy per user is injected. Similarly, sum of fare and travel cost of a user on path [18,8,1] is also $22.51, and a $2.51 subsidy per user is injected. For path [18,16,12], sum of fare and travel cost of a user is $20.26, which exceed trip utility by $0.26. Since another walking path [18,16,10,11,12] also connects OD pair (18,12) with a travel cost of $18 (no fare), the user\u2019s payoff of the walking path is $2 per user. User\u2019s payoff of path [18,16,12] should also be $2 per user to be stable. Hence the subsidy needed for path [18,16,12] is $2.26.\nAlthough the operating cost reduction is only for Operator 5, the subsidy induces market entry for\nOperator 7 (orange MOD) with a fleet size of 1. This is because some profitable paths involving Operator 5 also involves Operator 7 (path [18,8,1] and [20,8,1]). The benefit of the reduced operating cost of operator 5 is shared by operator 5 and 7, which is a result of coopetition between operators (Remark 1).\nRemark 1. The proposed model can quantify changes in operating costs for one operator in a MaaS platform inducing other operators\u2019 market entry decisions due to coopetitive effects.\nOperator 5 serves zones 10 and 11 even though no demand directly goes there because of the\ncongestion effects at zones 12 and 16 are so high they push some travelers to go further away to access MOD service (Remark 2).\nRemark 2. The proposed model can quantify impacts of congestion on operators\u2019 design decisions.\nOperator revenue, users\u2019 payoff, and unserved demand are shown in the second column of Table 2.\nTotal unserved demand dropped slightly to 1192.05 (12.3% of total demand). In this case, the impact of a lower operating cost for MOD Operator 5 on total supply of the system is not significant since some of the additional demand comes from fixed-route transit.\nMore MOD operation also leads to higher computation time for each branch. With the same tolerance,\nLagrange multipliers converge more slowly with MOD access links involved, since path costs are affected by the flows on MOD access links."
        },
        {
            "heading": "5.2.3. Reducing Fixed-route Operating cost",
            "text": "We model reduced fixed-route operating cost by reducing the operating cost of fixed-route operator 4\n(green line) by 60%, which may represent technological improvements as well as public subsidies from outside of the platform. Operating cost of all links on the green line is cut from 400 to 160.\nThe proposed algorithm converges after solving 378 branches, taking 6h 17 min (60 sec per branch on\naverage). The final solution is locally stable without subsidy. The solution is the same as the base case (Fig. 7) with an objective value of $106,400. There are 51 other subsidized solutions found in branch and bound, whose subsidized objective values are all higher than the final solution. No locally stable solution without subsidy is found.\nCost allocation results are shown in the third column of Table 2. The computation time is significantly\nhigher due to more branches solved, which is caused by a larger upper bound with subsidy added. The optimal solution to \ud835\udc3f1 requires subsidy and is shown in Fig. 9. Without subsidy, \ud835\udc4d\ud835\udc3f1 \u2217 = $106,160. The solution reflects the impact of reduced operating cost of the green line. Links (6,2), (2,6), (6,8), (8,6), (8,16), (16,8) are operated and used. However, the matching is unstable due to path [20,18,16,8,6,2]. The sum of travel cost and fare for one user of the path is $22.8, which is greater than trip utility. To stabilize the path, a subsidy of $2.8 is needed per user resulting in a total subsidy of $280. The subsidized objective value becomes \ud835\udc4d\ud835\udc3f1 \u2217 + \ud835\udc4d\ud835\udc3f3 \u2217 = $106,440, which is greater than the locally stable solution to \ud835\udc3f1\ud835\udc36 found.\nRemark 3. A reduction in operating cost to an operator may not have any impact on the market equilibrium due to local stability requirement."
        },
        {
            "heading": "5.2.4. Heterogeneous Demand",
            "text": "In real-life cases, users are heterogeneous. We model two different income groups by assigning\ndifferent trip utilities. Demand of every OD pair are evenly split into 2 halves. The one with higher income has a trip utility of \ud835\udc48\ud835\udc60 = $24 while the one with lower income has a trip utility of \ud835\udc48\ud835\udc60 = $16, resulting in the same population average trip utility as the base case of $20.\nThe proposed algorithm converged after 280 branches, taking 30h 16min (389 sec per branch on\naverage). Computation time is significantly larger due to larger dimensionality of OD pairs, since the number of user groups is increased from 30 to 60 to represent the two income levels. The final solution is not locally stable without subsidy, which means that it is a solution to \ud835\udc3f1\ud835\udc46, i.e. a feasible solution to the subsidized MaaS platform equilibrium. The subsidized objective value is $105,595.50. There are 13 other subsidized solutions found in branch and bound, with subsidized objective values higher than the final solution found. No locally stable solution without subsidy is found.\nThe solution is shown in Fig. 10, in which solid lines represent non-MOD flows and dashed links\nrepresent MOD flows. Cost allocation results are shown in the last column of Table 2. Compared with the base case, MOD operator 5 enters the market (zones 1, 2, 16) with a fleet size of 1, even if the cost parameters of MOD are the same as the base case. The difference is that only the higher-income users are served. Unserved demand substantially increases from the base case to 2240.22, in which 1,650 (73.7%) are lower-income users. In other words, by simply having a heterogeneous population, we reveal inequities as more mobility services enter the market but only serve users with higher income levels (Remark 4).\nRemark 4. The modeling of heterogeneous user groups can capture inequities in the market where operators enter primarily to serve higher income users while leaving more lower income users out of the platform.\nSubsidy is required to stabilized path [18,16,1], and [2,16,18], both paths with MOD chosen by the\nhigher-income group. The sum of fare and travel cost of a user on path [18,16,1] is $24.51, which requires\na $0.51 subsidy per user. Sum of fare and travel cost of a user on path [2,16,18] is also $27.83, which requires a $3.83 subsidy per user. MOD fares at buyer-optimal and seller-optimal vertices are the same given a very narrow stable outcome space of the paths that involves MOD."
        },
        {
            "heading": "6 Conclusion",
            "text": "In this study, we propose a MaaS platform design method for MaaS systems which incorporate fixed-\nroute transit services and MOD services, with dummy links that model users\u2019 choice of not being a part of the system. The matching problem is formulated as a convex multicommodity network design problem. We\nderive local stability conditions corresponding to this matching problem and define the optimum that is further constrained to be locally stable to be a globally stable MaaS platform equilibrium. We show that certain variables for this solution to be unique allowing for market design analysis.\nAn exact solution algorithm is proposed to solve the matching problem. The algorithm has a branch\nand bound framework. Each branch is solved through subgradient optimization with a Frank-Wolfe algorithm in each iteration. We prove that due to congestion effects, matchings may be locally unstable. A heuristic is derived from the exact algorithm to solve for a feasible solution to the MaaS platform equilibrium. Local stability is guaranteed by finding a solution that is either naturally stable or subsidized.\nTwo sets of numerical examples are conducted. With the smaller toy case, we verify the model and\nalgorithm, showing how different locally stable solutions may exist of which one is the globally stable MaaS platform equilibrium. The larger case involves an expanded version of Sioux Falls with 82 nodes and 748 links. We show, among other insights, the following:\n\u2022 The proposed model can quantify changes in operating costs for one operator in a MaaS platform inducing other operators\u2019 market entry decisions due to coopetitive effects.\n\u2022 The proposed model can quantify impacts of congestion on operators\u2019 design decisions.\n\u2022 A reduction in operating cost to an operator may not have any impact on the market equilibrium due to local stability requirement.\n\u2022 The modeling of heterogeneous user groups can capture inequities in the market where operators enter primarily to serve higher income users while leaving more lower income users out of the\nplatform.\nThe method could be applied to service design of MaaS ecosystems, including network design, pricing,\nand subsidy design. The method is able to incorporate services with different levels of flexibility: fixedroute transit (e.g. subway, bus) and MOD (e.g. ride-hailing, ride-sharing, bikesharing), and ensure the stability of the designed system. We can use this model to design external subsidies, fare bundles, different service region designs in the context of a mobility ecosystem, user heterogeneity, and evaluate the impact of a new external mode (which would alter the dummy link travel disutilities by altering the logsums).\nThe current bottleneck to the computation cost is the shortest path finding. In the subgradient\noptimization, different OD pairs have different network costs. Hence, the shortest path finding has to be run as one-to-one. When the number of user groups is large, computation cost can grow significantly if high accuracy is required, requiring modeling trade-offs in zone aggregation. Computation cost can be controlled by adjusting the tolerable gap between the upper and lower bound in branch and bound, and tolerance parameters of subgradient optimization and Frank-Wolfe algorithm. If there is a tolerable budget of subsidized system total cost, the branch and bound can be terminated when a solution below the budget is found.\nOne next step can be considered is to model heterogeneous demand as a stochastic many-to-many\nassignment game. Another possible next step is to define a desired stable outcome space considering policy goals such as efficiency, equity, and so on. In the current model, cost allocation is done in the entire stable outcome space. Subsidy is injected only to stabilize unstable matchings. With a desired stable outcome space specified, platform/agency intervention can be designed accordingly, including subsidy, fare bundles, service restrictions, and so on. The model framework can also be applied to other types of markets: electric vehicle charging infrastructure with multiple shared users, airlines and urban deliveries. For example, urban air mobility markets can be studied by breaking the trip demand into segments by trip purpose and income level to observe where vertiports should arise and which modes they can best work together with or compete against."
        },
        {
            "heading": "Acknowledgments",
            "text": "This research was conducted with partial support from NSF CMMI-1652735.\nAuthor statement\nThe authors confirm contribution to the paper as follows: study conception and design: B. Liu, J.Y.J. Chow; analysis and interpretation of results: B. Liu, J.Y.J. Chow; draft manuscript preparation: B. Liu, J.Y.J. Chow. All authors reviewed the results and approved the final version of the manuscript."
        },
        {
            "heading": "3 4 4 0 17111 19 15 3 0 14565 11 4 6 400 4909",
            "text": ""
        },
        {
            "heading": "4 3 4 0 17111 20 18 4 0 23403 11 14 4 400 4877",
            "text": "4 5 2 0 17783 20 21 6 0 5060 12 3 4 400 23403\n5 4 2 0 17783 20 22 5 0 5076 12 13 3 400 25900\n5 6 4 0 4948 21 20 6 0 5060 13 12 3 400 25900"
        },
        {
            "heading": "6 5 4 0 4948 21 24 3 0 4885 14 11 4 400 4877",
            "text": ""
        },
        {
            "heading": "7 8 3 0 7842 22 20 5 0 5076 14 23 4 400 4925",
            "text": "8 7 3 0 7842 22 23 4 0 5000 15 10 6 400 13512"
        },
        {
            "heading": "8 9 10 0 5050 23 22 4 0 5000 15 22 3 400 9599",
            "text": ""
        },
        {
            "heading": "9 8 10 0 5050 24 13 4 0 5091 16 8 5 400 5046",
            "text": "10 11 5 0 10000 24 21 3 0 4885 16 17 2 400 5230\n10 16 4 0 4855 1 3 4 400 23403 17 16 2 400 5230\n10 17 8 0 4994 2 6 5 400 4958 17 19 2 400 4824\n11 10 5 0 10000 3 1 4 400 23403 19 17 2 400 4824\n11 12 6 0 4909 3 12 4 400 23403 19 20 4 400 5003\n12 11 6 0 4909 4 11 6 400 4909 20 19 4 400 5003\n13 24 4 0 5091 5 9 5 400 10000 21 22 2 400 5230\n14 15 5 0 5128 6 2 5 400 4958 22 15 3 400 9599\n15 14 5 0 5128 6 8 2 400 4899 22 21 2 400 5230\n15 19 3 0 14565 8 6 2 400 4899 23 14 4 400 4925\n16 10 4 0 4855 8 16 5 400 5046 23 24 2 400 5079\n16 18 3 0 19680 9 5 5 400 10000 24 23 2 400 5079\n17 10 8 0 4994 9 10 3 400 13916\nAppendix B. OD demand for the Sioux Falls network\nOD ID Origin Destination Demand OD ID Origin Destination Demand\n1 2 1 100 16 1 18 100\n2 12 1 200 17 2 18 100\n3 18 1 100 18 12 18 200\n4 13 1 500 19 13 18 100\n5 20 1 300 20 20 18 400\n6 1 2 100 21 1 13 500\n7 12 2 100 22 2 13 300\n8 18 2 100 23 12 13 1300\n9 13 2 300 24 18 13 100\n10 20 2 100 25 20 13 600\n11 1 12 200 26 1 20 300\n12 2 12 100 27 2 20 100\n13 18 12 200 28 12 20 400\n14 13 12 1300 29 18 20 400\n15 20 12 500 30 13 20 600"
        }
    ],
    "title": "On-demand Mobility-as-a-Service platform assignment games with guaranteed stable outcomes",
    "year": 2023
}
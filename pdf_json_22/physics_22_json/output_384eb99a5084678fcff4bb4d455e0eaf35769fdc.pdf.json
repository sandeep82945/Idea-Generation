{
    "abstractText": "Proton therapy is a modality in fast development. Characterized by a maximum dose deposition at the end of the proton trajectory followed by a sharp fall-off, proton beams can deliver a highly conformal dose to the tumor while sparing organs at risk and surrounding healthy tissues. New treatment planning systems based on spot scanning techniques can now propose multi-field optimization. However, in most cases, this optimization only processes the field fluences whereas the choice of ballistics (field geometry) is left to the oncologist and medical physicist. In this work, we investigate a new optimization framework based on a genetic approach. This tool is intended to explore new irradiation schemes and to evaluate the potential of actual or future irradiation systems. We propose to optimize simultaneously the target points and beam incidence angles in a continuous manner and with a variable number of beams. No a priori technological constraints are taken into account, i.e. the beam energy values, incidence directions and target points are free parameters. The proposed algorithm is based on a modified version of classical genetic operators: mutation, crossover and selection. We use the real coding associated with random perturbations of the parameters to obtain a continuous variation of the potential solutions. We also introduce a perturbation in the exchange points of the crossover to allow variations of the number of beams. These variations are controlled by introducing a beam fluence lower limit. In this paper, we present a complete description of the algorithm and of its behaviour in an elementary test case. The proposed method is finally assessed in a clinically-realistic test case. Correspondence should be addressed to: jean.letang@creatis.insa-lyon.fr 1 ar X iv :2 20 5. 08 39 8v 1 [ ph ys ic s. m ed -p h] 1 7 M ay 2 02 2",
    "authors": [
        {
            "affiliations": [],
            "name": "F Smekens"
        },
        {
            "affiliations": [],
            "name": "N Freud"
        },
        {
            "affiliations": [],
            "name": "B Sixou"
        },
        {
            "affiliations": [],
            "name": "G Beslon"
        },
        {
            "affiliations": [],
            "name": "JM L\u00e9tang"
        }
    ],
    "id": "SP:efe518dc7c141cb81c94728695361f3c49e64e13",
    "references": [
        {
            "authors": [
                "A. Gemmel",
                "B. Hasch",
                "M. Ellerbrock",
                "W.K. Weyrather",
                "M. Kr\u00e4mer"
            ],
            "title": "Biological dose optimization with multiple ion fields",
            "venue": "Physics in Medicine and Biology,",
            "year": 2008
        },
        {
            "authors": [
                "F. Bourhaleb",
                "F. Marchetto",
                "A. Attili",
                "G. Pitt\u00e0",
                "R. Cirio",
                "M. Donetti",
                "S. Giordanengo",
                "N. Givehchi",
                "S. Iliescu",
                "M. Krengli",
                "A. La Rosa",
                "D. Massai",
                "A. Pecka",
                "J. Pardo",
                "C. Peroni"
            ],
            "title": "A treatment planning code for inverse planning and 3D optimization in hadrontherapy",
            "venue": "Computers in Biology and Medecine,",
            "year": 2008
        },
        {
            "authors": [
                "A. Lomax"
            ],
            "title": "Intensity modulation methods for proton radiotherapy",
            "venue": "Physics in Medicine and Biology,",
            "year": 1999
        },
        {
            "authors": [
                "M. Kr\u00e4mer"
            ],
            "title": "Swift ions in radiotherapy \u2013 treatment planning with TRiP98",
            "venue": "Nuclear Instruments and Methods in Physics Research B,",
            "year": 2009
        },
        {
            "authors": [
                "Y. Li",
                "J. Yao",
                "D. Yao"
            ],
            "title": "Automatic beam angle selection in IMRT planning using genetic algorithm",
            "venue": "Physics in Medicine and Biology,",
            "year": 2004
        },
        {
            "authors": [
                "C. Chao-min",
                "T. Mu-tao",
                "Z. Ling-hong",
                "W. Zhuo-yu",
                "L. Qing-wen",
                "S. Hua-bin"
            ],
            "title": "Implementation of inverse planning optimization in intensity modulated radiotherapy using genetic algorithm",
            "venue": "In Proceedings of IEEE International Conference on Bioinformatics and Biomedical Engineering,",
            "year": 2008
        },
        {
            "authors": [
                "S. Webb"
            ],
            "title": "Optimizing radiation therapy inverse treatment planning using the simulated annealing technique",
            "venue": "Int. J. Imaging Systems and Technology,",
            "year": 2005
        },
        {
            "authors": [
                "M. Hartmann",
                "L. Bogner"
            ],
            "title": "Investigation of intensity-modulated radiotherapy optimization with gEUD-based objectives by means of simulated annealing",
            "venue": "Medical Physics,",
            "year": 2008
        },
        {
            "authors": [
                "C. Cotrutz",
                "L. Xing"
            ],
            "title": "Segment-based dose optimization using genetic algorithm",
            "venue": "Physics in Medicine and Biology,",
            "year": 2003
        },
        {
            "authors": [
                "J. Lei",
                "Y. Li"
            ],
            "title": "An approaching genetic algorithm for automatic beam angle selection in IMRT planning",
            "venue": "Computer Methods and programs in Biomedecine,",
            "year": 2008
        },
        {
            "authors": [
                "Y. Li",
                "J. Yao",
                "D. Yao"
            ],
            "title": "Genetic algorithm based deliverable segments optimization for static intensity-modulated radiotherapy",
            "venue": "Physics in Medicine and Biology,",
            "year": 2003
        },
        {
            "authors": [
                "D.E. Goldberg",
                "K. Deb",
                "H. Kargupta",
                "G. Harik"
            ],
            "title": "Rapid, accurate optimization of difficult problems using fast messy genetic algorithms",
            "venue": "In Proceedings of the Fifth International Conference on Genetic Algorithms,",
            "year": 1993
        },
        {
            "authors": [
                "N. Hansen",
                "S. M\u00fcller",
                "P. Koumoutsakos"
            ],
            "title": "Reducing the time complexity of the derandomized evolution strategy with covariance matrix adaptation (CMA-ES)",
            "venue": "Evolutionary Computation,",
            "year": 2003
        },
        {
            "authors": [
                "C.Z. Janikow",
                "Z. Michalewicz"
            ],
            "title": "An experimental comparison of binary and floating point representations in genetic algorithms",
            "venue": "In Proceedings of the 4th International Conference on Genetic Algorithms,",
            "year": 1991
        },
        {
            "authors": [
                "F. Herrera",
                "M. Lozano",
                "J.L. Verdegay"
            ],
            "title": "Tackling real-coded genetic algorithms: Operators and tools for behavioural analysis",
            "venue": "Artificial Intelligence Review,",
            "year": 1998
        },
        {
            "authors": [
                "S. Vukovic\u0107and L. Sopta"
            ],
            "title": "Binary-coded and real-coded genetic algorithm in pipeline flow optimization",
            "venue": "Mathematical communications,",
            "year": 1999
        },
        {
            "authors": [
                "Z. Michalewicz",
                "C.Z. Janikow",
                "J.B. Krawczyk"
            ],
            "title": "A modified genetic algorithm for optimal control problems",
            "venue": "Computers & Mathematics with Applications,",
            "year": 1992
        },
        {
            "authors": [
                "R. Cavill",
                "S.L. Smith",
                "A.M. Tyrrell"
            ],
            "title": "Variable length genetic algorithms with multiple chromosomes on a variant of the onemax problem",
            "venue": "In Proceedings of the 8th annual conference on Genetic and evolutionary computation,",
            "year": 2006
        },
        {
            "authors": [
                "S. Agostinelli",
                "J. Allison",
                "K. Amako",
                "J. Apostolakis",
                "H. Araujo",
                "P. Arce"
            ],
            "title": "Geant4\u2014a simulation toolkit",
            "venue": "Nuclear Instruments and Methods in Physics Research A,",
            "year": 2003
        },
        {
            "authors": [
                "J. Allison",
                "K. Amako",
                "J. Apostolakis",
                "H. Araujo",
                "P. Arce Dubois",
                "M. Asai"
            ],
            "title": "Geant4 developments and applications",
            "venue": "IEEE Transactions on Nuclear Science,",
            "year": 2006
        },
        {
            "authors": [
                "E. Batin"
            ],
            "title": "Influence of the chemical composition of human tissues on dose distributions in hadrontherapy",
            "venue": "PhD thesis, Universite\u0301 de Caen (France),",
            "year": 2008
        },
        {
            "authors": [
                "R.L. Siddon"
            ],
            "title": "Fast calculation of the exact radiological path for a three-dimensionnal CT array",
            "venue": "Medical Physics,",
            "year": 1985
        },
        {
            "authors": [
                "F. Jacobs",
                "E. Sundermann",
                "B. De Sutter",
                "M. Christiaens",
                "I. Lemahieu"
            ],
            "title": "A fast algorithm to calculate the exact radiological path through a pixel or voxel space",
            "venue": "Journal of Computing and Information Technology,",
            "year": 1998
        },
        {
            "authors": [
                "H. Zhao",
                "A.J. Reader"
            ],
            "title": "Fast ray-tracing technique to calculate line integral paths in voxel arrays",
            "venue": "IEEE Nuclear Science Symposium Conference Record,",
            "year": 2003
        },
        {
            "authors": [
                "F. Rothlauf"
            ],
            "title": "Binary representations of integers and the performance of selectorecombinative genetic algorithms",
            "venue": "Lecture Notes in Computer Science,",
            "year": 2002
        },
        {
            "authors": [
                "E. Scheibmann",
                "M. Lahanas",
                "L. Xing",
                "D. Baltas"
            ],
            "title": "Multiobjective evolutionary optimization of the number of beams, their orientations and weights for intensity-modulated radiation therapy",
            "venue": "Physics in Medicine and Biology,",
            "year": 2004
        },
        {
            "authors": [
                "T. Blickle",
                "L. Thiele"
            ],
            "title": "A comparison of selection schemes used in evolutionary algorithms",
            "venue": "Evolutionary Computation,",
            "year": 1996
        }
    ],
    "sections": [
        {
            "text": "In this work, we investigate a new optimization framework based on a genetic approach. This tool is intended to explore new irradiation schemes and to evaluate the potential of actual or future irradiation systems. We propose to optimize simultaneously the target points and beam incidence angles in a continuous manner and with a variable number of beams. No a priori technological constraints are taken into account, i.e. the beam energy values, incidence directions and target points are free parameters.\nThe proposed algorithm is based on a modified version of classical genetic operators: mutation, crossover and selection. We use the real coding associated with random perturbations of the parameters to obtain a continuous variation of the potential solutions. We also introduce a perturbation in the exchange points of the crossover to allow variations of the number of beams. These variations are controlled by introducing a beam fluence lower limit.\nIn this paper, we present a complete description of the algorithm and of its behaviour in an elementary test case. The proposed method is finally assessed in a clinically-realistic test case.\nCorrespondence should be addressed to: jean.letang@creatis.insa-lyon.fr\nar X\niv :2\n20 5.\n08 39\n8v 1\n[ ph\nys ic\ns. m\ned -p\nh] 1\n7 M"
        },
        {
            "heading": "1 Introduction",
            "text": "Ion beam therapy is a fast developing modality using ion beams (protons or carbon ions) to treat tumors. Characterized by a maximum dose deposition at the end of the particle trajectory (Bragg peak) followed by a sharp fall-off, ion beams can deliver a highly conformal dose to the planning target volume (PTV) while sparing the organs at risk (OAR) and the surrounding normal tissues (NT). Recently, new treatment planning systems (TPS) dedicated to spot scanning techniques have been proposed to simultaneously optimize several fields and thus improve the dose delivery [1, 2]. A typical treatment generally consists of several fractions and requires a computed tomography (CT) scan, the contouring of the tumor and of critical structures, and the inverse planning, i.e. the optimization of the beam parameters that make it possible to obtain the prescribed homogeneous dose inside the PTV.\nIn this paper, we investigate a new optimization framework based on a genetic algorithm (GA). This tool is intended to explore new irradiation schemes and to assess the potential of actual or future irradiation systems. We propose to optimize simultaneously the target points and beam incidence angles in a continuous manner and with a variable number of beams. No a priori technological constraints are applied to the beam energy values, incidence directions and target points. The TPS is generally divided into two parts: the dose simulation engine and the optimization algorithm. Our work focuses on the optimization algorithm which has to converge towards an optimum with any dose simulation scheme.\nIn the spot scanning active delivery mode (intensity modulated particle therapy \u2013 IMPT), a proton beam with a transverse Gaussian profile (typically 5\u201310 mm FWHM) is scanned in two dimensions using magnetic devices [3]. The proton penetration depth in matter is adjusted by tuning the beam energy. Note that carbon ions can be used in the same way and present an higher (variable) biological effectiveness which has to be taken into account in the TPS using suitable models. The treatment plan generally combines less than 6 fields for which the entrance channels are manually selected. For each field, an analytical method is used to cover the PTV with spots, then a gradient descent is used to adjust the beam fluences to obtain a homogeneous dose in the tumor and to limit the dose in OAR [4].\nIn the IMRT field, planning techniques have been investigated with mixed analytical and probabilistic optimization, such as genetic algorithms [5, 6] and simulated annealing [7, 8]. In most cases, the probabilistic method only addresses the optimization of a single aspect, i.e. the angles, shape or weight of the beams [5, 10, 6, 9, 11], whereas the others are processed with an analytical method or based on clinical experience.\nAmong the existing evolutionary algorithms, Messy GA [12] and the state-of-the-art evolutionary strategy CMA-ES (Evolution Strategy with Covariance Matrix Adaptation) [13] present very good convergence and speed properties. As Messy GA have recourse to very specific operators and CMA-ES to a heavy mathematical formalism, we preferred to stick to classical genetic operators (mutation, crossover and selection), which can be more easily adapted to the inverse planning problem, based on physical considerations. These operators were modified to optimize the parameters, i.e. target points and beam incidences, in a continuous space and to allow variations of the individual genome length, i.e. of the number of beams. The continuous aspect of our method was introduced by using the real coding of the individuals instead of the binary coding [14, 15, 16] and a specific non-uniform mutation scheme [17]. Genome size variations were implemented using a cut-and-splice crossover operator [18].\nIn section 2, the dose simulation scheme adopted in this work is succinctly described (section 2.1), followed by a description of the proposed GA (section 2.2). The convergence results presented in section 3 are discussed in terms of dynamics and efficiency in a simple test case (section 3.1) and in a clinically-realistic case (section 3.2)."
        },
        {
            "heading": "2 Optimization scheme",
            "text": "We propose to optimize a pencil beam scanning (PBS) treatment plan in protontherapy based on a GA. The beam target positions, incidence angles as well as the number of beams are optimized simultaneously. The dose distribution model is described in section 2.1 and the different parts of the GA are detailed in section 2.2."
        },
        {
            "heading": "2.1 Dose calculation",
            "text": "In this study, a simplified pencil beam description is adopted to favor speed as the GA approach requires many generations (typically 103) and, for each generation, many dose simulations. Every pencil beam is described as a single ray. It is worthy of note that this model does not account for the lateral straggling of ions and the Gaussian transversal profile of the pencil beams. The main steps of the dose calculation are the following:\n\u2022 A beam is oriented in space by its incident direction (angles \u03b8 and \u03c6) and target position (vector p) considered as the Bragg peak position. This determines the energy of the beam. The corresponding depth-dose profile is obtained using a set of profiles in water, pre-calculated using the Monte Carlo (MC) code Geant4 [19, 20]. The material heterogeneities are taken into account by the water equivalent path length method [21].\n\u2022 Each beam is propagated in a voxel matrix using a fast raycasting method [22, 23, 24]. This method returns the list of voxels traversed by the beam with the corresponding path lengths. It makes it possible to calculate the dose deposited by a beam with unit fluence in every voxel along its trajectory.\n\u2022 A fast gradient-based method is then used to optimize the beam fluence values, so that a homogeneous dose is obtained in the PTV.\nNote that the dose simulation model is independent from the GA optimization and can be replaced in a straightforward way by physically more realistic models (with increased computational cost)."
        },
        {
            "heading": "2.2 Variable length genetic algorithm",
            "text": "In the GA approach, a set of individuals represented by a list of genes evolves simultaneously through the landscape, i.e. the solution space of the problem. The proposed method is based on the classical mutation, crossover and selection GA operators:\n\u2022 Mutation modifies the genes of individuals with a probability pm (generally small).\n\u2022 Crossover mixes two individuals by exchanging parts of their genetic material with a probability pc (generally high).\n\u2022 Selection retains an individual in the next generation with a selection probability based on its fitness score.\nThese operators were adapted to the context of treatment planning, including (i) a continuous parameter representation (through real parameter coding), (ii) a non-uniform mutation scheme, (iii) a clinically-relevant objective function associated to an exponential ranking operator, and (iv) a variable-length individual genome, i.e. number of beams (through a cut-and-splice crossover)."
        },
        {
            "heading": "2.2.1 Parameter coding",
            "text": "In GAs, the coding of individuals (genotype) is generally different from their real representation (phenotype). The most common ways to code the genes in GAs are the binary and real coding. The binary coding represents an individual as a list of parameters (i.e. vectors or angles) transformed into binary chains of fixed size whereas, in the real coding, the indvidual is directly coded by the real parameter values. It has been proved [14, 15] that real coding was able to avoid the Hamming cliffs phenomenon [25] known to be present in the binary coding. Real coding is also preferable for optimization problems where the objective function is a real value [16].\nIn what follows, an individual is defined as a set of beams, defined by their target position and incidence angles."
        },
        {
            "heading": "2.2.2 Non-uniform mutation",
            "text": "A mutation operator adapted to real parameter coding was defined. The most common way is to select a mutant parameter with a probability pm (typically about 0.01) and to add a Gaussian noise of fixed FWHM to the parameter value. This scheme, well-suited for fixed size individuals, presents some disadvantages when considering a varying size genome. As the crossover operator makes the beam number increase, the average distance between parameter values (e.g. target positions in the PTV region) becomes smaller and smaller leading to an unadapted FWHM of Gaussian noise. Moreover, if the same individual is selected more than once in a generation, the small mutation probability pm is not sufficient to create a significant difference between these individuals.\nTo tackle these issues, a non-uniform mutation scheme was used [17]. At each generation all the coding parameters are modified by adding an exponentially decreasing noise as follows:\nv\u2032p = vp \u00b1 \u03b4(\u03bbp) (1)\nwhere vp and v\u2032p are respectively the old and new values of parameter p, \u03b4 is a fluctuation randomly picked in the exponentially decreasing distribution of mean \u03bbp. In the case of the target position, this operation is repeated for every space coordinate. An empirical rule was established to rule the evolution of \u03bbp: if no better solution is found during 20 generations, all \u03bbp values decrease by 10%. In addition, a simple rule is defined for the non-coding parameters (see section 2.2.4), specifying that the beam is randomly reinitialized, for it to contribute to the forthcoming genetic evolution.\nAn automatic method was developed to set the initial \u03bbp values. For target positions, it is chosen equal to the mean distance between two neighbor target positions considering a uniform distribution of the initial positions in the tumor. We applied the same method for the perturbations of incidence angles \u03c6 and \u03b8 considering a uniform distribution around the tumor."
        },
        {
            "heading": "2.2.3 Objective function and selection",
            "text": "The purpose of the objective function is to assess the adaptation of an individual to its environment. In treatment planning, the dose distribution map of an individual is compared to a prescribed distribution segmented into regions of interest. We consider PTV, OAR and NT region types. The score is calculated using squared residuals [26, 5] as follows:\nfobj = I\u2211 i=0 fi (2)\nwith\nfi = 1\nN\u2217i Ni\u2211 n=1 \u03b4i,n(dn \u2212 pi)2 (3)\nwhere fobj is the total score of the objective function, I is the total number of regions, fi is the region score, N\u2217i a normalization factor, n is the nth voxel in the ith region containing Ni voxels,\ndn is the deposited dose, and pi is the dose prescription. \u03b4i,n is a boolean flag which is set to 1 except for OAR and NT region if dn \u2264 pi. The aim of fPTV is to tend to the prescribed dose values whereas fOAR and fNT ensure the dose stays lower than a limit. The normalization factor N\u2217i is set to the number of voxels in the case of PTV and OAR. As the NT region often has many more voxels than other regions, N\u2217NT represents the number of NT voxels crossed by the beams, averaged over the individuals. To account for the varying number of beams, N\u2217NT is updated every 50th generation.\nAssociated to the objective function, a selection operator was defined. In the classical selection scheme, individuals are randomly picked in the current generation using a probability proportional to their score. However, with this method, a highly adapted individual can easily screen the others, leading to premature convergence. Therefore, an exponential ranking selection scheme [27] was used, in which the selection probability depends on the rank of the individual and not directly on its objective function value. This highly favors the best individuals while allowing fit (but not optimal) individuals to participate to the optimization process."
        },
        {
            "heading": "2.2.4 Cut-and-splice crossover",
            "text": "The cut-and-splice crossover [18] is a well known operator which makes it possible to introduce perturbations in the individual size (number of beams). In contrast with the one-point crossover where a single cut point is randomly chosen for the two parents, the cut-and-splice operator generates a random cut point for each of them. For example, parents of sizes (s1, s2) and random cut point positions (\u03b11, \u03b12) will generate children of sizes (\u03b11+s2\u2212\u03b12, \u03b12+s1\u2212\u03b11). This operator was tested but did not produce satisfactory results in the absence of any constraints on the cut point positions. To deal with this issue, a modified cut-and-splice crossover scheme was proposed:{\ns1 = \u03b1+ \u03b2 s2 = k(\u03b1+ \u03b2)\n\u21d2 { s\u20321 = \u03b1+ k\u03b2 + \u03b41 \u2212 \u03b42 s\u20322 = k\u03b1+ \u03b2 + \u03b42 \u2212 \u03b41\n(4)\nwhere s is the parent size, s\u2032 the child size, \u03b1 the cut position of parent 1, \u03b2 the remaining length of parent 1 and k the ratio of parent sizes s2/s1. \u03b4 is a random perturbation generated with a Gaussian distribution centered at zero. Note that cut points are always chosen between beams. The FWHM is set so that \u03b4 is quite small (FWHM between 2 and 10 beams) leading to a slowly increasing number of beams (because individuals with larger numbers of beams provide a better geometrical coverage of the PTV). Accordingly, the mean beam fluence slowly decreases. A lower limit of the beam fluence is applied to control the beam number. If the beam fluence is below this limit (after the fluence optimization process, see section 2.1), the beam is considered as non-coding (its contribution to the dose is not taken into account in the objective function). A minimum number of 2\u00d7 103 protons per beam was chosen."
        },
        {
            "heading": "3 Results",
            "text": "In this section, we study the global dynamics of the proposed variable length GA, i.e. how the inclusion of the beam number in the genetic process affects the evolution (see section 3.1). Then the optimization of a clinically-realistic test case is fully detailed (see section 3.2)."
        },
        {
            "heading": "3.1 Global GA dynamic",
            "text": "The introduction of the beam number in the optimized parameters modifies the GA dynamics. The genetic operators used to control the individual size have to be tuned. These two aspects are investigated through (i) a comparison between genetic algorithms with and without operators specific to the variable length and (ii) a study of the influence of the initial beam number and crossover perturbation.\nAll the optimization test cases presented in this section were carried out on an artificial Cshaped tumor (figure 1). The volume is composed of 64\u00d764\u00d764 of cubic voxels of water with a 1\nmm voxel size. The optimized parameters are the target position p restricted to the tumor volume and the angle \u03c6 comprised between 0 and 360\u25e6 (the irradiation is planar). The dose prescribed to the PTV is 4 Gy and the limits for the OAR and NT are respectively 0 and 1 cGy."
        },
        {
            "heading": "3.1.1 Effects of variable length specific operators",
            "text": "The dynamics of the proposed GA is investigated by means of a comparison with two simpler algorithms in which only some of the operators presented in section 2.2 are activated. All algorithms use real coding (section 2.2.1) as well as the objective function and selection operator (section 2.2.3). The two simpler algorithms are the following:\n\u2022 The first one only uses basic operators which do not affect the number of beams, i.e. the classical 1-point crossover and the non-uniform mutation operator (section 2.2.2) without the concept of non-coding genes.\n\u2022 The second one uses the previously proposed specific operators: cut-and-splice crossover (section 2.2.4) and non-uniform mutation restricted to the random replacement of non-coding genes.\nThe population size was set to 50 individuals, the initial beam number to 1000 and the crossover rate to 0.5. The convergence of the objective function and the corresponding evolution of the number of beams are represented in figure 2.\nWe can see that the three algorithms converge to different values of the objective function. With the basic operators, in spite of the fixed number of beams, the objective function (red lines) decreases sharply in the first 2000 generations and reaches a minimum after about 6000 generations. This behavior can be explained by the optimization of the beam layout, enhanced by the restricted number of beams. In contrast, with the specific operators, genetic diversity is generated by the constant bringing of new beams and the random replacement of non-coding beams, which leads to a very fast evolution during the 500 first generations. However the decrease of the objective function progressively stops when the number of beams increases. It is worthy of note that the beam number continues to grow linearly without any additional benefit. In this case, the optimization of the objective function comes from the increase in the number of beams rather than the quality of the beam layout. In the case of the proposed GA (\u2019all operators\u2019), the evolution process displays two different regimes: (i) during the first 1000 generations the beam layout is optimized with only slight variations in the number of beams and a drop of the mean value of the objective function; (ii) then the number of beams increases (variable length dynamics) and are successfully used to further improve the objective function by performing a local search.\nThe final solution is better than with the specific operators alone, with a lower number of beams. The proposed algorithm is thus a satisfactory trade-off between the quality of the beam layout and the number of beams."
        },
        {
            "heading": "3.1.2 Setting of GA parameters",
            "text": "In what follows, the influence of crossover perturbation, initial number of beams and fluence limit are discussed.\nInfluence of crossover perturbation Two tests were carried out with Gaussian perturbation \u03b4 of FWHM respectively equal to 2 and 10 beams (see section 2.2.4). The population size was set to 50 individuals, the initial beam number to 50 and the crossover rate to 0.5. The convergence of the objective function and the corresponding evolution of the number of beams are represented in figure 3.\nThe results show that the cut-and-splice operator directly drives the evolution of the number of beams: with a high crossover perturbation (blue line) the number of beams increases much faster than with a low perturbation.\nHowever, the objective function reaches almost identical mean values: the search is mainly driven by the mutation operator and not by the cut-and-splice crossover. A high crossover perturbation favors a research based on the quantity of genes to the detriment of mutation-based optimization. In addition, the low perturbation optimization considerably reduces the calculation time since a smaller number of beams has to be simulated.\nInfluence of initial beam number The influence of the initial number of beams in the genetic process was studied by running tests with 50, 1000, 2500 and 5000 initial beams. The crossover perturbation was set to a FWHM of 2 beams and all other genetic parameters were kept the same as in paragraph 3.1.2. Figure 4 presents the convergence of the objective function and the corresponding evolution of the number of beams.\nLike in the crossover perturbation study, the dynamics of the objective function are almost identical and converge to the same solution. The evolution of the number of beams for the different initial configurations seems to eventually tend to the same asymptotic value. However, the genetic optimization of the beam layout is more efficient when a smaller initial number of beams is considered: it is more difficult to optimize a large number of beams from scratch than to gradually integrate new beams at each generation.\nInfluence of fluence limit The role of the fluence limit is to prevent the formidable increase of the number of beams that would most likely happen with the cut-and-splice crossover. Two tests were carried out with fluence limits of 2000 and 10000 particles per beam and are represented in figure 5.\nContrary to the crossover perturbation and initial number of beams, the fluence limit constrains the objective function as we can see in figure 5 (top). The optimization process displays two successive phases: (i) the number of beams increases first and the total number of incident protons (needed to obtain the prescribed dose in the PTV) is therefore gradually distributed over a larger set of beams, which reduces the average fluence per beam; (ii) then the fluence reaches the limit which stops the increase in the number of coding beams. The asymptotic value of the number of coding beams is directly related to the fluence limit, which is driven by the physics: a smooth depth-dose profile cannot be obtained with a poor statistics. We observed with the Geant4 MC code that a limit of 2000 particles per beam leads to acceptable depth-dose profiles in the case of proton pencil beams. The quality of the beam layout is still given by the number of degrees of freedom (i.e. the number of beams), the higher the fluence limit, the lower the quality of the beam layout at convergence."
        },
        {
            "heading": "3.2 Clinically-realistic optimization",
            "text": "Our algorithm was tested on a clinically-realistic case based on a CT model of a human head (see figure 6). This model consists of a single PTV of 5.8 cm3 surrounded by typical OAR regions for a brain tumor case, i.e. the eyes, the optic nerves, the temporal lobes and the brain stem. The rest of the head volume is considered as NT regions. The dose prescription to the PTV is set to 4 Gy and the dose limits to OAR and NT regions respectively to 0 and 0.01 Gy. Note that for the eyes, the optic nerves and the temporal lobes, left and right parts are independent regions.\nThe optimization concerns the target positions and the beam incidence angles \u03c6 and \u03b8. Target positions p are restricted to the PTV region, \u03c6 is defined between 0\u25e6 and 360\u25e6 and \u03b8 between 0\u25e6 and 120\u25e6 in order to avoid the irradiation of the inferior part of the body (figure 6, left). These parameters are randomly initialized. All the operators proposed in section 2.2 are used, with crossover rate and perturbation set to 0.5 and 2 beams FWHM, respectively. The population size is set to 50 individuals and the initial number of beams to 200. Figure 7 shows the convergence of the objective function components.\nWe can see that the relative contributions to the objective function evolve during the optimization. At the beginning, PTV and NT regions represent about 96% of the total objective function value. This is due to the low number of beams that cannot fully cover the PTV region and concentrate high dose in NT voxels. On the contrary, OAR regions benefit from this situation since only a few OAR voxels are irradiated. All along the optimization process, the contribution of the NT region remains the largest because every beam has to pass through NT. In spite of those unequal contributions, all the components of the objective function are optimized simultaneously. Note that the normalization of the region score by the number of voxels in the region (see section 2.2.3) is the cause of higher noise in the convergence curve of small regions.\nIn the evolution of the number of beams (figure 7, bottom), the slope changes after about 5600 generations. Before this point, the PTV benefits from a fast increase in the number of beams, which leads to an excellent coverage of the tumor volume. Then the PTV objective reaches a minimum due to the stop condition of the gradient-based fluence optimization (see section 2.1). The optimization is then driven by the NT region for which the spreading of the dose and consequently a higher number of beams is useful.\nThe initial and final dose maps are represented in figure 8 for the 50th slice of the volume, which includes most OAR regions. In the initial dose map, the PTV coverage with 200 beams is not\nsatisfactory and a few beam trajectories pass through OAR regions. In the final dose map obtained with about 3000 optimized beams, the dose in the PTV region is almost perfectly homogeneous (the largest deviation from the prescription is 7.5\u00d710\u22124). The algorithm has also found a suitable beam layout, avoiding OARs and limiting the dose to NT."
        },
        {
            "heading": "4 Conclusion",
            "text": "In this paper, we proposed a new inverse planning method intended to find the optimal beam layout for the spot scanning technique. A variable length GA with continuous parameters optimization combined with a gradient method is used to optimize simultaneously the beam number, the target positions and the incidence angles. This optimization tool was developped in a modular way in order to take into account multiple regions of different types, with different dose constraints. We took great care in choosing the genetic operators to make the best use of the GA characteristics:\n\u2022 we adopted a non-uniform mutation scheme adapted to real coding which does not require the definition of a mutation rate. The genetic process is accelerated by a reinitialization of non-coding beams.\n\u2022 we introduced a modified cut-and-splice crossover operator to make the beam number evolve smoothly.\n\u2022 a rank-based selection operator is used to avoid premature convergence.\nThe dynamics of the proposed GA was first studied using a simple optimization test case. The influence of the initial beam number and mutation and crossover operator settings was discussed. It was found that simple rules are sufficient to tune the algorithm and obtain efficient convergence. Our method was then successfully used in a clinically-realistic test case."
        }
    ],
    "title": "Variable length genetic algorithm with continuous parameters optimization of beam layout in proton therapy",
    "year": 2022
}
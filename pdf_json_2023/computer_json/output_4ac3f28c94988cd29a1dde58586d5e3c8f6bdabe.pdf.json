{
    "abstractText": "In this work, we present an efficient optic flow algorithm for the extraction of vertically resolved 3D atmospheric motion vector (AMV) fields from incomplete hyperspectral image data measures by infrared sounders. The model at the heart of the energy to be minimized is consistent with atmospheric dynamics, incorporating ingredients of thermodynamics, hydrostatic equilibrium and statistical turbulence. Modern optimization techniques are deployed to design a low-complexity solver for the energy minimization problem, which is non-convex, non-differentiable, high-dimensional and subject to physical constraints. In particular, taking advantage of the alternate direction of multipliers methods (ADMM), we show how to split the original high-dimensional problem into a recursion involving a set of standard and tractable optic-flow sub-problems. By comparing with the ground truth provided by the operational numerical simulation of the European Centre for Medium-Range Weather Forecasts (ECMWF), we show that the performance of the proposed method is superior to state-of-the-art optical flow algorithms in the context of real infrared atmospheric sounding interferometer (IASI) observations.",
    "authors": [
        {
            "affiliations": [],
            "name": "P. H\u00c9AS"
        }
    ],
    "id": "SP:0e961e54a658d23d9a39c0f28eb0de2db7e44e2a",
    "references": [
        {
            "authors": [
                "J.M. Apke",
                "K.A. Hilburn",
                "S.D. Miller",
                "D.A. Peterson"
            ],
            "title": "Towards objective identification and tracking of convective outflow boundaries in next-generation geostationary satellite imagery. Atmospheric Measurement Techniques",
            "year": 2020
        },
        {
            "authors": [
                "J.M. Apke",
                "J.R. Mecikalski",
                "K. Bedka",
                "E.W. McCaul",
                "C.R. Homeyer",
                "C.P. Jewett"
            ],
            "title": "Relationships between deep convection updraft characteristics and satellite-based super rapid scan mesoscale atmospheric motion vector\u2013derived flow",
            "venue": "Monthly Weather Review 146(10),",
            "year": 2018
        },
        {
            "authors": [
                "K.M. Bedka",
                "J.R. Mecikalski"
            ],
            "title": "Application of satellite-derived atmospheric motion vectors for estimating mesoscale flows",
            "venue": "Journal of Applied Meteorology and Climatology 44(11),",
            "year": 2005
        },
        {
            "authors": [
                "K.M. Bedka",
                "C.S. Velden",
                "R.A. Petersen",
                "W.F. Feltz",
                "J.R. Mecikalski"
            ],
            "title": "Comparisons of satellite-derived atmospheric motion vectors, rawinsondes, and noaa wind profiler observations",
            "venue": "Journal of Applied Meteorology and Climatology 48(8),",
            "year": 2009
        },
        {
            "authors": [
                "D.P. Bertsekas"
            ],
            "title": "Nonlinear Programming, 2nd edn",
            "venue": "Athena Scientific",
            "year": 1999
        },
        {
            "authors": [
                "R. Borde",
                "M. Carranza",
                "O. Hautecoeur",
                "K. Barbieux"
            ],
            "title": "Winds of change for future operational amv at eumetsat",
            "venue": "Remote Sensing 11(18),",
            "year": 2019
        },
        {
            "authors": [
                "S. Boyd",
                "N. Parikh",
                "E. Chu",
                "B. Peleato",
                "J. Eckstein"
            ],
            "title": "Distributed optimization and statistical learning via the alternating direction method of multipliers",
            "venue": "Found. Trends Mach. Learn",
            "year": 2011
        },
        {
            "authors": [
                "D.J. Butler",
                "J. Wulff",
                "G.B. Stanley",
                "M.J. Black"
            ],
            "title": "A naturalistic open source movie for optical flow evaluation",
            "venue": "European Conf. on Computer Vision (ECCV), Part IV,",
            "year": 2012
        },
        {
            "authors": [
                "E.J. Candes",
                "L. Demanet"
            ],
            "title": "The curvelet representation of wave propagators is optimally sparse",
            "venue": "Communications on Pure and Applied Mathematics 58(11),",
            "year": 2005
        },
        {
            "authors": [
                "P. D\u00e9rian",
                "P. H\u00e9as",
                "C. Herzet",
                "E. M\u00e9min"
            ],
            "title": "Wavelets and optical flow motion estimation",
            "venue": "Numerical Mathematics: Theory, Methods and Applications 6(1),",
            "year": 2013
        },
        {
            "authors": [
                "J. Eckstein",
                "D.P. Bertsekas"
            ],
            "title": "On the Douglas-Rachford splitting method and the proximal point algorithm for maximal monotone operators",
            "venue": "Math. Program",
            "year": 1992
        },
        {
            "authors": [
                "S. English",
                "T. McNally",
                "N. Bormann",
                "K. Salonen",
                "M. Matricardi",
                "A. Moranyi",
                "M. Rennie",
                "M. 22 Janiskov\u00e1",
                "S. Di Michele",
                "A Geer"
            ],
            "title": "Impact of satellite data",
            "venue": "ECMWF Research Department Techn. Memo",
            "year": 2013
        },
        {
            "authors": [
                "D. Fortun",
                "P. Bouthemy",
                "C. Kervrann"
            ],
            "title": "Optical flow modeling and computation: A survey",
            "venue": "Computer Vision and Image Understanding 134,",
            "year": 2015
        },
        {
            "authors": [
                "S. Foucart",
                "H. Rauhut"
            ],
            "title": "A Mathematical Introduction to Compressive Sensing",
            "venue": "Applied and Numerical Harmonic Analysis",
            "year": 2013
        },
        {
            "authors": [
                "R. Glowinski",
                "S. Osher",
                "W. Yin"
            ],
            "title": "Splitting Methods in Communication, Imaging, Science, and Engineering",
            "venue": "Scientific Computation. Springer International Publishing",
            "year": 2017
        },
        {
            "authors": [
                "P. H\u00e9as",
                "A. Dr\u00e9meau",
                "C. Herzet"
            ],
            "title": "An efficient algorithm for video superresolution based on a sequential model",
            "venue": "SIAM Journal on Imaging Sciences",
            "year": 2016
        },
        {
            "authors": [
                "P. H\u00e9as",
                "C. Herzet",
                "E. M\u00e9min",
                "D. Heitz",
                "P.D. Mininni"
            ],
            "title": "Bayesian estimation of turbulent motion. IEEE transactions on pattern analysis and machine intelligence",
            "year": 2012
        },
        {
            "authors": [
                "P. Heas",
                "F. Lavancier",
                "S.K. Harouna"
            ],
            "title": "Self-similar prior and wavelet bases for hidden incompressible turbulent motion",
            "venue": "SIAM Journal on Imaging Sciences",
            "year": 2014
        },
        {
            "authors": [
                "P. H\u00e9as",
                "E. M\u00e9min"
            ],
            "title": "Three-dimensional motion estimation of atmospheric layers from image sequences. IEEE transactions on geoscience and remote sensing",
            "year": 2008
        },
        {
            "authors": [
                "P. Heas",
                "E. Memin",
                "D. Heitz",
                "P. Mininni"
            ],
            "title": "Power laws and inverse motion modeling: application to turbulence measurements from satellite images",
            "venue": "Tellus A 64,",
            "year": 2012
        },
        {
            "authors": [
                "P. H\u00e9as",
                "E. M\u00e9min",
                "N. Papadakis",
                "A. Szantai"
            ],
            "title": "Layered estimation of atmospheric mesoscale dynamics from satellite imagery",
            "venue": "IEEE Transactions on Geoscience and Remote Sensing 45(12),",
            "year": 2007
        },
        {
            "authors": [
                "J. Holton"
            ],
            "title": "An introduction to dynamic meteorology",
            "year": 1992
        },
        {
            "authors": [
                "B. Horn",
                "B. Schunck"
            ],
            "title": "Determining optical flow",
            "venue": "Artificial Intelligence 17,",
            "year": 1981
        },
        {
            "authors": [
                "S. Kadri Harouna",
                "P. D\u00e9rian",
                "P. H\u00e9as",
                "E. M\u00e9min"
            ],
            "title": "Divergence-free Wavelets and High Order Regularization",
            "venue": "International Journal of Computer Vision 103(1),",
            "year": 2013
        },
        {
            "authors": [
                "W. Lahoz",
                "B. Khattatov",
                "R. Menard"
            ],
            "title": "Data Assimilation: Making Sense of Observations",
            "year": 2010
        },
        {
            "authors": [
                "A. Nicolas",
                "F. Zentgraf",
                "M. Linne",
                "A. Dreizler",
                "B. Peterson"
            ],
            "title": "Assessment and application of wavelet-based optical flow velocimetry (wofv) to wall-bounded turbulent flows",
            "venue": "Experiments in Fluids 64(3),",
            "year": 2023
        },
        {
            "authors": [
                "J. Nocedal",
                "S.J. Wright"
            ],
            "title": "Numerical Optimization. Springer Series in Operations Research",
            "year": 1999
        },
        {
            "authors": [
                "N. Parikh",
                "S. Boyd"
            ],
            "title": "Proximal algorithms. Foundations and Trends in Optimization",
            "year": 2014
        },
        {
            "authors": [
                "P. Raviart",
                "J. Thomas"
            ],
            "title": "Introduction \u00e0 l\u2019analyse num\u00e9rique des \u00e9quations aux d\u00e9riv\u00e9es partielles. Collection Math\u00e9matiques appliqu\u00e9es pour la m\u00e2\u0131trise",
            "year": 1983
        },
        {
            "authors": [
                "D. Santek",
                "S. Nebuda",
                "D. Stettner"
            ],
            "title": "Demonstration and evaluation of 3d winds generated by tracking features in moisture and ozone fields derived from airs sounding retrievals",
            "venue": "Remote Sensing 11(22),",
            "year": 2019
        },
        {
            "authors": [
                "B. Schmidt",
                "J. Sutton"
            ],
            "title": "High-resolution velocimetry from tracer particle fields using a waveletbased optical flow method",
            "venue": "Experiments in Fluids",
            "year": 2019
        },
        {
            "authors": [
                "D. Suter"
            ],
            "title": "Motion estimation and vector splines",
            "venue": "Proc. Conf. Comp. Vision Pattern Rec.,",
            "year": 1994
        },
        {
            "authors": [
                "P.D. Tafti",
                "M. Unser"
            ],
            "title": "On regularized reconstruction of vector fields",
            "venue": "Image Processing, IEEE Trans. on 20(11),",
            "year": 2011
        },
        {
            "authors": [
                "C. Temperton",
                "M. Hortal",
                "A. Simmons"
            ],
            "title": "A two-time-level semi-lagrangian global spectral model",
            "venue": "Quarterly Journal of the Royal Meteorological Society 127(571),",
            "year": 2001
        },
        {
            "authors": [
                "M. Unser",
                "A. Aldroubi",
                "M. Eden"
            ],
            "title": "Fast B-Spline transforms for continuous image representation and interpolation",
            "venue": "IEEE Transactions on Pattern Analysis and Machine Intelligence 13(3),",
            "year": 1991
        },
        {
            "authors": [
                "Y. Wang",
                "W. Yin",
                "J. Zeng"
            ],
            "title": "Global convergence of admm in nonconvex nonsmooth optimization",
            "venue": "Journal of Scientific Computing",
            "year": 2019
        }
    ],
    "sections": [
        {
            "text": "Key words. 3D atmospheric motion vector fields, infrared atmospheric sounding interferometer, data assimilation, transport equation, vertical winds, constrained optimization, wavelet-based optic flow.\n1. Introduction. Numerical weather prediction (NWP) models require the assimilation of meteorological observations. NWP models must be continuously fed with a wide range of in situ observations, such as radiosondes, radars, buoys, aircraft measurements, and observations extracted from satellite data. The proportion of satellite data assimilated into numerical weather prediction models has increased considerably in recent years, as these data cover all regions of the Earth, especially the oceans and polar regions, where few in situ measurements are available [14]. Atmospheric motion vectors (AMVs) derived from satellite images are the only wind observations with good global coverage [6].\nAlthough AMVs have a significant positive impact on forecast scores, they provide information at only one level of the atmosphere and their retrieval is highly dependent on the presence of clouds. Therefore, they cannot meet the user requirements on horizontal winds defined by the world meteorological organization in its report on applications of global numerical weather prediction: horizontal and vertical resolutions of 50 km and 1 km, respectively [1]. On the other hand, there is currently no reliable alternative based on satellite imagery to extract vertical wind profiles, and one must rely solely on conventional radiosonde measurements, wind profiles during ascent and descent of civil aircraft and by the radar Doppler network. In contrast to satellite images, these observations are sparse and mainly collected in the northern hemisphere and over land areas. Therefore, profiles of horizontal and vertical winds have been identified as the most critical atmospheric variables that are not adequately measured by current or planned systems [2].\n\u2217INRIA Rennes & IRMAR, Universite\u0301 de Beaulieu, 35042 Rennes, France (Patrick.Heas@inria.fr) \u2020Exostaff GmbH, Riedstrasse 6, 64404 Bickenbach, Germany \u2021EUMETSAT, Eumetsat Allee, 64295 Darmstadt, Germany\nar X\niv :2\n30 3.\n05 15\n4v 1\n[ cs\n.C V\n] 9\nM ar\n2 02\n3\nInfrared sounder measurements have been ranked as the second highest priority for horizontal wind profile retrieval, second only to Doppler wind lidar lidar measurements [1]. This ranking is evaluated as a mixture of several elements such as uncertainty, horizontal and vertical resolution, and frequency of recovered measurements, which are found to be primarily determined by the observing technique and the earth orbit (geostationary or low) of the satellite. Several works have been conducted to investigate the extraction of AMV profiles from moisture and temperature fields retrieved from these hyperspectral instruments [32]. These studies have pointed out difficulties and limitations linked to the common techniques used to extract AMVs. Most of the AMV extraction algorithms apply cross-correlation techniques on sequences of consecutive images [5]. The frequent lack of contrast in the moisture fields retrieved from the hyperspectral sounders does not permit the unambiguous identification of features in the images. Moreover, the moisture fields are characterized by large areas with missing observations making the tracking task even harder [4]. This frequently leads to a poor matching, limiting overall AMV production.\nEnergy minimization methods, known in the computer vision literature as optic flow algorithms, have shown promise as approaches in atmospheric science because of their good adaptation to the inherent physical nature of images, and because they can handle low contrast and missing observations, see [15] for a review on optic flow. Among other meteorological studies, these techniques have been applied to the identification of flow boundaries [3], or adapted to the estimation of layered AMV fields at different altitudes in the troposphere by satellite measurements of cloud top temperature [23]. Using the latter approach, the methodology has then been extended to the three-dimensional layered estimation of AMVs [21]. Finally, preliminary studies on the estimation of vertical profiles of dense 3D AMV fields using hyperspectral observations have been conducted in [8].\nIn line with the latter work, this paper proposes an improved optic flow methodology for the characterization of vertical profiles of 3D AMV fields processing noisy and incomplete hyperspectral satellite observations. The improvement is threefold. First, the model at the heart of the optic flow technique is based on a consistent physical modeling of atmospheric dynamics. Specifically, on the one hand, the data term incorporates a hydrostatic equilibrium constraint and a term penalizing deviations from the thermodynamic equation, providing a unified framework for the two wellknown meteorological methods used for estimating vertical motion: the kinematic method and the adiabatic method [24]. On the other hand, the regularization term is adapted to statistical models of atmospheric turbulence [22, 19]. Secondly, the noise and the missing image observations are managed by the coupling of the estimation of AMV fields with the reconstruction of dense maps of temperature, humidity and ozone concentration. Lastly, modern optimization techniques are deployed to manage the optic flow problem taking the form of a high-dimensional, non-convex and nondifferentiable minimization problem subject to physical constraints. More precisely, we design alternate direction of multipliers methods (ADMM) to split the constrained high-dimensional problem into a set of unconstrained differentiable parallel minimizations [9]. These latter problems remain non-convex and high-dimensional. We rely on the wavelet expansion of the AMV fields [12, 26, 20, 33, 28] and employ large scale quasi-Newton methods [29] to deal efficiently with these problems.\nThis paper is organized as follows. In section 2, we present the atmospheric model on which our methodology is based. The optic flow estimation problem is then formalized in section 3, while a dedicated efficient solver is proposed in section 4. A\nnumerical evaluation compares in section 5 the performance of the proposed method with a benchmark of state-of-the-art optic flow algorithms, for real observations of the Infrared Atmospheric Sounding Interferometer (IASI) . The ground truth used for the evaluation procedure is the synchronized data provided the operational numerical model of the European Centre for Medium-Range Weather Forecasts (ECMWF). Finally, a last section draws the conclusion.\n2. Geophysical Modeling. We hereafter propose a set of constraints relating vertical profiles of AMVs fields, which we will refer to 3D AMVs, to the time evolution of the spatial distribution over the three dimensional space of three meteorological quantities, namely temperature, specific humidity and ozone concentration. The model relies on standard atmospheric dynamics presented in [24].\n2.1. Pressure-Averaged Atmospheric States. Let us consider an isobaric coordinate system with the spatial coordinates denoted by (s, p) \u2208 \u2126\u00d7Z \u2282 R3. The spatial distribution at time t \u2208 R of the three meteorological quantities of interest is represented by the bounded multivariate function \u03c1(s, p, t) defined over \u2126 \u00d7 Z \u00d7 R and taking its values in R3. We are interested in relating the time evolution of function \u03c1(s, p, t) to the time evolution of horizontal wind function v(s, p, t), both function being defined over \u2126 \u00d7 Z \u00d7 R and taking their values respectively in R3 and R2. To this aim, we consider the discretization of the pressure interval Z into a finite set of decreasing pressure levels {pk}Kk=0 with pk > pk+1, yielding pressure increments denoted by \u03b4pk = pk\u2212pk+1 for k \u2208 K = {0, . . . ,K\u22121}. Using this vertical discretization, the spatial distribution of the meteorological quantities over the three dimensional space is represented by a stack {\u03c1k}k\u2208K of pressure-averaged functions \u03c1k : \u2126\u00d7 R\u2192 R3 defined as\n\u03c1k(s, t) = 1\n\u03b4pk \u222b pk pk+1 \u03c1(s, p, t)dp, (2.1)\nand a stack {vk}k\u2208K of pressure-averaged horizontal winds vk : \u2126\u00d7 R\u2192 R2 as\nvk(s, t) = 1\n\u03b4pk \u222b pk pk+1 v(s, p, t)dp. (2.2)\nIn addition, we introduce the vertical wind functions \u03c9(s, p, t) defined over \u2126\u00d7Z \u00d7R and taking its values in R. The vertical winds taken at the discrete set of pressure levels yield the stack {\u03c9k(s, t)}Kk=0 whose elements are \u03c9k(s, t) = \u03c9(s, pk, t).\n2.2. Time-Integrated Atmospheric Dynamics. As detailed in Appendix A, simplified geophysical models describing the time evolution of temperature and specific humidity may be obtained by neglecting diabetic heating in the first law of thermodynamics. Moreover, similar simplified model may be obtained making the common assumption that ozone concentration evolves as a passive scalar transported by the flow. These dynamical models take the form of the transport equation described hereafter. Assuming some mild smoothness condition1, the pair (xkt0 ,x k t1) can be identified to the solution \u03c1k(s, t) taken on the points of the grid \u2126m, at times t0\n1The horizontal and vertical wind fields are asumed to be vk(s, t) \u2208 (C1(\u2126 \u00d7 R))2, \u03c9k(., t) \u2208 C1(\u2126\u00d7 R) and Lipschitz continuous.\nand t1 (with t0 < t1) of the transport equation of initial condition \u03c1 k t0(s) \u2202\u03c1k \u2202t (s, t) + vk(s, t) \u00b7 \u2207s\u03c1k(s, t) + 1 2 (\u03b3k\u03c9k(s, t) + \u03b3k+1\u03c9k+1(s, t)) = 0,\n\u03c1k(s, t0) = \u03c1 k t0(s)\n, (2.3)\nwhere vk(s, t) \u00b7 \u2207s\u03c1k(s, t) denotes the scalar product of the gradients of each of the three components of \u03c1k(s, t) with vk(s, t), and where the \u03b3k \u2208 R3 are known physical constants. It is well known that under mild conditions, when \u03b4t , t1 \u2212 t0 is a small increment, we obtain from (2.3) by time integration the Lagrangian form of the dynamics which we will call the warping constraints2\n\u03c1kt0(s) = \u03c1 k t1(s+ \u03b4tv k(s, t0)) + \u03b4t\n2 (\u03b3k\u03c9k(s, t0) + \u03b3 k+1\u03c9k+1(s, t0)). (2.4)\n2.3. Constraint on Hydrostatic Equilibrium. Besides, mass conservation provides in addition to (2.4) a geophysical constraint on the structure of horizontal and vertical winds. Indeed, in isobaric coordinates mass conservation writes:\n\u2212\u2202\u03c9(s, p, t) \u2202p = \u2207s \u00b7 v(s, p, t). (2.5)\nVertical integration of (2.5) in the pressure interval [pk, pk+1] yields3 at time t0 for k \u2208 K what we will call the hydrostatic constraints\n\u03c9k(s, t0)\u2212 \u03c9k+1(s, t0) = \u03b4pk\u2207s \u00b7 vk(s, t0), (2.6)\nwith the boundary conditions \u03c90(s, t0) = 0 and \u03c9 K(s, t0) = 0 for any s \u2208 \u2126. These boundary conditions on vertical winds can be argued as follows: for the lowest layer (k=0), the Earth boundary condition implies zero vertical winds, while for the highest layer (k=K) a reasonable assumption is that vertical wind can be neglected at the tropopause which acts like a cover.\n2.4. Spatial Discretization. We now describe the spatial discretization of the continuous functions introduced in the previous sections. Consider the image grid\n\u2126m = {s \u2208 \u2126 : s = \u03ba(j), j = 1, . . . ,m},\n2Let the function t\u2192 Xtt0 (s) be the characteristic curves of the partial differential equation (2.3), solution of the system:  d dt Xtt0 (s) = v k(Xtt0 (s), t)\nXt0t0 (s) = s\n.\nIt follows from (2.3) that the field at initial time satisfies [31]\n\u03c1kt0 (s) = \u03c1 k(Xt1t0 (s), t1) + \u222b t1 t0 1 2 (\u03b3k\u03c9k(Xt \u2032 t0 (s), t\u2032) + \u03b3k+1\u03c9k+1(Xt \u2032 t0 (s), t\u2032))dt\u2032.\nWe then obtain (2.4) by assuming that \u222b t1 t0 vk(Xt \u2032 t0 (s), t\u2032)dt\u2032 = \u03b4tvk(s, t0), and that the vertical winds \u03c9k and \u03c9k+1 are constant in the time interval [t0, t1]. 3under the assumption on the vertical wind function mentioned earlier.\nwhere \u03ba(j) is the function returning the spatial position corresponding to index j. Using this spatial discretization of the bi-dimensional domain \u2126, we finally define at time t the stack x?t of images in R3Km, whose k-th layer is a vector with m tri-variate components xkt (j) = \u03c1\nk(\u03ba(j), t), \u2200j : \u03ba(j) \u2208 \u2126m. We are interested in the pair of stack of pressure-averaged images at time t0 and t1, i.e., (x ? t0 ,x ? t1) \u2208 (R3Km)2. Related to the image grid \u2126m, we also define the AMVs: a stack of pressureaveraged horizontal displacement fields d? \u2208 R2Km, whose k-th layer is a vector of m bi-variate components defined as dk(j) = \u03b4tvk(\u03ba(j), t0), \u2200j : \u03ba(j) \u2208 \u2126m, and a stack of vertical displacement fields \u03c9? \u2208 R(K+1)m located at the frontiers of the layers, whose k-th component is the vector with m components defined as \u03c9k(j) = \u03c9k(\u03ba(j), t0), \u2200j : \u03ba(j) \u2208 \u2126m, where according to the boundary conditions, we have for any j the conditions \u03c90(j) = 0 and \u03c9K(j) = 0.\n2.5. 3D AMV Model. We are now ready to define the 3D AMV model, which relies on pressure-averaged time-integrated and spatially-discretized physical conservation laws.\nThe first constraint defining our discrete model for 3D AMVs relies on mass conservation given in its pressure-averaged and spatially-discretized form by the hydrostatic constraints (2.6). Applied on the pixel grid, the latter takes for k \u2208 K the form of\n\u03c9k \u2212 \u03c9k+1 = \u03b4pkdiv(dk). (2.7)\nLet us note that the components of the vector div(dk) in Rm is the divergence at location in \u2126m of a continuous representation of d\nk on the bi-dimensional domain \u2126. Then, in order to complement this mass constraint, for each couple (xkt0 ,x k t1) we will need to assume a continuous model for interpolating the images xkt1 outside of \u2126m. Taking the warping constraints (2.4) at points in \u2126m, we rewrite the warping model for the k-th layer as\nxkt0 =W(x k t1 ,d k,\u03c9k,\u03c9k+1), (2.8)\nwhere operator W : R3m\u00d7R2m\u00d7Rm\u00d7Rm \u2192 R3m in (2.8) warps the stack of images xkt1 into x k t0 according to the AMV pressure-averaged horizontal component d\nk and to the vertical winds \u03c9k and \u03c9k+1 on the upper and lower layer boundary. The j-th component output Wj : R3m \u00d7 R2m \u00d7 Rm \u00d7 Rm \u2192 R3 of operator W is the function defined as Wj(xkt1 ,d\nk,\u03c9k,\u03c9k+1) =\u2211 i\u2208V(\u03ba(j)+dk(j)) xkt1(i)\u03d5i(\u03ba(j) + d k(j))\u2212 \u03b4t 2 (\u03b3k\u03c9k(j) + \u03b3k+1\u03c9k+1(j)), (2.9)\nwhere V(\u03ba(j)+dk(j)) denotes a subset of indices corresponding to the \u201cneighborhood\u201d of point \u03ba(j) + dk(j). The family {\u03d5i}mi=1 with \u03d5i : \u2126m \u2192 R is chosen to be the bidimensional cubic cardinal splines interpolation functions [37]. Note that the stack of images xkt0 is a deterministic function of x k t1 and d\nk, \u03c9k and \u03c9k+1. We remark that W is linear in its first, third and fourth arguments and non-linear in its second one as long as \u03d5i\u2019s are non-linear.\nTo summarize, the 3D AMV model is (2.7)\u2013(2.9).\n3. Formulation of the Estimation Problem. In this section, we expose our methodology to estimate pressure-averaged vertical profiles of 3D AMV fields. The estimation relies on vertically resolved and partially observed fields of temperature, specific humidity and ozone.\n3.1. Partial Observations. We refer to the stack (d?,\u03c9?,x?t1) of K triple satisfying the 3D AMV model (2.7)\u2013(2.9), as the \u201cground truth\u201d. The ground truth related to the k-th layer of the stack will be denoted by the triple (dk,?,\u03c9k ? ,xk,?t1 ). Of course the ground truth is usually unknown, but we may assume some generative model relating the ground truth to the available noisy and partial observations. More explicitly, let \u2126t0,kobs , \u2126 t1,k obs \u2286 \u2126m denote the set of spatial locations of the image grid related to the observed components of xk,?t0 and x k,? t1 . The set of observations is\ny = {ykt (j) \u2208 R3 : \u03ba(j) \u2208 \u2126 t,k obs; t \u2208 {t0, t1}; k \u2208 K} \u2208 Y,\nwhere Y \u2208 R3Km and the three components of ykt (j) are those of x k,? t (j) up to some additional centered Gaussian noise of covariance I\u03c32obs = diag(\u03c3 2 obs, \u03c3 2 obs, \u03c3 2 obs). Therefore, according to the warping model (2.8), the observations at the k-th layer are generated from the ground truth as\nykt0(j) =Wj(x k,? t1 ,d k,?,\u03c9k ? ,\u03c9k+1,?) +N (0, I\u03c32obs), \u03ba(j) \u2208 \u2126 t0,k obs , ykt1(j) = x k,? t1 (j) +N (0, I\u03c32obs), \u03ba(j) \u2208 \u2126 t1,k obs .\nMore involved schemes use alternative noise assumptions to take into account noise correlation and non-quadratic deviations, see references in [10].\n3.2. Optimization Problem. Given the incomplete observations y of temperature, humidity and ozone, the problem is the estimation of 3D AMVs, i.e., (d?,\u03c9?) \u2208 RK2m \u00d7 R(K\u22121)m, together with the estimation of the stack of images x?t1 \u2208 R\n3Km. The vector parametrizing the 3D AMV model (2.7)\u2013(2.9) is thus \u03b8? = (d?\u1d40,\u03c9?\u1d40,x?t1 \u1d40)\u1d40 \u2208 Rn, with\nn = (6K \u2212 1)m.\nLet us point out that the dimension n of the 3D AMV model is typically huge: considering the realistic scenario of K = 24 layers and images of size m = 29\u00d7 29, the number of degrees of freedom n of the 3D AMV model is greater than 24 millions. Let us consider an optimization variable \u03b8 = (d\u1d40,\u03c9\u1d40,x\u1d40t1)\n\u1d40 \u2208 Rn of dimension identical to \u03b8?. Our approach is based on the resolution of the hard constrained optimization problem  arg min (d,\u03c9,xt1 ) J (d,\u03c9,xt1 ,y) +\u03b1dRd(d) +\u03b1xRx(xt1),\ns.t. h(d,\u03c9) = 0, (3.1)\nwhere the cost J denotes the data term, Rd and Rx denote some regularizers, and h denotes some constraint. The components of parameter vectors \u03b1d = (\u03b1 1 d, \u00b7 \u00b7 \u00b7 , \u03b1Kd )\u1d40 and \u03b1x = (\u03b1 1 x, \u00b7 \u00b7 \u00b7 , \u03b1Kx )\u1d40 are positive reals, which we assumed pre-defined by expert knowledge. Alternatively, substituting the hard constraint in (3.1) by a quadratic penalization, we may also consider the soft constrained minimization problem\narg min (d,\u03c9,xt1 )\nJ (d,\u03c9,xt1 ,y) +\u03b1dRd(d) +\u03b1xRx(xt1) + \u03c1h(d,\u03c9)2, (3.2)\nwhere \u03c1 is a given positive real. Let us provide some precisions on the components of problem (3.1) and (3.2).\n3.2.1. The Linear Constraint. The constraint in (3.1) or the function in (3.2) is linear and defined as\nh(d,\u03c9) = Dd\u2212 L\u03c9 (3.3)\nwith matrices L \u2208 RKm\u00d7(K\u22121)m and D \u2208 RKm\u00d72Km. The hydrostatic balance (2.7) under the vertical wind boundary conditions can be rewritten in the form of the matrix-vector products (3.3) by choosing specific matrices L and D. We remark that in this case this linear constraint generates an overdetermined system in \u03c9: there are (K\u22121) unknown m-dimensional vertical wind fields, for K m-dimensional constraints. However, m-linear rows of L are linearly dependent. As a consequence, there exists a unique \u03c9 satisfying the linear constraint, for any value of D d. Therefore in problem (3.1), \u03c9 can be expressed as a deterministic function of d: \u03c9 = L\u2020D d. As we shall see, optimization with the linear constraint L\u03c9 = D d will be preferable in terms of algorithmic implementation to the use of the deterministic function \u03c9 = L\u2020D d, as it offers the possibility to parallelize the optimization procedure.\n3.2.2. The Data Term. The data-term J in (3.1) is a function depending on the vector \u03b8 = (d\u1d40,\u03c9\u1d40,x\u1d40t1)\n\u1d40 \u2208 Rn and on observations y \u2208 Y. Its aim is to penalize discrepencies between given states xt at time t = t0 and t1 and the related observations (when available), where we recall that xt0 is a deterministic mapping of xt1 by the warping model (2.8). More precisely, we define the residual function\n\u03b4 : Rn \u00d7 Y \u2192 R6m such that \u03b4(\u03b8,y) = ( \u03b4t0(\u03b8,y) \u03b4t1(\u03b8,y) ) , with the (k, j)-th component of \u03b4t(\u03b8,y) defined for k \u2208 K and \u03ba(j) \u2208 \u2126m as:\n\u03b4k,st (\u03b8,y) =\n{ xkt (j)\u2212 ykt (j) if \u03ba(j) \u2208 \u2126 t,k obs\n0 else . (3.4)\nWe have assumed that the observation noise is Gaussian and uncorrelated. Under this Gaussian assumption, the most likely state is the one minimizing the square of the residual function norm. We thus define the data-term simply as\nJ (\u03b8,y) = 1 2 \u2016\u03b4(\u03b8,y)\u201622. (3.5)\n3.2.3. The Regularizers. It is well known that solving problem (3.1) or (3.2) with no regularization, i.e., setting the regularization parameters to zero, yields a severely ill-conditioned problem. In the present meteorological context, some regularizers are more appropriate than others to the specificity of the geophysical flows.\nIndeed, many options for Rd have been proposed in the computer vision literature, starting with the famous first-order optic flow regularization [25]. However, this model is not suitable for fluid flows, as it smoothes out the vortex and divergence structures. Second-order schemes are more relevant for fluid flows. Among others, popular approaches are to smooth the gradient of the divergence and vorticity [34] or the higher order derivatives [26]. Recent schemes [35, 20], propose a quadratic regularization taking the form of\n\u03b1dRd(d) = 1\n2 K\u22121\u2211 k=0 \u03b1kd\u2016\u2206mdk\u201622. (3.6)\nwhere the operator \u2206m : R2m \u2192 Rm is defined as a finite approximation of the bidimensional Laplacian operator applied to the displacement field dk. The regularization (3.6) provides a relevant prior structure for geophysical flows, which characterizes an isotropic self-similar structure for 2D turbulence [19, 20].\nWith respect to the Rx regularizer, a standard approach to reconstructing dense fields from the observation of incomplete maps is to rely on sparse priors [16]. In particular, the geophysical variables of temperature, humidity, and ozone concentration, which are solutions of a transport equation of the form (2.3), admit a sparse decomposition in some well-chosen basis as argued in [11]. Specifically, we will assume that the temperature, humidity, and ozone concentration images in the xt1 stack are sparse in a dictionary of two-dimensional interpolation functions. To this aim, we represent the components of the state xkt1 \u2208 R 3m using three series. Let xk,`t1 \u2208 R m for ` = 1, 2, 3 be the `-th image of the stack xkt1 . We define x k,` t1 = \u03a6\u0304 c\nk,`, where \u03a6\u0304 \u2208 Rm\u00d7m is an orthonormal basis {\u03c6i}mi=1 with \u03c6i : \u2126m \u2192 R, and with the coefficient vector ck,` \u2208 Rm. Denoting by ck \u2208 R3m the concatenation of the ck,`\u2019s for ` = 1, 2, 3, and furthermore denoting by c \u2208 R3Km the concatenation of the ck\u2019s for k \u2208 K, we define operator \u03a6 : R3Km \u2192 R3Km such that xt1 = \u03a6 c. Coefficients ck are related to the image stack xkt1 through the latter decomposition. It is now well established that the sparse assumption may be modeled (under some specific assumption) by an `1 norm penalization [16], i.e.,\n\u03b1xRx(xt1) = 1\n2 K\u22121\u2211 k=0 \u03b1kx\u2016ck\u20161. (3.7)\n4. Efficient Solvers. As mentioned earlier, the number of variables involved in the constrained minimization problem (3.1) is typically huge. Moreover, the objective function is non-convex (due to the data term J ) and non-differentiable (due to the regularizer Rx). Accessing the minimum of the constrained minimization problem in this context is obviously a difficult task. Although the convergence to a global minimum is usually out of reach for any deterministic optimization procedure, local minima can still constitute relevant approximations. Nevertheless, only specificallydedicated procedures can address efficiently such a high-dimensional, non-convex, non-differentiable and constrained optimization problem.\nIn the sequel, we propose optimization methods based on the alternating direction method of multipliers (ADMM) [9]. We will also specify some convergence issues for the ADMM procedure particularized to our problem. ADMM appeared more than ten years ago in the optimization community to deal with large-scale constrained and nondifferentiable optimization problems. This type of method is known for its robustness (convergence to a local minimum is is ensured under very mild conditions) and for its fast convergence to an acceptable accuracy (typically, a few tens of iterations are sufficient). We refer the reader to Appendix B.1 for a brief description of the ADMM framework.\n4.1. Dealing with Constraints and Non-Differentiability. In order to solve a non-differentiable constrained optimization problem, ADMM transforms it into a three-stage recursion in which the first two stages are standard unconstrained minimization problems. To derive ADMM recursions, we reformulate the constrained optimization problem (3.1). To this aim, we add a new variables to the problem: c\u0303 made of the concatenation of vectors c\u03030, ..., c\u0303K\u22121, which are counterbalanced by the\ninclusion of a new constraint c\u0303 = c. Problem (3.1) can then be reshaped as arg min d,\u03c9,c,c\u0303 J (d,\u03c9, c) +\u03b1dRd(d) +\u03b1xRx(\u03a6c\u0303), s.t. ( D \u2212L 0 0 0 I )d\u03c9 c + ( 0\u2212I ) c\u0303 = ( 0 0 ) .\n(4.1)\nAs detailed in Appendix B.2, this constrained optimization problem fits the generic ADMM procedure exposed in appendix B.1. It yields a solution obtained by iterating until convergence the three following steps:\n(d(i+1),\u03c9(i+1), c(i+1)) = arg min d,\u03c9,c\nJ (d,\u03c9, c) +\u03b1dRd(ed) + \u03c1\n2 \u2016c\u2212 c\u0303 (i) + uc (i)\u201622\n+ \u03c1\n2 \u2016Dd\u2212 L\u03c9 + u(i)d \u2016 2 2, (4.2)\nc\u0303k,` (i+1)\n(s) = soft\u03b1kx \u03c1\n( ck,` (i+1)(s) + uk,`c (i)(s) ) , k \u2208 K, ` \u2208 {1, 2, 3}, s : \u03c7(s) \u2208 \u2126m,\n(4.3){ u\n(i+1) d = u (i) d + D d (i+1) \u2212 L\u03c9(i+1)\nu (i+1) c = u (i) c + c(i+1) \u2212 c\u0303(i+1)\n, (4.4)\nwhere \u03c1 > 0 and where\nsoft\u03bb (a) =  a\u2212 \u03bb if a \u2265 \u03bb,a+ \u03bb if a \u2264 \u2212\u03bb, 0 otherwise.\n(4.5)\nLet us make the following remarks about the different steps of the ADMM recursion. First, problem (4.2) is a differentiable but non-convex and n-dimensional minimization problem. Second, (4.3) corresponds to the definition of the proximal operator of the `1 norm and is based on the simple soft-thresholding operator (4.5). We note that, the solution of (4.3) is typically sparse since soft-thresholding enforces the small coefficients to be equal to zero.\nInterestingly, we remark that the solution of the soft constrained problem (3.2) can be computed using the same steps (4.2)-(4.4), but substituting the first update in (4.4) by u (i+1) d = 0.\nNote that since the steps (4.3)-(4.4) of the procedure only involves vector additions, the particularization of ADMM to our problem leads to an algorithm exhibiting a complexity O(Km) per iteration scaling linearly in the problem dimensions, as long as the first step (4.2) scales linearly. We will see in the Section 4.3.2 that the first step is solved in fact in a log linear time. However, it is important to notice that step (4.2) is the computational bottleneck of the ADMM procedure, because, on the contrary to the other two ADMM steps, the high-dimensional problem can not be divided into lower-dimensional sub-optimization problems of complexity independent of K. Indeed, the K subsets of variables {dk, ck} are all inter-depending through the action of vertical winds \u03c9. Thus, this ADMM procedure does not offer a natural structure for parallelization, which constitute a crucial issue for this high-dimensional optimization problem.\n4.2. Dealing with High-Dimensionality by Splitting. As mentioned previously, the ADMM recursion (4.2)-(4.4) gathers K sets of high-dimensional variables, interacting on each others through the (K \u2212 1) vertical wind fields. Strategies based on optimal control can be efficient to deal with this dependence of variables across vertical levels [7]. However, the ADMM algorithm enjoys also a very high popularity as an efficient tool for the fast solution of large-scale optimization problems due to its ability at taking advantage of the structure of the variable dependance through operator splitting [17]. Assume without loss of generality that K is even. As proposed hereafter, a variable splitting allows to solve (3.1) by solving independently K/2 subproblems, and thus enabling parallel computation of complexity independent of K.\nProblem (4.1) can equivalently written as\n arg min d,\u03c9,\u03c9\u0303,c,c\u0303 J (d,\u03c9, c) +\u03b1dRd(d) +\u03b1xRx(c\u0303), s.t. D \u2212L 00 I 0 0 0 I d\u03c9 c +  0 0\u2212I 0 0 \u2212I (\u03c9\u0303 c\u0303 ) = 00 0  , (4.6)\nwhere we have added a new variable to the problem (4.1): \u03c9\u0303 made of the concatenation of respectively vectors \u03c9\u03031, ..., \u03c9\u0303K\u22121, which is counterbalanced by the inclusion of the new constraint \u03c9\u0303 = \u03c9.\nAs detailed in Appendix B.3, by splitting the set of variables into the two subsets according to their height level indexes whether in K\u2032 = {0, 2, 4, . . . ,K \u2212 2} or in K\u2032\u2032 = {1, 3, 5, . . . ,K \u2212 1}, the constrained optimization problem (4.6) fits the generic ADMM framework exposed in appendix B.1.\nLet\nF(dk,\u03c9k,\u03c9k+1, ck) = \u03b1 k d\n2 \u2016\u2206mdk\u201622 +\n1 2 \u2016\u03b4(\u03c9k,\u03c9k+1)\u201622\n+ \u03c1\n2 \u2016\u03b4pkdiv dk \u2212 \u03c9k + \u03c9k+1 + u(i) dk \u201622 +\n\u03c1 2 \u2016ck \u2212 c\u0303k (i) + uck (i)\u201622,\nand let G(dk,\u03c9k,\u03c9k+1, ck) = F(dk,\u03c9k,\u03c9k+1, ck) + \u2211\nk\u2032\u2208{k,k+1}\n\u03c1 2 \u2016\u03c9k \u2032 \u2212 \u03c9\u0303k \u2032 (i) + u\u03c9k\u2032 (i)\u201622,\nG\u0303(dk, \u03c9\u0303k, \u03c9\u0303k+1, ck) = F(dk, \u03c9\u0303k, \u03c9\u0303k+1, ck) + \u2211\nk\u2032\u2208{k,k+1}\n\u03c1 2 \u2016\u03c9k \u2032 (i+1) \u2212 \u03c9\u0303k \u2032 + u\u03c9k\u2032 (i)\u201622,\nwhere we have noted the data term 12\u2016\u03b4(\u03b8,y)\u2016 2 2 defined in (3.5) as 1 2\u2016\u03b4(\u03c9 k,\u03c9k+1)\u201622, in order to simplify notations and to explicitly show its dependance on the vertical winds (\u03c9k,\u03c9k+1) or (\u03c9\u0303k, \u03c9\u0303k+1) depending if k belongs to K\u2032 or K\u2032\u2032. Using the proposed splitting, a local minimum of problem (4.6) can be obtained using ADMM by iterating\nuntil convergence the three following steps (dk (i+1) ,\u03c9k (i+1) ,\u03c9k+1 (i+1) , ck (i+1) ) = arg min dk,\u03c9k,\u03c9k+1,ck G(dk,\u03c9k,\u03c9k+1, ck), k \u2208 K\u2032 (dk (i+1) , \u03c9\u0303k (i+1) , \u03c9\u0303k+1 (i+1) , ck (i+1)\n) = arg min dk,\u03c9\u0303k,\u03c9\u0303k+1,ck\nG\u0303(dk, \u03c9\u0303k, \u03c9\u0303k+1, ck), k \u2208 K\u2032\u2032 ,\n(4.7)\nc\u0303k,` (i+1)\n(s) = soft\u03b1kx \u03c1\n( ck,` (i+1)(s) + uk,`c (i)(s) ) , k \u2208 K, ` \u2208 {1, 2, 3}, s : \u03c7(s) \u2208 \u2126m,\n(4.8) u (i+1) dk = u (i) dk + \u03b4pkdivdk (i+1) \u2212 \u03c9k(i+1) + \u03c9k+1(i+1), k \u2208 K\u2032, u (i+1) dk = u (i) dk + \u03b4pkdivdk (i+1) \u2212 \u03c9\u0303k (i+1) + \u03c9\u0303k+1 (i+1) , k \u2208 K\u2032\u2032, u (i+1) c = u (i) c + c(i+1) \u2212 c\u0303(i+1),\nu (i+1)\n\u03c9k = u\n(i) \u03c9k + \u03c9k (i+1) \u2212 \u03c9\u0303k (i+1) , k \u2208 K.\n(4.9)\nThe K/2 minimization problems can be performed independently within the two consecutive sub-steps appearing in system (4.7). In other words, this independence allows to perform sequentially the two sub-steps, each one of them constituted of K/2 parallel minimization procedures. The other two steps, namely (4.8) and (4.9) can be performed independently for the different indexes k \u2208 K = K\u2032 \u222a K\u2032\u2032. Therefore, the proposed scheme enables to solve (3.1) with an overall computation time O(m) independent of K, as long as we are able to solve K/2 minimization problem in parallel.\nAs for the solver proposed in Section 4.1, we notice that the solution of the soft constrained problem (3.2) can be computed using the steps (4.7)-(4.9), but substituting the two first updates in (4.9) by u (i+1)\ndk = 0.\n4.3. Dealing with Non-Convexity.\n4.3.1. ADMM convergence. The convergence of the ADMM algorithm to a local minimum is guaranteed for a non-convex objective function under mild conditions as detailed in [38]. In the context of our optimization problem (3.1), a sufficient assumption is that the objective function is coercive. Due to the regularizer (3.7) and the linear constraint in (3.1), it is straightforward to show the coercivity with respect to the variables \u03c9 and xt1 , for fixed d. However, the coercivity with respect to d is not guaranteed with a regularizer of the form of (3.6). To verify the coercivity assumption, one may add to the cost function a Tikonov regularizer term of the form \u03b4\u2016d\u201622 with \u03b4 being a small positive constant, set above the machine precision.\n4.3.2. Efficient Optimization. The two parallel minimizations in (4.7) are non-convex but differentiable problems. They may be solved efficiently using gradientdescent methods, as for instance the limited-memory quasi-Newton descent method, known as Broyden-Fletcher-Goldfarb-Shanno (L-BFGS) procedure, with a line-search routine based on the strong Wolf conditions [29]. Such descent methods involve a complexity per iteration scaling linearly in m, to which must be added the complexity to compute the gradient of the objective in (4.7). Let us mention that, interestingly, the minimizations in (4.7) need not (under very mild conditions) to be performed exactly to guaranteethe convergence of ADMM, see e.g., [13, Theorem 8].\nNevertheless, it is well known that large displacements are difficult to estimate due to the cost function non-linearities. To face this problem, as proposed in [12] and\nlatter studied in [26, 20, 33, 28], the optimization procedure avoids the heuristic and standard multiresolution optic flow initialization, and relies instead on the estimation of wavelet expansions of the displacement variable d (Coiflets with 10 vanishing moments). The strategy consists in estimating wavelet series with an increasing number of terms over the iterations of the algorithm, the added terms being related to increasingly fine spatial scales. The wavelet decomposition is in turn exploited to make the computation of the Laplacian operator efficient in the regularizer (3.6) [26]. An analogous wavelet expansion is used to extend the image variables xt1 accordingly. The fast evaluation procedures computing the gradient of the cost function is similar to the one proposed in [20]. The fast evaluation relies on the fast wavelet transform and on the fast Fourier transform computed in log linear time. In summary, the complexity of the overall algorithm is O(m logm)."
        },
        {
            "heading": "5. Numerical Evaluation.",
            "text": "5.1. Data Benchmark. We detail hereafter two different datasets issued from real-world meteorological observations.\n\u2022 ECMWF Data. Observations are provided, together with the corresponding ground truth profiles of 3D motion fields, by the operational numerical model of the European Centre for Medium-Range Weather Forecasts (ECMWF) [36]. There are neither noise nor missing image observations. \u2022 IASI Data. Incomplete observations are provided by the Infrared Atmospheric Sounding Interferometer (IASI) of Metop-A and Metop-B satellites [8], while a proxy to the ground truth is assumed to be the synchronized ECMWF numerical model. The exploitation of this dataset for the estimation of vertical profiles of dense 3D AMV fields is extremely ambitious because there are many missing observations in the images and in addition the remaining observations are highly corrupted by noise.\nIn these two datasets, observations are composed of two consecutive vertical profiles of 3 physical quantities, namely pressure-averaged atmospheric humidity, temperature and ozone concentration. Observations are gathered in two stacks of layers of trivariate (possibly incomplete) images. Altitudes ranging from the isobaric levels 1000 hPa to 400 hPa are discretize in K = 8 layers. Specifically, the 8 pressure-averaged humidity, temperature and ozone concentration images are integrals (2.1) computed for height intervals (pk+1, pk) \u2208 {(1000, 950), (950, 900), (900, 850), (850, 800), (800, 700), (700, 600), (600, 500), (500, 400)}, where the integrand is a piecewise constant approximation obtained using the 137 image bands provided by ECMWF or IASI. Each image is of dimension m = 256\u00d7 256.\nThe IASI data gathers incomplete observation maps, on the contrary to the ECMWF data which provides dense observations. In consequence, the IASI dataset will require the joint estimation of the image variable xt1 and the 3D AMVs (d,\u03c9), while only the latter couple of variables will need to be estimated in the case of the ECMWF dataset.\nAs previously mentioned, in the context of the ECMWF data, we have the true parameter \u03b8?, which generated the observation y. In the context of the IASI data, the synchronized ECMWF data will be considered as a proxy for the true parameter \u03b8?. We specify that this ground truth will be used exclusively for the analysis of the performance of the algorithms, and will not be used as an input ingredient of the proposed method.\n5.2. Algorithm Benchmark & Evaluation Criteria. We propose to compare the proposed solvers for problem (3.1) and (3.2), with three state-of-the-art algorithms.\n\u2022 2D model. This algorithm estimates horizontal 2D AMVs, solving problem (3.2) with the vertical winds held at zero \u03c9 = 0 and with \u03c1 = 0, i.e., without the constraint (3.3). This estimator constitutes our reference method: 2D optic flow estimation [12], performed independently on each atmospheric layer, coupled to the reconstruction of missing image observations, in the spirit of the work [18]. \u2022 2D incompressible model (soft constraint). This algorithm estimates horizontal 2D AMVs, solving problem (3.2) with the vertical wind vector held at zero \u03c9 = 0. In this zero-vertical wind setting, (3.3) boils down to a soft zero-divergence constraint. This estimator constitutes an alternate version of\nthe reference 2D model, where we have added a divergence-free constraint, similar to [26, 20]. \u2022 3D model. This algorithm estimates 3D AMVs, solving problem (3.2) with \u03c1 = 0, i.e., without the hydrostatic constraint (3.3). This estimator implements an enhanced version of the 3D model proposed in [21], in which motion estimation is coupled to the reconstruction of missing observations4. \u2022 3D hydrostatic model (soft constraint). This algorithm implements the proposed solver for problem (3.2). \u2022 3D hydrostatic model (hard constraint). This algorithm implements the proposed solver for problem (3.1). The free parameters of the warping constraint (2.9) and the hydrostatic constraint (2.7), namely the \u03b3k\u2019s and the \u03b4pk\u2019s, are learned in a minimum mean square sense from the ECMWF data. The regularization parameters \u03b1d, \u03b1x and \u03c1 in the cost (3.1) or (3.2) are set on the basis of expert knowledge. We mention that the algorithms all started by initializing the unknown AMV and image fields to zero.\nA common criterion to compare the accuracy of the horizontal AMV components estimated at layer k, which we will denote by vector d\u0302k, is the normalized average horizontal endpoint error (EPE) [10]\nHorizontal EPE(k) =\n\u2211 j:\u03ba(j)\u2208\u2126obs \u2016d\nk?(j)\u2212 d\u0302k(j)\u20162\u2211 j:\u03ba(j)\u2208\u2126obs \u2016d k?(j)\u20162 , (5.1)\nwhere \u2126obs stands here and in the following for the pixel grid with consecutive observations, i.e., \u2126obs = \u2126 t0,k obs \u2229\u2126 t1,k obs . To fully assess the accuracy of 3D AMV estimation, we complement this criterion with the normalized root mean square error (RMSE) on vertical winds\nVertical RMSE(k) =\n(\u2211 j:\u03ba(j)\u2208\u2126obs |\u03c9\nk?(j)\u2212 \u03c9\u0302k(j)|2\u2211 j:\u03ba(j)\u2208\u2126obs |\u03c9 k?(j)|2\n)1/2 , (5.2)\nwhere \u03c9\u0302k denotes the vector of vertical wind estimates at layer k.\n5.3. Results. Figure 5.1 plots the profiles of the error criteria (5.1) and (5.2) for the two datasets for the different algorithms of the benchmark in Section 5.2.\nWe focus on the upper plots, i.e., on the context of the noise-free and complete observations provided by the ECMWF numerical weather simulation. We observe the relevance of both, the 3D versus the 2D models and the introduction of constraints (incompressibility for the 2D model or hydrostatic balance for the 3D ones). Specifically, accounting for interacting horizontal AMVs via vertical winds in a 3D model provides a systematic improvement of up to about 5% in terms of normalized horizontal EPE. We find that the 3D model also systematically decreases the vertical RMSE. However, this decrease is only of the order of a small fraction. Indeed, although the spatial structure of the estimated vertical wind fields is globally consistent with the ground truth (as can be seen in Figure 5.2), the vertical wind magnitude is dramatically underestimated, yielding a normalized RMSE slightly below unity. Next, the\n4In addition to the difference in the 3D model, our solver also differs from the algorithm of [21] by the use of an efficient high-dimensional optimization procedure based on ADMM splitting (see Section 4.2) and efficient minimization using the well-known L-BFGS procedure and employing a wavelet-based multiresolution framework (see Section 4.3.2).\nintroduction of soft contraints on incompressibility in the 2D model or on hydrostatic balance in the 3D model lowers the error criteria a bit more, with a gain on the normalized horizontal EPE reaching up to 10% for the constrained 3D model compared to the reference 2D model. The hard constraint on hydrostatic balance finally yields the best horizontal AMVs estimates in terms of EPE. We note that these constraints are relevant in terms of RMSE to estimates of the vertical wind away from Earth and the tropopause boundary layer, suggesting that the assumption of zero wind boundary conditions is somewhat spurious.\nWe continue with the lower plots, i.e., the noisy and incomplete observations measured by IASI. For this data context, we have at our disposal state-of-the-art results obtained with the 3D model solver proposed in [21]. The latter constitutes the state-of-the-art algorithm to extract 3D AMVs from IASI data used presently as a demonstration prototype by the European operational satellite agency for monitoring of weather, climate and the environment from space (EUMETSAT). We immediately notice that the results of this state-of-the-art algorithm differ from those of our 3D model solver (see the 5.2 section and its footnote for more details on the differences of the model and solver). Specifically, all the algorithms in our benchmark perform significantly better than the state-of-the-art method in terms of the two criteria (note that the corresponding vertical RMSE does not appear because it is well above unity). In this context of noisy and missing observations, the horizontal EPE is obviously\nhigher than for the ECMWF (about 40% higher). Commenting more specifically on the algorithms of our benchmark, we note that the performance of the 2D and 3D model are very similar in terms of horizontal EPE with a gain of about 15% in comparison to state-of-the-art. A decrease reaching about 35% is obtained adding the incompressibility or hydrostatic (soft or hard) constraints. The significant improvement in accuracy suggests that the noisy and incomplete observations supplemented by the a priori constraining divergence bursts are sufficient to characterize the dominant solenoidal structures of the flow. However, the small difference between the 2D and 3D model, i.e., little influence of the interaction by vertical winds of horizontal AMVs, suggests that, unlike the ECMWF dataset, the IASI observations are not rich\nenough to accurately characterize the weaker divergence structures (the magnitude of the solenoidal component is about twice in average that of the divergence) or the vertical component of the atmospheric flow. Nevertheless, we observe the same trend on the vertical RMSE profiles as for the ECMWF data, but in a smaller range.\nAfter this quantitative evaluation, we move on to a qualitative analysis by comparing, for the different algorithms, the spatial structures of the estimated AMVs with those of the ground truth.\nIn the case of the ECMWF data, Figure 5.2 shows that the large vortex structures on the horizontal winds are accurately estimated by all algorithms while the errors at medium and small scales tend to disappear when moving from the 2D to the 3D model and then adding the hydrostatic balance constraint. We observe, that the large scale structures of the vertical components of AMV are approximately recovered by the 3D model, although they are embedded in strong noise. The hydrostatic balance constraint smoothes out this noise and reveal most of the large to medium structures of vertical winds. Although the results presented in Figure 5.1 showed the positive impact of considering a 3D model on the accuracy of the horizontal wind estimates, the ability to capture the global spatial structures of the vertical wind was nevertheless not expected in view of the small gain in accuracy observed in the vertical RMSE profiles. A potential explanation could be that the highly dimensional and strongly non-convex optimization at the heart of the proposed method remain stuck in local minima reflecting weak vertical wind states. This would preclude obtaining the desired ground truth magnitudes, but would still capture the overall spatial trends in vertical winds.\nWe conclude by the quantitative analysis in Figure 5.3 of AMV estimates in the context of the IASI observations. We immediately understand the challenge of extracting 3D AMVs from this noisy and incomplete data set. More precisely, the 2D and 3D models are only partially able to capture the main vortex structures of the horizontal flow located in the vicinity of the observations. The introduction of an hydrostatic balance constraint leads to a dramatic improvement since most of the vortices are accurately estimated in the observation areas but also extrapolated outside these areas. The vertical component of the AMVs follows the same trends as for the estimates obtained in the previous experiment with ECMWF data, with the difference that the spatial structures are estimated in the case of IASI data only in areas with consecutive observations and that the vertical wind structures are corrupted by a stronger noise.\n6. Conclusion and Perspectives. Based on atmospheric thermodynamics and hydrostatic equilibrium, this work proposes a method for estimating vertical profiles of 3D AMV fields from incomplete image observations collected by hyperspectral sounders. The contributions are: i) to devise a geophysically-sound inverse model for optic flow taking the form of a constrained energy minimization, ii) to design an efficient and low complexity algorithm to solve this difficult problem.\nThe energy to be minimized relies on adiabatic atmospheric thermodynamics. More precisely, the energy measures discrepancies from the layered transport of pressureaveraged temperature, humidity, and ozone concentration fields driven by the action of pressure-averaged horizontal winds, interacting with each other through the vertical winds at the vertical layer boundaries. The AMV fields should in sus be in hydrostatic balance: the pressure-averaged horizontal divergence of the flow must compensate the difference between vertical winds at the layer lower and upper boundaries.\nAMV estimation from the incomplete observations takes the form of a linear constrained non-convex and high-dimensional energy minimization problem, where the variables to be jointly optimized are the profile of 3D AMV fields together with the profile of temperature, humidity, and ozone concentration fields. By splitting the global estimation problem into a set of independent optic flow subproblems, and adding a set of matching constraints forcing the split variables to coincide, we take advantage of an ADMM framework to instead solve a set of independent lower-dimensional unconstrained and differentiable minimization problems. The nonconvexity of these subproblems is efficiently handled using a multiresolution wavelet expansion of AMVs combined with an L-BFGS optimization scheme. The resulting\nglobal algorithm has advantageous complexity independent of the number of layers and log linear in the number of image pixels.\nThanks to the availability of real hyperspectral observations by IASI on Metop satellites and synchronized real NWP provided by ECMWF, we show in our numerical evaluation that both, the geophysical modeling and the optimization are quantitatively and qualitatively relevant. In particular, we find a decreases of the estimation error reaching about 35% in comparison to state-of-the-art.\nAlthough it is beyond the scope of this paper, a comprehensive evaluation of the capabilities of the proposed algorithm, however, remains to be done before operational use. An important study that remains to be done is the empirical evaluation of the sensitivity of the estimated AMV profile to the profile of the regularization parameters and the number of layers. Such a study is particularly crucial in the context of IASI observations in order to calibrate some optimal parameters (in the sense that they minimize the estimation error). In the light of the results obtained on the ECMWF dataset, we expect that such a study will allow a more discriminating performance gain between the 2D and 3D model. Of course, future work will concern the validation of the algorithm on longer test periods.\nAppendix A. Atmospheric Conservation Laws. We present in this section bi-dimensional continuous models issued from the vertical integration in the pressure interval [pk, pk+1] of atmospheric conservation laws.\nA.1. Constraints Related to the Kinematic Method. Interesting models for 3D compressible atmospheric motion adapted to infrared image measurements may be derived by using an isobaric coordinate system (x, y, p). In comparison to standard altimetric coordinates (x, y, z), isobaric coordinates are advantageous: they enable to handle in a simple manner the compressibility of atmospheric flows. In this coordinate system, the pressure function p acts as a vertical coordinate. Note that when pressure is used as the vertical coordinate, horizontal partial derivatives must be evaluated holding p constant. The vertical wind is defined in the isobaric coordinate system by \u03c9 = dpdt . Using the hydrostatic assumption \u2202p \u2202z = \u2212\u03c1g, relating pressure to density \u03c1 and gravity g, the expansion of \u03c9 in the (x, y, z) altimetric coordinate system yields\n\u03c9 = \u2202p\n\u2202t + u\n\u2202p \u2202x + v \u2202p \u2202y \u2212 w\u03c1g, (A.1)\nwhere partial derivative operators and the vertical velocity w are in z coordinates. In the light of (A.1), it is worth noticing that the mass conservation constraint (2.6) constitutes the kernel of the so-called kinematic method, applied in meteorology for the recovery of vertical motion5\nA.2. Constraints Related to the Adiabatic Method. Assume we neglect the diabetic heating and omit the modeling of atmosphere chemistry below the stratosphere, as it is commonly done in atmospheric studies [27]. Then expressing in the\n5A good approximation for synoptic-scale motions is to let \u03c9 ' \u2212w\u03c1g. Thus, using this approximation, vertical motion can be expressed as:\nw(sk+1) = \u03c1(sk)w(sk)\n\u03c1(sk+1) \u2212\n\u03b4pk\ng\u03c1(sk+1) \u2207s \u00b7 (vk), (A.2)\nwhere, in relation to pressure levels pk and pk+1, we have define the isobaric surfaces sk(x, y) and sk+1(x, y) in the altimetric coordinate system (x, y, z). Vertical wind given by (A.2) corresponds exactly to the kinematic estimate, see [24].\nisobaric system the first law of thermodynamics and the dynamics of ozone both yields transport equations of the form of [24]\n\u2202\u03c1 \u2202t + u \u2202\u03c1 \u2202x + v \u2202\u03c1 \u2202y + \u03b3\u03c9 = 0, (A.3)\nwith respectively \u03b3 = (\u2202T\u2202p \u2212 1 cp\u03c1 ), \u03b3 = \u2202q\u2202p and \u03b3 = \u2202o \u2202p for either the temperature \u03c1 = T , the humidity \u03c1 = q or the ozone concentration \u03c1 = o variables. cp denotes specific heat of dry air at constant pressure. Estimation of vertical winds using (A.3) for temperature \u03c1 = T is known as the adiabatic method.6 We are interested in integrating (A.3) vertically to relate the evolution of pressure-averaged temperature fields to pressure-averaged horizontal displacements. In this perspective, we assume that horizontal displacements in the pressure interval [pk, pk+1] are equal to pressureaverage horizontal displacements, i.e., (u, v) ' vk in [pk, pk+1]. Approximating the vertical integration of the last term of (A.3) using the trapezoidal rule, and inverting the derivatives and integrals (assuming smoothness conditions) in the remaining terms of (A.3), we obtain by the vertical integration of (A.3) (one of the three components of) the partial differential equation (2.3). The components of \u03b3k are identified to either \u2202T\u2202p (p k)\u2212 1 cp\u03c1(pk) , \u2202q\u2202p (p k) or \u2202o\u2202p (p k). We note that the trapezoidal rule used for vertical integration has been chosen for consistency between the model variables: the vertical integrated dynamics depend on vertical winds at the layers interfaces, as for the mass conservation constraint (2.6).\nAppendix B. ADMM Solver.\nB.1. The ADMM Generic Procedure. The alternating direction method of multipliers (ADMM) focusses on the following type of optimization problems:\nmin z1\u2208\u039e1,z2\u2208\u039e1\nG1(z1) + G2(z2), s.t. Az1 = \u2212Bz2, (B.1)\nwhere A \u2208 Rr\u00d7n1 , B \u2208 Rr\u00d7n2 , G1 : Rn1 \u2192 R, G2 : Rn2 \u2192 R are closed, proper and convex functions, and \u039e1, \u039e2 are nonempty convex sets. ADMM is an iterative procedure inspired by the well-known method of multipliers [7]. It searches for a minimizer of (B.1) by sequentially minimizing the corresponding augmented Lagrangian with respect to each primal variables z1 and z2, before updating a dual variable u \u2208 Rr. Formally, the ADMM recursions take the form:\nz (i+1) 1 = arg min z1\u2208\u039e1 G1(z1) +\n\u03c1 2 \u2016Az1 + Bz(i)2 + u(i)\u201622, (B.2)\nz (i+1) 2 = arg min z2\u2208\u039e2 G2(z2) +\n\u03c1 2 \u2016Az(i+1)1 + Bz2 + u(i)\u201622, (B.3)\nu(i+1) = u(k) + Az (i+1) 1 + Bz (i+1) 2 , (B.4)\nfor some \u03c1 > 0.\nB.2. Particularization to Problem (4.1). To solve the non-differentiable non-\nconvex problem (4.1), we use the formalism exposed in appendix B.1 with z1 = d\u03c9 c , 6Using natural coordinates, vertical motion is w = 1\n( g cp + \u2202T \u2202z\n) ( \u2202T \u2202t +u \u2202T \u2202x +v \u2202T \u2202y ), where dry adia-\nbatic lapse rate \u2202T \u2202z can be approximated by a constant value throughout the lower atmosphere [24].\nz2 = c\u0303 , \u039e1 = R2Km \u00d7 R(K\u22121)m \u00d7 R3Km, \u039e2 = R3Km, A = (\nD \u2212L 0 0 0 I\n) \u2208\nR4Km\u00d7(6K\u22121)m and B = (\n0 \u2212I\n) \u2208 R4Km\u00d73Km. We obtain the ADMM optimization\nsteps (4.2) and (4.4), complemented by c\u0303(i+1) = arg minc\u0303 \u2016c\u0303\u20161+ \u03c1 2\u03b1x \u2016c(i+1)\u2212c\u0303+u(i)c \u201622. The optimization problem specified in the latter has a very simple analytical solution. In fact the right-hand side corresponds to the definition of the proximal operator of the `1 norm. The latter has been extensively studied in the literature (see e.g., [30, section 6.5.2]) and possesses the simple analytical solution (4.3) based on soft-thresholding operators (4.5).\nB.3. Particularization to Problem (4.6). We split the set of optimization variables, except \u03c9, into the two subsets {d, c, c\u0303} = {d\u2032, c\u2032, c\u0303\u2032} \u222a {d\u2032\u2032 , c\u2032\u2032 , c\u0303\u2032\u2032}, where the subscripts \u00b7\u2032 and \u00b7\u2032\u2032 denote the subset of variables indexed respectively by height level number k in K\u2032 = {0, 2, 4, . . . ,K \u2212 2} and K\u2032\u2032 = {1, 3, 5, . . . ,K \u2212 1}. Using this splitting, problem (4.6) is rewritten as\n arg min d,\u03c9,\u03c9\u0303,c,c\u0303 J \u2032 (d \u2032 ,\u03c9, c \u2032 ) + J \u2032\u2032 (e \u2032\u2032 d, \u03c9\u0303, c \u2032\u2032 ) +\u03b1dRd(d) +\u03b1xRx(c\u0303), s.t. D \u2212L 00 I 0 0 0 I d\u03c9 c +  0 0\u2212I 0 0 \u2212I (\u03c9\u0303 c\u0303 ) = 00 0  , (B.5)\nwhere J = J \u2032 + J \u2032\u2032 is a decomposition of the cost J into two sub-costs J \u2032 and J \u2032\u2032 , defined by the squared `2 norm of the vector of components {\u03b4k,`,st (\u03b8,y)}k,`,s,t defined in (3.4) with index k in respectively K\u2032 and K\u2032\u2032 (and the other indices ` \u2208 {1, 2, 3},s : \u03c7(s) \u2208 \u2126m and t \u2208 {t0, t1}). We then use the formalism exposed in appendix B.1 with\nz1 =  d\u2032 \u03c9 c\u2032\nc\u0303 \u2032\u2032\n, z2 =  d \u2032\u2032 \u03c9\u0303 c\u0303\u2032\nc \u2032\u2032\n, A = \nD \u2212L 0 0 0 I 0 0 0 0 I 0 0 0 0 \u2212I\n, B = \nD \u2212L 0 0 0 \u2212I 0 0 0 0 \u2212I 0 0 0 0 I , \u039e1 = RKm \u00d7 R(K\u22121)m \u00d7 R 3Km 2 \u00d7 R 3Km2 , \u039e2 = \u039e1, with A,B \u2208 R(4K\u22121)m\u00d7(5K\u22121)m, and where with an abuse of notations, we have denote identically operator D and L when they are defined for the two subsets of variables. We obtain the following ADMM recursions:  (d\u2032 (i+1) ,\u03c9(i+1), c\u2032 (i+1) ) = arg min d\u2032,\u03c9,c\u2032 J \u2032(d\u2032,\u03c9, c\u2032) + \u2211 k\u2208K\u2032 \u03b1kd 2 \u2016\u2206m d \u2032k\u201622 + \u03c1 2\u2016c \u2032 \u2212 c\u0303\u2032 (i) + uc\u2032 (i)\u201622 +\u03c12\u2016\u03c9 \u2212 \u03c9\u0303 (i) + u (i) \u03c9 \u201622 + \u03c1 2\u2016Dd \u2032 \u2212 L\u03c9 + u(i) d\u2032 \u201622 c\u0303 \u2032\u2032 (i+1)\n= arg min c\u0303 \u2032\u2032 \u2016c\u0303\u2032\u2032\u20161 +\n\u2211 k\u2208K\u2032\u2032 \u03c1 2\u03b1kx \u2016c\u2032\u2032 k(i+1) \u2212 c\u0303\u2032\u2032 k + u (i) c\u2032\u2032 k\u201622,\n(B.6)\n (d\u2032\u2032 (i+1) , \u03c9\u0303(i+1), c\u2032\u2032 (i+1) ) = arg min d\u2032\u2032,\u03c9\u0303,c\u2032\u2032 J \u2032\u2032(d\u2032\u2032, \u03c9\u0303, c\u2032\u2032) + \u2211 k\u2208K\u2032\u2032 \u03b1kd 2 \u2016\u2206m d \u2032\u2032k\u201622 + \u03c1 2\u2016c \u2032\u2032 \u2212 c\u0303\u2032\u2032 (i) + uc\u2032\u2032 (i)\u201622 +\u03c12\u2016\u03c9 (i+1) \u2212 \u03c9\u0303 + u(i)\u03c9 \u201622 + \u03c1 2\u2016Dd \u2032\u2032 \u2212 L \u03c9\u0303 + u(i) d\u2032\u2032 \u201622 c\u0303 \u2032 (i+1)\n= arg min c\u0303 \u2032 \u2016c\u0303\u2032\u20161 +\n\u2211 k\u2208K\u2032 \u03c1 2\u03b1kx \u2016c\u2032 k(i+1) \u2212 c\u0303\u2032 k + u (i) c\u2032 k\u201622,\n(B.7) u (i+1) \u03c9 = u (i) \u03c9 + \u03c9(i+1) \u2212 \u03c9\u0303(i+1), u (i+1) d\u2032 = u (i) d\u2032 + Dd\u2032 (i+1) \u2212 L\u03c9(i+1), u (i+1) d\u2032\u2032 = u (i) d\u2032\u2032 + Dd \u2032\u2032 (i+1) \u2212 L \u03c9\u0303(i+1), u (i+1) c\u2032 = u (i) c\u2032 + c\u2032 (i+1) \u2212 c\u0303\u2032(i+1), u (i+1)\nc \u2032\u2032 = u\n(i) c \u2032\u2032 + c \u2032\u2032 (i+1) \u2212 c\u0303\u2032\u2032 (i+1) .\n(B.8)\nThe first minimization appearing in systems (B.6) are (B.7) involve K/2 independent optimization procedures detailed in (4.7), which can be naturally parallelized. The addition of vectors in the ADMM step (B.8) can also be decomposed as exposed in (4.9). Based on soft-thresholding operators (4.5), the proximal operators of the `1 norm specified in (B.6) and (B.7) have simple analytical forms given in (4.8)."
        }
    ],
    "title": "3D WIND FIELD PROFILES FROM HYPERSPECTRAL SOUNDERS: REVISITING OPTIC-FLOW FROM A METEOROLOGICAL PERSPECTIVE",
    "year": 2023
}
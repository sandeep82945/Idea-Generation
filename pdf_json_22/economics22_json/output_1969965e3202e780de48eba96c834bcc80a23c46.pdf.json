{
    "abstractText": "We study the problem of designing mechanisms for trading networks that satisfy four desired properties: dominant-strategy incentive compatibility, efficiency, weak budget balance (WBB), and individual rationality (IR). Although there exist mechanisms that simultaneously satisfy these properties ex post for combinatorial auctions, we prove the impossibility that such mechanisms do not exist for a broad class of trading networks. We thus propose approaches for computing and learning the mechanisms that satisfy the four properties, in a Bayesian setting, where WBB and IR, respectively, are relaxed to ex ante and interim. For computational and sample efficiency, we introduce several techniques, including game theoretical analysis to reduce the input feature space. We empirically demonstrate that the proposed approaches successfully find the mechanisms with the four properties for those trading networks where the impossibility holds ex post .",
    "authors": [
        {
            "affiliations": [],
            "name": "Takayuki Osogami"
        },
        {
            "affiliations": [],
            "name": "Segev Wasserkrug"
        },
        {
            "affiliations": [],
            "name": "Elisheva S. Shamash"
        }
    ],
    "id": "SP:928a7f6e0e7c72112cf9e365e8bb1ede64d2c3aa",
    "references": [
        {
            "authors": [
                "T. Alon",
                "R. Lavi",
                "E.S. Shamash",
                "I. Talgam-Cohen"
            ],
            "title": "Incomplete Information VCG Contracts for Common Agency",
            "venue": "arXiv preprint arXiv:2105.14998",
            "year": 2021
        },
        {
            "authors": [
                "J. Balaguer",
                "R. Koster",
                "C. Summerfield",
                "A. Tacchetti"
            ],
            "title": "The Good Shepherd: An Oracle Agent for Mechanism Design",
            "venue": "In ICLR 2022 Workshop on Gamification and Multiagent Solutions",
            "year": 2022
        },
        {
            "authors": [
                "J. Balaguer",
                "R. Koster",
                "A. Weinstein",
                "L. Campbell-Gillingham",
                "C. Summerfield",
                "M. Botvinick",
                "A. Tacchetti"
            ],
            "title": "2022b. HCMD-zero: Learning Value Aligned Mechanisms from Data",
            "venue": "In ICLR 2022 Workshop on Gamification and Multiagent Solutions",
            "year": 2022
        },
        {
            "authors": [
                "M.-F. Balcan",
                "A. Blum",
                "J. Hartline",
                "Y. Mansour"
            ],
            "title": "Mechanism Design via Machine Learning",
            "year": 2005
        },
        {
            "authors": [
                "T. Baumann",
                "T. Graepel",
                "J. Shawe-Taylor"
            ],
            "title": "Adaptive Mechanism Design: Learning to Promote Cooperation",
            "year": 2018
        },
        {
            "authors": [
                "G. Brero",
                "D. Chakrabarti",
                "A. Eden",
                "M. Gerstgrasser",
                "V. Li",
                "D.C. Parkes"
            ],
            "title": "Learning Stackelberg Equilibria in Sequential Price Mechanisms. In Workshop for Reinforcement Learning Theory at ICML 2021",
            "year": 2021
        },
        {
            "authors": [
                "G. Brero",
                "A. Eden",
                "M. Gerstgrasser",
                "D. Parkes",
                "D. Rheingans-Yoo"
            ],
            "title": "Reinforcement Learning of Sequential Price Mechanisms",
            "venue": "In Proceedings of the 35th AAAI Conference on Artificial Intelligence,",
            "year": 2021
        },
        {
            "authors": [
                "Y. Cai",
                "C. Daskalakis"
            ],
            "title": "Learning Multi-Item Auctions with (or without) Samples",
            "venue": "In Proceedings of the 58th Annual Symposium on Foundations of Computer Science (FOCS),",
            "year": 2017
        },
        {
            "authors": [
                "O. Candogan",
                "M. Epitropou",
                "R.V. Vohra"
            ],
            "title": "Competitive Equilibrium and Trading Networks: A Network Flow Approach",
            "venue": "Operations Research,",
            "year": 2021
        },
        {
            "authors": [
                "A.C. Chapman",
                "A. Rogers",
                "N.R. Jennings"
            ],
            "title": "Learn While You Earn: Two Approaches to Learning Auction Parameters in Take-it-or-leave-it Auctions",
            "venue": "In Proceedings of the 7th International Joint Conference on Autonomous Agents and Multiagent Aystems,",
            "year": 2008
        },
        {
            "authors": [
                "V. Conitzer",
                "T. Sandholm"
            ],
            "title": "Complexity of Mechanism Design",
            "venue": "In Proceedings of the 18th Conference on Uncertainty in Artificial Intelligence,",
            "year": 2002
        },
        {
            "authors": [
                "P. Duetting",
                "Z. Feng",
                "H. Narasimhan",
                "D. Parkes",
                "S.S. Ravindranath"
            ],
            "title": "Optimal Auctions through Deep Learning",
            "venue": "Proceedings of the 36th International Conference on Machine Learning,",
            "year": 2019
        },
        {
            "authors": [
                "F. Faccio",
                "L. Kirsch",
                "J. Schmidhuber"
            ],
            "title": "Parameter-Based Value Functions",
            "venue": "In International Conference on Learning Representations",
            "year": 2021
        },
        {
            "authors": [
                "Y.A. Gonczarowski",
                "S.M. Weinberg"
            ],
            "title": "The Sample Complexity of Up-to-epsilon Multi-Dimensional Revenue Maximization",
            "venue": "In Proceedings of the 59th Annual Symposium on Foundations of Computer Science (FOCS),",
            "year": 2018
        },
        {
            "authors": [
                "J.W. Hatfield",
                "S.D. Kominers"
            ],
            "title": "Matching in Networks with Bilateral Contracts",
            "venue": "American Economic Journal: Microeconomics,",
            "year": 2012
        },
        {
            "authors": [
                "J.W. Hatfield",
                "S.D. Kominers",
                "A. Nichifor",
                "M. Ostrovsky",
                "A. Westkamp"
            ],
            "title": "Stability and Competitive Equilibrium in Trading Networks",
            "venue": "Journal of Political Economy,",
            "year": 2013
        },
        {
            "authors": [
                "J.W. Hatfield",
                "S.D. Kominers",
                "A. Nichifor",
                "M. Ostrovsky",
                "A. Westkamp"
            ],
            "title": "Full Substitutability in Trading Networks",
            "venue": "In Proceedings of the 16th ACM Conference on Economics and Computation,",
            "year": 2015
        },
        {
            "authors": [
                "S. Iwata",
                "S. Moriguchi",
                "K. Murota"
            ],
            "title": "A Capacity Scaling Algorithm for M-Convex Submodular Flow",
            "venue": "Mathematical Programming,",
            "year": 2005
        },
        {
            "authors": [
                "R. Koster",
                "B. Jan",
                "A. Tacchetti",
                "A. Weinstein",
                "T. Zhu",
                "O. Hauser",
                "D. Williams",
                "L. Campbell-Gillingham",
                "P. Thacker",
                "M. Botvinick",
                "C. Summerfield"
            ],
            "title": "Human-centred Mechanism Design with Democratic AI",
            "venue": "Nature Human Behaviour",
            "year": 2022
        },
        {
            "authors": [
                "A. Likhodedov",
                "T. Sandholm"
            ],
            "title": "Methods for Boosting Revenue in Combinatorial Auctions",
            "venue": "In Proceedings of the 19th National Conference on Artifical Intelligence,",
            "year": 2004
        },
        {
            "authors": [
                "A. Likhodedov",
                "T. Sandholm"
            ],
            "title": "Approximating Revenue-Maximizing Combinatorial Auctions",
            "venue": "In Proceedings of the 20th National Conference on Artifical Intelligence,",
            "year": 2005
        },
        {
            "authors": [
                "T.-Y. Liu",
                "W. Chen",
                "T. Qin"
            ],
            "title": "Mechanism Learning with Mechanism Induced Data",
            "venue": "In Proceedings of the 29th AAAI Conference on Artificial Intelligence,",
            "year": 2015
        },
        {
            "authors": [
                "P. Manisha",
                "C.V. Jawahar",
                "S. Gujar"
            ],
            "title": "Learning Optimal Redistribution Mechanisms Through Neural Networks",
            "venue": "In Proceedings of the 17th International Conference on Autonomous Agents and MultiAgent Systems,",
            "year": 2018
        },
        {
            "authors": [
                "M. Mohri",
                "A.M. Medina"
            ],
            "title": "Learning Theory and Algorithms for Revenue Optimization in Second Price Auctions with Reserve",
            "venue": "Proceedings of the 31st International Conference on Machine Learning,",
            "year": 2014
        },
        {
            "authors": [
                "J. Morgenstern",
                "T. Roughgarden"
            ],
            "title": "Learning Simple Auctions",
            "venue": "29th Annual Conference on Learning Theory,",
            "year": 2016
        },
        {
            "authors": [
                "R.B. Myerson",
                "M.A. Satterthwaite"
            ],
            "title": "Efficient Mechanisms for Bilateral Trading",
            "venue": "Journal of Economic Theory,",
            "year": 1983
        },
        {
            "authors": [
                "N. Nisan"
            ],
            "title": "Introduction to Mechanism Design (for Computer Scientists)",
            "venue": "In Algorithmic Game Theory,",
            "year": 2007
        },
        {
            "authors": [
                "M. Ostrovsky"
            ],
            "title": "Stability in Supply Chain Networks",
            "venue": "American Economic Review,",
            "year": 2008
        },
        {
            "authors": [
                "A. Othman",
                "T. Sandholm"
            ],
            "title": "How Pervasive is the Myerson-Satterthwaite Impossibility",
            "venue": "In Proceedings of the 21st International Joint Conference on Artificial Intelligence,",
            "year": 2009
        },
        {
            "authors": [
                "D.C. Parkes"
            ],
            "title": "Iterative Combinatorial Auctions: Achieving Economic and Computational Efficiency",
            "venue": "Ph.D. thesis,",
            "year": 2001
        },
        {
            "authors": [
                "J. Rahme",
                "S. Jelassi",
                "S.M. Weinberg"
            ],
            "title": "Auction Learning as a Two-Player Game",
            "venue": "In International Conference on Learning Representations",
            "year": 2021
        },
        {
            "authors": [
                "D. Rheingans-Yoo"
            ],
            "title": "Reinforcement Learning for Indirect Mechanism Design. Bachelor\u2019s Thesis, Harvard College",
            "year": 2020
        },
        {
            "authors": [
                "T. Sandholm"
            ],
            "title": "Automated Mechanism Design: A New Application Area for Search Algorithms",
            "venue": "Principles and Practice of Constraint Programming \u2013 CP",
            "year": 2003
        },
        {
            "authors": [
                "J.C. Schlegel"
            ],
            "title": "The Structure of Equilibria in Trading Networks with Frictions",
            "venue": "Theoretical Economics,",
            "year": 2022
        },
        {
            "authors": [
                "A. Tacchetti",
                "D. Strouse",
                "M. Garnelo",
                "T. Graepel",
                "Y. Bachrach"
            ],
            "title": "Learning Truthful, Efficient, and Welfare Maximizing Auction Rules",
            "venue": "In ICLR 2022 Workshop on Gamification and Multiagent Solutions",
            "year": 2022
        },
        {
            "authors": [
                "P. Tang"
            ],
            "title": "Reinforcement Mechanism Design",
            "venue": "In Proceedings of the 26th International Joint Conference on Artificial Intelligence",
            "year": 2017
        },
        {
            "authors": [
                "S. Zheng",
                "A. Trott",
                "S. Srinivasa",
                "D.C. Parkes",
                "R. Socher"
            ],
            "title": "The AI Economist: Optimal Economic Policy Design via Two-level Deep Reinforcement Learning",
            "year": 2021
        }
    ],
    "sections": [
        {
            "heading": "1 Introduction",
            "text": "Trading networks, where firms trade via bi-lateral contracts, are becoming increasingly ubiquitous and essential to the world\u2019s economy in vital areas such as transportation and supply chain. The purpose of such a trading network is both to benefit its participants and to contribute to the external markets. As such, a major goal of a trading network is efficiency in the sense of maximizing the value (social welfare) that the trading network creates (Hatfield et al., 2013).\nThe prior work on trading networks primarily investigates solution concepts such as stability and competitive equilibrium (Hatfield et al., 2013; Candogan, Epitropou, and Vohra, 2021), which can be shown to imply efficiency. To compute these solutions for a given trading network, however, one would require the full information about the value of each subset of trades to each firm (or the type of the firm), which is typically private information and needs to be truthfully revealed by the firms. As we will show, however, the firms typically have incentive to be untruthful.\nOur goal in this work is to provide a mechanism for a given trading network such that the firms in the trading network have the incentive to be truthful, which in turn leads to efficiency. For this purpose, we follow the standard practice in mechanism design of introducing the payment to or from an Independent Party (IP) in the trading network and assume that there is a prior distribution over the types of the firms (i.e., we consider a Bayesian setting). More specifically, in this setting, we seek to compute (or learn) the mechanism that satisfies weak budget balance (WBB; which ensures non-negative utility of IP) and individual rationality (IR; which ensures non-negative utility of firms) in addition to efficiency and incentive compatibility (which promotes truthfulness). These four properties are standard in the literature of mechanism design (Parkes, 2001), and, for combinatorial auctions, the VCG mechanism with the Clarke pivot rule is known to satisfy all of the four properties ex post , i.e. surely for any types, (Nisan, 2007).\nNotice, however, that trading networks are fundamentally more complex than combinatorial auctions. For example, a trade is a transfer of a good from a seller to a buyer, and the seller who has negative valuation on the trade is compensated by the payment from the buyer. We will show that, in this more\n\u2217IBM Research - Tokyo. osogami@jp.ibm.com \u2020IBM Research - Haifa. segevw@il.ibm.com \u2021Technion - Israel Institute of Technology. This work was performed at IBM Research. elisheva.shamash@gmail.com\nar X\niv :2\n20 8.\n09 22\n2v 1\n[ cs\n.G T\n] 1\n9 A\nug 2\n02 2\ncomplex settings, it is impossible to simultaneously satisfy all of the four properties ex post for a broad class of trading networks.\nWe thus relax the WBB and IR properties and seek to compute a mechanism that respectively satisfies these properties ex ante and interim (i.e., in expectation with respect to the prior distribution over the types) rather than ex post . To this end, we restrict ourselves to the class of Groves mechanisms to ensure incentive compatibility and efficiency and compute the pivot rule of a Groves mechanism via a linear program (LP) that encodes WBB and IR as constraints.\nWhile this LP successfully computes a mechanism that simultaneously satisfies the four properties, it involves two fundamental challenges. First, the mechanism designer needs the exact knowledge of the prior distribution of types. Second, the linear program becomes intractable as the number of trades, players, or their types increases.\nWe thus further provide an approach of learning a mechanism from the sample of the prior distribution of types to mitigate the shortcomings of the computational approach. With the proposed learning approach, the mechanism designer only requires the access to the sample instead of the precise knowledge of the prior distribution. In addition, we propose several techniques to reduce the computational complexity in the proposed mechanism learning. In particular, we manually design special Groves mechanisms, which achieve some but not all of the four properties ex post , and demonstrate how the dimension of the feature vector of the types may be reduced based on the knowledge of those special Groves mechanisms.\nContributions Our contributions are fourfold. First, we prove a fundamental theorem that holds for any mechanism for trading networks with payment to/from IP (Theorem 1), which shows that we may ignore the payment between firms without loss of generality. This greatly reduces the set of possible mechanisms that needs to be considered, thereby greatly simplifying the subsequent analysis and proposed algorithms. Second, we prove the impossibility of simultaneously satisfying the four properties ex post in trading networks (Theorem 2), which is analogous to the Myerson\u2013Satterthwaite theorem (Myerson and Satterthwaite, 1983). Unlike the Myerson\u2013Satterthwaite theorem, however, our theorem does not require the assumption that the prior distribution on types has absolutely continuous density. Third, we provide the approaches of automated mechanism design (Conitzer and Sandholm, 2002; Sandholm, 2003) for trading networks, by formulating an optimization problem and its learning variant whose solutions give the mechanisms that achieve the four properties, two in ex post and two in ex ante/ interim, and propose techniques to reduce the computational complexity in computing or learning the solution to these optimization problems (see Sections 5-6). These include the technique of reducing the dimensionality of the feature vector based on the manually designed special Groves mechanisms. Finally, we provide empirical support on the effectiveness of the proposed computational and learning approaches to mechanism design for trading networks (see Section 7).\nRelated Work Trading networks and their efficiency have been extensively studied (Hatfield et al., 2013; Candogan, Epitropou, and Vohra, 2021; Ostrovsky, 2008; Hatfield and Kominers, 2012; Hatfield et al., 2015)), but no AMD approaches are known to simultaneously achieve the four properties in trading networks. In fact, there are few studies on incentive compatibility in trading networks with an exception of Schlegel (2022), who establishes incentive compatibility but only for those firms who are buyers (or sellers) in all trades.\nFrom methodological perspectives, the prior work most related to ours is some of the AMD approaches for combinatorial auctions, where constrained optimization problems are formulated and approximated with the sample from the prior distribution of types. However, in Duetting et al. (2019); Rahme, Jelassi, and Weinberg (2021), DSIC is encoded as a constraint of the optimization problem and is not necessarily guaranteed due to the sample approximation unless the dataset covers the full support of the prior distribution, while we always ensure DSIC via the Groves mechanism. On the other hand, Manisha, Jawahar, and Gujar (2018); Tacchetti et al. (2022) learn the mechanism (specifically, the rule of redistributing payment from IP to players) that minimizes the expected revenue of IP, while ensuring the four properties via the VCG mechanism. In trading networks, however, we can guarantee only two properties via the Groves mechanism, and we encode the other two properties as constraints of our optimization problem.\nAlon et al. (2021) also study an approach of computing (no learning) a mechanism for a principal-agent\nmodel as a solution to LP, while ensuring some of the properties via the VCG mechanism. Earlier work along this line of computing a mechanism within a restricted class of mechanisms includes Likhodedov and Sandholm (2004), who maximize expected revenue in combinatorial auctions. Sample approximation of this method is studied by Likhodedov and Sandholm (2005)."
        },
        {
            "heading": "2 Trading networks",
            "text": "Following Hatfield et al. (2013), we model a trading network by a tuple (N ,\u2126, v), where N is a set of players (or firms), \u2126 is a set of bi-lateral trades, and v \u2261 (vi)i\u2208N , where each vi : 2\u2126 \u2192 R is the type (valuation) of player i. That is, vi(\u03a6) represents the (possibly negative) value of \u03a6 \u2286 \u2126 for the player with type vi. Without loss of generality, we assume that the value of no trade is zero for any player (i.e., vi(\u2205) = 0,\u2200i \u2208 N ). Each trade is associated with a seller and a buyer in N , and the buyer makes non-negative payment to the seller. Let p(\u03c9) be the payment associated with \u03c9 \u2208 \u2126. We refer to a pair (\u03c9, p(\u03c9)) as a contract. A pair of \u03a6 and p determines a set of contracts1, {(\u03c9, p(\u03c9)) : \u03c9 \u2208 \u03a6}.\nOne\u2019s goal with a trading network is to determine a set of trades \u03a6 \u2286 \u2126 to be conducted together with the payment associated with each trade in a way that certain properties are satisfied. A particularly important metric is the total valuations associated with the trades to be conducted (i.e., \u2211 i\u2208N vi(\u03a6)), since it is the value that the trading network produces to the external market(s). In particular, we say that the set of trades \u03a6? is efficient for a trading network T (v) = (N ,\u2126, v) if\u2211\ni\u2208N vi(\u03a6 ?) \u2265 \u2211 i\u2208N vi(\u03a6),\u2200\u03a6 \u2208 2\u2126. (1)\nThe efficiency may also be represented in terms of the utilities of players. Specifically, when the set of contracts {(\u03c9, p(\u03c9)) : \u03c9 \u2208 \u03a6} is conducted, the player i \u2208 N gets the following (quasi-linear) utility2:\nu\u0303i((\u03a6, p); T (v)) = vi(\u03a6) + \u2211\n\u03c9\u2208\u03a6i\u2192\np(\u03c9)\u2212 \u2211\n\u03c9\u2208\u03a6\u2192i\np(\u03c9), (2)\nwhere \u03a6i\u2192 is the subset of \u03a6 where i is the seller, and \u03a6\u2192i is the one where i is the buyer. Now, since we have \u22c3\ni\u2208N \u03a6i\u2192 = \u22c3 i\u2208N \u03a6\u2192i = \u03a6 (3)\nfor any \u03a6 \u2286 \u2126, the total payment from sellers equals the total payment to buyers:\u2211 i\u2208N \u2211 \u03c9\u2208\u03a6i\u2192 p(\u03c9) = \u2211 i\u2208N \u2211 \u03c9\u2208\u03a6\u2192i p(\u03c9), (4)\nwhich together with (2) implies \u2211 i\u2208N u\u0303i((\u03a6, p); T (v)) = \u2211 i\u2208N vi(\u03a6) (5)\nfor any p. Therefore, for any p, (1) is equivalent to\u2211 i\u2208N u\u0303i((\u03a6 ?, p); T (v)) \u2265 \u2211 i\u2208N u\u0303i((\u03a6, p); T (v)),\u2200\u03a6 \u2208 2\u2126. (6)\n1p may need to specify the payment for \u03c9 \u2208 \u2126 \\ \u03a6 to discuss some of the properties. 2In the literature of trading networks (e.g., Hatfield et al. (2013)), a valuation function is often denoted by ui and a utility by Ui, but we use the notations from mechanism design. Also, we reserve ui for the utility defined in Section 3 and use u\u0303i here.\nThe prior work has developed several algorithms for finding the set of contracts that achieve the properties that are stronger than efficiency (e.g., competitive equilibrium and stability) under certain conditions (e.g., full substitutability (Hatfield et al., 2019)). However, they all rely on the knowledge of the types v.\nIn practice, however, the types are private information and need to be revealed by the players. Then, the players can have the incentive to be untruthful, which in turn leads to inefficiency, as the following example shows:\nExample 1. Consider a trading network with a single potential trade, \u2126 = {\u03c9}, between two players, N = {S,B}. With \u03c9, the seller (S) incurs a production cost CS, and the buyer (B) gets a profit 1 \u2212 CB (retail price minus handling cost): i.e., vS(\u03a6) = \u2212CS I{\u03a6 = \u2126} and vB(\u03a6) = (1\u2212CB) I{\u03a6 = \u2126}, where I{\u00b7} is the indicator function. Consider the payment, p(\u03c9) = 1+CS\u2212CB2 , that equally shares the net profit between S and B. Given the types (i.e., CS and CB), we can achieve efficiency by letting \u03a6 = \u2126 if CS +CB < 1 and \u03a6 = \u2205 otherwise. When CS +CB < 1, the utility of each player is 1\u2212CS\u2212CB2 . However, then each player i has the incentive to untruthfully declare slightly higher cost Ci+ \u03b5 to get slightly higher utility 1\u2212CS\u2212CB+\u03b5 2 . If the declared cost is too high, the trade is not conducted. Since 1\u2212CS\u2212CB = vS(\u2126)+vB(\u2126) > vS(\u2205)+vB(\u2205) = 0, untruthfulness indeed leads to inefficiency."
        },
        {
            "heading": "3 Introducing Payment to/from IP",
            "text": "We consider the trading networks where the types are private information of the respective players and study the mechanisms that promote truthfulness and hence lead to efficiency. To facilitate truthfulness, the mechanism may require each player i to make (possibly negative) payment \u03c4i \u2208 R to an independent party (IP). A trading network with IP is denoted by T +(v) = (N+,\u2126, v), where N+ \u2261 N \u222a {IP} denotes the set of all players and IP. Also, let Vi be the space of types for each i \u2208 N and let V \u2261 \u00d7i\u2208NVi. Moreover, let T +(V) \u2261 (N ,\u2126,V) \u2261 {T +(v) : v \u2208 V} be the set of trading networks with IP under V. We will simply refer to T +(v) or T +(V) as a trading network.\nWe study the Bayesian setting where there exists a prior distribution q over V such that the players have types v with probability q(v). Throughout, we assume that the true type vi of each player i \u2208 N is known by that player. We will, however, make varying assumptions on other knowledge about the types, which will be made explicit in each of the results in the following."
        },
        {
            "heading": "3.1 Direct Mechanisms",
            "text": "We study a direct mechanism, where players and IP act according to the following protocol:\n1. Each player i declares a (possibly untruthful) type v\u0302i \u2208 Vi 2. IP determines the set of contracts, {(\u03c9, \u03c0(\u03c9; v\u0302)) : \u03c9 \u2208 \u03c6(v\u0302)}, and (possibly negative) payment, \u03c4i(v\u0302),\nfrom each player i to IP\nHence, the direct mechanism of a trading network T (V) is specified by an outcome rule (\u03c6, \u03c4, \u03c0), where \u03c6 : V \u2192 2\u2126 is the allocation rule that maps declared types, v\u0302 \u2261 (v\u0302i)i\u2208N , to a set of trades \u03c6(v\u0302) to be conducted; \u03c4 determines the rule of payment to IP, \u03c4i \u2208 V \u2192 R, for each i \u2208 N ; \u03c0 : 2\u2126 \u00d7 V \u2192 R is the payment rule that determines the payment associated with each trade, depending on the declared types. In the following, we refer to a direct mechanism simply as a mechanism.\nWhen v\u0302 is declared by the players in the trading network T + = (N+,\u2126, v), each player i \u2208 N gets the following utility under the mechanism (\u03c6, \u03c4, \u03c0):\nui(v\u0302; (\u03c6, \u03c4, \u03c0), T +(v)) = vi(\u03c6(v\u0302)) + \u2211\n\u03c9\u2208\u03c6(v\u0302)i\u2192\n\u03c0(\u03c9; v\u0302)\u2212 \u2211\n\u03c9\u2208\u03c6(v\u0302)\u2192i\n\u03c0(\u03c9; v\u0302)\u2212 \u03c4i(v\u0302). (7)\nWe denote the net-payment to IP (or utility of IP) by uIP(v\u0302; (\u03c6, \u03c4, \u03c0), T +(v)) = \u2211 i\u2208N \u03c4i(v\u0302). (8)"
        },
        {
            "heading": "3.2 Desirable Properties",
            "text": "We consider the four desirable properties of a mechanism that is standard in mechanism design (Parkes, 2001): Dominant Strategy Incentive Compatibility (DSIC), Efficiency, Weak Budget Balance (WBB), and Individual Rationality (IR). These properties are known to be simultaneously achievable in combinatorial auctions, but we will see that such positive results do not carry over to trading networks. We formally define each property in the following, but note that, under the Bayesian setting, we can discuss both ex post properties (which hold surely for any v \u2208 V) and ex ante or interim properties (which hold in expectation with respect to the prior distribution q over V).\nWe will formally define each of these properties in the following (see Parkes (2001) for more details). Note that, under the Bayesian setting, we can discuss either ex post properties (which hold surely for any v \u2208 V) or ex ante/interim properties (which hold in expectation with respect to the prior distribution q over V).\nDSIC is an ex post property and ensures that the best strategy of each player is truthfully revealing its type regardless of the strategies of the other players. This gives a clear course of actions. Formally, we say that a mechanism (\u03c6, \u03c4, \u03c0) for a trading network T +(V) is DSIC if the profile of truthful strategies form a dominant-strategy equilibrium:\nui((vi, v\u2212i); (\u03c6, \u03c4, \u03c0), T +(v)) \u2265 ui((v\u2032i, v\u2212i); (\u03c6, \u03c4, \u03c0), T +(v)),\u2200(v, v\u2032i) \u2208 V \u00d7 Vi (9)\nwhere v\u2212i is the strategy profile of players except i. We will discuss the corresponding ex ante property of Bayesian Nash Incentive-Compatibility (BNIC) only in relation to the prior work, but BNIC only ensures that a truthful player can maximize its expected utility under the additional condition that other players are truthful.\nEfficiency is also an ex post property and ensures that the trades are allocated in a way that they maximize total value. Following the definition without IP in (1), we say that a mechanism (\u03c6, \u03c4, \u03c0) for T +(V) is Efficient if \u2211\ni\u2208N vi(\u03c6(v)) \u2265 \u2211 i\u2208N vi(\u03a6),\u2200(v,\u03a6) \u2208 V \u00d7 2\u2126. (10)\nWe will not discuss the corresponding ex ante property. WBB ensures nonnegative utility of IP. We say that a mechanism (\u03c6, \u03c4, \u03c0) for T +(V) is ex post WBB if\nuIP(v; (\u03c6, \u03c4, \u03c0), T +(v)) \u2265 0,\u2200v \u2208 V (11)\nand ex ante WBB if\nE [ uIP(v; (\u03c6, \u03c4, \u03c0), T +(v)) ] \u2265 0, (12)\nwhere the expectation is with respect to the prior distribution of v. That is, under the additional condition that the players are truthful (which is guaranteed with DSIC), the utility of IP is non-negative surely under ex post WBB and in expectation under ex ante WBB.\nIR ensures that every player gets non-negative utility. IR can also be ex post or ex ante. However, when players know their own types, each player should require non-negative expected utility given its own type, and such a property is called interim IR. Formally, we say that a mechanism (\u03c6, \u03c4, \u03c0) for T +(V) is ex post IR if\nui(v; (\u03c6, \u03c4, \u03c0), T +(v)) \u2265 0,\u2200v \u2208 V (13)\nfor each i \u2208 N and interim IR if E [ ui(v; (\u03c6, \u03c4, \u03c0), T +(v)) | vi ] \u2265 0,\u2200vi \u2208 Vi (14)\nfor each i \u2208 N . That is, under the additional condition that the players are truthful (guaranteed with DSIC), a truthful player gets non-negative utility surely under ex post IR and in expectation under interim IR.\nNote that ex post properties are more desirable than the corresponding ex ante properties. For example, maximizing expected utility may not be the objective of risk-sensitive players. Also, the optimality of the truthful strategy under BNIC relies on the truthfulness of the other players, which is not required under DSIC."
        },
        {
            "heading": "3.3 No Payment between Players",
            "text": "We claim that, as far as the utilities of the forms in (7)-(8) are concerned, we do not lose generality by ignoring the payment among players (i.e., \u03c0(\u03c9; v\u0302) = 0,\u2200(\u03c9, v\u0302)). Formally,\nLemma 1. For any mechanism (\u03c6, \u03c4, \u03c0) and a payment rule \u03c0\u2032 for a trading network T +(V) = (N+,\u2126,V), there exists a rule of payment to IP \u03c4 \u2032 such that ui(v\u0302; (\u03c6, \u03c4, \u03c0), T +(v)) = ui(v\u0302; (\u03c6, \u03c4 \u2032, \u03c0\u2032), T +(v)) for any (v\u0302, v, i) \u2208 V2 \u00d7N+.\nProof. Let \u03c4 \u2032i(v\u0302) = \u03c4i(v\u0302)\u2212 \u2211\n\u03c9\u2208\u03c6(v\u0302)i\u2192\n\u03c0(\u03c9; v\u0302) + \u2211\n\u03c9\u2208\u03c6(v\u0302)\u2192i\n\u03c0(\u03c9; v\u0302) + \u2211\n\u03c9\u2208\u03c6(v\u0302)i\u2192\n\u03c0\u2032(\u03c9; v\u0302)\u2212 \u2211\n\u03c9\u2208\u03c6(v\u0302)\u2192i\n\u03c0\u2032(\u03c9; v\u0302). (15)\nThen, by (7), we have ui(v\u0302; (\u03c6, \u03c4, \u03c0), T +(v)) = ui(v\u0302; (\u03c6, \u03c4 \u2032, \u03c0\u2032), T +(v)) for any (v, i) \u2208 V \u00d7 N . Also, (4) implies uIP(v\u0302; (\u03c6, \u03c4, \u03c0), T +(v)) = uIP(v\u0302; (\u03c6, \u03c4 \u2032, \u03c0\u2032), T +(v)) for any v \u2208 V by the definition of uIP in (8).\nThe following theorem implies that we only need to consider the mechanisms without payment between players to achieve the four properties:\nTheorem 1. For any mechanism (\u03c6, \u03c4, \u03c0) and a payment rule \u03c0\u2032 for T +(V) = (N+,\u2126,V), there exists a rule of payment to IP, \u03c4 \u2032 such that each of DSIC, Efficiency, WBB (either ex ante or ex post), and IR (either ex ante or interim) is satisfied with (\u03c6, \u03c4, \u03c0) iff it is satisfied with (\u03c6, \u03c4 \u2032, \u03c0\u2032).\nProof. By Lemma 1, for any pair of (\u03c6, \u03c4, \u03c0) and \u03c0\u2032, there exists \u03c4 \u2032 such that utilities of the players and the IP under (\u03c6, \u03c4, \u03c0) are the same as those under (\u03c6, \u03c4 \u2032, \u03c0\u2032) for any v \u2208 V. Hence, it suffices to show that each of the properties depend only on the utilities of the players and the IP. For example, DSIC (9) depends only on the utilities; hence, if (\u03c6, \u03c4, \u03c0) is DSIC, i.e.,\nui((vi, v\u2212i); (\u03c6, \u03c4, \u03c0), T +(v)) \u2265 ui((v\u2032i, v\u2212i); (\u03c6, \u03c4, \u03c0), T +(v)),\u2200(v, v\u2032i) \u2208 V \u00d7 Vi, (16)\nthen, since ui(v; (\u03c6, \u03c4, \u03c0), T +(v)) = ui(v; (\u03c6, \u03c4 \u2032, \u03c0\u2032), T +(v)) for any v, we must have\nui((vi, v\u2212i); (\u03c6, \u03c4 \u2032, \u03c0\u2032), T +(v)) \u2265 ui((v\u2032i, v\u2212i); (\u03c6, \u03c4 \u2032, \u03c0\u2032), T +(v)),\u2200(v, v\u2032i) \u2208 V \u00d7 Vi, (17)\ni.e., (\u03c6, \u03c4 \u2032) is DSIC. The converse also holds. Since it is straightforward to see that ex post WBB (11), ex ante WBB (12), ex post IR (13), and interim IR (14) also depend only on the utilities of the players and the IP, it remains to show that Efficiency depends only on the utilities. Now, observe that (10) is equivalent to\u2211\ni\u2208N+ ui(v; (\u03c6, \u03c4, \u03c0), T +(v)) \u2265 \u2211 i\u2208N+ ui(v; (\u03c6 \u2032, \u03c4, \u03c0), T +(v)),\u2200v \u2208 V,\u2200\u03c6\u2032, (18)\nwhich depends only on the utilities of the players and the IP, which establishes the theorem.\nTheorem 1 implies that we only need to consider mechanisms with no payment between players as long as the desirable properties are the ones that depend only on the utility. Namely, for any set of properties that depend on the utility, there exists a mechanism with no payment between players that achieves those properties if and only if there exists a mechanism (with an arbitrary payment rule) that achieves those properties. Hence, we will only consider designing a mechanism (\u03c6, \u03c4, \u03c00) without payment between players and denote such a mechanism by (\u03c6, \u03c4). Intuitively, if there is a payment p(\u03c9) from a buyer to a seller, we can let the buyer pay p(\u03c9) to IP and let IP pay p(\u03c9) to the seller without changing the net-payment of the two players and IP."
        },
        {
            "heading": "4 Impossibility",
            "text": "Here, we show that no mechanism (\u03c6, \u03c4) can achieve all of the four properties ex post for trading networks with a single potential trade except for trivial cases. Theorem 1 then implies that no mechanisms (\u03c6, \u03c4, \u03c0), with any payment rule \u03c0, can simultaneously achieve the four properties except for trivial cases. Formally,\nDefinition 1. We say that a trading network (N+, {\u03c9},V) with a single trade between two players, |N | = 2, has non-trivial V if it satisfies both of the following conditions: i) there exists v \u2208 V such that \u2211 j\u2208N vj({\u03c9}) <\n0, and ii) for any vi \u2208 Vi, there exists v\u2212i \u2208 V\u2212i such that \u2211 j\u2208N vj({\u03c9}) > 0, where {i,\u2212i} \u2208 N .\nIn other words, V is said to be trivial if at least one of the two conditions in Definition 1 are violated. When condition i) is violated, the trade should always be conducted (i.e., \u03c6(v\u0302) = {\u03c9},\u2200v\u0302 \u2208 V) for Efficiency to hold, and all of the four properties are trivially satisfied with a constant payment rule3. Specifically, consider a seller (S) and a buyer (B), and let vi \u2261 minvi\u2208Vi vi({\u03c9}) be the minimum value of the trade for each i \u2208 N = {S,B}. Since condition i) is violated, we have vS + vB \u2265 0. Without loss of generality, let vS \u2264 vB. Then, with the constant payment rule of \u03c4 \u2032S(v\u0302) = \u2212vB and \u03c4 \u2032B(v\u0302) = vB, it is straightforward to verify that the four conditions are satisfied.\nWhen condition ii) is violated, there exists a player i who has the type vi that makes it impossible to make the social welfare, vi({\u03c9}) + v\u2212i({\u03c9}), positive no matter what types v\u2212i that the other player has. Such player i should not participate in the trading network from the perspective of social welfare, even if all of the four properties may be achieved with some mechanisms.\nFor other non-trivial cases, no mechanisms achieve all of the four properties. Formally,\nTheorem 2. For any trading network (N+, {\u03c9},V) with a single trade between two players having non-trivial V, no mechanisms can achieve all of DSIC, Efficiency, ex post WBB, and ex post IR.\nProof. Let N = {S,B} be the two players. For each i \u2208 N , let vLi \u2261 argminvi\u2208Vi vi({\u03c9}) be the type that gives the lowest value on the trade, and let vHi \u2261 argmaxvi\u2208Vi vi({\u03c9}) be the one giving the highest value. We say that player i with vLi has type X for X \u2208 {L,H}. We will show that we cannot simultaneously satisfy the conditions for the four properties associated with the players of those types (L and H).\nWe first consider the allocation rule \u03c6(X,Y ), where (X,Y ) are the types declared by (S, B). Efficiency (10) and the non-triviality of V imply that we must have\n\u03c6(X,Y ) = { \u2205 if (X,Y ) = (L,L) {\u03c9} otherwise (19)\nNext, consider the rule of payment to IP, \u03c4 \u2032(X,Y ). DSIC (9) requires among others that\nvHS (\u03c6(H,H))\u2212 \u03c4 \u2032S(H,H) \u2265 vHS (\u03c6(L,H))\u2212 \u03c4 \u2032S(L,H) (20) vLS (\u03c6(L,H))\u2212 \u03c4 \u2032S(L,H) \u2265 vLS (\u03c6(H,H))\u2212 \u03c4 \u2032S(H,H) (21) vHB (\u03c6(H,H))\u2212 \u03c4 \u2032B(H,H) \u2265 vHB (\u03c6(H,L))\u2212 \u03c4 \u2032B(H,L) (22) vLB(\u03c6(H,L))\u2212 \u03c4 \u2032B(H,L) \u2265 vLB(\u03c6(H,H))\u2212 \u03c4 \u2032B(H,H). (23)\nSince \u03c6(H,H) = \u03c6(L,H) = \u03c6(H,L) = {\u03c9} by (19), we can reduce (20)-(23) to\n\u03c4 \u2032S(L,H) = \u03c4 \u2032 S(H,H) (24) \u03c4 \u2032B(H,L) = \u03c4 \u2032 B(H,H). (25)\nex post IR (13) requires among others that\n\u03c4 \u2032S(L,H) \u2264 vLS (\u03c6(L,H)) = vLS ({\u03c9}) (26) \u03c4 \u2032B(H,L) \u2264 vLB(\u03c6(H,L)) = vLB({\u03c9}) (27)\n3The simple example in (Othman and Sandholm, 2009), where impossibility is shown not to hold, violates condition i.\nBy (24)-(27), we must have\n\u03c4 \u2032S(H,H) + \u03c4 \u2032 B(H,H) \u2264 vLS ({\u03c9}) + vLB({\u03c9}) (28)\nSince vLS ({\u03c9}) + vLB({\u03c9}) < 0 by condition i) of Definition 1, this contradicts a requirement from ex post WBB (11):\n\u03c4 \u2032S(H,H) + \u03c4 \u2032 B(H,H) \u2265 0 (29)\nMyerson and Satterthwaite (1983) show similar impossibility but assumes that the prior distribution over V has absolutely continuous density, which does not hold e.g. for discrete V (Othman and Sandholm, 2009). Our impossibility theorem does not require such an assumption, but ours is with DSIC and hence weaker in that respect than Myerson-Satterthwaite\u2019s, which establishes impossibility with BNIC."
        },
        {
            "heading": "5 Computing Mechanisms",
            "text": "The impossibility suggested by Theorem 2 motivates us to study the mechanisms that achieve weaker properties of ex ante WBB and interim IR in addition to DSIC and Efficiency. These weaker properties are still meaningful in practice and are sufficient for risk-neutral players.\nTo guarantee DSIC and Efficiency, we rely on the Groves mechanism. For any trading network (N+,\u2126,V), a mechanism (\u03c6, \u03c4 \u2032) is called a Groves mechanism if it can be represented by the use of a pivot rule, h \u2261 (hi)i\u2208N where hi : V\u2212i \u2192 R, as follows:\n\u03c6(v) = \u03c6?(v) \u2208 argmax \u03a6\u2286\u2126 \u2211 i\u2208N vi(\u03a6) (30)\n\u03c4 \u2032i(v) = hi(v\u2212i)\u2212 \u2211 j 6=i vj(\u03c6 ?(v)) (31)\nfor any v \u2208 V. Here, the pivot rule hi determines the payment, in addition to the second term of the righthand side of (31), in a way that it depends only on the types of other players (and not the type of player i). The Groves mechanism is guaranteed to satisfy Efficiency and DSIC, and we may arbitrarily choose h to achieve other properties. We refer to h as a Groves mechanism when it does not cause confusion.\nWith a Groves mechanism h, the condition for ex ante WBB (12) is reduced to\n0 \u2264 E [\u2211 i\u2208N \u03c4 \u2032i(v) ] (32)\n= E \u2211 i\u2208N hi(v\u2212i)\u2212\u2211 j 6=i vj(\u03c6 ?(v))  (33) = \u2211 i\u2208N E [hi(v\u2212i)]\u2212 (|N | \u2212 1) \u2211 i\u2208N E [vi(\u03c6?(v))] , (34)\nand interim IR (14) is reduced to\n0 \u2264 E [vi(\u03c6?(v))\u2212 \u03c4 \u2032i(v) | vi] (35)\n= E vi(\u03c6?(v))\u2212 hi(v\u2212i) +\u2211 j 6=i vj(\u03c6 ?(v)) | vi  (36) = \u2211 j\u2208N E [vj(\u03c6?(v)) | vi]\u2212 E [hi(v\u2212i) | vi] . (37)\nThere may or may not exist an h that satisfies both ex ante WBB and interim IR. When it does not exist, one could seek to find the h that minimizes the violation of these conditions. However, here we focus on studying whether such an h exists and finding one if it does. Also, when there are multiple h that satisfy both ex ante WBB and interim IR, we prefer the one with stronger budget balance (i.e., the total payment to IP should be as close to zero as possible).\nTherefore, we proposed to find h as the solution to the following optimization problem:\nmin h \u2211 i\u2208N E [hi(v\u2212i)] (38)\ns.t. \u2211 i\u2208N E [hi(v\u2212i)] \u2265 (|N | \u2212 1) \u2211 i\u2208N E [vi(\u03c6?(v))] (39)\nE [hi(v\u2212i) | vi] \u2264 \u2211 j\u2208N E [vj(\u03c6?(v)) | vi] ,\u2200vi \u2208 Vi,\u2200i \u2208 N (40)\nwhere E is the expectation with respect to the prior distribution of types. The constraint (39) is on ex ante WBB and corresponds to (34). The constraint (40) is on interim IR and corresponds to (37). for a given trading network (N+,\u2126,V), the right-hand sides of (39)-(40) are constants that can be computed by the use of the allocation rule \u03c6? and the prior distribution of types When N and V are finite, the optimization problem (38)-(40) is a linear program (LP), where variables are hi(v\u2212i) for v\u2212i \u2208 V, i \u2208 N . When there are n = |N | players, and each player i has m = |Vi| types, the LP has nmn\u22121 variables and nm+ 1 constraints. Example 2. Consider the trading network in Example 1, but we now assume that each player has one of two types: the production cost of the seller of type X is CXS for X \u2208 {L,H}, and the handling cost of the buyer of type Y is CYB for Y \u2208 {L,H}. Let CLi < CHi for i \u2208 {S,B}. By Theorem 2, there is no mechanism that simultaneously achieves the four properties ex post when cHS + c H B > 1 and c X S + c Y B < 1 for (X,Y ) \u2208 {(H,L), (L,H), (L,L)}. Under the Groves mechanism, the amount of payment to IP from S of type X and B of type Y is respectively given by\n\u03c4 \u2032S(X,Y ) = hS(Y )\u2212 (1\u2212 CYB ) q?(X,Y ) (41) \u03c4 \u2032B(X,Y ) = hB(X) + C X S q ?(X,Y ), (42)\nwhere q?(X,Y ) \u2261 I{\u03c6?(X,Y ) = \u2126} is the number of goods to be traded when the types of S and B are X and Y respectively. Note that the pivot rule of each player depends on the type of the other player and can be determined by solving the optimization problem (38)-(40), which is reduced to the following for this example:\nmin h\nE[hS(Y ) + hB(X)] (43)\ns.t. E[hS(Y ) + hB(X)] \u2265 E[(1\u2212 CXS \u2212 CYB ) q?(X,Y )] (44) E[hS(Y ) | X] \u2264 E[(1\u2212 CXS \u2212 CYB ) q?(X,Y ) | X],\u2200X \u2208 {L,H} (45) E[hB(X) | Y ] \u2264 E[(1\u2212 CXS \u2212 CYB ) q?(X,Y ) | Y ],\u2200Y \u2208 {L,H} (46)\nwhere the expectation is with respect to the prior distribution of types. This is an LP with four variables h \u2261 (hS(L), hS(H), hB(L), hB(H)) and four constraints.\nAlthough the solution to the optimization problem (38)-(40) indeed gives non-trivial Groves mechanisms that are of practical interest, it is intractable except for small trading networks. For example, i) there can be infinitely many types vi, which results in infinitely many variables in the optimization problem. Also, ii) one may not know the exact prior distribution of types, which we need to compute the expectation in (38)-(40). In addition, iii) it may be hard to compute the efficient allocation \u03c6?(v) for a given v \u2208 V."
        },
        {
            "heading": "6 Learning Mechanisms",
            "text": "Among the three challenges, i) and ii) are fundamental, since one cannot even represent the optimization problem with infinitely many variables or without knowing the prior distribution. Here, we propose learning\ntechniques to overcome these challenges. For the computational complexity of \u03c6?, efficient algorithms are known under some conditions on V (Candogan, Epitropou, and Vohra, 2021; Iwata, Moriguchi, and Murota, 2005)."
        },
        {
            "heading": "6.1 Learning Pivot Rules",
            "text": "We now assume that the mechanism designer (IP) has access to the sample D of types from the prior distribution q, rather than the exact knowledge on q. The expectation in (38)-(40) can then be replaced with sample average, which solves Challenge ii). IP may collect such D by running a Groves mechanism that is not necessarily ex ante WBB (hence, IP needs investment). Since players act truthfully under the Groves mechanism, the collected D should follow q4. One may then learn a better Groves mechanism (which less violates WBB) and collect additional data with the new mechanism for learning even better mechanisms (with the hope of eventually achieving ex ante WBB).\nRecall that the variables in (38)-(40) correspond to the output values of the pivot rule, hi(v\u2212i) for v\u2212i \u2208 V\u2212i and i \u2208 N , which constitute the codomain of the functions h = (hi)i\u2208N . To deal with infinitely many variables that stem from the functions with infinite codomain, we approximate those functions with machine learning models, h\u03b8 \u2261 (h\u03b8ii )i\u2208N where h \u03b8i i : V\u2212i \u2192 R with parameter \u03b8i for each i.\nSuch approaches of machine learning have been successfully applied in the prior work of mechanism learning. Unfortunately, in our case, it is not sufficient to replace the expectation with sample average and h with h\u03b8. In particular, the constraint (40) is problematic. Since the set {v\u0303 \u2208 D | v\u0303i = vi} is often small and can be empty for some vi \u2208 Vi, the sample average is unreliable or cannot be obtained with the empty set. A solution to this problem is to learn, for each i \u2208 N , a regressor (e.g., Gaussian process regressor) that maps vi to \u2211 j\u2208N E[vj(\u03c6?(v)) | vi] for vi \u2208 Vi, where the training data is D\u0302i \u2261 {(v\u0303i, \u2211 j\u2208N v\u0303j(\u03c6\n?(v\u0303)))}v\u0303\u2208D. Let g\u0302i be such a regressor trained with D\u0302i for i \u2208 N .\nWe can now reduce (38)-(40) to the following constrained non-linear optimization and learn a locally optimal \u03b8 with the augmented Lagrangian method:\nmin \u03b8 \u2211 v\u0303\u2208D \u2211 i\u2208N h\u03b8ii (v\u0303\u2212i) (47)\ns.t. \u2211 v\u0303\u2208D \u2211 i\u2208N h\u03b8ii (v\u0303\u2212i) \u2265 (|N | \u2212 1) \u2211 v\u0303\u2208D \u2211 i\u2208N v\u0303i(\u03c6 ?(v\u0303)) (48)\n1 |{v \u2208 D | vi = v\u0303i}| \u2211\nv\u2208D|vi=v\u0303i\nh\u03b8ii (v\u0303\u2212i) \u2264 g\u0302i(v\u0303i),\u2200v\u0303i \u2208 Di,\u2200i \u2208 N (49)\nwhere Di \u2261 {vi \u2208 Vi | \u2203v\u0303 \u2208 D s.t. v\u0303i = vi} is the set of the types of player i that appear in D. More precisely, we use a lower confidence bound for g\u0302(v\u0303i) in (49) and an upper confidence bound for the righthand side of (48). The learning problem (47)-(49) matches the optimization problem (38)-(40) in the limit of |D| \u2192 \u221e when the law of large numbers applies to the sample averages (e.g., v\u0303i(\u03c6?(v\u0303)) has finite variance), the regressors are asymptotically consistent (i.e., g\u0302i(vi)\u2192 E[vj(\u03c6?(v)) | vi]), the optimal h is in the class of h\u03b8 (i.e., realizable), the support of the prior distribution covers the whole V, and V is finite.\nAlthough the use of h\u03b8 alleviates Challenge i), the issue of computational complexity still remains. Namely, each h\u03b8ii takes types v\u2212i as its input, but each type is a function vj : 2\n\u2126 \u2192 R. A question is how to represent those functions. One may for example assume that the types are in a certain parametric family of functions (e.g., neural networks); then their parameters may be given as the input to h \u03b8\u2212i i (Faccio, Kirsch, and Schmidhuber, 2021). We take an alternative approach of representing a function with its output values (Harb et al., 2020). Observe that vi : 2 \u2126 \u2192 R can be fully characterized by a 2|\u2126|-dimensional valuation-vector, (vi(\u03a6))\u03a6\u2286\u2126, that represents the output values for all of the possible inputs. Each hi : V\u2212i \u2192 R can then be seen as a function that maps |N |\u22121 vectors, each having 2|\u2126| dimensions, to a real number; namely, hi : R2\n|\u2126| (|N |\u22121) \u2192 R (see Figure 1(a)).\n4Assuming that players (or their types) are sampled independently each time."
        },
        {
            "heading": "6.2 Variable Reduction",
            "text": "The valuation-vector has exponentially many dimensions and does not fully resolve Challenge i). We now show, based on game theoretic analysis, that some of the features of the valuation-vector are particularly important to achieve some of the desirable properties. A low dimensional valuation-vector can then be formed with these important features.\nTo this end, we have designed the following special Groves mechanisms:\nhWBBi (v) \u2261 max \u03a6\u2286\u2126 \u2211 j 6=i vj(\u03a6),\u2200i \u2208 N (50)\nhIRi (v) \u2261 max \u03a6\u2286\u2126\u2212i \u2211 j 6=i vj(\u03a6),\u2200i \u2208 N , (51)\nwhere \u2126\u2212i \u2261 \u2126 \\ (\u2126i\u2192 \u222a\u2126\u2192i) is the set of trades where player i is neither the seller nor the buyer. We will utilize these mechanisms, because it can be shown that hWBB is always ex post WBB, and hIR is ex post IR when no players reduce the social welfare, where a player reducing the social welfare is defined as follows:\nDefinition 2. In a trading network (N+,\u2126,V), a player i \u2208 N with type vi \u2208 Vi is called a negative player if there exists v\u2212i \u2208 V\u2212i such that\nmax \u03a6\u2208\u2126\u2212i \u2211 j 6=i vj(\u03a6) > max \u03a6\u2208\u2126 \u2211 j\u2208N vj(\u03a6). (52)\nFormally,\nTheorem 3. For any trading network (N+,\u2126,V), the hWBB in (50) satisfies DSIC, Efficiency, and ex post WBB, and the hIR in (51) satisfies DSIC, Efficiency, and ex post IR if (N+,\u2126,V) has no negative players.\nProof. Since DSIC and Efficiency are guaranteed with the Groves mechanism, it suffices to prove ex ante WBB and interim IR, respectively. Under hWBB, the payment from i to IP is\n\u03c4WBBi (v) = h WBB i (v)\u2212 \u2211 j 6=i vj(\u03c6 ?(v)) (53)\n= max \u03a6\u2286\u2126 \u2211 j 6=i vj(\u03a6)\u2212 \u2211 j 6=i vj(\u03c6 ?(v)) (54)\n\u2265 0 (55)\nfor any (i, v) \u2208 N \u00d7 V. We thus have \u2211 i\u2208N \u03c4 WBB i (v) \u2265 0 for any v \u2208 V, which implies ex post WBB (11).\nAlso, when there are no negative players, the utility of player i under hIR is\nvi(\u03c6 ?(v))\u2212 hIRi (v)\u2212\u2211 j 6=i vj(\u03c6 ?(v))  = \u2211 j\u2208N vj(\u03c6 ?(v))\u2212 max \u03a6\u2286\u2126\u2212i \u2211 j 6=i vj(\u03a6) (56)\n\u2265 0 (57)\nfor any v \u2208 V, which implies ex post IR (13).\nSince hWBBi and h IR i , respectively, achieve ex post WBB and interim IR, one might expect that their combination may simultaneously achieve the weaker properties of ex ante WBB and interim IR. Observe that an arbitrary combination of two functions can be represented by a function that takes the input of the two functions. Since\nhWBBi (v) = \u2211 j 6=i vj(\u03a6 ?), where \u03a6? \u2208 argmax \u03a6\u2286\u2126 \u2211 j 6=i vj(\u03a6)\nhIRi (v) = \u2211 j 6=i vj(\u03a6 ?,i), where \u03a6?,i \u2208 argmax \u03a6\u2286\u2126\u2212i \u2211 j 6=i vj(\u03a6),\nwe see that (vj(\u03a6 ?))j 6=i and (vj(\u03a6 ?,i))j 6=i are the input of h WBB i and h IR i , respectively, and hence are the important features of the valuation-vector. We may thus seek to find the optimal function within the class of functions that take those important features as input (see Figure 1). We may also consider a larger class of functions by allowing additional (e.g., random) elements of the original valuation-vector as input, trading off the quality of approximation against computational complexity."
        },
        {
            "heading": "7 Experiments",
            "text": "We conduct our experiments with trading networks where it is impossible to achieve all of the four desirable properties ex post. Specifically, we generate non-trivial instances of trading networks uniformly at random in the setting of Example 2, which involves a single potential trade between a seller and a buyer5. By Theorem 2, there exist no mechanisms that satisfy all of the four desirable properties ex post for those non-trivial instances. We apply our proposed AMD approaches to these trading networks and study whether they can find the mechanisms that satisfy the four properties if WBB is ex ante and IR is interim."
        },
        {
            "heading": "7.1 Validating Computational Approach",
            "text": "We first validate our computational approach by applying it to each of the randomly generated instances. Here, we solve the optimization problem in (38)-(40) via CPLEX 22.1.\nFigure 2 shows the expected budget balance (utility) of IP in (a) and the expected utility of each player in (b) for the 1,642 instances plotted in non-decreasing order. Observe that, for all instances, IP expects essentially zero budget balance, and every player (supplier or buyer of any type) expects non-negative utility. Therefore, the proposed approach finds the mechanism that achieves both of ex ante WBB6 and interim IR (in addition to DSIC and Efficiency) for every randomly generated instance where achieving the four properties ex post is impossible.\nThis however does not mean that one can always achieve ex ante WBB and interim IR. There indeed exist instances for which ex ante WBB or interim IR cannot be achieved. Empirically, however, such infeasible instances appear to have zero Lebesgue measure and are not generated in our random process. A caveat\n5To generate non-trivial instances, we first randomly generate 10,000 instances that are not necessarily non-trivial (for each player, pairs of numbers in [0,1] are generated uniformly at random and let those values be the cost of the two types; the prior probabilities of the types are also chosen uniformly at random). Out of those instances, 1,642 have non-trivial V and used in the experiments.\n6In fact, strong budge balance is achieved.\nis that, when an instance is close to an infeasible instance, our approach tends to find the mechanism that requires a large amount of payment to or from IP. The amount of payment occasionally exceeds the cost of each player by more than 100 times, which is unlikely to be acceptable in practice even if the expected utility is non-negative. See the expected payment of each player to/from IP in Figure 3."
        },
        {
            "heading": "7.2 Validating Learning Approach",
            "text": "Next, we validate the effectiveness of our learning approach with a focus on the impact of sample approximation. Here, for each of the 1,642 instances, we take varying number of samples from the prior distribution of types to solve the learning problem (47)-(49). Here, we use the lower confidence bound of a Gaussian process regressor to evaluate the right-hand side of (49) and added the sample standard deviation to the right-hand side of (48) to form an upper confidence bound. We do not rely on functional approximation h\u03b8 and seek to find an exact h. Figure 4 shows (a) the fraction of the instances for which the learning problem has feasible solutions as well as the expected utility of (b) IP, (c) the supplier, and (d) the buyer under the mechanisms learned with our approach. In (b)-(d), the solid lines show the average over the feasible instances, and the shared area represents the [15.9%, 84.1%]-quantile, which coincide with the confidence intervals set in (48)-(49).\nWe find that the learning problems do not necessarily have feasible solutions (while the corresponding optimization problems are all feasible), but with sufficient amount of data (\u2265 512 in this case), all of the learning problems become feasible. For those feasible learning problems, the proposed approach learns the mechanisms where the supplier and the buyer has strictly positive expected utility (achieving interim IR), and the IP has approximately zero expected utility (achieving ex ante WBB). Also, ex ante WBB and interim IR are achieved with high probability, but they are sometimes violated unlike the mechanisms computed with the exact knowledge of the prior distribution. As the sample size increases, however, ex ante WBB and interim IR get more frequently satisfied with the mechanisms found with learning."
        },
        {
            "heading": "7.3 Validating Variable Reduction",
            "text": "Finally, we study the effectiveness of variable reduction by applying it to the settings of the previous experiments. Recall that the number of variables can be reduced from 2|\u2126| |N | (|N | \u2212 1) to 2 |N | (|N | \u2212 1). While this may not appear to reduce the number of variables when |\u2126| = 1 and |N | = 2, it reduces the essential\nnumber of variables even in this case. Specifically, for the trading network in Example 2, we have\nargmax \u03a6\u2286\u2126 vS(\u03a6) = argmax \u03a6\u2286\u2126\u2212B\nvS(\u03a6) = {\u2205}, (58)\nso that both hIRB and h WBB B are functions vS(\u2205).\nFigure 5 shows the performance of the mechanisms computed by the proposed approach with the technique of variable reduction. Compared to the corresponding results in Figure 2 and Figure 3 without variable reduction, we find different mechanisms depending on whether the variables are reduced or not, as is suggested by the different expected utilities of the players. However, the mechanisms computed with reduced variables still achieve ex ante WBB and interim IR for all of the randomly generated instances.\nFigure 6 shows the performance of the mechanisms learned with variance reduction. Similar to the corresponding results without variable reduction (Figure 4), ex ante WBB and interim IR are achieved with high probability when the learning problems are feasible. Variable reduction, however, reduces the solution space, and the instances that are feasible without variable reduction can become infeasible. Nevertheless, the fraction of feasible instances increases with the sample size (and all of the instances become feasible with the exact prior distribution, as we have shown with the computational approach)."
        },
        {
            "heading": "8 Conclusion",
            "text": "We have shown that, by computing or learning appropriate mechanisms, it can be made possible to achieve DSIC, Efficiency, ex ante WBB, and interim IR in trading networks where achieving these four properties ex post is impossible. Our AMD approach is greatly simplified with Theorem 1, which allows us to ignore the payment between players, and the Groves mechanisms, which allows us to focus on achieving WBB and IR.\nThis paper proposes the first AMD approach for trading networks and suggests interesting directions of future work. For example, while we learn mechanisms from previously collected (offline) data, the prior work has also investigated the approaches of learning mechanisms while collecting data in an online manner (Mohri and Medina, 2014; Chapman, Rogers, and Jennings, 2008; Balaguer et al., 2022b; Liu, Chen, and Qin, 2015) or by reinforcement learning (Tang, 2017; Rheingans-Yoo, 2020; Balaguer et al., 2022a; Zheng et al., 2021; Baumann, Graepel, and Shawe-Taylor, 2018; Koster et al., 2022; Brero et al., 2021b,a). Such online methods involves the additional challenge of the tradeoff between exploration and exploitation, and it is an interesting direction of future work to study such online methods for trading networks. (Morgenstern and Roughgarden, 2016; Cai and Daskalakis, 2017; Gonczarowski and Weinberg, 2018; Balcan et al., 2005)\nstudy sample complexity of learning mechanisms in combinatorial auctions, but such sample complexity for trading networks is unknown to date."
        },
        {
            "heading": "A When the payment rule is given by other means",
            "text": "Our approach may also be applied when \u03c0 is determined by other means. Namely, for any payment rule \u03c0 for T +(V) = (N ,\u2126,V), we may design a mechanism (\u03c6, \u03c4 \u2032, \u03c00) with no payment between players, and convert \u03c4 \u2032 to \u03c4 via (15) to obtain the mechanism (\u03c6, \u03c4, \u03c0). See Algorithm 1.\nAlgorithm 1 Mechanism design for trading network with IP\nInput: A trading network (N ,\u2126,V) and a payment rule \u03c0; Desirable properties Output: A mechanism (\u03c6, \u03c4, \u03c0) that achieves the desirable properties\n1: For (N ,\u2126,V), design a mechanism (\u03c6, \u03c4 \u2032, \u03c00) with no payment between players that achieves the desirable properties 2: Let \u03c4i(v) = \u03c4 \u2032 i(v) + \u2211 \u03c9\u2208\u03c6(v)i\u2192 \u03c0(\u03c9; v)\u2212 \u2211 \u03c9\u2208\u03c6(v)\u2192i \u03c0(\u03c9; v) for any (i, v) \u2208 N \u00d7 V\nIn particular, for an arbitrary payment rule \u03c0, one may first find a Groves mechanism (\u03c6?, \u03c4 \u2032) and transform it into a mechanism (\u03c6?, \u03c4) by following the procedure in Algorithm 1. Even though (\u03c6?, \u03c4) may not be a Groves mechanism in the sense of (30)-(31), DSIC and Efficiency of (\u03c6?, \u03c4) are guaranteed by the corresponding properties of (\u03c6?, \u03c4 \u2032) according to Theorem 1."
        }
    ],
    "title": "Mechanism Learning for Trading Networks",
    "year": 2022
}
{
    "abstractText": "The computation of the nuclear quantum dynamics of molecules is challenging, requiring both accuracy and efficiency to be applicable to systems of interest. Recently, theories have been developed for employing time-dependent basis functions (denoted modals) with vibrational coupled cluster theory (TDMVCC). The TDMVCC method was introduced along with a pilot implementation, which illustrated good accuracy in benchmark computations. In this paper, we report an efficient implementation of TDMVCC, covering the case where the wave function and Hamiltonian contain up to two-mode couplings. After a careful regrouping of terms, the wave function can be propagated with a cubic computational scaling with respect to the number of degrees of freedom. We discuss the use of a restricted set of active one-mode basis functions for each mode, as well as two interesting limits: (i) the use of a full active basis where the variational modal determination amounts essentially to the variational determination of a time-dependent reference state for the cluster expansion; and (ii) the use of a single function as an active basis for some degrees of freedom. The latter case defines a hybrid TDMVCC/TDH (time-dependent Hartree) approach that can obtain even lower computational scaling. The resulting computational scaling for hybrid and full TDMVCC[2] is illustrated for polyaromatic hydrocarbons with up to 264 modes. Finally, computations on the internal vibrational redistribution of benzoic acid (39 modes) are used to show the faster convergence of TDMVCC/TDH hybrid computations towards TDMVCC compared to simple neglect of some degrees of freedom. Published under an exclusive license by AIP Publishing. https://doi.org/10.1063/5.0175506",
    "authors": [
        {
            "affiliations": [],
            "name": "Andreas Buchgraitz"
        },
        {
            "affiliations": [],
            "name": "Mads Greisen H\u00f8jlund"
        },
        {
            "affiliations": [],
            "name": "Alberto Zoccante"
        },
        {
            "affiliations": [],
            "name": "Niels Kristian Madsen"
        }
    ],
    "id": "SP:1f421d064a423db53d2a6a9511158b6b5c489fda",
    "references": [],
    "sections": [
        {
            "text": "I. INTRODUCTION\nMolecular dynamics research covers a broad spectrum, from classical molecular dynamics (MD) approaches to full quantum descriptions. Classical MD methods have the advantage of being easily applicable to large systems using simple coordinates, but purely classical MD falls short in capturing quantum effects that are crucial at the atomic level. Quantum-classical trajectory methods incorporate quantum corrections, and such methods have seen significant progress through the years; see Refs. 1 and 2 and references therein.\nIn this paper, we will, however, focus entirely on wave function methods. Quantum dynamical wave function methods are typically computationally expensive, i.e., they often exhibit exponential scaling of the cost with respect to the system size. While this limitation is not universal, many methods struggle to handle systems with numerous coupling terms and can only treat a limited number of degrees of freedom efficiently.\nRecently, vibrational coupled cluster (VCC)3 methods have been extended to the time-dependent domain as time-dependent vibrational coupled cluster (TDVCC),4,5 thus offering a new\nJ. Chem. Phys. 159, 204106 (2023); doi: 10.1063/5.0175506 159, 204106-1\nPublished under an exclusive license by AIP Publishing\n12 January 2024 17:00:20\napproach for solving the time-dependent Schr\u00f6dinger equation (TDSE) for molecular motion numerically. Time-dependent coupled cluster methods have previously been discussed in many contexts,6\u201310 and there has been considerable recent activity in time-dependent coupled cluster theory for electrons.7,11\u201315 In the remainder of this work, we shall focus exclusively on nuclear motion, although a number of formal aspects are similar. TDVCC has demonstrated its potential as an efficient method for simulating time-dependent phenomena with attractive features with respect to accuracy, convergence in configuration space, and separability properties, but it also has certain drawbacks. In the initial formulation, it relies on both a time-independent basis set and a time-independent reference state, which restricts the applicability of the method. The use of cluster amplitudes to describe effects that could be captured in a more compact way by time-dependent basis sets and reference states leads to reduced computational efficiency. To address these limitations, the concept of time-dependent vibrational coupled cluster with time-dependent modals (TDMVCC)16\u201318 has been proposed even more recently. The term modal refers simply to onemode basis functions, similar to the single-particle orbital basis of electronic structure theory, from which many-particle basis functions are constructed as products. TDMVCC aims to combine the advantages of TDVCC with the use of a time-dependent adaptive basis in the spirit of the multiconfiguration time-dependent Hartree (MCTDH)19,20 method. MCTDH has proven highly successful in describing quantum dynamics by utilizing a small, adaptive active space, providing accurate results at a reasonable computational cost. However, MCTDH still suffers from exponential scaling with the number of modes in the system. While MCTDH offers a fully correlated description, the much simpler time-dependent Hartree (TDH) method amounts to a mean-field treatment of the dynamics. In fact, TDH can be viewed as a limiting case of MCTDH, where each mode has only one active modal. This simplifying circumstance reduces the computational scaling to quadratic for two-body Hamiltonians in an efficient implementation.21,22 To overcome the scaling issue of MCTDH, efforts have been made to achieve polynomial scaling by multilayer schemes (ML-MCTDH)23\u201327 or by truncating the configuration space.28\u201333 The latter direction includes methods such as MCTDH[n]33 and MR-MCTDH[n],32 where the wave function is constructed in terms of excitations from a reference configuration. This approach is similar to how we will truncate the excitation space of TDMVCC in this paper. Other directions include Gaussian-based MCTDH variants (G-MCTDH) and other multi-configurational methods, including time-dependent Density Matrix Renormalization Group (TD-DMRG).34\u201352 See also Ref. 40 for a review of multiple spawning methods. TDMVCC seeks to incorporate the benefits of MCTDH and the TDVCC Ansatz. By introducing a small active space of time-dependent basis functions as in MCTDH and leveraging the fast convergence in configuration space offered by the exponentially parameterized VCC methodology, truncated TDMVCC variants present a potential solution to the exponential scaling problem. Still, the development of TDMVCC is in its infancy, and much further research is necessary to fully explore its capabilities.\nThe previous pilot implementation of TDMVCC could not establish the true low-order polynomial computational scaling of TDMVCC methods, as it relied on very general but exponential scaling steps. It was made solely with the aim of investigating\naccuracy and convergence in simple benchmarks. In this paper, we present an efficient implementation of the TDMVCC method covering the case where the wave function and Hamiltonian contain up to two-mode couplings (henceforth denoted TDMVCC[2]). The two-mode coupling case has a manageable number of terms that can be programmed by hand, something that has been utilized in similar papers in time-independent53,54 and time-dependent4 cases. We demonstrate how the TDMVCC[2] method can be implemented to efficiently handle many-mode computations with many-term Hamiltonians, achieving a computational scaling of third order with respect to the system size. In particular, we address the challenge of efficiently computing the TDMVCC mean fields. By manually deriving and implementing all the necessary terms, we establish a highly efficient code and lay the groundwork for future general implementations of TDMVCC. In addition, we discuss two interesting limits of using a restricted set of active one-mode basis functions for each mode: (i) the use of a full active basis where the variational modal determination amounts essentially to the variational determination of a time-dependent reference state for the cluster expansion; and (ii) the use of a single function as an active basis for some degrees of freedom. The latter case defines a hybrid TDMVCC/TDH approach, where some modes are treated at the TDH level. This approach of limiting some modes to the TDH level has previously been explored for the MCTDH method.55,56 This approach can obtain an even lower computational scaling, where the equations of motion (sEOMs) for the TDH modes are similar to those of the simple TDH theory, only with some additional mean-field contributions due to the TDMVCC modes. This work thereby initiates a new way of dealing with large systems with different levels of TDMVCC theory.\nThe structure of the paper is as follows. In Sec. II, we introduce the necessary theory for the TDMVCC method and derive the expressions in a form suitable for efficient implementation. In Sec. III, we present numerical results that highlight the features of the two-mode implementation, including computations on polyaromatic hydrocarbons (PAHs) with up to 264 modes, as well as TDMVCC and TDMVCC/TDH hybrid computations on benzoic acid. Finally, in Sec. IV, we provide a summary of our findings and offer an outlook for future research."
        },
        {
            "heading": "II. THEORY",
            "text": ""
        },
        {
            "heading": "A. The many-mode second quantization formulation for biorthogonal bases",
            "text": "The TDMVCC method is formulated using the second quantization (SQ) framework introduced in Ref. 57. In an extension to Ref. 57 and following Refs. 16 and 17, we are working in a biorthogonal framework with the main points repeated in this paper for completeness. The biorthogonality is indicated by using a\u0303 \u2020 and b\u0303 for creation and annihilation operators, respectively. The tilde is used to denote the time-dependence of the operators.\nRelative to the vacuum state, \u2223vac\u27e9, single-mode creation and annihilation operators act as\na\u0303m \u2020sm \u2223vac\u27e9 = \u2223\u03c6\u0303 m sm\u27e9, (1)\n\u27e8vac\u2223b\u0303mrm = \u27e8\u03c6\u0303 \u2032m rm \u2223. (2)\nJ. Chem. Phys. 159, 204106 (2023); doi: 10.1063/5.0175506 159, 204106-2\nPublished under an exclusive license by AIP Publishing\n12 January 2024 17:00:20\nIn first quantization coordinate representation, the right-hand sides would be written as \u03c6\u0303msm(qm, t) and \u03c6\u0303 \u2032m rm (qm, t). The explicit timedependence will usually be omitted in the following. One-mode basis functions will generally be denoted modals (in analogy to orbitals for electronic structure theory).\nTo describe the biorthogonality of the basis, we define the commutator relations\n[b\u0303mrm , a\u0303 m\u2032 \u2020\nsm \u2032 ] = \u03b4mm\u2032\u03b4rmsm\u2032 , [a\u0303\nm \u2020 rm , a\u0303\nm\u2032 \u2020 sm \u2032 ] = [b\u0303mrm , b\u0303 m\u2032 sm \u2032 ] = 0. (3)\nThe time-dependent biorthogonal creation and annihilation operators will be defined through a linear combination of timeindependent orthonormal creation (am \u2020\u03b1m ) and annihilation (a m \u03b1m) operators with a set of time-dependent expansion coefficients,\na\u0303m \u2020pm =\u2211 \u03b1m am \u2020\u03b1m U m \u03b1mpm , (4)\nb\u0303mpm =\u2211 \u03b1m Wmpm\u03b1m a m \u03b1m. (5)\nWe use an index convention with Greek letters \u03b1m for the primitive set of time-independent modals and roman letters pm, qm, rm, sm for generic time-dependent modals. The full set of time-dependent modals is divided into an active set of modals indexed by um, vm, wm and a set of secondary modals indexed by xm, ym. The active set of modals are those actually present in the wave functions. The number of time-independent modals will later be denoted N, while the number of time-dependent modals will be denoted A.\nThe biorthonormality of the time-dependent modals is captured by the modal expansion coefficients,\n\u2211 \u03b1m\nWmpm\u03b1m U m \u03b1mqm = \u03b4pmqm \u21d4 W mUm = Im, (6)\nwhere we have used matrix notation in the latter equation. From the creation and annihilation operators, we define the shift operator as\nE\u0303mrmsm = a\u0303 m \u2020 rm b\u0303 m sm. (7)\nThis type of operator is used extensively in Sec. II D, either as written earlier in Eq. (7) or as the one-mode excitation and deexcitation operators,\n\u03c4\u0303mam = E\u0303 m amim , (8)\n\u03c4\u0303m\u2021am = E\u0303 m imam. (9)\nHere, excitation and deexcitation refer to a reference Hartree product, which is given as a string of M creation operators acting on the vacuum,\n\u2223\u03a6\u0303\u27e9 = M\n\u220f m=1\na\u0303m \u2020im \u2223vac\u27e9. (10)\nHere, M denotes the number of modes. The index im is reserved for the occupied active modal of mode m in the reference state, while am, bm, cm denote unoccupied (virtual) active modals.\nWe will at times use the compound index \u03bc to mean some collection of mode and modal indices defining a general excitation. Other single Hartree product ket or bra states can, for example, be obtained as\n\u2223\u03bc\u27e9 = \u03c4\u0303\u03bc\u2223\u03a6\u0303\u27e9, (11)\n\u27e8\u03bc\u2032\u2223 = \u27e8\u03a6\u0303 \u2032\u2223\u03c4\u0303\u2021\u03bc. (12)\nIn addition, we will use the nomenclature that \u03bcj denotes a j-mode excitation. In our case, the two-mode excitations, \u03bc2, are of particular interest. Such excitations are constructed as products of one-mode excitations, i.e.,\n\u03c4\u0303\u03bc2 = \u03c4\u0303 m1m2 am1 am2 = E\u0303 m1 am1 im1 E\u0303 m2 am2 im2 . (13)"
        },
        {
            "heading": "B. The TDMVCC method",
            "text": "To obtain an approximation to the time-dependent wave function that exactly solves the TDSE within well-defined limits, we employ the TDMVCC method as introduced in Ref. 16. This section will give a brief overview of the general scheme of the method as well as a summary of the important equations one needs to implement.\nThe TDMVCC bra and ket Ans\u00e4tze are given as\n\u27e8\u03a8\u0304 \u2032\u2223 = \u27e8\u03a8\u0303 \u2032\u2223ei\u03f5 = \u27e8\u03a6\u0303 \u2032\u2223(1 + L)e\u2212Tei\u03f5, (14)\n\u2223\u03a8\u0304\u27e9 = e\u2212i\u03f5\u2223\u03a8\u0303\u27e9 = e\u2212i\u03f5eT \u2223\u03a6\u0303\u27e9. (15)\nHere, the T and L operators are defined as linear combinations of excitation and deexcitation operators, respectively, with the coefficients (s\u03bc and l\u03bc) termed cluster amplitudes and left amplitudes,\nT =\u2211 \u03bc s\u03bc\u03c4\u0303\u03bc, (16)\nL =\u2211 \u03bc\nl\u03bc\u03c4\u0303\u2021\u03bc. (17)\nWe denote the \u03f5 as the generalized phase (\u03f5 is generally complex). Following the time-dependent bivariational principle (TDBVP),6,7 one defines a Lagrangian\nL = \u27e8\u03a8\u0304 \u2032\u2223(i \u2202 \u2202t \u2212 H\u0302)\u2223\u03a8\u0304\u27e9, (18)\nand solves the corresponding Euler\u2013Lagrange equations (sELEs) for all parameters. Taking biorthogonality constraints into account, one arrives at16\nJ. Chem. Phys. 159, 204106 (2023); doi: 10.1063/5.0175506 159, 204106-3\nPublished under an exclusive license by AIP Publishing\n12 January 2024 17:00:20\n\u03f5\u0307 = \u27e8\u03a6\u0303 \u2032\u2223(H\u0302 \u2212 g\u0302)\u2223\u03a8\u0303\u27e9, (19)\ns\u0307 = \u2212i\u03c9H\u0302\u2212g\u0302 , (20)\nl\u0307 = i\u03b7H\u0302\u2212g\u0302 , (21)\niW\u0307mA = \u2212g\u0303 m WmA \u2212 [\u03c1 m ] \u22121F\u030c \u2032m Qm, (22)\niU\u0307mA = U m A g\u0303 m \u2212Qm F\u030c m[\u03c1m]\u22121. (23)\nHere, s and l are vectors containing the amplitudes, s\u03bc and l\u03bc. The g\u0302 operator is the so-called constraint operator, defined as\ng\u0302 =\u2211 m g\u0302 m =\u2211 m \u2211 umvm g\u0303mumvm E\u0303 m umvm. (24)\nSeveral other definitions are given in Table I. The projection matrix Qm = 1m \u2212UmWm plays the role of projecting onto the secondary space. The matrix containing the g\u0303mumvm elements is termed the constraint matrix (also written as g\u0303 m) and is related to the time-derivative of the creation and annihilation operators as\n[b\u0303mum , \u02d9\u0303a m\u2020 vm ] = \u2212ig\u0303mumvm , [ \u02d9\u0303bmum , a\u0303 m \u2020 vm ] = ig\u0303mumvm. (25)\nAs discussed in Ref. 16, the TDBVP leads to the following g\u0303 m matrix structure:\ng\u0303 m = \u23a1 \u23a2 \u23a2 \u23a2 \u23a2 \u23a2 \u23a3 0 (dg\u0303 m)T ug\u0303m 0 \u23a4 \u23a5 \u23a5 \u23a5 \u23a5 \u23a5 \u23a6 . (26)\nThe vectors dg\u0303m and ug\u0303m are found by solving two sets of linear equations,\nZm dg\u0303m = \u03b7H\u0302 ,m, (27)\n\u2212 (Zm)T ug\u0303m = um. (28)\nHere, we have defined Zmambm = \u03b4ambm \u03c1 m imim \u2212 \u03c1 m ambm . The density matrix \u03c1m and the um vector are discussed in detail for the two-mode case in Secs. II D 1 and II D 2, respectively.\nThe TDMVCC theory reduces to TDVCC with a timeindependent basis when Wm and Um are kept time-independent and gm consequently zero, as described in Refs. 4 and 5. In particular, the same structure of the EOMs is found for the phase, \u03f5, cluster amplitudes, s, and left amplitudes, l. A significant difference though is the necessity of the constraint matrix, gm, and determining the time-evolving modals, which introduces the need for computing mean-field matrices.\nIf there is no secondary space, i.e., if all modals are active, the equations for U\u0307mA and W\u0307 m A simplify significantly as the Q\nm matrix becomes the null matrix, effectively zeroing the second term in the two EOMs. The first column of the mean-field matrices is still needed for computing the um vector that is used for computing the variationally optimal g\u0303 m [see Eqs. (27) and (28)]. In Sec. II D 5, we will specifically discuss this limit, which we will call the full active basis (FAB)."
        },
        {
            "heading": "C. Polar parameterization of the modals",
            "text": "In Ref. 17, we described how instabilities can occur in the TDMVCC EOMs when employing a secondary modal basis (i.e., when the active basis is not full) and that such instabilities can also occur for other types of wave functions when a biorthogonal basis is used. This phenomenon was analyzed in detail for general bivariational time-dependent wave functions, and it was shown that the issue occurs because the bra and ket modal bases tend to span different spaces when given enough time in a numerical computation. A solution was proposed based on the reparameterization of the modals through polar decomposition. Fully variational EOMs were derived and subsequently modified in order to lock the bra and ket modal bases together such that they span the same space at any given time. This restricted polar representation corresponds to a modal\nTABLE I. Definition of variables for TDMVCC in the general case and in the specific two-mode case where T \u2192 T2, L\u2192 L2, \u03bc\u2192 \u03bc2, and H\u0302 = H\u03021 + H\u03022. For the mean-field matrices, we have introduced the semi-locked Hamiltonian operators of Eqs. (52), (53), and (58)\u2013(61). The two-mode specific expressions for the um vector, density matrix, and mean-field matrices are also expanded upon in Secs. II D 2, II D 1, and II D 3, respectively.\nSymbol General definition Two-mode specific expression\n\u03c9H\u0302\u03bc \u27e8\u03bc\u2032\u2223e\u2212TH\u0302eT \u2223\u03a6\u0303\u27e9 \u27e8\u03bc\u20322\u2223H\u03022 + [H\u03021 + H\u03022, T2] + 12 [[H\u03022, T2], T2]\u2223\u03a6\u0303\u27e9\u27e9 \u03b7H\u0302\u03bc \u27e8\u03a8\u0303 \u2032\u2223[H\u0302, \u03c4\u0303\u03bc]\u2223\u03a8\u0303\u27e9 \u27e8\u03a6\u0303 \u2032\u2223(1 + L2)([H\u03021 + H\u03022, \u03c4\u0303\u03bc2] + [[H\u03022, \u03c4\u0303\u03bc2], T2])\u2223\u03a6\u0303\u27e9 \u03c1mwmvm \u27e8\u03a8\u0303 \u2032\u2223E\u0303mvmwm \u2223\u03a8\u0303\u27e9 \u27e8\u03a6\u0303 \u2032\u2223(1 + L2)(E\u0303mvmwm + [E\u0303 m vmwm , T2])\u2223\u03a6\u0303\u27e9 F\u030cm\u03b1mvm \u27e8\u03a8\u0303 \u2032\u2223a\u0303m \u2020 vm [am\u03b1m , H\u0302]\u2223\u03a8\u0303\u27e9 [ U H\u030cm1 \u03c1m] \u03b1mvm + \u27e8\u03a8\u0303 \u2032\u2223H\u0306m2,(\u03b1mvm)\u2223\u03a8\u0303\u27e9 F\u030c\u2032mvm\u03b1m \u27e8\u03a8\u0303 \u2032\u2223[H\u0302, am \u2020\u03b1m ]b\u0303 m vm \u2223\u03a8\u0303\u27e9 [\u03c1 m W H\u030cm1 ] vm\u03b1m + \u27e8\u03a8\u0303 \u2032\u2223H\u0306\u2032m2,(vm\u03b1m)\u2223\u03a8\u0303\u27e9 umam F\u0303 \u2032m amim \u2212 F\u0303 m amim + more terms F\u0303 \u2032m amim \u2212 F\u0303 m amim\nJ. Chem. Phys. 159, 204106 (2023); doi: 10.1063/5.0175506 159, 204106-4\nPublished under an exclusive license by AIP Publishing\n12 January 2024 17:00:20\nparameterization of the form\nUmA = V m A P m, (29a)\nWmA = (P m ) \u22121 (VmA) \u2020, (29b)\nwhere VmA is semi-unitary (has orthonormal columns) and P m is Hermitian. Equation (29) clearly implies that the columns of UmA and WmA span the same space. Although the modified EOMs are not strictly variational, we found an attractive combination of stability and accuracy. The EOMs for the polar modal parameters are given by\niV\u0307mA = V m A g\u0303 \u2032m +Q\u2032mXm, (30a)\niP\u0307 m = Pmg\u0303 \u2032\u2032m. (30b)\nThe necessary matrices are all calculated from known quantities in a straightforward manner, using H and A to denote the Hermitian and anti-Hermitian parts of a matrix and \u25cb to denote the Hadamard product,\nQ\u2032m = 1 \u2212VmA(V m A) \u2020, (31a)\nXm = 1 2 (F\u030c m(\u03c1m)\u22121(Pm)\u22121 + (P(\u03c1m)\u22121F\u030c \u2032m)\u2020), (31b) g\u0303 \u2032m = H(g\u0304 m) + Tm(\u0393m \u25cb ((Tm)\u2020A(g\u0304 m)Tm))(Tm)\u2020, (31c)\ng\u0303 \u2032\u2032m = A(g\u0304 m) + Tm(\u0393m \u25cb ((Tm)\u2020A(g\u0304 m)Tm))(Tm)\u2020. (31d)\nHere, we have diagonalized Pm as Pm = Tm\u03b8mTm\u2020 and defined the auxiliary matrices g\u0304 m and \u0393m as\ng\u0304 m = Pmg\u0303 m(Pm)\u22121, (32a)\n\u0393mpmqm = \u2212\u03b8mpm + \u03b8 m qm\n\u03b8mpm + \u03b8 m qm\n. (32b)\nThe restricted polar representation requires the original gm matrices and a few extra steps that scale only linearly with respect to the number of modes. This extra cost can safely be considered negligible. We will accordingly employ the restricted polar representation throughout without further discussion of its computational cost and features."
        },
        {
            "heading": "D. Two-mode TDMVCC implementation",
            "text": "In the two-mode specific case, we truncate the cluster expansion to include at most two-mode excitations. As mentioned, onemode excitations are redundant and can be excluded, as derived in Sec. II C 3 of Ref. 16. This means that unlike in TDVCC[2] (with static modals), we do not need one-mode excitations in TDMVCC[2], since these degrees of freedom are covered by the time-dependent modals. TDMVCC[2] is defined by letting T \u2192 T2, L\u2192 L2, and \u03bc\u2192 \u03bc2. In this study, we further restrict ourselves to Hamiltonians containing at most two-mode couplings, i.e., H\u0302 = H\u03021 + H\u03022, where H\u0302 j contains only j-mode couplings. To be specific, let us write the cluster operators in detail,\nT = \u2211 m1<m2 Tm1m2 =\u2211 \u03bc2 s\u03bc2 \u03c4\u0303\u03bc2 = \u2211 m1<m2 \u2211 am1 am2 sm1m2am1 am2 \u03c4\u0303 m1m2 am1 am2 , (33)\nL = \u2211 m1<m2 Lm1m2 =\u2211 \u03bc2 l\u03bc2 \u03c4\u0303 \u2021 \u03bc2 = \u2211 m1<m2 \u2211 am1 am2 lm1m2am1 am2 \u03c4\u0303 m1m2\u2021 am1 am2 . (34)\nNote that the summations over modes in the T2 and L2 operators run over unique pairs of modes. In many summations later in this paper, we will use a notation allowing us to utilize permutation symmetry, i.e., we set Tm1m2 = Tm2m1 and sm1m2am1 am2 = s m2m1 am2 am1 and similarly for L. The reasoning is that excitations in two modes, m1 and m2, commute, as the mode indices are different by definition. We can use this in detailed expressions including commutation, e.g.,\n[E\u0303mpmqm , T] = \u2211 m0>m [E\u0303mpmqm , T mm0] + \u2211 m0<m [E\u0303mpmqm , T m0m]\n= \u2211 m0>m [E\u0303mpmqm , T mm0] + \u2211 m0<m [E\u0303mpmqm , T mm0] = \u2211 m0\u2260m [E\u0303mpmqm , T mm0]\n= \u2211 m0\u2260m \u2211 amam0\nsmm0amam0 [E\u0303 m pmqm , E\u0303 m amim]E\u0303 m0 am0 im0 . (35)\nWe express the Hamiltonian in a sum-of-products (SOP) format with factors containing one-mode operators, h\u0302mO m , where the Om index refers to a specific operator. Correspondingly, we have one-mode integrals of this operator in the time-dependent basis denoted as h\u0303mO m\npmqm . We can write the H\u03021 and H\u03022 operators as\nH\u03021 =\u2211 m H\u0302m1 =\u2211 m \u2211 Om CmOm h\u0302 mOm =\u2211 m \u2211 Om CmOm\u2211 pmqm h\u0303mO m pmqm E\u0303 m pmqm , (36)\nH\u03022 = \u2211 m<m0 H\u0302mm02 = \u2211 m<m0 \u2211 OmOm0 Cmm0OmOm0 h\u0302 mOm h\u0302 m0O m0\n= \u2211 m<m0 \u2211 OmOm0 Cmm0OmOm0 \u2211 pmqm\ntm0 um0\nh\u0303mO m pmqm h\u0303 m0Om0 tm0 um0 E\u0303 m pmqm E\u0303 m0 tm0 um0 .\n(37)\nHere, CmOm and C mm0 OmOm0 are possible fitting coefficients.\nThe two-mode implementation presented in this paper is obtained by explicitly deriving and hand-coding every single nonzero term. The overall idea and implementation follow those of Refs. 4, 53, and 54, but the mean fields contain other types of terms. As the EOMs for the s\u03bc2 and l\u03bc2 amplitudes presented in Sec. II B are equivalent to the ones derived explicitly in Ref. 4 (apart from the lack of the g\u0302 operator), we re-use the \u03c9H\u0302 and \u03b7H\u0302 transformers, as well as the phase evaluation algorithm. The only terms that are left for us to implement are, therefore, the constraint contributions, the modal derivatives, and in particular the efficient evaluation of the um vector, the density matrix (\u03c1m), and the mean-field matrices (F\u030c m and F\u030c \u2032m). Of these terms, the mean-field matrices are the most complex to evaluate. They contain many demanding terms and would be strongly time dominating unless care is taken in reducing operation count and scaling by analysis and use of intermediates. Naively, the computation of the mean-field matrices would scale as M4, but this can be reduced to M3 as explored in Secs. II D 4 and III A.\nJ. Chem. Phys. 159, 204106 (2023); doi: 10.1063/5.0175506 159, 204106-5\nPublished under an exclusive license by AIP Publishing\n12 January 2024 17:00:20\nIncluding only two-mode excitations in the excitation space and in the Hamiltonian greatly reduces the number of terms from thousands to tens. A first indication of this is given later in Tables II and III."
        },
        {
            "heading": "1. The density matrix",
            "text": "We will start out with an explicit derivation of the TDMVCC[2] density matrix, as it showcases general ideas that can be applied to many of the following equations. Starting from the definition of the density matrix, we simply expand the bra and ket states and then apply a Baker\u2013Campbell\u2013Hausdorff (BCH) expansion that\nTABLE III. Contributions to the mean-field matrix F\u030c \u2032m. Names for intermediates listed under column \u2019I\u2019 are defined in Table IV.\nNo. F\u030c \u2032m BCH order Contribution I\n13 F\u030c\u2032mim\u03b1m 0 h\u030c m im\u03b1m h\u0303 m0 p E\u0303 m p E\u0303 m0 p 14 F\u030c\u2032mim\u03b1m 0 h\u030c m am\u03b1m h\u0303 m0 u L2E\u0303mu E\u0303 m0 u W 15 F\u030c\u2032mim\u03b1m 1 \u2212h\u030c m im\u03b1m h\u0303 m0 p L2T2E\u0303 m p E\u0303 m0 p U 16 F\u030c\u2032mim\u03b1m 1 h\u030c m im\u03b1m h\u0303 m0 p L2E\u0303 m p E\u0303 m0 p T2 U 17 F\u030c\u2032mim\u03b1m 1 h\u030c m am\u03b1m h\u0303 m0 d L2E\u0303 m u E\u0303 m0 d T2 XL 18 F\u030c\u2032mim\u03b1m 1 h\u030c m im\u03b1m h\u0303 m0 f L2E\u0303 m p E\u0303 m0 f T2 V\n19 F\u030c\u2032mam\u03b1m 1 h\u030c m im\u03b1m h\u0303 m0 d E\u0303 m d E\u0303 m0 d T2 X 20 F\u030c\u2032mam\u03b1m 1 h\u030c m am\u03b1m h\u0303 m0 p L2E\u0303 m f E\u0303 m0 p T2 \u039b 21 F\u030c\u2032mam\u03b1m 1 h\u030c m im\u03b1m h\u0303 m0 u L2E\u0303md E\u0303 m0 u T2 WS 22 F\u030c\u2032mam\u03b1m 1 h\u030c m am\u03b1m h\u0303 m0 f L2E\u0303 m f E\u0303 m0 f T2 23 F\u030c\u2032mam\u03b1m 2 h\u030c m im\u03b1m h\u0303 m0 d L2E\u0303 m d E\u0303 m0 d T2T2 \u039e, U, X 24 F\u030c\u2032mam\u03b1m 2 \u2212h\u030c m im\u03b1m 2h\u0303 m0 d L2T2E\u0303 m d E\u0303 m0 d T2 U, X\nterminates after only two terms because the T and L operators only contain two-mode excitations/deexcitations. This procedure yields\n\u03c1mwmvm = \u27e8\u03a8\u0303 \u2032 \u2223E\u0303mvmwm \u2223\u03a8\u0303\u27e9\n= \u27e8\u03a6\u0303 \u2032\u2223(1 + L2)e\u2212T2 E\u0303mvmwm e T2 \u2223\u03a6\u0303\u27e9 = \u27e8\u03a6\u0303 \u2032\u2223(1 + L2)(E\u0303mvmwm + [E\u0303 m vmwm , T2])\u2223\u03a6\u0303\u27e9 = \u03b4imwm \u03b4imvm + \u27e8\u03a6\u0303 \u2032 \u2223L2[E\u0303mvmwm , T2]\u2223\u03a6\u0303\u27e9. (38)\nSpecifying the modals as either reference or virtual, only the following four combinations are possible:\n1. Passive: (vm,wm) = (im, im). 2. Up: (vm,wm) = (am, im). 3. Down: (vm,wm) = (im, am). 4. Forward: (vm,wm) = (am, bm).\nThis division of the modal indices is particularly convenient for quickly assessing the commutator or expectation value expressions, as the shift operator becomes an excitation/deexcitation (up/down) operator or an operator that does not change the excitation level (passive/forward). It is rather easy to see that the up and down elements vanish as the shift operator becomes either an excitation or deexcitation operator, i.e., \u03c1mamim = \u03c1 m imam = 0. The remaining cases\u2014passive and forward\u2014give non-zero contributions. The passive indices result in\n\u03c1mimim = 1 + \u27e8\u03a6\u0303 \u2032 \u2223L2[E\u0303mimim , T2]\u2223\u03a6\u0303\u27e9\n= 1 + \u2211 m0\u2260m \u2211 ambm0\nsmm0ambm0 \u27e8\u03a6\u0303 \u2032 \u2223L2[E\u0303mimim , \u03c4\u0303 mm0 ambm0 ]\u2223\u03a6\u0303\u27e9\n= 1 \u2212 \u2211 m0\u2260m \u2211 ambm0\nsmm0ambm0 \u27e8\u03a6\u0303 \u2032 \u2223L2\u03c4\u0303mm0ambm0 E\u0303 m imim \u2223\u03a6\u0303\u27e9\n= 1 \u2212 \u2211 m0\u2260m \u2211 ambm0\nsmm0ambm0 l mm0 ambm0 . (39)\nFollowing the same logic, we can get an expression for the forward contribution, where we obtain a sum over matrix products given as\n\u03c1mbmam = \u2211 m0\u2260m \u2211 cm0 smm0bmcm0 l mm0 amcm0 . (40)"
        },
        {
            "heading": "2. The um vector",
            "text": "Another important quantity to compute is the um vector [see Eq. (A29) in Ref. 16]. Utilizing the fact that \u03bc is strictly a two-mode excitation (\u03bc2) simplifies this expression significantly. Equation (A29) reads\numam = F\u0303 \u2032m amim \u2212 F\u0303 m amim +\u2211 \u03bc (\u27e8\u03a8\u0303 \u2032\u2223[\u03c4\u0303m\u2021am , \u03c4\u0303\u03bc]\u2223\u03a8\u0303\u27e9(is\u0307\u03bc)\n+ (il\u0307 \u03bc)\u27e8\u03bc\u0303 \u2032\u2223e\u2212T \u03c4\u0303m\u2021am \u2223\u03a8\u0303\u27e9). (41)\nAssuming that the fully transformed mean-field matrices as well as l\u0307 and s\u0307 are calculated and saved elsewhere, we are left with the summation over \u03bc and write this out with explicit two-mode cluster operators as\nJ. Chem. Phys. 159, 204106 (2023); doi: 10.1063/5.0175506 159, 204106-6\nPublished under an exclusive license by AIP Publishing\n12 January 2024 17:00:20\numam \u2190\u2211 \u03bc2 (\u27e8\u03a6\u0303 \u2032\u2223(1 + L2)e\u2212T2[\u03c4\u0303m\u2021am , \u03c4\u0303\u03bc2]e T2 \u2223\u03a6\u0303\u27e9(is\u0307\u03bc2)\n+ (il\u0307 \u03bc2)\u27e8\u03bc\u0303 \u2032 2\u2223e \u2212T2 \u03c4\u0303m\u2021am e T2 \u2223\u03a6\u0303\u27e9). (42)\nThe two terms are expanded using the BCH expansion and examined one at a time. The BCH expansion in the first term evaluates\ne\u2212T2[\u03c4\u0303m\u2021am , \u03c4\u0303\u03bc2]e T2 = [\u03c4\u0303m\u2021am , \u03c4\u0303\u03bc2] + [[\u03c4\u0303 m\u2021 am , \u03c4\u0303\u03bc2], T2]\n+ [[[\u03c4\u0303m\u2021am , \u03c4\u0303\u03bc2], T2], T2]. (43)\nIt is seen that the resulting three terms contain an even number of excitations (2, 4, 6) due to \u03c4\u0303\u03bc2 and T2 and a single deexcitation due to \u03c4\u0303m\u2021am . In the full expression, we also have the (1 + L2) term, which contains 0 and 2 deexcitations. This means that in total we have an even number of excitations (2, 4, 6) and an odd number of deexcitations (1, 3), resulting in orthogonal bra and ket states. The first term in the \u03bc2 sum in Eq. (41), therefore, always contributes 0 to the u m vector. The same procedure can be applied to the second term, again resulting in a vanishing contribution,\n\u27e8\u03bc\u0303\u20322\u2223e \u2212T2 \u03c4\u0303m\u2021am e T2 \u2223\u03a6\u0303\u27e9 = \u27e8\u03bc\u0303\u20322\u2223(\u03c4\u0303 m\u2021 am + [\u03c4\u0303 m\u2021 am , T2]\n+ [[\u03c4\u0303m\u2021am , T2], T2])\u2223\u03a6\u0303\u27e9 = 0. (44)\nTherefore, the umam vector elements for the two-mode coupling case are simply the difference of the first columns in the mean-field matrices, i.e.,\numam = F\u0303 \u2032m amim \u2212 F\u0303 m amim. (45)\nAgain, this encourages an efficient implementation of the mean-field matrices, which will be presented in Sec. II D 3."
        },
        {
            "heading": "3. Mean-field equations",
            "text": "As mentioned in Sec. II B, an efficient implementation of the mean-field matrices is key to an efficient implementation of the TDMVCC method. We will thus elaborate on the specifics of the equations for the mean fields in this and Sec. II D 4. The half-transformed mean fields defined in Ref. 16 are given as\nF\u030cm\u03b1mvm = \u27e8\u03a8\u0303 \u2032 \u2223a\u0303m \u2020 vm [am\u03b1m , H\u0302]\u2223\u03a8\u0303\u27e9, (46)\nF\u030c\u2032mvm\u03b1m = \u27e8\u03a8\u0303 \u2032 \u2223[H\u0302, am \u2020\u03b1m ]b\u0303 m vm \u2223\u03a8\u0303\u27e9. (47)\nTo obtain computationally convenient expressions for the two-mode part, we rewrite the primitive creation and annihilation operators in the biorthogonal basis using Eqs. (4)\u2013(6), giving the following two expressions:\nam\u03b1m =\u2211 pm Um\u03b1mpm b\u0303 m pm , (48)\nam \u2020\u03b1m =\u2211 pm a\u0303m\u2020pm W m pm\u03b1m. (49)\nThis means that\n[am\u03b1m , E\u0303 m pmqm] = U m \u03b1mpm b\u0303 m qm , (50)\n[E\u0303mpmqm , a m \u2020 \u03b1m ] =W m qm\u03b1m a\u0303 m \u2020 pm . (51)\nWe can, therefore, rewrite the essential commutator part of the mean-field expressions using\nH\u0306mO m (\u03b1mvm) = a\u0303 m \u2020 vm [am\u03b1m , h\u0302 mOm ] = a\u0303m \u2020\nvm \u2211 pmqm\nh\u0303mO m pmqm[a m \u03b1m , E\u0303 m pmqm]\n= a\u0303m \u2020 vm \u2211 pmqm h\u0303mO\nm\npmqm U m \u03b1mpm b\u0303 m qm\n=\u2211 qm\nU h\u030c\nmOm \u03b1mqm E\u0303 m vmqm , (52)\nH\u0306\u2032mO m (vm\u03b1m) = [h\u0302 mOm , a\u0303m \u2020\u03b1m ]a m vm =\u2211\npm\nW h\u030c\nmOm pm\u03b1m E\u0303 m pmvm. (53)\nHere, we have introduced one-mode integrals that are transformed halfway into the primitive basis,\nU h\u030c\nmOm \u03b1mqm =\u2211 pm Um\u03b1mpm h\u0303 mOm pmqm , (54)\nW h\u030c\nmOm wm\u03b1m =\u2211 qm Wmqm\u03b1m h\u0303 mOm pmqm. (55)\nNow, if Eqs. (36), (37), (50), and (51) are inserted into Eqs. (46) and (47), we can write the one- and two-mode Hamiltonian contributions to the mean fields as expectation values of effective operators. We thus obtain\nF\u030cm\u03b1mvm = \u27e8\u03a8\u0303 \u2032 \u2223H\u0306m1,(\u03b1mvm)\u2223\u03a8\u0303\u27e9 + \u27e8\u03a8\u0303 \u2032 \u2223H\u0306m2,(\u03b1mvm)\u2223\u03a8\u0303\u27e9, (56)\nF\u030c\u2032mvm\u03b1m = \u27e8\u03a8\u0303 \u2032 \u2223H\u0306\u2032m1,(vm\u03b1m)\u2223\u03a8\u0303\u27e9 + \u27e8\u03a8\u0303 \u2032 \u2223H\u0306\u2032m2,(vm\u03b1m)\u2223\u03a8\u0303\u27e9, (57)\nwith the mode-locked operators defined as\nH\u0306m1,(\u03b1mvm) =\u2211 Om CmOm H\u0306 mOm (\u03b1mvm), (58)\nH\u0306\u2032m1,(vm\u03b1m) =\u2211 Om CmOm H\u0306 \u2032mOm (vm\u03b1m), (59)\nH\u0306m2,(\u03b1mvm) = \u2211 m0<m m0>m \u2211 OmOm0 Cmm0OmOm0 H\u0306 mOm (\u03b1mvm)h\u0303 m0Om0 , (60)\nH\u0306\u2032m2,(vm\u03b1m) = \u2211 m0<m m0>m \u2211 OmOm0 Cmm0OmOm0 H\u0306 \u2032mOm (vm\u03b1m)h\u0303 m0Om0 . (61)\nIn accordance with Ref. 16, the contributions to the mean fields from H\u03021 can be computed efficiently from the density matrix as\nJ. Chem. Phys. 159, 204106 (2023); doi: 10.1063/5.0175506 159, 204106-7\nPublished under an exclusive license by AIP Publishing\n12 January 2024 17:00:20\nTABLE IV. Intermediates used to reduce computational scaling. Under the columns \u201cStorage\u201d and \u201cComputation,\u201d we list the theoretical scaling of the storage and computational efforts associated with each intermediate. Here, the quantities Mx , Ax , and Ox indicate the scaling with respect to the number of modes, time-dependent basis functions, and operator factors per mode related to the total number of terms (there are O2 terms for each of the M(M \u2212 1)/2 two-mode couplings), respectively.\nName Definition Storage Computation\nm0Om0 Xmam \u2211cm0 h\u0303 m0Om0 im0 cm0 s mm0 amcm0 M 2AO M2A2O m0Om0 Wmam \u2211cm0 h\u0303 m0Om0 cm0 im0 l mm0 amcm0 M\n2AO M2A2O m0Om0 (XL)mm0am \u2211m1\u2260{m,m0}\u2211cm1 m0Om0 Xm1cm1 l mm1 amcm1 M\n2AO M3A2O m0Om0 (WS)mm0am \u2211m1\u2260{m,m0}\u2211cm1 m0Om0 Wm1cm1 s mm1 amcm1 M\n2AO M3A2O (LS)m1m2 \u2211am1 bm2 l m1m2 am1 bm2 s m1m2 am1 bm2 M 2 M2A2 Umm0 \u2211m1<m2\u2260{m,m0} (LS) m1m2 \u2212\u2211m1<m2 (LS) m1m2 M2 M3 m0Om0 Vmm0 \u2211m1\u2260{m,m0}\u2211bm1 cm0 dm0 l m1m0 bm1 cm0 h\u0303 m0Om0 cm0 dm0 s m1m0 bm1 dm0 M\n2O M3A3O \u039bmm0 \u2211m1\u2260{m,m0}\u2211cm1 l mm1 amcm1 s mm1 bmcm1 M 2A2 M3A3 (ls)mm1amam1 \u2211m2\u2260{m,m1}\u2211bm2 s mm2 ambm2 l m1m2 am1 bm2 M 2A2 M3A3 m0Om0 \u039emm0am \u2211m1\u2260{m,m0} (\u2211am1 m0Om0 Xm1am1 (ls) mm1 amam1 )\n\u2212\u2211bm0 s mm0 ambm0 (\u2211m1\u2260{m,m0}\u2211am1 m0Om0 Xm1am1 l m1m0 am1 bm0 ) M 2AO M3A2O\n1M F\u030cm\u03b1mvm = \u27e8\u03a8\u0303 \u2032 \u2223H\u0306m1,(\u03b1mvm)\u2223\u03a8\u0303\u27e9 =\u2211 Om CmOm\u2211 wm U h\u030c\nmOm \u03b1mwm \u03c1 m wmvm\n= [ U H\u030cm1 \u03c1 m ]\n\u03b1mvm , (62)\n1M F\u030c\u2032mvm\u03b1m = \u27e8\u03a8\u0303 \u2032 \u2223H\u0306\u2032m1,(vm\u03b1m)\u2223\u03a8\u0303\u27e9 =\u2211 Om CmOm\u2211 wm W h\u030c mOm wm\u03b1m \u03c1 m vmwm\n= [\u03c1m W H\u030cm1 ] vm\u03b1m . (63)\nThe two-mode contributions to the mean fields can be written as\n2M F\u030cm\u03b1mvm = \u2211 m0<m m0>m \u2211 OmOm0 Cmm0OmOm0\u2211 wm U h\u030c\nmOm \u03b1mwm\n\u00d7 \u2211 tm0 um0\nh\u0303m0O m0 tm0 um0 \u27e8\u03a8\u0303 \u2032 \u2223E\u0303mvmwm E\u0303 m0 tm0 um0 \u2223\u03a8\u0303\u27e9, (64)\n2M F\u030c\u2032mvm\u03b1m = \u2211 m0<m m0>m \u2211 OmOm0 Cmm0OmOm0\u2211 wm W h\u030c mOm wm\u03b1m\n\u00d7 \u2211 tm0 um0\nh\u0303m0O m0 tm0 um0 \u27e8\u03a8\u0303 \u2032 \u2223E\u0303mwmvm E\u0303 m0 tm0 um0 \u2223\u03a8\u0303\u27e9. (65)\nThe two-mode part of the Hamiltonian is much more challenging compared to the one-mode part, as we now have two shift operators in our bra-ket expression, giving a set of two-mode density matrix elements. Because of this, non-zero second-order terms are now possible in the BCH expansion. We do not want to compute and store the potentially very large set of two-mode density matrix elements but rather seek to derive all terms and their explicit form. In Tables II and III, we have listed all the non-zero contributions to the two mean-field matrices, which can be realized\nby analyzing Eqs. (64) and (65) in the same way as discussed in Sec. II D 1. Table IV contains a list of intermediates that are used for the computations."
        },
        {
            "heading": "4. Intermediates for highly efficient mean-field equations",
            "text": "If one were to naively implement the mean-field equations as written in Sec. II D 3, the computational cost would scale as M4. This would be an order higher than the TDVCC[2] and timedependent vibrational configuration interaction with singles and doubles (TDVCI[2]) methods (with static modals). Luckily, we can circumvent this issue with the introduction of intermediates. Only a couple of intermediates are strictly necessary for bringing down the scaling exponent, but more have been introduced to bring down the absolute cost as well. We find some intermediates introduced in Refs. 53 and 54, but we will repeat them here for completeness and to account for slight changes in definition and/or notation. All intermediates used have been listed in Table IV with their definition, storage cost, and computational cost. In this table, Mx refers to the scaling with respect to the number of modes, Ax denotes the scaling with respect to the size of the active space, and Ox is the scaling with respect to the number of operator terms. Intermediates (ls)mm1amam1 and Umm0 are of particular importance, as they allow scaling to be reduced from M4 to M3.\nWe will now look at two intermediates in more detail. The first intermediate, which we will denote by \u039e, arises from contributions 11 and 23. Expanding contributions 11 and 23 from the compact notation in Tables II and III, one obtains several terms among which the following leads to the \u039e intermediate:\n\u2211 m1\u2260{m,m0} \u2211 m2\u2260{m,m0 ,m1} \u2211 am1 bm2\nm0Om0 Xm1am1 l m1m2 am1 bm2 s mm2 ambm2 . (66)\nJ. Chem. Phys. 159, 204106 (2023); doi: 10.1063/5.0175506 159, 204106-8\nPublished under an exclusive license by AIP Publishing\n12 January 2024 17:00:20\nIt can be seen that there are 4 mode indices (m, m0, m1, m2) giving the M4 scaling. We introduce the following quantity as an intermediate:\n(ls)mm1amam1 = \u2211 m2\u2260m,m1 \u2211 bm2 lm1m2am1 bm2 s mm2 ambm2 . (67)\nEquation (66) can now be written as\n\u2211 m1\u2260{m,m0}\n\u239b \u239d \u2211 am1 m0Om0 Xm1am1 (ls) mm1 amam1 \u239e \u23a0\n\u2212\u2211 bm0\nsmm0ambm0 \u239b\n\u239d \u2211 m1\u2260m,m0 \u2211 am1\nm0Om0 Xm1am1 l m1m0 am1 bm0 \u239e\n\u23a0 . (68)\nOnly three mode indices are now present (m, m0, m1) giving the scaling of M3. Of course, it is necessary to compute the intermediates, but this also scales as M3, requiring two computations with M3 scaling, which is much more favorable than one computation at M4 scaling. The second term contributing to the M4 scaling stems from contributions 7, 8, 11, 12, 15, 16, 23, and 24 and appears as\nUmm0 = \u2211 m1<m2\u2260{m,m0} (LS)m1m2 \u2212 \u2211 m1<m2 (LS)m1m2. (69)\nSince all the terms in the first summation are contained in the second, the first term is not computed, and it is a matter of checking when the combinations of mode indices result in something not contained in the first summation and then only compute and subtract these.\nAfter introducing these two intermediates (along with the remaining intermediates in Table IV), we can write the final meanfield equations to be computed as follows, with only M3 scaling cost,\nF\u030cm\u03b1mim = \u2211 m0<m m0>m \u2211 OmOm0 Cmm0OmOm0 \u23a7\u23aa\u23aa \u23a8 \u23aa\u23aa\u23a9 U h\u030c mOm \u03b1mim(h\u0303 m0Om0 im0 im0 + m0Om0 Vmm0\n+ h\u0303m0O m0 im0 im0 U mm0) +\u2211\nam\nU h\u030c\nmOm \u03b1mam m0Om0 Xmam(1 +U mm0)\n+\u2211 am\nU h\u030c\nmOm \u03b1mam m0Om0 (WS)mm0am +\u2211\nam\nU h\u030c\nmOm \u03b1mam m0Om0 \u039emm0am \u23ab\u23aa\u23aa \u23ac \u23aa\u23aa\u23ad , (70)\nF\u030cm\u03b1mam = \u2211 m0<m m0>m \u2211 OmOm0 Cmm0OmOm0 \u23a7\u23aa\u23aa \u23a8 \u23aa\u23aa\u23a9 U h\u030c mOm \u03b1mim m0Om0 Wmam\n+ h\u0303m0O m0\nim0 im0 \u2211 bm\nU h\u030c\nmOm \u03b1mbm \u039b mm0 + U h\u030c mOm \u03b1mim m0Om0 (XL)mm0am\n+\u2211 bm\nU h\u030c\nmOm \u03b1mbm \u2211 cm0 dm0 lm0mcm0 am h\u0303 m0Om0 cm0 dm0 s m0m dm0 bm \u23ab\u23aa\u23aa \u23ac \u23aa\u23aa\u23ad , (71)\nF\u030c\u2032mim\u03b1m = \u2211 m0<m m0>m \u2211 OmOm0 Cmm0OmOm0 \u23a7\u23aa\u23aa \u23a8 \u23aa\u23aa\u23a9 W h\u030c mOm im\u03b1m(h\u0303 m0Om0 im0 im0 + m0Om0 Vmm0\n+ h\u0303m0O m0 im0 im0 U mm0) +\u2211\nam\nW h\u030c\nmOm am\u03b1m m0Om0 Wmam\n+\u2211 am\nW h\u030c\nmOm am\u03b1m m0Om0 (XL)mm0am \u23ab\u23aa\u23aa \u23ac \u23aa\u23aa\u23ad , (72)\nF\u030c\u2032mam\u03b1m = \u2211 m0<m m0>m \u2211 OmOm0 Cmm0OmOm0 \u23a7\u23aa\u23aa \u23a8 \u23aa\u23aa\u23a9 W h\u030c mOm im\u03b1m m0Om0 Xmam(1 +U mm0)\n+ h\u0303m0O m0\nim0 im0 \u2211 bm\nW h\u030c\nmOm bm\u03b1m \u039b mm0 + W h\u030c mOm im\u03b1m m0Om0 (WS)mm0am\n+\u2211 bm\nW h\u030c\nmOm bm\u03b1m \u2211 cm0 dm0 smm0amdm0 h\u0303 m0Om0 cm0 dm0 l mm0 bmcm0 + W h\u030c mOm im\u03b1m m0Om0 \u039emm0am \u23ab\u23aa\u23aa \u23ac \u23aa\u23aa\u23ad .\n(73)"
        },
        {
            "heading": "5. The full active basis approach",
            "text": "The use of an active space smaller than the full space has been decisive for MCTDH and is obviously anticipated to be similarly advantageous for TDMVCC. However, it is of course an additional approximation that may give a basis set truncation error, and it gives rise to additional numerical steps, projections, etc. In the FAB limit, the time-evolving basis has solely the purpose of making the reference optimal, which is obviously a theoretically interesting limit. For these reasons, we consider the efficient implementation of using the full space as an active space to study advantages and disadvantages. In the limit where the primitive and time-dependent modal bases are equal in size, the EOMs simplify significantly, and we only need to compute the parts of the mean-field matrices necessary for computing the um vector. We see in Eq. (45) that this is simply the first column of both matrices. Expanding the right-hand side of Eq. (112) from Ref. 16,\nF\u0303\u2032mvmwm \u2212 F\u0303 m vmwm = \u27e8\u03a8\u0303 \u2032 \u2223[H\u0302, E\u0303mwmvm]\u2223\u03a8\u0303\u27e9, (74)\nsimilar to what was done in Secs. II D 1\u2013III D 4 results in terms with structure similar to the ones in Eqs. (70) and (72), but with fully transformed mean-field matrices rather than half-transformed ones. These two approaches are, of course, equivalent in the limit of no secondary modal space, but the implementation differs a bit as new efficient intermediates/transformations might become available.\nInitially, we had hoped for a very fast specialized implementation of this limit, but despite the apparent simplicity of the um vector equations, many expensive terms remain to be computed, and the approach still scales as M3."
        },
        {
            "heading": "E. Hybrid TDMVCC/TDH scheme",
            "text": "In this section, we present a computational scheme introduced for obtaining an important computational limit that opens up for efficient calculations of large systems. The idea is to apply TDMVCC in the usual way for a selected set of important modes and then only have a single active time-dependent modal for the rest. Therefore, we restrict these modes to stay in the reference modal. In this way,\nJ. Chem. Phys. 159, 204106 (2023); doi: 10.1063/5.0175506 159, 204106-9\nPublished under an exclusive license by AIP Publishing\n12 January 2024 17:00:20\nwe obtain a TDMVCC/TDH hybrid scheme where we do not ignore less important modes, as may be a more standard approach. Instead, they are included in a simplified way, which makes the computations significantly faster compared to TDMVCC[2]. We denote the modes with the simplified treatment as TDH modes but emphasize that their mean fields will be different from the pure TDH mean fields due to the TDMVCC modes. Therefore, one can state that the ket state of the system can be written like\n\u2223\u03a8\u0304\u27e9 = e\u2212i\u03f5eT TDMVCC\n\u220f m\u2208MCTDMVCC a\u0303m \u2020im \u220f m\u2208MCTDH a\u0303m \u2020im \u2223vac\u27e9. (75)\nThe speedup achieved by TDMVCC/TDH is shown by the fact that we can skip certain parts of the calculations involved in solving the EOMs as these TDH modes do not have any virtual modals. For example, we see this effect in the density matrices and the meanfield matrices. The density matrix for a TDH mode reduces to a 1-by-1 matrix with the element 1, as can be seen in Eqs. (39) and (40). The mean-field matrices for the TDH modes reduce to a vector with very few contributions, as seen in Eqs. (70) and (72), where the intermediates with a virtual modal index do not contribute.\nThis approach will be explored further with numerical results in Sec. III C, where we utilize it to do computations on a 39- mode potential-energy surface (PES) (coupled at the two-mode level) describing benzoic acid. We will also denote this method as TDMVCC[2\u2223X], where X denotes the number of modes propagated at the TDMVCC level. We note that TDMVCC[2\u22230] will occasionally be named the TDH limit."
        },
        {
            "heading": "III. NUMERICAL RESULTS",
            "text": "The described methods have been implemented in the Molecular Interactions, Dynamics And Simulations Chemistry Program Package (MidasCpp).58 All computational results presented in the following have been obtained with this implementation. The\nimplementation builds upon our previous TDMVCC works16,17 and exploits the same equation solvers, integrators, etc., including the same SVD regularization of the density matrix inverse.\nWe will henceforth use the following nomenclature for the three TDMVCC[2] schemes that are considered in this paper: (i) hybrid TDMVCC[2] (or TDMVCC[2\u2223X]) denotes the scheme where only a subset of modes is treated at the TDMVCC level; (ii) FAB TDMVCC[2] denotes the implementation that has been optimized to run with an equal number of time-dependent and time-independent modals (A = N); and (iii) TDMVCC[2] (with no further qualifiers) denotes the basic scheme where all modes are treated at the TDMVCC level and where the optimized FAB implementation is not used (even if A = N)."
        },
        {
            "heading": "A. Mode scaling",
            "text": "Theoretically, we found the scaling of the mean fields with respect to the number of modes in the system to be M3. The scaling of the implementation of the mean field computation has been tested with calculations on 12 PAHs systems, with the number of modes ranging from 102 to 192 using pre-computed two-mode PESs.22,53 To get representative numbers, we have averaged over 96 evaluations of the mean-field matrices. A b-spline basis was used as the primitive basis, with bounds at the 10th classical turning point. For the modals, we used the 5 lowest-lying VSCF modals as our stationary basis and then 5 time-dependent modals for Fig. 1, which is sufficient for investigating the scaling of the method with respect to the number of modes. The PESs have a relatively large number of terms (in the range of 59 000\u2013122 000) and are thus representative of real PESs. Obviously, absolute timings would be even more favorable with simple few-term model potentials.\nIn Fig. 1, the computational times for different parts of the TDMVCC method have been plotted. The timings for the \u03c9H\u0302 and \u03b7H\u0302 vectors (Refs. 53 and 54) have also been plotted to give a sense of absolute times.\nJ. Chem. Phys. 159, 204106 (2023); doi: 10.1063/5.0175506 159, 204106-10\nPublished under an exclusive license by AIP Publishing\n12 January 2024 17:00:20\nFrom Fig. 1, we see that a theoretical scaling proportional to M3 fits rather nicely with the data for the computation of the total mean-field matrices. We see that mean-field computations are the major computational task, even after our significant optimizations.\nIn Fig. 2, we show the scaling of four different computational schemes for TDMVCC and, for comparison, two different versions of TDH. For TDMVCC, we show the approach where all modes are propagated at the TDMVCC level, two different hybrid approaches where (i) a fixed number of 10 modes are propagated at the TDMVCC level while the rest are kept at the TDH level; (ii) 15% percent of the modes propagated at the TDMVCC level; and (iii) the limit where all modes are propagated at the TDH level. These results are also run on PAH systems with a range of sizes. Note that the PESs for these timings have been trimmed, keeping only the five lowest-order coupling terms so that the number of coupling terms is the same for each mode combination (MC). This was performed as the number of coupling terms in the PESs does not increase as a simple polynomial as a function of the number of modes, giving spurious fitting for the results shown in Fig. 2. From Fig. 2, we see that the TDMVCC[2\u2223X] scheme is computationally very attractive, as the computational times of the TDMVCC method can be significantly reduced if the important dynamics is located in a small subset of modes. This is especially true if the number of dynamically important modes does not change with respect to the system size. Therefore, we can obtain reductions in both absolute cost and in scaling of cost with system size. While TDMVCC[2] and TDMVCC[2\u2223X] have similar scalings of third order (3.17 and 3.13 are considered similar within noise), when X is increased proportionally to the system size, there are significant gains in absolute speed. When X is constant, we additionally observe a reduction in\nscaling. It can be seen that the TDMVCC[2\u222310] method scales as M2, just as the TDH method. That is, the 10 modes propagated at the TDMVCC level simply result in a prefactor. If the number of dynamically important modes is not independent of the system size but still located in a subset of the total modes, we end up with the M3 scaling as the number of modes propagated at the TDMVCC level increases. Importantly, this is at a significantly reduced cost compared to propagating all modes at the TDMVCC level.\nIn the limit where all modes are propagated at the TDH level, we see, despite a lot of logical TDMVCC overhead, that the implementation recovers the M2 scaling of TDH.21 The explicit TDH code clearly runs faster still, with the exponentially parameterized TDH as the clear winner. It is an opportunity for future research to implement TDMVCC[2] with exponentially parameterized modals18 and recover this efficiency gain. However, very large systems and small TDMVCC[2] domains must be considered for this additional gain to be significant."
        },
        {
            "heading": "B. Basis size scaling",
            "text": "Here, we investigate the scaling of the method with respect to the basis set size. The setup is very similar to the above-mentioned computations; we have here limited the computations to PAH systems with 48, 66, and 84 modes, and we only look at the timings for constructing the mean fields as these are the most important factors, as shown in Fig. 1. The basis scaling results have been plotted in Fig. 3. For TDMVCC[2], we have fixed N = 50 and then varied A. Additionally, we have plotted the same results obtained from a FAB computation (N = A \u2264 50).\nFor basis sets larger than 10, we see a reasonable fit to roughly A3. This meets our expectations since there are several terms scaling as M3A3, as listed in Table IV.\nIn the FAB (A = N) limit, we see a decrease in computing time. We found the computing time for the TDMVCC[2] implementation to be 1.2\u20131.6\u00d7 slower than the specialized FAB implementation, depending on the system size and the basis size (large basis sets gave a larger difference while large systems gave a smaller difference). One, of course, has to hold this up against the quality of the result: The FAB implementation can, of course, only be used in the N = A limit, which often yields poor results for realistic values of N. Furthermore, an important point of TDMVCC is that it is not\nJ. Chem. Phys. 159, 204106 (2023); doi: 10.1063/5.0175506 159, 204106-11\nPublished under an exclusive license by AIP Publishing\n12 January 2024 17:00:20\nnecessary to use N = A to obtain good results, and often N can be significantly larger than A. Therefore, the FAB option is mainly of interest from a theoretical point of view. We foresee that the restricted polar parameterization in combination with a small active space will be used in applications.\nC. IVR for benzoic acid To explore further the numerical behavior of TDMVCC[2] and the quality of the TDMVCC[2\u2223X] method, we present some results on the benzoic acid molecule (39 modes). The PES was obtained using the adaptive density-guided approach (ADGA)59 procedure in MidasCpp58 and the GFN2-xTB method60 in the xTB program for computing cheap single points in these exploratory computations. ADGA settings are given in the supplementary material, and the final PES has 35 956 terms. The dynamics of the benzoic acid molecule is initialized by using a VSCF state with the mode describing the acid O\u2013H stretch in the first excited state (described by the v = 1 modal) computed on an uncoupled PES and then letting this state relax in the coupled PES.\nIn Fig. 4, the expectation value of the displacement coordinate describing the O\u2013H stretch in the acid group (Q38) is plotted as a function of time. Coordinates Q32 and Q22 are also shown for comparison. As a reference method, we use TDMVCC[2\u222339] (also simply named TDMVCC[2]), where all modes are described at the coupled cluster level. Each mode has an active basis of four timedependent modals. We compare the reference calculation with linear\nTDH and with the hybrid TDMVCC[2\u2223X] method with X = 8, 13, 18. The modes to be propagated at the TDMVCC[2] level were chosen by visual inspection (modes dominated by motion localized in the acid group were prioritized). The manual selection approach was taken here for simplicity, but developing automatic procedures for dividing modes into subsets with different levels of treatment will be attractive for future applications of the methodology. A table is given in the supplementary material listing the specific modes used in the different hybrid schemes. Expectation values are generally defined as \u27e8\u03a8\u0304 \u2032\u2223O\u0302\u2223\u03a8\u0304\u27e9 for an operator O\u0302. However, in the simple case of a one-mode operator O\u0302 m, this expression specializes to \u2211rmsm O\u0303 m rmsm \u03c1 m smrm , which adds no significant additional cost to the computations. It is clear that increasing X ensures that the expectation values converge towards the TDMVCC[2] limit, where all modes are treated at the coupled cluster level. We also note that if one wants to do computations on a very large system, the computational cost can be significantly reduced by the hybrid approach, and the results are qualitatively very similar. Another observation is that the hybrid approach is much better than TDH. This is found in Fig. 4 for the modes that are TDMVCC modes for all the X, but it is in fact also the case for the TDH-modes part, as documented and discussed in the supplementary information. This underlines that the so-called TDH part is described beyond the TDH level in the sense that the contributions from TDMVCC modes to mean fields are improved compared to TDH for these modes.\nJ. Chem. Phys. 159, 204106 (2023); doi: 10.1063/5.0175506 159, 204106-12\nPublished under an exclusive license by AIP Publishing\nFIG. 5. Comparison of the hybrid TDMVCC[2\u2223X] method and reduced dimension PESs for the benzoic acid molecule. The TDMVCC[2\u222339] computation corresponds simply to TDMVCC[2], i.e. all modes are included as TDMVCC modes.\nTo show that the hybrid method is favorable compared to a computation with frozen modes (i.e., a computation in reduced dimensionality), we have performed a number of calculations where the less important modes have been frozen completely instead of being included as TDH modes. The computational settings are identical to those in Fig. 4, and the results are shown in Fig. 5. We now only show the results for the O\u2013H stretch (Q38) and only the last 1000 time units to make it easier to distinguish between the results. It is seen that both schemes converge towards the TDMVCC[2] results, but that the hybrid schemes do so with a lower number of TDMVCC modes. We also note in passing that the convergence is not always straightforward, something we mainly ascribe to the manual mode selection.\nThe results for the hybrid TDMVCC[2\u2223X] approach are clearly better, but this of course comes with a more time-consuming calculation. In Table V, the approximate timings for several computations shown in Figs. 4 and 5 are listed. The propagation time is 5000 a.u., corresponding to about 120 fs. So far, the implementation only allows for serial calculations, which is an obvious area for improvement in future work.\nTABLE V. Absolute timings of computations presented in Figs. 4 and 5.\nCalculation name Time\nTDH: 2 h Frozen PES (8M): 1.7 h Frozen PES (13M): 6 h Frozen PES (18M): 15 h TDMVCC[2\u22238]: 17 h TDMVCC[2\u222313]: 1.4 days TDMVCC[2\u222318]: 1.8 days TDMVCC[2\u222339]: 7.5 days"
        },
        {
            "heading": "IV. SUMMARY AND OUTLOOK",
            "text": "This work presents the first efficient implementation of the TDMVCC method. Focusing on the two-mode coupling level, all detailed equations were derived and implemented by hand. We showed that the computational cost of TDMVCC[2] can be reduced to cubic scaling with respect to the number of degrees of freedom by introducing appropriate intermediates. Specializations were made, allowing efficient and flexible usage of both full active basis sets and basis sets limited to only a few active basis functions per mode. The latter allows for a hybrid TDMVCC/TDH approach that has an even lower quadratic computational scaling as long as the set of TDMVCC modes is kept constant and only the number of TDH modes is extended. The resulting low order scaling was illustrated for PAHs with up to 264 modes, and the gain of TDMVCC/TDH hybrid computations compared to simply freezing some degrees of freedom was illustrated in computations on a 39-mode benzoic acid PES.\nThe ability to perform these high-dimensional computations shows how TDMVCC may open the door for accurate quantum dynamical studies on systems that were previously out of reach. The hybrid methods introduced further open a new line of research where TDMVCC computations can be tailored to balance accuracy, efficiency, and feasibility in quantum dynamical computations.\nThe work presented here is only the first step in making TDMVCC more generally applicable. In many cases, the present two-mode version will not be sufficiently accurate, and higher-level TDMVCC and higher-level couplings in the Hamiltonian will be important. This includes flexible multi-reference schemes along the lines of recent work on MR-MCTDH[n].32 For example, the quantum dynamics of vibronic coupling Hamiltonians is one area of application where researchers have often been satisfied with Hamiltonians having only two-mode couplings. However, in such studies, there are (at least) two electronic states. Using a single basis set\nJ. Chem. Phys. 159, 204106 (2023); doi: 10.1063/5.0175506 159, 204106-13\nPublished under an exclusive license by AIP Publishing\n12 January 2024 17:00:20\nformulation as in the present work, it would be attractive (from an accuracy point of view) to use a flexible multi-reference scheme treating the electronic degree of freedom as a special coordinate along the lines of our recent MR-MCTDH[n] work. This would formally include selected 3M couplings and is thus not currently covered by the present implementation. However, if the hybrid TDMVCC[2\u2223X] approach developed here can be combined with a multi-state treatment, we believe it would offer a fast, low-scaling methodology for vibronic problems. An obvious alternative would be to develop a multi-set approach where each electronic state has its own TDMVCC[2\u2223X] expansion with separate non-orthogonal basis sets. Both options require significant further development. Implementing higher-level TDMVCC methods must generally be considered a very hard problem, as higher-order TDMVCC methods with higher-order Hamiltonians include numerous terms (on the order of many thousands).5 For TDVCC (with static modals), it has been possible to make a general implementation5 with welldefined low-order polynomial scaling of the computational effort by utilizing existing machinery for automatic derivation, analysis, and computation of all terms that appear in the equations. However, TDMVCC contains new types of terms (particularly in the mean fields) that fall outside the scope of our current code base. The present work has shown that it is possible and important to construct certain appropriate intermediates to obtain low-order computational scaling. This work, therefore, paves the way for and encourages the laborious work on general machinery for implementing general order TDMVCC and general order TDMVCC/TDH hybrids.\nSUPPLEMENTARY MATERIAL\nThe supplementary material contains information regarding the ADGA computations performed for obtaining the benzoic acid PES used in Sec. III as well as files for the used PESs. It also contains an overview of all modes in the benzoic acid molecule, their harmonic frequencies, and whether they are treated at the TDMVCC or the TDH level in hybrid computations."
        },
        {
            "heading": "ACKNOWLEDGMENTS",
            "text": "O.C. acknowledges support from the Independent Research Fund Denmark through Grant No. 1026-00122B. All calculations were performed on the high performance computing cluster of the Center for Scientific Computing Aarhus. This work was supported by the Danish National Research Foundation through the Center of Excellence for the Chemistry of Clouds (Grant Agreement No. DNRF172).\nThe authors acknowledge Jonas Elm and the Independent Research Fund Denmark for financial support via Grant No. 9064-00001B.\nAUTHOR DECLARATIONS Conflict of Interest\nThe authors have no conflicts to disclose.\nAuthor Contributions\nAndreas Buchgraitz Jensen: Conceptualization (equal); Data curation (lead); Formal analysis (equal); Investigation (lead); Software (lead); Visualization (lead); Writing \u2013 original draft (equal); Writing \u2013 review & editing (equal). Mads Greisen H\u00f8jlund: Conceptualization (equal); Formal analysis (equal); Writing \u2013 original draft (equal); Writing \u2013 review & editing (equal). Alberto Zoccante: Conceptualization (equal); Formal analysis (equal); Writing \u2013 original draft (equal); Writing \u2013 review & editing (equal). Niels Kristian Madsen: Conceptualization (equal); Formal analysis (equal); Software (supporting); Writing \u2013 original draft (supporting); Writing \u2013 review & editing (equal). Ove Christiansen: Conceptualization (equal); Formal analysis (equal); Project administration (lead); Supervision (lead); Writing \u2013 original draft (equal); Writing \u2013 review & editing (equal).\nDATA AVAILABILITY The data that support the findings of this study are available from the corresponding author upon reasonable request."
        }
    ],
    "title": "Efficient time-dependent vibrational coupled cluster computations with time-dependent basis sets at the two- mode coupling level: Full and hybrid TDMVCC[2] \ue904",
    "year": 2024
}
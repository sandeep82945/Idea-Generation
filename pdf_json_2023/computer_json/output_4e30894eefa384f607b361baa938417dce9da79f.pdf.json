{
    "abstractText": "In this article, we present the design of a smart electrostimulator for muscle rehabilitation or reinforcement, using fast computations, in order to control the muscular force. The Ding and al. model allows to predict and to optimize the muscular force response to functional electrical stimulation. [1]. We analyze the estimation of the Ding and al. parameters using an approximation of the force response [6] which depends upon the 6 parameters of the Ding\u2019s model and we derive optimization scheme which bypass the time computational expensive integration of the dynamics of the Ding and al. equations.",
    "authors": [
        {
            "affiliations": [],
            "name": "Sandrine Gayrard"
        }
    ],
    "id": "SP:86de05adc4c23394ac30385b8e2c7ee3e832e13d",
    "references": [
        {
            "authors": [
                "J. Ding",
                "A.S. Wexler",
                "S.A Binder-Macleod"
            ],
            "title": "Development of a mathematical model that predicts optimal muscle activation patterns by using brief trains",
            "venue": "J. Appl.Physiol., vol. 88",
            "year": 2000
        },
        {
            "authors": [
                "E. Wilson"
            ],
            "title": "Force response of locust skeletal muscle",
            "venue": "Southampton University, Ph.D. thesis",
            "year": 2021
        },
        {
            "authors": [
                "T. Bakir",
                "B. Bonnard",
                "L. Bourdin",
                "J. Rouot"
            ],
            "title": "Pontryagin-type conditions for optimal muscular force response to functional electrical stimulations",
            "venue": "J. Optim. Theory Appl.",
            "year": 2020
        },
        {
            "authors": [
                "T. Bakir",
                "B. Bonnard",
                "L. Bourdin",
                "J. Rouot"
            ],
            "title": "Direct and indirect methods to optimize the muscular force response to a pulse train of electrical stimlation",
            "venue": "ESAIM : Proceedings and Survey, EDP Sciences, vol. 71",
            "year": 2021
        },
        {
            "authors": [
                "B. Doll",
                "N. Kirsch",
                "N. Sharma"
            ],
            "title": "Optimization of a stimulation train based on a predictive model of muscle force and fatigue",
            "venue": "IFAC- PapersOnLine, vol. 48(20)",
            "year": 2015
        },
        {
            "authors": [
                "T. Bakir",
                "B. Bonnard",
                "S. Gayrard",
                "J. Rouot"
            ],
            "title": "Finite Dimensional Approximation to Muscular Response in Force-Fatigue Dynamics using Functional Electrical Stimulation",
            "venue": "Automatica",
            "year": 2022
        },
        {
            "authors": [
                "J. Ding",
                "A.S. Wexler",
                "S.A Binder-Macleod"
            ],
            "title": "Two-step",
            "venue": "predictive, isometric force model tested on data from human and rat muscles, J. Appl.Physiol., vol. 85",
            "year": 1998
        },
        {
            "authors": [
                "J. Ding",
                "A.S. Wexler",
                "S.A. Binder-Macleod"
            ],
            "title": "A predictive model of fatigue in human skeletal muscles",
            "venue": "J. Appl. Physiol., 89",
            "year": 2000
        }
    ],
    "sections": [
        {
            "text": "I. INTRODUCTION\nA. Industrial Project\nThe aim of the study project is the design of a smart electrostimulator, in the isometric case (without displacement of the muscle), for muscle rehabilitation or reinforcement based, in particular, on modern sensors and fast computations using embedded electronics. The idea is to design training programs to track a force of reference [5] or to maximize the muscular force. Each training program can be converted into an optimization problem. The mathematical equations presented below are the tools to the design of this smart electrostimulator."
        },
        {
            "heading": "B. Mathematical equations",
            "text": "The Ding and al. model [1] allows to predict and to optimize the muscular force response to functional electrical stimulations and was validated experimentally [2]. The system is described as follow.\nThe input u of a pulse train is defined, for t \u2208 [0,T ], by: u(t) = \u2211ni=0 \u03b4 (t \u2212 ti), with 0 = t0 < t1 < \u00b7 \u00b7 \u00b7< tn < T the impulse times with n \u2208N fixed. This physical control allows us to obtain the signal E(t), which permits to calculate the force response following a train of electrical pulses. The dynamics is given by (1) :\nE\u0307(t)+ E(t) \u03c4c = 1 \u03c4c\nn\n\u2211 i=0 \u03b7iRi\u03b4 (t \u2212 ti), (1)\nwith E(0) = 0, and depending on the response time \u03c4c and the function Ri defined by Ri = 1 if i = 0 and Ri = 1+(R0\u2212 1)exp(\u2212 ti\u2212ti\u22121\u03c4c ) elsewhere . It allows the visualization of the tetany phenomenon, which corresponds to the memory of the effect of successive pulses. \u03b7i is the amplitude of the electric pulse stimulation.\n*This work was supported by Segula Matra Technologies organization, Trappes (France)\n1PhD student, Burgundy Unviversity of Dijon (France), INRIA McTAO (France) sandrine.gayrard@inria.fr\nThe FES (Functional Electrical Stimulation) signal allows to determine the evolution of electrical conduction as a function of the dynamics describing the evolution of the concentration cN of the calcium ions (Ca2+), which plays an important role in muscle contraction.\nc\u0307N(t)+ cN(t)\n\u03c4c = E(t) (2)\nThe others equations of the Ding and al. model are described below and provide the muscular force response.\nm1(t) = cN(t)\nKm + cN(t) , m2(t) = 1 \u03c41 + \u03c42 m1(t) , (3)\nwith m1 the Michaelis-Menten (1913) function. The muscular force response satisfied the Hill-Huxley\u2019s models dynamics.\nF\u0307(t) =\u2212m2(t)F(t)+m1(t)A, (4)\nwith \u03c4c,R0,A0,Km,\u03c41,\u03c42 the set of parameters described in [1]."
        },
        {
            "heading": "C. Motivation",
            "text": "The controls are the frequency and amplitudes of the electrical stimulations. They fit in the sampled-data control category [6]. The goal is to maximize the force response or to track a force of reference [5].\nIn previous references [3], [4] the problem was analyzed using direct or indirect optimal control schemes which are computationally expensive due to the numerical integration of the dynamics. In a more recent work we derive an approximation of the force response in [6] which depends upon the 6 parameters of the Ding\u2019s model and which can be used to derive a fast optimization scheme in this category by bypassing the time computational expensive integration of the dynamics."
        },
        {
            "heading": "II. APPROXIMATION OF THE MUSCULAR FORCE RESPONSE TO FES",
            "text": "We present a brief recap of the [6]. We derive an approximation of the force response, which gives an explicit form of the dynamics of the force as a function of time.\n1) Definition 1: The muscular force, with F(0) = 0, is defined in [tk, tk+1], k = 0, . . . ,n, by\nF(t) = A0M(t) \u222b t\n0 M\u22121(s)m1(s)s, (5)\nwith M(t) = exp ( \u2212 \u222b t\n0 m2(s)s\n) .\nWe define a finer partition of (ti)1\u2264i\u2264n noted (ti+ j/p), i = 0, . . . ,n, j = 0, . . . , p\u22121, with p \u2208N\u2217 the number of the new points inserted between ti and ti+1. Using (5), we construct the approximation of the force F on [tk+ j/p, tk+( j+1)/p], k = 0, . . . ,n, j = 0, . . . , p\u22121, by : F(t)\u2248 A0 M\u0303(t) \u222b t\n0 M\u0303\u22121(s)m\u03031(s)s, \u2200t \u2208 [tk+ j/p, tk+( j+1)/p],\nwith M\u0303(t) = exp ( \u2212 \u222b t\n0 m\u03032(s)s\n) , et m\u0303i, i = 1,2 an approx-\nimation of mi defined by :\nm\u0303i(t) = ai j,k (t \u2212 tk+ j/p)+bi j,k, for t \u2208 [tk+ j/p, tk+( j+1)/p]\nand k = 0, . . . ,n, j = 0, . . . , p\u22121. The constants ai j,k,bi j,k, j = 0, . . . , p\u2212 1 are calculed at specific times, depending on the choice on the approximation of mi.\nAs m\u03072 = \u03c42m\u03071/(\u03c41 + \u03c42m1)2, then m\u03072 is equal to 0 when cN is maximal. On [tk, tk+1], m2 can be approximated by m\u0303k2(t) = ai j,k (t\u2212tk+ j/2)+bi j,k, k = 0, . . . ,n and j = 0,1, with tk+1/2 = argmax\nt\u2208[tk,tk+1] c\u0303N(t). By calculation, we end up with\nai j,k = mki (tk+1/2)\u2212mki (tk)\ntk+1/2 \u2212 tk , bi j,k = mki (tk).\n2) Proposition 1: The approximation of the muscular force F on [tkt+ jt/p, tkt+( jt+1)/p], kt = 0, . . . ,n, jt = 0, . . . , p\u22121 is given by :\nF\u0303(t)/A0 = kt\u22121\n\u2211 i=0\np\u22121 \u2211 j=0 \u222b ti+( j+1)/p ti+ j/p M\u0303(t)M\u0303\u22121(s) m\u03031(s)s\n+ jt\u22121\n\u2211 j=0 \u222b tkt+( j+1)/p tkt+ j/p M\u0303(t)M\u0303\u22121(s) m\u03031(s)s\n+ \u222b t\ntkt+ jt /p M\u0303(t)M\u0303\u22121(s) m\u03031(s)s.\n(6)\n3) Proposition 2: From a practical point of view, we just need to estimate the values of the force F for tk+ j/p, which gives :\nF\u0303(tk+ j/p)/A0 = k\u22121\n\u2211 i=0\np\u22121 \u2211 j=0 \u222b ti+( j+1)/p ti+ j/p M\u0303(tk+ j/p)M\u0303 \u22121(s) m\u03031(s)s\n+ j\u22121\n\u2211 j=0 \u222b tk+( j+1)/p tk+ j/p M\u0303(tk+ j/p)M\u0303 \u22121(s) m\u03031(s)s\n(7)"
        },
        {
            "heading": "III. SMART ELECTROSTIMULATOR",
            "text": "A. Industrial Project\nLet\u2019s remind that the goal is the design of smart electrostimulator for muscle rehabilitation or reinforcement, using modern sensors and fast computations using embedded electronics, in order to control the muscular force [5]."
        },
        {
            "heading": "B. Materials and methods",
            "text": "The measurements of the muscular force were carried out under isometric conditions, i.e. without displacement of the muscle. The measurements were performed at the biceps brachii (BB) level. The stimulation protocol and data acquisition are also presented. The subject is placed on an adjustable chair. His/her arm is placed on a L-shaped platform so that the arm is in a 90 degree position and the chair is adjusted so that the arm is completely on the platform and is \u201dglued\u201d to it to allow stabilization with a strap hooked around the biceps. The experimental setup is presented Fig. 2.\n1) Sensor: The force sensor is an FSR sensor (ref : Interlink Eletronics FSR 402, 406). The resistance of the sensor decreases as the force applied to its surface increases. The pressure sensor is placed between the strap and the\nbiceps, in such way that when the biceps contracts, the biceps compresses the sensor, in a perpendicularly direction.\nThe range of force sensitivity varies according on the chosen model. The sensor is connected to an Arduino UNO to sample the output voltage and to process it.\nFinally, a premilinary calibration to grade the relation between the sensor output voltage and the induced force, is performed.\n2) Stimulation: Electrical stimulation is provided by a commercial electrostimulation device (ref : Beurer EM 49 Digital TENS/EMS unit, see Fig. 2) designed for EMS (Electrical Muscle Stimulation) to promote muscle regeneration. Its adjustable parameters are the duration of the stimulation train tstim (fixed at 15 ms), the duration of rest trest (fixed at 10ms), the width of the pulse (fixed at 150\u00b5s). The stimulation frequency f is chosen according to the objective of the experiment and the amplitude is modifiable during the experiment, as the controls."
        },
        {
            "heading": "C. Data acquisition",
            "text": "During the muscle contraction, determined by its stimulation amplitude, the biceps compresses the force sensor. Isometric force is sampled at a sampling rate of 1kHz and recorded through a serial port driven by a Matlab program."
        },
        {
            "heading": "D. Training program : algorithm",
            "text": "Each training program can be translated into an optimization problem. The several steps are described below and resumed in Fig. 3\n\u2022 A succession of pulse trains is send to the biceps. Each train (of frequency f ) lasts tstim and is followed by a rest time of trest . \u2022 During the pulse train sent to the biceps, the sensor measures the induced force. \u2022 At the end of the pulse train, the resting time starts. During this resting time, the force measurements are recovered and processed, by a Matlab program running on a standard computer. \u2022 The force model parameters are estimated by fitting the measured data to the force prediction model described by the muscle force approximation. \u2022 From the force prediction model and the parameters estimated before, the optimal control is calculated according to an optimization problem that allows to track a force of reference or to maximize the muscular force. \u2022 This new calculated optimal command is then applied to the muscle during the next impulses train, at the end of the resting time.\nThe two main parts are : 1) the muscle parameter\u2019s estimation; 2) the computation of the optimal control, using the approximation model force. They are both computed during the resting time trest , which reinforces the need for fast computations."
        },
        {
            "heading": "IV. ESTIMATION OF THE DING AND AL. PARAMETERS",
            "text": "The muscle parameters of each person are estimated during the resting periods with low frequency stimulation using the piezoelectric force sensor.\nA. Data-fitting\n1) Model: The explicit form of the force approximation gives the force in terms \u03b1 a set 6 parameters of Ding and al. More precisely, (7) gives the approximation of the force in terms of a set \u03b1 of 6 parameters and tk+ j/p with k = 0, . . . ,n (n number of pulses during the train), j = 0, . . . , p\u2212 1 and p \u2208 N\u2217 the number of the new points added between tk and tk+1. \u03b1 = [\u03c4c,R0,A0,Km,\u03c41,\u03c42].\n2) Data: Force data were recorded using the experimental set-up. The input, a nth pulse train with a stimulation frequency f gives the muscular response with as many bounces as pulses. For each bounce k, the average value is calculated using the data value Fdata :\nF\u0304[tk,tk+1] = 1\ntk+1 \u2212 tk \u222b tk+1 tk Fdata(t)dt (8)\nThe vector of data force, which is going to be used to fit the model and estimate the 6 parameters of Ding and al. can be written for each impulse k \u2208 [1,n\u22121] by Fdata\u2212 f it = [Fdata(tk), F\u0304[tk,tk+1]] (9) and is represented Fig. 4.\nFdata\u2212 f it = [Fdata(t1), F\u0304[t1,t2], . . . ,Fdata(tn\u22121), F\u0304[tn\u22121,tn]] (9)\nAll the information of the model (the 6 parameters) is contained in the muscular response of the impulse train of size n. However, because of too high calculation time, only the muscular response to 5 or 6 impulses is taken into account, thus requiring a compromise between amount of information and computing time.\n3) Cost Function: Each value of Fdata\u2212 f it fits the model F(tk+ j/p) which corresponds to the approximation force calculated for each impulse time tk and for tk+ j/p, the intermediate times between 2 pulses (see Fig. 4). For k \u2208 [1,n], the values Fdata(tk) fit F\u0303(tk) and the values F\u0304[tk,tk+1] fit F\u0303(tk+ j/p) (p = 2 and j = 1).\nThe cost function to minimize is described below :\nJ(\u03b1) = N\n\u2211 i=1 \u2225F\u0303i(tk+ j/p,\u03b1)\u2212Fi,data\u2212 f it\u222522 (10)\nwith F\u0303 the approximation force that fits the values of force Fdata\u2212 f it . \u03b1 = [\u03c4c,R0,A0,Km,\u03c41,\u03c42]. N the size of the data and the fit vectors (N = n.p)."
        },
        {
            "heading": "B. Practical estimation",
            "text": "1) Computation: The use of a non-linear solver, helps to solve non-linear curve fitting problems of the form m\n\u03b1 inJ(\u03b1)\nwith \u03b1 the elements and \u03b10 the initial vector of the parameters. The solver starts at \u03b10 and attempts to find a local minimum \u03b1 of the function described by J.\nThe associated problem is solved using a quasi-newton method, with Matlab [7], on a standard computer. We initialize the parameters with the Ding and al. parameters [1].\n2) Experimental results: The estimated parameters are calculated for one subject with 4 different frequencies and various amplitudes. They are given in Fig. 6 and in Table I. For each frequency, identical stimulation have be send to the muscle BB and the parameters have been estimated for each train : the represented values correspond to the average values calculated using all the data, for each frequency. The corresponding curves for 3 various frequencies are depicted Fig. 5.\n3) Observation and discussion: The errors between measured data Fdata\u2212 f it and predicted force values increase at lower pulse frequencies because the approximating force model considers force at a given time tk+ j/p but does not take into account the dynamic behavior of the force with bounces, whose peak-to-peak amplitude increases for lower frequency.\nThe parameters \u03c4c, R0, \u03c41 and \u03c42 show a standard deviation with the Ding and al. parameters, respectively less than 26%, 3%, 12% and 1.5%. The difference appears for the parameters Km and A0 with standard deviations greater than 50% and increases with the frequency of stimulation.\nThese two parameters correspond to the non-fatigued model. The experimental results show difficulties to predict results depending on the muscle fatigue. The biceps can be subjected to a significant effort without the subject having performed it, thus disturbing the measurements. Sources of error can be a lack of hydration, general fatigue or skin\u2019s condition. To overcome this problem, it is necessary to multiply the experiments, on the same subject and on other subjects.\nThe difference obtained with the parameter A0 with the Ding\u2019s values comes from the fact that the latter depends on\nthe calibration of the force measurements. It is important to note that Ding et al. performed experiments mainly on the quadriceps. [8] shows that parameters varied with muscle length and fatigue.\nA statistical analysis was done to understand the difference in data for each group of parameters for different frequencies. Using an R algorithm and after checking that the measurements fits either a normal distribution or a \u2019poisson\u2019 distribution, it was observed, using the ANOVA (analysis of variance) test that:\n\u2022 For the parameter \u03c41, there are significant errors (p \u00a1 0.05) between the group of measurements for frequencies: 5Hz\u22121Hz with p = 0.00014 and 5Hz\u22122Hz with p = 0.012. In other words, the group of \u03c41 values at 5Hz is significantly different than at 1Hz and 2Hz. \u2022 There are no significant errors between measurement groups of estimated parameters \u03c4c, \u03c42, A0, R0 and Km (p > 0.05) for each frequency, which means that for each parameter, the groups of parameter meurements can be considered identical. This also shows that these 5 factors do not vary with stimulation frequency.\nThe most surprising result is the statistical analysis of A0: this parameter describes muscle fatigue and decreases when the muscle is fatigued. The table of values shows a decrease in A0 as the frequency increases, which is consistent with the fact the higher the frequency the more the muscle is subjected to electric impulses, the more it fatigues the muscle. However, the statistical analysis of these values describes that there is no significant differences between these values packages for the three different frequencies studied. It was also shown in the analysis of Ding et al. [9] that the parameters \u03c41 and Km change with muscle fatigue. A significant error was found between the parameters at 5 Hz versus 1 Hz and 2 Hz for \u03c41. But no significant errors (p > 0.05) were found for Km. Another comment, only experiments with constant stimulation frequency were performed because, firstly, the stimulation equipment imposes this constraint and secondly it was shown that parameters vary significantly between constant and non-constant frequency stimulation, which is part of the limitation of the force model described by Ding in [8]."
        },
        {
            "heading": "V. OPTIMIZATION PROBLEM",
            "text": "The training programs are being translated into an optimization problem. Both problems fit in the sampled-data control category.\na) Endurance program: We consider a single train [0,T ] on which the corresponding problem is :\nm x\nin \u222b T\n0 |F(t)\u2212Fre f |2 dt (11)\nThe amplitudes are optimization variables (x = (\u03b71,\u03b72, ...,\u03b7n)), which belong to the finite dimensional input-space I \u2208 [0,1]n+1 defined by amplitude constraints : \u03b7i \u2208 [0,1], i = 0, ... , n, with n a fixed integer, representing the number of pulses in the train. T is the time of the end of the pulse train. The reference force Fre f is adjusted in relation with the user.\nb) Punch program: We consider a single train [0,T ], T free, on which the corresponding problem is :\nm x axF(T ) (12)\nAmplitudes are fixed at one. Impulse times are the optimization variables (x = (t1, t2, ..., tn)). They belong to the finite dimensional input-space I \u2208 [0,T ]n. They are subjected to two constraints :\n\u2022 0 = t0 < t1 < ... < tn < tn+1 = T , with n a fixed integer, representing the number of pulses in the train. \u2022 ti+1 \u2212 ti > \u03b5 = 10 ms for i = 0, ... , n."
        },
        {
            "heading": "A. Optimal sampled-data control problem",
            "text": "Using the equation of the approximation force (7), we can generate the explicit expression of the approximation of the force, in terms of the optimization variables x. J\u03031 and J\u03032 constitute the approximated cost functions of the optimization routine.\nm \u03b7i inJ\u03031 = m\u03b7i in\nn\n\u2211 k=1 \u2225F\u0303k(tk+ j/p,\u03b1,\u03b7i)\u2212Fre f \u222522 (13)\nm ti inJ\u03032 = m ti in(\u2212F\u0303k(T,\u03b1, ti)) (14)\nwith \u03b1 = [\u03c4c,R0,A0,Km,\u03c41,\u03c42]. For each case, the associated problem which gives the approximation J\u0303 of the cost function J based on the approximation F\u0303 of the variable F described before, is solved using an interior point method, with the function \u201dfmincon\u201d in Matlab, on a standard computer. For the first case, we initialize the amplitudes of the pulse train to random values on [0,1] and for the second case, we initialize the times of the pulse train to random values, respecting the two constraints described before.\n1) Numerical results: 1.1) The optimal solution \u03b7i\u2217 and the force response F\u0303 corresponding are depicted in Fig. 7.\n1.2) The optimal solution ti\u2217 and the force response F\u0303 corresponding are depicted in Fig. 8."
        },
        {
            "heading": "B. Smart electrostimulator",
            "text": "Only the endurance program has been implemented into the smart electrostimulator because of the hardware constraint which imposes a constant frequency during the stimulation train. Besides, maximizing muscle strenght during the experimental tests generates pain. The training program, translated into an optimization problem, has been tested using the algorithm presented in Fig. 3. Optimal controls are the amplitudes \u03b7 of the stimulation train. In the case of the smart electrostimulator and for simplification purposes, we impose optimal solution \u03b7i\u2217 constant for all i\u2208 [0,n] with n the number of stimulation impulses.\n1) Experimental results: The optimal solution \u03b7\u2217i , the predicted force response F\u0303 and the measured force Fdata are depicted in Fig. 9 and 10.\n2) Observation and discussion: The error between measured data and predicted force values increases when the pulse frequency is lower. Indeed, the dynamic behavior of the force with bounces whose peak-to-peak amplitude increases for a lower frequency, makes the tracking more difficult. The most problematic fact comes from the computation of the\nerror between measured force data and Fre f reference force. The error has to be compute either from the lower peak of force bounces or the higher peak of force bounces. If we introduce a total error margin of 5% around the reference value, the measured force are out of this range from 28% at the bottom and 71% with a low frequency. This error decreases when the stimulation frequency is higher. But a higher frequency means the perception of pain increasing and more importantly, the fatigue increases rapidly which means that the muscle can\u2019t maintain the reference force."
        },
        {
            "heading": "VI. CONCLUSIONS",
            "text": "Our study shows how to estimate the set of 6 parameters of the Ding\u2019s model using an approximation of the force response, that allows to bypass the time computational expensive integration of the dynamics. This study is about the design of a smart electrostimulator with fast computations and modern sensors, allowing us to fit the model to the sensors values and to compute the optimal trajectory."
        },
        {
            "heading": "ACKNOWLEDGMENT",
            "text": "The work presented in this article was performed in the frame of a PhD \u201dDesign of a smart muscle stimulator\u201d, as a CIFRE agreement between the Burgundy university (Dijon, France) and Segula Matra Technologies (Trappes, France) under the direction of Pr. Toufik Bakir, Pr. Bernard Bonnard and Mr. Mokrane Abdiche."
        }
    ],
    "title": "Fast Optimization Scheme for the Muscular Response to FES Stimulation to Design a Smart Electrostimulator",
    "year": 2024
}
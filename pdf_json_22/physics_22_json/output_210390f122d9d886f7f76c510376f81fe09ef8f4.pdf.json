{
    "abstractText": "In the operation of cascaded H-bridge (CHB) converters and modular multilevel converters (MMCs) with energy storage or renewable power resources, unbalanced active power distribution among the submodules (SMs) is unavoidable. Depending on the operating conditions, there are certain upper and lower limits on the active power that can be processed by a single SM or a subset of SMs. The control system needs to restrict the SM power references to these limits, hence, accurate knowledge of the power limits is important. In existing methods to derive the power limits, the SM capacitor voltages are assumed to have negligible ripples, whereas in practice the ripples can be considerable. This paper analyzes the effect of capacitor voltage ripples on the SM active power control limits and highlights the importance of considering the ripple effect. A methodology is proposed to accurately incorporate capacitor voltage ripples in the derivation of SM active power control limits. Simulation and experimental results are provided to evaluate the effectiveness of the proposed methodology.",
    "authors": [
        {
            "affiliations": [],
            "name": "Gaowen Liang"
        },
        {
            "affiliations": [],
            "name": "Hossein Dehghani Tafti"
        },
        {
            "affiliations": [],
            "name": "Glen G. Farivar"
        },
        {
            "affiliations": [],
            "name": "Josep Pou"
        },
        {
            "affiliations": [],
            "name": "Salvador Ceballos"
        }
    ],
    "id": "SP:798f2ad03b66665a6fa668e701dbf98c0e0c2869",
    "references": [
        {
            "authors": [
                "G. Wang",
                "G. Konstantinou",
                "C.D. Townsend",
                "J. Pou",
                "S. Vazquez",
                "G.D. Demetriades",
                "V.G. Agelidis"
            ],
            "title": "A review of power electronics for grid connection of utility-scale battery energy storage systems",
            "venue": "IEEE Trans. on Sustain. Energy, vol. 7, no. 4, pp. 1778\u20131790, Jul. 2016.",
            "year": 2016
        },
        {
            "authors": [
                "C. Wang",
                "K. Zhang",
                "J. Xiong",
                "Y. Xue",
                "W. Liu"
            ],
            "title": "A coordinated compensation strategy for module mismatch of chb-pv systems based on improved ls-pwm and reactive power injection",
            "venue": "IEEE Trans. Ind. Electron., vol. 66, no. 4, pp. 2825\u20132836, Jun. 2019.",
            "year": 2019
        },
        {
            "authors": [
                "X. Zhang",
                "Y. Hu",
                "W. Mao",
                "T. Zhao",
                "M. Wang",
                "F. Liu",
                "R. Cao"
            ],
            "title": "A grid-supporting strategy for cascaded H-bridge PV converter using vsg algorithm with modular active power reserve",
            "venue": "IEEE Trans. Ind. Electron., vol. 68, no. 1, pp. 186\u2013197, Jan. 2021.",
            "year": 2021
        },
        {
            "authors": [
                "J.I. Leon",
                "S. Vazquez",
                "L.G. Franquelo"
            ],
            "title": "Multilevel converters: Control and modulation techniques for their operation and industrial applications",
            "venue": "Proc. of the IEEE, vol. 105, no. 11, pp. 2066\u20132081, Nov. 2017.",
            "year": 2017
        },
        {
            "authors": [
                "F. Gao",
                "L. Zhang",
                "Q. Zhou",
                "M. Chen",
                "T. Xu",
                "S. Hu"
            ],
            "title": "State-of-charge balancing control strategy of battery energy storage system based on modular multilevel converter",
            "venue": "Proc. of ECCE, pp. 2567\u20132574, Sep. 2014.",
            "year": 2014
        },
        {
            "authors": [
                "N. Li",
                "F. Gao",
                "T. Hao",
                "Z. Ma",
                "C. Zhang"
            ],
            "title": "SoH balancing control method for the MMC battery energy storage system",
            "venue": "IEEE Trans. Ind. Electron., vol. 65, no. 8, pp. 6581\u20136591, Aug. 2018.",
            "year": 2018
        },
        {
            "authors": [
                "M. Wang",
                "X. Zhang",
                "T. Zhao",
                "M. Ma",
                "Y. Hu",
                "F. Wang",
                "X. Wang"
            ],
            "title": "Harmonic compensation strategy for single-phase cascaded h-bridge pv inverter under unbalanced power conditions",
            "venue": "IEEE Trans. Ind. Electron., vol. 67, no. 12, pp. 10474\u201310484, Jan. 2020.",
            "year": 2020
        },
        {
            "authors": [
                "M. Hamzeh",
                "A. Ghazanfari",
                "H. Mokhtari",
                "H. Karimi"
            ],
            "title": "Integrating hybrid power source into an islanded MV microgrid using CHB multilevel inverter under unbalanced and nonlinear load conditions",
            "venue": "IEEE Trans. Energy Convers., vol. 28, no. 3, pp. 643\u2013651, Jul. 2013.",
            "year": 2013
        },
        {
            "authors": [
                "L. Zhang",
                "Y. Tang",
                "S. Yang",
                "F. Gao"
            ],
            "title": "Decoupled power control for a modular-multilevel-converter-based hybrid ac-dc grid integrated with hybrid energy storage",
            "venue": "IEEE Trans. Ind. Electron., vol. 66, no. 4, pp. 2926\u20132934, Jun. 2019.",
            "year": 2019
        },
        {
            "authors": [
                "V.V. Viswanathan",
                "M. Kintner-Meyer"
            ],
            "title": "Second use of transportation batteries: Maximizing the value of batteries for transportation and grid services",
            "venue": "IEEE Trans. Veh. Technol., vol. 60, no. 7, pp. 2963\u20132970, Sep. 2011.",
            "year": 2011
        },
        {
            "authors": [
                "Z. Ze",
                "H. Lin",
                "Y. Ma",
                "Z. Wang"
            ],
            "title": "Assessment of modular multilevel converter with partly integrated battery energy storage system",
            "venue": "Proc. ECCE, pp. 2956\u20132962, Sep. 2018.",
            "year": 2018
        },
        {
            "authors": [
                "P.D. Judge",
                "T.C. Green"
            ],
            "title": "Modular multilevel converter with partially rated integrated energy storage suitable for frequency support and ancillary service provision",
            "venue": "IEEE Trans. Power Del., vol. 34, no. 1, pp. 208\u2013219, Feb. 2019.",
            "year": 2019
        },
        {
            "authors": [
                "L. Xiong",
                "Y. Gui",
                "H. Liu",
                "W. Yang",
                "J. Gong"
            ],
            "title": "A hybrid CHB multilevel inverter with supercapacitor energy storage for grid-connected photovoltaic systems",
            "venue": "Proc. of Appli. Power Electron. Conf. and Expo., pp. 3195\u20133199, Mar. 2018.",
            "year": 2018
        },
        {
            "authors": [
                "G. Liang",
                "H. Dehghani Tafti",
                "G.G. Farivar",
                "J. Pou",
                "C.D. Townsend",
                "G. Konstantinou",
                "S. Ceballos"
            ],
            "title": "Analytical derivation of intersubmodule active power disparity limits in modular multilevel converterbased battery energy storage systems",
            "venue": "IEEE Trans. Power Electron., vol. 36, no. 3, pp. 2864\u20132874, Mar. 2020.",
            "year": 2020
        },
        {
            "authors": [
                "S. V\u00e1zquez P\u00e9rez",
                "J.I. Le\u00f3n",
                "J.M. Carrasco Sol\u00eds",
                "L. Franquelo",
                "E. Galv\u00e1n D\u00edez",
                "M. Reyes",
                "J.A. S\u00e1nchez",
                "E. Dom\u00ednguez"
            ],
            "title": "Analysis of the power balance in the cells of a multilevel cascaded H-Bridge converter",
            "venue": "IEEE Trans. Ind. Electron., vol. 57, no. 7, pp. 2287\u20132296, Oct. 2009.",
            "year": 2009
        },
        {
            "authors": [
                "W. Qifeng",
                "F. Wang",
                "H. Guo",
                "S. Zhu"
            ],
            "title": "Analysis of power balance influenced by voltage configuration in two-cell multilevel CHB",
            "venue": "Proc. of Intern. Power Electron. and Appli. Conf. and Expo., pp. 1\u20137, Nov. 2018. IEEE TRANSACTIONS ON INDUSTRIAL ELECTRONICS",
            "year": 2018
        },
        {
            "authors": [
                "Z. Wang",
                "H. Lin",
                "Y. Ma"
            ],
            "title": "Improved capacitor voltage balancing control for multimode operation of modular multilevel converter with integrated battery energy storage system",
            "venue": "IET Power Electron., vol. 12, no. 11, pp. 2751\u20132760, Sep. 2019.",
            "year": 2019
        },
        {
            "authors": [
                "G. Liang",
                "H.D. Tafti",
                "G.G. Farivar",
                "J. Pou",
                "C.D. Townsend",
                "G. Konstantinou"
            ],
            "title": "Analysis of the inter-submodule active power disparity limits of modular multilevel converter-based battery energy storage systems",
            "venue": "Proc. ECCE, pp. 594\u2013600, Oct. 2020.",
            "year": 2020
        },
        {
            "authors": [
                "M. Vasiladiotis",
                "A. Rufer"
            ],
            "title": "Analysis and control of modular multilevel converters with integrated battery energy storage",
            "venue": "IEEE Trans. Power Electron., vol. 30, no. 1, pp. 163\u2013175, Jan. 2015.",
            "year": 2015
        },
        {
            "authors": [
                "K. Ilves",
                "S. Norrga",
                "L. Harnefors",
                "H. Nee"
            ],
            "title": "On energy storage requirements in modular multilevel converters",
            "venue": "IEEE Trans. Power Electron., vol. 29, no. 1, pp. 77\u201388, Jan. 2014.",
            "year": 2014
        },
        {
            "authors": [
                "J. Pou",
                "S. Ceballos",
                "G. Konstantinou",
                "V.G. Agelidis",
                "R. Picas",
                "J. Zaragoza"
            ],
            "title": "Circulating current injection methods based on instantaneous information for the modular multilevel converter",
            "venue": "IEEE Trans. Ind. Electron., vol. 62, no. 2, pp. 777\u2013788, Feb. 2015.",
            "year": 2015
        },
        {
            "authors": [
                "A. Gil",
                "J. Segura",
                "N.M. Temme"
            ],
            "title": "Numerical methods for special functions",
            "year": 2007
        }
    ],
    "sections": [
        {
            "text": "Index Terms\u2014Active power control limits, cascaded H-bridge, capacitor voltage ripple, hybrid integration of energy sources, modular multilevel converter.\nI. INTRODUCTION\nCascaded H-bridge (CHB) converters and modular multi-level converters (MMCs) are popular choices to connect renewable energy resources and energy storage systems to the power system [1]\u2013[3]. Compared to the conventional two-level converter, these two converters provide evident advantages, such as modularity, excellent harmonic performance, low switching frequency, etc. [4].\nFig. 1(a) depicts the circuit representation of a phase of the CHB converter with N submodules (SMs). Fig. 1(b) depicts\nManuscript received March 23, 2021; revised May 18, 2021; accepted June 11, 2021. This work was supported by the Office of Naval Research U.S. under DUNS Code: 595886219. It has also been partially supported by the Spanish Centre for the Development of Industrial Technology (CDTI) through the \"Cervera\" program under the grant agreement CER-20191002 ENERISLA.\nG. Liang and J. Pou are with the School of Electrical and Electronic Engineering, Nanyang Technological University, 639798 Singapore (email:gaowen001@e.ntu.edu.sg; josep.pou@ieee.org).\nH. D. Tafti and C. D. Townsend are with the Department of Electrical, Electronic, and Computer Engineering, The University of Western Australia, Crawley WA 6009, Australia (e-mail: hossein002@e.ntu.edu.sg; townsend@ieee.org).\nG. G. Farivar is with the Energy Research Institute, Nanyang Technological University, 639798 Singapore (e-mail: gfarivar@ntu.edu.sg).\nG. Konstantinou is with the School of Electrical Engineering and Telecommunications, University of New South Wales, Sydney, NSW 2052, Australia (e-mail: g.konstantinou@unsw.edu.au).\nS. Ceballos is with Tecnalia, Basque Research and Technology Alliance (BRTA), Derio E-48160, Spain (e-mail: salvador.ceballos@tecnalia.com).\nthe circuit representation of a phase of the MMC, which consists of two arms and each arm has N SMs. Renewable power resources and energy storage systems are connected to the SMs, which enable the SMs to process active power. The control system allocates the active power reference to each SM with consideration of the integrated energy sources to achieve certain control objectives. For example, in a converter integrated with batteries, the SM power references are determined based on the states of charge (SoC) and states of health (SoH) of batteries [5], [6]. Another example is a converter integrated with photovoltaic (PV) panels, where the active power generation from each SM is affected by the irradiance and temperatures of the PV strings [7]. Therefore, the active power distribution can be unbalanced among the SMs.\nThe unbalanced active power distribution is especially important in systems with hybrid energy sources, where different SMs are integrated with different types of energy sources [8], [9]. A typical example is the use of second-life batteries in energy storage applications to reduce cost, where the batteries can have different power ratings, energy capacities and chemistries [10]. There is also the possibility of partial integration of batteries, which means batteries are added to some SMs instead of all the SMs [11], [12]. This hybrid/partial integration makes the active power distribution among the SMs highly unbalanced [13].\nDepending on the operating condition (SM capacitor voltage reference, output voltage and current reference of the converter), every subset of SMs have upper and lower limits on how much active power it can process [14]. These limits are defined as the SM active power control limits (APCLs). When the system operates close to the boundaries, accurate knowledge of the APCLs becomes imperative for the control system. If the provided limits to the control system are beyond the actual APCLs, then the controller may allocate power\nreferences to some SMs that are beyond the actual limits, which means those SMs will not be able to track the references and the converter operation can become unstable. On the other hand, setting the APCLs too low will result in suboptimal operation of the system. Take a SM integrated with PV panels as an example. The PV power generation should be limited to the maximum APCL of this SM. Hence, if the calculated APCL is lower than the actual value, this SM will fail to extract the maximum power from the PV panels by unnecessarily curtailing the power to an incorrect limit. Therefore, it is important to derive the SM APCLs accurately.\nA graphical method is proposed to derive the SM APCLs for CHB converters in [15], which is further developed as an analytical method in [16]. However, this research only investigates CHB converters with two SMs per phase. In [17], the authors investigated the APCLs of a single SM in the MMC. However, the APCL of a subset with multiple SMs are not analyzed, which is an important drawback as the APCLs of n SMs are not necessarily equal to n times the APCLs of one SM [18]. An analytical method is proposed in [14] to derive the APCLs of an arbitrary number of SMs in the MMC, which can be extended to the CHB converter.\nA common limitation of all the mentioned studies is that the SM capacitor voltage ripples (CVRs) are assumed negligible in the analysis. However, the ripples can be large in practice. For example, in Fig. 2, an indirect active interface (IAI, i.e. a boost converter in this figure) is implemented between the capacitor and batteries to suppress the battery current ripples and regulate the average capacitor voltage [19]. In this case, the energy oscillation is burdened by the capacitor and thus, depending on the capacitance, the CVRs can be large [20]. Albeit, there is uncertainty on how much difference can be caused on the SM APCLs by the CVRs. To fill this gap, the main contributions of this paper are as follows: 1) investigating the effect of CVRs on the SMs APCLs and demonstrating its significance, and 2) proposing a methodology to incorporate the CVRs in the derivation of SM APCLs.\nThe rest of this paper is organized as follows. Section II introduces the operation principles of the converter and the derivation of SM APCLs, where negligible capacitor voltage ripples are assumed. Section III proposes a method to incorporate the CVRs in the derivation of SM APCLs. Simulation and experimental results are provided in Sections IV and V respectively, to verify the proposed analysis. Finally, Section VI summarizes this paper."
        },
        {
            "heading": "II. OPERATION PRINCIPLES OF THE CONVERTER",
            "text": "This section first introduces the control scheme of an MMC integrated with battery energy storage, where the knowledge of SM APCLs is needed. The conventional approach to derive the SM APCLs is also introduced, where CVRs are assumed negligible. Though the provided introduction only focuses on one arm of the MMC with N SMs, a similar analysis can be applied to the CHB converter. This is because they have similar topologies and operating principles in the sense they both synthesize a certain voltage waveform using a series connection of SMs while being subjected to a certain current waveform."
        },
        {
            "heading": "A. Control Scheme",
            "text": "Fig. 3 depicts the control scheme for an MMC integrated with battery energy storage [19]. In the arm current controller, the arm current reference (i\u2217arm) is decided according to the dc-side power reference (P \u2217dc), dc-side voltage (Vdc), ac-side power references and voltage (P\u0304 \u2217ac, Qac and vo) of the MMC. The output of the current controller block is the arm voltage reference [21].\nIn the SM power reference controller, the power reference for each SM is normally decided according to the SoC and SoH of batteries, where P\u0304 \u2217SMi represents the active power reference of the ith SM [5], [6]. The desired unbalanced power references can become unviable, which means they cannot be tracked by the corresponding SMs. To ensure the viability of the power references, a viability check and modification block is used, where the knowledge of the SM APCLs is required as an input [14]. If and only if the power references of all the subsets of SMs are within the corresponding APCLs, the power references are viable and can be allocated to the corresponding SMs. Otherwise, the SM power references need to be modified. Details of the viability check and modification are reported in [14]. The derivation of SM APCLs is introduced in Subsection II-B.\nIn the SM power controller, a moving average filter (MAF) calculates the average power of each SM (P\u0304SMi), which is then compared to the reference (P\u0304 \u2217SMi) to derive the error (\u2206P\u0304SMi). According to the error, a sorting algorithm is used to distribute the output voltage reference for each SM\n(v\u2217SMi), which regulates the active power of each SM to its reference and simultaneously synthesizes the output voltage of the converter arm [14].\nThe SM capacitor voltage controller regulates the SM average capacitor voltage (v\u0304Ci) to the reference (VC) through the battery current reference (i\u2217Bi). For a faster response, a feedforward component (I\u2217Bi = P\u0304 \u2217 SMi/vBi, where vBi is the battery voltage) is added to the output of the PI-based capacitor voltage controller \u2206i\u2217Bi (i \u2217 Bi = I \u2217 Bi +\u2206i \u2217 Bi) [19]. Then, in the battery current controller, the battery current of each SM is regulated to its reference.\nThe controllers in Fig. 3 can also be applied to the CHB converter, except the arm current controller. In the CHB converter, the output current reference (i\u2217arm) and voltage reference (v\u2217arm) are decided based on the ac-side power and voltage ( (P\u0304 \u2217ac, Qac and vo) [13]."
        },
        {
            "heading": "B. Active Power Control Limits with Negligible Capacitor Voltage Ripples",
            "text": "The average active power of one SM is calculated as:\nP\u0304SMi = 1\nT\nt0+Tw\nt0\nvSMi(t)iarm(t)dt, (1)\nwhere T represents the fundamental voltage period and vSMi is the instantaneous output voltage of the ith SM, respectively. To achieve the maximum power, the ac-side output voltage of an SM should be maximum when the arm current is positive, and minimum when the arm current is negative. This can be generalized to an arbitrary combination of n SMs, where n \u2208 [1, N ]. Hence, the maximum APCL of a combination with n SMs can be derived as:\nP\u0304nmax = 1\nT \u222b t0+T t0 vnmaxp(t)iarm(t) dt,\nvnmaxp(t) = { vnmax(t) if iarm(t) \u2265 0; vnmin(t) if iarm(t) < 0, (2)\nwhere P\u0304nmax represents the maximum active power of n SMs. vnmax and v n min represent the maximum and minimum allowed output voltage of n SMs, respectively. Similarly, the minimum APCL of n SMs can be derived as:\nP\u0304nmin = 1\nT \u222b t0+T t0 vnminp(t)iarm(t) dt,\nvnminp(t) = { vnmin(t) if iarm(t) \u2265 0; vnmax(t) if iarm(t) < 0. (3)\nThe maximum and minimum output voltages of unipolar SMs, which means the output voltage can be either zero or positive, are derived in [14]:\nvnmax(t) = min [nVC , v \u2217 arm(t)] , (4)\nvnmin(t) = max [0, v \u2217 arm(t)\u2212 (N \u2212 n)VC ] , (5)\nwhere VC represents the capacitor voltage of one SM and v\u2217arm represents the arm voltage reference. Extending to bipolar\nSMs, whose output voltage can be negative as well, (4) and (5) are rewritten as:\nvnmax(t) = min [nVC , v \u2217 arm(t) + (N \u2212 n)VC ] , (6)\nvnmin(t) = max [\u2212nVC , v\u2217arm(t)\u2212 (N \u2212 n)VC ] . (7)\nThis conventional analysis assumes constant capacitor voltages, i.e. capacitor voltages with negligible ripples. However, the CVRs can be notable in practice and neglecting their effect can cause significant errors in the derivation of APCLs. This is a major limitation of the conventional analysis, which this paper overcomes as explained in Section III."
        },
        {
            "heading": "III. ACTIVE POWER CONTROL LIMITS WITH CONSIDERING CAPACITOR VOLTAGE RIPPLES",
            "text": "This section proposes a method to incorporate the CVRs in the derivation of the SM APCLs. The proposed analysis considers one arm of the MMC with N SMs, but it can be readily applied to the CHB converter as they have similar topologies and operational principles (they both synthesize a certain voltage waveform using a series connection of SMs while being subjected to a certain current waveform)."
        },
        {
            "heading": "A. Modeling of Capacitor Voltage Ripples",
            "text": "If the time-variant capacitor voltages of the SMs are known, their APCLs can be derived from (2)-(7). Although the arm current is common for all the SMs in one arm, the corresponding power references and the output voltage references of each SM can be different, which makes the SM capacitor voltages unequal. Nevertheless, to derive the APCLs of an arbitrary subset of n SMs, only the sum of the capacitor voltages of the n SMs in this subset and the capacitor voltage sum of the remaining N \u2212 n SMs are needed. Thus, this subset of the n SMs and the subset of the remaining N \u2212 n SMs can be considered as a clustered SM, respectively. The capacitor voltage of such a clustered SM, vnC(t), is equal to the sum of the capacitor voltages of all the SMs within the cluster. The capacitor voltage reference of this clustered SM is nVC , its capacitance is C/n (C represents the capacitance of a single SM), and its power reference is equal to the sum of power references of all the SMs in the cluster.\nThe CVR of this clustered SM depends on its power reference and output voltage reference. When the SM is charged with the maximum power, the power reference is the maximum APCL while the output voltage reference is vnmaxp(t) in (2). When the SM is charged with the minimum power, the power reference is the minimum APCL while the output voltage reference is vnminp(t) in (3). According to the relationship between the capacitor current and voltage, the capacitor voltage of this clustered SM is expressed as:\nvnC(t) =\n\u222b t 0 iC(t)dt\nC/n + vnC(0), (8)\nwhere iC(t) represents the charging current into this clustered capacitor, and vnC(0) represents the initial value of the capacitor voltage. As depicted in Fig. (2), the current iC(t) can be expressed as:\niC(t) = iSM (t) + iBC(t), (9)\nwhere iSM (t) is the charging current from the ac side of the SM and iBC(t) is the charging current from the integrated energy sources.\nThe current from the ac-side can be expressed as:\niSM (t) = vn\u2217(t)\nvnC(t) iarm(t), (10)\nwhere vn\u2217(t) represents the output voltage reference of this clustered SM. The current from the integrated energy source is affected by the average power of this SM. Assuming the integrated energy sources are providing a constant power (such as batteries with the IAI in Fig. 2), to maintain the average capacitor voltage, the current is regulated as:\niBC(t) = P\u0304nSM nVC , (11)\nwhere P\u0304nSM represents the average power of the clustered SM and is equal to its power reference in the steady state, i.e. the maximum/minimum APCL. Though the model of iBC(t) in (11) returns a dc value, without loss of generality of the following analysis, the model can change according to different control objectives.\nAs can be concluded from (8)-(11), to derive the APCLs of a subset with n SMs in one arm, the sum of their capacitor voltages is required. However, to derive the sum of the capacitor voltages, the initial capacitor voltages and the power references, i.e. the APCLs, are required. Therefore, it is challenging to derive the APCLs and the capacitor voltages of the SMs because they affect each other. To overcome this challenge, a numerical method is used to calculate the capacitor voltages and APCLs iteratively as explained in Subsection B.\nB. Iterative Active Power Control Limits Calculation Considering Capacitor Voltage Ripples\nThis subsection proposes a method to incorporate the CVRs in the derivation of APCLs. The analysis focuses on the derivation of the maximum APCL of a subset with n SMs (n \u2208 [1, N ]), but it can be readily applied to derive the minimum APCL of SMs without loss of generality. In the following analysis, all the estimated quantities are distinguished from the real ones with the hat sing \"^\". For example, the estimated sum of capacitor voltages of the n SMs is denoted as v\u0302nC(t), while the true value is vnC(t).\nThe value of v\u0302nC(t) at any time step can be derived by rewriting (8) in a discretized form:\nv\u0302nC(kTd + Td) = i\u0302nC(kTd)Td C/n + v\u0302nC(kTd), (12)\nwhere Td represents the sampling period and k represents the sampling instance. According to (9), (10) and (11), the estimated charging current, i\u0302nC(t), is expressed as:\ni\u0302nC(kTd) = vn\u2217(kTd)\nv\u0302nC(kTd) iarm(kTd) + P\u0302nmax nVC , (13)\nwhere P\u0302nmax represents the estimated maximum APCL. According to (8), the average of v\u0302nC(t) in a fundamental cycle, represented as v\u0302nC-ave, is derived as:\nv\u0302nC-ave = 1\nT \u222b T 0 v\u0302nC(t)dt = v\u0302 n C(0) + 1 T \u222b T 0 ( \u222b t 0 i\u0302nCdt C/n )dt,\n(14) where v\u0302nC(0) is the estimated initial capacitor voltage. In other words, v\u0302nC-ave is a function of v\u0302 n C(0), represented as v\u0302nC-ave(v\u0302 n C(0)). If the estimated v\u0302 n C(t) is equal to the true value vnC(t) at each time step, its average value (v\u0302 n C-ave) should be equal to nVC , the average of vnC(t). Thus, defining a function:\nf(v\u0302nC(0)) = v\u0302 n C-ave(v\u0302 n C(0))\u2212 nVC , (15)\nthe value of f(v\u0302nC(0)) is zero if v\u0302 n C(t) equals the true voltage vnC(t). When f(v\u0302 n C(0)) is not zero, this value indicates how to update the estimated values. According to Newton\u2019s Method [22], the estimated v\u0302nC(0) can be updated as:\nv\u0302nC-(K+1)(0) = v\u0302 n C-K(0)\u2212\nf(v\u0302nC-K(0)) f \u2032(v\u0302nC-K(0)) , (16)\nwhere v\u0302nC-K(0) is the estimate of v n C(0) after K iterations, while f \u2032 (v\u0302nC-K(0)) represents the derivative of the function f(v\u0302nC-K(0)). According to (15), f \u2032 (v\u0302nC-K(0)) is derived to be:\nf \u2032 (v\u0302nC-K(0)) = \u2202v\u0302nC-ave \u2202v\u0302nC-K(0) . (17)\nHence, assuming a minor increment \u03b5 to v\u0302nC-K(0), f \u2032 (v\u0302nC-K(0)) can be calculated as:\nf \u2032 (v\u0302nC-K(0)) =\nv\u0302nC-ave(v\u0302 n C-K(0) + \u03b5)\u2212 v\u0302nC-ave(v\u0302nC-K(0))\n\u03b5 .\n(18)\nA similar analysis is applied to estimate the capacitor voltages summation of the remaining N \u2212n SMs, represented as v\u0302N\u2212nC (t). Its estimated initial value and the average are represented as v\u0302N\u2212nC (0) and v\u0302 N\u2212n C-ave, respectively. The value of v\u0302N\u2212nC (0) can be updated with the same method of updating v\u0302nC(0).\nAfter v\u0302nC(0) and v\u0302 N\u2212n C (0) are updated, the estimated values of v\u0302nC(t) and v\u0302 N\u2212n C (t) are calculated from (12). Afterwards, the estimated P\u0302nmax is updated using (2)-(7), where nVC and (N\u2212n)VC are replaced with v\u0302nC(t) and v\u0302 N\u2212n C (t), respectively. The iteration process continues until the estimated values of the voltages and the APCLs converge to the true values. If the estimated voltages (v\u0302nC(t) and v\u0302 N\u2212n C (t)) are close to the true values, then:\nv\u0302nC(T ) ' v\u0302nC(0), v\u0302nC-ave ' nVC ; (19)\nv\u0302N\u2212nC (T ) ' v\u0302 N\u2212n C (0), v\u0302 N\u2212n C-ave ' (N \u2212 n)VC . (20)\nIf v\u0302nC(t) and v\u0302 N\u2212n C (t) are close to the true values, the estimated P\u0302nmax is also close to its true value. The complete process of the proposed numerical method is displayed in Fig. 4. The initial estimated values of v\u0302nC(0) and v\u0302N\u2212nC (0) can be chosen as nVC and (N \u2212 n)VC , while the initial P\u0302nmax is the calculated value of P\u0304 n max in (2) with the assumption of negligible CVRs. The proposed method applies to both the MMC and CHB converter. Moreover, since no constraint is imposed on the arm voltage/current in the analysis, the proposed method is generic, i.e., it is applicable irrespective of the control methodology and presence of any circulating current or common-mode voltage. In practice, the SM capacitance can have deviation, which affects the estimation of CVRs. This challenge can be overcome with available capacitance condition monitoring methods [23]."
        },
        {
            "heading": "C. Effect of the Capacitor Voltage Ripples",
            "text": "To investigate the effect of the CVRs on the SM APCLs, the maximum SM APCLs of an MMC with bipolar SMs are studied. Parameters of the studied system are provided in Table I. The circulating current is zero and the ac-side output current of the converter is 1200 A (peak).\nWith the proposed method, the derived maximum APCLs of one SM on various operating points are provided in Fig. 5(a), where the CVRs are considered. The modulation index (ma) varies between [0.2, 1] and the phase shift (\u03d5) between the output voltage and current of the MMC varies\nbetween [0\u00b0, 180\u00b0]. When ma decreases, the maximum APCL increases. This is because when ma decreases, the arm voltage requirement becomes lower, which provides higher flexibility for operating the SMs. When \u03d5 increases from 0 to 180\u00b0, the maximum APCL increases because the MMC changes from injecting active power to absorbing power from the ac-side.\nFig. 5(b) displays the amplitude of the CVR on the SM when it is charged with the maximum APCL. The ripple is normalized to the reference capacitor voltage (3 kV). Fig. 5(c) displays the difference between the derived maximum APCLs with and without considering the CVRs, which depicts the effect of the CVRs on the maximum APCLs. Representing the derived maximum APCL as P\u0304max when CVRs are considered and the APCL as P\u0303max when the CVRs are ignored, the difference of these two values is normalized in Fig. 5(c) as:\n\u2206P\u0304max = \u2223\u2223\u2223\u2223\u2223 P\u0304max \u2212 P\u0303maxP\u0304max \u2223\u2223\u2223\u2223\u2223\u00d7 100%. (21)\nAccording to Figs. 5(b) and (c), the effect of CVRs is highly\ndependent on the phase shift (\u03d5) between the MMC output voltage and current. When \u03d5 is close to 0, regardless of the modulation index and the amplitude of CVRs, the effect on the APCL is negligible (around 1% or less). However, when \u03d5 is close to 45\u00b0, the effect is considerable. For example, when ma = 1 and \u03d5 = 0, the CVR amplitude is 9.47% but only changes the APCL by 1.03%. However, when ma = 1 and \u03d5 = 45\u00b0, the CVR amplitude is 9.19% and changes the APCL by 9.34%. In other words, the CVRs can have a considerable effect on the SM APCLs and should not be ignored.\nTherefore, to accurately derive SM APCLs, the proposed method in Fig. 4 should be applied if the capacitor voltages contain notable ripples. In practice, if the control processing power is limited and the APCLs are calculated online, while the viability check is ongoing, the active power requirement of the converter can be evenly distributed among the SMs to ensure the viability of the power distribution. As the SM APCLs are decided by the operating point of the converter and not affected by the SM power references, the APCLs only need to be calculated and updated when the operating point changes. The APCLs can also be precalculated and stored in a look-up table for faster response."
        },
        {
            "heading": "IV. SIMULATION RESULTS",
            "text": "To verify the proposed analysis, simulation results are obtained on the MMC analyzed in Subsection III (parameters are given in Table I). Batteries are integrated into each SM with boost converters as in Fig. 2. The implemented control scheme is similar to the one in Fig. 3 except for the SM power references controller. In this paper, to verify the derived SM APCLs, the SM power references are manually decided and allowed to become unviable. When the power reference of one SM (or a subset of multiple SMs) exceeds its maximum APCL, the corresponding measured power will be saturated at the limit, which should be equal to the derived value if the proposed analysis is valid.\nSimulation results displayed on Fig. 6 are obtained with ma = 0.9 and \u03d5 = 45\u00b0. The upper arm is discharging with 1.43 MW. Hereinafter in this section, the power values are all normalized to 1.43 MW. According to Fig. 5, the derived maximum APCL of one SM is 40.49% when CVRs are considered. Ignoring the CVRs, the derived maximum APCL becomes 43.73%. The relative difference between these two limits is around 8%.\nFig. 6(a) displays the power reference and average measured power of each SM during the simulation. As observed, before t = 0.6 s, even though the active power distribution among the SMs is highly unbalanced, the SMs can still track their corresponding reference power because the references do not exceed the APCLs. From t = 0.6 s to t = 1.0 s, the power reference of the first SM (P\u0304 \u2217SM1 = 43%) is higher than the derived maximum APCL (40.49%) when CVRs are considered. Thus, this power reference is unviable and the measured power saturates at the derived limit. However, if the CVRs are ignored, the derived limit is 43.73% and this power reference will be considered as viable, which is incorrect. After\nt = 1.0 s, the measured power of the first SM is not saturated at the derived APCL because the SM capacitor voltages have diverged, as displayed in Fig. 6(c). The capacitor voltages affect the SM APCLs.\nIn Fig. 6(b), P\u0304n\u2217 and P\u0304n represent the power reference and the measured power of a subset with n SMs (from the first SM to the nth SM), respectively. The corresponding maximum APCL is derived as P\u0304nmax with the proposed method. As observed, before t = 0.6 s, each subset can track its power reference as the references do not exceed the limits. From t = 0.6 s to t = 1.0 s, when the references exceed the limits, the measured powers saturate at the corresponding derived limits. Results displayed in Figs. 6(a) and (b) verify the effectiveness of the derived SM APCLs using the proposed method. As can be seen, the proposed method provides accurate APCLs prediction because of the consideration of CVRs.\nFigs. 6(c) and (d) depicts the measured capacitor voltage and battery current of each SM, respectively. Before t = 0.6 s, when each SM tracks its power reference, the capacitor voltages are balanced and battery currents are regulated. From t = 0.6 s to t = 1.0 s, even though the power references slightly exceed the APCLs, the capacitor voltage controller still regulates the voltages and battery currents. However, after t = 1.0 s, because the power references further exceed the APCLs, the SM capacitor voltages diverge. Moreover, since the capacitor voltages of the first and second SMs drop lower than the battery voltage in some intervals, the boost converter cannot regulate the battery current in those intervals. Consequently, pulses appear in the battery currents of these SMs, which deteriorate the health of the integrated batteries. This specific case demonstrates the importance of the power distribution viability, which requires the knowledge of SM APCLs.\nFig. 6(e) depicts the measured capacitor voltage of the first SM when it is charged with the maximum power and its estimate (v\u03021C) with the proposed method. The estimated voltage is close to the measured one, which verifies the effectiveness of the capacitor voltage estimation in the proposed method."
        },
        {
            "heading": "V. EXPERIMENTAL RESULTS",
            "text": "Experimental results are obtained on a CHB converter that is built with Imperix PEH 2015 full-bridge power modules. Parameters of the setup are given in Table I and a picture is provided in Fig. 7. Three RS 537-5488 lead-acid batteries are connected in series to the dc-side of each SM through a boost converter. Results are obtained with two fundamental frequencies of the converter output voltage (20Hz and 50Hz).\nA. 20Hz Case\nIn this case, a 2.4-\u2126 resistor, 6.1-mH inductor and 1.2-mF capacitor are connected in series to the output of the CHB converter as a load. The modulation index is 0.9. Considering the CVRs, the maximum APCL of one SM is derived to be 43.1%. However, if CVRs are ignored, the APCL is derived to be 45.5%. The relative difference is around 5%. Results are provided in Fig. 8.\nFig. 8(a) displays the SM powers. Before t = 2.4 s, the power references are viable and each SM tracks its reference. At t = 2.4 s, the power reference of the first SM (45%) is higher than the maximum APCL (43.1% when considering CVRs), which means the reference is unviable. As observed, this SM cannot track the reference and saturates at the derived APCL. However, if CVRs are ignored in the derivation of APCL, the power references will be considered viable, which is incorrect. This specific case emphasizes the importance of the proposed method that considers CVRs. After t = 4.2 s, the power references are unviable even if CVRs are not considered. Consequently, the SM powers are saturated at the derived APCLs with consideration of CVRs. The obtained results verify the accuracy of derived SM APCLs using the proposed method.\nFig. 8(b) depicts the measured capacitor voltages of the two SMs in one fundamental cycle and the corresponding estimates. As observed, the estimated voltages are close to the measured ones, which verifies the validity of the proposed method.\nB. 50Hz Case\nIn this case, a 5.4-\u2126 resistor and 5-mH inductor are connected in series to the output of the CHB converter as a\nload. two modulation indices (ma = 0.9 and ma = 0.8) are investigated. Considering the CVRs, the maximum APCL of one SM is derived to be -26.55% when ma = 0.9 and -17.34% when ma = 0.8. Results are provided in Fig. 9.\nFig. 9(a) displays the power references and measured powers of the SMs. When the power references exceed the derived limits, the SM powers are saturated at the corresponding limits. Figs. 9(b) and (c) depict the measured and estimated capacitor voltages of the two SMs when ma = 0.9 and ma = 0.8, respectively. In both conditions, the estimated voltages are close to the measured ones."
        },
        {
            "heading": "VI. CONCLUSION",
            "text": "This paper has investigated the effect of CVRs on the SM APCLs for the MMC and CHB converter. It is revealed that, depending on the phase shift between the converter output voltage and current, the CVR can have a considerable effect on the SM APCLs (around 9% CVRs can change the SM APCLs by more than 9%). Moreover, a methodology is proposed to incorporate the CVRs in the derivation of SM APCLs, which provides more accurate results than the conventional method that ignores the CVRs. Simulation and experimental results\nobtained on both the MMC and CHB converter verified the validity of the proposed analysis."
        }
    ],
    "title": "Effect of Capacitor Voltage Ripples on Submodule Active Power Control Limits of Cascaded Multilevel Converters",
    "year": 2021
}
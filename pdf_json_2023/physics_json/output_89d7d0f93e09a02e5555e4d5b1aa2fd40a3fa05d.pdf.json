{
    "abstractText": "1 Jan and Dan Duncan Neurological Research Institute at Texas Children\u2019s Hospital, Houston, TX, 77030, USA 2 Department of Pediatrics-Neurology, Baylor College of Medicine, Houston, TX, 77030, USA 3 Graduate Program of Quantitative & Computational Biosciences, Baylor College of Medicine, One Baylor Plaza, Houston, TX, 77030, USA 4 Advanced Technology Cores, Baylor College of Medicine, Houston, TX, 77030, USA 5 Department of Molecular and Human Genetics, Baylor College of Medicine, Houston, TX, 77030, USA 6 Center for Drug Discovery, Department of Pathology, Baylor College of Medicine, One Baylor Plaza, Houston, TX, 77030, USA 7 Department of Statistics, Rice University, 6100 Main Street, Houston, TX 77005-1827, USA",
    "authors": [
        {
            "affiliations": [],
            "name": "Xu Han"
        },
        {
            "affiliations": [],
            "name": "Wanli Wang"
        },
        {
            "affiliations": [],
            "name": "Li-Hua Ma"
        },
        {
            "affiliations": [],
            "name": "Ismael Al-Ramahi"
        },
        {
            "affiliations": [],
            "name": "Juan Botas"
        },
        {
            "affiliations": [],
            "name": "Kevin MacKenzie"
        },
        {
            "affiliations": [],
            "name": "Genevera I. Allen"
        },
        {
            "affiliations": [],
            "name": "Damian W. Young"
        },
        {
            "affiliations": [],
            "name": "Zhandong Liu"
        },
        {
            "affiliations": [],
            "name": "Mirjana Maletic-Savatic"
        },
        {
            "affiliations": [],
            "name": "Dan Duncan"
        }
    ],
    "id": "SP:4678e8fddbcd72d0f001023a6108ca3bbe5ad5fb",
    "references": [
        {
            "authors": [
                "Markley",
                "J. L"
            ],
            "title": "The future of NMR-based metabolomics",
            "venue": "Current Opinion in Biotechnology vol",
            "year": 2017
        },
        {
            "authors": [
                "Emwas",
                "A. H"
            ],
            "title": "Nmr spectroscopy for metabolomics research",
            "venue": "Metabolites vol. 9 Preprint at https://doi.org/10.3390/metabo9070123",
            "year": 2019
        },
        {
            "authors": [
                "N Psychogios"
            ],
            "title": "The Human Serum Metabolome",
            "venue": "PLoS One",
            "year": 2011
        },
        {
            "authors": [
                "D.S. Wishart"
            ],
            "title": "NMR metabolomics: A look ahead",
            "venue": "Journal of Magnetic Resonance vol",
            "year": 2019
        },
        {
            "authors": [
                "C.B. Newgard"
            ],
            "title": "Metabolomics and Metabolic Diseases: Where Do We Stand",
            "venue": "Cell Metabolism vol",
            "year": 2017
        },
        {
            "authors": [
                "Kennedy",
                "A. D"
            ],
            "title": "Metabolomics in the clinic: A review of the shared and unique features of untargeted metabolomics for clinical research and clinical testing",
            "venue": "Journal of Mass Spectrometry",
            "year": 2018
        },
        {
            "authors": [
                "Graaf",
                "R.A. de"
            ],
            "title": "In vivo NMR Spectroscopy: Principles and Techniques",
            "venue": "(Wiley,",
            "year": 2007
        },
        {
            "authors": [
                "J.D. van Beek"
            ],
            "title": "matNMR: A flexible toolbox for processing, analyzing and visualizing magnetic resonance data in Matlab\u00ae",
            "venue": "Journal of Magnetic Resonance",
            "year": 2007
        },
        {
            "authors": [
                "C. Ludwig",
                "U.L. G\u00fcnther"
            ],
            "title": "MetaboLab - advanced NMR data processing and analysis for metabolomics",
            "venue": "BMC Bioinformatics",
            "year": 2011
        },
        {
            "authors": [
                "U.L. G\u00fcnther",
                "C. Ludwig",
                "H. R\u00fcterjans"
            ],
            "title": "NMRLAB - Advanced NMR Data Processing in Matlab",
            "venue": "Journal of Magnetic Resonance 145,",
            "year": 2000
        },
        {
            "authors": [
                "B. Worley",
                "R. Powers"
            ],
            "title": "MVAPACK: A complete data handling package for NMR metabolomics",
            "venue": "ACS Chem Biol",
            "year": 2014
        },
        {
            "authors": [
                "Z Pang"
            ],
            "title": "MetaboAnalyst 5.0: narrowing the gap between raw spectra and functional insights",
            "venue": "Nucleic Acids Res",
            "year": 2021
        },
        {
            "authors": [
                "C. Zheng",
                "S. Zhang",
                "S. Ragg",
                "D. Raftery",
                "O. Vitek"
            ],
            "title": "Identification and quantification of metabolites in 1H NMR spectra by Bayesian model selection",
            "venue": "Bioinformatics 27,",
            "year": 2011
        },
        {
            "authors": [
                "J. Hao",
                "W. Astle",
                "M. de iorio",
                "T.M.D. Ebbels"
            ],
            "title": "Batman-an R package for the automated quantification of metabolites from nuclear magnetic resonance spectra using a bayesian model",
            "venue": "Bioinformatics 28,",
            "year": 2012
        },
        {
            "authors": [
                "I.A. Lewis",
                "S.C. Schommer",
                "J.L. Markley"
            ],
            "title": "rNMR: Open source software for identifying and quantifying metabolites in NMR spectra",
            "venue": "Magnetic Resonance in Chemistry",
            "year": 2009
        },
        {
            "authors": [
                "J. Xia",
                "N. Psychogios",
                "N. Young",
                "D.S. Wishart"
            ],
            "title": "MetaboAnalyst: A web server for metabolomic data analysis and interpretation",
            "venue": "Nucleic Acids Res",
            "year": 2009
        },
        {
            "authors": [
                "K. Hollywood",
                "D.R. Brison",
                "R. Goodacre"
            ],
            "title": "Metabolomics: Current technologies and future trends",
            "venue": "Proteomics 6,",
            "year": 2006
        },
        {
            "authors": [
                "A. Zhang",
                "H. Sun",
                "G. Yan",
                "P. Wang",
                "X. Wang"
            ],
            "title": "Metabolomics for Biomarker Discovery: Moving to the Clinic",
            "venue": "Biomed Res Int 2015,",
            "year": 2015
        },
        {
            "authors": [
                "O Cloarec"
            ],
            "title": "Statistical total correlation spectroscopy: An exploratory approach for latent biomarker identification from metabolic 1H NMR data sets",
            "venue": "Anal Chem 77,",
            "year": 2005
        },
        {
            "authors": [
                "S.L. Robinette",
                "J.C. Lindon",
                "J.K. Nicholson"
            ],
            "title": "Statistical spectroscopic tools for biomarker discovery and systems medicine",
            "venue": "Analytical Chemistry vol",
            "year": 2013
        },
        {
            "authors": [
                "Robinette",
                "S. L"
            ],
            "title": "Cluster analysis statistical spectroscopy using nuclear magnetic resonance generated metabolic data sets from perturbed biological systems",
            "venue": "Anal Chem",
            "year": 2009
        },
        {
            "authors": [
                "Blaise",
                "B. J"
            ],
            "title": "Statistical recoupling prior to significance testing in nuclear magnetic resonance based metabonomics",
            "venue": "Anal Chem",
            "year": 2009
        },
        {
            "authors": [
                "Maher",
                "A. D"
            ],
            "title": "Statistical total correlation spectroscopy scaling for enhancement of metabolic information recovery in biological NMR spectra",
            "venue": "Anal Chem",
            "year": 2012
        },
        {
            "authors": [
                "Posma",
                "J. M"
            ],
            "title": "Subset optimization by reference matching (STORM): An optimized statistical approach for recovery of metabolic biomarker structural information from 1H NMR spectra of biofluids",
            "venue": "Anal Chem",
            "year": 2012
        },
        {
            "authors": [
                "Posma",
                "J. M"
            ],
            "title": "Integrated Analytical and Statistical Two-Dimensional Spectroscopy Strategy for Metabolite Identification: Application to Dietary Biomarkers",
            "venue": "Anal Chem",
            "year": 2017
        },
        {
            "authors": [
                "P.A. Hoijemberg",
                "I. Pelczer"
            ],
            "title": "Fast Metabolite Identification in Nuclear Magnetic Resonance Metabolomic Studies: Statistical Peak Sorting and Peak Overlap Detection for More Reliable Database Queries",
            "venue": "J Proteome Res",
            "year": 2018
        },
        {
            "authors": [
                "J. Forshed",
                "I. Schuppe-Koistinen",
                "S.P. Jacobsson"
            ],
            "title": "Peak alignment of NMR signals by means of a genetic algorithm",
            "venue": "Anal Chim Acta 487,",
            "year": 2003
        },
        {
            "authors": [
                "Lixin Gong",
                "Y.A.C. William Constantine"
            ],
            "title": "msProcess: Protein Mass Spectra",
            "venue": "Processing in R",
            "year": 2012
        },
        {
            "authors": [
                "N Mackinnon"
            ],
            "title": "MetaboID: A graphical user interface package for assignment of 1H NMR spectra of bodyfluids and tissues",
            "venue": "Journal of Magnetic Resonance 226,",
            "year": 2013
        },
        {
            "authors": [
                "D. Tulpan",
                "S. L\u00e9ger",
                "L. Belliveau",
                "A. Culf",
                "M. \u010cuperlovi\u0107-Culf"
            ],
            "title": "MetaboHunter: An automatic approach for identification of metabolites from 1H-NMR spectra of complex mixtures",
            "venue": "BMC Bioinformatics 12,",
            "year": 2011
        },
        {
            "authors": [
                "S Ravanbakhsh"
            ],
            "title": "Accurate, fully-automated NMR spectral profiling for metabolomics",
            "venue": "PLoS One 10,",
            "year": 2015
        },
        {
            "authors": [
                "A Alonso"
            ],
            "title": "Focus: A robust workflow for one-dimensional NMR spectral analysis",
            "venue": "Anal Chem",
            "year": 2014
        },
        {
            "authors": [
                "G Lefort"
            ],
            "title": "ASICS: an R package for a whole analysis workflow of 1D 1H NMR spectra",
            "venue": "Bioinformatics 35,",
            "year": 2019
        },
        {
            "authors": [
                "Tardivel",
                "P.J. C"
            ],
            "title": "ASICS: an automatic method for identification and quantification of metabolites in complex 1D 1H NMR spectra",
            "venue": "Metabolomics 13,",
            "year": 2017
        },
        {
            "authors": [
                "A.C. Alves",
                "M. Rantalainen",
                "E. Holmes",
                "J.K. Nicholson",
                "T.M.D. Ebbels"
            ],
            "title": "Analytic properties of statistical total correlation spectroscopy based information recovery in 1H NMR metabolic data sets",
            "venue": "Anal Chem",
            "year": 2009
        },
        {
            "authors": [
                "A Cruz-Marcelo"
            ],
            "title": "Comparison of algorithms for pre-processing of SELDI-TOF mass spectrometry data",
            "venue": "Bioinformatics 24,",
            "year": 2008
        },
        {
            "authors": [
                "R. Tibshirani",
                "G. Walther"
            ],
            "title": "Cluster validation by prediction strength",
            "venue": "Journal of Computational and Graphical Statistics",
            "year": 2005
        },
        {
            "authors": [
                "F. Dieterle",
                "A. Ross",
                "G. Schlotterbeck",
                "H. Senn"
            ],
            "title": "Probabilistic quotient normalization as robust method to account for dilution of complex biological mixtures. Application in1H NMR metabonomics",
            "venue": "Anal Chem",
            "year": 2006
        }
    ],
    "sections": [
        {
            "text": "Nuclear Magnetic Resonance (NMR) spectroscopy is widely used to analyze metabolites in biological samples, but the analysis can be cumbersome and inaccurate. Here, we present a powerful automated tool, SPA-STOCSY (Spatial Clustering Algorithm - Statistical Total Correlation Spectroscopy), which overcomes the challenges by identifying metabolites in each sample with high accuracy. As a data-driven method, SPA-STOCSY estimates all parameters from the input dataset, first investigating the covariance pattern and then calculating the optimal threshold with which to cluster data points belonging to the same structural unit, i.e. metabolite. The generated clusters are then automatically linked to a compound library to identify candidates. To assess SPA-STOCSY\u2019s efficiency and accuracy, we applied it to synthesized and real NMR data obtained from Drosophila melanogaster brains and human embryonic stem cells. In the synthesized spectra, SPA outperforms Statistical Recoupling of Variables, an existing method for clustering spectral peaks, by capturing a higher percentage of the signal regions and the close-to-zero noise regions. In the real spectra, SPA-STOCSY performs comparably to operator-based Chenomx analysis but avoids operator bias and performs the analyses in less than seven minutes of total computation time. Overall, SPA-STOCSY is a fast, accurate, and unbiased tool for untargeted analysis of metabolites in the NMR spectra. As such, it might accelerate the utilization of NMR for scientific discoveries, medical diagnostics, and patient-specific decision making."
        },
        {
            "heading": "1 Introduction",
            "text": "Many of the diseases that plague developed societies\u2014obesity, diabetes, cardiovascular and neurodegenerative diseases, cancer\u2014are caused by or associated with faulty metabolic regulation. To measure composite metabolic changes, the medical community is increasingly relying on metabolomics (the study of all metabolites in a given sample) for quantitative phenotyping and biomarker discovery (Markley et al., 2017; Emwas et al., 2019; Psychogios et al., 2011; Wishart, 2019; Bujak et al., 2015; Newgard, 2017; Kennedy et al., 2018). However, metabolomics has still not been fully accepted as a critical tool for clinical assessment and mechanistic discoveries; the reasons mostly stem from cumbersome data analysis. Two main platforms used to acquire metabolomic data are mass spectrometry (MS) and NMR. MS is more sensitive than NMR; detecting more metabolites means gnon-destructive, and non-invasive; requires minimal sample preparation; and most importantly, it is quantitative (NMR signal intensity is proportional to sample concentration) at a dynamic range of 2x105 and very reproducible (coefficient of variation, CV 1-2%) making it ideal for on-site diagnostics and biomarker discovery (Graaf, 2007). Because small changes in some metabolites (e.g. blood cholesterol, glucose) have serious health implications, identifying subtle-but-significant metabolic changes at the level of the whole metabolome can have a substantial clinical impact. Amassing relevant quantitative and highly reproducible data, such as those provided by the NMR, holds the promise to transform biology and medicine.\nIdentifying signals in NMR spectra may seem straightforward, but practical NMR spectral\ndecomposition suffers from several challenges (Graaf, 2007). First, NMR data analysis is operatorbased and time-intensive due to the complex nature of the data: the spectra contain thousands of resonances that may belong to hundreds of metabolites and although each metabolite has a unique spectral pattern, peaks of different metabolites may overlap. Second, real sample signal line shapes may differ from the idealized signals in the reference library, due to instrumental imperfections during acquisition. Third, a real sample may contain components not found in the library: a metabolite that is normally present at undetectable levels, or a breakdown product of an uncommon food or a rare drug (Graaf, 2007). Thus, NMR spectra may not correspond, precisely, to the weighted sums of ideal reference library components. Analyzing NMR spectra is also difficult due to high dimensionality: they have thousands of variables (data points) corresponding to thousands of dimensions, which can be computationally intense. Yet, NMR signal analysis methods should\nnot attempt to simplify these computations by making assumptions about metabolites\u2019 number and identity, as it is critical to extract the actual chemical, structural, or metabolic pathway information. For all these reasons, it is still challenging to use NMR for metabolomics discoveries.\nTo help surmount these challenges, several computational tools have been developed to\nperform standard data preprocessing and to obtain phased, baseline-corrected, chemical shiftreferenced, and normalized spectra (van Beek, 2007; Ludwig and G\u00fcnther, 2011; G\u00fcnther et al., 2000; Worley and Powers, 2014; Pang et al., 2021). Existing computational and statistical tools for metabolomic profiling can then be applied to the processed spectra to extract the biologically useful information(Zheng et al., 2011; Hao et al., 2012; Lewis et al., 2009; Xia et al., 2009; Hollywood et al., 2006; Zhang et al., 2015). However, these methods, led by Statistical Total Correlation Spectroscopy (STOCSY) (Cloarec et al., 2005) and its variations (Robinette et al., 2013), have yet to accurately identify metabolites from the NMR spectra because of the highdimensional problem in the covariance matrix estimation and the overlapping signals. In a typical NMR spectrum, the number of chemical shift intervals (ppm values) can range from 3000 to 8000 and the number of samples can range from several to hundreds. In addition, adjacent points on a spectrum often demonstrate high correlation, which makes it hard to estimate distal dependence. Further attempts have been made to first group NMR signals in a certain way and then utilize STOCSY: Cluster analysis statistical spectroscopy (CLASSY) employs a correlation matrix of peaks and an intersection matrix to determine local clusters and explore the intrametabolite connections (Robinette et al., 2009). Consequently, it identified the intermetabolite connections by hierarchical clustering of those local clusters. Statistical recoupling of variables (SRV) groups variables by scanning the covariance/correlation ratio landscape in consecutive variables. It then combines the grouped variables into super-clusters which represent variables with similar physical, chemical, and biological properties (Blaise et al., 2009). STOCSY is then applied to the superclusters to help metabolite identification. Besides, there are also continuous efforts in the extension of STOCSY to accelerate the metabolites identification process. STOCSY-scaling method scales down the contribution of the metabolites with dominant intensities, such as glucose, which could explain most of the variation between the biological groups (Maher et al., 2012). It makes it possible to explore and identify metabolites that have the metabolic variation of diagnostic interest but are covered by those dominant metabolites. STORM is developed to advance biomarker discovery by applying STOCSY on selected subsets of spectra that contain specific spectroscopic\nsignatures differentiating between different human populations (Posma et al., 2012). More recently, RED-STORM, the extension of STORM in a probabilistic framework, is applied for metabolite identification in 2D NMR data (Posma et al., 2017). Also, POD-CAST, which is applied after the STOCSY, aims at overcoming the peak overlap issues and provides a better peak list for database queries (Hoijemberg and Pelczer, 2018). Despite all these efforts, metabolite identification remains time-consuming and involves highly specialized knowledge and complex procedures on the part of the operator, while still failing to identify novel metabolites in the spectra.\nHere, we present a novel, automated approach that identifies metabolites with spectral\npatterns in a known database (reference library) and provides insights into those that are not in the reference library. We took advantage of two existing algorithms: Spatial Clustering Algorithm (SPA) and STOCSY (Cloarec et al., 2005) (Fig. 1). SPA takes advantage of the strong correlations among data points from the same multiplets and identifies local spatial clusters of contiguous data points that are highly possible to arise from the same metabolite cluster. With the SPA-derived clusters as input, STOCSY is then used to highlight the correlation map and to arrange clusters into highly correlated groups containing signals from the same metabolite. Once combined, the analytical power of these two algorithms synergistically increases and compared to the existing methods, enables automatic, accurate, and fast identifications of metabolites in the spectra."
        },
        {
            "heading": "2 Methods",
            "text": ""
        },
        {
            "heading": "2.1 NMR simulation model",
            "text": "We generated spectral intensities as\n\ud835\udc66\ud835\udc56(\ud835\udc53) = \ud835\udc46\ud835\udc56(\ud835\udc53) + \ud835\udc41\ud835\udc56(\ud835\udc53), (1)\nwhere \ud835\udc53 denotes the data points in terms of ppm, \ud835\udc53 = 1, \u2026, p, and \ud835\udc56 denotes the samples, \ud835\udc56 = 1, \u2026 , \ud835\udc5b. A typical simulated spectrum with 50 metabolites is shown. (Supplementary Fig. 1a). We specified the noise term \ud835\udc41(\ud835\udc53) as an autoregressive process of order 1, i.e., AR(1), ith high correlation (in simulations we used \ud835\udf0c = 0.9) (Supplementary Fig. 1b). This choice of the error term seemed reasonable based on the characteristics of the real data, and it has also been adopted in simulation models for other high-throughput spectral data, such as mass-spectrometry data (CruzMarcelo et al., 2008). Let L be the total number of metabolites present in a sample. \ud835\udc40(\ud835\udc53) is defined\nas reference spectra (scaled to have maximum 1) that the metabolite l resonates at the chemical shift, \ud835\udc53 , that is \ud835\udc40\ud835\udc59(\ud835\udc53) \u2208 [0, 1] (Supplementary Fig. 1c), and \ud835\udef4 \u2208 \ud835\udc45 \ud835\udc3f\u00d7\ud835\udc3f as a correlation matrix, denoting the correlation between the metabolites in the sample. The matrix \ud835\udc46(\ud835\udc5b x \ud835\udc5d) of population spectra, with elements \ud835\udc46\ud835\udc56(\ud835\udc53). S is defined as\n\ud835\udc46 = (\ud835\udc3b\ud835\udef4 + 1\ud835\udc5b \ud835\udefc \ud835\udc47)\ud835\udc40, (2)\nwhere \ud835\udc40 \u2208 \ud835\udc45\ud835\udc3f\u00d7\ud835\udc5d has elements \ud835\udc40\ud835\udc59(\ud835\udc53) , \ud835\udc3b \u2208 \ud835\udc45 \ud835\udc5b\u00d7\ud835\udc3f has elements \ud835\udc3b\ud835\udc56 \u2208 \ud835\udc41(0, \u2205 2)\ud835\udc56\ud835\udc56\ud835\udc51 , denoting the variation of metabolite \ud835\udc59 in the \ud835\udc56\ud835\udc61\u210e sample and \ud835\udefc \u2208 \ud835\udc45\ud835\udc3f\u00d71 such that \ud835\udefc\ud835\udc59 \u2208 \ud835\udc4b 2(\ud835\udefe)\ud835\udc56\ud835\udc56\ud835\udc51 , denoting the mean concentration of each metabolite in the sample.\nIn simulations, we fixed \ud835\udc3f , the total number of metabolites in the samples, and \ud835\udc40 , the\nmetabolite reference spectra. We then generated different datasets with different values of \ud835\udc5b, the sample size, \ud835\udefe, the degree of freedom for generating metabolite concentrations, and \u2205, the variance of generating metabolite variation. These parameters, in turn, determined the signal-to-noise ratio (SNR), calculated as the variance of signals divided by the variance of noise: \ud835\udc46\ud835\udc41\ud835\udc45 = 2L\u03b3+L \u22052\nn .\nParameter values were chosen to imitate experimental data from our lab, acquired on an 800MHz NMR spectrometer (Bruker, Inc). In particular, the mean value to generate metabolite concentrations and the variance for simulation were determined based on summary statistics from data that included both in vivo and in vitro experiments, acquired from several species such as humans, mice, and fruit flies. Means and variances of the intensities at the 25th, 50th, and 75th percentiles were calculated from this experimental data. Simulation parameters were set to have summary statistics of the simulated data matching this range of values."
        },
        {
            "heading": "2.2 Simulation setup",
            "text": "We designed three sets of synthesized spectra, in which the total number of metabolites in the sample, \ud835\udc3f, was fixed at 10, 30, or 50 metabolites, respectively. The reference spectra were chosen from the BMRB database (Ulrich et al., 2008). The spectra were generated for the chemical shift range of 0.5 to 4.0ppm. Each reference spectrum was scaled to its maximum intensity so that each spectrum was within the range (0, 1). The scaled spectra were then used to construct the matrix \ud835\udc40 in the three simulated scenarios, according to the different values of \ud835\udc3f . We generated data\naccording to models (1) and (2). In all simulations, we set \ud835\udef4 = \ud835\udc3c . We set the window size to \ud835\udc58 = 5, fixed \ud835\udefe = 60 and had either \u2205 = 12 or 25. PACF was used to examine the autocorrelation in the dataset and determined k in a manner that at the \ud835\udc58\ud835\udc61\u210e lag, the partial autocorrelation first falls into the 95 percent confidence interval. We performed analysis on two sample sizes (\ud835\udc5b = 50, 100). Each dataset (\ud835\udc5b = 50 or 100 samples per dataset) had a different combination of concentrations of the reference metabolites. However, the mean intensity of each spectrum was always the same."
        },
        {
            "heading": "2.3 Spatial clustering algorithm (SPA)",
            "text": "The first step of the SPA is to generate a correlation landscape since variables from the same functional unit tend to have stronger correlations with each other than variables from different functional units or the baseline (Fig. 2a, b). To achieve an accurate record of the relationships among individual variables, we designed a moving average approach to scan the correlations among consecutive variables. This moving average calculates the correlation landscape as the average pair-wise Pearson correlation between adjacent variables in a window of fixed size. Let us define\n\ud835\udc44(\ud835\udc57, \ud835\udc57 + \ud835\udc58) = 2\n\ud835\udc58(\ud835\udc58\u22121) \u2211 \u2211 \ud835\udf0c(\ud835\udc65.\ud835\udc57+\ud835\udc57\u2032 , \ud835\udc65.\ud835\udc57+ \ud835\udc57\" ) \ud835\udc58 \ud835\udc57\"=\ud835\udc57\u2032+1 \ud835\udc58 \ud835\udc57\u2032=1 , (3)\nwhere \ud835\udc44 is the correlation landscape, \ud835\udc57 is the index of the first variable in the window, and \ud835\udc58 is the window size. \ud835\udf0c(. ) denotes the Pearson correlation coefficient. \ud835\udc4b denotes the dataset under study, whose columns represent the data points at each ppm value and rows represent sample.\nNext, we improved the stability of the partial correlation landscape by kernel smoothing.\nBased on our simulated data, the Epanechnikov kernel,\n\ud835\udc54(\ud835\udc61) = 3\n4 (1 \u2212 \ud835\udc612) if |\ud835\udc61| \u2264 1 and 0 otherwise, (4)\nand the tri-cube kernel,\n\ud835\udc54(\ud835\udc61) = (1 \u2212 |\ud835\udc61|3)3 if |\ud835\udc61| \u2264 1 and 0 otherwise, (5)\nare best suited for spectral data. To identify SPA clusters in a spectrum (Fig. 2c), we need to set a\nthreshold on the correlation landscape . Although this threshold can be empirically determined,\nwe set it by optimizing the correlation thresholds that maximizing the stability for ppm memberships between two equally split datasets out of X (the whole dataset under study). We designed an automated procedure based on the prediction strength (Tibshirani and Walther, 2005). It is calculated as the median proportion of correctly allocated variables across all spatial clusters in a sampled set (Tibshirani and Walther, 2005). This procedure starts by first randomly splitting the data into two sets of equal sample size, set-1, and set-2. Our goal is to find the threshold \ud835\udf06, at which the spatial clusters become most stable between set-1 and set-2. At the same time, the grouped variables should be as informative as possible to represent the chemical structural information of the present metabolites. To accomplish this goal, a \ud835\udc5d \u00d7 \ud835\udc5d co-membership matrix \ud835\udc37, representing how well the memberships in set-1 can predict the memberships in set-2, is constructed. If variable \ud835\udc56 in the set-1 and variable \ud835\udc560 in the set-2 are in the same cluster, then \ud835\udc37(\ud835\udc56, \ud835\udc560) equals 1, otherwise 0. Let \ud835\udc50 be the total number of clusters, \ud835\udc5a1, \u2026 , \ud835\udc5a\ud835\udc50 denote the number of variables in each spatial cluster and \ud835\udc361, \u2026 , \ud835\udc36\ud835\udc50 are the spatial cluster memberships. For a given threshold \ud835\udf06, the prediction strength \ud835\udc43\ud835\udc51 is defined as the median proportion of correctly allocated variables, across all spatial clusters in the set-1.\n\ud835\udc43\ud835\udc51(\ud835\udf06) = \ud835\udc5a\ud835\udc52\ud835\udc51\ud835\udc56\ud835\udc4e\ud835\udc5b\ud835\udc57\u2208{1,\u2026,\ud835\udc50} 1\n\ud835\udc5a\ud835\udc57(\ud835\udc5a\ud835\udc57\u22121) \u2211 \ud835\udc3c[\ud835\udc37\u03bb(\ud835\udc56, \ud835\udc56 \u2032) = 1]\ud835\udc56\u2260\ud835\udc56\u2032\u2208\ud835\udc50\ud835\udc57 (6)\nThis process is repeated for several random folds to determine the mean and standard error\nof the prediction strength. The optimal threshold is then chosen as the lowest value whose mean prediction strength is within one standard error of the maximum mean prediction strength over all possible thresholds."
        },
        {
            "heading": "2.4 Statistical Recoupling of Variables (SRV)",
            "text": "Let \ud835\udc4b\ud835\udc5b\u00d7\ud835\udc5d denote the data matrix, with rows representing samples and columns representing spectral variables. Let us define\n\ud835\udc3f\ud835\udc57 = \ud835\udc50\ud835\udc5c\ud835\udc63\ud835\udc4e\ud835\udc5f\ud835\udc56\ud835\udc4e\ud835\udc5b\ud835\udc50\ud835\udc52\n\ud835\udc50\ud835\udc5c\ud835\udc5f\ud835\udc5f\ud835\udc52\ud835\udc59\ud835\udc4e\ud835\udc61\ud835\udc56\ud835\udc5c\ud835\udc5b (\ud835\udc65.\ud835\udc57 , \ud835\udc65.\ud835\udc57+1 ) = \u221a\ud835\udc63\ud835\udc4e\ud835\udc5f(\ud835\udc65.\ud835\udc57 )\ud835\udc63\ud835\udc4e\ud835\udc5f(\ud835\udc65.\ud835\udc57+1 ) =\n\u221a 1\n\ud835\udc5b \u2211 (\ud835\udc65\ud835\udc56,\ud835\udc57 \u2212 \ud835\udc65.\ud835\udc57\u0305\u0305 \u0305 )2\n1 \ud835\udc5b \u2211 (\ud835\udc65\ud835\udc56,\ud835\udc57+1 \u2212 \ud835\udc65.\ud835\udc57+1\u0305\u0305 \u0305\u0305 \u0305\u0305 )2 \ud835\udc5b \ud835\udc56=1 \ud835\udc5b \ud835\udc56=1 (7)\nfor \ud835\udc57 = 1, \u2026 , \ud835\udc5d . The boundaries of spectral clusters are identified by the local minima of the landscape function. The minimum number of variables in one cluster is determined by the resolution of the NMR spectra. Blaise et al. suggest discarding clusters that have less than 10 variables (Blaise et al., 2009). Representative intensities of spectral clusters are calculated as the mean of NMR signals assigned to each cluster. Super-clusters are then formed by aggregating clusters according to their correlation with neighboring ones. The authors suggest aggregating clusters with the correlation greater than 0.9 and limiting the association to a maximum of three clusters to keep efficiency in areas of highly correlated signals."
        },
        {
            "heading": "2.5 SPA input for STOCSY",
            "text": "To couple these spatial clusters with STOCSY, we first calculated each cluster\u2019s intensity as a mean value of the local-maximum peaks within the cluster and generated a new data matrix. We input this data matrix into STOCSY. Using 0.8 as the threshold for SPA-STOCSY, we identified the highly correlated clusters. We then found these clusters in the spectrum and determined the corresponding resonances. For both known and unknown metabolites, the identification can be realized using these distinguished signals and their resonances either with a reference library or by fragment-matching using the identified splitting pattern."
        },
        {
            "heading": "2.6 NMR sampling",
            "text": "The Drosophila head tissues (Control, Elav-GAL4/w1118; +; +) and human embryonic stem cells (hESCs) (1 million cells) were each dissolved in phosphate-buffered saline, pH 7.25, containing 10% D2O as a field frequency lock. One-dimensional 1H-NMR spectra were collected at 230C using an 800 MHz NMR spectrometer (Bruker Inc.). DSS (4,4-dimethyl-4-silapentane-1-sulfonic acid) was used as the internal standard for head tissues, while for hESCs we used 0.05mM TSP (Trimethylsilylpropanoic acid) as the chemical shift internal standard.\nFor Drosophila head tissues, for each free induction decay (FID), 128 transients were\nrecorded at a repetition rate of 2 sec per transient. To minimize the large water peak, the water\nsignal was pre-saturated with a low power radiofrequency (RF) pulse. For hESCs, to minimize the water peak, the ZGESGP pulse sequence from the Bruker library was selected. For each FID, the size of FID is equal to 32K, the number of dummy scans is 4, and the spectral width was 12ppm. 128 transients were recorded at a repetition rate of 1.7 sec per transient.\nFinally, spectra from both datasets were preprocessed in Topspin including Fourier\ntransform to the frequency domain, Gaussian filter, centering of the water peak to 4.7ppm, binning, phasing, baseline correction, peak alignment to the internal standard, and the normalization to the integral of the spectrum were performed. To remove the dilution factor in samples, we applied the probabilistic quotient normalization on the normalized dataset (Dieterle et al., 2006). Similar to others, we observed that the variables at baseline regions in the preprocessed data had notably high correlations. We estimated the baseline level by calculating five standard deviations from a noise region of the baseline and set the points with intensities less than the baseline level to zero, as suggested by Torgrip et al (Torgrip et al., 2008). Here, we considered the noise region as 0.08- 0.58ppm."
        },
        {
            "heading": "3 Results",
            "text": ""
        },
        {
            "heading": "3.1 SPA allows the identification of strongly correlated functional units",
            "text": "In the NMR spectrum, each metabolite has unique signatures depending on its chemical and physical structure. As noted, the signature is represented by one or more structural units, which can be singlets, doublets, or multiplets in the spectra. The SPA identifies these structural units even where many of the signals overlap (Fig. 2) because unlike existing clustering methods, which focus on individual peaks or the variation of peaks, the SPA aims to group data points that belong to the same structural unit. It does so by finding contiguous groups of data points that exhibit stronger correlations since data points from the same multiplets correlate more strongly with each other than with those from other multiplets.\nFirst, the SPA seeks to determine the relationships among individual data points. After\npreprocessing, a typical NMR spectrum has more than 3,000 data points which can generate about 5,000,000 pairs of correlations, each of which contain complex patterns. To calculate the correlation landscape, the SPA first determines the window size, which is a type of bucketing. Bucketing is commonly used to control the peak shifts in NMR data, but the drawback is a loss of resolution (Forshed et al., 2003). High-resolution bucketing is therefore needed but decreasing the\nsize of the bucket can cause the loss of spectral dependence (Blaise et al., 2009). Accordingly, the SPA uses the partial autocorrelation function (PACF) approach to determine the window size, thus balancing resolution quality and spectral dependence.\nTo illustrate, assume a data point at location n and another data point at location n-k. The\npartial autocorrelation of them is the correlation of the two data points conditionally on the data points between them. This approach estimates a window size k that data points within this window will have significantly stronger dependencies.\nTo test the performance of the SPA, we first synthesized a spectrum using 10 random\nmetabolites with complex spectra (Supplementary Fig. 1). After a series of calculations and filtering, the SPA-produced spatial clusters contained data points and peaks with the strongest correlation and without noise or baseline data points (Fig. 2b, c). Therefore, these clusters were more likely to be functional units, representing the structural information of the underlying molecules."
        },
        {
            "heading": "3.2 SPA consistently outperforms SRV in discriminating signals from noise",
            "text": "We then compared the SPA to SRV (Blaise et al., 2009), another clustering method that calculates a landscape function as the ratio of covariance and correlation between neighboring spectral data points. We were prompted to compare their performance because the two methods grouped data points of the same simulation dataset differently (Fig. 3a).\nWe designed three sets of simulated spectra, in which the total number of metabolites in\neach sample was fixed at 10, 30, or 50, respectively. (The more metabolites in a sample, the greater coverage of overlapping regions where metabolites resonate.) For each simulated set, we generated four scenarios by varying metabolites\u2019 concentrations, sample size, and sample variations (Supplementary Table 1). With these different simulation parameters, each scenario had a different SNR (Supplementary Table 1). When analyzing the spectra, an ideal method would demonstrate high true coverage (detection of true metabolite regions) and low noise coverage (detection of regions in which there is no metabolite). For each scenario, we calculated the SPA\u2019s and SRV\u2019s true coverage and noise coverage (Fig. 3b) and ran the analysis 100 times for each sample (for example, for a dataset with 50 samples, the total number of tested samples was 50 \u00d7 100 ). Increasing the total number of metabolites in the sample resulted in increased variability of both true and noise coverage for the SPA, but only noise coverage for SRV. As expected, the true\ncoverage increased with increased SNR for both methods, while the sample size did not affect the results (Fig. 3b). Comparisons of the difference between the SPA and SRV measurements were all significant according to the student\u2019s t-test (Fig. 3c, d). The SPA\u2019s advantage over SRV is demonstrated by the clear difference in their respective true coverage and noise coverage ratios (Fig. 3). This finding is of critical importance because it indicates SPA reliably discriminates signals from noise."
        },
        {
            "heading": "3.3 Coupling SPA and STOCSY achieves accurate identification of both separated and",
            "text": "overlapping metabolites on the simulated data While the SPA can identify structural units in the spectra, it cannot by itself identify their corresponding metabolites. We, therefore, coupled the SPA with STOCSY, a method that uses statistical correlations between spectral data points to identify signals originating from the same molecule (Cloarec et al., 2005). STOCSY has been used previously to explore the intra- and intermetabolite correlations within raw NMR data, but high dimensionality and overlapping signals can make STOCSY readout and interpretation cumbersome. In SPA-STOCSY, however, we input the spatial clusters selected by SPA rather than raw NMR data, and the spectrum is therefore interpreted as a series of spatial clusters rather than data points. SPA-STOCSY then provides correlations between these spatial clusters, allowing the identification of corresponding metabolites.\nWe tested the SPA-STOCSY algorithm using simulated spectra with a set of 10 metabolites\n(spectrum shown in Fig. 2a). We first calculated each cluster\u2019s intensity as a mean value of the peaks within the cluster and generated a new data matrix to be loaded into STOCSY. Using 0.8 as the threshold for SPA-STOCSY, we then identified the highly correlated clusters (Fig. 4a). Each set of highly correlated SPA clusters, when projected to the mean spectrum, displayed the reconstructed signature of the metabolites that might exist in the sample. For example, valine resonated in three clusters, which were accurately identified by SPA-STOCSY (Fig. 4b). To achieve this result, the SPA must effectively capture the true metabolite regions (Fig. 3d), and STOCSY must accurately pick up these clusters (Fig. 4a). When we input spectrum resonances that are highly correlated with clusters in the Biological Magnetic Resonance Data Bank (BMRB) database (Ulrich et al., 2008), SPA-STOCSY identified 9 out of 10 metabolites present in the simulated dataset (Fig. 4c). Thus, we conclude that the spatial clusters are close representations of\nthe resonances from metabolites that exist in each sample. Moreover, STOCSY can correctly extract clusters that belong to the same molecule.\nUpon inspection of the selected metabolites, we recognized that some reconstructed signal\nregions were incomplete, such as the glucose signal regions at 3.2 to 4ppm (Fig. 4d). This omission is caused by the overlapping signals from different molecules, which can reduce the existing correlations (Cloarec et al., 2005). However, as SPA-STOCSY identified the majority of glucose structural units, we were still able to identify this metabolite (Fig. 4d).\nPeak overlapping is a universal challenge in NMR-based metabolomic profiling, and many\nalgorithms lose accuracy when overlapping spectral peaks are present in a sample. But SPASTOCSY substantially aids the identification of molecules because of its unique ability to identify overlapping peaks. In the SPA algorithm, the correlation landscape is sensitive to even minor changes in pair-wise correlations of the consecutive k data points, in which k is the window size. The fluctuation of the correlation landscape thus represents both the connectivity strength of highcorrelation resonances that may originate from the same molecule, as well as the separation capability of resonances from different molecules or overlapping peaks (Fig. 2b). Spatial clusters tend to split where the overlapping occurs because it reduces the original strong correlations among data points originating from the same metabolite multiplet. When we apply STOCSY, the split clusters describing the same functional unit can be recombined because they are highly correlated, thus reconstructing metabolite regions. We demonstrate this property in two examples: L-proline and glucosamine-1-phosphate N-acetyltransferase, which overlap at the 2.0ppm region (Fig. 4e), and the glucose region between 3.2 to 4ppm, where the method identified glucose, dihydroxyacetone, L-tyrosine, and valine peaks (Fig. 4d). These findings indicate that the overlapping problem may be overcome by correctly identifying and splitting the structural units in the overlapping regions. When correctly identified, structural units are then coupled in the STOCSY algorithm and the true metabolite regions are reconstructed."
        },
        {
            "heading": "3.4 SPA-STOCSY provides automatic identification of metabolites and outperforms",
            "text": "current methods The SPA-STOCSY algorithm has several automated features that quickly and accurately identify candidate metabolites and potentially avoid human interference in processing NMR data. These automated features include (1) determining window size for the calculation of correlation\nlandscape; (2) deciding the threshold value for grouping data points that are likely from the same spatial cluster, according to the correlation landscape; and (3) identifying metabolites by matching highly correlated SPA clusters with the reference library. The first two parameters are determined automatically through exploration and investigation of the dataset under study. To connect the SPA-STOCSY data to the metabolite reference library, we designed an algorithm that provides a readout of all candidate molecules by matching spatial clusters resonances with the library\u2019s reference resonances. Specifically, we identified each spatial cluster\u2019s peaks using the local minimum and maximum for peak detection (Gong Lixin,Constantine William, 2012). Highly correlated spatial clusters can be transformed into a series of highly correlated peaks, which the algorithm then inputs into the reference library to find corresponding metabolites.\nWith these features, SPA-STOCSY outperforms current automated identification and\nvisualization methods. For example, MetaboID requires user selection of candidate metabolites, which introduces operator bias (Mackinnon et al., 2013). MetaboHunter enables automatic identification of metabolites (Tulpan et al., 2011), but it matches individual peaks to the reference library rather than a group of peaks that originate from the same structural unit, resulting in a high false detection rate. MetaboHunter\u2019s mutual exclusion of peaks also neglects overlapping signals, increasing the need to visually inspect the spectra for the metabolite readouts. BAYESIL segments spectra into small blocks and uses the probabilistic graphical model to estimate the metabolite concentrations and chemical shifts. But accurate quantification from BAYESIL is more applicable to specific biofluids with the sub-libraries curated from serum, plasma, and cerebrospinal fluid (CSF) (Ravanbakhsh et al., 2015). FOCUS is an integrated tool that provides a data analysis workflow to analyze 1D NMR-based metabolomics. Its metabolite identification concentrates on peak picking and matching, with the peaks extracted in pure compounds\u2019 reference spectra (Alonso et al., 2014). Although FOCUS\u2019s matching score mechanism considers peak correlations, with peak overlapping, its score is undermined due to a high proportion of zero-intensity peaks. ASICS is a linear-based tool whose accuracy depends heavily on a dedicated shifting algorithm that contains two steps: global shift and local peak distortions (Lefort et al., 2019; Tardivel et al., 2017). In the real application, the maximum allowed global shift needs to be well-tuned to reach the best alignment. This time-consuming adjustment could result from the different sensitivities among metabolites and sample heterogeneity. However, it makes it hard to set a standard among them, and it is inconvenient to tune them separately. Thus, while using residuals to find out the best\ndistortions for peaks in metabolites, ASICS is likely to align reference spectra to the wrong clusters in heavily overlapping regions.\nA biological sample is usually complex, and its total number and composition of\nmetabolites are unknown. Moreover, the composition of metabolites varies in different samples and even scans acquired from replicated samples can be slightly different. One metabolite may present in most of the samples, but not in others. Despite this complexity, the connectivity of the underlying unknown signals from the same metabolite persists and can be captured. SPA-STOCSY uses covariance patterns from a dataset to recover such connectivity, thereby identifying a given sample\u2019s missing signals that are present in many other samples in the same dataset."
        },
        {
            "heading": "3.5 Identification of metabolites in real data",
            "text": "We also tested SPA-STOCSY\u2019s performance on real data, first with a set of experimental NMR data from the head homogenates of Drosophila melanogaster (12-day-old, female, 40 heads per sample, N=10) (Fig. 5a-c). Using PACF, we determined the optimal window size for scanning the correlation landscape as 7, and we chose a tri-cube kernel smoother to calculate the correlation landscape. Following the SPA, we identified 50 clusters that exhibited strong correlations (Fig. 5a) and observed that high correlation landscape values are always localized to signal regions. In addition, some regions had lower correlation landscape values and spatial clusters were split there. The sharp decline of correlation landscape values indicated overlapping, and the splitting behavior was more common in regions between 3 to 4ppm, abundant in overlapping resonances from different metabolites. The SPA can detect minute changes in correlations among variables resulting from overlapping peaks, leading to the accurate identification of those metabolites. We then analyzed the data with STOCSY. Here, the most important step was to determine the threshold of detection, i.e., the optimal correlation to provide the maximum number of meaningful variables. In real data, the optimal correlation threshold needs to be determined by the characteristics of the spatial clustering method itself. As the SPA groups variables that exhibit strong correlations, however, there is a chance that the correlations of highly concentrated metabolites at specific regions may overwhelm the metabolites present in low concentrations. Therefore, to ensure that SPA-STOCSY captured all correlated clusters, we took advantage of the external chemical reference, DSS. DSS resonates at several frequencies along the spectrum (Ulrich et al., 2008) and these J-coupled resonances have high correlations in SPA-STOCSY. Thus, the correlation\nthreshold value when all DSS resonances were captured by STOCSY was chosen as the optimal value. Using this criterion, the optimal correlation threshold for the Drosophila head NMR dataset was 0.8.\nNext, using a similar analysis, we applied SPA-STOCSY to 22 NMR spectra from\nhESCs. Using PACF, the window size was set at 11. The SPA generated 126 clusters in total. DSS resonances were barely captured due to the distortions and low concentrations, so to determine the optimal correlation threshold for this set of spectra, we took the two clusters from choline as the reference and set this threshold at 0.8 as well.\nIn the Drosophila head data, we set the automatic detection ratio at 0.55 and identified 132\nmetabolites using the Chenomx library as reference (Supplementary Table 2). Some examples of the correctly identified metabolites are presented in Figures 5a-c. As shown, the complexity of the resonances clustered by SPA-STOCSY ranged from 1 (acetate) to > 5 (maltose), including the regions of highly overlapping signals, such as between 3.00-4.00 ppm. We also performed an analysis of the same samples using commercially available software, Chenomx (Chenomx Inc., Edmonton, Canada). Chenomx analysis identified 81 metabolites (three of which were not in our library). To discern the differences, we visually inspected the identified metabolites, focusing on those that resonated from 0.00-4.00ppm. SPA-STOCSY and Chenomx identified 55 common metabolites, while SPA-STOCSY identified more metabolites missed by Chenomx. However, it is possible that SPA-STOCSY could capture false-positive metabolites because its automatic identification is based on the peak detection and cluster positions for metabolites in the reference library. Metabolites with only one cluster are likely to be claimed as detected. Thus, metabolites with multiplets captured by SPA-STOCSY offer stronger confidence (Supplementary Table 2).\nFor the hESCs, when the detection ratio was also set at 0.55, SPA-STOCSY identified 126\nclusters and 81 metabolites. Three representative metabolites are shown in Figures 5d-f. Clearly, there is an increased level of NMR spectra complexity in the hESC samples as compared to the Drosophila samples. Nonetheless, SPA-STOCSY still captured highly correlated clusters from the same metabolite in diversified regions, with clusters ranging from singlets to multiplets. Chenomx profiling of the same hESCs data by an NMR expert identified only 24 metabolites. Compared to manual profiling, SPA-STOCSY, therefore, is more efficient and offers more testable candidates. For the 24 metabolites identified by Chenomx profiling, SPA-STOCSY detected at\nleast one cluster for each of them if their clusters were included in the reference library within the selected region (0ppm to 4ppm) (Supplementary Table 3). For most of them, SPA-STOCSY achieved a detection ratio of at least 0.5. We thus believe that SPA-STOCSY is the first method to enable automated analysis of spectra with unknown number and type of metabolites with precision and speed (seven minutes)."
        },
        {
            "heading": "4 Discussion",
            "text": "In this study, we have introduced a new algorithm, SPA-STOCSY, as an untargeted metabolome profiling tool. The SPA part of the algorithm greatly reduces the high dimensionality of the NMR dataset by transforming the data points into spatial clusters that represent functional units. First, SPA groups adjacent variables that potentially originate from the same functional unit and blindly identifies metabolites. In addition, it groups variables according to their average correlations, which can capture small changes in pair-wise correlations among variables within a determined window size, k, along the spectrum. Spatial clusters split where a sudden decline in average correlations occurs, as in the case of overlapping resonances. Therefore, the SPA aids the identification of metabolite regions by detecting overlapping components.\nWhen analyzed by a human expert, the noise and overlapping peaks are the major factors\nthat raise bias in metabolite identification. With SPA, we show its capability in making full use of the spectral information to limit the influence from a subjective bias. SPA outperforms SRV in successfully separating signal regions from noise regions. This clear signal-to-noise separation provides a good start for a human expert analysis and decrease bias. Also, later for the development of NMR quantification computational methods, the quality of the spectra is expected to be higher. SPA, which can deliver a noise-free spectrum within 2 minutes, can ease the preprocessing of realworld spectra without losing marginal spectral information.\nWith the wide applications of SPA, it has boosted performance when it is coupled with\nSTOCSY. The significant feature of the SPA enables accurate metabolite detection, as shown in both our simulation studies and real data. For metabolites identification, a crucial task is to separate the overlapping peaks. With SPA itself, it can only separate the signals from noise, but not metabolite from metabolite. And for human experts, these separation boundaries are mostly decided based on their experience, raising the problem of subjectivity and the loss of information if they choose to only focus on the dominant peaks. SPA-STOCSY can set these separation\nboundaries with less ambiguity, by applying the intrinsic features of concentration heterogeneity among metabolites within the mixture. These features can help SPA-STOCSY separate small peaks from the dominant group if they are not from the same metabolites and offer a detailed annotation for the high-overlapping region.\nHowever, SPA-STOCSY has some potential limitations and we have included some extra\nsteps to address these intrinsic concerns. Firstly, SPA-STOCSY depends on the maximum homogeneity of the investigated samples (Alves et al., 2009). This suggests that the samples selected to explore structural connectivity should have the same metabolic changes and the peak locations should be well aligned. Specifically, we assume that the correlation pattern of the dataset directly reflects the strength of proton connectivity. If the spectra in the dataset are not well aligned or the phase is not properly corrected, the correlation pattern may not completely represent the structural information of molecules in the sample. To address this concern in our analysis of real samples, we used a chemical reference, DSS, a complex compound having a singlet at 0.00 ppm. The distances between peaks are relatively stable in all the samples, so when each sample is aligned to this singlet at 0.00 ppm, all spectra are homogeneous after the alignment. Although there is a chance that small positional variation may exist in the spectra, the SPA grouping mechanism can overcome it by a proper determination of window size k for the calculation of correlation landscape. As we use average correlation instead of point-to-point correlation, a tolerance of minor perturbation is embedded. Secondly, SPA captures the variation of signals and differentiates them from noise based on the assumption that the true concentrations of underlying metabolites are not identical across samples. This concern is easily solved with the intrinsic heterogeneity in real data, as there is no pair of biological samples that is identical.\nOverall, SPA-STOCSY performs comparably to the widely used, operator-based Chenomx\nanalysis in identifying candidate metabolites, but it eliminates the possibility of operator bias while returning the results in only seven minutes of computation time. It also outperforms SRV by capturing a higher percentage of the signal regions and the close-to-zero noise regions. Furthermore, summarizing the results from NMR spectra directly, SPA-STOCSY takes the library as a reference but is not limited only to the specific library. Unlike the previous identification methods (Hao et al., 2012; Ravanbakhsh et al., 2015; Lefort et al., 2019), SPA-STOCSY can offer the non-annotated metabolites by highlighting the correlated functional units with no match to any annotated metabolite. Accordingly, SPA-STOCSY brings new insights for metabolite\ncompositions in diversified systems and offers researchers and clinicians a fast, highly accurate, and unbiased tool for NMR data analysis, with several key advantages over existing methods.\nData availability The data synthesized and generated for this study is available at https://github.com/LiuzLab/SPA_STOCSY\nCode availability\nSPA-STOCSY is implemented with R. The codes and tutorials for SPA-STOCSY are available at https://github.com/LiuzLab/SPA_STOCSY\nReferences: 1. Markley, J. L. et al. The future of NMR-based metabolomics. Current Opinion in\nBiotechnology vol. 43 34\u201340 Preprint at https://doi.org/10.1016/j.copbio.2016.08.001 (2017).\n2. Emwas, A. H. et al. Nmr spectroscopy for metabolomics research. Metabolites vol. 9\nPreprint at https://doi.org/10.3390/metabo9070123 (2019).\n3. Psychogios, N. et al. The Human Serum Metabolome. PLoS One (2011)\ndoi:10.1371/journal.\n4. Wishart, D. S. NMR metabolomics: A look ahead. Journal of Magnetic Resonance vol. 306\n155\u2013161 Preprint at https://doi.org/10.1016/j.jmr.2019.07.013 (2019).\n5. Bujak, R., Struck-Lewicka, W., Markuszewski, M. J. & Kaliszan, R. Metabolomics for\nlaboratory diagnostics. Journal of Pharmaceutical and Biomedical Analysis vol. 113 108\u2013 120 Preprint at https://doi.org/10.1016/j.jpba.2014.12.017 (2015).\n6. Newgard, C. B. Metabolomics and Metabolic Diseases: Where Do We Stand? Cell\nMetabolism vol. 25 43\u201356 Preprint at https://doi.org/10.1016/j.cmet.2016.09.018 (2017).\n7. Kennedy, A. D. et al. Metabolomics in the clinic: A review of the shared and unique features\nof untargeted metabolomics for clinical research and clinical testing. Journal of Mass Spectrometry 53, 1143\u20131154 (2018).\n8. Graaf, R. A. de. In vivo NMR Spectroscopy: Principles and Techniques. (Wiley, 2007). 9. van Beek, J. D. matNMR: A flexible toolbox for processing, analyzing and visualizing\nmagnetic resonance data in Matlab\u00ae. Journal of Magnetic Resonance 187, 19\u201326 (2007).\n10. Ludwig, C. & G\u00fcnther, U. L. MetaboLab - advanced NMR data processing and analysis for\nmetabolomics. BMC Bioinformatics 12, (2011).\n11. G\u00fcnther, U. L., Ludwig, C. & R\u00fcterjans, H. NMRLAB - Advanced NMR Data Processing\nin Matlab. Journal of Magnetic Resonance 145, 201\u2013208 (2000).\n12. Worley, B. & Powers, R. MVAPACK: A complete data handling package for NMR\nmetabolomics. ACS Chem Biol 9, 1138\u20131144 (2014).\n13. Pang, Z. et al. MetaboAnalyst 5.0: narrowing the gap between raw spectra and functional\ninsights. Nucleic Acids Res 1\u20139 (2021) doi:10.1093/nar/gkab382.\n14. Zheng, C., Zhang, S., Ragg, S., Raftery, D. & Vitek, O. Identification and quantification of\nmetabolites in 1H NMR spectra by Bayesian model selection. Bioinformatics 27, 1637\u2013 1644 (2011).\n15. Hao, J., Astle, W., de iorio, M. & Ebbels, T. M. D. Batman-an R package for the automated\nquantification of metabolites from nuclear magnetic resonance spectra using a bayesian model. Bioinformatics 28, 2088\u20132090 (2012).\n16. Lewis, I. A., Schommer, S. C. & Markley, J. L. rNMR: Open source software for identifying\nand quantifying metabolites in NMR spectra. Magnetic Resonance in Chemistry 47, (2009).\n17. Xia, J., Psychogios, N., Young, N. & Wishart, D. S. MetaboAnalyst: A web server for\nmetabolomic data analysis and interpretation. Nucleic Acids Res 37, 652\u2013660 (2009).\n18. Hollywood, K., Brison, D. R. & Goodacre, R. Metabolomics: Current technologies and\nfuture trends. Proteomics 6, 4716\u20134723 (2006).\n19. Zhang, A., Sun, H., Yan, G., Wang, P. & Wang, X. Metabolomics for Biomarker Discovery:\nMoving to the Clinic. Biomed Res Int 2015, (2015).\n20. Cloarec, O. et al. Statistical total correlation spectroscopy: An exploratory approach for\nlatent biomarker identification from metabolic 1H NMR data sets. Anal Chem 77, 1282\u2013 1289 (2005).\n21. Robinette, S. L., Lindon, J. C. & Nicholson, J. K. Statistical spectroscopic tools for\nbiomarker discovery and systems medicine. Analytical Chemistry vol. 85 5297\u20135303 Preprint at https://doi.org/10.1021/ac4007254 (2013).\n22. Robinette, S. L. et al. Cluster analysis statistical spectroscopy using nuclear magnetic\nresonance generated metabolic data sets from perturbed biological systems. Anal Chem 81, 6581\u20136589 (2009).\n23. Blaise, B. J. et al. Statistical recoupling prior to significance testing in nuclear magnetic\nresonance based metabonomics. Anal Chem 81, 6242\u20136251 (2009).\n24. Maher, A. D. et al. Statistical total correlation spectroscopy scaling for enhancement of\nmetabolic information recovery in biological NMR spectra. Anal Chem 84, 1083\u20131091 (2012).\n25. Posma, J. M. et al. Subset optimization by reference matching (STORM): An optimized\nstatistical approach for recovery of metabolic biomarker structural information from 1H NMR spectra of biofluids. Anal Chem 84, 10694\u201310701 (2012).\n26. Posma, J. M. et al. Integrated Analytical and Statistical Two-Dimensional Spectroscopy\nStrategy for Metabolite Identification: Application to Dietary Biomarkers. Anal Chem 89, 3300\u20133309 (2017).\n27. Hoijemberg, P. A. & Pelczer, I. Fast Metabolite Identification in Nuclear Magnetic\nResonance Metabolomic Studies: Statistical Peak Sorting and Peak Overlap Detection for More Reliable Database Queries. J Proteome Res 17, 392\u2013401 (2018).\n28. Forshed, J., Schuppe-Koistinen, I. & Jacobsson, S. P. Peak alignment of NMR signals by\nmeans of a genetic algorithm. Anal Chim Acta 487, 189\u2013199 (2003).\n29. Ulrich, E. L. et al. BioMagResBank. Nucleic Acids Res 36, 402\u2013408 (2008). 30. Lixin Gong, William Constantine, Y. A. C. msProcess: Protein Mass Spectra Processing in\nR. (2012).\n31. Mackinnon, N. et al. MetaboID: A graphical user interface package for assignment of 1H\nNMR spectra of bodyfluids and tissues. Journal of Magnetic Resonance 226, 93\u201399 (2013).\n32. Tulpan, D., L\u00e9ger, S., Belliveau, L., Culf, A. & \u010cuperlovi\u0107-Culf, M. MetaboHunter: An\nautomatic approach for identification of metabolites from 1H-NMR spectra of complex mixtures. BMC Bioinformatics 12, 1\u201322 (2011).\n33. Ravanbakhsh, S. et al. Accurate, fully-automated NMR spectral profiling for metabolomics.\nPLoS One 10, 1\u201315 (2015).\n34. Alonso, A. et al. Focus: A robust workflow for one-dimensional NMR spectral analysis.\nAnal Chem 86, 1160\u20131169 (2014).\n35. Lefort, G. et al. ASICS: an R package for a whole analysis workflow of 1D 1H NMR spectra.\nBioinformatics 35, 4356\u20134363 (2019).\n36. Tardivel, P. J. C. et al. ASICS: an automatic method for identification and quantification of\nmetabolites in complex 1D 1H NMR spectra. Metabolomics 13, 1\u20139 (2017).\n37. Alves, A. C., Rantalainen, M., Holmes, E., Nicholson, J. K. & Ebbels, T. M. D. Analytic\nproperties of statistical total correlation spectroscopy based information recovery in 1H NMR metabolic data sets. Anal Chem 81, 2075\u20132084 (2009).\n38. Cruz-Marcelo, A. et al. Comparison of algorithms for pre-processing of SELDI-TOF mass\nspectrometry data. Bioinformatics 24, 2129\u20132136 (2008).\n39. Tibshirani, R. & Walther, G. Cluster validation by prediction strength. Journal of\nComputational and Graphical Statistics 14, 511\u2013528 (2005).\n40. Dieterle, F., Ross, A., Schlotterbeck, G. & Senn, H. Probabilistic quotient normalization as\nrobust method to account for dilution of complex biological mixtures. Application in1H NMR metabonomics. Anal Chem 78, 4281\u20134290 (2006).\n41. Torgrip, R. J. O., \u00c5berg, K. M., Alm, E., Schuppe-Koistinen, I. & Lindberg, J. A note on\nnormalization of biofluid 1D 1H-NMR data. Metabolomics 4, 114\u2013121 (2008)."
        },
        {
            "heading": "Acknowledgement",
            "text": "We thank Cemal Karakas, MD, Soumya Patti, PhD, Marina Vannucci, PhD, and Christine Peterson, PhD for their helpful comments and inputs for this work; Advanced Technology Core support of NMR and Drug Metabolism core, the National Institute of General Medical Sciences (5R01GM120033 to M.M.S.). the Eunice Kennedy Shriver National Institute of Child Health & Human Development of the National Institutes of Health under Award Number P50HD103555 (M.M.S) for support of the Bioinformatics Core and the NMR and Drug Metabolism Core. The content is solely the responsibility of the authors and dose not necessarily represent the official views of the National Institutes of Health. The work was partially supported by the Cynthia and Antony Petrello Endowment (M.M.S.), the Chao Endowment (Z.L.) and the Huffington Foundation (Z.L.).\nAuthor contributions M.M.S., Z.L., X.H. planned and initiated the project. M.M.S., Z.L. supervised the project. I.A-R and J.B. provided Drosophila tissue for analysis. L.M. performed the NMR experiments. X.H., W.W. designed and modified the algorithm, analyzed the data. G.A. provided guidance on statistical analysis. K.M. and D.W.Y. provided guidance on the NMR data collection. X.H., W.W., M.M.S wrote the manuscript.\nCorresponding authors Correspondence to Mirjana Maletic-Savatic, Zhandong Liu.\nCompeting interests The authors declare no competing interests."
        }
    ],
    "title": "SPA-STOCSY: An Automated Tool for Identification of Annotated and Non-Annotated Metabolites in High-Throughput NMR Spectra",
    "year": 2023
}
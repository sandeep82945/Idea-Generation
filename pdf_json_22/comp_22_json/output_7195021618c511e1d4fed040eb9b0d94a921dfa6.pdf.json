{
    "abstractText": "Tissues are constituted of heterogeneous cell types. Although single-cell RNA sequencing has paved the way to a deeper understanding of organismal cellular composition, the high cost and technical noise have prevented its wide application. As an alternative, computational deconvolution of bulk tissues can be a cost-effective solution. In this study, we propose DecOT, a deconvolution method that uses the Wasserstein distance as a loss and applies scRNA-seq data as references to characterize the cell type composition from bulk tissue RNA-seq data. TheWasserstein loss in DecOT is able to utilize additional information from gene space. DecOT also applies an ensemble framework to integrate deconvolution results from multiple individuals\u2019 references to mitigate the individual/batch effect. By benchmarking DecOT with four recently proposed square lossbased methods on pseudo-bulk data from four different single-cell data sets and real pancreatic islet bulk samples, we show that DecOT outperforms other methods and the ensemble framework is robust to the choice of references.",
    "authors": [
        {
            "affiliations": [],
            "name": "Gan Liu"
        },
        {
            "affiliations": [],
            "name": "Xiuqin Liu"
        },
        {
            "affiliations": [],
            "name": "Liang Ma"
        }
    ],
    "id": "SP:85d534d959b53b858d953a3681ae4c5afac72779",
    "references": [
        {
            "authors": [
                "K. Yin",
                "S. Yan",
                "C. Qian",
                "J.C. Ho",
                "H Park"
            ],
            "title": "Swift: Scalable Wasserstein Factorization for Sparse Nonnegative Tensors",
            "venue": "arXiv preprint arXiv:2010.04081",
            "year": 2020
        },
        {
            "authors": [
                "M. Arjovsky",
                "S. Chintala",
                "L. Bottou"
            ],
            "title": "Wasserstein Generative Adversarial Networks,\u201d in International Conference on Machine Learning (PMLR), Sydney, Australia, 214\u2013223",
            "venue": "Avila Cobos, F., Alquicira-Hernandez, J., Powell, J. E., Mestdagh, P., and De Preter, K. (2020). Benchmarking of Cell Type Deconvolution Pipelines for",
            "year": 2017
        },
        {
            "authors": [
                "F. Avila Cobos",
                "J. Vandesompele",
                "P. Mestdagh",
                "K. De Preter"
            ],
            "title": "Computational Deconvolution of Transcriptomics Data from Mixed Cell Populations",
            "venue": "Transcriptomics Data. Nat. Commun",
            "year": 2018
        },
        {
            "authors": [
                "M. Baron",
                "A. Veres",
                "S.L. Wolock",
                "A.L. Faust",
                "R. Gaujoux",
                "A Vetere"
            ],
            "title": "A Single-Cell Transcriptomic Map of the Human and Mouse Pancreas Reveals Inter- and Intra-cell Population Structure",
            "venue": "Cel Syst",
            "year": 2016
        },
        {
            "authors": [
                "L.J. Carithers",
                "H.M. Moore",
                "M. Salvatore",
                "R. Phillips",
                "E. Lo",
                "S Shad"
            ],
            "title": "The Genotype-Tissue Expression (GTEx) Project",
            "venue": "Biopreservation and Biobanking",
            "year": 2015
        },
        {
            "authors": [
                "E. Denisenko",
                "B.B. Guo",
                "M. Jones",
                "R. Hou",
                "L. de Kock",
                "T Lassmann"
            ],
            "title": "Systematic Assessment of Tissue Dissociation and Storage Biases in Single-Cell and Single-Nucleus RNA-Seq Workflows",
            "venue": "Genome Biol",
            "year": 2020
        },
        {
            "authors": [
                "M. Enge",
                "H.E. Arda",
                "M. Mignardi",
                "J. Beausang",
                "R. Bottino",
                "Kim",
                "S. K"
            ],
            "title": "SCDC: Bulk Gene Expression Deconvolution by Multiple Single-Cell RNA Sequencing References",
            "venue": "Cell 171,",
            "year": 2017
        },
        {
            "authors": [
                "P. Vikman",
                "E.O. Laakso",
                "I.G. Mollet",
                "J.L. Esguerra",
                "J Taneera"
            ],
            "title": "Global Genomic and Transcriptomic Analysis of Human Pancreatic",
            "year": 2014
        },
        {
            "authors": [
                "X. Data. Han",
                "Z. Zhou",
                "L. Fei",
                "H. Sun",
                "R. Wang",
                "Y Chen"
            ],
            "title": "Learning with a Wasserstein Loss. arXiv preprint arXiv:1506.05439",
            "year": 2020
        },
        {
            "authors": [
                "H. Jin",
                "Z. Liu"
            ],
            "title": "A Benchmark for RNA-Seq Deconvolution Analysis",
            "year": 2021
        },
        {
            "authors": [
                "M. politics. Kuksin",
                "D. Morel",
                "M. Aglave",
                "Danlos",
                "F.-X",
                "A. Marabelle",
                "A. Zinovyev"
            ],
            "title": "On the Transfer of Masses",
            "venue": "Diabetes Care",
            "year": 1942
        },
        {
            "authors": [
                "P. 005 Langfelder",
                "S. Horvath"
            ],
            "title": "Wgcna: an R Package for Weighted",
            "year": 2008
        },
        {
            "authors": [
                "D.D. Lee",
                "H.S. Seung"
            ],
            "title": "Learning the Parts of Objects by Non",
            "year": 1999
        },
        {
            "authors": [
                "A. Li",
                "S. Horvath"
            ],
            "title": "Network Neighborhood Analysis with the Multi",
            "year": 2007
        },
        {
            "authors": [
                "E. Ravasz",
                "A.L. Somera",
                "D.A. Mongru",
                "Z.N. Oltvai",
                "Barab\u00e1si",
                "A-L."
            ],
            "title": "Hierarchical Organization of Modularity in Metabolic Networks",
            "venue": "Science 297 (5586), 1551\u20131555. doi:10.1126/science.1073374",
            "year": 2002
        },
        {
            "authors": [
                "A. Rolet",
                "M. Cuturi",
                "G. Peyr\u00e9"
            ],
            "title": "Fast Dictionary Learning with a Smoothed Wasserstein Loss",
            "venue": "Artificial Intelligence and Statistics (PMLR),",
            "year": 2016
        },
        {
            "authors": [
                "A. Rolet",
                "V. Seguy",
                "M. Blondel",
                "H. Sawada"
            ],
            "title": "Blind Source Separation with Optimal Transport Non-negative Matrix Factorization",
            "venue": "EURASIP J. Adv. Signal. Process. 2018. doi:10.1186/s13634-018-0576-2",
            "year": 2018
        },
        {
            "authors": [
                "Saliba",
                "A.-E.",
                "A.J. Westermann",
                "S.A. Gorski",
                "J. Vogel"
            ],
            "title": "Single-cell RNA-Seq: Advances and Future Challenges",
            "venue": "Nucleic Acids Res. 42 (14), 8845\u20138860. doi:10.1186/1755-8794-4-5410.1093/nar/gku555",
            "year": 2014
        },
        {
            "authors": [
                "R. Sandler",
                "M. Lindenbaum"
            ],
            "title": "Nonnegative Matrix Factorization with Earth Mover\u2019s Distance Metric for Image Analysis",
            "venue": "IEEE Trans. Pattern Anal. Mach. Intell. 33 (8), 1590\u20131602. doi:10.1109/tpami. 2011.18",
            "year": 2011
        },
        {
            "authors": [
                "M. Schelker",
                "S. Feau",
                "J. Du",
                "N. Ranu",
                "E. Klipp",
                "G. MacBeath",
                "B. Schoeberl",
                "A. Raue"
            ],
            "title": "Estimation of Immune Cell Content in Tumour Tissue Using Single-Cell RNA-Seq Data.Nat",
            "year": 2017
        },
        {
            "authors": [
                "M.A. Schmitz",
                "M. Heitz",
                "N. Bonneel",
                "F. Ngol\u00e8",
                "D. Coeurjolly",
                "M Cuturi"
            ],
            "title": "Wasserstein Dictionary Learning: Optimal Transport-Based Unsupervised Nonlinear Dictionary Learning",
            "venue": "SIAM J. Imaging Sci",
            "year": 2018
        },
        {
            "authors": [
                "M.A. Schmitz",
                "M. Heitz",
                "N. Bonneel",
                "F. Ngol\u00e8",
                "D. Coeurjolly",
                "M Cuturi"
            ],
            "title": "Wasserstein Dictionary Learning: Optimal Transport-Based Unsupervised Nonlinear Dictionary Learning",
            "venue": "SIAM J. Imaging Sci",
            "year": 2018
        },
        {
            "authors": [
                "\u00c5 Segerstolpe",
                "A. Palasantza",
                "P. Eliasson",
                "Andersson",
                "E.-M",
                "Andr\u00e9asson",
                "A.-C",
                "X Sun"
            ],
            "title": "Single-cell Transcriptome Profiling of Human Pancreatic Islets in Health and Type 2 Diabetes",
            "venue": "Cel Metab",
            "year": 2016
        },
        {
            "authors": [
                "R. Sinkhorn"
            ],
            "title": "Diagonal Equivalence to Matrices with Prescribed Row and Column Sums",
            "venue": "The Am. Math. Monthly 74 (4), 402\u2013405. doi:10.2307/2314570",
            "year": 1967
        },
        {
            "authors": [
                "K. Tomczak",
                "P. Czerwi\u0144ska",
                "M. Wiznerowicz"
            ],
            "title": "Review the Cancer",
            "year": 2015
        },
        {
            "authors": [
                "J. Park",
                "K. Susztak",
                "N.R. Zhang",
                "M. Li"
            ],
            "title": "Optimal Transport: Old and New, 338",
            "year": 2014
        },
        {
            "authors": [
                "A.M. Yip",
                "S. Horvath"
            ],
            "title": "From gan to Wgan",
            "year": 2019
        },
        {
            "authors": [
                "B. Zhang",
                "S. Horvath"
            ],
            "title": "A General Framework for Weighted Gene",
            "year": 2005
        },
        {
            "authors": [
                "S.Y. Zhang"
            ],
            "title": "A Unified Framework for Non-negative Matrix and Tensor",
            "year": 2021
        }
    ],
    "sections": [
        {
            "text": "DecOT: Bulk Deconvolution With Optimal Transport Loss Using a Single-Cell Reference Gan Liu1, Xiuqin Liu1* and Liang Ma2*\n1Department of Information and Computing Science, University of Science and Technology Beijing, Beijing, China, 2Key Laboratory of Zoological Systematics and Evolution, Institute of Zoology, Chinese Academy of Sciences, Beijing, China\nTissues are constituted of heterogeneous cell types. Although single-cell RNA sequencing has paved the way to a deeper understanding of organismal cellular composition, the high cost and technical noise have prevented its wide application. As an alternative, computational deconvolution of bulk tissues can be a cost-effective solution. In this study, we propose DecOT, a deconvolution method that uses the Wasserstein distance as a loss and applies scRNA-seq data as references to characterize the cell type composition from bulk tissue RNA-seq data. TheWasserstein loss in DecOT is able to utilize additional information from gene space. DecOT also applies an ensemble framework to integrate deconvolution results from multiple individuals\u2019 references to mitigate the individual/batch effect. By benchmarking DecOT with four recently proposed square lossbased methods on pseudo-bulk data from four different single-cell data sets and real pancreatic islet bulk samples, we show that DecOT outperforms other methods and the ensemble framework is robust to the choice of references.\nKeywords: bulk RNA sequencing, single-cell RNA sequencing, cell-type deconvolution, wasserstein distance, optimal transport\nINTRODUCTION\nQuantification of gene expression changes in different tissues or under different conditions gives information on how genes are regulated in organisms. The analysis of gene expression by using RNA sequencing (RNA-seq) has contributed substantially, since its development more than a decade ago, to our understanding of biological processes such as organism development, human disease progression, and patients\u2019 response to treatments. The classic RNA-seq applied to bulk tissue samples has accumulated a rich reservoir of data sets, for example, GTEx, TCGA, and so forth (Tomczak et al., 2015, Carithers et al., 2015). However, since tissues are heterogeneous, which comprise a variety of cell types, the bulk sequencing data only measure the average state of the mixed cell populations. In fact, the information of cellular composition is crucial. For example, when developing diagnostic techniques, such information would enable researchers to track the contribution of each cellular component during disease progressions (Schelker et al., 2017).\nWith the rapid development of single-cell technologies, one way to obtain a cell-specific transcriptome is to apply single-cell RNA-seq (Saliba et al., 2014). However, these experiments remain costly and noisy compared to the mature bulk RNA-seq and have therefore been performed only on a limited scale (Denisenko et al., 2020): (Kuksin et al., 2021). Alternatively, one may apply computational deconvolution algorithms with bulk data, which provide cost-effective ways to derive\nEdited by: Jiajun Zhang,\nSun Yat-sen University, China\nReviewed by: Suoqin Jin,\nWuhan University, China Xiaoqiang Sun, Sun Yat-sen University, China\n*Correspondence: Xiuqin Liu\nmathlxq@163.com Liang Ma maliang@ioz.ac.cn\nSpecialty section: This article was submitted to\nComputational Genomics, a section of the journal Frontiers in Genetics\nReceived: 30 November 2021 Accepted: 04 January 2022\nPublished: 04 February 2022\nCitation: Liu G, Liu X and Ma L (2022) DecOT:\nBulk Deconvolution With Optimal Transport Loss Using a Single-\nCell Reference. Front. Genet. 13:825896.\ndoi: 10.3389/fgene.2022.825896\nFrontiers in Genetics | www.frontiersin.org February 2022 | Volume 13 | Article 8258961\nMETHODS published: 04 February 2022 doi: 10.3389/fgene.2022.825896\ncellular composition information and have the potential to bring considerable improvements in the speed and scale of relevant applications.\nIn recent years, a number of computational deconvolution methods have been developed with the goal of estimating celltype composition within the bulk sample and/or cell-typespecific states (Avila Cobos et al., 2018); (Jin and Liu, 2021). According to whether references, such as expression profiles of pure cell types or marker gene lists, are provided, these deconvolution methods can be divided into supervised and unsupervised categories. As completely unsupervised approaches based on non-negative matrix factorization (NMF) suffer from low deconvolution accuracy and interpretation of their results largely depends on the ability to recover meaningful gene features or expression profiles for different cell types, the most commonly used methods are under the supervised category and are often optimized by least squares algorithms (Avila Cobos et al., 2018). The rapid accumulation of publicly available scRNA-seq data on a number of different samples (Baron et al., 2016), (Guo, 2020), led to the recent popularization of developing deconvolution methods with scRNA-seq references. For instance, Bisque learned the gene-specific conversion of bulk data from the scRNA-seq reference, eliminating the technical deviation of the sequencing technology between reference and bulk data (Jew et al., 2020). MuSiC proposes a weighted non-negative least squares regression framework that simultaneously weighs each gene through cross-subject and cross-cell variation (Wang et al., 2019). SCDC extends the MuSiC method and proposes an ensemble framework which applies multiple scRNA-seq data sets as reference deconvolution. They claim that SCDC can implicitly solve the batch effect between reference data sets in different experiments (Dong et al., 2019).\nBesides square loss, divergence functions for characterizing differences between two distributions, for example, KullbackLeibler divergence, are also commonly applied as loss functions in solving deconvolution problems (Lee and Seung, 1999). These losses, as well as square losses, decompose vectors or distributions in an elementwise manner, which neglects relationships between features (in our case, correlations between genes) (Zhang, 2021), (Afshar et al., 2020).\nRecently, the Wasserstein distance, which originated from the optimal transport (OT) problem (Monge, 1781); (Kantorovich, 1942), has shown its potential as a better loss function for measuring the distance between distributions (Langfelder and Horvath, 2008); (Arjovsky et al., 2017). Wasserstein distance utilizes a metric between features (e.g., genes) called ground cost to take advantage of additional knowledge from the feature space (Rolet et al., 2016). Especially, when comparing two non-overlapping distributions (distributions with nonoverlapping support), Wasserstein distance can still provide a smooth and meaningful measure, which is a desirable property that square loss and other divergence losses cannot offer (Weng, 2019), (Schmitz et al., 2018a). Since the first application of Wasserstein loss in solving NMF problems in Sandler and Lindenbaum, 2011, it has been successfully applied to blind\nsource decomposition (Rolet et al., 2018), dictionary learning (Rolet et al., 2016), (Schmitz et al., 2018b), and multilabel supervised learning problems.\nCell types are characterized in gene space. The expression of genes is not mutually independent. The co-expression of genes naturally induces a similarity or distance metric among genes (Langfelder and Horvath, 2008). To the best of our knowledge, such a relationship has not yet been leveraged to solve cell-type devolution problems.\nHere, we present DecOT, a bulk gene expression deconvolution method that uses the optimal transport distance as a loss and applies an ensemble framework to integrate reference information from scRNA-seq data of multiple individuals. We apply different ground cost metrics for characterizing gene relations in DecOT. We optimize DecOT under an entropic regularized form. We test the performance of DecOT on pseudo-bulk mixtures generated from different data sets and evaluate its robustness when different reference data are supplied. Finally, we applied DecOT on a real pancreatic islet bulk data set. DecOT is available on GitHub (https://github.com/lgustb/DecOT)."
        },
        {
            "heading": "MATERIALS AND METHODS",
            "text": "In this section, we will first give a brief review of the original Wasserstein distance and the optimization algorithm with entropic regularization. Then, we will introduce our proposed DecOT framework for deconvolution. Finally, we will describe the data sets and procedures used for benchmarking DecOT."
        },
        {
            "heading": "Wasserstein Distance and Entropic Regularization",
            "text": "Wasserstein distance, originated from the optimal transport problem (Monge, 1781); (Kantorovich, 1942), aims at minimizing transportation costs between two probability distributions. Given two histograms, p \u2208 \u03a3n and q \u2208 \u03a3s , the Wasserstein distance between p and q with respect to ground cost M is\nW(p, q)M def min T\u2208U(p,q) <M,T> (1)\nwhere \u03a3n def{q\u03f5Rn+|< q, 1> 1} is the set of histograms or an n-dimensional simplex; <X,Y> def tr(XTY) \u2211mi 1Xi, Yi is the Frobenius dot product between matrices X and Y; U(p, q) {T \u2208 Rn\u00d7s+ | T1 pTT1 p} is called the transportation polytope of p and q; M is the transportation cost of mapping p to q, which is also called the ground cost. W is a distance whenever Mij is a metric in these two histograms\u2019 element space (Villani, 2009).\nThe computation of Wasserstein distance is extremely costly when the histograms\u2019 dimension exceeds a few hundreds. Cuturi et al. (Cuturi, 2013) introduced an entropic regularizer to smooth the optimal transport problem, which can be computed at several orders of a magnitude faster in speed than traditional algorithms\nFrontiers in Genetics | www.frontiersin.org February 2022 | Volume 13 | Article 8258962\nW\u03b3(p, q)M def min T\u2208U(p,q) <M,T> \u2212 \u03b3h(T) (2)\nwhere \u03b3> 0 is a hyperparameter. h(T) def \u2212<T, logT> \u2212\u2211i,j Tijlog(Tij) is the entropic function.\nThe problem (Eq. 2) is strongly convex, and the solution of transport plan Tp can be optimized by solving a matrix balancing problem, which is typically solved using the fixed point Sinkhorn algorithm (Sinkhorn, 1967). The hyperparameter \u03b3 plays an important role in the final performance of Sinkhorn, with higher values of \u03b3 corresponding to a faster execution of the algorithm but a more diffused coupling. In this study, unless otherwise noted, we use \u03b3 0.001 by default."
        },
        {
            "heading": "Cell-Type Deconvolution with Wasserstein Loss",
            "text": "In this section, we will introduce the bulk tissue deconvolution framework by applying the Wasserstein distance as a loss function, which is the core part of DecOT.\nWe assume that each cell type has a unique expression profile which can be characterized by a distribution/histogram in gene space; for instance, we denote the expression profile over n genes of cell type i as Ci \u2208 \u03a3n. Thus, the cell type-specific profiles of k types can be represented as a k \u00d7 n matrix,C \u2208 \u03a3kn. For a set of normalized bulk tissue samples Y {Y1, . . . , Ym: Yj \u2208 \u03a3n,\u2200j}, the deconvolution problem is to solve the cell-type proportion or mixture proportion P \u2208 \u03a3mk for them bulk samples by giving celltype-specific profiles C, which can be represented by\nY \u2248 C \u00b7 P To avoid individual/batch effects, here, we use reference data from a single individual. The annotated scRNA-seq reference data are then used by averaging the cell expressions within each cell type to generate C. The Wasserstein distance not only measures the difference between two distributions but also accounts for the underlying geometry of the feature (gene) space through the choice of an appropriate ground cost. Since the expression of genes is not mutually independent, the co-expression pattern between pairs of genes naturally induces a similarity or a distance metric among genes. Such a relationship forms the transportation cost among genes (ground cost M) and will be incorporated in the minimization of Wasserstein distance between the bulk sample gene expression distribution Y and the estimated mixture CP\u0302. In order to ensure a trackable calculation for data containing thousands of genes, we apply the entropic regularized Wasserstein distance as a loss, which results in solving the following optimization problem\nmin P\u2208\u03a3m\nk\n\u2211m j 1W\u03b3(Yj, CPj)M s.t. CP \u2208 \u03a3mn (3)\nIn addition, since the cell-type proportions are non-negative, we further added a regularization term, as performed by Rolet et al. (Rolet et al., 2016) in solving the dictionary learning problem\nwith a fixed dictionary, to enforce non-negativity constraints on the variables\nmin P\u2208\u03a3m\nk\n\u2211m j 1W\u03b3(Yj, CPj)M \u2212 \u03c1E(Pj) s.t. CP \u2208 \u03a3mn (4)\nwhere E is defined for matrices whose columns are in the simplex as E(A) <A, logA> and \u03c1> 0 is a hyperparameter. In this study, unless otherwise noted, we use \u03c1 0.001 by default."
        },
        {
            "heading": "Ensemble Deconvolution Results Across Individuals",
            "text": "With the accumulation of publicly available single-cell data, references from multiple individuals may be available. In order to resolve variabilities in gene expression between references from different individuals, we adopt an ensemble approach similar to SCDC (Dong et al., 2019). The difference is that we focus on individuals rather than reference data sets of different experimental platforms. Assuming that single-cell data sets from R reference individuals are available, we first deconvolve the bulk gene expression data with entropic regularized Wasserstein loss as described above for each individual reference. Let C\u0302(r) and P\u0302(r) denote the cell-type-specific average expression matrix and the cell-type proportion matrix computed from the rth reference individual. Our goal is to find the optimal combination strategy to ensemble the available deconvolution results\n(w\u03021, w\u03022, . . . , w\u0302R) argmin (w1 ,w2 ,...,wR)\nl(P,\u2211R r 1wrP\u0302(r)) (5)\nwhere l is the loss function. As explained by Dong in SCDC (Dong et al., 2019), function (5) cannot be optimized directly since the actual cell-type proportionsP are unknown, and the solutions to function (5) are approximately equivalent to minimize the loss of gene expression levels. Therefore, we change the optimization problem to\n(w\u03021, w\u03022, . . . , w\u0302R) argmin (w1 ,w2 ,...,wR) l(Y,\u2211R r 1 wrY\u0302(r))\nwhere Y\u0302(r) C\u0302(r)P\u0302(r) is the rth individual\u2019s predicted bulk gene expression levels.\nWe redefine the problem to non-negative least squares regression by choosing the l2 norm as loss\nmin Y \u2212\u2211R\nr 1 wrY\u0302(r)\n2 s.t.\u2211 R r 1 wr 1, wr > 0\nIntuitively, wr can be seen as the similarity of cell expression profiles between rth reference individual and a bulk tissue-derived individual."
        },
        {
            "heading": "Ground Cost Selection",
            "text": "In Wasserstein distance, a key factor is the ground cost matrix M, which defines the transportation cost. We obtain M from the reference cells an expression histogram X whose columns correspond to cells and whose rows correspond to genes. Mij represents the dissimilarity of expression between gene i and\nFrontiers in Genetics | www.frontiersin.org February 2022 | Volume 13 | Article 8258963\ngene j in reference cells. Here, we focus on four metrics, including\n(i) Euclidean distance: ||x \u2212 y||2 \u2211ni 1(xi \u2212 yi)2\u221a .\n(ii) Cosine similarity: cos(x, y) xy||x||2 \u00d7 ||y||2. We use 1 \u2212 cos(x, y) as distance.\n(iii) Pearson correlation: cor(x, y) cos(x \u2212 x, y \u2212 y), where x and y are the mean of the values of x and y, respectively. We use 1 \u2212 cor(x, y) as distance. (iv) Topological overlap-based dissimilarity measure (dissTOM) (Ravasz et al., 2002; Li and Horvath, 2007; Yip and Horvath, 2007) underweighted gene co-expression network analysis framework (Zhang and Horvath, 2005)\nd\u03c9ij 1 \u2212 \u2211uaiuauj + aij\nmin {\u2211uaiu,\u2211uaju} + 1 \u2212 aij where aij is the power adjacency function. dissTOM metric measures the distance between genes in a co-expression network, which is converted into a scale-free network. We use a python package POT (Flamary et al., 2021) to compute metrics (i)\u2013(iii) and WGCNA (Langfelder and Horvath, 2008)..., a R package ... to compute dissTOM.\nBenchmark Data Sets and Artificial"
        },
        {
            "heading": "Pseudo-bulk Mixtures",
            "text": "To evaluate DecOT and compare it to other deconvolution methods using l2 norm loss, we generated artificial pseudobulk mixtures from four real RNA-seq data sets (see Table 1). We partly adopt the preprocessing and quality control pipeline in Cobos et al. (Avila Cobos et al., 2020) to the original data, which include filtering genes with all zero expression or zero variance, removing cells with the library size deviating from the mean size over three median absolute deviations (MADs), keeping genes with at least 5% of all cells having a UMI or read count greater than 1, and retaining cell types with at least 50 cells passing the quality control step (Avila Cobos et al., 2020).\nAfter quality control, for each individual in each data set, we split their cells evenly into the reference set and testing set with similar distribution of cell types. Then, we generate 200 pseudo-bulk mixtures by randomly sampling 60% of the cells each time in testing data sets and aggregate the expression counts of each gene to generate the pseudo-bulk\nsample. The true cell-type proportions are recorded, which allows us to benchmark the performance of different deconvolution methods. The flow chart for constructing pseudo-bulk mixtures is shown in Supplementary Figure S1.\nTo evaluate the performance of deconvolution methods, we need to measure the deviation of the estimated proportion P\u0302 to the true P. Here, we apply the Pearson correlation coefficient and root-mean-squared error (RMSE) to evaluate the performance of deconvolution methods:\n(i) Pearson correlation: cor(P, P\u0302); (ii) Root-mean-squared error: RMSE = 1 k\u00b7m\u2211ki\u2211mj (Pi,j \u2212 P\u0302i,j)2\u221a ."
        },
        {
            "heading": "RESULTS",
            "text": ""
        },
        {
            "heading": "Method Overview",
            "text": "Since Wasserstein distance has been successfully applied to blind source decomposition (Rolet et al., 2018) and dictionary learning (Rolet et al., 2016), (Schmitz et al., 2018b) problems with excellent performance, we aimed to apply Wasserstein loss on the bulk deconvolution problem. We propose DecOT, which applies Wasserstein loss to estimate the relative abundance of cell types within a bulk sample by using a scRNA-seq reference ensemble of multi-individuals. An overview of DecOT is shown in Figure 1. DecOT first solves the entropic regularized Wasserstein loss for the cell-type deconvolution problem (Cell Type Deconvolution with Wasserstein Loss formula 4) based on a single individual reference constitute of scRNA-seq data with annotated cell types. Wasserstein distance aims to find the optimal transport plan under a given transportation cost. In our case, the transportation cost, also referred to as the \u201cground cost,\u201d represents the similarity or distance among genes. Therefore, the application of Wasserstein loss can take advantage of the relationship between genes to get an accurate estimate.\nWhen references from multi-individuals are available, to minimize the possible bias induced by individual and/or platform variations across different individual references, we apply an ensemble framework similar to SCDC (Dong et al., 2019), which aims to solve batch effects between reference data sets. Instead of weighting deconvolution results across a data set, DecOT seeks to optimize weights on results based on each\nTABLE 1 | Four real scRNA-seq data sets.\nData set Tissue type Data type Protocol Individual samples Cells Genes Cell types\nBaron (GSE84133) Baron et al. (2016) Pancreatic islet Single-cell RNA-seq Illumina HiSeq 2,500 (InDrop) 4 7,876 8,415 10 E-MTAB-5061 Segerstolpe et al. (2016) Pancreatic islet Single-cell RNA-seq Smart-seq2 10 1901 14,200 7 GSE81547 Enge et al. (2017) Pancreatic islet Single-cell RNA-seq Smart-seq2 8 2073 11,861 5 Kidney.HCL Han et al. (2020) Guo, (2020) Kidney Single-cell RNA-seq Microwell-seq 3 20,601 2,748 13\nFrontiers in Genetics | www.frontiersin.org February 2022 | Volume 13 | Article 8258964\nindividual reference. In this way, the individual or batch effects can be accounted for simultaneously by DecOT."
        },
        {
            "heading": "DecOT Outperforms Deconvolution Methods Based on Squared Loss",
            "text": "We evaluate DecOT with different ground costs as listed in Ground Cost Selection, which we refer to as DecOT_dissTOM, DecOT_euclidean, DecOT_cosine, and DecOT_correlation. For these four settings, we apply the aggregated reference, which is, pooling cells from multiple individuals to generate a single reference. In addition, we also evaluate DecOT with dissTOM under the ensemble framework (referred to as DecOT_disTOM_ensamble). The various settings of DecOT are then compared to four other square loss-based methods (including Nonnegative least squares (NNLS), MuSiC, SCDC, and Bisque) on artificial pseudo-bulk mixtures generated from four scRNA-seq data sets (Table 1, Methods). Since it is possible by design to assay both bulk-RNA and scRNA from the same\nindividual (Kuksin et al., 2021), we consider settings of reference data in two situations:\na) There are annotated single-cell reference data from the same individual, from which the bulk sample is collected. We term such a situation as \u201cpaired\u201d. b) Reference data are all collected from other individuals. We refer to such a scenario as \u201cunpaired\u201d.\nWe mimic the \u201cpaired\u201d situations in the benchmark by including cells (in the reference set) from the same individual for generating a pseudo-bulk sample (in the testing set) (Supplementary Figure S1).\nFigure 2 shows the benchmark result of data set GSE81547 from Enge et al. (Enge et al., 2017) under these two situations. Applying DecOT under the ensemble framework has the best overall performance compared to other settings and methods. The average RMSE of DecOT_dissTOM_ensemble over all pseudo-bulks is 0.037 and 0.056 under paired and unpaired\nFrontiers in Genetics | www.frontiersin.org February 2022 | Volume 13 | Article 8258965\nsituations, respectively, and the average correlation is 0.946 and 0.893 (Figure 2A). Figure 2B shows the detailed estimation results of individual sample 54_male in GSE81547. DecOT with an ensemble framework using dissTOM shows the greatest performance. Even when applying aggregated references, Wasserstein\u2019s loss still outperforms NNLS.\nIn order to show the overall quality of the various methods in pseudo-bulk mixtures generated from different samples in GSE81547, we compared the mean RMSEs and mean Cors, which result from performing different methods on the pseudo-bulk generated based on different individuals (Figure 2C). For each individual, we rank the results across different methods and rescale them to the interval between 0 and 1. As shown in Figure 2C, the dark-red and larger points within a line represent a smaller RMSE and a larger Cor. In general, DecOT using Wasserstein loss has better performance than square loss methods in most cases, and the ensemble framework can further improve the accuracy of the\ndeconvolution results even when the mixtures and reference cells come from different individuals.\nSimilar conclusions are also obtained from benchmarks based on the other three data sets. The results are shown in Supplementary Figures S2\u2013S4."
        },
        {
            "heading": "DecOT Performs Robustly Under the Ensemble Framework",
            "text": "The choice of reference in solving the supervised deconvolution problem is crucial. We first compare the performance of DecOT by using references from different individuals. In detail, we evaluate DecOT on the pseudo-bulk generated from the testing set of 54_male in GSE81547 by respectively applying reference data from each individual as well as under the ensemble framework (paired and unpaired). Figure 3A shows the result out of 200 pseudo-bulk mixtures in each reference setting. Using references from the same individual (reference set\nFIGURE 2 | Benchmark results using data set GSE81547. (A) Average RMSE and Cor of the deconvolution results of all mixtures in data set GSE81547. From the overall results, the estimation of DecOT with the ensemble framework has smaller errors and stronger correlation than other methods. (B) Boxplot of RMSE from 200 replicate pseudo-bulk mixtures from sample 54_male. The top/bottom panel shows the results under paired/unpaired situation. (C)Overview of deconvolution results of individual pseudo-bulk mixtures across all methods in data set GSE81547. For each individual, we rank the results across different methods and rescale them to the interval between 0 and 1. A darker-red and larger point within a line represents a smaller RMSE and a larger Cor. Both paired (top) and unpaired (bottom) situations are considered.\nFrontiers in Genetics | www.frontiersin.org February 2022 | Volume 13 | Article 8258966\nfrom 54_male) outperforms the situation of applying references from other individuals (Figure 3A). The deconvolution performance is slightly improved with integrating results across all individuals (paired), indicating that the DecOT ensemble framework makes use of information from other individuals to adjust the final estimation. Such a finding is further confirmed in the case under the unpaired reference situation; when excluding 54_male from the reference, the estimation of DecOT under the ensemble framework still obtains a smaller error than using other single individual references. In fact, including more individual references under the ensemble framework tends to improve the performance of deconvolution (Supplementary Figure S5).\nDeconvolution with paired single-cell data as a reference will greatly improve the performance. However, in a more realistic scenario, single cells collected from the same individual may have missing cell types as compared to the paired bulk sample, especially when the cell type is rare. Therefore, we conducted an experiment by gradually and cumulatively removing cell types in ascending order of cell count in the reference set of 54_male (Supplementary Table S1) and used the data with the missing cell type as a reference. When there is a missing cell type in the\nreference, the deconvolution may allocate the expression of the missing cell type to other types, which leads to biased estimation (Figure 3B). One way to reduce such bias is to impute the missing cell type in the reference by utilizing a publicly available data set as a surrogate. Here, we use the mean expression of the missing cell type from references of other individuals for imputation (Figure 3C). Compared to the results in Figures 3B,C, imputation of missing cell types significantly improves the performance of deconvolution. Nevertheless, regardless of imputation, the estimation error will get worse as the number of missing cell types increases.\nAnother possible way for reducing the impact caused by missing cell types in paired single-cell references is to apply DecOT under the ensemble framework. Since our ensemble framework integrates deconvolution results respectively performed under each individual reference, we can still apply imputation on missing cell types in the paired reference. Table 2 compares the average RMSE of cases based on single references from paired single-cell data (RMSE-54_male) and ensemble references which account all possible individuals (RMSEensemble). In addition, we use the unpaired ensemble case as\nFrontiers in Genetics | www.frontiersin.org February 2022 | Volume 13 | Article 8258967\nTABLE 2 | Optimal weights of different individual references under the DecOT ensemble framework. The weights and the overall performance are compared under different settings of the missing cell type in the paired reference of sample 54_male. Imputation indicates that the reference profiles of missing types are imputed by references from other individuals.\nOptimal weight with imputation RMSE-54_male RMSE-ensemble\n1_male 21_male 22_male 38_female 44_female 54_male 5_male 6_male\n54_male-all 0.0000 0.0000 0.1654 0.0000 0.0000 0.7504 0.0842 0.0000 0.0190 0.0175 54_male-delta 0.0000 0.0000 0.1691 0.0000 0.0000 0.7412 0.0817 0.0081 0.0234 0.0215 54_male-delta-ductal 0.0000 0.0000 0.1772 0.0000 0.0000 0.7293 0.0830 0.0104 0.0234 0.0218 54_male-delta-ductal-acinar 0.0000 0.0000 0.1684 0.0000 0.0000 0.6985 0.0934 0.0397 0.0318 0.0289 54_male-delta-ductal-acinar-beta 0.0000 0.0000 0.1765 0.0000 0.0475 0.6251 0.1509 0.0000 0.0359 0.0306 54_male-unpair 0.0000 0.0000 0.5114 0.0000 0.1837 \u2014 0.1487 0.1561 \u2014 0.0227\nOptimal weight without imputation RMSE-54_male RMSE-ensemble\n1_male 21_male 22_male 38_female 44_female 54_male 5_male 6_male\n54_male-all 0.0000 0.0000 0.1462 0.0000 0.0000 0.7483 0.0859 0.0196 0.0190 0.0172 54_male-delta 0.0000 0.0000 0.1558 0.0000 0.0000 0.7310 0.0901 0.0231 0.0211 0.0165 54_male-delta-ductal 0.0000 0.0000 0.1625 0.0000 0.0000 0.7069 0.1093 0.0212 0.0293 0.0237 54_male-delta-ductal-acinar 0.0000 0.0000 0.2971 0.0000 0.0545 0.3624 0.2173 0.0686 0.1268 0.0444 54_male-delta-ductal-acinar-beta 0.0000 0.0000 0.4654 0.0000 0.1840 0.0081 0.1670 0.1755 0.6834 0.0226 54_male-unpair 0.0000 0.0000 0.4692 0.0000 0.1855 \u2014 0.1683 0.1770 \u2014 0.0224\nFrontiers in G enetics |w w w .frontiersin.org\nFebruary 2022 |V olum e 13 |A rticle 825896 8\nLiu et al. D econvolution w ith O ptim alTransport Loss\nFrontiers in Genetics | www.frontiersin.org February 2022 | Volume 13 | Article 8258969\na baseline. The weight contributions of references from each individual are also displayed in Table 2. Since the pseudo-bulk mixtures are constructed from 54_male, the reference from one\u2019s own cell (self-ref) contributed the most to the ensemble result. The weight contribution from self-ref decreases with the increasing number of missing cell types. The ensemble DecOT estimation under the ensemble framework is always better than using a single reference, even though it is collected from the same individual as for the bulk sample. Such a result verifies that the ensemble framework can integrate the information of multiple individuals to get a better estimate even if there is a cell type missing in the paired reference. In general, the results from the ensemble framework are rather robust under missing cell types in paired references (regardless of whether they are imputed or not)."
        },
        {
            "heading": "Performance of DecOT on Human",
            "text": "Pancreatic Islet Data Next, we apply DecOT with dissTOM as the ground cost to deconvolve the bulk samples of 89 human islets from Fadista et al. (Fadista et al., 2014), which contains 51 healthy individuals, 26 type 2 diabetic (T2D) individuals, and 12 unknown individuals. We focus on the composition of six cell types of interest (alpha, beta, delta, gamma, acinar, and ductal) in the human pancreatic islet. We use three groups of scRNA-seq references, denoted as the Baron reference (Avila Cobos et al., 2020), Segerstolpe reference (Segerstolpe et al., 2016), and ensemble reference, which combine data from both studies. Figure 4A shows the deconvolution results of DecOT on the six types of cells by contrasting the status of individuals (normal or T2D). The proportion of beta cells that secrete insulin will gradually decrease with the progression of type 2 diabetes (T2D) (Kanat et al., 2011), (Hou et al., 2015). DecOT can successfully detect such a proportion difference between normal and T2D patients, regardless of which group of reference is used for analysis. In addition, we also apply independent sample t-tests on the beta cell proportion estimated by DecOT between normal and T2D groups. The estimates of DecOT based on all three reference groups all result in significant differences in beta cell proportion between normal and T2D samples (Figure 4B). When comparing the results with those of the four other deconvolution methods, DecOT shows the most significant p-values (Figure 4B). Note that for the ensemble reference, SCDC applies its built-in ENSEMBLE method, which weighs the deconvolution results across two sources of references. The other methods directly use the pooled data as references.\nPrevious studies have shown that in human pancreatic islet samples, hemoglobin A1c (HbA1c) is an important biomarker of type 2 diabetes, and its expression level should be negatively correlated with beta cell functions (Kanat et al., 2011), (Hou et al., 2015), (Frogner et al., 2015). We perform linear regression to the estimates of beta cell proportion (BP) by HbA1c and adding age, gender, andBMI as covariates.Figure 4C shows the regression results. The estimates of BP by NNLS and BisqueRNA failed to recover a significant negative correlation to the level of HbA1c. The beta cell proportion estimated by DecOT, MuSiC, and SCDC based on the three groups of references discovered significant negative correlations withHbA1c.When using a single-source reference, DecOT calculated\nthe smallest p-values (0.0599 and 0.0514), indicating a more significant correlation between BP and HbA1c levels. In fact, the estimated BP by DecOT is robust over all three groups of references, which can be seen from the variation between the slops of the fitted regression line in Figure 4C. In contrast, the slopes have greater differences in MuSiC and SCDC cases when a different reference is applied. In short, DecOT shows better performance on real data sets and is robust to different sources of references."
        },
        {
            "heading": "DISCUSSION",
            "text": "In this study, we proposed DecOT, which applies single-cell data as references and uses Wasserstein distance as a loss function for decomposing bulk cell types. Compared with the commonly used square loss methods, the optimization of Wasserstein loss in DecOT is able to utilize additional information from gene space, for example, ground cost induced by gene-gene relations. By benchmarking DecOT with four recently proposed square loss-based methods on pseudo-bulk data from four different single-cell data sets and real pancreatic islet bulk samples, DecOT shows superior performance.\nWasserstein loss accounts for the distance between genes through the ground cost matrix. In this study, we evaluated four possible choices of ground cost, namely, three common metrics (Euclidean distance, cosine similarity, and Pearson correlation) and the dissTOM distance based on gene co-expression networks. In the analysis of simulated data, the final deconvolution effect of the four metrics did not showmuch difference; however, since the topological overlapmeasure (TOM) has been considered amore robustmeasure of gene interconnections (Li and Horvath, 2007), we recommend using dissTOM over other metrics.\nAlthough DecOT obtains better deconvolution accuracy by using Wasserstein loss, optimization of such a loss also brings a greater computational cost. The application of entropic regularization allows tractable computation of data sets on a larger scale. However, there is a trade-off between accuracy and computation time. This trade-off can be tuned by the two hyperparameters \u03b3 and \u03c1. In Supplementary Figure S6, we show the calculation time of DecOT under different numbers of genes and the accuracy and time of DecOT calculations under different choices of two regularization parameters. We show that the performance of DecOT is rather robust with parameters in the range of \u03b3\u2264 0.05 and \u03c1\u2264 0.01, which results in higher calculation accuracy.\nWhen applying a supervised bulk-cell-type deconvolution algorithm, the possible individual variation and batch effect should be noted when combining references from multiple individuals and/or data sets. DecOT uses an ensemble framework to weigh the deconvolution across multiple results from each individual reference to mitigate individual effects. The weights of the ensemble framework indicate, to a certain extent, the similarity of the gene distribution between the reference individuals and the bulk samples. In the benchmarks on pseudo-bulk data, DecOT using the ensemble framework shows improved accuracy and robustness over existing methods in most scenarios.\nThe performance of deconvolution will be greatly improved when paired single-cell references are available. However, there can be a problem regarding the cell-type integrity in the paired\nFrontiers in Genetics | www.frontiersin.org February 2022 | Volume 13 | Article 82589610\nreference. We have tested two solutions in the study, imputation of themissing cell types, and/or applying the ensemble framework with DecOT. The results show that the ensemble framework can effectively utilize information of missing cell types from other reference individuals by adjusting the weights. Although the imputation solution also achieves acceptable results, the ensemble framework of DecOT shows more robust performance."
        },
        {
            "heading": "DATA AVAILABILITY STATEMENT",
            "text": "All the data sets used for this study can be found at GitHub: https://github.com/lg-ustb/DecOT. These data sets are downloaded from their respective sources: GSE84133, GSE81547, E-MTAB-5061, GSE134355, and GSE50398 and https://figshare.com/articles/HCL_DGE_Data/7235471."
        },
        {
            "heading": "AUTHOR CONTRIBUTIONS",
            "text": "GL and LM designed research. GL, LM, and XL discussed the ideas and supervised the study. GL performed the research. GL\nand LM wrote the manuscript. All authors approved the final manuscript."
        },
        {
            "heading": "FUNDING",
            "text": "This work was supported by the National Key R&D Program of China (2019YFA0709501) and the National Natural Science Foundation of China (11971459; 31772435)."
        },
        {
            "heading": "ACKNOWLEDGMENTS",
            "text": "We thank the editor and the reviewers for their helpful comments and suggestions."
        },
        {
            "heading": "SUPPLEMENTARY MATERIAL",
            "text": "The SupplementaryMaterial for this article can be found online at: https://www.frontiersin.org/articles/10.3389/fgene.2022.825896/ full#supplementary-material"
        }
    ],
    "title": "DecOT: Bulk Deconvolution With Optimal Transport Loss Using a Single-Cell Reference",
    "year": 2022
}
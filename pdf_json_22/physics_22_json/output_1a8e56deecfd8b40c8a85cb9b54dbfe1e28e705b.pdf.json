{
    "abstractText": "Abstract. Cosmological simulations play an increasingly important role in analysing the observed large-scale structure of the Universe. Recently, they have been particularly important in building hybrid models that combine a perturbative bias expansion with displacement fields extracted from N-body simulations to describe the clustering of biased tracers. Here, we show that simulations that employ a technique referred to as \"Fixing-and-pairing\" (F&P) can dramatically improve the statistical precision of such hybrid models. Specifically, by numerical and analytical means, we show that F&P simulations provide unbiased estimates for all statistics employed by hybrid models while reducing, by up to two orders of magnitude, their uncertainty on large scales. This roughly implies that an EUCLID-like survey could be analysed using simulations of 2Gpc a side \u2013 a 20% of the survey volume. Our work establishes the robustness of F&P for current hybrid theoretical models for galaxy clustering, an important step towards achieving an optimal exploitation of large-scale structure measurements.",
    "authors": [
        {
            "affiliations": [],
            "name": "Francisco Maion"
        },
        {
            "affiliations": [],
            "name": "Raul E. Angulo"
        },
        {
            "affiliations": [],
            "name": "Matteo Zennaro"
        }
    ],
    "id": "SP:99876645cfef171661a24a2e2be6a89ef55bdc7c",
    "references": [
        {
            "authors": [
                "Luca Amendola"
            ],
            "title": "Cosmology and fundamental physics with the Euclid satellite",
            "venue": "Living Reviews in Relativity",
            "year": 2018
        },
        {
            "authors": [
                "R.E. Angulo",
                "S.D.M. White"
            ],
            "title": "One simulation to fit them all - changing the background parameters of a cosmologicalN-body simulation",
            "venue": "Monthly Notices of the Royal Astronomical Society",
            "year": 2010
        },
        {
            "authors": [
                "Raul E. Angulo",
                "Oliver Hahn"
            ],
            "title": "Large-scale dark matter simulations",
            "venue": "arXiv eprints,",
            "year": 2021
        },
        {
            "authors": [
                "Raul E. Angulo",
                "Andrew Pontzen"
            ],
            "title": "Cosmological N-body simulations with suppressed variance",
            "venue": "Monthly Notices of the Royal Astronomical Society: Letters",
            "year": 2016
        },
        {
            "authors": [
                "Tobias Baldauf"
            ],
            "title": "LSS constraints with controlled theoretical uncertainties",
            "year": 2016
        },
        {
            "authors": [
                "F. Bernardeau"
            ],
            "title": "Large scale structure of the universe and cosmological perturbation theory",
            "venue": "In: Phys. Rept",
            "year": 2002
        },
        {
            "authors": [
                "James Bradbury"
            ],
            "title": "JAX: composable transformations of Python+NumPy programs",
            "venue": "Version 0.2.5",
            "year": 2018
        },
        {
            "authors": [
                "Jordan Carlson",
                "Beth Reid",
                "Martin White"
            ],
            "title": "Convolution Lagrangian perturbation theory for biased tracers",
            "venue": "Monthly Notices of the Royal Astronomical Society",
            "year": 2012
        },
        {
            "authors": [
                "Vincent Desjacques",
                "Donghui Jeong",
                "Fabian Schmidt"
            ],
            "title": "Large-Scale Galaxy Bias",
            "venue": "In: Phys. Rept",
            "year": 2018
        },
        {
            "authors": [
                "Boryana Hadzhiyska"
            ],
            "title": "Hefty enhancement of cosmological constraints from the DES Y1 data using a Hybrid Effective Field Theory approach to galaxy bias",
            "year": 2021
        },
        {
            "authors": [
                "Cullan Howlett",
                "Marc Manera",
                "Will J. Percival"
            ],
            "title": "L-PICOLA: A parallel code for fast dark matter simulation",
            "year": 2015
        },
        {
            "authors": [
                "Anatoly Klypin",
                "Francisco Prada",
                "Joyce Byun"
            ],
            "title": "Suppressing cosmic variance with paired-and-fixed cosmological simulations: average properties and covariances of dark matter clustering statistics",
            "venue": "Monthly Notices of the Royal Astronomical Society",
            "year": 2020
        },
        {
            "authors": [
                "Nickolas Kokron"
            ],
            "title": "Priors on red galaxy stochasticity from hybrid effective field theory",
            "venue": "Monthly Notices of the Royal Astronomical Society",
            "year": 2022
        },
        {
            "authors": [
                "Nickolas Kokron"
            ],
            "title": "The cosmology dependence of galaxy clustering and lensing from a hybrid N -body-perturbation theory model",
            "year": 2021
        },
        {
            "authors": [
                "Takahiko Matsubara"
            ],
            "title": "Nonlinear perturbation theory with halo bias and redshift-space distortions via the Lagrangian picture",
            "venue": "In: Phys. Rev. D",
            "year": 2008
        },
        {
            "authors": [
                "Chirag Modi",
                "Shi-Fan Chen",
                "Martin White"
            ],
            "title": "Simulations and symmetries",
            "venue": "Monthly Notices of the Royal Astronomical Society",
            "year": 2020
        },
        {
            "authors": [
                "Marcos Pellejero Iba\u00f1ez"
            ],
            "title": "Modelling galaxy clustering in redshift space with a Lagrangian bias formalism and N-body simulations",
            "venue": "MNRAS",
            "year": 2022
        },
        {
            "authors": [
                "Marcos Pellejero-Ibanez"
            ],
            "title": "The Bacco Simulation Project: Bacco Hybrid Lagrangian Bias Expansion Model in Redshift Space",
            "venue": "arXiv e-prints,",
            "year": 2022
        },
        {
            "authors": [
                "Planck Collaboration"
            ],
            "title": "Planck 2018 results - I. Overview and the cosmological legacy of Planck",
            "venue": "A&A",
            "year": 2020
        },
        {
            "authors": [
                "Cornelius Rampf"
            ],
            "title": "Cosmological Vlasov\u2013Poisson equations for dark matter",
            "venue": "Reviews of Modern Plasma Physics",
            "year": 2021
        },
        {
            "authors": [
                "Cornelius Rampf",
                "Yvonne Y.Y Wong"
            ],
            "title": "Lagrangian perturbations and the matter bispectrum II: the resummed one-loop correction to the matter bispectrum",
            "venue": "Journal of Cosmology and Astroparticle Physics",
            "year": 2012
        },
        {
            "authors": [
                "Tim Sprenger"
            ],
            "title": "Cosmology in the era of Euclid and the Square Kilometre Array",
            "venue": "Journal of Cosmology and Astroparticle Physics",
            "year": 2019
        },
        {
            "authors": [
                "V. Springel"
            ],
            "title": "Simulations of the formation, evolution and clustering of galaxies and quasars",
            "venue": "Nature",
            "year": 2005
        },
        {
            "authors": [
                "Naonori S. Sugiyama"
            ],
            "title": "USING LAGRANGIAN PERTURBATION THEORY FOR PRECISION COSMOLOGY",
            "venue": "The Astrophysical Journal",
            "year": 2014
        },
        {
            "authors": [
                "Francisco Villaescusa-Navarro"
            ],
            "title": "Statistical Properties of Paired Fixed Fields",
            "venue": "The Astrophysical Journal",
            "year": 2018
        },
        {
            "authors": [
                "Pauli Virtanen"
            ],
            "title": "SciPy 1.0: Fundamental Algorithms for Scientific Computing in Python",
            "venue": "Nature Methods",
            "year": 2020
        },
        {
            "authors": [
                "Matteo Zennaro"
            ],
            "title": "Priors on Lagrangian bias parameters from galaxy formation modelling",
            "year": 2021
        },
        {
            "authors": [
                "Matteo Zennaro"
            ],
            "title": "The BACCO simulation project: biased tracers in real space",
            "year": 2021
        },
        {
            "authors": [
                "Tony Zhang"
            ],
            "title": "Covariance matrices for variance-suppressed simulations",
            "year": 2021
        },
        {
            "authors": [
                "Ciyou Zhu"
            ],
            "title": "Algorithm 778: L-BFGS-B: Fortran Subroutines for Large-Scale Bound-Constrained Optimization",
            "venue": "ACM Trans. Math. Softw",
            "year": 1997
        }
    ],
    "sections": [
        {
            "text": "ar X\niv :2\n20 4.\n03 86\n8v 2\n[ as\nContents"
        },
        {
            "heading": "1 Introduction 1",
            "text": ""
        },
        {
            "heading": "2 Fixed and Paired Fields 3",
            "text": ""
        },
        {
            "heading": "3 Bias Expansion 4",
            "text": ""
        },
        {
            "heading": "4 Numerical Results 5",
            "text": "4.1 Bias and Variance Reduction 6"
        },
        {
            "heading": "5 Analytic Exploration 9",
            "text": "5.1 Results for P11, P1\u03b4, P\u03b4\u03b4 10 5.2 Results for P1\u03b42 , P1s2 , P\u03b4\u03b42 , P\u03b4s2 11 5.3 Results for P\u03b42\u03b42 , Ps2s2 , P\u03b42s2 11 5.4 Discussion on P1\u22072\u03b4, P\u03b4\u22072\u03b4, P\u03b42\u22072\u03b4, Ps2\u22072\u03b4, P\u22072\u03b4\u22072\u03b4 12 5.5 Quantitative Predictions 12"
        },
        {
            "heading": "6 Optimal Phase-Fields 15",
            "text": ""
        },
        {
            "heading": "7 EUCLID Forecast 17",
            "text": ""
        },
        {
            "heading": "8 Conclusion 19",
            "text": ""
        },
        {
            "heading": "A Advected Lagrangian Fields 20",
            "text": "A.1 \u03b41 20 A.2 \u03b4\u03b4 21 A.3 \u03b4\u03b42 21 A.4 \u03b4s2 21 A.5 \u03b4\u22072\u03b4 21"
        },
        {
            "heading": "B Further Details on Quantitative Predictions 21",
            "text": "B.1 \u03c31\u03b4 21"
        },
        {
            "heading": "C EUCLID Forecast Parameters 23",
            "text": ""
        },
        {
            "heading": "D Details of Optimization 23",
            "text": ""
        },
        {
            "heading": "1 Introduction",
            "text": "Numerical simulations of the large-scale structure are fundamental tools in modern cosmology [3]. They can be used for a variety of purposes such as generating mock observations of the universe, testing the underlying physics of the cosmos and assessing the observability of novel effects, or even to generate large training sets for machine-learning based models that seek to describe complex phenomena. Finally, they are the only tools capable of accurately describing the nonlinear regime of structure formation. However, many of the aforementioned applications suffer from a limitation \u2013 these numerical simulations poorly sample modes comparable with the fundamental mode of the\n\u2013 1 \u2013\nsimulated volume. This issue is related to the observational effect known as cosmic variance, and causes a lack of precision in statistical quantities on large scales. It is possible to increase this precision by running simulations with larger volumes or many realizations of them, but of course there are limits imposed by the capabilities of even the largest supercomputers available. No simulation run up to now is capable of matching the combination of volume and resolution required for the interpretation of data from Stage IV galaxy surveys such as EUCLID or Rubin-DESC [3].\nOne way to suppress the cosmic variance in these simulations was introduced by [4], and is commonly referred to as \"Fixing and Pairing\" (hereafter F&P). The procedure consists of two steps; the first is to generate initial conditions with amplitudes fixed to their ensembleaverage values, so that the matter power spectrum of one realization will be exactly equal to the the ensemble mean. Secondly, one combines two such simulations with the same initial seed, but shifting the phases of one of them by \u03c0, or equivalently, generating it with opposite initial linear overdensities; the deviations of their two-point functions with respect to the ensemble average will be roughly the same, only with opposite sign, so that averaging the two is expected to make this statistic converge to the ensemble average much faster than it would by simply averaging two realizations with random seeds. A wide range of statistics derived from the matter density field in F&P simulations have been investigated, finding that they are unbiased and that some feature a very significant reduction in their variances [4, 25, 12].\nReducing the variance in matter statistics is a great advancement, but interpreting observations requires models for biased tracers, and thus one must test whether their statistics also remain unbiased and quantify the variance suppression. This has been done by [25] using halos in N-Body simulations, or directly hydrodynamic simulations, seeing that these statistics are unbiased and display some variance suppression, albeit smaller than for matter. Alternatively, one can model these tracers by combining several properties of the dark-matter density field with a set of bias parameters [9]. It has not been checked whether this can be done using the results of F&P simulations without introducing biases, nor how much the statistical improvements are retained in the final spectrum. This is particularly relevant for current developments of theoretical models of galaxy clustering based on combining numerical simulations and the bias expansion, as F&P is a valuable tool in making them more precise [14, 28, 10, 17, 18].\nTheoretical models are never a perfect description of reality, and one must have good estimates of the error being made so that it can be included in the data analyses, avoiding distorted interpretations of the measurements [5, 22]. In the case of models based on numerical simulations, these errors may come from cosmology rescaling methods [2], emulators of statistical quantities, and from the undersampling of large-scale modes in the simulation itself. The latter can in principle be reduced using F&P, which helps make the model more precise, but hinders our capacity of predicting its error [29] \u2013 one knows only that the variance is smaller, but not its value.\nIn this work, we set out to understand the statistical properties of models of biased tracers built from F&P simulations, answering several of the questions raised in the preceding paragraphs. We will assess whether F&P introduces biases to the basis spectra entering the bias expansion, and quantify the variance suppression for each of them. Furthermore, we will provide qualitative explanations for their different behaviours and quantitative predictions capable of describing their variances. We also propose and test a method to further reduce the variances in certain spectra that are unaffected by F&P, and finally apply the developed tools to understand what the minimum simulation size is such that the error in a theoretical\n\u2013 2 \u2013\nmodel built from it satisfies EUCLID requirements. The text of this manuscript is organized as follows. Section 2 is devoted to establishing our notation, and to reviewing the fixing and pairing methods. Section 3 gives a very brief account of the bias expansion, and explains the way in which it has been applied in this work. In section 4 we describe the set of simulations utilized throughout this work and employ them to demonstrate that the basis spectra entering the bias expansion are unbiased in F&P simulations, and to quantify the reduction in their variances. In Section 5 we use Lagrangian Perturbation-Theory (hereafter LPT) to understand why certain spectra feature noise reduction in F&P simulations, while others do not, and to obtain, for the first time, simple analytical expressions for the variances of these spectra in F&P simulations. In section 6 we show how to further reduce the variance in the basis spectra. Finally, section 7 is devoted to applying these results to understand the simulation sizes required to build a model precise enough for the analysis of Euclid data, and in section 8 we conclude and present final remarks."
        },
        {
            "heading": "2 Fixed and Paired Fields",
            "text": "In this section we give a brief overview to contextualize F&P fields, and to settle on the notation to be used throughout this work. Let us say \u03c1(x) is the density of dark matter, then we can define the matter overdensity field as \u03b4(x) = \u03c1(x)\u03c1\u0304 \u2212 1. It is customary to work with its Fourier transform, defined by\n\u03b4(k) = \u222b d3x\u03b4(x)e\u2212ik\u00b7x. (2.1)\nThis field will be complex, and therefore can be decomposed into an amplitude and a phase, \u03b4(k) = |\u03b4(k)|ei\u03b8k ; due to \u03b4(x) being real, these fields must satistfy \u03b4\u2217(k) = \u03b4(\u2212k) and consequently \u03b8\u2212k = \u2212\u03b8k. One can in general define the power spectrum of this field through the expression\n\u3008\u03b4(k)\u03b4(k\u2032)\u3009 = (2\u03c0)3\u03b4D(k \u2212 k\u2032)P (k), (2.2)\nin which we express the power spectrum directly as depending only on the modulus of the wave vector due to the assumption of isotropy in the density field. In the case of a numerical simulation with finite volume L3, the power spectrum can be defined as\nP (k) = 1\nL3 \u03b4(k)\u03b4(\u2212k), (2.3)\nand isotropy is only valid in the limit of L3 \u2192\u221e, so in order to obtain P as a function of the modulus of the wave-vector, one must average over a spherical shell of radius ki and width \u2206k,\nP (ki) = 1\nVs(ki) \u222b ki d3k (2\u03c0)3 P (k), (2.4)\nin which Vs(ki) = 4\u03c0k2i \u2206k = 4\u03c0k 3 i \u2206(ln k), depending on whether one uses linear or logarithmic binning of the wave modes, and \u222b ki\nis an integral over Vs(ki), the Fourier shell of radius ki and width \u2206k. Observations of the cosmic microwave background [19] have shown that perturbations in the early universe were, to a very good approximation, Gaussianly distributed. This can be expressed equivalently by saying that the absolute values of the Fourier modes follow a\n\u2013 3 \u2013\nRayleigh distribution, and the phases are uniformly distributed in the interval [0, 2\u03c0], resulting in a combined distribution given by\nP(|\u03b4(k)|, \u03b8k) = |\u03b4|\n\u03c0L3P e\u2212|\u03b4| 2/L3P . (2.5)\nTherefore, the standard procedure for generating initial conditions for cosmological simulations is to sample this distribution for amplitudes and phases, using the linear power spectrum at high redshift in place of P . To generate fixed simulations, in contrast, one substitutes this probability density function by a Dirac delta centered at \u221a L3P (k), that is,\nPf (|\u03b4|(k)|, \u03b8k) = 1\n2\u03c0 \u03b4D\n( |\u03b4| \u2212 \u221a L3P ) , (2.6)\nwhich amounts to fixing all the amplitudes to the value |\u03b4(k)| = \u221a L3P (k) while allowing the phases to be uniformly sampled between 0 and 2\u03c0. From this initial density field, \u03b41(k) = |\u03b4(k)|ei\u03b8k , one can easily generate its corresponding pair simply by shifting the phases of \u03c0, \u03b42(k) = |\u03b4(k)|ei(\u03b8k+\u03c0). Fixing clearly reduces the level of randomness in the field while destroying its Gaussianity. Nevertheless, works such as [4, 25, 12] have done extensive studies of many statistical quantities derived from F&P simulations, finding that two and threepoint clustering statistics, as well as the mass function and probability density function are unbiased; biases appear in the variance and covariance of two-point functions \u2013 as intended, since the method has been designed to suppress these quantities."
        },
        {
            "heading": "3 Bias Expansion",
            "text": "Biased tracers of the large-scale structure can be modeled in many ways, ranging from detailed and expensive methods such as finding halos or galaxies in simulations, or doing subhalo abundance matching to populate dark-matter simulations with galaxies, to simpler and less detailed methods such as a perturbative bias expansion. In this work we will model galaxies\n\u2013 4 \u2013\nby applying a second-order Lagrangian bias expansion with an additional term to account for nonlocal effects of galaxy formation,\n1 + \u03b4g(q) = 1 + b L 1 \u03b4(q) + b L 2 \u03b4 2(q) + bLs2s 2(q) + bL\u22072\u03b4\u2207 2 q\u03b4(q) + \u00b7 \u00b7 \u00b7 , (3.1)\nin which s2(q) = sijsij and sij is the traceless part of the tidal tensor. This has the advantage of being agnostic to the galaxy formation processes, and also very flexible, allowing one to fit virtually any galaxy population merely by changing the values of the bias parameters [9]. Using equation (3.1) one can obtain an approximation for the galaxy density field in Lagrangian space; however, to compare it to observations one must have it in Eulerian space. To perform this transformation, we must move particles from their Lagrangian to Eulerian positions,\n1 + \u03b4g(x) = \u222b d3q\u03b4D(x\u2212 q \u2212\u03c8(q))(1 + \u03b4g(q))\n= \u2211\nF (q)\u2208[1,\u03b4,\u03b42,s2,\u22072\u03b4]\nbF\n\u222b d3q\u03b4D(x\u2212 q \u2212\u03c8(q))F (q)\n= \u2211\nF (q)\u2208[1,\u03b4,\u03b42,s2,\u22072\u03b4]\nbF \u03b4F (x),\n(3.2)\nin which we have used the linearity of the bias expansion to reorganize the expression for the galaxy overdensity in Eulerian space as a linear combination of advected Lagrangian operators. From this, one can then obtain an expression for the galaxy power spectrum expressed in terms of the bias coefficients and the auto and cross-spectra of the advected dark-matter density fields,\nPgg(k) = \u2211\ni,j\u2208[1,\u03b4,\u03b42,s2,\u22072\u03b4]\nbibjPij(k). (3.3)\nNotice that in this expression b1 must be equal to 1, and is merely a bookkeeping parameter; in the next sections we will refer to the bias parameter denoted here by b\u03b4 as bL1 , that is, the linear Lagrangian bias. Recent work [16, 14, 28, 10, 27, 13, 17, 18] has shown that one can use this modeling and perform the advection using the nonlinear displacement field predicted by simulations to obtain accurate predictions for the power spectra of biased tracers at highly nonlinear scales. We call this general procedure \"hybrid Lagrangian bias expansion\"."
        },
        {
            "heading": "4 Numerical Results",
            "text": "To perform our numerical analyses we have run an ensemble of 200 L-PICOLA simulations, which were used for comparing Gaussian and F&P spectra, and for understanding up to which scales our theoretical predictions are valid; this set of simulations was run with the parameters resumed in table (4), for Gaussian and fixed initial conditions, and for phase offsets \u03c6 = 0, \u03c0. The cosmological parameters correspond to those used in the Millennium simulation [23]; the parameters nsteps, Nsample and Npart control, respectively, the time, force, and mass resolutions of the simulation. The original L-PICOLA code developed by [11] did not include an option for fixing or pairing, and therefore, minor modifications had to be done to it. In order to measure the basis spectra entering equation (3.3) we took the following procedure:\n\u2013 5 \u2013\n1. Generate initial conditions with the same seed and phase offset as the simulation to be analysed;\n2. Use this generated field to compute \u03b4(q), \u03b42(q), s2(q) and \u22072q\u03b4(q) in Lagrangian space;\n3. Compare the initial positions of the particles to their positions at the desired redshift, thus obtaining their displacement \u03c8i = xi(zfinal)\u2212 xi(zinit);\n4. Advect the quantities from Lagrangian to Eulerian space using the procedure outlined in equation 5.3\n5. Compute their auto and cross-spectra using the fields obtained in Eulerian space. For the paired spectra we then average over the two simulations run with the same seed, but different phase offsets.\nThe mean of these spectra is shown in figure (1), along with theoretical predictions obtained using 2LPT."
        },
        {
            "heading": "4.1 Bias and Variance Reduction",
            "text": "In this section, we use the previously mentioned COLA simulations to numerically assess by how much fixing and/or pairing reduce the variance in the basis spectra, and whether these spectra are unbiased compared to those obtained using Gaussian initial conditions. Using the simulation results, we estimate the bias of F&P simulations with respect to Gaussian ones by using the expression\nBFPN = \u3008PFP \u3009N \u2212 \u3008PG\u3009N\n\u03c3FP\u2212GN , (4.1)\nin which \u3008PFP \u3009N is the average of N F&P simulations, and analogously for \u3008PG\u3009N ; \u03c3FP\u2212GN is the expected error in their difference, defined by the expression\n\u03c3FP\u2212GN = \u221a[ \u03c3fpN ]2 + [ \u03c3GN ]2 , (4.2)\nand the standard deviations \u03c3FPN and \u03c3 G N are the estimated errors on the average of N spectra, defined by [ \u03c3FPN ]2 = 1\nn\u2212 1 n\u2211 i=1 ( \u3008PFP \u3009Ni \u2212 \u3008PFP \u3009 )2 , (4.3)\n\u2013 6 \u2013\nn being the number of independent sets of N spectra available. In figure (2) we show the results for the computation of these biases from 10 sets of 20 simulations; it is not hard to see that, for all of the 15 basis spectra, no significant bias can be detected, as most of the points are located inside the 1 or 2\u2212 \u03c3 region, represented by gray-shaded areas in the figure. This result was expected from analytical considerations made in [4], in which the authors show that the procedure of fixing the amplitudes of the initial Fourier modes is expected to change the power spectra only at a measure-zero set of their domain.\nTo quantify the statistical improvement derived from fixing we directly take the ratio between the variances of Gaussian and fixed spectra, \u03c3G\u03c3f . Quantifying the statistical improvement coming from pairing is slightly more delicate. Paired spectra are obtained from the average of spectra from two simulations with same seed, but opposite initial conditions; if these spectra were uncorrelated, then the variance of the average would be divided by 2. Of course this would not be much of an improvement since we could just have run an additional simulation, with a different seed, to get the same effect; the interesting case is when, due to having opposed ICs, the spectra from these simulations are anticorrelated and their fluctuations around the mean will cancel out making the averaged spectra converge to the ensemble mean much faster. Therefore, we choose to multiply the variance of paired simulations by 2 before comparing them to the other ones, to avoid seeing the effects of simply averaging over two simulations. A side effect to this is that, for some spectra, the measurements from the two simulations are highly correlated so that the second simulation adds almost no information, giving only a small reduction in variance from taking their average; multiplying it by 2, can then make it artificially larger than the variance of the non-paired spectra, which does not mean that pairing worsened the variance, but only that the second simulation added almost no new information.\nFigure (3) shows the analysis assessing the variance reductions from F&P. It is useful to divide these spectra into three categories to better understand the reduction in variance:\n\u2013 7 \u2013\n\u2022 Spectra involving two linear fields, P11, P1\u03b4, P\u03b4\u03b4. For scales k \u223c 10\u22122[h/Mpc] fixing gives a large reduction in \u03c3 of a factor of around 102 at the largest scales, which then reduces until no improvement is seen at scales k \u2248 0.15[h/Mpc]; a small improvement is seen for k & 0.15[h/Mpc], but is not very relevant both because of its much smaller magnitude, and because the error in the spectra at these scales is already quite small. At the largest scales pairing further reduces \u03c3 by a factor of 10 and this reduction diminishes as we go to larger k, until no improvement is seen beyond k \u2248 0.15[h/Mpc].\n\u2022 Spectra involving one linear and one squared field, P1\u03b42 , P1s2 , P\u03b4\u03b42 , P\u03b4s2 . Fixing gives no benefit for these spectra at scales k . 0.15, and for scales beyond this threshold we see only a very small improvement for P1\u03b42 and P\u03b4\u03b42 . Pairing gives considerable reduction in \u03c3 of a factor of 10 at scales k \u223c 10\u22122[h/Mpc], which then falls down until no improvement is seen for k & 0.15[h/Mpc].\n\u2022 Spectra involving two squared fields P\u03b42\u03b42 , P\u03b42s2 , Ps2s2 . For these spectra we see no improvement from fixing or pairing.\nA comment is in order regarding the spectra involving the Laplacian field P1\u22072\u03b4, P\u03b4\u22072\u03b4, P\u03b42\u22072\u03b4, Ps2\u22072\u03b4, P\u22072\u03b4\u22072\u03b4. For these spectra we see a mild improvement from fixing and pairing at scales 10\u22122 . k/[hMpc\u22121] . 0.1, but we wish not to include it in any of the categories above both because they present an irregular behaviour, with no clear tendency as a function of scale, and because in any way it is not relevant to predict these variances because the corresponding spectra are extremely suppressed with respect to the others. In the next section we will provide simple explanations to these three classes of behaviours, and compute their variances analytically.\n\u2013 8 \u2013"
        },
        {
            "heading": "5 Analytic Exploration",
            "text": "In order to understand the results exposed above, we will use the LPT formalism [6, 15, 21, 8, 24, 20] to compute approximate expressions for the power spectra that go into equation (3.3) and their variances; this will allow us to see the effects of fixing or pairing on the structure of these quantities. Let us call F (q) a field in Lagrangian space such that\nF (q) \u2208 [1, \u03b4, \u03b42, s2,\u22072\u03b4]. (5.1)\nWe are interested in these quantities in Eulerian space, and therefore we must advect them using the displacement field, as previously described in equation (3.2),\n\u03b4F (x) = \u222b d3qF (q)\u03b4D(x\u2212 q \u2212\u03c8(q)). (5.2)\nTaking the Fourier transform of both sides and expanding the displacement to first order in perturbation theory, we obtain the following results.\n\u03b4F (k) \u2248 \u222b d3qe\u2212ik\u00b7qF (q)e\u2212ik\u00b7\u03c8 (1)(q)\n\u2248 \u222b d3qe\u2212ik\u00b7qF (q) [ 1\u2212 ik \u00b7\u03c8(1) \u2212 (k \u00b7\u03c8 (1))2\n2\n] (5.3)\nin which going to the second line we Taylor expanded the exponential up to second order; one can then plug in the Z\u2019eldovich approximation \u03c8(k) = i k\nk2 \u03b4L(k) and the different fields\ninto this expression and perform the relevant calculations to obtain them in Eulerian space. We notice that, although the results to be presented in sections 5.1 - 5.4 are obtained using equation (5.3) to advect the fields, our qualitative conclusions are completely general and rely only on the structure of perturbative calculations.\nWith the expressions of \u03b4F (k) at hand, we can obtain the auto and cross power spectra of these fields through\nP\u0302\u00b5\u03bd(k) = 1\nV Re [\u03b4\u00b5(k)\u03b4\u03bd(\u2212k)] , (5.4)\nin which \u00b5, \u03bd \u2208 [ 1, \u03b4, \u03b42, s2,\u22072\u03b4 ] and V = L3. Notice that to make this calculation fully consistent up to 1-loop, we should have retained several terms in equation (5.3) which we have discarded; this is justified simply because our purpose is not to obtain highly precise expressions for these variances but to provide insight into the mechanism by which these methods operate, and to validate our approach showing we can make reasonable quantitative predictions. We attract the attention of the reader to the fact that we are not taking the ensemble average of this combination of fields. This is done with the purpose of retaining terms which would be zero in the ensemble average but are present for simulations due to their finite size; these terms will be very important in our explanations of the variance reduction in different spectra.\n\u2013 9 \u2013\n5.1 Results for P11, P1\u03b4, P\u03b4\u03b4 Using equations (A.2) and (A.3) one can easily obtain the expression for P11 in the case of fixed initial Fourier amplitudes 1\nPF11(k) \u2248PLk + V 1/2 \u222b q1 \u221a PLk P L q1P L q1\u2212k cos [\u03b8k \u2212 \u03b8q1 \u2212 \u03b8q1\u2212k]FZA(q1,k \u2212 q1,k)\n+ V\n4 \u222b q1 \u222b q2 \u221a PLq1P L k\u2212q1P L q2P L q2\u2212k cos [\u03b8q1 + \u03b8k\u2212q1 \u2212 \u03b8q2 \u2212 \u03b8k\u2212q2 ]\n\u00d7 FZA(q1,k \u2212 q1,k)FZA(q2,k \u2212 q2,k).\n(5.5)\nThe leading-order contribution to this spectrum is the linear power spectrum, PLk , and for the fixed case this has no variance whatsoever; indeed, when we combined the two fixed fields, their phases canceled completely, and since their amplitudes are fixed to the square root of the linear power spectrum, we obtain it completely free of noise. It is not hard to see that, for all spectra which have the linear power spectrum as their leading order term, fixing will greatly suppress their variance, by cancelling its leading order contribution. This is precisely the case of these spectra,\nP11, P1\u03b4, P\u03b4\u03b4 \u2283 PL, (5.6)\nexplaining why fixing provides a large reduction to their variances. The next-to-leading-order contribution to P11 is given by a term which came from the combination of three factors of \u03b4L, and we will thus denote it schematically by (\u03b4\u03b4\u03b4). Taking a closer look at this term we can see that, for a simulation which had all of its phases displaced by \u03c0, one would obtain\n(\u03b4\u03b4\u03b4)\u03c0 \u223c \u222b q1 \u221a \u00b7 \u00b7 \u00b7 cos [\u03b8k \u2212 \u03b8q1 \u2212 \u03b8q1\u2212k \u2212 \u03c0]\ufe38 \ufe37\ufe37 \ufe38\n\u2212 cos[\u03b8k\u2212\u03b8q1\u2212\u03b8q1\u2212k]\nFZA(q1,k \u2212 q1,k)\n=\u2212 (\u03b4\u03b4\u03b4).\n(5.7)\nThe pairing procedure consists precisely of creating two simulations with the same seed \u2013 but one of them with all the phases displaced by \u03c0 \u2013 and then average their spectra. Through the arguments above one can clearly see that this would cancel the (\u03b4\u03b4\u03b4) \u2013 along with all other combinations of an odd number of factors of the density field \u2013 from the spectrum. Although the explanation we gave was focused on the case of P11, it is valid for the other two spectra, as all of these contain a term composed of three linear fields, which has a completely analogous structure to the one described above. Schematically, one can say that\nP11, P1\u03b4, P\u03b4\u03b4 \u2283 (\u03b4\u03b4\u03b4), (5.8)\nand therefore, all of these spectra have their variances further reduced by pairing. The only term at this order of the calculation which continues to contribute to the variance is V\n4 \u222b q1 \u222b q2 \u221a PLq1P L k\u2212q1P L q2P L q2\u2212k cos [\u03b8q1 + \u03b8k\u2212q1 \u2212 \u03b8q2 \u2212 \u03b8k\u2212q2 ]\n\u00d7FZA(q1,k \u2212 q1,k)FZA(q2,k \u2212 q2,k). (5.9)\n1In the following sections, whenever an integral of the kind \u222b\nd3k (2\u03c0)3 appears, we will simplify the notation, substituting it by \u222b\nd3k (2\u03c0)3 \u2212\u2192 \u222b k .\n\u2013 10 \u2013\nA very interesting question is then raised, regarding how can one reduce the variance associated with terms such as this one, and this expression allows us to immediately see that searching for other phase-translations in the same spirit as the pairing procedure will not help. This is because the cosine in the above expression has two phases with a plus sine, and two with a minus, so that any phase translation will be canceled and will not affect this term whatsoever.\n5.2 Results for P1\u03b42 , P1s2 , P\u03b4\u03b42 , P\u03b4s2\nFrom Appendix A we can take the expression for the fields \u03b41 and \u03b4\u03b42 , and compute P1\u03b42 up to fourth order in \u03b4L in the case of fixed initial Fourier amplitudes; this will be given by\nPF1\u03b42(k) \u2248V 1/2 \u222b q1 \u221a PLk P L \u2212q1P L q1\u2212k cos [\u03b8k \u2212 \u03b8q1 \u2212 \u03b8k\u2212q1 ]\n+ V \u222b q1 \u222b q2 k \u00b7 (k \u2212 q12) |k \u2212 q12|2 \u221a PLk P L q1P L q2P L k\u2212q12 cos [\u03b8k \u2212 \u03b8q1 \u2212 \u03b8q2 \u2212 \u03b8k\u2212q12 ] + V\n2 \u222b q1 \u222b q2 K1(q1,k \u2212 q1) \u221a PLq1P L k\u2212q1P L q2P L k\u2212q2 cos [\u03b8q1 + \u03b8k\u2212q1 \u2212 \u03b8q2 \u2212 \u03b8k\u2212q2 ]\n(5.10)\nThis makes it clear that the leading order contribution to this spectrum is not coming from the linear power-spectrum; indeed this supports our observations from numerical simulations, which show that fixing has no effect in reducing the variance of these spectra. The intense mode-mixing coming from the integrals in equation (5.10) destroys the regularity introduced by fixing the amplitudes, leaving the statistical noise unchanged. However, we see that the leading-order term for these spectra is in fact precisely of the shape (\u03b4\u03b4\u03b4), allowing us to affirm\nP1\u03b42 , P\u03b4\u03b42 , P1s2 , P\u03b4s2 \u2283 (\u03b4\u03b4\u03b4), (5.11)\nand thus the argument developed in the preceding subsection is capable of explaining the substantial variance reduction to these spectra coming from pairing.\n5.3 Results for P\u03b42\u03b42 , Ps2s2, P\u03b42s2\nAnalogously to what has been done before, one can take expressions for \u03b4\u03b42 from appendix A and compute P\u03b42\u03b42 for the case of fixed initial Fourier amplitudes; this gives us\nPF&P\u03b42\u03b42 \u2248 1\nVf \u222b q1 \u222b q2 \u221a PLq1P L k\u2212q1P L q2P L k\u2212q2 cos [\u03b8q1 + \u03b8k\u2212q1 \u2212 \u03b8q2 \u2212 \u03b8k\u2212q2 ] . (5.12)\nThe leading-order contribution to this spectrum is an integral which will mix the initial Fourier modes in a highly nontrivial way, and will thus be unaffected by fixing. Pairing will not affect this term either since the first odd combination of factors of the density field will only appear at fifth order, and will therefore be negligible in comparison to the contribution from the fourth order term. It is interesting to notice that this term has many similarities in form with equation (5.9) and with one of the fourth-order contributions to equation (5.10). If one was to encounter a method analogous to F&P to mitigate the variance associated with this kind of term, there would be a massive reduction in the error of the final galaxy clustering model due to the simultaneous reduction in all the relevant basis spectra.\n\u2013 11 \u2013"
        },
        {
            "heading": "5.4 Discussion on P1\u22072\u03b4, P\u03b4\u22072\u03b4, P\u03b42\u22072\u03b4, Ps2\u22072\u03b4, P\u22072\u03b4\u22072\u03b4",
            "text": "Analytically, the behaviour of these terms would be very simple to derive, since in Fourier space one can write \u22072\u03b4 \u2192 \u2212k2\u03b4. It is quite clear that, although multiplying \u03b4 by k2 could change the kernels connecting the linear fields, it would not change the general structure of these terms, which should then behave as if the laplacian was a linear field; as stated earlier, this is not what we see. It is not yet clear whether these effects are a product of a lack of numerical resolution to which the laplacian would be exceedingly sensible, or if it would be necessary to improve our analytical modeling to reproduce this behaviour."
        },
        {
            "heading": "5.5 Quantitative Predictions",
            "text": "Throughout this section we have presented a theoretical framework for analytically computing power spectra while retaining in these expressions the statistical properties characteristic of a simulation, and have employed it to obtain a qualitative understanding on the behaviour of the variances for auto and cross-spectra in F&P simulations. This same framework can also be used to compute expressions for the variances of these spectra in F&P simulations, an thus obtain quantitative predictions for them. In the remainder of this section we will describe the general procedure employed (details will be omitted from the main text, but can be found in Appendix B ) and compare our predictions to results from an ensemble of COLA simulations.\n\u2013 12 \u2013\nWe can readily write a formal expression for the variance in these spectra,\n\u03c32\u00b5\u03bd(ki) = \u2329 P\u0302 2\u00b5\u03bd(ki) \u232a \u2212 \u2329 P\u0302\u00b5\u03bd(ki) \u232a2 , (5.13)\nin which\nP\u0302\u00b5\u03bd(ki) = 1\nVs(ki) \u222b ki d3k (2\u03c0)3 P\u0302\u00b5\u03bd(k) \u2261 [ P\u0302\u00b5\u03bd(k) ] \u0398(ki) , (5.14)\nand Vs(ki) = 4\u03c0k3i \u2206(ln k) is the volume of the spherical shell of radius ki and width \u2206(ln k), while \u222b ki\nindicates integration over this shell in Fourier space. In order to simplify equation (5.13) so that we can evaluate it analytically, we will make the approximation that[\nP\u0302 2\u00b5\u03bd(k) ] \u0398(ki) = [ P\u0302\u00b5\u03bd(k) ]2 \u0398(ki) , (5.15)\nand that we are working in the linear regime so that power spectra at different wave vectors will be uncorrelated, that is, \u3008P\u0302\u00b5\u03bd(k)P\u0302\u00b5\u03bd(k\u2032)\u3009 = 0 if k 6= k\u2032. Using these approximations, we can write\n\u03c32\u00b5\u03bd(ki) = 1\nNki \u03c32\u00b5\u03bd(k), (5.16)\nin which Nki = Vs(ki) 2Vf is the number of independent Fourier modes falling inside the spherical shell of radius ki, and Vf = (2\u03c0)3/V is the volume of one Fourier cell. This expression now makes it simple to compute \u03c32\u00b5\u03bd(ki) by computing \u03c32\u00b5\u03bd(k) from the expressions for the fields in appendix A, and then dividing them by Nki . Once established the approximations that we will be using, we now turn to describing how the calculation of \u03c32\u00b5\u03bd takes place. For brevity we will not show the calculations for all the spectra, but merely indicate how one can perform the calculation of \u03c311(k). Consider equation (5.5) for the power spectrum of a fixed simulation, and let us recall that the first and second terms in this equation will not contribute to the variance in the F&P case. Let us call the third term in this equation T3(k),\nT3(k) = V\n4 \u222b q1 \u222b q2 \u221a PLq1P L k\u2212q1P L q2P L q2\u2212k cos [\u03b8q1 + \u03b8k\u2212q1 \u2212 \u03b8q2 \u2212 \u03b8k\u2212q2 ]\n\u00d7 FZA(q1,k \u2212 q1,k)FZA(q2,k \u2212 q2,k), (5.17)\nand we can write the variance of P11 simply as\n\u03c3211(k) = \u3008T 23 (k)\u3009 \u2212 \u3008T3(k)\u30092. (5.18)\nTo simplify the notation, we will write T3(k) as\nT3(k) = \u222b q1 \u222b q2 A(q1, q2,k) cos (\u0398 (q1, q2)) , (5.19)\nin which we have used\nA(q1, q2,k) = V\n4\n\u221a PLq1P L k\u2212q1P L q2P L q2\u2212kFZA(q1,k \u2212 q1)FZA(q2,k \u2212 q2)\n\u0398(q1, q2,k) =\u03b8q1 + \u03b8k\u2212q1 \u2212 \u03b8q2 \u2212 \u03b8k\u2212q2 . (5.20)\n\u2013 13 \u2013\nLet us begin by computing the first term on the right-hand side of equation (5.18). Using the notation we just defined, we can write it as\u222b\nq1,q2,q3,q4\nA(q1, q2,k)A(q3, q4,k) \u3008cos (\u0398(q1, q2,k)) cos (\u0398(q3, q4,k))\u3009 . (5.21)\nNotice that \u0398 is a sum of random variables, and is therefore also a random variable uniformly distributed between 0 and 2\u03c0. This implies that if \u0398(q1, q2,k) is independent of \u0398(q3, q4,k), we can split the ensemble average of the product into the product of the ensemble averages, which will both be null. Therefore, the only cases for which the above integral will not be zero are when\ncos (\u0398(q1, q2,k)) = cos (\u0398(q3, q4,k)) , (5.22)\nas in this case the expression becomes the expected value of the square of the cosine of a random variable, which equals 12 , in a well known result. This will be satisfied when one of the following conditions is fulfilled,\n q1 = q2 and q3 = q4, or q1 = k \u2212 q2 and q3 = q4, or q1 = q2 and q3 = k \u2212 q4, or q1 = k \u2212 q2 and q3 = k \u2212 q4, or\n q1 = q3 and q2 = q4, or q1 = q4 and q2 = q3, or q1 = k \u2212 q3 and q2 = k \u2212 q4, or q1 = k \u2212 q4 and q2 = k \u2212 q3, or q1 = q3 and q2 = k \u2212 q4, or q1 = k \u2212 q3 and q2 = q4, or q1 = q4 and q2 = k \u2212 q3, or q1 = k \u2212 q4 and q2 = q3.\nEach of these cases will give a contribution, e.g.: for the first case of the block on the right we substitute the ensemble average of the cosines by the expression\n1\n2\ufe38\ufe37\ufe37\ufe38 \u3008cos2\u3009 \u00d7 1 L3 \u03b4D(q1 \u2212 q3)\ufe38 \ufe37\ufe37 \ufe38 q1=q3 \u00d7 1 L3 \u03b4D(q2 \u2212 q4)\ufe38 \ufe37\ufe37 \ufe38 q2=q4 . (5.23)\nWe have divided these cases into two blocks because the block on the left will give contributions which will precisely cancel the second term in the RHS of equation (5.18), and contributions to the variance will only come from the block to the right. Fortunately, for the case of \u03c3211 all of the cases will contribute the same value, and thus we can write the expression for the variance, having already integrated over the Dirac deltas,\n\u03c3211(k) \u2248 \u222b q P (q)P (|k \u2212 q|)F 2ZA(q,k \u2212 q), (5.24)\na remarkable simplification compared to the expressions from which we began. The results obtained from these calculations are shown in figure (4), along with the variances computed from the ensemble of COLA simulations. We can see that our calculations\n\u2013 14 \u2013\nare able to reproduce well most of the variances up to scales of k \u223c 0.2[Mpc/h]; those which are not well reproduced such as \u03c311, \u03c31\u03b4 and \u03c3\u03b4\u03b4 are the ones which have their leading-order and next to leading order contributions cancelled, and therefore, the calculation of their variances becomes quite complex, requiring us to go to higher orders in perturbation theory to have very precise predictions \u2013 a task already beyond the scope of the current work."
        },
        {
            "heading": "6 Optimal Phase-Fields",
            "text": "The previous section has demonstrated the power of F&P in reducing statistical noise in simulations, and thus its great potential for building simulation-based theoretical models for galaxy clustering. We have seen, however, that these techniques do not reduce the variance in all basis spectra \u2013 as a direct consequence, for certain combinations of values of the bias parameters, \u03c3gg will be dominated by contributions coming from \u03c3\u03b42\u03b42 , \u03c3\u03b42s2 and \u03c3s2s2 , precisely the terms which get no variance reduction. The question that poses itself naturally is whether there is a way to reduce these terms as well.\nWithout modifying the underlying physics, the freedom we have in an N-Body simulation is essentially that of changing the initial conditions \u2013 amplitudes and phases of the Fourier modes \u03b4L(k). Using F&P the amplitudes are no longer free after we fix them to be exactly the square root of the power spectrum, but the phases remain unconstrained. One could think of these phases as parameters to be adjusted, and try to fit them so that the spectra measured from the simulation match their ensemble averages; this would of course have a prohibitive cost if for every point to be tested in this extremely high-dimensional space we should have to run a complete simulation and then compute its power spectra. This prompts us to look for an approximation to the power spectra of the fully evolved simulations such that it can be quickly calculated, and captures the statistical properties of these power spectra, namely their deviations from the ensemble average.\nAt linear scales it is known that the growth of structures proceeds independently between different scales k 6= k\u2032. This means that there is little mode mixing at these scales, so that the statistical properties of these modes in the initial conditions will be essentially preserved in the final output of a simulation. Therefore, the level of noise of e.g.: P\u03b42\u03b42 computed from the initial conditions of a simulation \u03b4IC(\u03b8) will be very similar to the level of noise in P\u03b42\u03b42 computed from the fully evolved field, provided we compare them at sufficiently large scales. This gives us an approximation with the characteristics we were looking for: computing the power spectra of the initial conditions is very fast, and approximately captures the statistical properties of the power spectra of the fully evolved field.\nHaving found a sufficiently fast approximation to the power spectra of a fully evolved simulation, we can now use it to find the optimal phase-field that reduces the distance of the relevant power spectra to their ensemble averages. Notice that the ensemble average can be easily computed up to the desired precision, simply by generating as many realizations of the initial conditions as needed, computing their power spectra and averaging over them. Further explaining and systematizing the optimization procedure, we can divide it into three steps:\n1. Generating or Receiving ICs. First the amplitudes of the Fourier modes are generated |\u03b4L(k)| = A(k) = \u221a L3PL(k), and the phases are either generated randomly\nor received from an iteration of this whole procedure, allowing us to form the initial density field \u03b4L(k) = A(k)ei\u03b8i(k);\n\u2013 15 \u2013\n2. Computing the Loss-Function. We compute P\u03b42\u03b42(\u03b8i), P\u03b42s2(\u03b8i) and Ps2s2(\u03b8i) taking \u03b4L(k) as input, and use this to calculate a loss-function that measures the distances of these spectra from their ensemble averages. This is done by taking advantage of the Python library JAX [7]; functions implemented using this library can be automatically differentiated, allowing one to evaluate their gradients without having to write any additional code; this feature will be very important for the next step, at which the gradient of this function will be used inside a minimization algorithm.\n3. Stepping Minimization Algorithm. The value of the loss-function and its derivative with respect to the phases is fed to the SciPy implementation of the L-BFGS-B algorithm [30, 26], that produces an updated phase field \u03b8i+1 with a smaller value of the loss-function. Steps 1-3 are repeated until the loss-function is reduced by a specified factor, at which point one says the algorithm has converged, and outputs an optimal phase-field \u03b8opt.\nHaving carried out this process, one can run a full simulation using the optimal phasefield as input and compare the power-spectra measured from it to those from a standard simulation. Figure (5) shows precisely this comparison for the three spectra of interest; one can see how the deviations from the ensemble average are significantly reduced at large scales, corresponding to a small fraction of the standard deviation in simulations with random phase-fields. Furthermore, these deviations are restricted to less than 10% at all scales \u2013 this\n\u2013 16 \u2013\nis particularly impressive for large scales, at which deviations in standard simulations can easily reach 40%. This optimization algorithm provides very distinct results depending on the given initial phase-field; taking advantage of that, we ran it using different initial conditions to find five independent optimal phase-fields. From the simulations run with these initial conditions one can then estimate the power spectra and compute their variance and compare it to the result for usual F&P. This comparison can be seen in figure (8) of appendix D and shows a reduction by a roughly a factor of 10 in the variances of P\u03b42\u03b42 , P\u03b42s2 and Ps2s2 . One would hope that this optimization procedure could reveal general properties of the optimal phase-fields responsible for reducing the noise. However, we have investigated the probability density function of the phases and its power spectrum, but did not find significant differences to the same properties computed for random realizations. This can be most likely attributed to the fact that this optimization algorithm has the freedom to fit a very large number of free parameters \u2013 the values of the initial phases \u2013 and therefore the solution that we find is a very specific one. Indeed, if one tries to use this same phase-field to initialize a simulation at a different cosmology or with a different box size, the optimal properties are quickly lost."
        },
        {
            "heading": "7 EUCLID Forecast",
            "text": "The error in hybrid Lagrangian bias expansion models of large-scale structure will have multiple sources, depending on each particular implementation. One main source will be related to the interpolation scheme used to allow access to the model in any required cosmology; another source is associated to the algorithms employed in carrying out simulations; finally, there is the error coming from the statistical noise of the simulation itself. The latter arises because of the finite volume of the simulations, and is precisely the one which can be reduced through F&P techniques, or through the optimization procedure described above. This statistical noise in the dark-matter only simulations will translate itself to a source of noise in the galaxy power spectrum; we can write this relationship using once again the bias expansion\n\u03c32gg = \u2211\n\u03b1,\u03b2,\u00b5,\u03bd\u2208[1,\u03b4,\u03b42,s2,\u22072\u03b4]\nb\u03b1b\u03b2b\u00b5b\u03bd\u03c3 2 \u03b1\u03b2,\u00b5\u03bd , (7.1)\nand in this expression we have slightly changed our notation for the variances. This was necessary because our previous notation did not allow us to represent cross-variances between different spectra, which we now write as\n\u03c32\u03b1\u03b2,\u00b5\u03bd = \u3008(P\u03b1\u03b2 \u2212 P\u0304\u03b1\u03b2)(P\u00b5\u03bd \u2212 P\u0304\u00b5\u03bd)\u3009. (7.2)\nThese cross-variances can give quite large contributions to the galaxy spectrum variance, which represents an issue since our calculations are not capable of giving predictions for them; however, as we have seen, one can divide these spectra into three groups, namely {P11, P1\u03b4, P\u03b4\u03b4}, {P1\u03b42 , P1s2 , P\u03b4\u03b42 , P\u03b4s2} and {P\u03b42\u03b42 , P\u03b42s2 , Ps2s2} such that the spectra belonging to a same group have very similar noise properties. Therefore, we will assume that if the spectra P\u03b1\u03b2 and P\u00b5\u03bd belong to the same group, their cross-variance will be given by\n\u03c3\u03b1\u03b2,\u00b5\u03bd = \u221a \u03c3\u03b1\u03b2\u03c3\u00b5\u03bd , (7.3)\n\u2013 17 \u2013\nand if they belong to different groups,\n\u03c3\u03b1\u03b2,\u00b5\u03bd = 0. (7.4)\nUsing these approximations and our calculations of the variances \u03c3\u00b5\u03bd , \u00b5, \u03bd \u2208 [1, \u03b4, \u03b42, s2,\u22072\u03b4] for F&P simulations we can thus compute the contribution of the statistical noise in simulations to the final error in the galaxy power-spectrum, and even forecast the size of the simulations one should run to have this term below the expected measurement error in EUCLID galaxy power spectra.\nThe calculation of the measurement error for galaxy power-spectra in an EUCLID-like survey was done using the parameters shown in table (3), and the expression for the variance in a random Gaussian field\n\u03c32E = 2\nNk P 2gg, (7.5)\nin which Nk = 4\u03c0k3\u2206(ln k)VE/(2\u03c0)3 is the number of Fourier modes falling the spherical shell\n\u2013 18 \u2013\nof radius k, and the power spectrum is given by\nPgg = \u2211\ni,j\u2208[1,\u03b4,\u03b42,s2,\u22072\u03b4]\nbibjPij + 1\nn\u0304 . (7.6)\nWe have considered two separate cases for the values of the bias parameters. In the first case we do a fiducial analysis, considering the bias parameters which seem most likely to be found by the EUCLID survey; for that, we fixed the linear Lagrangian bias to its expected value from forecasts, bL1 = 0.38 [1], and the values of the other bias parameters were obtained from the co-evolution relations for galaxies found in [27]. The second scenario we have considered is one in which b\u03b42 and bs2 take the maximum values of the intervals over which [27] observed them to vary; the motivation for this is that in the fiducial case the contributions coming from \u03c3\u03b42\u03b42 , \u03c3\u03b42s2 and \u03c3s2s2 are highly suppressed due to the very small values taken by their accompanying bias parameters, despite their sheer values being much larger than for the other spectra, as can be seen in figure (7). Therefore, relatively small variations in these bias parameters could lead to very different scenarios in which the model error is actually dominated by the noise in these spectra; the second scenario thus serves to probe such regimes. From figure (6) one can see that a F&P simulation with a volume V \u223c 2[Gpc/h]3 would be sufficient to have the statistical errors smaller than what is expected for EUCLID, in the case of the fiducial bias parameters. This shows the great power of the F&P technique, as this volume corresponds to roughly 6% of the assumed volume for EUCLID; using a simulation with usual initial conditions would require a volume at least as large as that of the survey. For the second set of biases the error becomes dominated by \u03c3\u03b42\u03b42 , \u03c3\u03b42s2 and \u03c3s2s2 , and the necessary volume for the statistical error to be below EUCLID errors is around V \u223c 16[Gpc/h]3; the dashed lines in this figure show how in this case our optimization procedure helps reduce by a factor of almost 10 the error in the final galaxy spectrum at the largest scales. In summary, these results show that controlling this source of error is within reach, and that obtaining a model with the precision required for EUCLID analysis will depend mostly on reducing emulation and rescaling errors, as these are in the range 1% \u223c 3%, and thus we can see from figure (6) that they would dominate over the statistical noise."
        },
        {
            "heading": "8 Conclusion",
            "text": "With the analyses presented in this we have demonstrated the power of F&P simulations for building hybrid Lagrangian bias expansion models of LSS. We have shown that the method does not introduce any biases to the relevant spectra, while significantly reducing the variance in the final galaxy spectrum, and thus easing the computational tasks of running simulations large enough to have the required precision to analyse upcoming survey data. This establishes this technique firmly as a foremost method to accessing accurate and precise predictions of LSS summary statistics. We have also explored the method\u2019s deficiencies, namely the fact that it does not reduce the variance for all of the basis spectra. We provided a clear analytical explanation for these observations based on LPT; the same formalism also allowed us to obtain predictions for the variances of these basis spectra in F&P simulations. These results should be fundamental for future analyses that use hybrid Lagrangian bias expansion models, as they are a direct and extremely flexible way to obtain the error being made in the model, and this is expected to have a sizeable importance with the continuous reduction of experimental errors.\n\u2013 19 \u2013\nUsing the analytical predictions for the variances in the basis spectra we have also been able to develop an understanding of the numerical challenges that have to be overcome to make hybrid Lagrangian bias expansion models precise enough for the analysis of EUCLID data. Our results clearly indicate that, assuming the real biases to be between the fiducial and worst-case scenarios, simulations with V \u223c 8[Gpc/h]3 should be sufficient to make the statistical noise in the model smaller than EUCLID errors; this volume is well within reach of current supercomputing facilities. Therefore, other sources of error such as those from interpolation schemes or from techniques to scale existing simulations to new cosmologies, are the ones that will need to be mitigated. Finally, it was also possible to go beyond the limitations of the method, reducing the variance in terms that remain otherwise unaltered, namely \u03c3\u03b42\u03b42 , \u03c3\u03b42s2 and \u03c3s2s2 . For the simulation size and resolution used, the method has proved to be unbiased, and the reduction in the variances was substantial, reason enough to consider it as a good option to reduce statistical noise rather than simply running larger simulations. It also highlights the influence of the initial phase-field in the derived n-point functions, showing that there exist a large number of initial configurations that lead to results arbitrarily close to the ensemble average."
        },
        {
            "heading": "A Advected Lagrangian Fields",
            "text": "In this appendix we show the results of applying equation (5.3) to each of the F (q) \u2208[ 1, \u03b4, \u03b42, s2,\u22072\u03b4 ] . It is convenient to define a kernel which will appear many times in the following calculations,\nFZA(q1, q2) = 1 + q1 \u00b7 q2 q1q2 ( q1 q2 + q2 q1 ) + (q1 \u00b7 q2)2 q21q 2 2 . (A.1)\nA.1 \u03b41\n\u03b41(k) = \u03b4 L k +\n1\n2 \u222b q1 FZA(q1,k \u2212 q1)\u03b4Lq1\u03b4 L k\u2212q1 +O(\u03b4 3) (A.2)\n\u2013 20 \u2013\nA.2 \u03b4\u03b4\n\u03b4\u03b4(k) = \u03b4 L k + \u222b q1 \u03b4Lq1\u03b4 L k\u2212q1 k \u00b7 (k \u2212 q1) |k \u2212 q1|2 + 1 2 \u222b q1,q2 \u03b4Lq1\u03b4 L q2\u03b4 L k\u2212q12FZA(q2,k\u2212 q12) +O(\u03b4 4) (A.3)\nA.3 \u03b4\u03b42\n\u03b4\u03b42(k) = \u222b q1 \u03b4Lq1\u03b4 L k\u2212q1 + \u222b q1,q2 \u03b4Lq1\u03b4 L q2\u03b4 L k\u2212q12 k \u00b7 (k \u2212 q12) |k \u2212 q12|2 +O(\u03b44) (A.4)\nA.4 \u03b4s2\n\u03b4s2(k) = \u222b q1 \u03b4Lq1\u03b4 L k\u2212q1S2(q1,k\u2212q1)+ \u222b q1,q2 k \u00b7 (k \u2212 q12) |k \u2212 q12|2 S2(q1, q2)\u03b4 L q1\u03b4 L q2\u03b4 L k\u2212q12 +O(\u03b4 4) (A.5)\nA.5 \u03b4\u22072\u03b4\n\u03b4\u22072\u03b4(k) = k 2\u03b4Lk + \u222b q1 q21\u03b4 L q1\u03b4 L k\u2212q1 k \u00b7 (k \u2212 q1) |k \u2212 q1|2 + 1 2 \u222b q1,q2 q21\u03b4 L q1\u03b4 L q2\u03b4 L k\u2212q12FZA(q2,k\u2212q12)+O(\u03b4 4)\n(A.6)"
        },
        {
            "heading": "B Further Details on Quantitative Predictions",
            "text": "In this appendix we will provide further details on the calculations sketched in section 5.5 . Because we have already described the calculation of \u03c311(k) in the main text, we will detail here the calculation of \u03c31\u03b4(k). We omit the calculations for the other spectra, since they are completely analogous.\nB.1 \u03c31\u03b4 Using the expressions for the advected fields, obtained in appendix A, we can readily write an expression for the P1\u03b4 spectrum\n1\nL3 \u03b4\u03b4(k)\u03b41(\u2212k) =PL(k) +O(3)\n+ 1\n2 \u222b q1,q2 \u221a PLq1P L k\u2212q1P L q2P L k\u2212q2 k \u00b7 (k \u2212 q1) |k \u2212 q1|2 FZA(q2,k \u2212 q2)\n\u00d7 cos(\u03b8q1 + \u03b8k\u2212q1 \u2212 \u03b8q2 \u2212 \u03b8k\u2212q2)\n(B.1)\nin which we have not explicitly written the third-order terms because we already know they will be cancelled by pairing, and are thus irrelevant to the current calculation. The only term contributing to the variance will be the fourth-order one,\nT1(k) = 1\n2 \u222b q1,q2 \u221a PLq1P L k\u2212q1P L q2P L k\u2212q2 k \u00b7 (k \u2212 q1) |k \u2212 q1|2 FZA(q2,k \u2212 q2) cos(\u03b8q1 + \u03b8k\u2212q1 \u2212 \u03b8q2 \u2212 \u03b8k\u2212q2)\n= \u222b q1,q2 A(q1, q2,k) cos (\u0398(q1, q2,k)) ,\n(B.2)\nin which\nA(q1, q2,k) = \u221a PLq1P L k\u2212q1P L q2P L k\u2212q2 k \u00b7 (k \u2212 q1) |k \u2212 q1|2 FZA(q2,k \u2212 q2)\n\u0398(q1, q2,k) = \u03b8q1 + \u03b8k\u2212q1 \u2212 \u03b8q2 \u2212 \u03b8k\u2212q2 (B.3)\n\u2013 21 \u2013\nWe must compute the expression\n\u3008T 21 (k)\u3009 \u2212 \u3008T1(k)\u30092, (B.4)\nand we begin by evaluating the first term in this expression, which we rewrite as\n\u3008T 21 (k)\u3009 = \u222b q1,q2,q3,q4 A(q1, q2,k)A(q3, q4,k) \u3008cos (\u0398(q1, q2,k)) cos (\u0398(q3, q4,k))\u3009 . (B.5)\nOnce again, we see that the ensemble average in the expression above will give a non-zero contribution only when we have\ncos (\u0398(q1, q2,k)) = cos (\u0398(q3, q4,k)) , (B.6)\nwhich implies\n\u03b8q1 + \u03b8k\u2212q1 \u2212 \u03b8q2 \u2212 \u03b8k\u2212q2 = \u03b8q3 + \u03b8k\u2212q3 \u2212 \u03b8q4 \u2212 \u03b8k\u2212q4 . (B.7)\nThis will be satisfied if one of the following conditions is satisfied\n q1 = q2 and q3 = q4, or q1 = k \u2212 q2 and q3 = q4, or q1 = q2 and q3 = k \u2212 q4, or q1 = k \u2212 q2 and q3 = k \u2212 q4, or\n q1 = q3 and q2 = q4, or q1 = q4 and q2 = q3, or q1 = k \u2212 q3 and q2 = k \u2212 q4, or q1 = k \u2212 q4 and q2 = k \u2212 q3, or q1 = q3 and q2 = k \u2212 q4, or q1 = k \u2212 q3 and q2 = q4, or q1 = q4 and q2 = k \u2212 q3, or q1 = k \u2212 q4 and q2 = q3.\nEach of these terms will give us a contribution, and once again we will not explicitly write the terms in the left block, because we affirm they will cancel the second term appearing in\n\u2013 22 \u2013\nexpression (B.4). The contributions coming from the conditions in the right block will be\nA1 = 1\n8 \u222b q1 PLq1P L |k\u2212q1| ( k \u00b7 (k \u2212 q1) |k \u2212 q1|2 )2 \u222b q2 PLq2P L |k\u2212q2|F 2 ZA(q2,k \u2212 q2)\nA2 = 1\n8 [\u222b q PLq P L |k\u2212q| k \u00b7 (k \u2212 q) |k \u2212 q|2 FZA(q,k \u2212 q) ]2\nA3 = 1\n8 \u222b q1 PLq1P L |k\u2212q1| k \u00b7 (k \u2212 q1) |k \u2212 q1|2 k \u00b7 q1 q21 \u222b q2 PLq2P L |k\u2212q2|F 2 ZA(q2,k \u2212 q2)\nA4 = 1\n8 [\u222b q PLq P L |k\u2212q| k \u00b7 (k \u2212 q) |k \u2212 q|2 FZA(q,k \u2212 q) ]2\nA5 = 1\n8 \u222b q1 PLq1P L |k\u2212q1| ( k \u00b7 (k \u2212 q1) |k \u2212 q1|2 )2 \u222b q2 PLq2P L |k\u2212q2|F 2 ZA(q2,k \u2212 q2)\nA6 = 1\n8 \u222b q1 PLq1P L |k\u2212q1| k \u00b7 (k \u2212 q1) |k \u2212 q1|2 k \u00b7 q1 q21 \u222b q2 PLq2P L |k\u2212q2|F 2 ZA(q2,k \u2212 q2)\nA7 = 1\n8 [\u222b q PLq P L |k\u2212q| k \u00b7 (k \u2212 q) |k \u2212 q|2 FZA(q,k \u2212 q) ]2\nA8 = 1\n8 [\u222b q PLq P L |k\u2212q| k \u00b7 (k \u2212 q) |k \u2212 q|2 FZA(q,k \u2212 q) ]2 .\n(B.8)\nMany of these contributions are equal, and summing them up, we obtain that the variance of P1\u03b4 in a fixed and paired simulation is given approximately by\n\u03c321\u03b4(k) \u2248 1\n2 [\u222b q PLq P L |k\u2212q| k \u00b7 (k \u2212 q) |k \u2212 q|2 FZA(q,k \u2212 q) ]2\n+ 1\n2 \u222b q1 PLq1P L |k\u2212q1| k \u00b7 (k \u2212 q1) |k \u2212 q1|2 k \u00b7 q1 q21 \u222b q2 PLq2P L |k\u2212q2|F 2 ZA(q2,k \u2212 q2).\n(B.9)"
        },
        {
            "heading": "C EUCLID Forecast Parameters",
            "text": "The parameters used to estimate the measurement errors on EUCLID spectra were obtained from [1]. We have considered the volume of a redshift slice ranging from z = 0.85 to z = 0.95, spanning an observed area of 15.000deg2 and using the cosmology from [19] to compute the comoving distances."
        },
        {
            "heading": "D Details of Optimization",
            "text": "In section 6 we have derived optimal phase-fields which can be used to initialize simulations and obtain spectra with reduced variances. Figure (8) shows a comparison between the\n\u2013 23 \u2013\nvariances computed from the 200 usual F&P simulations, and those computed from a set of 5 F&P simulations initialized with distinct realizations of the optimal phase-fields. With the purpose of including the effects of this suppression into the calculation of \u03c3gg \u2013 see equation (7.1) \u2013 we fitted the ratio \u03c3op/\u03c3F&P using the following expression\nf(k, a, b, c, d, e) = a (b+ c tanh [(k \u2212 d)e]) . (D.1)\nUsing this fit we could then approximate the optimized variance for any value of the simulated volume, cosmology or redshift using\n\u03c3op(k,\u0398, z, V ) = \u03c3F&P (k,\u0398, z, V )f(k, a0, b0, c0, d0, e0), (D.2)\nin which we have represented the cosmological parameters by \u0398, z is the redshift, V is the simulated volume, and a0, b0, \u00b7 \u00b7 \u00b7 are the fitted values of the parameters."
        },
        {
            "heading": "Acknowledgments",
            "text": "The authors acknowledge the support of the ERC-StG number 716151 (BACCO). FM acknowledges partial support from FAPESP via the fellowship 2019/01631-0. The authors acknowledge useful discussions with C. Rampf and R. Voivodic. We also thank O. Hahn, C. Rampf and R. Voivodic for valuable suggestions and comments on the draft.\n\u2013 26 \u2013"
        }
    ],
    "title": "Statistics of biased tracers in variance-suppressed simulations",
    "year": 2022
}
{
    "abstractText": "Statistical shape modeling aims at capturing shape variations of an anatomical structure that occur within a given population. Shape models are employed in many tasks, such as shape reconstruction and image segmentation, but also shape generation and classification. Existing shape priors either require dense correspondence between training examples or lack robustness and topological guarantees. We present FlowSSM, a novel shape modeling approach that learns shape variability without requiring dense correspondence between training instances. It relies on a hierarchy of continuous deformation flows, which are parametrized by a neural network. Our model outperforms state-of-the-art methods in providing an expressive and robust shape prior for distal femur and liver. We show that the emerging latent representation is discriminative by separating healthy from pathological shapes. Ultimately, we demonstrate its effectiveness on two shape reconstruction tasks from partial data. Our source code is publicly available (https://github.com/davecasp/flowssm). DOI: https://doi.org/10.1007/978-3-031-16434-7_44 Posted at the Zurich Open Repository and Archive, University of Zurich ZORA URL: https://doi.org/10.5167/uzh-230764 Book Section Submitted Version The following work is licensed under a Creative Commons: Attribution 4.0 International (CC BY 4.0) License. Originally published at: L\u00fcdke, David; Amiranashvili, Tamaz; Ambellan, Felix; Ezhov, Ivan; Menze, Bjoern H; Zachow, Stefan (2022). Landmark-Free Statistical Shape Modeling Via Neural Flow Deformations. In: Wang, Linwei; Dou, Qi; Fletcher, Thomas P; Speidel, Stefanie; Liu, Shuo. Medical Image Computing and Computer Assisted Intervention : MICCAI 2022. Cham: Springer, 453-463. DOI: https://doi.org/10.1007/978-3-031-16434-7_44 Landmark-free Statistical Shape Modeling via Neural Flow Deformations David L\u00fcdke, Tamaz Amiranashvili, Felix Ambellan, Ivan Ezhov, Bjoern Menze, and Stefan Zachow 1 Zuse Institute Berlin, Berlin, Germany 2 University of Zurich, Zurich, Switzerland tamaz.amiranashvili@uzh.ch 3 Technical University of Munich, Munich, Germany 4 Freie Universit\u00e4t Berlin, Berlin, Germany Abstract. Statistical shape modeling aims at capturing shape variations of an anatomical structure that occur within a given population. Shape models are employed in many tasks, such as shape reconstruction and image segmentation, but also shape generation and classification. Existing shape priors either require dense correspondence between training examples or lack robustness and topological guarantees. We present FlowSSM, a novel shape modeling approach that learns shape variability without requiring dense correspondence between training instances. It relies on a hierarchy of continuous deformation flows, which are parametrized by a neural network. Our model outperforms state-ofthe-art methods in providing an expressive and robust shape prior for distal femur and liver. We show that the emerging latent representation is discriminative by separating healthy from pathological shapes. Ultimately, we demonstrate its effectiveness on two shape reconstruction tasks from partial data. Our source code is publicly available. Statistical shape modeling aims at capturing shape variations of an anatomical structure that occur within a given population. Shape models are employed in many tasks, such as shape reconstruction and image segmentation, but also shape generation and classification. Existing shape priors either require dense correspondence between training examples or lack robustness and topological guarantees. We present FlowSSM, a novel shape modeling approach that learns shape variability without requiring dense correspondence between training instances. It relies on a hierarchy of continuous deformation flows, which are parametrized by a neural network. Our model outperforms state-ofthe-art methods in providing an expressive and robust shape prior for distal femur and liver. We show that the emerging latent representation is discriminative by separating healthy from pathological shapes. Ultimately, we demonstrate its effectiveness on two shape reconstruction tasks from partial data. Our source code is publicly available.",
    "authors": [
        {
            "affiliations": [],
            "name": "David L\u00fcdke"
        },
        {
            "affiliations": [],
            "name": "Tamaz Amiranashvili"
        },
        {
            "affiliations": [],
            "name": "Felix Ambellan"
        },
        {
            "affiliations": [],
            "name": "Ivan Ezhov"
        },
        {
            "affiliations": [],
            "name": "Bjoern Menze"
        },
        {
            "affiliations": [],
            "name": "Stefan Zachow"
        }
    ],
    "id": "SP:e1630f306d4807b20274507283defa644745932a",
    "references": [
        {
            "authors": [
                "F. Ambellan",
                "H. Lamecker",
                "C. von Tycowicz",
                "S. Zachow"
            ],
            "title": "Statistical shape models - understanding and mastering variation in anatomy",
            "venue": "Rea, P.M. (ed.) Biomedical Visualisation, vol. 3, pp. 67\u201384. Springer",
            "year": 2019
        },
        {
            "authors": [
                "F. Ambellan",
                "M. Hanik",
                "C. von Tycowicz"
            ],
            "title": "Morphomatics: Geometric morphometrics in non-euclidean shape spaces (2021)",
            "year": 2021
        },
        {
            "authors": [
                "F. Ambellan",
                "A. Tack",
                "M. Ehlke",
                "S. Zachow"
            ],
            "title": "Automated segmentation of knee bone and cartilage combining statistical shape knowledge and convolutional neural networks: Data from the osteoarthritis initiative",
            "venue": "Medical image analysis 52, 109\u2013 118",
            "year": 2019
        },
        {
            "authors": [
                "F. Ambellan",
                "S. Zachow",
                "C. von Tycowicz"
            ],
            "title": "Rigid motion invariant statistical shape modeling based on discrete fundamental forms: Data from the osteoarthritis initiative and the alzheimer\u2019s disease neuroimaging initiative",
            "venue": "Medical Image Analysis 73, 102178",
            "year": 2021
        },
        {
            "authors": [
                "P.J. Besl",
                "N.D. McKay"
            ],
            "title": "Method for registration of 3-d shapes",
            "venue": "Sensor fusion IV: control paradigms and data structures. vol. 1611, pp. 586\u2013606. Spie",
            "year": 1992
        },
        {
            "authors": [
                "N. Charon",
                "A. Islam",
                "W. Zbijewski"
            ],
            "title": "Landmark-free morphometric analysis of knee osteoarthritis using joint statistical models of bone shape and articular space variability",
            "venue": "Journal of Medical Imaging 8(4), 044001",
            "year": 2021
        },
        {
            "authors": [
                "R.T.Q. Chen",
                "Y. Rubanova",
                "J. Bettencourt",
                "D. Duvenaud"
            ],
            "title": "Neural ordinary differential equations",
            "venue": "Advances in Neural Information Processing Systems",
            "year": 2018
        },
        {
            "authors": [
                "Z. Chen",
                "H. Zhang"
            ],
            "title": "Learning implicit fields for generative shape modeling",
            "venue": "Proceedings of the IEEE/CVF Conference on Computer Vision and Pattern Recognition. pp. 5939\u20135948",
            "year": 2019
        },
        {
            "authors": [
                "T.F. Cootes",
                "C.J. Taylor",
                "D.H. Cooper",
                "J. Graham"
            ],
            "title": "Active shape models-their training and application",
            "venue": "Computer vision and image understanding 61(1), 38\u201359",
            "year": 1995
        },
        {
            "authors": [
                "R.H. Davies"
            ],
            "title": "Learning shape: optimal models for analysing natural variability",
            "venue": "The University of Manchester (United Kingdom)",
            "year": 2002
        },
        {
            "authors": [
                "B.C. Davis",
                "P.T. Fletcher",
                "E. Bullitt",
                "S. Joshi"
            ],
            "title": "Population shape regression from random design data",
            "venue": "International journal of computer vision 90(2), 255\u2013266",
            "year": 2010
        },
        {
            "authors": [
                "S. Durrleman",
                "M. Prastawa",
                "N. Charon",
                "J.R. Korenberg",
                "S. Joshi",
                "G. Gerig",
                "A. Trouv\u00e9"
            ],
            "title": "Morphometry of anatomical shape complexes with dense deformations and sparse parameters",
            "venue": "NeuroImage 101, 35\u201349",
            "year": 2014
        },
        {
            "authors": [
                "P.T. Fletcher",
                "C. Lu",
                "S.M. Pizer",
                "S. Joshi"
            ],
            "title": "Principal geodesic analysis for the study of nonlinear statistics of shape",
            "venue": "IEEE transactions on medical imaging 23(8), 995\u20131005",
            "year": 2004
        },
        {
            "authors": [
                "K. Gupta",
                "M. Chandraker"
            ],
            "title": "Neural mesh flow: 3d manifold mesh generation via diffeomorphic flows",
            "venue": "Advances in Neural Information Processing Systems 33, 1747\u2013 1758",
            "year": 2020
        },
        {
            "authors": [
                "T. Heimann",
                "H.P. Meinzer"
            ],
            "title": "Statistical shape models for 3d medical image segmentation: a review",
            "venue": "Medical image analysis 13(4), 543\u2013563",
            "year": 2009
        },
        {
            "authors": [
                "S. Huckemann",
                "T. Hotz",
                "A. Munk"
            ],
            "title": "Intrinsic shape analysis: Geodesic pca for riemannian manifolds modulo isometric lie group actions",
            "venue": "Statistica Sinica pp. 1\u2013 58",
            "year": 2010
        },
        {
            "authors": [
                "C. Jiang",
                "J. Huang",
                "A. Tagliasacchi",
                "L.J. Guibas"
            ],
            "title": "Shapeflow: Learnable deformation flows among 3d shapes",
            "venue": "Larochelle, H., Ranzato, M., Hadsell, R., Balcan, M.F., Lin, H. (eds.) Advances in Neural Information Processing Systems. vol. 33, pp. 9745\u20139757. Curran Associates, Inc.",
            "year": 2020
        },
        {
            "authors": [
                "D. Kainm\u00fcller",
                "T. Lange",
                "H. Lamecker"
            ],
            "title": "Shape constrained automatic segmentation of the liver based on a heuristic intensity model",
            "venue": "Proc. MICCAI Workshop 3D Segmentation in the Clinic: A Grand Challenge. vol. 109, p. 116",
            "year": 2007
        },
        {
            "authors": [
                "M. Kazhdan",
                "H. Hoppe"
            ],
            "title": "Screened poisson surface reconstruction",
            "venue": "ACM Transactions on Graphics (ToG) 32(3), 1\u201313",
            "year": 2013
        },
        {
            "authors": [
                "J.H. Kellgren",
                "J. Lawrence"
            ],
            "title": "Radiological assessment of osteo-arthrosis",
            "venue": "Annals of the rheumatic diseases 16(4), 494",
            "year": 1957
        },
        {
            "authors": [
                "L. Van der Maaten",
                "G. Hinton"
            ],
            "title": "Visualizing data using t-sne",
            "venue": "Journal of machine learning research 9(11)",
            "year": 2008
        },
        {
            "authors": [
                "M.I. Miller",
                "A. Trouv\u00e9",
                "L. Younes"
            ],
            "title": "Geodesic shooting for computational anatomy",
            "venue": "Journal of mathematical imaging and vision 24(2), 209\u2013228",
            "year": 2006
        },
        {
            "authors": [
                "M. Niemeyer",
                "L. Mescheder",
                "M. Oechsle",
                "A. Geiger"
            ],
            "title": "Occupancy flow: 4d reconstruction by learning particle dynamics",
            "venue": "Proceedings of the IEEE/CVF international conference on computer vision. pp. 5379\u20135389",
            "year": 2019
        },
        {
            "authors": [
                "J.J. Park",
                "P. Florence",
                "J. Straub",
                "R. Newcombe",
                "S. Lovegrove"
            ],
            "title": "Deepsdf: Learning continuous signed distance functions for shape representation",
            "venue": "Proceedings of the IEEE/CVF Conference on Computer Vision and Pattern Recognition. pp. 165\u2013 174",
            "year": 2019
        },
        {
            "authors": [
                "C. von Tycowicz",
                "F. Ambellan",
                "A. Mukhopadhyay",
                "S. Zachow"
            ],
            "title": "An efficient riemannian statistical shape model using differential coordinates: with application to the classification of data from the osteoarthritis initiative",
            "venue": "Medical image analysis 43, 1\u20139",
            "year": 2018
        },
        {
            "authors": [
                "M. Vaillant",
                "A. Qiu",
                "J. Glaun\u00e8s",
                "M.I. Miller"
            ],
            "title": "Diffeomorphic metric surface mapping in subregion of the superior temporal gyrus",
            "venue": "NeuroImage 34(3), 1149\u20131159",
            "year": 2007
        },
        {
            "authors": [
                "L. Wang",
                "F. Beg",
                "T. Ratnanather",
                "C. Ceritoglu",
                "L. Younes",
                "J.C. Morris",
                "J.G. Csernansky",
                "M.I. Miller"
            ],
            "title": "Large deformation diffeomorphism and momentum based hippocampal shape discrimination in dementia of the alzheimer type",
            "venue": "IEEE transactions on medical imaging 26(4), 462\u2013470",
            "year": 2007
        },
        {
            "authors": [
                "S. Wold",
                "K. Esbensen",
                "P. Geladi"
            ],
            "title": "Principal component analysis",
            "venue": "Chemometrics and intelligent laboratory systems 2(1-3), 37\u201352",
            "year": 1987
        }
    ],
    "sections": [
        {
            "text": "DOI: https://doi.org/10.1007/978-3-031-16434-7_44\nPosted at the Zurich Open Repository and Archive, University of Zurich ZORA URL: https://doi.org/10.5167/uzh-230764 Book Section Submitted Version\nThe following work is licensed under a Creative Commons: Attribution 4.0 International (CC BY 4.0) License.\nOriginally published at: L\u00fcdke, David; Amiranashvili, Tamaz; Ambellan, Felix; Ezhov, Ivan; Menze, Bjoern H; Zachow, Stefan (2022). Landmark-Free Statistical Shape Modeling Via Neural Flow Deformations. In: Wang, Linwei; Dou, Qi; Fletcher, Thomas P; Speidel, Stefanie; Liu, Shuo. Medical Image Computing and Computer Assisted Intervention : MICCAI 2022. Cham: Springer, 453-463. DOI: https://doi.org/10.1007/978-3-031-16434-7_44\nLandmark-free Statistical Shape Modeling via\nNeural Flow Deformations\nDavid Lu\u0308dke\u22c61, Tamaz Amiranashvili\u22c61,2,3, Felix Ambellan1,4, Ivan Ezhov3, Bjoern Menze2,3, and Stefan Zachow1\n1 Zuse Institute Berlin, Berlin, Germany 2 University of Zurich, Zurich, Switzerland\ntamaz.amiranashvili@uzh.ch 3 Technical University of Munich, Munich, Germany\n4 Freie Universita\u0308t Berlin, Berlin, Germany\nAbstract. Statistical shape modeling aims at capturing shape variations of an anatomical structure that occur within a given population. Shape models are employed in many tasks, such as shape reconstruction and image segmentation, but also shape generation and classification. Existing shape priors either require dense correspondence between training examples or lack robustness and topological guarantees. We present FlowSSM, a novel shape modeling approach that learns shape variability without requiring dense correspondence between training instances. It relies on a hierarchy of continuous deformation flows, which are parametrized by a neural network. Our model outperforms state-ofthe-art methods in providing an expressive and robust shape prior for distal femur and liver. We show that the emerging latent representation is discriminative by separating healthy from pathological shapes. Ultimately, we demonstrate its effectiveness on two shape reconstruction tasks from partial data. Our source code is publicly available5.\nKeywords: Representation learning \u00b7 Statistical shape analysis \u00b7 Shape prior"
        },
        {
            "heading": "1 Introduction",
            "text": "Statistical shape models (SSMs) are an important tool in medical image analysis and computational anatomy. Application examples include diagnosis, pathology detection and segmentation, outlier detection, shape reconstruction, etc. (cf. e.g. [1]). For this purpose, shape models capture variations in shape that occur within the population of a given anatomical structure. The model is typically learned in an automated fashion from example data. This results in a generative model, which can be, among others, used as a regularizer for ill-posed tasks. Furthermore, shape models provide a low-dimensional statistics-driven latent representation of shapes, which allows clustering, classification and shape regression.\n\u22c6 Equal contribution 5 https://github.com/davecasp/flowssm\nar X\niv :2\n20 9.\n06 86\n1v 1\n[ cs\n.C V\n] 1\n4 Se\np 20\n22\nThe most established statistical shape model in the medical domain is a point distribution model (PDM) [9,15]. While PDMs are simple and effective, they employ linear statistics, which restricts their capacity to fully capture the high variability of anatomical structures [11]. There exists a variety of non-linear statistical shape models [13,16,25] that have been shown to increase the flexibility and can handle large, non-linear deformations well, such as the recently developed fundamental coordinate model (FCM) [4]. However, most of these models still require consistently parametrized training shapes, i.e. shapes which are in dense correspondence to each other. This limits the learned shape model to the resolution of the given training data. Furthermore, generating well-defined dense correspondence typically requires manual landmark annotation that is tedious to obtain. Moreover, establishing exact dense correspondence is faulted by generally undefined true dense correspondence of biological shapes [15]. Lastly, as these models work on uncoupled primitives, such as mesh triangles, they have no inherent safeguards to avoid the generation of unnatural shapes with selfintersections.\nAnother popular tool in computational anatomy is large deformation diffeomorphic metric mapping (LDDMM) [22,26,12]. It allows estimating a template from a population of training shapes, as well as deformations that map the template to individual subjects. These deformations are continuous, however they are parametrized by a finite set of momentum vectors, providing a compact latent representation. While the template is population-wide, the subject-specific latent representations result from independent, pair-wise registration of each subject to the template. In context of shape modeling, LDDMMs have several advantages over PDMs and FCMs. First, LDDMMs do not rely on dense correspondence between training shapes. Second, being formulated as a diffeomorphism, they are less prone to producing self-intersections. Recently, novel parametrizations of approximately diffeomorphic deformation flows through a multilayer perceptron (MLP) were proposed [23,17,14]. The MLP\u2019s parameters are estimated on the training data, hence representing a population-wide prior. In this work, we extend neurally parametrized deformation fields to create FlowSSM \u2013 a novel hierarchical, continuous shape model, that is able to accurately capture variations in shapes of anatomical structures without requiring dense correspondence between training shapes. Our main contributions can be summarized as follows:\n\u2013 We propose a novel shape model FlowSSM, which is based on continuous neural flows and produces natural shape deformations without relying on a given dense correspondence between training shapes.\n\u2013 Our model outperforms state-of-the-art methods in capturing variability in anatomical shapes variation on liver and distal femur, as measured in generalization ability and specificity.\n\u2013 We demonstrate the discriminative nature of our learned latent representation by classifying knee osteoarthritis.\n\u2013 We qualitatively show that our model provides anatomically plausible reconstructions from partial and sparse shapes on both anatomical structures."
        },
        {
            "heading": "2 Methodology",
            "text": ""
        },
        {
            "heading": "2.1 Neural Flow Deformer",
            "text": "We model shapes by a continuous deformation of a template surface (cf. Fig. 1). A shape X is obtained by deforming each point x0 on a template T along a trajectory x : [0, 1] \u2192 R3, where x(0) = x0 and x(1) \u2208 X. We model these trajectories by a time-dependent velocity field v : R3 \u00d7 [0, 1] \u2192 R3, that relates to x(\u00b7) through the following ordinary differential equation:\ndx(t)\ndt = v(x(t), t). (1)\nFor each initial condition x0 \u2208 T , the solution of this ODE describes a trajectory that starts in x0. All solutions for different starting points are summarized as the flow function \u03a6 : R3 \u00d7 [0, 1] \u2192 R3, for which holds:\n\u03a6(x0, \u03c4) = x0 + \u222b \u03c4 0 v(\u03a6(x0, t), t) dt. (2)\nHence, the flow \u03a6 describes the trajectory of a point x0 which tangentially follows the velocity field v. The target shape is described by {\u03a6(x0, 1) | x0 \u2208 T }.\nVelocity Field Parametrization Following recent advances in modeling continuous neural flows [7,23,17], we propose to parametrize the velocity field v(\u00b7, \u00b7) through an MLP that is conditional on a shape-specific latent representation z \u2208 Rd. Similar to [17], we define the deformation velocity field as:\nv\u03b8(x(t), t) = f\u03b8(x(t), t \u00b7 z) \u00b7 \u2016z\u20162 , (3)\nwhere f is the flow function parametrized by an MLP (IM-Net [8]) and then scaled by a flow magnitude proportional to the euclidean vector norm of z. For architectural detail of the applied flow function, we refer the reader to Fig. S1 in the supplements.\nGlobal and Local Level of Detail In Eq. (3), one global latent vector z \u2208 Rd for all starting points is employed. While being compact, such global parametrization tends to produce smooth, low-frequency deformations [17]. To extend the deformations\u2019 frequency spectrum, we propose to model the latent representation as a continuous function in R3. In particular, we interpolate M latent weights zk \u2208 R d at their control point positions ck \u2208 R 3 via radial basis functions, using a Gaussian kernel with an inverse width \u03b5k:\nz(x) = M\u2211 k=1 zk\u03d5k(\u2016ck \u2212 x\u20162) ,\n\u03d5k(r) = e \u2212(\u03b5k\u00b7r)\n2\n.\n(4)\nWhen solving (2) to obtain a deformation trajectory for a starting point x0 \u2208 T , we compute z(x) via (4) only at the starting point x0, using a constant z(x0) for the whole resulting trajectory. This allows us to sample {ck} equidistantly on the template surface, instead of the whole volume, making for a more compact parametrization.\nTo disentangle global, low frequency shape characteristics from local, high frequency details, we apply two deformers sequentially. The first one uses a global latent vector, while the second one uses the localized formulation (4). Each deformer has its own set of MLP parameters \u03b8g and \u03b8l respectively.\nIn summary, a global latent vector z, M local control points (zk, ck, \u03b5k) and MLP parameters \u03b8g and \u03b8l parametrize a continuous, time-dependent velocity field, which defines deformation trajectories for every surface point on a template, yielding a single target shape."
        },
        {
            "heading": "2.2 Training",
            "text": "Given a set of N arbitrarily parametrized but topologically equivalent training surfaces X = {X1, \u00b7 \u00b7 \u00b7 , XN} and a template surface T , our model is trained without given dense correspondence. Every shape Xi is represented by M + 1 latent vectors (zi, {zik}). The MLP parameters, {ck}, \u03b5k and T are shared across all training surfaces, representing a population-wide prior. We train our model as an auto-decoder [24,17]. That is, in training, the latent representations are randomly initialized from N (0, 0.12) and jointly optimized with the MLP parameters, without learning an encoder. The global and local deformers are trained consecutively with the same target surfaces X . The loss is the correspondencefree, symmetric point-set to point-set Chamfer distance C between randomly sampled surface points of the target Pi \u2282 Xi and deformed, sampled surface points of the template P\u03a6 = \u03a6 i(PT \u2282 T , 1):\nC(Pi, P\u03a6) = 1\n2|Pi| \u2211 xi\u2208Pi min x\u2208P\u03a6 \u2016xi \u2212 x\u20162 + 1 2|P\u03a6| \u2211 x\u2208P\u03a6 min xi\u2208Pi \u2016xi \u2212 x\u20162 . (5)\nAfter training, we estimate the probability distribution of the latent vectors by performing principal component analysis (PCA) [28] on the emerging latent\nrepresentations of training shapes. The PCA is performed separately for the global and local latent representations, keeping all modes of variation."
        },
        {
            "heading": "2.3 Inference",
            "text": "To embed unseen shape instances in the learned shape space, e.g. for reconstruction, one needs to obtain a latent representation that best describes a given observation. For this, a new latent embedding is initialized from N (0, 0.12). We fix the trained MLP parameters and {\u03b5k}, while the latent representations are optimized with the correspondence-free loss (5). Within this process, the latent embedding is restricted to the subspace, i.e. span of the training representations, defined by the PCA. The global and local latent representations are trained consecutively."
        },
        {
            "heading": "3 Experiments",
            "text": "We conduct experiments on three datasets: liver, distal femur bone, as well as the condyle region of the distal femur (a dataset summary can be found in Table S1 in the supplements). Both femur datasets cover the full spectrum of osteoarthritis severity. The liver, being a deformable soft tissue organ, exhibits a much higher degree of nonlinear variability, yielding a particularly challenging dataset for shape modeling.\nLiver and Femur Datasets The datasets consist of correspondingly 112 and 253 surfaces. The surfaces were obtained from manually segmented CT scans of liver [18] and MRI scans of knee [3]. For correspondence-based methods, consistently meshed surfaces were obtained semi-automatically following [18,25]. Both datasets are split into 70% training, 10% validation, and 20% test data.\nClassification DatasetWe adopt the Osteoarthritis Initiative6 - right distal femur dataset from [25,4]. The dataset consists of 116 femur surfaces with 58 healthy cases and 58 severe cases of osteoarthritis, according to their Kellgren and Lawrence [20] score of 0/1 and 4, respectively. For further information on the dataset and its construction, cf. [25,4].\nTemplate Generation For liver and femur datasets, we generate a correspondence free template per dataset by applying the hub-and-spokes approach of ShapeFlow [17]. This results in non-rigidly aligned training shapes in a canonical space. These are used for the template surface generation by applying an unscreened Poisson surface reconstruction [19]. Finally, the template meshes are simplified to attain approximately the same number of faces as in the training data. For the classification dataset, the template is directly constructed by unscreened Poisson surface reconstruction from given shapes.\nData Preprocessing Although our method randomly samples points on training surfaces and therefore does not use correspondences, we further emphasize this fact by re-meshing the surfaces to destroy correspondences. Each mesh\n6 nda.nih.gov/oai\nis aligned to its template via Iterative Closest Points [5]. All meshes are then isotropically rescaled to fit [\u22121, 1] based on the largest training instance and centred around the origin in alignment with the template shape. The classification dataset is left unchanged for comparability to previous works [25,4]."
        },
        {
            "heading": "3.1 Experimental Setup",
            "text": "In the following, we compare FlowSSM to two correspondence-based models \u2013 the linear PDM [9] and a non-linear statistical shape model, the FCM [4,2]. Furthermore, we compare to an LDDMM-based approach [12], where the emerging latent shape space is estimated by a PCA on the learned initial momentum vectors of training shapes. This is motivated by [27,6], who used a PCA on momenta for disease classification. For comparability, we use the same template and control points as in our method. We emphasize that the PDM and FCM baselines require corresponding meshes for training, in contrast to LDDMM and ours. We run all experiments on an NVIDIA A100 40GB GPU. The training takes about 2h and 4h for liver and femur data, respectively, while generating a single shape given a latent representation takes about 0.14s per shape. For further implementation details and hyperparameters, refer to Tables S2 and S4 in the supplements."
        },
        {
            "heading": "3.2 Generality and Specificity",
            "text": "To quantitatively assess the quality of our generative model in the light of statistical shape modeling, we apply two standard measures, generalization ability and specificity, as introduced by Davies [10]. Here, generality refers to the ability\nof a statistical shape model to fit unseen instances of the class of shapes. It is evaluated by the average symmetric surface distance between all test shapes and their reconstructions. To ensure comparability between the methods, we fit the correspondence-based models to the test shape by minimizing the average surface distance. In contrast to generality, specificity measures the restrictiveness of a model to generate shapes that are close to training instances. To generate random samples, we utilize the distributions described by all PCA modes of each model. We randomly sample 1000 surfaces by sampling latent representations and computing the surfaces. We then calculate their average surface distance to the closest example in the training set. For computational reasons, the surface distance is approximated by symmetric Chamfer distance.\nThe results in Table 1 show that FlowSSM exhibits the lowest generality error for both liver and femur, i.e., best fit to unseen shape instances. Further, FlowSSM is more specific than the baselines and generates samples closest to the training population. All methods are less precise on the liver dataset, which can be explained by larger, nonlinear variability in the deformable liver. Generally, dense correspondence between livers is not clearly defined and thus poses an additional challenge for PDM and FCM. The femur, on the other hand, has better defined correspondences and less variation between shapes, which we conjecture to be the main reason for similar performance between all methods. Furthermore, self-intersections degrade the resulting mesh quality and suggest that a model produces unnatural shape deformations. FlowSSM exhibits by far the lowest total number of self-intersecting meshes out of the four models, indicating smooth and natural shape deformations.\nLastly, our localized deformer allows us to nearly half the generalization error, when compared to the global parametrization of [17,23] (cf. Table S3 in the supplements)."
        },
        {
            "heading": "3.3 Osteoarthritis Classification",
            "text": "A discriminative emerging latent space is an important property of a shape model. Following the experimental setup of [4,25], we evaluate our model\u2019s ability to classify knee osteoarthritis (OA) \u2013 a degenerative disease of the joints which causes pathological malformities of the femur. To this end, FlowSSM is trained to best reconstruct the complete classification data of the condyle region. Note that this does not involve the OA labels and is therefore to be considered unsupervised. Ultimately, we classify the respective PCA weights of our model and the baselines with a linear support vector machine. We evaluate the average classification accuracy of a stratified Monte-Carlo cross-validation for 10,000 samples per partitioning with training set sizes from 10% to 90%.\nIn Fig. 2, the high average classification accuracy of our model across all partitionings is indicative of the discriminative nature of the unsupervisedly learned latent space. This is further exemplified through the emerging clustering in the t-distributed Stochastic Neighbor Embedding (t-SNE) [21] visualization. The FCM provides slightly more robust classification, especially for smaller training sets, indicating a more distinct linear separability of the weights. Still, our model shows comparable performance for larger training sets, without relying on given correspondence in representation learning."
        },
        {
            "heading": "3.4 Shape Reconstruction",
            "text": "Our model can be fitted to various target parametrizations. We fit our trained model from Sec. 3.2 to a partial mesh and a sparse point-cloud (200 surface points) from unseen subjects and reconstruct full meshes. In contrast to the shape inference in the generality experiment, a one-sided Chamfer distance is minimized to obtain a latent embedding. Reconstructions in Fig. 3 qualitatively highlight our model\u2019s specificity by displaying anatomically plausible reconstructions. At the same time, our model\u2019s generality is demonstrated by preserving patient-specific details, present in the targets."
        },
        {
            "heading": "4 Conclusion",
            "text": "We present a novel landmark-free shape model that captures variability of a given population of anatomical shapes. This is achieved through a novel, localized neural flow parametrization. Our model exhibits good generalization ability to unseen shapes without sacrificing specificity, demonstrated on two anatomical structures. Additionally, in contrast to established methods, our model does not require any given dense correspondences. Furthermore, the emerging latent space is discriminative, as demonstrated by classification of osteoarthritis.\nIn practice, our method simplifies building robust and expressive shape priors by utilizing large pools of heterogeneous training data, independent of their parametrization and resolution. The emerging latent representation is useful in discriminating various shape-correlated features. As the flow parametrization of our model makes it well suited for studying temporal shape trajectories, this poses an exciting future research direction."
        },
        {
            "heading": "Acknowledgements",
            "text": "This work was supported by the Bundesministerium fu\u0308r Bildung und Forschung (BMBF) through the research campus MODAL (ref. 3FO18501) and The Berlin Institute for the Foundations of Learning and Data (BIFOLD) - (ref. 01IS18025A and ref. 01IS18037A). We are grateful for the open-access dataset OAI. (The Osteoarthritis Initiative is a public-private partnership comprised of five contracts (N01-AR-2-2258; N01-AR-2-2259; N01-AR-2-2260; N01-AR-2-2261; N01-AR-22262) funded by the National Institutes of Health, a branch of the Department of Health and Human Services, and conducted by the OAI Study Investigators. Private funding partners include Merck Research Laboratories; Novartis Pharmaceuticals Corporation, GlaxoSmithKline; and Pfizer, Inc. Private sector funding for the OAI is managed by the Foundation for the National Institutes of Health. This manuscript was prepared using an OAI public use data set and does not necessarily reflect the opinions or views of the OAI investigators, the NIH, or the private funding partners.)"
        },
        {
            "heading": "A Supplements",
            "text": "Fig. S1. Depiction of the IM-Net MLP network [8] architecture of the neural flow field deformer. The IM-Net network consists of 5 fully connected layers with intermediate LeakyReLU activations and skip-layer connections (copy and concatenate). It takes a point coordinate x and a latent vector z as an input and outputs a displacement vector.\nTable S1. Dataset summary of the number of shapes in the training, validation and test set and number of vertices and faces per shape. Note: In the classification task, FlowSSM was trained on the whole dataset to best reconstruct the training shapes. This relates to an unsupervised learning task, as the classification labels were not used in training.\nLiver Femur Classification\n# Shapes 112 253 116 # Vertices per shape 12,974 11,968 8,988 # Faces per shape 25,944 23,814 17,829 # Training shapes 78 177 116 # Validation shapes 11 25 \u2013\n# Test shapes 23 51 \u2013\nTable S2. Hyperparameter values for different data sets. The number of control points M \u2208 [4, 10] and \u03b5 \u2208 [0.01, 30] of the radial basis function interpolation were tuned with Optuna TPESampler (optuna.readthedocs.io). The hyperparameter search minimizes the generalization ability evaluated on the validation data for femur and liver and a training reconstruction error for the classification data. lr refers to the Adam optimizer learning rate and d is the dimensionality of the latent representation. For LDDMM baselines, we use recommended parameters from the open-source reference implementation Deformetrica.\nParameter Liver Femur Classification\nM 63 73 103\ninitial \u03b5k 2.5963 3.7606 14.3416 train lr 0.001 0.001 0.001\ntrain epochs 300 300 300 inference lr 0.01 0.01 0.01 inference epochs 600 600 600 batch size 16 16 16\n# sampled surface points 15,000 15,000 15,000 d 128 128 128\nTable S3. Ablation study on the average surface distance in the generality experiment of the global vs. global + local flow deformer. Note, that the parametrization of the global flow deformer corresponds to the parameterization applied in ShapeFlow [17], which only insufficiently represents the geometric details present in anatomical structures.\nLiver Femur\nGlobal Flow Deformer 1.96 \u00b1 0.43 0.41 \u00b1 0.08 Global + Local Flow Deformer 1.20 \u00b1 0.18 0.24 \u00b1 0.04\nTable S4. Versions of used software packages.\nPackage Version\nPyTorch (pytorch.org) 1.10.0 torchdiffeq (github.com/rtqichen/torchdiffeq) 0.2.2\nMorphomatics (morphomatics.github.io) 1.0 (curious caesar) Deformetrica (deformetrica.org) 4.3.0"
        }
    ],
    "title": "Landmark-Free Statistical Shape Modeling Via Neural Flow Deformations",
    "year": 2023
}
{
    "abstractText": "The role of a market maker is to simultaneously offer to buy and sell quantities of goods, often a financial asset such as a share, at specified prices. An automated market maker (AMM) is a mechanism that offers to trade according to some predetermined schedule; the best choice of this schedule depends on the market maker\u2019s goals. The literature on the design of AMMs has mainly focused on prediction markets with the goal of information elicitation. More recent work motivated by DeFi has focused instead on the goal of profit maximization, but considering only a single type of good (traded with a numeraire), including under adverse selection (Milionis et al. 2022). Optimal market making in the presence of multiple goods, including the possibility of complex bundling behavior, is not well understood. In this paper, we show that finding an optimal market maker is dual to an optimal transport problem, with specific geometric constraints on the transport plan in the dual. We show that optimal mechanisms for multiple goods and under adverse selection can take advantage of bundling, both improved prices for bundled purchases and sales as well as sometimes accepting payment \u201cin kind.\u201d We present conjectures of optimal mechanisms in additional settings which show further complex behavior. From a methodological perspective, we make essential use of the tools of differentiable economics to generate conjectures of optimal mechanisms, and give a proof-of-concept for the use of such tools in guiding theoretical investigations.",
    "authors": [
        {
            "affiliations": [],
            "name": "Michael J. Curry"
        },
        {
            "affiliations": [],
            "name": "David C. Parkes"
        }
    ],
    "id": "SP:2ffdff6a332f6e54e82e381e4439cc80028256ac",
    "references": [
        {
            "authors": [
                "Jacob Abernethy",
                "Satyen Kale"
            ],
            "title": "Adaptive market making via online learning",
            "venue": "Advances in Neural Information Processing Systems,",
            "year": 2013
        },
        {
            "authors": [
                "Jacob Abernethy",
                "Yiling Chen",
                "Jennifer Wortman Vaughan"
            ],
            "title": "Efficient market making via convex optimization, and a connection to online learning",
            "venue": "ACM Transactions on Economics and Computation (TEAC),",
            "year": 2013
        },
        {
            "authors": [
                "Jacob D Abernethy",
                "Rafael M Frongillo"
            ],
            "title": "A characterization of scoring rules for linear properties",
            "venue": "In Conference on Learning Theory,",
            "year": 2012
        },
        {
            "authors": [
                "William James Adams",
                "Janet L Yellen"
            ],
            "title": "Commodity bundling and the burden of monopoly",
            "venue": "The quarterly journal of economics,",
            "year": 1976
        },
        {
            "authors": [
                "Guillermo Angeris",
                "Alex Evans",
                "Tarun Chitra"
            ],
            "title": "Replicating market makers",
            "year": 2021
        },
        {
            "authors": [
                "Maria-Florina Balcan",
                "Tuomas Sandholm",
                "Ellen Vitercik"
            ],
            "title": "A general theory of sample complexity for multi-item profit maximization",
            "venue": "In Economics and Computation",
            "year": 2018
        },
        {
            "authors": [
                "Maria-Florina Balcan",
                "Tuomas Sandholm",
                "Ellen Vitercik"
            ],
            "title": "Estimating approximate incentive compatibility",
            "venue": "In Economics and Computation (EC),",
            "year": 2019
        },
        {
            "authors": [
                "Maria-Florina F Balcan",
                "Tuomas Sandholm",
                "Ellen"
            ],
            "title": "Vitercik. Sample complexity of automated mechanism design",
            "venue": "In Advances in Neural Information Processing Systems,",
            "year": 2016
        },
        {
            "authors": [
                "Vincent Conitzer",
                "Tuomas Sandholm"
            ],
            "title": "Complexity of mechanism design",
            "venue": "In Uncertainty in Artificial Intelligence (UAI),",
            "year": 2002
        },
        {
            "authors": [
                "Michael Curry",
                "Ping-yeh Chiang",
                "Tom Goldstein",
                "John P. Dickerson"
            ],
            "title": "Certifying strategyproof auction networks",
            "venue": "In Neural Information Processing Systems (NeurIPS),",
            "year": 2020
        },
        {
            "authors": [
                "Michael Curry",
                "Tuomas Sandholm",
                "John Dickerson"
            ],
            "title": "Differentiable economics for randomized affine maximizer auctions",
            "venue": "In International Joint Conference on Artificial Intelligence (IJCAI),",
            "year": 2023
        },
        {
            "authors": [
                "Sanmay Das",
                "Malik Magdon-Ismail"
            ],
            "title": "Adapting to a market shock: Optimal sequential market-making",
            "venue": "Advances in Neural Information Processing Systems,",
            "year": 2008
        },
        {
            "authors": [
                "Constantinos Daskalakis",
                "Alan Deckelbaum",
                "Christos Tzamos"
            ],
            "title": "Mechanism design via optimal transport",
            "venue": "In Proceedings of the fourteenth ACM conference on Electronic commerce,",
            "year": 2013
        },
        {
            "authors": [
                "Constantinos Daskalakis",
                "Alan Deckelbaum",
                "Christos Tzamos"
            ],
            "title": "Strong duality for a multiple-good monopolist",
            "year": 2017
        },
        {
            "authors": [
                "Zhijian Duan",
                "Haoran Sun",
                "Yurong Chen",
                "Xiaotie Deng"
            ],
            "title": "A Scalable Neural Network for DSIC Affine Maximizer Auction Design, May 2023",
            "year": 2023
        },
        {
            "authors": [
                "Miroslav Dudik",
                "Sebastien Lahaie",
                "David M. Pennock",
                "David Rothschild"
            ],
            "title": "A combinatorial prediction market for the U.S. elections",
            "venue": "In Proceedings of the Fourteenth ACM Conference on Electronic Commerce,",
            "year": 2013
        },
        {
            "authors": [
                "Paul D\u00fctting",
                "Zhe Feng",
                "Harikrishna Narasimhan",
                "David C. Parkes",
                "Sai Srivatsa Ravindranath"
            ],
            "title": "Optimal auctions through deep learning: Advances in differentiable economics",
            "venue": "J. ACM,",
            "year": 2023
        },
        {
            "authors": [
                "Rafael Frongillo",
                "Ian Kash"
            ],
            "title": "General truthfulness characterizations via convex analysis",
            "venue": "In International Conference on Web and Internet Economics,",
            "year": 2014
        },
        {
            "authors": [
                "Rafael Frongillo",
                "Bo Waggoner"
            ],
            "title": "An axiomatic study of scoring rule markets",
            "venue": "arXiv preprint arXiv:1709.10065,",
            "year": 2017
        },
        {
            "authors": [
                "Rafael Frongillo",
                "Maneesha Papireddygari",
                "Bo Waggoner"
            ],
            "title": "An axiomatic characterization of cfmms and equivalence to prediction markets",
            "venue": "arXiv preprint arXiv:2302.00196,",
            "year": 2023
        },
        {
            "authors": [
                "Yiannis Giannakopoulos",
                "Elias Koutsoupias"
            ],
            "title": "Duality and optimality of auctions for uniform distributions",
            "venue": "In Economics and Computation (EC),",
            "year": 2014
        },
        {
            "authors": [
                "Mohak Goyal",
                "Geoffrey Ramseyer",
                "Ashish Goel",
                "David Mazi\u00e8res"
            ],
            "title": "Finding the Right Curve: Optimal Design of Constant Function Market Makers",
            "year": 2023
        },
        {
            "authors": [
                "Robin Hanson"
            ],
            "title": "Logarithmic markets coring rules for modular combinatorial information aggregation",
            "venue": "The Journal of Prediction Markets,",
            "year": 2007
        },
        {
            "authors": [
                "Christoph Hertrich",
                "Yixin Tao",
                "L\u00e1szl\u00f3 A V\u00e9gh"
            ],
            "title": "Mode connectivity in auction design",
            "venue": "In Neural Information Processing Systems (NeurIPS),",
            "year": 2023
        },
        {
            "authors": [
                "Ian A Kash",
                "Rafael M Frongillo"
            ],
            "title": "Optimal auctions with restricted allocations",
            "venue": "In Economics and Computation (EC),",
            "year": 2016
        },
        {
            "authors": [
                "Andreas Kleiner",
                "Alejandro Manelli"
            ],
            "title": "Strong Duality in Monopoly Pricing",
            "year": 2019
        },
        {
            "authors": [
                "Christian Kroer",
                "Miroslav Dud\u0301\u0131k",
                "S\u00e9bastien Lahaie",
                "Sivaraman Balakrishnan"
            ],
            "title": "Arbitrage-Free Combinatorial Market Making via Integer Programming",
            "venue": "In Proceedings of the 2016 ACM Conference on Economics and Computation,",
            "year": 2016
        },
        {
            "authors": [
                "Anton Likhodedov",
                "Tuomas Sandholm"
            ],
            "title": "Methods for boosting revenue in combinatorial auctions",
            "venue": "In AAAI,",
            "year": 2004
        },
        {
            "authors": [
                "Alejandro M. Manelli",
                "Daniel R. Vincent"
            ],
            "title": "Bundling as an optimal selling mechanism for a multiplegood monopolist",
            "venue": "J. Econ. Theory,",
            "year": 2006
        },
        {
            "authors": [
                "R Preston McAfee",
                "John McMillan"
            ],
            "title": "Multidimensional incentive compatibility and mechanism design",
            "venue": "Journal of Economic theory,",
            "year": 1988
        },
        {
            "authors": [
                "R Preston McAfee",
                "John McMillan",
                "Michael D Whinston"
            ],
            "title": "Multiproduct monopoly, commodity bundling, and correlation of values",
            "venue": "The Quarterly Journal of Economics,",
            "year": 1989
        },
        {
            "authors": [
                "Jason Milionis",
                "Ciamac C. Moallemi",
                "Tim Roughgarden",
                "Anthony Lee Zhang"
            ],
            "title": "Automated Market Making and Loss-Versus-Rebalancing",
            "venue": "doi: 10.48550/arXiv.2208",
            "year": 2022
        },
        {
            "authors": [
                "Jason Milionis",
                "Ciamac C. Moallemi",
                "Tim Roughgarden"
            ],
            "title": "A Myersonian Framework for Optimal Liquidity Provision in Automated Market Makers",
            "year": 2023
        },
        {
            "authors": [
                "Alfred M\u00fcller"
            ],
            "title": "Stochastic orders generated by integrals: a unified study",
            "venue": "Advances in Applied probability,",
            "year": 1997
        },
        {
            "authors": [
                "Roger B Myerson"
            ],
            "title": "Optimal auction design",
            "venue": "Mathematics of Operations Research,",
            "year": 1981
        },
        {
            "authors": [
                "Abraham Othman",
                "Tuomas Sandholm"
            ],
            "title": "Liquidity-sensitive automated market makers via homogeneous risk measures",
            "venue": "In International Workshop on Internet and Network Economics,",
            "year": 2011
        },
        {
            "authors": [
                "Gregory Pavlov"
            ],
            "title": "Optimal mechanism for selling two goods",
            "venue": "The BE Journal of Theoretical Economics,",
            "year": 2011
        },
        {
            "authors": [
                "Jad Rahme",
                "Samy Jelassi",
                "Joan Bruna",
                "S Matthew Weinberg"
            ],
            "title": "A permutation-equivariant neural network architecture for auction design",
            "venue": "arXiv preprint arXiv:2003.01497,",
            "year": 2020
        },
        {
            "authors": [
                "Jad Rahme",
                "Samy Jelassi",
                "S Matthew Weinberg"
            ],
            "title": "Auction learning as a two-player game",
            "venue": "In International Conference on Learning Representations (ICLR),",
            "year": 2021
        },
        {
            "authors": [
                "Jean-Charles Rochet"
            ],
            "title": "A necessary and sufficient condition for rationalizability in a quasi-linear context",
            "venue": "Journal of mathematical Economics,",
            "year": 1987
        },
        {
            "authors": [
                "Jean-Charles Rochet",
                "Philippe Chon\u00e9"
            ],
            "title": "Ironing, sweeping, and multidimensional screening",
            "year": 1998
        },
        {
            "authors": [
                "Ralph Tyrell Rockafellar"
            ],
            "title": "Convex analysis",
            "venue": "Princeton university press,",
            "year": 2015
        },
        {
            "authors": [
                "Tuomas Sandholm"
            ],
            "title": "Automated mechanism design: A new application area for search algorithms",
            "venue": "In International Conference on Principles and Practice of Constraint Programming,",
            "year": 2003
        },
        {
            "authors": [
                "Tuomas Sandholm",
                "Anton Likhodedov"
            ],
            "title": "Automated design of revenue-maximizing combinatorial auctions",
            "venue": "Operations Research,",
            "year": 2015
        },
        {
            "authors": [
                "Weiran Shen",
                "Pingzhong Tang",
                "Song Zuo"
            ],
            "title": "Automated mechanism design via neural networks",
            "venue": "In Proceedings of the 18th International Conference on Autonomous Agents and Multiagent Systems,",
            "year": 2019
        },
        {
            "authors": [
                "C\u00e9dric Villani"
            ],
            "title": "Topics in optimal transportation",
            "venue": "American Mathematical Soc.,",
            "year": 2003
        }
    ],
    "sections": [
        {
            "heading": "1 Introduction",
            "text": "Market participants like to buy low and sell high, and avoid doing the opposite, at least in expectation. By doing this, a market participant can make a profit. A typical market maker, which is an entity that plays a role in facilitating trades by other market participants, achieves profits by charging a spread: they are willing to buy some quantity of a good at a fixed price, and sell the same quantity at a higher fixed price. The goal of a market maker is to profit even in the face of potential adverse selection, which can arise when better informed traders can selectively accept offers that are profitable to them (and therefore unprofitable to the market maker). Roughly speaking, the spread should be wider when there is greater adverse selection.\nAt the same time, there is a much richer space of possibilities for market makers than simply adjusting the spread. Automated market makers (AMMs), as used in prediction markets and decentralized finance (DeFi), frequently make use of these richer possibilities. For example, the logarithmic-market scoring rule (LMSR) [23] and constant-product market makers [48] have the effect of offering a trader a continuum of trades at a continuum of prices. From the perspective of mechanism design, the use of spread by a market maker is similar to a posted-price mechanism, and posted-price mechanisms are well known to be optimal for selling a single good to a single buyer. Under reasonable models of adverse selection, the same is true for market making: optimal mechanisms consist of a bid-ask spread, where the nature and extent of adverse selection determines the width of the spread [33]. From the full space of mechanisms, the optimal mechanism in this single good case is therefore surprisingly simple.\nBut what if a market maker wants to make markets in multiple goods at once? In this case, the full space of mechanisms might be extremely rich: in addition to offering a continuum of trades (as with the aforementioned, single-good AMMs), there could be bundling among goods and the potential to accept goods \u201cin kind\u201d in exchange for a lower payment. For example, a market maker might offer to buy good 1 for\nar X\niv :2\n40 2.\n09 12\n9v 1\n[ cs\n.G T\n] 1\n4 Fe\nb 20\n24\nprice x, or sell good 2 for price y, but simultaneously buy good 1 and sell good 2 charging z < y \u2212 x. To our knowledge, it is atypical for current market makers to bundle goods, and they instead simply adjust a separate spread per good (analogous to item-wise, posted prices). There are a few exceptions, though; e.g., in the case of certain order types on the OneChronos combinatorial stock exchange [36], some experiments in combinatorial prediction markets [27, 16], and the portfolio trading of bonds.\nMany of these aforementioned cases of bundling are motivated by outside business constraints; e.g., there may be complements or substitutes between goods, or there may be practical reasons why a customer is forced to trade bundles. But what if all these outside concerns are removed? We want to understand whether a profit-maximizing market maker in the multiple-good case will want to take advantage of the full richness of the space of mechanisms. (Indeed, in classic auction design when selling multiple goods to a single buyer, optimal mechanisms may show this kind of complexity [14, 29, 25].) This question motivates our work. Under a deliberately simple model of additive and quasilinear traders, and considering an objective for the market maker that can take into account the possibility of adverse selection (following that of Milionis et al. [32]), we ask how much of the full space of possible mechanisms will a market maker want to use? We give answers to this question, and further believe that the computational and theoretical tools that we develop have broader interest.\nOur methodological contributions The space of possible market making strategies is quite complex in the multiple good case, and conjecturing the form of an optimal solution is not trivial. To search through the space of mechanisms and develop our theoretical results and additional conjectures on optimal designs, we make use of differentiable economics [17], which employs the tools of modern machine learning to search through the space of all mechanisms to optimize performance. Through differentiable economics, we find conjectured optimal mechanisms that make use of the full richness of the space of possible mechanisms: displaying bundling behavior across both buying and selling, and potentially offering a continuum of possible trades. Differentiable economics has previously been used to find a optimal auctions in a few, stylized auction settings [17, 46]. Here, we utilize differentiable economics, in particular RochetNet [17], in studying and developing the theory for a new kind of problem (optimal market making with multiple goods and adverse selection), applying it from the start to guide our understanding and theoretical development. In doing so, we have found the methods of differentiable economics to be invaluable in guiding our exploration. The techniques we use appear to work quite well, and require only access to samples from the market maker\u2019s distribution of beliefs about traders. For this reason, we belief that future work can also pursue their use as a tool for data-driven design of market makers that can inform deployment.\nOur theoretical contributions We provide a framework for formally proving the optimality of conjectured mechanisms that are generated through the differential economics pipeline. To do this, we treat market makers as strategyproof mechanisms, and show that the market maker design problem is dual to an optimal transport problem, extending the theory of optimal transport duality from [14, 25] to allow for different constraints on the primal and dual, and giving a geometric interpretation of these constraints that allows solving the dual problem.\nIn particular, we use differentiable economics to search for profitable mechanisms across multiple valuation distributions. We find that some of the learned mechanisms make use of mixed bundling; i.e., trading in goods separately at one price, but also offering bundle discounts or taking payments in kind (accepting a sale of one good to discount the purchase of another). Other mechanisms offer a continuum of allocations in certain regions. Based on this, we conjecture that the full space of mechanisms is in fact potentially useful to the market maker.\nFor one of these cases, we apply the duality framework, constructing explicit dual certificates for a particular choice of distribution under a linear model of adverse selection, showing optimality for a family of mechanisms parameterized by the strength of adverse selection. As conjectured, the optimal mechanisms offer a bid-ask spread for each good. However, they also offer bundled trades at better prices than the separate bids and asks. For a specific example in one case, the trader can buy one good for 56 , or sell another for 16 , but simultaneous buying and selling costs only 4\u2212 \u221a 2 6 . As the strength of adverse selection decreases,\nthe prices for all goods and bundles improve nonlinearly. We thus answer our main question about the optimal design of market makers in this multiple good setting in the affirmative: under a reasonable model of adverse selection, it may be optimal for a profitmaximizing market maker to engage in mixed bundling, with profits up to 11.4% greater than separately making a market for each good. Beyond being of theoretical interest, we believe that this positive answer to the question about the richness of market making possibilities in this setting can motivate the use of multiple-good CFMMs in DeFi and perhaps also in prediction markets, as well as providing a motivation for the increased use of combinatorial bundle order types in securities markets."
        },
        {
            "heading": "1.1 Related Work",
            "text": ""
        },
        {
            "heading": "1.1.1 The multiple-good monopolist problem",
            "text": "Adams and Yellen [4] observed that for a monopolist selling more than one good, it may be advantageous to engage in mixed bundling, selling a bundle of multiple goods at a discounted price, while possibly also offering each good separately at an independent price. Surprisingly, this advantage does not require that goods be complements or substitutes; rather, it can happen even if the goods are completely unrelated, for example with a buyer with additive values.\nA long line of work [31, 30, 42] seeks to characterize in what circumstances taking advantage of bundling is optimal. Pavlov [38], Manelli and Vincent [29], and Giannakopoulos and Koutsoupias [21] all give explicit optimal solutions to particular special cases of the multiple-good monopolist problem, and show that these solutions do sometimes involve mixed bundling.\nDaskalakis et al. [13, 14] present a general theory of strong duality, in which the optimal mechanism design problem is shown to be dual to a relaxed optimal transport problem. They show that depending on the particular problem, selling separately, selling only a bundle, mixed bundling, or even offering an infinite continuum of lottery bundles could be optimal. Kleiner and Manelli [26] give an equivalent formulation of the problem in terms of infinite-dimensional linear programming, and Kash and Frongillo [25] allow for more general constraints on allocations."
        },
        {
            "heading": "1.1.2 Prediction markets and automated market makers",
            "text": "There is a rich literature on the use of AMMs to facilitate prediction markets [19, 37, 3, 2]. There are direct connections between truthful mechanisms and proper scoring rules [18, e.g.].\nHowever, the goals of prediction markets are very different than those in the present paper: the purpose of a prediction market is to elicit useful information from traders. Profit is usually not a concern, and the market maker may be happy to tolerate a bounded loss if this helps the market run smoothly. Because the goal is to elicit accurate predictions, these mechanisms are also designed with properties that are almost diametrically opposed to our goals. For example, they should be not merely weakly truthful, but strictly truthful, to uniquely distinguish all types (in the language of scoring rules, they should be strictly proper and not just proper). This necessarily means that there cannot be a \u201cno-trade\u201d region where many types all receive the identical zero allocation; in contrast, we will see that optimal market makers often must do this in our setting. Moreover, most prediction markets consider a single security at once (see [16, 27] for examples of combinatorial markets). We do note that there is other work from this literature that does focus on profit [1, 37, 12]."
        },
        {
            "heading": "1.1.3 Constant-function market makers",
            "text": "Constant-function market makers (CFMM) are a class of AMMs that start with an initial portfolio of assets (one of which may be considered the numeraire) from a liquidity provider (LP). They are willing to exchange any basket of assets for another basket of assets as long as some constant function of the portfolio (referred to as the \u201cinvariant\u201d or \u201ccurve\u201d) is preserved. Angeris et al. [5] describes how to construct a CFMM curve that results in a given payoff for the liquidity provider, as long as that payoff is concave in the price. Milionis et al. [32] give one criterion, loss-versus-rebalancing, for measuring the performance over time of AMMs.\nMilionis et al. [33] consider a flexible model of adverse selection over a single time step and show that optimal CFMM \u201ccurves\u201d take the form of a bid-ask spread. Goyal et al. [22], similar to our work, consider optimizing CFMMs for various performance goals given market maker beliefs about the value of goods. Their main focus is an objective related to liquidity, where they show a correspondence between market maker beliefs and various existing and new CFMM curves. They also consider optimizing for profit and loss-versus-rebalancing. Crucially, they focus on a single-parameter setting, with one token trading against one numeraire."
        },
        {
            "heading": "1.1.4 Characterization of truthful mechanisms",
            "text": "Rochet [41] gives an extremely useful characterization of dominant-strategy incentive compatible (DSIC, or strategyproof) mechanisms. Essentially, every truthful mechanism can be identified with a convex function mapping the participant\u2019s true type to their utility for bidding truthfully. The allocation rule (which uniquely determines the payment rule) for a given type corresponds to the (sub)gradient of this function. Finally, one can interpret the convex conjugate of this function [43] as a summary of the \u201cmenu\u201d mapping possible allocations to prices. Frongillo and Kash [18] extend this general idea to additional mechanism design problems such as truthful elicitation via scoring rules and liquidity provision in prediction markets.\nThere are in fact further similarities between all of the above results, which identify each mechanism with the utility it induces for an honest agent, and connect strategyproofness to convexity. For example, [20] show an equivalence between CFMMs and scoring rules. Angeris et al. [5] characterize CFMMs in terms of a concave \u201cvalue function\u201d which, up to a linear translation, corresponds to the utility function of the mechanism participant. Frongillo and Kash [18], Section 1.2, give an exhaustive survey of related work with similar results."
        },
        {
            "heading": "1.1.5 Automated mechanism design and differentiable economics",
            "text": "The general lack of theoretical progress on the problem of optimal mechanism design has motivated the use of automated mechanism design: the use of computational techniques to search for high-performing mechanisms on specific problem instances [9, 44, 28, 45]. In the typical model of mechanism design, the valuation distribution is common knowledge, and if samples are available from this distribution, it is natural to formulate the mechanism design problem as a machine learning problem; indeed, a number of works have considered the learning-theoretic properties of various classes of mechanisms [8, 7, 6].\nMore recently, Du\u0308tting et al. [17] introduce differentiable economics: the use of rich, flexible function approximators, trained via stochastic gradient descent, for strategyproof auction design. One of their architectures, RegretNet, works for multi-bidder auctions, with strategyproofness constraints approximately enforced via a penalty term. Another architecture, RochetNet, is always strategyproof but only well-defined for single-bidder auctions. This single bidder fits with the present setting, where we seek the optimal design given knowledge of a distribution on the possible types of a single trader who will interact with the market maker, and we make use of the RochetNet approach in the present paper. Separately, Shen et al. [46] consider MenuNet, an architecture which takes a similar approach to RochetNet and is also limited to single-bidder settings, and to which they apply to a broader class of value models beyond additive and unit-demand. Curry et al. [11] present a direct generalization of these two approaches, appealing to affine maximizers to give an architecture that is always strategyproof and well defined for many-bidder auctions (although it may not always be able to represent the optimal mechanism). There are followups improving on the architecture of RegretNet [28, 39, 40, 10] and the Curry et al. [11] approach [15]."
        },
        {
            "heading": "2 Our model",
            "text": "Here we describe our model of optimal automated market-maker design. We first describe our family of objectives, which are a generalization of those of Milionis et al. [33] to multiple goods. We then describe our constraints, that is, the set of mechanisms we are willing to consider. These correspond to either\nstrategyproof and individually rational (defined below) direct-revelation mechanisms with feasible allocation rules, or menus of (lottery) bundles at associated prices.1 An important detail of the market setting is that we also need to handle adverse selection, reflecting that the trader may be better informed than the market maker."
        },
        {
            "heading": "2.1 Mechanism Design Objectives",
            "text": "We assume that the market maker has some initial belief vector c \u2208 X = [0, b]d, for some maximum value b > 0, on the value for each of d \u2265 1 goods. A trader has their own value vector x \u2208 X = [0, b]d, and seeks to trade with the market maker. The trader\u2019s value is, in mechanism design terms, their type, drawn from some distribution with probability density function, f(x).\nWe assume that the market maker is willing to buy or sell up to one unit of each good. After a trade, the market maker receives a profit equal to their gain or loss of money plus the value of goods bought or sold, also considering how their beliefs may be affected by the trade. In particular, there is the possibility of adverse selection: the market maker may be incorrect about the value c, and the trader may be better informed. To capture this possibility, following Milionis et al. [32], we adopt an update function, \u03c0(c, x) : X \u00d7 X \u2192 X . When the market maker observes a trader with value x, they update their own belief about the value of the goods from c to \u03c0(c, x) (note that, as in Milionis et al. [32], we require that \u03c0(c, c) = c). The resulting profit is the revenue minus the loss due to the sale of goods (respectively, payment to trader and profit from gain of goods).\nSuppose that after a trade takes place, the trader\u2019s allocation of goods is a \u2208 [\u22121, 1]d and their payment is p \u2208 R. Note that the trader may gain or lose a fractional amount of each good, and that payment p may be negative in the case that they receive a payment from the market maker. Then the trader\u2019s utility is their value of the allocation (perhaps negative, in the case of a sale) minus their payment: a \u00b7 x\u2212 p. The market maker\u2019s profit is the revenue from the sale (perhaps negative if they pay the trader), minus the loss or gain from the transfer of goods, this measured at their updated belief about the value of the goods: p\u2212a \u00b7\u03c0(c, x). In other words, given beliefs about the value of goods, the market maker and trader each have additive and quasilinear utility.\nWe highlight three important special cases, each with a different definition of belief update, \u03c0:\n1. When \u03c0(c, x) = c, this is the \u201cnoise trading\u201d case, where the mechanism designer believes that the bidders are simply uninformed, with no adverse selection.\n2. In the above case, if we further have that c = 0, this recovers the \u201cselling-only\u201d case studied in the auction setting of Daskalakis et al. [14].\n3. If \u03c0(c, x) = \u03bbc + (1 \u2212 \u03bb)x, for some 0 \u2264 \u03bb \u2264 1, this is the \u201clinear interpolation\u201d case from Milionis et al. [33]. This is a simple model of adverse selection."
        },
        {
            "heading": "2.2 Class of mechanisms",
            "text": "Following Rochet [41], we can consider three equivalent perspectives on our mechanisms. The first perspective is that of a strategyproof, direct-revelation mechanism, in which the trader directly reports their value vector x, and allocations and payments are determined according to an allocation rule, a(x) : X \u2192 [\u22121, 1]d and payment rule, p(x) : X \u2192 R. The bidder then has a utility, which is a function of their valuation: u(x) = a(x) \u00b7 x \u2212 p(x). Strategyproofness means that there should be no incentive for the bidder to report anything other than their true value: that is, \u2200x, x\u2032 : a(x\u2032) \u00b7 x\u2212 p(x\u2032) \u2264 u(x).\nThe second perspective is that a mechanism corresponds to offering a menu, specifying a price for any possible allocation a (with infinite, positive prices for infeasible allocations), where the trader chooses freely among the menu elements. One can denote this menu u\u2217(a), because it is the Fenchel conjugate [43] of the utility function u(x) enjoyed by a bidder who chooses their best menu element, or who participates truthfully\n1There are also connections to constant-function market makers, which we discuss in Appendix A.\nin the direct revelation mechanism. A third perspective is that given a utility function u(x), the gradients of the utility, \u2207u(x), define the direct revelation allocation rule a(x), with payments p(x) = \u2207u(x) \u00b7 x\u2212 u(x). Rochet showed that all of these perspectives are in some sense equivalent.\nWe find it especially useful to focus on the third perspective, and to design mechanisms through the design of the trader\u2019s utility function u(x), because different mechanism design desiderata can be easily connected to constraints on the agent\u2019s utility function. The first three desiderata are standard in mechanism design and the fourth is special to this domain.\n\u2022 Strategyproofness can be identified with convexity of the utility function [41].\n\u2022 Individual rationality means that if traders participate truthfully, they are guaranteed nonnegative utility, so can always safely participate in the mechanism; this can be identified with nonnegativity of the utility function: \u2200x, u(x) \u2265 0. .\n\u2022 Feasibility of allocations involves ensuring that the gradients are bounded. In particular, we would like that \u2225a(x)\u2225\u221e = \u2225\u2207u(x)\u2225\u221e \u2264 1, or equivalently that u(x) is 1-Lipschitz in the \u21131 norm (dual to the \u2113\u221e norm).\n\u2022 In addition, there is always a no-trade region in the present setting, that includes at least the point where the trader and market maker agree on the price (and thus do not want to trade). Under our model, this happens at the initial price belief c. Thus we also require u(c) = 0, which by nonnegativity means utility attains its minimum at c.\nBased on these considerations, we define the following convex set of feasible mechanisms:\nU = {u : X \u2192 R+ | u convex , \u2225u(x)\u2225\u221e \u2264 1, u(c) = 0}.\nWe can also rewrite the market-maker\u2019s expected profit in terms of u(x). Since a(x) = \u2207u(x), profit is \u2207u(x) \u00b7 x \u2212 u(x) \u2212 \u2207u(x) \u00b7 \u03c0(c, x) = \u2207u(x) \u00b7 (x \u2212 \u03c0(c, x)) \u2212 u(x). Thus, the market maker\u2019s objective of expected profit under belief updating, for traders distributed according to x \u223c f(x), is:\u222b\nX (\u2207u(x) \u00b7 (x\u2212 \u03c0(c, x))\u2212 u(x)) f(x) dx. (1)"
        },
        {
            "heading": "3 Establishing Duality",
            "text": "To find the profit-maximizing mechanism, we now face an optimization problem over the space of feasible utility functions:\nsup u\u2208U \u222b X (\u2207u(x) \u00b7 (x\u2212 \u03c0(c, x))\u2212 u(x)) f(x) dx.\nOur goal in this section is to establish strong duality: we will provide a dual minimization problem, and show that the primal and dual objectives coincide at the optimal point. This will allow us to check optimality of a proposed mechanism by showing a matching dual solution."
        },
        {
            "heading": "3.1 Linearizing the objective",
            "text": "Similar to other work, [30, 14, 25, 42], we can linearize our problem by doing integration by parts, establishing the following lemma. Lemma 3.1. \u222b (\u2207u(x) \u00b7 (x\u2212 \u03c0(c, x))\u2212 u(x)) f(x) dx = \u222b u d\u00b5+ \u2212 \u222b u d\u00b5\u2212, (2)\nwhere \u00b5 = \u00b5+ \u2212 \u00b5\u2212 is a signed measure which integrates to 0, defined as\n\u00b5(A) = \u222b \u2202X IA(x)f(x)(x\u2212 \u03c0(c, x)) \u00b7 n\u0302 dx\n\u2212 \u222b X IA(x)(\u2207f(x) \u00b7 (x\u2212 \u03c0(c, x)) + (n+ 1\u2212 div \u03c0(c, x))f(x)) dx+ IA(c).\n(3)\nThe calculation, which is mainly an application of integration by parts, is in Appendix B.\nInterpretation of \u00b5 There are three terms in \u00b5(A). The first term involves positive mass distributed along the boundary of the type space. The second term involves a density of negative mass distributed across the interior (and possibly also touching the boundaries). The third term is an indicator function denoting one positive unit of mass at c. Because we require that u(c) = 0, we can add this term without altering the result, which is useful as it serves to balance positive and negative mass so that we have a true optimal transport problem between \u00b5+ and \u00b5\u2212. We will see in Sections 4 and 5 below that the positive mass IA(c) associated with this third term will be spread outward to exactly cover the negative mass in the \u201cno-trade\u201d regions that show up in the center of the type space."
        },
        {
            "heading": "3.2 Statement of duality",
            "text": "Following the above discussion, the mechanism design problem is to design a profit-maximizing, feasible utility function to the trader, u(x). We define a matching dual problem, and establish strong duality.\nTheorem 3.2 (Strong duality, following [47, 14, 25]). We have\nsup u\u2208U\n\u222b u d\u00b5+ \u2212 \u222b u d\u00b5\u2212 = inf\n\u03b3:\u03b31\u2ab0\u00b5+,\u03b32\u2aaf\u00b5\u2212\n\u222b \u2225x\u2212 y\u22251, d\u03b3(x, y), (4)\nwhere \u2ab0 is an integral stochastic order [34], representing the relation \u03b1 \u2ab0 \u03b2 \u21d0\u21d2 \u2200f \u2208 U : \u222b f d\u03b1 \u2265 \u222b f d\u03b2.\nThe proof is in Section 3.4. While we focus on eq. (1) as the objective in this paper, the strong duality result also applies to any other objective that can be linearized into an integral of the trader\u2019s utility function, u, against some balanced \u00b5+ and \u00b5\u2212."
        },
        {
            "heading": "3.3 Interpretation of the dual constraints",
            "text": "The relation which we denote here as \u2ab0 has a geometric interpretation. Given some \u03b1 \u2ab0 \u03b2, any modification to transform \u03b1 into \u03b1\u2032 that is guaranteed to weakly increase the value of \u222b f d\u03b1 will ensure that \u03b1\u2032 \u2ab0 \u03b2 as well. In our case, f is required to be convex, so any mean-preserving spread (as in the sweeping/balayage discussed in Rochet and Chone\u0301 [42]) of positive mass will weakly increase the value of the integral. Additionally, we require that f attain its minimum at c. This along with convexity means that moving positive mass in any direction coordinate-wise away from c weakly increases the value of the integral. (For negative mass, we have mean-preserving contractions and coordinate-wise moves towards c respectively.)\nTherefore, either mean-preserving spreads, or moving mass in any direction coordinate-wise away from c, can be used to improve the dual objective without paying a transport cost. In the special case when c is fixed to 0, we recover the selling-only, multiple good monopolist problem. Mean-preserving spreads are still allowed, and moving mass away from c = 0 amounts to moving mass upwards/rightwards, so \u2ab0 becomes precisely the convex dominance condition defined in [14].\nAlso, we have \u03b1 \u2ab0 \u03b1, and so the \u2ab0 relation represents a relaxation of the typical equality constraints in an optimal transport problem. This relaxation of the dual is needed to maintain zero duality gap, because the primal mechanism design problem is tightened by additional constraints on the functions as a result of enforcing mechanism design desiderata such as strategyproofness.\nIn addition, scaling f by a constant does not change anything. As such, the same \u2ab0 is defined if we instead consider U\u25e6, the cone generated by U . u \u2208 U\u25e6 are still convex and attain their minimum of 0 at c, but are no longer necessarily 1-Lipschitz."
        },
        {
            "heading": "3.4 Proving duality",
            "text": "Daskalakis et al. [14] generalize the standard proof of optimal transport duality from Villani [47]; Kash and Frongillo [25] in turn builds further on each of these theories.2 We follow in this tradition to prove Theorem 3.2, for completeness reproducing much of the same structure of the proof. The key differences in our work are that we consider a different set of feasible functions U , and therefore a different definition of the relation \u2ab0, which requires some technical modifications to make the proof go through. Additionally, actually finding dual solutions requires a geometric interpretation of the relation \u2ab0, which is different than the integral stochastic orders in prior work."
        },
        {
            "heading": "3.4.1 Weak Duality",
            "text": "It is easy to establish weak duality, in the same way as [14, 25]:\u222b X u d\u00b5+ \u2212 \u222b X u d\u00b5\u2212 \u2264 \u222b X u d(\u03b31 \u2212 \u03b32) by definition of \u2ab0\n= \u222b X\u00d7X (u(x)\u2212 u(y)) d\u03b3(x, y)\n\u2264 \u222b X\u00d7X \u2225x\u2212 y\u2225 d\u03b3(x, y) by 1-Lipschitz property of u.\nWeak duality already suffices for using the framework to prove optimality."
        },
        {
            "heading": "3.4.2 Strong Duality",
            "text": "We start by showing that the transport problem is dual to a an optimization problem over a pair of functions.\nLemma 3.3.\ninf \u03b3:\u03b31\u2ab0\u00b5+,\u03b32\u2aaf\u00b5\u2212\n\u222b \u2225x\u2212 y\u22251 d\u03b3(x, y) = sup\n\u03d5(x)\u2212\u03c8(y)\u2264\u2225x\u2212y\u22251,\u03d5,\u03c8\u2208U\u25e6\n\u222b \u03d5d\u00b5+ \u2212 \u222b \u03c8 d\u00b5\u2212.\nThe proof, similar to those in previous work, is deferred to Appendix B.\nOptimal Solution Involves a Single Function in U The next step is to show that some optimal, feasible pair \u03d5, \u03c8 which lie in the cone U\u25e6 can be replaced with a weakly better pair of two identical functions \u03d5, \u03d5 in U\u2014in other words, a single feasible mechanism. The technique here is similar but not identical to prior work, due to the need to preserve the u(c) = 0 property.\nLemma 3.4.\nsup \u03d5(x)\u2212\u03c8(y)\u2264\u2225x\u2212y\u22251,\u03d5,\u03c8\u2208U\u25e6\n\u222b \u03d5d\u00b5+ \u2212 \u222b \u03c8 d\u00b5\u2212 = sup\nu\u2208U\n\u222b u d\u00b5+ \u2212 \u222b u d\u00b5\u2212.\nProof. First, let \u03d5(x) = infy \u03c8(y) + \u2225x\u2212 y\u22251. \u03d5 is still a feasible function:\n\u2022 it maintains convexity because \u03c8(y)+\u2225x\u2212y\u22251, a sum of convex functions, is convex in x and y [43, 26].\n\u2022 \u03d5(c) = 0 because \u03c8(c) = 0 and the \u2225\u00b7\u22251 term is minimized to 0 by setting y = c also.\n\u2022 Moreover, for any y that is the minimizer for \u03d5(x), and for all x\u2032, \u03d5(x\u2032) \u2212 \u03d5(x) \u2264 \u03c8(y) + \u2225y \u2212 x\u2032\u22251 \u2212 \u03c8(y)\u2212 \u2225y \u2212 x\u22251 \u2264 \u2225x\u2032 \u2212 x\u2225, so \u03d5 is also 1-Lipschitz in the \u21131 norm.\n2Kleiner and Manelli [26] give an alternate proof in terms of infinite-dimensional linear programming. We focus on the optimal transport interpretation because thinking geometrically in terms of transport plans is useful for actually finding dual solutions. But the linear programming interpretation may be helpful for some readers to keep in mind.\n\u03d5 is thus feasible, lying not just in U\u25e6 but actually in U , and, because \u03d5(x) \u2264 \u03c8(y) + \u2225x\u2212 y\u22251, replacing \u03d5 by \u03d5 weakly improves the objective (by increasing the \u00b5+ term). So we now have a new optimal pair \u03d5, \u03c8, with \u03d5 \u2208 U and \u03c8 \u2208 U\u25e6.\nWe can now define \u03c8(y) = supx \u03d5(x)\u2212\u2225x\u2212y\u22251. \u03c8(y) \u2265 \u03d5(x)\u2212\u2225x\u2212y\u22251, so feasibility is maintained and the objective is weakly improved (by decreasing the \u00b5\u2212 term). And in fact, \u03c8 = \u03d5. First, \u03c8(y) \u2265 \u03d5(y)\u2212\u2225y\u2212 y\u2225 due to the supremum. Then,\n\u03c8(y) = sup x \u03d5(x)\u2212 \u2225x\u2212 y\u2225\n= \u03d5(y) + sup x\n( \u03d5(x)\u2212 \u2225x\u2212 y\u2225 ) \u2212 \u03d5(y)\n= \u03d5(y) + sup x\n( \u03d5(x)\u2212 \u03d5(y)\u2212 \u2225x\u2212 y\u2225 ) \u2264 \u03d5(y),\nwhere the last inequality follows because \u03d5 is 1-Lipschitz, so the objective of the supremum is always nonpositive. Thus \u03c8 = \u03d5, and we have a feasible pair \u03d5, \u03d5, with \u03d5 \u2208 U , which has weakly improved the objective.\nCombining the above steps, we have\nProof of Theorem 3.2.\ninf \u03b3:\u03b31\u2ab0\u00b5+,\u03b32\u2aaf\u00b5\u2212\n\u222b \u2225x\u2212 y\u22251 d\u03b3(x, y) = sup\n\u03d5(x)\u2212\u03c8(y)\u2264\u2225x\u2212y\u22251,\u03d5,\u03c8\u2208U\u25e6\n\u222b \u03d5d\u00b5+ \u2212 \u222b \u03c8 d\u00b5\u2212 by Lemma 3.3\n= sup u\u2208U\n\u222b u d\u00b5+ \u2212 \u222b u d\u00b5\u2212 by Lemma 3.4."
        },
        {
            "heading": "4 Warmup: a 1D example",
            "text": "Milionis et al. [33] give optimal mechanisms for the 1-dimensional case, that is, for the case of a market marker trading a single kind of good for a numeraire. They show that optimal mechanisms in this case take\nthe simple form of a bid-ask spread: an offer to sell one unit of a good at some price, and buy at a higher price. By analogy to a Myerson auction [35], they set these prices to maximize a \u201cvirtual valuation\u201d which depends on the type distribution.\nTheir problem setting is the one-dimensional case of the framework we study here, so we can view their solutions as convex utility functions lying in U . As a test and demonstration of our framework, we can construct dual solutions whose transport cost matches the expected profit, establishing optimality in an alternate way."
        },
        {
            "heading": "4.1 Constructing the transformed measure",
            "text": "Consider the case where the mechanism designer updates their beliefs about prices by linearly interpolating, so that \u03c0(c, x) = \u03bbc+ (1\u2212 \u03bb)x, and distributions are uniform.\nWe can consider the transformed measure, which places mass as follows:\n\u2022 \u2212(n+ 1) = \u22122 uniformly.\n\u2022 +(1\u2212 \u03bb) uniformly from the f(x) div \u03c0 = \u03c0\u2032 term.\n\u2022 The above cancels out to \u2212(\u03bb+ 1) uniformly.\n\u2022 +\u03bbc mass at 0 (left normal term).\n\u2022 +(\u03bb\u2212 \u03bbc) mass at 1 (right normal term).\n\u2022 +1 mass at c.\nThe total mass of \u00b5+ and \u00b5\u2212 are each \u03bb + 1, so \u00b5 integrates to 0. For a visualization of this measure, see Fig. 1."
        },
        {
            "heading": "4.2 Conjecture of optimal mechanism",
            "text": "Following Milionis et al. [33], the upper and lower virtual value functions are \u03bb(x\u2212c)\u2212(1\u2212x) and \u03bb(c\u2212x)\u2212x, so selling and buying at (1 + \u03bbc)/(\u03bb + 1) and (\u03bb/(\u03bb + 1))c respectively is optimal. The expected profit of this mechanism, calculated directly, is (2(c\u22121)c+1)\u03bb 2\n2(\u03bb+1) ."
        },
        {
            "heading": "4.3 Constructing the dual certificate",
            "text": "\u00b5\u2212 thus has a CDF of (1 + \u03bb)x, i.e., it is uniform. Again, to construct \u03b31, we can perform preprocessing on \u00b5+ to spread the point mass at c out to a uniform mass on the interval [ c\u03bb1+\u03bb , 1+c\u03bb 1+\u03bb ], resulting in CDF\nC\u03b31 =  0 x < 0 c\u03bb 0 \u2264 x < c\u03bb\u03bb+1 c\u03bb+ x\u2212 c\u03bb\u03bb+1 c\u03bb+1 \u03bb+1 \u2212 c\u03bb \u03bb+1 c\u03bb \u03bb+1 \u2264 x < c\u03bb+1 \u03bb+1\nc\u03bb+ 1 c\u03bb+1\u03bb+1 \u2264 x < 1 \u03bb+ 1 1 \u2264 x\n.\nLetting \u03b32 = \u00b5 \u2212, we have a transport cost of \u222b\u221e \u2212\u221e|C\u03b31 \u2212 C\u03b32 |= (2(c\u22121)c+1)\u03bb2 2(\u03bb+1) , which matches the expected profit, proving the proposed mechanism optimal. Observe that in the above case, the point mass IA(c) is spread out via preprocessing at no transport cost. The endpoints of the area to which it is spread precisely correspond to the no-trade region which is inside the bid and ask prices."
        },
        {
            "heading": "5 Optimal mechanisms in multi-parameter settings",
            "text": "Having warmed up on a 1D case where the optimal solution was already known, we proceed to apply the dual transport framework in earnest. This is not so easy to do. We have established that for any optimal mechanism, its expected profit must be matched by the transport cost of the dual transport problem. However, this gives us little insight into what an optimal mechanism might look like for a given problem instance; in particular, any combination of allocations and prices could be optimal.\nThis is where we turn to differentiable economics to search for profitable mechanisms. Without any prior knowledge about the structure of the optimal mechanism, but only sample access to the valuation distribution, we show that we can use these techniques from differentiable economics to find high-performing mechanisms. We treat the results coming from this computational pipeline as conjectures for the form of the optimal mechanism. Although they are necessarily only numerical approximations, they contain a lot of useful information that we can use, along with knowledge about the dual program, to come up with plausible analytic expressions for the menus and prices. Then, we construct a transport plan for the dual and show that the primal and dual values match.\nThis general approach has been used before to find a few new optimal mechanisms in simple, single bidder auction problems [46, 17]. Here, though, we apply differentiable economics as a tool throughout our work, adopting it to develop intuitions and theoretical directions for a new problem from the very start of our work (in fact, simple experiments with differentiable economics were able to yield helpful clues before we began proving mechanisms to be optimal, in particular providing hints about the geometric interpretation of the relation \u2ab0)."
        },
        {
            "heading": "5.1 Differentiable economics: Architecture and training methods",
            "text": "We encode our convex utility function (in the style of RochetNet from Du\u0308tting et al. [17]) as a maximization over a large number of hyperplanes, each corresponding to an allocation ai (represented by a parameter \u03b1 \u2208 R which is scaled via a sigmoid transformation to encode a feasible allocation in [\u22121, 1])and payment pi:\nu(x) = max i ai \u00b7 x\u2212 pi; where ai = 2\u03c3(\u03b1)\u2212 1, \u03b1i \u2208 R, pi \u2208 R.\nMotivated by empirical results [17, 11] as well as theory [24], we overparameterize our networks with 210 menu items, even though few menu items are typically used. We train to directly optimize the profit objective, using softmax with a temperature of 100 as a differentiable surrogate for the max operation, and use Adam with the typical learning rate of 10\u22123 and large batch sizes of 216 or 215. Each job was scheduled on a compute cluster, running with a single A100 GPU."
        },
        {
            "heading": "5.2 A new family of optimal mechanisms",
            "text": "We consider the case of two kinds of goods, with values uniformly distributed on [0, 1], a market maker with initial valuation of c = ( 12 , 1 2 ), and a linear update model, \u03c0(c, x) = \u03bbc+ (1\u2212 \u03bb)x. We present a new family of optimal mechanisms for this setting. We train models for a range of values of \u03bb, some of which are shown in Figure 2. These mechanisms have some shared structure. There is symmetry when reflecting across y = x, y = 12 , and x = 1 2 . They only make deterministic allocations (i.e., either selling -1, 0, or 1 units of each good), and within deterministic allocations, they offer every possible allocation for some price. There is a no-trade region centered at the initial price c = ( 12 , 1 2 ), and as we would expect, this increases in size (i.e., the prices for the trader get worse) as adverse selection becomes stronger."
        },
        {
            "heading": "5.2.1 Constructing the transformed measure",
            "text": "The transformed measure (Eq. 1) for this case is:\n\u2022 \u2212(2\u03bb+ 1) mass distributed uniformly.\n\u2022 A +1 point mass at c.\n\u2022 Mass of +(1\u2212 c1)\u03bb on the right boundary, +(1\u2212 c2)\u03bb on the top boundary, +c1\u03bb on the left boundary, and +c2\u03bb on the bottom boundary.\nThe positive and negative masses each have magnitude 2\u03bb + 1. The measure for the case where c = ( 12 , 1 2 ) is visualized in Fig. 1."
        },
        {
            "heading": "5.2.2 Conjecture for optimal mechanism",
            "text": "Consider the case where c = (12 , 1 2 ). We first train a model to maximize profit; the allocation rules for the mechanism after training are shown in the top row of Fig. 2. We use the learned model, as well as our knowledge of the problem setting, to conjecture the structure of the optimal mechanism.\nThe mechanism should be deterministic, and offer eight menu items in addition to the no-trade option (every combination of buying or selling a full unit of the items, or neither). There should be a large octagonal no-trade region in the center. Also, because valuations are symmetric, the mechanism should be symmetric, despite minor asymmetries in the learned solution which can be ascribed to numerical imprecision."
        },
        {
            "heading": "5.2.3 Constructing a dual certificate",
            "text": "We now show how to construct a dual certificate and explicitly calculate its transport cost. For clarity, we show here the \u201cnoise trading\u201d case where c = ( 12 , 1 2 ) and \u03bb = 1. We also develop the optimal mechanism design parameterized by \u03bb when c = ( 12 , 1 2 ). The calculations for this are similar but uglier, and relegated to Appendix D.\nPartitioning the type space The solution of the optimal transport dual problem can be illustrated using an optimal partition of the unit square so that the minimal total transport cost is the sum of the minimal transport cost for each of the partitioned regions. Fig. 3, left, shows the optimal partition in this case. In the optimal transport solution, the +1 point mass at c = ( 12 , 1 2 ), according to our definition of \u2ab0, can be spread outward (away from c) to uniformly cover the octagon-shaped region at the center, at zero cost. In addition to the octagon, there are four equivalent rectangles and four equivalent pentagons. Each of the rectangles and pentagons contains a part of the four outer edges of the unit square, and the positive mass on that part of the edge gets distributed uniformly over the rectangle or pentagon to cancel out the negative mass. The total transport cost is therefore C1 = 4C (R) 1 +4C (P ) 1 , where C (R) 1 is the transport cost of one rectangle, C (P ) 1 is the transport cost of one pentagon, and the subscript 1 represents that these quantities are for the case of \u03bb = 1.\nTransport plan We parameterize the partition in terms of lengths a1 and b1. In terms of these quantities, the transport cost for each rectangle is C (R) 1 = \u222b b1 0 ( 1\u22122a1 2 ) 1 b1 xdx = (1\u22122a1)b14 , while the total transport cost for the pentagon is C (P ) 1 = (5a1+b1)b1 6 (see the detailed calculations in Appendix C). The actual transport plans are visualized in Fig. 3, right and involve moving the positive mass along the edges uniformly inward until the boundary of the no-trade region is reached.\nSolving for a1 and b1 The structure of the transport plan constrains the values of a1 and b1. There is a positive mass on edge JK of length 1\u2212 2a1, and as the mass density per unit length of the edge is 12 , the mass is 1\u22122a12 . This mass is moved upward to be distributed uniformly over the rectangle HIJK and should perfectly cancel out the negative mass in the rectangle. The density of the initial negative mass over the rectangle HIJK is \u22123(1\u22122a1)b1, and because it should perfectly cancel out the positive mass 1\u22122a12 , we have\n1\u2212 2a1 2 \u2212 3(1\u2212 2a1)b1 = 0. (5)\nThe positive mass on edge BC is b12 , and the negative mass on triangle EFG is \u2212 3(a1\u2212b1)2\n2 . As these two masses should perfectly cancel out each other, we have\nb1 2 \u2212 3(a1 \u2212 b1) 2 2 = 0. (6)\nSimilarly, the positive mass on edge CD is a1\u2212b12 , and the negative mass on rectangle CDEG is \u22123(a1\u2212b1)b1. As these two masses should perfectly cancel out, we have\na1 \u2212 b1 2 \u2212 3(a1 \u2212 b1)b1 = 0. (7)\nCombining equations Eq. 5, Eq. 6, and Eq. 7, the values of a1 and b1 can be solved: a1 = 1+\n\u221a 2 6 , b1 = 1 6 .\nComputing the menu The boundary between two regions is the point where a trader is indifferent between the two menu items. At any trader type on a boundary, we can easily calculate the welfare of the two neighboring allocations, and infer the price that would make the trader indifferent. The resulting menu is given in Table 1 and visualized in Fig. 4. The total transport cost for this pure noise trading case is\nC1 = 4C (R) 1 + 4C (P ) 1 = 4 \u00b7 (1\u2212 2a1)b1 4 + 4 \u00b7 (5a1 + b1)b1 6 = 1 27\n( 6 + \u221a 2 ) \u2248 0.274601, (8)\nwhich exactly matches the expected profit of the optimal menu, so our solutions are optimal."
        },
        {
            "heading": "5.2.4 Adverse selection in two dimensions",
            "text": "As mentioned, the above calculations are for the special case where \u03bb = 1, i.e. no adverse selection. We also consider the more interesting case of the linear belief updating objective described above, for an initial valuation of c = ( 12 , 1 2 ). The calculations are similar, though more involved, and are deferred to Appendix D. The optimal mechanism in this case, as a function of the belief-updating parameter, \u03bb, is given in Table 2."
        },
        {
            "heading": "5.2.5 Discussion of economic properties of optimal mechanisms",
            "text": "We now qualitatively discuss the mechanism shown in Table 2. There is a no-trade octagon in the center. Even with no adverse selection, this octagon is present, but as adverse selection grows stronger, it grows larger until eventually no trade is possible. The mechanism engages in mixed bundling: that is, for any combination of buying and selling both goods, there is an offer, as well as distinctly priced offers for buying or selling any individual good. In particular, bundles can involve buying one good and selling another, which we can interpret as taking payment \u201cin kind.\u201d The intuition for why this is useful is as follows: considering only the single-good offers in Table 2, the bid-ask spread is wider than in the optimal mechanism discussed in Section 4, so when single-good trades take place, they are more profitable, but a larger proportion of traders refuse to participate. However, some of these traders are then won back by offering a discount for the multiple good bundles, so profit is higher on the whole.\nWe also highlight that the profit gap between this optimal mechanism, and the mechanism consisting of\napplying the prices from Section 4 separately to each item, is \u03bb3((2\n\u221a 2\u22123)\u03bb+2 \u221a 2)\n6(\u03bb+1)(2\u03bb+1)2 . For \u03bb = 1 this gives about\na 10% increase in profit; for \u03bb = \u221a 2 3 the increase is highest at 11.4% \u2013 a fairly substantial improvement in profit."
        },
        {
            "heading": "5.3 Further Conjectures via Differentiable Economics",
            "text": "We have presented a family of optimal market maker mechanisms for independent, uniformly distributed items, parameterized by the strength of adverse selection. These mechanisms make use of mixed bundling behavior and we are able to construct dual certificates establishing optimality.\nTo showcase the flexibility of differentiable economics, we also train models on a much wider range of valuation distributions. The resulting mechanisms display an interesting range of behavior and we conjecture they are optimal.\nAsymmetric noise trading case The above examples all considered the setting where the initial belief of the market maker is centered at ( 12 , 1 2 ), resulting in a symmetric mechanism. We also consider the case where the initial belief is centered at (13 , 1 3 ) (again for the case where the type distribution is uniform). The result of training a mechanism is shown in Figure 5. Based on this solution, and our knowledge of the dual problem as well as knowledge of the points where bidders must be indifferent between two items, we conjecture (calculations in Appendix E) an analytic form for this mechanism, whose menu is shown in Table 3.Here, we observe qualitatively different market maker behavior: note that the items are bought separately or together (i.e. mixed bundling when the mechanism buys), or bundled with the sale of the other item, but not sold separately (i.e., if the trader only wants to purchase, the only choice is the grand bundle).\nA three dimensional mechanism So far we have focused on two-good settings, in which optimal mechanisms already display interesting behavior. Our problem setting is well-defined for any number of goods and we also train a three-good mechanism, as visualized in Figure 6. Two dimensional cross-sectional slices for much of the type space have the same structure as the optimal mechanisms in Section 5.2, although towards the boundaries of the type space the structure changes. The result has extremely interesting and complex structure\u2014a no-trade truncated octahedron (a 14-face polyhedron) in the center, and bundling of all combinations of three goods (buying and selling), along with separate offers for individual goods, but no bundles of two goods.\nBeta distribution: infinite menu size In the multiple-good monopolist problem, it is well-known that optimal mechanisms under a beta distribution may show infinite menu size [14]; in other words, the convex utility function may not be piecewise linear. We train RochetNet under the no-adverse-selection model with c = ( 12 , 1 2 ), on both Beta(2,1) and Beta(2,2) distributions. Shown in Figure 7 and Figure 8, the resulting allocation rules approximate a continuously varying allocation. For the asymmetric distribution, the mixture only takes place for types that have relatively high valuations in one of the goods.\nTruncated normal distribution: an interestingly boring mechanism We also consider a normal distribution centered and truncated to fit within the type space. Here, the learned mechanism, shown in Figure 9, is interesting because unlike the other mechanisms we have presented, it is relatively simple. It is essentially a \u201cgrand bundling\u201d strategy, making an all-or-nothing offer of the bundle of all goods for some fixed price, albeit with four grand bundles, one for each combination of buying and selling."
        },
        {
            "heading": "6 Future Generalizations and Extensions",
            "text": "Here we detail some immediate directions for the generalization of our approach, as well as possible future applications of our techniques.\nGeneral constraints on allocations Kash and Frongillo [25] show how to design optimal auctions with fairly arbitrary constraints on the allocation set, such as requiring deterministic allocations, enforcing minimum quantities of goods to be sold, and many others. Our computational tools can support such constraints,\nand an extension of the strong duality results would likely be relatively straightforward. In particular, if offers must take place in discrete \u201clots,\u201d such an approach could be useful.\nOther mechanism design objectives We focus on a particular adverse selection model. It is relatively general and plausible: one can drop in new update rules \u03c0 with few restrictions [33]. But it is not the only reasonable model of adverse selection, and profit under adverse selection is not the only goal for AMM design. Our duality results all still hold for any other objective, as long as it can be linearized; i.e., converted into an integral against a signed measure \u00b5. The computational techniques we use also work without modification in this case, so the theoretical and practical machinery here should directly work for many other mechanism design goals.\nTrading over time and CFMMs As discussed in Appendix A, there is a formal identification between CFMMs and the mechanisms we study, so that any of these mechanisms could be deployed as a CFMM that accepts multiple trades over time. However, after the first trade, the mechanism would no longer be optimal, and re-optimizing after each trade would result in a mechanism that might be vulnerable to roundtrip arbitrage. Optimizing a fixed CFMM under a dynamic model, or optimizing within some space of time-varying CFMMs which still guarantee no arbitrage, is a compelling direction for future work."
        },
        {
            "heading": "7 Conclusion",
            "text": "We analyze market-making across multiple goods in the face of adverse selection. In the settings we study, the market maker has the capacity to buy and sell different bundles at different prices, as well as to accept sales of goods \u201cin kind\u201d in lieu of money. We show that the problem of maximizing profit under adverse selection is dual to an optimal transport problem. Using our framework, we produce dual certificates for known single-good mechanisms and then show how to use differentiable economics to search through the space of mechanisms in settings with multiple goods, in order to generate conjectures for optimal mechanisms. Based on some of these conjectures, we derive optimal mechanisms and dual certificates.\nFrom an economics perspective, our results establish that in some cases, the optimal mechanism for market makers who work across multiple goods must involve making use of their capacity to bundle and to accept goods \u201cin kind\u201d, resulting in significant improvements in profit. Further conjectured optimal mechanisms in a range of other cases which show a variety of additional complex behaviors including offers of a continuous spectrum of allocations. This is by contrast with the single-good case, where a much simpler bid-ask spread is optimal. It is common in practice to restrict market makers to these simple mechanisms, even when there are multiple goods; our model and results suggest this imposes a cost on them.\nFrom a methodological perspective, we provide theoretical results for another area in the relatively underexplored field of multi-parameter mechanism design, and we show how differentiable economics can be used to guide theory in otherwise very challenging settings. We also hope that these techniques can lead to the design of better market-making mechanisms which will actually be deployed."
        },
        {
            "heading": "A Connection to constant-function market makers",
            "text": "Angeris et al. [5] defines constant-function market makers in terms of a concave portfolio value function and a conjugate trading function. The portfolio value function V (x) is the value that the market maker expects to retain in their portfolio after an arbitrageur, who knows the correct price vector x, engages in a trade. The trading function \u03a8V (R) remains constant for any portfolio that could be the result of a feasible trade; \u03a8V (R) = \u2212 supx(\u2212xTR\u2212 (\u2212V )(x)) = \u2212(\u2212V )\u2217(\u2212R). Angeris et al. [5] require that V (x) is 1-homogeneous; rather than treating payments separately, one good is treated as the numeraire with fixed value normalized to 1. Because V (x) is 1-homogeneous, \u03a8V (R) = \u2212(\u2212V )\u2217(\u2212R) represents the negative indicator function for a convex set of feasible reserves [43].\nThus there is a close connection between the portfolio value and trading functions, and our formulation of a trader utility u(x) and a menu u\u2217(a). For some initial reserves r0, u(x) = x\nT r0\u2212V (x) (there is some surplus which, after a trade, will be divided between the market maker and trader). When u is 1-homogeneous and one good is chosen to be the numeraire, u\u2217(a) will be either 0 or \u221e (denoting whether a trade is possible or not). In our case, we instead allow the output u\u2217(a) to denote a price for trade a, reducing the dimensionality of the valuation vector by 1.\nSeparately and similarly, Frongillo et al. [20] shows a connection between CFMMs and scoring rules for prediction markets."
        },
        {
            "heading": "B Proofs of duality lemmas",
            "text": "First, we go from an expression for expected profit which involves \u2207u(x) to one that only involves u, proving Lemma 3.1. The calculation mainly involves repeated application of integration by parts, which we include in extreme detail in this appendix.\nProof of Lemma 3.1. First, we can start with the expression for expected profit and slightly rewrite it.\u222b X (\u2207u(x) \u00b7 (x\u2212 \u03c0(c, x))\u2212 u(x)) f(x) dx\n= \u222b X ( n\u2211 i=1 ( \u2202u \u2202xi ) (xi \u2212 \u03c0i(ci, xi))\u2212 u(x) ) f(x) dx\n= n\u2211 i=1 \u222b X (( \u2202u \u2202xi ) (xi \u2212 \u03c0i(ci, xi)) ) f(x) dx\u2212 \u222b X u(x)f(x) dx.\n(9)\nNow consider the first term in 9, and pick out the summand for any index i. We have\u222b X (( \u2202u \u2202xi ) (xi \u2212 \u03c0i(ci, xi)) ) f(x) dx\n= \u222b X\u2212i (\u222b Xi \u2202u \u2202xi xif(x) dxi \u2212 \u222b Xi \u2202u \u2202xi (\u03c0i(ci, xi)f(x)) dxi ) dx\u2212i.\n(10)\nApplying integration by parts to these terms, with Xi = [0, bi] we get\u222b Xi \u2202u \u2202xi xif(x) dxi = u(x)xif(x)|xi=bi0 \u2212 \u222b bi 0 u(x) [ \u2202 \u2202xi (xif(x)) ] dxi\n= biu(bi, x\u2212i)f(bi, x\u2212i)\u2212 \u222b bi 0 u(x) ( xi \u2202f \u2202xi + f(x) ) dxi.\nand likewise\u222b Xi \u2202u \u2202xi \u03c0i(ci, xi)f(x) dxi = u(x)\u03c0i(ci, xi)f(x)|xi=bi0 \u2212 \u222b bi 0 u(x) [ \u2202 \u2202xi (\u03c0i(ci, xi)f(x)) ] dxi\n=u(bi, x\u2212i)\u03c0i(ci, bi)f(bi, x\u2212i)\u2212 u(0, x\u2212i)\u03c0i(ci, 0)f(0, x\u2212i) \u2212 \u222b bi 0 u(x) ( \u03c0i(ci, xi) \u2202f \u2202xi + f(x) \u2202\u03c0i(ci, xi) \u2202xi ) dxi.\nPutting these back into the expression in 10, and distributing through the \u222b X\u2212i\n, we end up with\u222b X\u2212i u(bi, x\u2212i)(bi \u2212 \u03c0i(ci, bi))f(bi, x\u2212i) dx\u2212i \u2212 \u222b X\u2212i \u2212u(0, x\u2212i)\u03c0i(ci, 0)f(0, x\u2212i) dx\u2212i\n+ \u222b X (\u03c0i(ci, xi)\u2212 xi)u(x) \u2202f \u2202xi dx+ \u222b X u(x)f(x) ( \u2202\u03c0i(ci, xi) \u2202xi \u2212 1 ) dx.\nfor any choice of index i.\nPutting these terms back inside the sum in 9, we get\nn\u2211 i=1 \u222b X (( \u2202u \u2202xi ) (xi \u2212 \u03c0i(ci, xi)) ) f(x) dx\u2212 \u222b X u(x)f(x) dx\n= n\u2211 i=1 (\u222b X\u2212i u(bi, x\u2212i)(bi \u2212 \u03c0i(ci, bi))f(bi, x\u2212i) dx\u2212i \u2212 \u222b X\u2212i \u2212u(0, x\u2212i)\u03c0i(ci, 0)f(0, x\u2212i) dx\u2212i ) +\nn\u2211 i=1 \u222b X (\u03c0i(ci, xi)\u2212 xi)u(x) \u2202f \u2202xi dx+ n\u2211 i=1 \u222b X u(x)f(x) ( \u2202\u03c0i(ci, xi) \u2202xi \u2212 1 ) dx\u2212 \u222b X u(x)f(x) dx\n=...+ n\u2211 i=1 \u222b X u(x)f(x) ( \u2202\u03c0i(ci, xi) \u2202xi \u2212 1 ) dx\u2212 \u222b X u(x)f(x) (1) dx\n=...+ n\u2211 i=1 \u222b X u(x)f(x) ( \u2202\u03c0i(ci, xi) \u2202xi ) dx\u2212 (n+ 1) \u222b X u(x)f(x) dx\n= n\u2211 i=1 (\u222b X\u2212i u(bi, x\u2212i)(bi \u2212 \u03c0i(ci, bi))f(bi, x\u2212i) dx\u2212i \u2212 \u222b X\u2212i \u2212u(0, x\u2212i)\u03c0i(ci, 0)f(0, x\u2212i) dx\u2212i ) +\n\u222b X u(x)(\u2207f(x) \u00b7 (\u03c0(c, x)\u2212 x)) dx+ n\u2211 i=1 \u222b X u(x)f(x) ( \u2202\u03c0i(ci, xi) \u2202xi ) dx\u2212 (n+ 1) \u222b X u(x)f(x) dx\n= n\u2211 i=1 (\u222b X\u2212i u(bi, x\u2212i)(bi \u2212 \u03c0i(ci, bi))f(bi, x\u2212i) dx\u2212i \u2212 \u222b X\u2212i \u2212u(0, x\u2212i)\u03c0i(ci, 0)f(0, x\u2212i) dx\u2212i ) +\u222b\nX u(x)(\u2207f(x) \u00b7 (\u03c0(c, x)\u2212 x)) dx+ \u222b X u(x)f(x)div\u03c0(c, x) dx\u2212 (n+ 1) \u222b X u(x)f(x) dx.\nThere are four terms in this sum. The first term can be expressed as a surface integral around X =\u220f i[0, bi]. Each of the remaining terms is an integral of u(x) against some density, and we can combine these together. After this transformation, we can re-express the above as an integral \u222b u d\u00b5\u2032 against a measure \u00b5\u2032, where\n\u00b5\u2032(A) = \u222b \u2202X IA(x)f(x)(x\u2212 \u03c0(c, x)) \u00b7 n\u0302 dx\n\u2212 \u222b X IA(x)(\u2207f(x) \u00b7 (x\u2212 \u03c0(c, x)) + (n+ 1\u2212 div \u03c0(c, x))f(x)) dx.\nThis relationship holds for any u. However, we can plug in u(x) = 1 and, after some calculation, find that \u00b5\u2032 integrates to \u222b\nX (\u2207u(x) \u00b7 (x\u2212 \u03c0(c, x))\u2212 u(x)) f(x) dx = \u222b X (0\u2212 1)f(x) dx = \u222b d\u00b5\u2032 = \u22121.\nIt will be more convenient to construct a measure \u00b5 that integrates to zero, so that when we split \u00b5 = \u00b5+\u2212\u00b5\u2212, we face a balanced optimal transport problem between \u00b5+ and \u00b5\u2212. We can take advantage of the fact that for our problem, feasible u have u(c) = 0, and let \u00b5(A) = \u00b5\u2032(A) + IA(c), observing \u222b u d\u00b5 = \u222b u d\u00b5\u2032 for such feasible u. Our final measure is thus\n\u00b5(A) = \u222b \u2202X IA(x)f(x)(x\u2212 \u03c0(c, x)) \u00b7 n\u0302 dx\n\u2212 \u222b X IA(x)(\u2207f(x) \u00b7 (x\u2212 \u03c0(c, x)) + (n+ 1\u2212 div \u03c0(c, x))f(x)) dx+ IA(c).\n(3)\nIn conclusion,\u222b X (\u2207u(x) \u00b7 (x\u2212 \u03c0(c, x))\u2212 u(x)) f(x) dx = \u222b u d\u00b5 = \u222b u d\u00b5+ \u2212 \u222b u d\u00b5\u2212.\nfor any feasible u.\nProof of lemma 3.3. First, we rewrite the dual problem in an unconstrained form, proceeding in essentially the same manner as all prior work.\ninf \u03b3:\u03b31\u2ab0\u00b5+,\u03b32\u2aaf\u00b5\u2212\n\u222b \u2225x\u2212 y\u22251 d\u03b3(x, y) = inf\n\u03b3 \u0398\u2217(\u03b3)\u2212 \u039e\u2217(\u03b3),\nwhere\n\u0398\u2217(\u03b3) =\n{\u222b \u2225x\u2212 y\u22251 d\u03b3(x, y) if \u03b3 \u2208 Radon+(X \u00d7 X )\n+\u221e , otherwise. and\n\u039e\u2217(\u03b3) = { 0 if \u03b31 \u2ab0 \u00b5+, \u00b5\u2212 \u2ab0 \u03b32 \u2212\u221e , otherwise. .\nWe will apply Fenchel-Rockafellar duality [47], which states that supf \u039e(f)\u2212\u0398(f) = inf\u03b3 \u0398\u2217(\u03b3)\u2212\u039e\u2217(\u03b3) for concave \u039e, and convex and continuous \u0398. The \u2217 operation is the (convex or concave) conjugate. By directly taking the conjugate of \u0398\u2217, we can find\n\u0398\u2217\u2217(f) = { 0 if f(x, y) \u2264 \u2225x\u2212 y\u22251 +\u221e , otherwise.\nThis function is proper and convex, and closed because the domain of feasible f is a convex set. Therefore it is legitimate to refer to \u0398 = \u0398\u2217\u2217. We propose \u039e\u2217\u2217 = \u039e as the closed and concave function,\n\u039e\u2217\u2217(f) =\n{\u222b \u03d5d\u00b5+ \u2212 \u222b \u03c8 d\u00b5\u2212 \u2203\u03d5, \u03c8 \u2208 U\u25e6 : \u03d5(x)\u2212 \u03c8(y) = f(x, y)\n\u2212\u221e , otherwise,\nwhere U\u25e6 is the cone generated by positive scaling of elements of U . This function is proper and concave, and is closed because the domain of feasible f , {f | \u2203\u03d5, \u03c8 \u2208 U\u25e6 : f(x, y) = \u03d5(x) \u2212 \u03c8(y)} is a closed convex set. Taking the conjugate again, \u039e\u2217\u2217\u2217 is in fact \u039e\u2217:\n\u039e\u2217\u2217\u2217(\u03b3) = inf f\n\u222b f(x, y) d\u03b3(x, y)\u2212 \u039e\u2217\u2217(f)\n= inf \u03d5,\u03c8\u2208U\u25e6\n\u222b \u03d5(x) d\u03b31(x)\u2212 \u222b \u03c8(y) d\u03b3(y)\u2212 \u222b \u03d5(x) d\u00b5+ + \u222b \u03c8(y) d\u00b5\u2212\n=\n{ 0 \u03b31 \u2ab0 \u00b5+, \u03b32 \u2ab0 \u00b5\u2212\n\u2212\u221e else\n=\u039e\u2217(\u03b3).\n(If \u03b31 \u2ab0 \u00b5+ does not hold, this implies there must exist some \u03d5 for which the integrals are negative; and this can be scaled arbitrarily to \u2212\u221e. Likewise for \u03b32, \u00b5\u2212 and \u03c8. This allows the transformation from an unconstrained to constrained problem.)\nFor the same reasons as in Kash and Frongillo [25], \u0398 is continuous at f(x, y) = \u22121, \u0398(f) = 0, and \u039e(f) = \u2212 \u222b d\u00b5\u2212, so the preconditions for Fenchel-Rockafellar duality are satisfied. At this point, we now have a dual of\nsup \u03d5(x)\u2212\u03c8(y)\u2264\u2225x\u2212y\u22251,\u03d5,\u03c8\u2208U\u25e6\n\u222b \u03d5d\u00b5+ \u2212 \u222b \u03c8 d\u00b5\u2212 = sup\nf \u039e(f)\u2212\u0398(f) = inf \u03b3 \u0398\u2217(\u03b3)\u2212 \u039e\u2217(\u03b3)."
        },
        {
            "heading": "C Noise trading (no adverse selection) in 2 dimensions",
            "text": "We consider in \u00a75.2 a pure noise trading case where the mechanism designer has a fixed belief c = ( 12 , 1 2 ), which corresponds to setting \u03bb = 1 in the linear belief update model. Here we detail the calculations of the transport cost of the optimal transport plan for the dual problem.\nFigure 10 visualizes the signed measure for the optimal transport dual problem for this specific case. There is a point mass of 1 at ( 12 , 1 2 ), a uniformly distributed mass of 1 2 at each of the four edges of the unit square, and a \u22123 mass uniformly distributed over the square. The solution to the dual problem is the minimum transport cost to move the positive mass so that the positive and negative mass cancel each other and the net mass is zero everywhere.\nNote that the transport cost here is defined with respect to the Manhattan distance of any mass movement, i.e., measuring the sum of horizontal movement and vertical movement when calculating the transport cost of any movement. As moving positive mass and moving negative mass are symmetric, we can consider the optimal solution in the solution space where only the positive masses are moved to cancel out the uniform negative mass over the unit square.\nBased on the learned solution in Fig. 2 (top row), we can conjecture the structure of the optimal mechanism and thus the structure of the optimal transport plan, which involves partitioning the type space into separate regions including one octagonal region with zero transport cost, four equivalent rectangular regions, and four equivalent pentagonal regions.\nFig. 3, right, shows the optimal transport for one of the four equivalent rectangles. There is a positive on edge JK, and it is moved upward to uniformly cover the rectangle HIJK. The transport cost of one rectangle is therefore C (R) 1 = \u222b b1 0 ( 1\u22122a1 2 ) 1 b1 xdx = (1\u22122a1)b14 .\nFig. 3, middle, shows the optimal transport for one of the four equivalent pentagons. There is a positive mass on edges AB and BD. The positive mass at edge AB is moved downward to uniformly cover rectangle ABCF, the positive mass at edge CD is moved leftward to uniformly cover rectangle CDEG, and the positive mass at edge BC is moved to cover uniform triangle EFG. The transport cost for rectangle ABCF is\u222b b1\n0\n(a1 2 ) 1 b1 xdx = a1b1 4 .\nThe transport cost for rectangle CDEG is\u222b b1 0 ( a1 \u2212 b1 2 ) 1 b1 xdx = (a1 \u2212 b1)b1 4 .\nFor the triangle EFG, the positive mass at edge BC is first moved to point C, then moved to point G, and finally moved to uniformly cover triangle EFG. This is the optimal way to transport the mass as the cost is with respect to the Manhattan distance of movements. Adding the costs of these three transport steps together, the transport for triangle EFG is(\u222b b1\n0\n1 2 xdx\n) + ( b1 2 b1 ) + (\u222b a1\u2212b1 0 \u222b a1\u2212b1\u2212x 0 ( b1 2 )( 2 (a1 \u2212 b1)2 ) (x+ y)dydx ) = 3b21 4 + (a1 \u2212 b1)b1 3 .\nThe total transport cost of the pentagon is\nC (P ) 1 = a1b1 4 + (a1 \u2212 b1)b1 4 + 3b21 4 + (a1 \u2212 b1)b1 3 = (5a1 + b1)b1 6 ."
        },
        {
            "heading": "D Linear belief update in 2 dimensions",
            "text": "Here, we show the full derivation for a more general case where the mechanism designer has an initial belief of c and updates their belief by linearly interpolating after one trade, so that \u03c0(c, x) = \u03bbc+(1\u2212\u03bb)x, \u03bb \u2208 [0, 1]. We give a family of transport plans parameterized by \u03bb, which match a family of mechanisms parameterized by \u03bb.\nD.1 Constructing the transformed measure\nThe transformed measure (Eq. 1) for this case is:\n\u2022 \u2212(2\u03bb+ 1) mass distributed uniformly.\n\u2022 A +1 point mass at c.\n\u2022 Mass of +(1\u2212 c1)\u03bb on the right boundary, +(1\u2212 c2)\u03bb on the top boundary, +c1\u03bb on the left boundary, and +c2\u03bb on the bottom boundary.\nThe positive and negative masses each have magnitude 2\u03bb + 1. The measure for the case where c = ( 12 , 1 2 ) is visualized in Fig. 1 (right).\nD.2 Conjecture for optimal mechanism\nConsider the case where c = ( 12 , 1 2 ) . We first train a model to maximize profit. Fig. 2 visualizes the learned mechanisms when varying the value of \u03bb. Similar to the noise trading case, we use the learned solution, as well as our knowledge of the problem setting, to conjecture the structure of the optimal mechanism. The optimal mechanism should be deterministic, offer 8 menu items in addition to the no-trade option, and should be symmetric.\nD.3 Constructing a dual certificate\nPartitioning the type space As in the noise trading case, the solution to the dual problem is the minimum transport cost to move the positive mass and cancel out the negative mass perfectly and the optimal transport plan involves partitioning the type space into separate regions including an octagonal notrade region in the center, four equivalent rectangular regions, and four equivalent octagonal regions. The minimal total transport cost is the sum of the minimal transport cost for each of the partitioned regions.\nFig. 11 shows the optimal partition in this case with a linear belief update. In the optimal transport solution, the +1 point mass at c = ( 12 , 1 2 ), according to our definition of \u2ab0, can be spread outward (away from c) to uniformly cover the octagonal region at the center, at zero cost. In addition to the octagon, there are four equivalent rectangles and four equivalent pentagons. Each of the rectangles and pentagons contains a part of the four outer edges of the unit square, and the positive mass on that part of the edge gets distributed uniformly over the rectangle or pentagon to cancel out the negative mass. The total transport cost is therefore\nC\u03bb = 4C (R) \u03bb + 4C (P ) \u03bb ,\nwhere C (R) \u03bb is the transport cost of one rectangle, C (P ) \u03bb is the transport cost of one pentagon, and the subscript \u03bb represents the linear update parameter.\nTransport plan We parameterize the partition in terms of lengths a\u03bb and b\u03bb. Fig. 12, right, shows the optimal transport for one of the four equivalent rectangles. There is a positive on edge JK, and it is moved upward to uniformly cover the rectangle HIJK. The transport cost of one rectangle is therefore\nC (R) \u03bb = \u222b b\u03bb 0 \u03bb 2 (1\u2212 2a\u03bb) 1 b\u03bb xdx = \u03bb(1\u2212 2a\u03bb)b\u03bb 4 .\nFig. 12, left, shows the optimal transport for one of the four equivalent pentagons. There is a positive mass on edges AB and BD. The positive mass at edge AB is moved downward to uniformly cover rectangle ABCF, the positive mass at edge CD is moved leftward to uniformly cover rectangle CDEG, and the positive mass at edge BC is moved to cover uniform triangle EFG. The transport cost for rectangle ABCF is\u222b b\u03bb\n0\n( \u03bba\u03bb 2 ) 1 b\u03bb xdx = \u03bba\u03bbb\u03bb 4 .\nThe transport cost for rectangle CDEG is\u222b b\u03bb 0 \u03bb 2 (a\u03bb \u2212 b\u03bb) 1 b\u03bb xdx = \u03bb(a\u03bb \u2212 b\u03bb)b\u03bb 4 .\nFor the triangle EFG, the positive mass at edge BC is first moved to point C, then moved to point G, and finally moved to uniformly cover triangle EFG. This is the optimal way to transport the mass as the cost is with respect to the Manhattan distance of movements. Adding the costs of these three transport steps together, the transport for triangle EFG is(\u222b b\u03bb\n0\n\u03bb 2 xdx\n) + ( \u03bbb\u03bb 2 b\u03bb ) + (\u222b a\u03bb\u2212b\u03bb 0 \u222b a\u03bb\u2212b\u03bb\u2212x 0 ( \u03bbb\u03bb 2 )( 2 (a\u03bb \u2212 b\u03bb)2 ) (x+ y)dydx ) = 3\u03bbb2\u03bb 4 + \u03bb(a\u03bb \u2212 b\u03bb)b\u03bb 3 .\nThe total transport cost of the pentagon is\nC (P ) \u03bb = \u03bba\u03bbb\u03bb 4 + \u03bb(a\u03bb \u2212 b\u03bb)b\u03bb 4 + 3\u03bbb2\u03bb 4 + \u03bb(a\u03bb \u2212 b\u03bb)b\u03bb 3 = \u03bb(5a\u03bb + b\u03bb)b\u03bb 6 .\nSolving for a\u03bb and b\u03bb The structure of the transport plan constrains the values of a\u03bb and b\u03bb. There is a positive mass on edge JK of length 1 \u2212 2a\u03bb, and as the mass density per unit length of the edge is \u03bb2 , the mass is \u03bb(1\u22122a\u03bb)2 . This mass is moved upward to be distributed uniformly over the rectangle HIJK and should perfectly cancel out the negative mass in the rectangle. The density of the initial negative mass over the rectangle HIJK is \u2212(2\u03bb + 1)(1 \u2212 2a\u03bb)b\u03bb, and because it should perfectly cancel out the positive mass \u03bb(1\u22122a\u03bb)\n2 , we have\n\u03bb(1\u2212 2a\u03bb) 2 \u2212 (2\u03bb+ 1)(1\u2212 2a\u03bb)b\u03bb = 0. (11)\nThe positive mass on edge BC is \u03bbb\u03bb2 , and the negative mass on triangle EFG is \u2212 (2\u03bb+1)(a\u03bb\u2212b\u03bb)2\n2 . As these two masses should perfectly cancel out each other, we have\n\u03bbb\u03bb 2 \u2212 (2\u03bb+ 1)(a\u03bb \u2212 b\u03bb) 2 2 = 0. (12)\nSimilarly, the positive mass on edge AB is \u03bba\u03bb2 , and the negative mass on rectangle ABCF is \u2212(2\u03bb+1)a\u03bbb\u03bb. As these two masses should perfectly cancel out, we have\n\u03bba\u03bb 2 \u2212 (2\u03bb+ 1)a\u03bbb\u03bb = 0. (13)\nCombining equations Eq. 11, Eq. 12, and Eq. 13, the values of a\u03bb and b\u03bb can be solved:\na\u03bb = (1 +\n\u221a 2)\u03bb\n4\u03bb+ 2 , b\u03bb =\n\u03bb\n4\u03bb+ 2 .\nComputing the menu The boundary between two regions is the point where a trader is indifferent between the two menu items. At any trader type on a boundary, we can easily calculate the welfare of the two neighboring allocations, and infer the price that would make the trader indifferent. The resulting menu is given in Table 2 and visualized (with a specific value of \u03bb = 12 ) in Fig. 13. The total transport cost for this case with linear belief update is\nC\u03bb = 4C (R) \u03bb + 4C (P ) \u03bb = 4 \u00b7 \u03bb(1\u2212 2a\u03bb)b\u03bb 4 + 4 \u00b7 \u03bb(5a\u03bb + b\u03bb)b\u03bb 6\n= \u03bb2 (( 9 + 2 \u221a 2 ) \u03bb+ 3 ) 6(2\u03bb+ 1)2 . (14)\nwhich exactly matches the expected profit of the optimal menu, so our solutions are optimal."
        },
        {
            "heading": "E Noise trading in 2 dimensions with an off-center belief",
            "text": "We now consider another pure noise trading case which corresponds to the setting \u03bb = 1 in the linear update model. Unlike in \u00a7C, the mechanism designer in this case has an off-center belief of c = ( 13 , 1 3 ).\nE.1 Constructing the transformed measure\nThe transformed measure (Eq. 1) for this case is:\n\u2022 \u2212(2\u03bb+ 1) = \u22123 mass distributed uniformly.\n\u2022 A +1 point mass at c = ( 13 , 1 3 ).\n\u2022 Mass of +(1\u2212 c1)\u03bb = + 23 on the right boundary, +(1\u2212 c2)\u03bb = + 2 3 on the top boundary, +c1\u03bb = + 1 3\non the left boundary, and +c2\u03bb = + 1 3 on the bottom boundary.\nThe positive and negative masses each have magnitude 3. The measure is visualized in Fig 14.\nE.2 Conjecture for optimal mechanism\nWe first train RochetNet to maximize profit in this case. The allocation rules for the mechanism after training are shown in Fig. 5.\nSimilar to \u00a7C and \u00a7D, we use the RochetNet solution, as well as our knowledge of the problem setting, to conjecture the structure of the optimal mechanism. The optimal mechanism should be deterministic and should be symmetric with respect to the two items. The RochetNet solution suggests that the optimal mechanism offers 6 menu items in addition to the no-trade option.\nPartitioning the type space The dual problem is the optimal transport according to the transformed measure in \u00a7E.1 and the optimal transport plan involves partitioning the type space into separate regions. Based on the RochetNet solution, we conjecture the partitioned regions in Fig. 15, which consist of a central hexagonal no-trade region, two rectangular regions, and four pentagonal regions.\nIn the optimal transport solution under our conjecture, the +1 point mass at c = ( 13 , 1 3 ), according to our definition of \u2ab0, can be spread outward (away from c) to uniformly cover the hexagonal region at the center, at zero cost. In addition to the hexagon, there are two equivalent rectangular regions, and we denote this shape with R. There are two equivalent pentagonal regions at top left and bottom right, which we denote with P1. We denote the smaller pentagonal region at bottom left with P2, and the larger pentagonal region at top right with P3. Each of the rectangles and pentagons contains a part of the four outer edges of the unit square, and the positive mass on that part of the edge gets distributed uniformly over the rectangle or pentagon to cancel out the negative mass.\nSolving for a, b, d, e, and f The structure of the transport plan constrains the values of a, b, d, e, and f . For the rectangular shape R illustrated with rectangle HIJK, there is a positive mass of 1\u2212a\u2212f3 on edge JK. This mass is moved upward to be distributed uniformly over the rectangle HIJK and should perfectly cancel out the negative mass of \u22123b(1\u2212 a\u2212 f) in the rectangle. Therefore, we have\n1\u2212 a\u2212 f 3 \u2212 3b(1\u2212 a\u2212 f) = 0. (15)\nFor the pentagonal shape P1 illustrated with pentagon STVWX, there is a positive mass of 2d 3 on edge ST and a positive mass of f3 on edge TV. They should cancel out the negative mass of \u22123 ( df \u2212 (d\u2212b)(f\u2212e)2 ) perfectly. That is,\n2d 3 + f 3 \u2212 3\n( df \u2212 (d\u2212 b)(f \u2212 e)\n2\n) = 0. (16)\nSimilarly, for the pentagonal shape P2, it should hold that\na 3 + a 3 \u2212 3\n( a2 \u2212 (a\u2212 b) 2\n2\n) = 0. (17)\nFor the pentagonal shape P3, we have\n2(1\u2212 d) 3 + 2(1\u2212 d) 3 \u2212 3\n( (1\u2212 d)2 \u2212 (1\u2212 d\u2212 e) 2\n2\n) = 0. (18)\nConsider the point X = (1 \u2212 e, d) in Fig. 15. The fact that this point lies on the boundary between the central no-trade region and the bottom right pentagonal region implies that a trader with the type (1\u2212 e, d) is indifferent to whether making no trade at all, or getting the allocation of (+1,\u22121) and making the corresponding payment. Assume the payment for the allocation (+1,\u22121) is p. Therefore, it holds that\n(+1) \u00b7 (1\u2212 e) + (\u22121) \u00b7 d\u2212 p = 0. (19)\nSimilarly, we can get the following equation by considering the point W = (1\u2212 f, b) in Fig. 15:\n(+1) \u00b7 (1\u2212 f) + (\u22121) \u00b7 b\u2212 p = 0. (20)\nAdditionally, we have the following constraints\n0 \u2264 a, b, d, e, f \u2264 1, e < f, 1\u2212 a\u2212 f > 0. (21)\nCombining equations Eq. 15, Eq. 16, Eq. 17, Eq. 18, Eq. 19, Eq. 20, and Eq. 21, the values of a, b, d, e, and f can be solved:\na = 1 +\n\u221a 2\n9 , b =\n1 9 , d = 1 63\n( 25\u2212 6 \u221a 2 + 2 \u221a 134\u2212 82 \u221a 2 ) , (22)\ne = 1\n63\n( 26 + 24 \u221a 2\u2212 2 \u221a 310 + 214 \u221a 2 ) , f = 1\n63\n( 44 + 18 \u221a 2\u2212 4 \u221a 74 + 22 \u221a 2 ) . (23)\nComputing the menu The boundary between two regions is the point where a trader is indifferent between the two menu items. At any trader type on a boundary, we can easily calculate the welfare of any two neighboring allocations, and infer the price that would make the trader indifferent between them. The resulting menu is given in Table 3 and visualized in Fig. 17."
        }
    ],
    "title": "Optimal Automated Market Makers: Differentiable Economics and Strong Duality",
    "year": 2024
}
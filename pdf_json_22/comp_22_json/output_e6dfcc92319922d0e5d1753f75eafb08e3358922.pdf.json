{
    "abstractText": "Let \u0394 = \u03941 \u00d7 . . . \u00d7 \u0394d \u2286 Rn, where Rn = Rn1 \u00d7 \u00b7 \u00b7 \u00b7 \u00d7 Rnd with each \u0394i \u2286 Rni a non-degenerate simplex of ni points. We prove that any set S \u2286 Rn, with n = n1 + \u00b7 \u00b7 \u00b7 + nd of positive upper Banach density necessarily contains an isometric copy of all sufficiently large dilates of the configuration \u0394. In particular any such set S \u2286 R2d contains a d-dimensional cube of side length \u03bb, for all \u03bb \u2265 \u03bb0(S). We also prove analogous results with the underlying space being the integer lattice. The proof is based on a weak hypergraph regularity lemma and an associated counting lemma developed in the context of Euclidean spaces and the integer lattice.",
    "authors": [
        {
            "affiliations": [],
            "name": "NEIL LYALL"
        }
    ],
    "id": "SP:52a25605f603a3b5371d5c057d6e31f15a241ecf",
    "references": [
        {
            "authors": [
                "J. Bourgain"
            ],
            "title": "A Szemer\u00e9di type theorem for sets of positive density in Rk, Israel",
            "venue": "J. Math",
            "year": 1986
        },
        {
            "authors": [
                "David Conlon",
                "Jacob Fox",
                "Yufei Zhao"
            ],
            "title": "A relative Szemer\u00e9di theorem, Geom",
            "venue": "Funct. Anal",
            "year": 2015
        },
        {
            "authors": [
                "Brian Cook",
                "\u00c1kos Magyar",
                "Malabika Pramanik"
            ],
            "title": "A Roth-type theorem for dense subsets of Rd",
            "venue": "Bull. Lond. Math. Soc",
            "year": 2017
        },
        {
            "authors": [
                "Polona Durcik",
                "Vjekoslav Kova\u010d"
            ],
            "title": "Boxes, extended boxes and sets of positive upper density in the Euclidean space, Math",
            "venue": "Proc. Cambridge Philos. Soc",
            "year": 2021
        },
        {
            "authors": [
                "H. Furstenberg",
                "Y. Katznelson"
            ],
            "title": "An ergodic Szemer\u00e9di theorem for commuting transformations",
            "venue": "J. Analyse Math",
            "year": 1978
        },
        {
            "authors": [
                "Hillel Furstenberg",
                "Yitzchak Katznelson",
                "Benjamin Weiss"
            ],
            "title": "Ergodic theory and configurations in sets of positive density, Mathematics of Ramsey theory",
            "venue": "Algorithms Combin.,",
            "year": 1990
        },
        {
            "authors": [
                "Alan Frieze",
                "Ravi Kannan"
            ],
            "title": "The regularity lemma and approximation schemes for dense problems",
            "venue": "Annual Symposium on Foundations of Computer Science (Burlington, VT,",
            "year": 1996
        },
        {
            "authors": [
                "W.T. Gowers"
            ],
            "title": "Hypergraph regularity and the multidimensional Szemer\u00e9di theorem, Ann",
            "venue": "DOI 10.4007/annals.2007.166.897",
            "year": 2007
        },
        {
            "authors": [
                "R.L. Graham"
            ],
            "title": "Recent trends in Euclidean Ramsey theory, Discrete Math",
            "venue": "DOI 10.1016/0012-365X(94)00110-5. Trends in discrete mathematics",
            "year": 1994
        },
        {
            "authors": [
                "M.A. Iosevich"
            ],
            "title": "Rudnev, Erd\u0151s distance problem in vector spaces over finite fields",
            "venue": "Trans. Amer. Math. Soc",
            "year": 2007
        },
        {
            "authors": [
                "Y. Kitaoka"
            ],
            "title": "Lectures on Siegel modular forms and representation by quadratic forms",
            "venue": "Tata Institute of Fundamental Research Lectures on Mathematics and Physics,",
            "year": 1986
        },
        {
            "authors": [
                "Neil Lyall",
                "\u00c1kos Magyar"
            ],
            "title": "Product of simplices and sets of positive upper density in Rd, Math",
            "venue": "Proc. Cambridge Philos. Soc",
            "year": 2018
        },
        {
            "authors": [
                "Neil Lyall",
                "\u00c1kos Magyar"
            ],
            "title": "Distance graphs and sets of positive upper density in Rd",
            "venue": "Anal. PDE",
            "year": 2020
        },
        {
            "authors": [
                "Neil Lyall",
                "\u00c1kos Magyar"
            ],
            "title": "Distances and trees in dense subsets of Zd, Israel",
            "venue": "J. Math",
            "year": 2020
        },
        {
            "authors": [
                "Neil Lyall",
                "\u00c1kos Magyar",
                "Hans Parshall"
            ],
            "title": "Spherical configurations over finite fields, Amer",
            "venue": "J. Math",
            "year": 2020
        },
        {
            "authors": [
                "\u00c1kos Magyar"
            ],
            "title": "On distance sets of large sets of integer points, Israel",
            "venue": "J. Math",
            "year": 2008
        },
        {
            "authors": [
                "\u00c1kos Magyar"
            ],
            "title": "k-point configurations in sets of positive density of Zn",
            "venue": "Duke Math. J",
            "year": 2009
        },
        {
            "authors": [
                "Hans Parshall"
            ],
            "title": "Simplices over finite fields",
            "venue": "Proc. Amer. Math. Soc",
            "year": 2017
        },
        {
            "authors": [
                "Carl Ludwig Siegel"
            ],
            "title": "On the theory of indefinite quadratic forms",
            "venue": "Ann. of Math. (2)",
            "year": 1944
        },
        {
            "authors": [
                "E. Szemer\u00e9di"
            ],
            "title": "On sets of integers containing no k elements in arithmetic progression",
            "venue": "Acta Arith",
            "year": 1975
        },
        {
            "authors": [
                "Terence Tao"
            ],
            "title": "Szemer\u00e9di\u2019s regularity lemma revisited, Contrib",
            "venue": "Discrete Math",
            "year": 2006
        },
        {
            "authors": [
                "Terence Tao"
            ],
            "title": "A variant of the hypergraph removal",
            "venue": "lemma, J. Combin. Theory Ser. A",
            "year": 2006
        },
        {
            "authors": [
                "Terence Tao"
            ],
            "title": "The ergodic and combinatorial approaches to Szemer\u00e9di\u2019s theorem, Additive combinatorics",
            "venue": "CRM Proc. Lecture Notes,",
            "year": 2007
        },
        {
            "authors": [
                "Tamar Ziegler"
            ],
            "title": "Nilfactors of Rm-actions and configurations in sets of positive upper density in Rm",
            "venue": "J. Anal. Math",
            "year": 2006
        }
    ],
    "sections": [
        {
            "heading": "1. Introduction",
            "text": "1.1. Existing results I: Distances and simplices in subsets of Rn. Recall that the upper Banach density of a measurable set S \u2286 Rn is defined by\n(1.1) \u03b4\u2217(S) = lim N\u2192\u221e sup t\u2208Rn |S \u2229 (t+Q(N))| |Q(N)| ,\nwhere | \u00b7 | denotes Lebesgue measure on Rn and Q(N) denotes the cube [\u2212N/2, N/2]n.\nA result of Furstenberg, Katznelson, and Weiss [6] states that if S \u2286 R2 has positive upper Banach density, then its distance set {|x\u2212 x\u2032| : x, x\u2032 \u2208 S} contains all sufficiently large numbers. Note that the distance set of any set of positive Lebesgue measure in Rn automatically contains all sufficiently small numbers (by the Lebesgue density theorem) and that it is easy to construct a set of positive upper density which does not contain a fixed distance by placing small balls centered on an appropriate square grid.\nTheorem A (Furstenberg, Katznelson, and Weiss [6]). If S \u2286 R2 with \u03b4\u2217(S) > 0, then there exists a \u03bb0 = \u03bb0(S) such that S is guaranteed to contain pairs of points {x1, x2} with |x2 \u2212 x1| = \u03bb for all \u03bb \u2265 \u03bb0.\nThis result was later reproved using Fourier analytic techniques by Bourgain in [1] where he established the following more general result for all configurations of n points in Rn whose affine span is n\u2212 1 dimensional, namely for all non-degenerate simplices.\nReceived by the editors January 3, 2020, and, in revised form, October 30, 2020. 2020 Mathematics Subject Classification. Primary 11B30. The first and second authors were partially supported by grants NSF-DMS 1702411 and NSF-\nDMS 1600840, respectively.\nc\u00a92022 by the authors under Creative Commons Attribution-Noncommercial 4.0 License (CC BY NC ND 4.0)\n160\nTheorem B (Bourgain [1]). Let \u0394 \u2286 Rn be a non-degenerate simplex of n points. If S \u2286 Rn with \u03b4\u2217(S) > 0, then there exists a threshold \u03bb0 = \u03bb0(S,\u0394) such that S contains an isometric copy of \u03bb\u0394 for all \u03bb \u2265 \u03bb0.\nRecall that a finite point configuration \u0394\u2032 is said to be an isometric copy of \u03bb\u0394 if there exists a bijection \u03c6 : \u0394 \u2192 \u0394\u2032 such that |\u03c6(v) \u2212 \u03c6(w)| = \u03bb |v \u2212 w| for all v, w \u2208 \u0394, i.e. if \u0394\u2032 is obtained from \u03bb\u0394 (the dilation of \u0394 by a factor \u03bb) via a rotation and translation.\nBourgain deduced Theorem B as an immediate consequence of the following stronger quantitative result for measurable subsets of the unit cube of positive measure. In Proposition C, and throughout this article, we shall refer to a decreasing sequence {\u03bbj}Jj=1 as lacunary if \u03bbj+1 \u2264 \u03bbj/2 for all 1 \u2264 j < J .\nProposition C (Bourgain [1]). Let \u0394 \u2286 Rn be a non-degenerate simplex of n points. For any 0 < \u03b4 \u2264 1 there exists a constant J = O\u0394(\u03b4\u22123n) such that if 1 \u2265 \u03bb1 \u2265 \u00b7 \u00b7 \u00b7 \u2265 \u03bbJ is any lacunary sequence and S \u2286 [0, 1]n with |S| \u2265 \u03b4, then there exists 1 \u2264 j < J such that S contains an isometric copy of \u03bb\u0394 for all \u03bb \u2208 [\u03bbj+1, \u03bbj ].\nIn [12] the authors provided a short direct proof of Theorem B without using Proposition C. It is based on the observation that uniformly distributed sets S \u2286 Rd contain the expected \u201cnumber\u201d of isometric copies of dilates \u03bb\u0394 and that all sets of positive upper density become uniformly distributed at sufficiently large scales. However, for the purposes of this paper it will be important to recall Bourgain\u2019s indirect approach.\nTo see that Proposition C implies Theorem B notice that if Theorem B were not to hold for some set S \u2286 Rn of upper Banach density \u03b4\u2217(S) > \u03b4 > 0, then there must exist a lacunary sequence \u03bb1 \u2265 \u00b7 \u00b7 \u00b7 \u2265 \u03bbJ \u2265 1, with J the constant in Proposition C, such that S does not contain an isometric copy of \u03bbj\u0394 for any 1 \u2264 j \u2264 J . Taking a sufficiently large cube Q with side length N \u2265 \u03bb1 and |S \u2229Q| \u2265 \u03b4|Q| and scaling back Q \u2192 [0, 1]n contradicts Proposition C.\nWe further note that by taking \u03bbj = 2 \u2212j in Proposition C we obtain the following\n\u201cFalconer-type\u201d result for subsets of [0, 1]n of positive Lebesgue measure.\nCorollary D. If \u0394 \u2286 Rn is a non-degenerate simplex of n points, then any S \u2286 [0, 1]n with |S| > 0 will necessarily contain an isometric copy of \u03bb\u0394 for all \u03bb in some interval of length at least exp(\u2212C\u0394|S|\u22123n).\nBourgain further demonstrated in [1] that no result along the lines of Theorem B can hold for configurations that contain any three points in arithmetic progression along a line, specifically showing that for any n \u2265 1 there are sets of positive upper Banach density in Rn which do not contain an isometric copy of configurations of the form {0, y, 2y} with |y| = \u03bb for all sufficiently large \u03bb. This should be contrasted with the following remarkable result of Tamar Ziegler.\nTheorem E (Ziegler [25]). Let F be any configuration of k points in Rn with n \u2265 2. If S \u2286 Rn has positive upper density, then there exists a threshold \u03bb0 = \u03bb0(S,F) such that S\u03b5 contains an isometric copy of \u03bbF for all \u03bb \u2265 \u03bb0 and any \u03b5 > 0, where S\u03b5 denotes the \u03b5-neighborhood of S.\nBourgain\u2019s example was later generalized by Graham [9] to establish that the condition that \u03b5 > 0 in Theorem E is necessary and cannot be strengthened to \u03b5 = 0 for any given non-spherical configuration F in Rn for any n \u2265 1, that is for\nany finite configuration of points that cannot be inscribed in some sphere. We note that the sets constructed by Bourgain and Graham have the property that for any \u03b5 > 0 their \u03b5-neighborhoods will contain arbitrarily large cubes and hence trivially satisfy Theorem E with \u03bb0 = 0.\nIt is natural to ask if any spherical configuration F , beyond the known example of simplices, has the property that every positive upper Banach density subset of Rn, for some sufficiently large n, contains an isometric copy of \u03bbF for all sufficiently large \u03bb, and even to conjecture that this ought to hold for all spherical configurations. The first breakthrough in this direction came in [12] when the authors established this for configurations of four points forming a 2-dimensional rectangle in R4 and more generally for any configuration that is the direct product of two non-degenerate simplices in Rn for suitably large n.\nThe purpose of this article is to present a strengthening of the results in [12] and to extend them to cover configurations with a higher dimensional product structure in both the Euclidean and discrete settings.\n1.2. New results I: Rectangles and products of simplices in subsets of Rn. The first main result of this article is the following\nTheorem 1.1. Let R be 2d points forming the vertices of a fixed d-dimensional rectangle in R2d.\n(i) If S \u2286 R2d has positive upper Banach density, then there exists a threshold \u03bb0 = \u03bb0(S,R) such that S contains an isometric copy of \u03bbR for all \u03bb \u2265 \u03bb0.\n(ii) For any 0 < \u03b4 \u2264 1 there exists a constant c = c(\u03b4,R) > 0 such that any S \u2286 [0, 1]2d with |S| \u2265 \u03b4 is guaranteed to contain an isometric copy of \u03bbR for all \u03bb in some interval of length at least c.\nMoreover, if R has sidelengths given by t1, . . . , td, then the isometric copies of \u03bbR in both (i) and (ii) above can all be realized in the special form {x11, x12} \u00d7 \u00b7 \u00b7 \u00b7 \u00d7 {xd1, xd2} \u2286 R2 \u00d7 \u00b7 \u00b7 \u00b7 \u00d7 R2 with each |xj2 \u2212 xj1| = \u03bbtj.\nThe multi-dimensional extension of Szemere\u0301di\u2019s theorem on arithmetic progressions in sets of positive density due to Furstenberg and Katznelson [5] implies, and is equivalent to the fact, that there are isometric copies of \u03bbR in S for arbitrarily large \u03bb, with sides parallel to the coordinate axis. Theorem 1.1 states that there is an isometric copy of \u03bbR in S for every sufficiently large \u03bb, but only with sides parallel to given 2-dimensional coordinate subspaces which provides an extra degree of freedom for each side vector of the rectangle R.\nA weaker version of Theorem 1.1, with R2d replaced with R5d, was later established by Durcik and Kovac\u030c in [4] using an adaptation of arguments of the second author with Cook and Pramanik in [3]. This approach also makes direct use of the full strength of the multi-dimensional Szemere\u0301di theorem and as such leads to quantitatively weaker results.\nOur arguments work for more general patterns where d-dimensional rectangles are replaced with direct products of non-degenerate simplices.\nTheorem 1.2. Let \u0394 = \u03941 \u00d7 \u00b7 \u00b7 \u00b7 \u00d7 \u0394d \u2286 Rn, where Rn = Rn1 \u00d7 \u00b7 \u00b7 \u00b7 \u00d7 Rnd and each \u0394j \u2286 Rnj is a non-degenerate simplex of nj points.\n(i) If S \u2286 Rn has positive upper Banach density, then there exists a threshold \u03bb0 = \u03bb0(S,\u0394) such that S contains an isometric copy of \u03bb\u0394 for all \u03bb \u2265 \u03bb0.\n(ii) For any 0 < \u03b4 \u2264 1 there exists a constant c = c(\u03b4,\u0394) > 0 such that any S \u2286 [0, 1]n with |S| \u2265 \u03b4 is guaranteed to contain an isometric copy of \u03bb\u0394 for all \u03bb in some interval of length at least c.\nMoreover the isometric copies of \u03bb\u0394 in both (i) and (ii) above can all be realized in the special form \u0394\u20321 \u00d7 \u00b7 \u00b7 \u00b7 \u00d7\u0394\u2032d with each \u0394\u2032j \u2286 Rnj an isometric copy of \u03bb\u0394j.\nQuantitative Remark. A careful analysis of our proof reveals that the constant c(\u03b4,\u0394) can be taken greater than Wd(C \u2032 \u0394\u03b4\n\u22123n1\u00b7\u00b7\u00b7nd)\u22121 where Wk(m) is a tower of exponentials defined by W1(m) = exp(m) and Wk+1(m) = exp(Wk(m)) for k \u2265 1.\n1.3. Existing results II: Distances and simplices in subsets of Zn. The problem of counting isometric copies of a given non-degenerate simplex in Zn (with one vertex fixed) has been extensively studied via its equivalent formulation as the number of ways a quadratic form can be represented as a sum of squares of linear forms, see [11] and [19]. This was exploited by the second author in [16] and [17] to establish analogous results to those described in Section 1.1 for subsets of the integer lattice Zn of positive upper density.\nRecall that the upper Banach density of a set S \u2286 Zn is analogously defined by\n(1.2) \u03b4\u2217(S) = lim N\u2192\u221e sup t\u2208Rn |S \u2229 (t+Q(N))| |Q(N)| ,\nwhere | \u00b7 | now denotes counting measure on Zn and Q(N) the discrete cube [\u2212N/2, N/2]n \u2229 Zn.\nIn light of the fact that any pairs of distinct points {x1, x2} in Zn have the property that the square of the distance between them |x2\u2212x1|2 is always a positive integer we introduce the convenient notation\n\u221a N := {\u03bb : \u03bb > 0 and \u03bb2 \u2208 Z}.\nTheorem A\u2032 (Magyar [16]). Let 0 < \u03b4 \u2264 1. If S \u2286 Z5 has upper Banach density at least \u03b4, then there exists an integer q0 = q0(\u03b4) and \u03bb0 = \u03bb0(S) such that S contains pairs of points {x1, x2} with |x2 \u2212 x1| = q0\u03bb for all \u03bb \u2208 \u221a N with \u03bb \u2265 \u03bb0.\nTheorem B\u2032 (Magyar [17]). Let 0 < \u03b4 \u2264 1 and \u0394 \u2286 Z2n+3 be a non-degenerate simplex of n points.\n(i) If S \u2286 Z2n+3 has upper Banach density at least \u03b4, then there exists an integer q0 = O(exp(C\u0394\u03b4 \u221213n)) and \u03bb0 = \u03bb0(S,\u0394) such that S contains an\nisometric copy of q0\u03bb\u0394 for all \u03bb \u2208 \u221a N with \u03bb \u2265 \u03bb0.\n(ii) If N \u2265 exp(2C\u0394\u03b4\u221213n), then any S \u2286 {1,. . . ,N}2n+3 with cardinality |S| \u2265 \u03b4N2n+3 will necessarily contain an isometric copy of \u03bb\u0394 for some \u03bb \u2208 \u221a N\nwith 1 \u2264 \u03bb \u2264 N .\nNote that the fact that S \u2286 Zn could fall entirely into a fixed congruence class of some integer 1 \u2264 q \u2264 \u03b4\u22121/n ensures that the q0 that appears in Theorems A\u2032 and B\u2032 must be divisible by the least common multiple of all integers 1 \u2264 q \u2264 \u03b4\u22121/n. Indeed if S = (qZ)n with 1 \u2264 q \u2264 \u03b4\u22121/n then S has upper Banach density at least \u03b4, however the distance between any two points x, y \u2208 S is of the form |x\u2212 y| = q\u03bb for some \u03bb \u2208 \u221a N.\nHowever, in both Theorems A\u2032 and Part (i) of Theorem B\u2032, one can take q0 = 1 if the sets S are assumed to be suitably uniformly distributed on congruence classes\nof small modulus. This leads via an easy density increment strategy to short new proofs, see [14] for Theorem A\u2032 and Section 8 for Part (i) of Theorem B\u2032.\nThe original argument in [17] deduced Theorem B\u2032 from the following discrete analogue of Proposition C.\nProposition C\u2032 (Magyar [17]). Let \u0394 \u2286 Z2n+3 be a non-degenerate simplex of n points.\nFor any 0 < \u03b4 \u2264 1 there exist constants J = O\u0394(\u03b4\u22123n) and q0 = O(exp(C\u0394\u03b4\n\u221213n)) such that if N \u2265 \u03bb1 \u2265 \u00b7 \u00b7 \u00b7 \u2265 \u03bbJ \u2265 1 is any lacunary sequence in q0 \u221a N and S \u2286 {1, . . . , N}2n+3 with cardinality |S| \u2265 \u03b4N2n+3, then S will necessarily contain an isometric copy of \u03bbj\u0394 for some 1 \u2264 j \u2264 J . To see that Proposition C\u2032implies Theorem B\u2032 notice that if Part (i) of Theorem B\u2032 were not to hold for some set S \u2286 Z2n+3 of upper Banach density \u03b4\u2217(S) > \u03b4 > 0 with q0 from Proposition C\n\u2032, then there must exist a lacunary sequence \u03bb1 \u2265 \u00b7 \u00b7 \u00b7 \u2265 \u03bbJ \u2265 1 in q0 \u221a N, with J the constant from Proposition C\u2032, such that S does not contain an isometric copy of \u03bbj\u0394 for any 1 \u2264 j \u2264 J . Since we can find a sufficiently large cube Q with integer side length N that is divisible by q0 and greater than \u03bb1 such that |S \u2229Q| \u2265 \u03b4|Q|, this contradicts Proposition C\u2032. Part (ii) of Theorem B\u2032 follows from Proposition C\u2032 by taking \u03bbj = 2 J\u2212jq0.\n1.4. New results II: Rectangles and products of simplices in subsets of Zn. We will also establish the following discrete analogues of Theorem 1.1 and 1.2.\nTheorem 1.3. Let 0 < \u03b4 \u2264 1 and R be 2d points forming the vertices of a ddimensional rectangle in Z5d.\n(i) If S \u2286 Z5d has upper Banach density at least \u03b4, then there exist integers q0 = q0(\u03b4,R) and \u03bb0 = \u03bb0(S,R) such that S contains an isometric copy of q0\u03bbR for all \u03bb \u2208 \u221a N with \u03bb \u2265 \u03bb0.\n(ii) There exists a constant N(\u03b4,R) such that if N \u2265 N(\u03b4,R), then any S \u2286 {1, . . . , N}5d with cardinality |S| \u2265 \u03b4N5d will necessarily contain an isometric copy of \u03bbR for some \u03bb \u2208 \u221a N with 1 \u2264 \u03bb \u2264 N .\nIf R has side lengths given by t1, . . . , td, then each of the isometric copies in (i) and (ii) above can be realized in the form {x11, x12}\u00d7\u00b7 \u00b7 \u00b7\u00d7{xd1, xd2} \u2286 Z5\u00d7\u00b7 \u00b7 \u00b7\u00d7Z5 with each |xj2 \u2212 xj1| = q0\u03bbtj and \u03bbtj, respectively.\nOur arguments again work for more general patterns where d-dimensional rectangles are replaced with direct products of non-degenerate simplices.\nTheorem 1.4. Let 0 < \u03b4 \u2264 1 and \u0394 = \u03941 \u00d7 \u00b7 \u00b7 \u00b7 \u00d7 \u0394d \u2286 Zn, where Zn = Z2n1+3 \u00d7 \u00b7 \u00b7 \u00b7 \u00d7 Z2nd+3 and each \u0394i \u2286 Z2ni+3 is a non-degenerate simplex of ni points.\n(i) If S \u2286 Zn has upper Banach density at least \u03b4, then there exist integers q0 = q0(\u03b4,\u0394) and \u03bb0 = \u03bb0(S,\u0394) such that S contains an isometric copy of\nq0\u03bb\u0394 for all \u03bb \u2208 \u221a N with \u03bb \u2265 \u03bb0.\n(ii) There exists a constant N(\u03b4,\u0394) such that if N \u2265 N(\u03b4,\u0394), then any S \u2286 {1, . . . , N}n with cardinality |S| \u2265 \u03b4Nn will necessarily contain an isometric copy of \u03bb\u0394 for some \u03bb \u2208 \u221a N with 1 \u2264 \u03bb \u2264 N .\nMoreover, each of the isometric copies in (i) and (ii) above can be realized in the special form \u0394\u20321 \u00d7 \u00b7 \u00b7 \u00b7 \u00d7\u0394\u2032d with each \u0394\u2032i \u2286 Z2ni+3 an isometric copy of q0\u03bb\u0394j and \u03bb\u0394j, respectively.\nQuantitative Remark. A careful analysis of our proof reveals that the constant q0(\u03b4,\u0394) (and consequently also N(\u03b4,\u0394)) can be taken less than Wd(C \u2032 \u0394\u03b4\n\u221213n1\u00b7\u00b7\u00b7nd) where Wk(m) is a tower of exponentials defined by W1(m) = exp(m) and Wk+1(m) = exp(Wk(m)) for k \u2265 1.\n1.5. Notations and outline. We will consider the parameters d, n1, . . . , nd fixed and will not indicate the dependence on them. Thus we will write f = O(g) if |f | \u2264 C(n1, . . . , nd)g. If the implicit constants in our estimates depend on additional parameters \u03b5, \u03b4, K, . . . then we will write f = O\u03b5,\u03b4,K,...(g). We will use the notation f g to indicate that |f | \u2264 c g for some constant c > 0 sufficiently small for our purposes.\nGiven an \u03b5 > 0 and a (finite or infinite) sequence L0 \u2265 L1 \u2265 \u00b7 \u00b7 \u00b7 > 0, we will say that the sequence is \u03b5-admissible if Lj/Lj+1 \u2208 N and Lj+1 \u03b52Lj for all j \u2265 1. Moreover, if q \u2208 N is given and Lj \u2208 N for all 1 \u2264 j \u2264 J , then we will call the sequence L0 \u2265 L1 \u2265 \u00b7 \u00b7 \u00b7 \u2265 LJ (\u03b5, q)-admissible if in addition LJ/q \u2208 N. Such sequences of scales will often appear in our statements both in the continuous and the discrete case.\nOur proofs are based on a weak hypergraph regularity lemma and an associated counting lemma developed in the context of Euclidean spaces and the integer lattice. In Section 2 we introduce our approach in the model case of finite fields and prove an analogue of Theorem 1.1 in this setting. In Section 3 we review Theorem 1.2 for a single simplex and ultimately establish the base case of our general inductive approach to Theorem 1.2. In Section 4 we address Theorem 1.2 for the direct product of two simplices, this provides a new proof (and strengthening) of the main result of [12] and serves as a gentle preparation for the more complicated general case which we present in the Section 5. The proof of Theorem 1.4 is outlined in Sections 6 and 7, while a short direct proof of Part (i) of Theorem B\u2032 is presented in Section 8."
        },
        {
            "heading": "2. Model case: Vector spaces over finite fields",
            "text": "In this section we will illustrate our general method by giving a complete proof of Theorem 1.1 in the model setting of Fnq where Fq denotes the finite field of q elements. We do this as the notation and arguments are more transparent in this setting yet many of the main ideas are still present.\nWe say that two vectors u, v \u2208 Fnq are orthogonal, if x\u00b7y = 0, where \u201c\u00b7\u201d stands for the usual dot product. A rectangle in Fnq is then a set R = {x1, y1}\u00d7 \u00b7 \u00b7 \u00b7\u00d7{xn, yn} with side vectors yi \u2212 xi being pairwise orthogonal.\nThe finite field analogue of Theorem 1.1 is the following\nProposition 2.1. For any 0 < \u03b4 \u2264 1 there exists an integer q0 = q0(\u03b4) with the following property:\nIf q \u2265 q0 and t1, . . . , td \u2208 F\u2217q, then any S \u2286 F2dq with |S| \u2265 \u03b4 q2d will contain points\n{x11, x12} \u00d7 \u00b7 \u00b7 \u00b7 \u00d7 {xd1, xd2} \u2286 V1 \u00d7 \u00b7 \u00b7 \u00b7 \u00d7 Vd with |xj2 \u2212 xj1|2 = tj for 1 \u2264 j \u2264 d\nwhere we have written F2dq = V1 \u00d7 \u00b7 \u00b7 \u00b7 \u00d7 Vd with Vj F2q pairwise orthogonal coordinate subspaces.\n2.1. Overview of the proof of Proposition 2.1. Write F2dq = V1\u00d7 . . .\u00d7Vd with Vj F2q pairwise orthogonal coordinate subspaces. For any t := (t1, . . . , td) \u2208 F\u2217q and S \u2286 F2dq we define\nNt(1S) := Ex1\u2208V 21 ,...,xd\u2208V 2d \u220f\n( 1,..., d)\u2208{1,2}d 1S(x1 1 , . . . , xd d) d\u220f j=1 \u03c3tj (xj2 \u2212 xj1)\nwhere we used the shorthand notation xj := (xj1, xj2) for each 1 \u2264 j \u2264 d and the averaging notation:\nEx\u2208Af(x) := 1 |A| \u2211 x\u2208A f(x)\nfor a finite set A = \u2205. We have also used the notation\n\u03c3t(x) = { q if |x|2 = t 0 otherwise\nfor each t \u2208 F\u2217q . Note that the function \u03c3t may be viewed as the discrete analogue of the normalized surface area measure on the sphere of radius \u221a t. It is well-known,\nsee [10], that\nEx\u2208F2q \u03c3t(x) = 1 +O(q \u22121/2)\nand for all \u03be = 0 one has\n\u03c3\u0302t(\u03be) := Ex\u2208F2q \u03c3t(x) e 2\u03c0ix\u00b7\u03beq = O(q\u22121/2).\nNote that if Nt(1S) > 0, then this implies that S contains a rectangle of the form {x11, x12} \u00d7 \u00b7 \u00b7 \u00b7 \u00d7 {xd1, xd2} with xj1, xj2 \u2208 Vj and |xj2 \u2212 xj1|2 = tj for 1 \u2264 j \u2264 d.\nOur approach to Proposition 2.1 in fact establishes the following quantitatively stronger result.\nProposition 2.2. For any 0 < \u03b5 \u2264 1 there exists an integer q0 = q0(\u03b5) with the following property:\nIf q \u2265 q0, then for any S \u2286 F2dq and t1, . . . , td \u2208 F\u2217q one has\nNt(1S) > ( |S| q2d )2d \u2212 \u03b5,\nwhere we have written F2dq = V1 \u00d7 . . . \u00d7 Vd with Vj F2q pairwise orthogonal coordinate subspaces.\nA crucial observation in the proof of Proposition 2.2 is that the averages Nt(1S) can be compared to ones which can be easily estimated from below. We define, for any S \u2286 F2dq , the (unrestricted) count\nM(1S) := Ex1\u2208V 21 ,...,xd\u2208V 2d \u220f\n( 1,..., d)\u2208{1,2}d 1S(x1 1 , . . . , xd d).\nIt is easy to see, by carefully applying Cauchy-Schwarz d times to Ex11\u2208V1,...,xd1\u2208Vd1S(x11, . . . , xd1), that\n(2.1) M(1S) \u2265 ( |S| q2d )2d .\nOur approach to Proposition 2.2 therefore reduces to establishing that for any \u03b5 > 0 one has\n(2.2) Nt(1S) = M(1S) +O(\u03b5) +O\u03b5(q\u22121/2). The validity of (2.2) will follow immediately from the d = k case of Proposition\n2.3. However, before we can state this counting lemma we need to introduce some further notation from the theory of hypergraphs, notation that we shall ultimately make use of throughout the paper.\n2.2. Hypergraph notation and a counting lemma. In order to streamline our notation we will make use the language of hypergraphs. For J := {1, . . . , d} and 1 \u2264 k \u2264 d, we let Hd,k = {e \u2286 J ; |e| = k} denote the full k-regular hypergraph on the vertex set J . For K := {jl; j \u2208 J, l \u2208 {1, 2}} we define the projection \u03c0 : K \u2192 J as \u03c0(jl) := j and use this in turn to define the hypergraph bundle\nH2d,k := {e \u2286 K; |e| = |\u03c0(e)| = k}\nusing the shorthand notation 2 = (2, 2, . . . , 2) to indicate that |\u03c0\u22121(j)| = 2 for all j \u2208 J .\nNotice when k = d then Hd,d consists of one element, the set e = {1, . . . , d}, and\nH2d,d = { {1l1, . . . , dld}; (l1, . . . , ld) \u2208 {1, 2}d}. Let V := F2dq and V = V1\u00d7 . . .\u00d7Vd with Vj F2q pairwise orthogonal coordinate subspaces. For a given x = (x11, x12, . . . , xd1, xd2) \u2208 V 2 with xj1, xj2 \u2208 Vj and a given edge e = {1l1, . . . , dld}, we write\nxe := (x1l1 , . . . , xdld).\nNote that the map x \u2192 xe defines a projection \u03c0e : V 2 \u2192 V . With this notation, we can clearly now write\nNt(1S) = Ex\u2208V 2 \u220f\ne\u2208H2d,d\n1S(xe) d\u220f j=1 \u03c3tj (xj2 \u2212 xj1)\nM(1S) = Ex\u2208V 2 \u220f\ne\u2208H2d,d\n1S(xe).\nNow for any 1 \u2264 k \u2264 d and any edge e\u2032 \u2208 Hd,k, i.e. e\u2032 \u2286 {1, . . . , d}, |e\u2032| = k, we let Ve\u2032 := \u220f j\u2208e\u2032 Vj . For every x \u2208 V 2 and e \u2208 H 2 d,k, we define xe := \u03c0e(x) where \u03c0e : V 2 \u2192 V\u03c0(e) is the natural projection map.\nOur key counting lemma, Proposition 2.3, which we will establish by induction on 1 \u2264 k \u2264 d below, is then the statement that given a family of functions fe : V\u03c0(e) \u2192 [\u22121, 1], e \u2208 H2d,k, the averages (generalizing those discussed above) which are defined by\nNt(fe; e \u2208 H2d,k) := Ex\u2208V 2 \u220f\ne\u2208H2d,k\nfe(xe) d\u220f j=1 \u03c3tj (xj2 \u2212 xj1)(2.3)\nM(fe; e \u2208 H2d,k) := Ex\u2208V 2 \u220f\ne\u2208H2d,k\nfe(xe)(2.4)\nare approximately equal. Specifically, one has\nProposition 2.3 (Counting lemma). Let 1 \u2264 k \u2264 d and 0 < \u03b5 \u2264 1. For any collection of functions\nfe : V\u03c0(e) \u2192 [\u22121, 1] with e \u2208 H2d,k one has\n(2.5) Nt(fe; e \u2208 H2d,k) = M(fe; e \u2208 H 2 d,k) +O(\u03b5) +O\u03b5(q \u22121/2).\nIf we apply this proposition with d = k and fe = 1S for all e \u2208 H2d,d, then Theorem 2.1 clearly follows given the lower bound (2.1).\n2.3. Proof of Proposition 2.3. We will establish Proposition 2.3 by inducting on 1 \u2264 k \u2264 d.\nFor k = 1 the result follows from the basic observation that if f1, f2 : F 2 q \u2192 [\u22121, 1]\nand let t \u2208 F\u2217q , then Ex1,x2\u2208F2q f1(x1)f2(x2) \u03c3t(x2 \u2212 x1) = \u2211 \u03be\u2208F2q f\u03021(\u03be)f\u03022(\u03be)\u03c3\u0302t(\u03be)\n= f\u03021(0)f\u03022(0) +O(q \u22121/2)(2.6)\n= Ex1,x2\u2208F2q f1(x1)f2(x2) +O(q \u22121/2)\nby the properties of the function \u03c3\u0302 given above.\nTo see how this implies Proposition 2.3 for k = 1 we note that since H2d,1 = {jl : 1 \u2264 j \u2264 d, 1 \u2264 l \u2264 2} it follows that\nNt(fe; e \u2208 H2d,1) = d\u220f\nj=1\nExj1,xj2\u2208F2q fj1(xj1)fj2(xj2) \u03c3t(xj2 \u2212 xj1)\n= d\u220f j=1 Exj1,xj2\u2208F2q fj1(xj1)fj2(xj2) +O(q \u22121/2)\n= M(fe; e \u2208 H2d,1) +O(q\u22121/2). The induction step has two main ingredients, the first is an estimate of the type\nwhich is often referred to as a generalized von-Neumann inequality, namely\nLemma 2.1. Let 1 \u2264 k \u2264 d. For any collection of functions fe : V\u03c0(e) \u2192 [\u22121, 1] with e \u2208 H2d,k one has\n(2.7) Nt(fe; e \u2208 H2d,k) \u2264 min e\u2208H2d,k \u2016fe\u2016 (V\u03c0(e)) +O(q \u22121/2),\nwhere for any e \u2208 H2d,k and f : V\u03c0(e) \u2192 [\u22121, 1] we define (2.8) \u2016f\u20162k (V\u03c0(e)) := Ex\u2208V 2\u03c0(e) \u220f\ne\u2208H2d,k\nf(xe).\nThe corresponding inequality for the multi-linear expression M(fe; e \u2208 H2d,k), namely the fact that\nM(fe; e \u2208 H2d,k) \u2264 \u220f\ne\u2208H2d,k\n\u2016fe\u2016 (V\u03c0(e)) \u2264 min e\u2208H2d,k \u2016fe\u2016 (V\u03c0(e))\nis well-known and is referred to as the Gowers-Cauchy-Schwarz inequality [8].\nThe second and main ingredient is an approximate decomposition of a graph to simpler ones, and is essentially the so-called weak (hypergraph) regularity lemma of Frieze and Kannan [7]. We choose to state this from a somewhat more abstract/probabilistic point of view, a perspective that will be particularly helpful when we consider our general results in the continuous and discrete settings.\nWe will first introduce this in the case d = 2. A bipartite graph with (finite) vertex sets V1, V2 is a set S \u2286 V1\u00d7V2 and a function f : V1\u00d7V2 \u2192 R may be viewed as weighted bipartite graph with weights f(x1, x2) on the edges (x1, x2). If P1 and P2 are partitions of V1 and V2 respectively then P = P1 \u00d7P2 is a partition V1 \u00d7V2 and we let E(f |P) denote the function that is constant and equal to Ex\u2208Af(x) on each atom A = A1\u00d7A2 of P. The weak regularity lemma states that for any \u03b5 > 0 and for any weighted graph f : V1 \u00d7 V2 \u2192 [\u22121, 1] there exist partitions Pi of Vi with |Pi| \u2264 2O(\u03b5 \u22122) for i = 1, 2, so that\n(2.9) |Ex1\u2208V1Ex2\u2208V2(f \u2212 E(f |P))(x1, x2) 1U1(x1)1U2(x2)| \u2264 \u03b5\nfor all U1 \u2286 V1 and U2 \u2286 V2. Informally this means that the graph f can be approximated with precision \u03b5 with the \u201clow complexity\u201d graph E(f,P). If we consider the \u03c3-algebras Bi generated by the partitions Pi and the \u03c3-algebra B = B1\u2228 B2 generated by P1\u00d7P2 then we have E(f |B), the so-called conditional expectation function of f . Moreover it is easy to see, using Cauchy-Schwarz, that estimate (2.9) follows from\n(2.10) \u2016f \u2212 E(f |B1 \u2228 B2)\u2016 (V1\u00d7V2) \u2264 \u03b5.\nWith this more probabilistic point of view the weak regularity lemma says that the function f can be approximated with precision \u03b5 by a low complexity function E(f |B1 \u2228 B2), corresponding to \u03c3-algebras Bi on Vi generated by O(\u03b5\u22122) sets. This formulation is also referred to as a Koopman von Neumann type decomposition, see Corollary 6.3 in [23].\nWe will need a natural extension to k-regular hypergraphs. See [8, 22], and also [2] for extension to sparse hypergraphs. Given an edge e\u2032 \u2208 Hd,k of k elements we define its boundary \u2202e\u2032 := {f\u2032 \u2208 Hd,k\u22121; f\u2032 \u2286 e\u2032}. For each f\u2032 = e\u2032\\{j} \u2208 \u2202e\u2032 let B\u2032f be a \u03c3-algebra on Vf\u2032 := \u220f j\u2208f\u2032 Vj and B\u0304f\u2032 := {U \u00d7 Vj ; U \u2208 Bf\u2032} denote\nits pull-back over the space Ve\u2032 . The \u03c3-algebra B = \u2228\nf\u2032\u2208\u2202e\u2032 Bf\u2032 is the smallest \u03c3-algebra on \u2202e\u2032 containing B\u0304f\u2032 for all f\u2032 \u2208 \u2202e\u2032. Note that the atoms of B are of the form A = \u22c2 f\u2032\u2208\u2202e\u2032 Af\u2032 where Af\u2032 is an atom of B\u0304f\u2032 . We say that the complexity of a \u03c3-algebra Bf\u2032 is at most m, and write complex(Bf\u2032) \u2264 m, if it is generated by m sets.\nLemma 2.2 (Weak hypergraph regularity lemma). Let 1 \u2264 k \u2264 d and fe : V\u03c0(e) \u2192 [\u22121, 1] be a given function for each e \u2208 H2d,k. For any \u03b5 > 0 there exists \u03c3-algebras Bf\u2032 on Vf\u2032 for each f\u2032 \u2208 Hd,k\u22121 such that\n(2.11) complex(Bf\u2032) = O(\u03b5\u22122 k+1 )\nand (2.12) \u2016fe \u2212 E(fe| \u2228\nf\u2032\u2208\u2202\u03c0(e) Bf\u2032)\u2016 (V\u03c0(e)) \u2264 \u03b5 for all e \u2208 H 2 d,k.\nThe proof of Lemmas 2.1 and 2.2 are presented in Section 2.4. We close this subsection by demonstrating how these lemmas can be combined to establish Proposition 2.3.\nProof of Proposition 2.3. Let \u03b5 > 0, 2 \u2264 k \u2264 d and assume that the lemma holds for k\u2212 1. It follows from Lemma 2.2 that there exists \u03c3-algebras Bf\u2032 of complexity O(\u03b5\u22122 k+1\n) on Vf\u2032 for each f \u2032 \u2208 Hd,k\u22121 for which (2.12) holds for all e \u2208 H2d,k. For each e \u2208 H2d,k we let f\u0304e := E(fe| \u2228\nf\u2032\u2208\u2202\u03c0(e) Bf\u2032) and write fe = f\u0304e + he. By Lemma 2.1 and multi-linearity we have that\n(2.13) Nt(fe; e \u2208 H2d,k) = Nt(f\u0304e; e \u2208 H 2 d,k) +O(\u03b5) +O(q \u22121/2)\nand also by the Gowers-Cauchy-Schwarz inequality\n(2.14) M(fe; e \u2208 H2d,k) = M(f\u0304e; e \u2208 H 2 d,k) +O(\u03b5).\nThe conditional expectation functions f\u0304e are linear combinations of the indicator functions 1Ae of the atoms Ae of the \u03c3-algebras Be := \u2228 f\u2032\u2208\u2202\u03c0(e) Bf\u2032 . Since the number of terms in this linear combination is at most 2C\u03b5 \u22122k+1 , with coefficients at most 1 in modulus, plugging these into the multi-linear expressionsNt(f\u0304e; e \u2208 H2d,k) and M(f\u0304e; e \u2208 H2d,k) one obtains a linear combination of expressions of the form Nt(1Ae ; e \u2208 H 2 d,k) and M(1Ae ; e \u2208 H 2 d,k) respectively with each Ae being an atoms of Be for all e \u2208 H2d,k. The key observation is that these expressions are at level k \u2212 1 instead of k.\nIndeed, 1Ae = \u220f f\u2032\u2208\u2202\u03c0(e) 1Aef\u2032 where Aef\u2032 = A \u2032 ef\u2032 \u00d7 Vj , with A\u2032ef\u2032 being an atom of Bf\u2032 when f\u2032 = \u03c0(e)\\{j}. If e = (j1l1, . . . , jl, . . . , jklk), let pf\u2032(e) := (j1l1, . . . , jklk) \u2208 H2d,k\u22121, obtained from e by removing the jl-entry. Then we have 1Aef\u2032 (xe) = 1A\u2032ef\u2032 (xp\u2032f(e)) since xjl \u2208 Vj , and hence\n1Ae(xe) = \u220f\nf\u2032\u2208\u2202\u03c0(e) 1A\u2032 ef\u2032 (xp\u2032f(e)).\nIt therefore follows that\nNt(1Ae ; e \u2208 H 2 d,k) = Ex\u2208V 2 \u220f e\u2208H2d,k \u220f f\u2032\u2208\u2202\u03c0(e) 1A\u2032 ef\u2032 (xpf\u2032 (e)) d\u220f j=1 \u03c3tj (xj2 \u2212 xj1)\n= Ex\u2208V 2 \u220f\nf\u2208H2d,k\u22121 \u220f e\u2208H2d,k, f\n\u2032\u2208\u2202\u03c0(e) pf\u2032 (e)=f\n1A\u2032 ef\u2032 (xpf\u2032 (e))\n\ufe38 \ufe37\ufe37 \ufe38 =:gf\nd\u220f j=1 \u03c3tj (xj2 \u2212 xj1)\n= Nt(gf; f \u2208 H2d,k\u22121)\nand similarly that\nM(1Ae ; e \u2208 H 2 d,k) = M(gf; f \u2208 H 2 d,k\u22121).\nIt then follows from the induction hypotheses that\nNt(1Ae ; e \u2208 H 2 d,k) = M(1Ae ; e \u2208 H 2 d,k) +O(\u03b51) +O\u03b51(q \u22121/2)\nfor any \u03b51 > 0. If we choose \u03b51 := 2 \u2212C1 \u03b5\u22122\nk+1\n, with C1 1 sufficiently large, then \u03b51 2 C\u03b5\u22122 k+1 = O(\u03b5) and it follows that\nNt(f\u0304e; e \u2208 H2d,k) = M(f\u0304e; e \u2208 H 2 d,k) +O(\u03b5) +O\u03b5(q \u22121/2).\nThis, together with (2.13) and (2.14), establishes that (2.5) hold for d = k as required.\n2.4. Proof of Lemmas 2.1 and 2.2.\nProof of Lemma 2.1. We start by observing the following consequence of (2.6), namely that (2.15) \u2223\u2223\u2223Ex1,x2\u2208F2qf1(x1)f2(x2)\u03c3t(x2 \u2212 x1)\u2223\u2223\u22232 \u2264 Ex1,x2\u2208F2qf1(x1)f1(x2) +O(q\u22121/2)\nfor any f1, f2 : F 2 q \u2192 [\u22121, 1] and t \u2208 F\u2217q .\nNow, fix an edge, say e0 = (11, 21, . . . , k1). Partition the edges e \u2208 H2d,k into three groups: the first group consisting of edges e for which 1 /\u2208 \u03c0(e), the second where 11 \u2208 e and write e = (11, e\u2032) with e\u2032 \u2208 H2d\u22121,k\u22121 and the third when 12 \u2208 e, using the notation H2d\u22121,k\u22121 := {(j2l2, . . . , jklk)}. Accordingly we can write\nNt(fe; e \u2208 H2d,k)(2.16) = Ex\u2208V 2 \u220f\n1/\u2208\u03c0(e) fe(xe) \u220f e\u2032\u2208H2d\u22121,k\u22121 f(11,e\u2032)(x11, xe\u2032)\n\u00d7 \u220f\ne\u2032\u2208H2d\u22121,k\u22121\nf(12,e\u2032)(x12, xe\u2032) d\u220f\nj=1\n\u03c3tj (xj2 \u2212 xj1).\nIf for given x \u2208 V1 and x\u2032 = (x21, x22, . . . , xd1, xd2) \u2208 V 22 \u00d7 . . .\u00d7 V 2d we define\ng1(x, x \u2032) := \u220f e\u2032\u2208H2d\u22121,k\u22121 f(11,e\u2032)(x, xe\u2032)\nand g2(x, x \u2032) := \u220f e\u2032\u2208H2d\u22121,k\u22121 f(12,e\u2032)(x, xe\u2032)\nthen we can write\nNt(fe; e \u2208 H2d,k) = Ex21,x22,...,xd1,xd2 \u220f\n1/\u2208\u03c0(e) fe(xe) d\u220f j=2 \u03c3tj (xj2 \u2212 xj1)(2.17)\n\u00d7 Ex11,x12 g1(x11, x\u2032)g2(x12, x\u2032) \u03c3t1(x12 \u2212 x11).\nBy (2.15) we can estimate the inner sum in (2.17) by the square root of\nEx11,x12 g1(x11, x \u2032)g1(x12, x \u2032) +O(q\u22121/2).\nThus by Cauchy-Schwarz, and the fact that fe : V\u03c0(e) \u2192 [\u22121, 1] for all e \u2208 H2d,k, we can conclude that\nNt(fe; e \u2208 H2d,k)2\n(2.18)\n\u2264 Ex11,x12,...,xd1,xd2 \u220f\ne\u2032\u2208H2d\u22121,k\u22121\nf(11,e\u2032)(x11, xe\u2032)f(11,e\u2032)(x12, xe\u2032) d\u220f\nj=2\n\u03c3tj (xj2 \u2212 xj2).\nThe expression on the right hand side of the inequality above is similar to that in (2.16) except for the following changes. The functions fe for 1 /\u2208 e are eliminated i.e. replaced by 1, as well as the factor \u03c3t1 . The functions f(12,e\u2032) are replaced by f(11,e\u2032) for all e \u2032 \u2208 H2d\u22121,k\u22121. Repeating the same procedure for j = 2, . . . , k one eliminates all the factors \u03c3tj for 1 \u2264 j \u2264 k, moreover all the functions fe for edges e such that j /\u2208 \u03c0(e) for some 1 \u2264 j \u2264 k, which leaves only the edges e so that \u03c0(e) = (1, 2, . . . , k), moreover for such edges the functions fe are eventually replaced by fe0 = f11,21,...,k1. The factors \u03c3tj (xj2 \u2212 xj1) are not changed for j > k however as the function fe0 does not depend on the variables xjl for j > k, averaging over these variables gives rise to a factor of 1 + O(q\u22121/2). Thus one obtains the following final estimate\nNt(fe; e \u2208 H2d,k)2 k \u2264 Ex11,x12,...,xk1,xk2 \u220f \u03c0(e)=(1,...,k) fe0(xe) +O(q \u22121/2)(2.19)\n= \u2016fe0\u20162 k (V\u03c0(e0)) +O(q \u22121/2).\nThis proves the lemma, as it is clear that the above procedure can be applied to any edge in place of e0 = (11, 21, . . . , k1).\nProof of Lemma 2.2. For a function fe : V\u03c0(e) \u2192 [\u22121, 1] and a \u03c3-algebra B\u03c0(e) on V\u03c0(e) define the energy of fe with respect to B\u03c0(e) as\nE(fe,B\u03c0(e)) := \u2016E(fe|B\u03c0(e))\u201622 = Ex\u2208V\u03c0(e) |E(fe|B\u03c0(e))(x)|2,\nand for a family of functions fe and \u03c3-algebras B\u03c0(e), e \u2208 H2d,k its total energy as\nE(fe,B\u03c0(e); e \u2208 H2d,k) := \u2211\ne\u2208H2d,k\nE(fe,B\u03c0(e)).\nWe will show that if (2.12) does not hold for a family of \u03c3-algebras B\u03c0(e) =\u2228 f\u2032\u2208\u2202\u03c0(e) Bf\u2032 , then the \u03c3-algebras Bf\u2032 can be refined so that the total energy of the system increases by a quantity depending only on \u03b5. Since the functions fe are bounded the total energy of the system is O(1), the energy increment process must stop in O\u03b5(1) steps, and (2.12) must hold. The idea of this procedure appears already in the proof of Szemere\u0301di\u2019s regularity lemma [20], and has been used since in various places [7, 8, 22].\nInitially set Bf\u2032 := {\u2205, Vf\u2032} and hence B\u03c0(e) = {\u2205, V\u03c0(e)} to be the trivial \u03c3algebras. Assume that in general (2.12) does not hold for a family of \u03c3-algebras Bf\u2032 , with f\u2032 \u2208 Hd,k\u22121. Then there exists an edge e \u2208 H2d,k so that \u2016ge\u2016 (V\u03c0(e)) \u2265 \u03b5, with ge := fe \u2212 E(fe|B\u03c0(e)). Let e = (11, . . . , k1) for simplicity of notation, hence\n\u03c0(e) = (1, . . . , k). Then, with notation x\u2032 = (x12, . . . , xk2), one has\n\u03b52 k \u2264 \u2016ge\u20162 k\n(V\u03c0(e)) = Ex11,x12,...,xk1,xk2 \u220f\nl1,...,lk=1,2\nge(x1l1 , . . . , xklk)\n\u2264 Ex12,...,xk2 \u2223\u2223\u2223Ex11,...,xk1ge(x11, . . . , xk1) k\u220f\nj=1\nhj,x\u2032(x11, . . . , xj\u22121 1, xj+11, . . . , xk1) \u2223\u2223\u2223\nfor some functions hj,x\u2032 that are bounded by 1 in magnitude. Indeed if and edge e = (11, . . . , k1) then xe does not depend at least one of the variables xj1. Thus there must be an x\u2032 for which the inner sum in the above expression is at least \u03b52 k\n. Fix such an x\u2032. Decomposing the functions hj,x\u2032 into their positive and negative parts and then writing them as an average of indicator functions, one obtains that there sets Bj \u2286 V\u03c0(e)\\{j} such that\n\u2223\u2223\u2223Ex11,...,xk1ge(x11, . . . , xk1) k\u220f j=1 1Bj (x11, . . . , xj\u22121 1, xj+1 1, . . . , xk1) \u2223\u2223\u2223 \u2265 2\u2212k \u03b52k\nwhich can be written more succinctly, using the inner product notation, as (2.20) \u2223\u2223\u2223\u3008fe \u2212 E(fe|B\u03c0(e)), k\u220f\nj=1\n1Bj \u3009 \u2223\u2223\u2223 \u2265 2\u2212k \u03b52k .\nFor f\u2032 = \u2202\u03c0(e)\\{j} let B\u2032f\u2032 be the \u03c3-algebra generated by Bf\u2032 and the set Bj and let B\u2032\u03c0(e) := \u2228 f\u2032\u2208\u2202\u03c0(e) B\u2032f\u2032 . Since the functions 1Bj are measurable with respect to the \u03c3-algebra B\u2032\u03c0(e) for all 1 \u2264 j \u2264 k, we have that (2.21) \u3008fe \u2212 E(fe|B\u2032\u03c0(e)), k\u220f\nj=1\n1Bj \u3009 = 0\nand hence, by Cauchy-Schwarz, that (2.22)\n\u2016E(fe|B\u2032\u03c0(e))\u2212 E(fe|B\u03c0(e))\u201622 = \u2016E(fe|B\u2032\u03c0(e))\u201622 \u2212 \u2016E(fe|B\u03c0(e))\u201622 \u2265 2\u22122k \u03b52 k+1 .\nNote that the first equality above follows from the fact that conditional expectation function E(f |B) is the orthogonal projection of f to the subspace of B-measurable functions in L2. This also implies that energy of a function is always increasing when the underlying \u03c3-algebra is refined, and (2.22) tells us that the energy of fe is increased by at least ck \u03b5 2k+1 .\nFor f\u2032 /\u2208 \u2202\u03c0(e) we set B\u2032f\u2032 := Bf\u2032 . Then the total energy of the family fe with respect to the system B\u2032\u03c0(e) = \u2228 f\u2032\u2208\u2202\u03c0(e) B\u2032f\u2032 , e \u2208 H 2 d,k is also increased by at least ck \u03b5 2k+1 . It is clear that the complexity of the \u03c3-algebras Bf\u2032 is increased by at most 1, hence, as explained above, the lemma follows by applying this energy increment process at most O(\u03b5\u22122 k+1 ) times.\n3. The base case of an inductive strategy to establish Theorem 1.2\nIn this section we will ultimately establish the base case of our more general inductive argument. We however start by giving a quick review of the proof of Theorem 1.2 when d = 1 (which contains both Theorem B and Corollary D as stated in Section 1.1), namely the case of a single simplex. This was originally addressed in [1] and revisited in [12] and [13].\n3.1. A single simplex in Rn. Let Q \u2286 Rn be a fixed cube and let l(Q) denotes its side length.\nLet \u03940 = {v1 = 0, v2, . . . , vn} \u2286 Rn be a fixed non-degenerate simplex and define tkl := vk \u00b7 vl for 2 \u2264 k, l \u2264 n where \u201c\u00b7\u201d is the dot product on Rn. Given \u03bb > 0, a simplex \u0394 = {x1 = 0, x2, . . . , xn} \u2286 Rn is isometric to \u03bb\u03940 if and only if xk \u00b7 xl = \u03bb2tkl for all 2 \u2264 k, l \u2264 n. Thus the configuration space S\u03bb\u03940 of isometric copies of \u03bb\u03940 is a non-singular real variety given by the above equations. Let \u03c3\u03bb\u03940 be natural normalized surface area measure on S\u03bb\u03940 , described in [1], [12], and [13]. It is clear that the variable x1 can be replaced by any of the variables xi by redefining the constants tkl.\nFor any family of functions f1, . . . , fn : Q \u2192 [\u22121, 1] and 0 < \u03bb l(Q) we define the multi-linear expression\nN 1\u03bb\u03940,Q(f1, . . . , fn)(3.1)\n:=\nx1\u2208Q \u02c6 x2,...,xn f1(x1) . . . fn(xn) d\u03c3\u03bb\u03940(x2 \u2212 x1, . . . , xn \u2212 x1) dx1.\nWe note that all of our functions are 1-bounded and both integrals, in fact all integrals in this paper are normalized. Recall that we are using the normalized integral notation ffl A f := 1|A| \u00b4 A f . Since the normalized measure \u03c3\u03bb\u03940 is supported on S\u03bb\u03940 we will not indicate the support of the variables (x2, . . . , xn) explicitly. Note also that if S \u2286 Q is a measurable set and N 1\u03bb\u03940,Q(1S, . . . , 1S) > 0 then S must contain an isometric copy of \u03bb\u03940. Proposition 3.1 (with Q = [0, 1]n) is a quantitatively stronger version of Proposition C that appeared in Section 1.1 and hence immediately establishes Theorem 1.2 for d = 1.\nProposition 3.1. For any 0 < \u03b5 \u2264 1 there exists an integer J = O(\u03b5\u22122 log \u03b5\u22121) with the following property:\nGiven any lacunary sequence l(Q) \u2265 \u03bb1 \u2265 \u00b7 \u00b7 \u00b7 \u2265 \u03bbJ and S \u2286 Q, there is some 1 \u2264 j < J such that\n(3.2) N 1\u03bb\u03940,Q(1S, . . . , 1S) > ( |S| |Q| )n \u2212 \u03b5\nfor all \u03bb \u2208 [\u03bbj+1, \u03bbj ].\nOur approach to establishing Proposition 3.1 is to compare the above expressions to simpler ones for which it is easy to obtain lower bounds. Given a scale 0 < \u03bb l(Q) we define the multi-linear expression\n(3.3) M1\u03bb,Q(f1, . . . , fn) := t\u2208Q x1,x2,...,xn\u2208t+Q(\u03bb) f1(x1) . . . fn(xn) dx1 . . . dxn dt,\nwhere Q(\u03bb) = [\u2212\u03bb2 , \u03bb 2 ] n and t+Q(\u03bb) is the shift of the cube Q(\u03bb) by the vector t. Note that if S \u2286 Q is a set of measure |S| \u2265 \u03b4|Q| for some \u03b4 > 0, then for a given\n\u03b5 > 0, Ho\u0308lder implies\nM1\u03bb,Q(1S , . . . , 1S) = t\u2208Q ( x\u2208t+Q(\u03bb) 1S(x) dx )n dt(3.4)\n\u2265 (\nt\u2208Q x\u2208t+Q(\u03bb)\n1S(x) dx dt\n)n \u2265 \u03b4n \u2212O(\u03b5),\nfor all scales 0 < \u03bb \u03b5 l(Q). Recall that for any \u03b5 > 0 we call a sequence L1 \u2265 \u00b7 \u00b7 \u00b7 \u2265 LJ \u03b5-admissible if Lj/Lj+1 \u2208 N and Lj+1 \u03b52Lj for all 1 \u2264 j < J . Note that given any lacunary sequence l(Q) \u2265 \u03bb1 \u2265 \u00b7 \u00b7 \u00b7 \u2265 \u03bbJ\u2032 with J \u2032 (log \u03b5\u22121) J , one can always finds an \u03b5-admissible sequence of scales l(Q) \u2265 L1 \u2265 \u00b7 \u00b7 \u00b7 \u2265 LJ such that for each 1 \u2264 j < J the interval [Lj+1, Lj ] contains at least two consecutive elements from the original lacunary sequence.\nIn light of this observation, and the one above regarding a lower bound for M1\u03bb,Q(1S , . . . , 1S), our proof of Proposition 3.1 reduces to establishing the following \u201ccounting lemma\u201d.\nProposition 3.2. Let 0 < \u03b5 < 1. There exists an integer J1 = O(\u03b5 \u22122) such that for any \u03b5-admissible sequence of scales l(Q) \u2265 L1 \u2265 \u00b7 \u00b7 \u00b7 \u2265 LJ1 and S \u2286 Q there is some 1 \u2264 j < J1 such that\n(3.5) N 1\u03bb\u03940,Q(1S , . . . , 1S) = M1\u03bb,Q(1S , . . . , 1S) +O(\u03b5)\nfor all \u03bb \u2208 [Lj+1, Lj ].\nThere are two main ingredients in the proof of Proposition 3.2, this will be typical to all of our arguments. The first ingredient is a result which establishes that the multi-linear forms N 1\u03bb\u03940,Q(f1, . . . , fn) are controlled by an appropriate norm which measures the uniformity of distribution of functions f : Q \u2192 [\u22121, 1] with respect to particular scales L. This is analogous to estimates in additive combinatorics [8] which are often referred to as generalized von-Neumann inequalities.\nThe result below was proved in [12] for Q = [0, 1]n, however a simple scaling of the variables xi transfers the result to an arbitrary cube Q.\nLemma 3.1 (A generalized von-Neumann inequality [12]). Let \u03b5 > 0, 0 < \u03bb l(Q), and 0 < L \u03b56\u03bb.\nFor any collections of functions f1, . . . , fn : Q \u2192 [\u22121, 1] we have\n(3.6) |N 1\u03bb\u03940,Q(f1, . . . , fn)| \u2264 min i=1,...,n \u2016fi\u2016U1L(Q) +O(\u03b5),\nwhere for any f : Q \u2192 [\u22121, 1] we define\n(3.7) \u2016f\u20162U1L(Q) := t\u2208Q \u2223\u2223\u2223 x\u2208t+Q(L) f(x) dx \u2223\u2223\u22232dt\nwith t+Q(L) denoting the shift of the cube Q(L) = [\u2212L2 , L 2 ] n by the vector t.\nThe corresponding inequality for the multi-linear expression M1\u03bb,Q(f1, . . . , fn), namely the fact that\nM1\u03bb,Q(f1, . . . , fn) \u2264 min i=1,...,n \u2016fi\u2016U1L(Q) +O(\u03b5)\nwhenever 0 < L \u03b56\u03bb follows easily from Cauchy-Schwarz together with the simple observation that\n\u2016f\u2016U1L(Q) \u2264 \u2016f\u2016U1L\u2032 (Q) +O(\u03b5) whenever L\u2032 \u03b5L.\nThe second key ingredient, proved in [13] and generalized in Lemma 3.3, is a Koopman-von Neumann type decomposition of functions where the underlying \u03c3algebras are generated by cubes of a fixed length. To recall it, let Q \u2286 Rn be a cube, L > 0 be scale that divides l(Q), Q(L) = [\u2212L2 , L 2 ]\nn, and GL,Q denote the collection of cubes t+Q(L) partitioning the cube Q and \u0393L,Q denote the grids corresponding to the centers of the cubes. By a slightly abuse of notation we also write GL,Q for the \u03c3-algebra generated by the grid. Recall that the conditional expectation function E(f |GL,Q) is constant and equal to ffl A f on each cube A \u2208 GL,Q.\nLemma 3.2 (A Koopman-von Neumann type decomposition [13]). Let 0 < \u03b5 \u2264 1 and Q \u2286 Rn be a cube."
        },
        {
            "heading": "There exists an integer J\u03041 = O(\u03b5",
            "text": "\u22122) such that for any \u03b5-admissible sequence l(Q) \u2265 L1 \u2265 \u00b7 \u00b7 \u00b7 \u2265 LJ\u03041 and function f : Q \u2192 [\u22121, 1] there is some 1 \u2264 j < J\u03041 such that\n(3.8) \u2016f \u2212 E(f |GLj ,Q)\u2016U1Lj+1 (Q) \u2264 \u03b5.\nProof of Proposition 3.2. Let GLj ,Q be the grid obtained from Lemma 3.2 for the functions f = 1S for some fixed \u03b5 > 0. Let f\u0304 := E(f |GLj ,Q), then by (3.6) and multi-linearity, we have\nN 1\u03bb\u03940,Q(f, . . . , f) = N 1\u03bb\u03940,Q(f\u0304 , . . . , f\u0304) +O(\u03b5), and also\nM1\u03bb,Q(f, . . . , f) = M1\u03bb,Q(f\u0304 , . . . , f\u0304) +O(\u03b5) provided for \u03b5\u22126Lj+1 \u03bb. Thus in showing (3.5) one can replace the functions f with f\u0304 . If we make the additional assumption that \u03bb \u03b5Lj then it is easy to see, using the fact that the function f\u0304 is constant on the cubes Qt(Lj) \u2208 GLj ,Q, that\nN 1\u03bb\u03940,Q(f\u0304 , . . . , f\u0304) = M1\u03bb,Q(f\u0304 , . . . , f\u0304) +O(\u03b5).\nSince the condition \u03b5\u22126Lj+1 \u03bb \u03b5Lj can be replaced with Lj+1 \u03bb Lj if one passes to a subsequence of scales, for example L\u2032j = L5j , this completes the proof of Proposition 3.2.\n3.2. The base case of a general inductive strategy. In this section, as preparation to handle the case of products of simplices, we prove a parametric version of Proposition 3.2, namely Proposition 3.3, which will serve as the base case for later inductive arguments.\nLet Q = Q1 \u00d7 \u00b7 \u00b7 \u00b7 \u00d7Qd with Qi \u2286 Rni be cubes of equal side length l(Q). Let L be a scale dividing l(Q) and for each t = (t1, . . . , td) \u2208 \u0393L,Q let Qt(L) = t+Q(L) and Qti(L) = ti +Qi(L). Note that Qt(L) = Qt1(L)\u00d7 \u00b7 \u00b7 \u00b7 \u00d7Qtd(L). Here Q(L) = [\u2212L2 , L 2 ] n and Qi(L) = [\u2212L2 , L 2 ]\nni for each 1 \u2264 i \u2264 d. Let \u03940i = {vi1, . . . , vini} \u2286 Rni be a non-degenerate simplex for each 1 \u2264 i \u2264 d.\nProposition 3.3 (Parametric counting lemma on Rn for simplices). Let 0 < \u03b5 \u2264 1 and R \u2265 1. There exists an integer J1 = J1(\u03b5,R) = O(R\u03b5\u22124) such that for any\n\u03b5-admissible sequence of scales L0 \u2265 L1 \u2265 \u00b7 \u00b7 \u00b7 \u2265 LJ1 with the property that L0 divides l(Q) and collection of functions\nf i,rk,t : Qti(L0) \u2192 [\u22121, 1] with 1 \u2264 i \u2264 d, 1 \u2264 k \u2264 ni, 1 \u2264 r \u2264 R and t \u2208 \u0393L0,Q there exists 1 \u2264 j < J1 and a set T\u03b5 \u2286 \u0393L0,Q of size |T\u03b5| \u2264 \u03b5|\u0393L0,Q| such that\n(3.9) N 1\u03bb\u03940i ,Qti (L0)(f i,r 1,t , . . . , f i,r ni,t) = M 1 \u03bb,Qti (L0) (f i,r1,t , . . . , f i,r ni,t) +O(\u03b5)\nfor all \u03bb \u2208 [Lj+1, Lj ] and t /\u2208 T\u03b5 uniformly in 1 \u2264 i \u2264 d and 1 \u2264 r \u2264 R.\nThe proof of Proposition 3.3 will follow from Lemma 3.1 and the following generalization of Lemma 3.2 in which we simultaneously consider a family of functions supported on the subcubes in a partition of an original cube Q.\nLemma 3.3 (A simultaneous Koopman-von Neumann type decomposition). Let 0 < \u03b5 \u2264 1, m \u2265 1, and Q \u2286 Rn be a cube. There exists an integer J\u03041 = O(m\u03b5\u22123) such that for any \u03b5-admissible sequence L0 \u2265 L1 \u2265 \u00b7 \u00b7 \u00b7 \u2265 LJ\u03041 with the property that L0 divides l(Q), and collection of functions\nf1,t, . . . , fm,t : Qt(L0) \u2192 [\u22121, 1] defined for each t \u2208 \u0393L0,Q, there is some 1 \u2264 j < J\u03041 and a set T\u03b5 \u2286 \u0393L0,Q of size |T\u03b5| \u2264 \u03b5|\u0393L0,Q| such that (3.10) \u2016fi,t \u2212 E(fi,t|GLj ,Qt(L0))\u2016U1Lj+1 (Qt(L0)) \u2264 \u03b5\nfor all 1 \u2264 i \u2264 m and t /\u2208 T\u03b5.\nProof of Proposition 3.3. Fix 1 \u2264 i \u2264 d. For 1 \u2264 k \u2264 ni and t = (t1, . . . , td) \u2208 \u0393L0,Q, we will abuse notation and write\nf i,rk,t(x1, . . . , xd) := f i,r k,t(xi)\nfor (x1, . . . , xd) \u2208 Qt(L0). If we apply Lemma 3.3 to the family of functions f i,rk,t on Qt(L0) for 1 \u2264 i \u2264 d, 1 \u2264 k \u2264 ni, and 1 \u2264 r \u2264 R, with m = (n1 + . . .+ nd)R, then this produces a grid GLj ,Q for some 1 \u2264 j \u2264 J\u03041 = O(\u03b5\u22123R), and a set T\u03b5 \u2286 \u0393L0,Q of size |T\u03b5| \u2264 \u03b5|\u0393L0,Q|, such that\n\u2016f i,rk,t \u2212 E(f i,r k,t |GLj ,Q)\u2016U1Lj+1 (Qt(L0)) \u2264 \u03b5\nuniformly for 1 \u2264 i \u2264 d, 1 \u2264 k \u2264 ni and 1 \u2264 r \u2264 R for t /\u2208 T\u03b5. Since f i,rk,t(x1, . . . , xd) = f i,r k,t(xi) for (x1, . . . , xd) \u2208 Qt(L0) it is easy to see that\n\u2016f i,rk,t \u2212 E(f i,r k,t |GLj ,Q)\u2016U1Lj+1 (Qt(L0)) = \u2016f i,r k,t \u2212 E(f i,r k,t |GLj ,Qi)\u2016U1Lj+1 (Qti (L0)).\nLet f\u0304 i,rk,t := E(f i,r k,t |GLj ,Qi), then by Lemma 3.1, one has\nN 1\u03bb\u03940i ,Qti (L0)(f i,r 1,t , . . . , f i,r ni,t) = N 1 \u03bb\u03940i ,Qti (L0) (f\u0304 i,r1,t , . . . , f\u0304 i,r ni,t) +O(\u03b5),\nand\nM1\u03bb,Qti (L0)(f i,r 1,t , . . . , f i,r ni,t) = M 1 \u03bb,Qti (L0) (f\u0304 i,r1,t , . . . , f\u0304 i,r ni,t) +O(\u03b5)\nfor all t /\u2208 T\u03b5 provided \u03b5\u22126Lj+1 \u03bb. Finally, if we also have \u03bb \u03b5Lj then it is easy to see that\nN 1\u03bb\u03940i ,Qti (L0)(f\u0304 i,r 1,t , . . . , f\u0304 i,r ni,t) = M 1 \u03bb,Qti (L0) (f\u0304 i,r1,t , . . . , f\u0304 i,r ni,t) +O(\u03b5)\nas the functions f\u0304 i,rk,t are constant on cubes Qti(Lj) of GLj ,Qi , which are of size Lj \u03b5L0.\nPassing first to a subsequence of scales, for example L\u2032j = L5j , the condition \u03b5\u22126Lj+1 \u03bb \u03b5Lj can be replaced with Lj+1 \u03bb Lj so this completes the proof of the proposition.\nWe conclude this section with a sketch of the proof of Lemma 3.3. These arguments are standard, see for example the proof of Lemma 3.2 given in [12].\nProof of Lemma 3.3. First we make an observation about the U1L(Q)-norm. Suppose 0 < L\u2032 \u03b52L with L\u2032 dividing L. If s \u2208 \u0393L\u2032,Q and t \u2208 Qs(L\u2032) then |t\u2212 s| = O(L\u2032) and hence\nx\u2208Qt(L)\ng(x) dx =\nx\u2208Qs(L)\ng(x) dx+O(L\u2032/L)\nfor any function g : Q \u2192 [\u22121, 1]. Moreover, since the cube Qs(L) is partitioned into the smaller cubes Qt(L\n\u2032), we have by Cauchy-Schwarz\u2223\u2223\u2223 x\u2208Qs(L) g(x) dx \u2223\u2223\u22232 \u2264 Et\u2208\u0393L\u2032,Qs(L) \u2223\u2223\u2223 x\u2208Qt(L\u2032) g(x) dx \u2223\u2223\u22232. From these observations it is easy to see that\n\u2016g\u20162U1L(Q) = t\u2208Q \u2223\u2223\u2223 x\u2208Qt(L) g(x) dx \u2223\u2223\u22232 dt \u2264 Et\u2208\u0393L\u2032,Q \u2223\u2223\u2223 x\u2208Qt(L\u2032) g(x) dx \u2223\u2223\u22232 +O(L\u2032/L) and we note that the right side of the above expression is \u2016E(g|GL\u2032,Q)\u20162L2(Q) since the conditional expectation function E(g|GL\u2032,Q) is constant and equal toffl x\u2208Qt(L\u2032) g(x) dx on the cubes Qt(L \u2032).\nSuppose that (3.10) does not hold for some 1 \u2264 i \u2264 m for every t in some set T\u03b5 \u2286 \u0393L0,Q of size |T\u03b5| > \u03b5 |\u0393L0,Q|. If we apply the above observation to g := fi,t \u2212 E(fi,t|GLj ,Qt(L0)), for every t \u2208 T\u03b5, we obtain by orthogonality that\nm\u2211 i=1 \u2016E(fi,t|GLj+2,Qt(L0))\u20162L2(Qt(L0)) \u2265 m\u2211 i=1 \u2016E(fi,t|GLj ,Qt(L0))\u20162L2(Qt(L0)) + c\u03b5 2\nfor some constant c > 0. If we now define fi : Q \u2192 [\u22121, 1] such that fi|(Qt(L0)) = fi,t, for 1 \u2264 i \u2264 m, average over t \u2208 \u0393L0,Q, and use the fact \u2016fi\u20162L2(Q) = Et\u2208\u0393L0,Q\u2016fi,t\u2016 2 L2(Qt(L0)) , we obtain\n(3.11)\nm\u2211 i=1 \u2016E(fi|GLj+2,Q)\u20162L2(Q) \u2265 m\u2211 i=1 \u2016E(fi|GLj ,Q)\u20162L2(Q) + c\u03b53.\nIt is clear that the sums in the above expressions are bounded by m for all j \u2265 1, thus (3.11) cannot hold for some 1 \u2264 j \u2264 J\u03041 for J\u03041 := Cm\u03b5\u22123. This implies that (3.10) must hold for some 1 \u2264 j \u2264 J\u03041, for all 1 \u2264 i \u2264 m and all t /\u2208 T\u03b5 for a set T\u03b5 \u2286 \u0393L0,Q of size |T\u03b5| \u2264 \u03b5 |\u0393L0,Q|."
        },
        {
            "heading": "4. Product of two simplices in Rn",
            "text": "Although not strictly necessary, we discuss in this section the special case d = 2 of Theorem 1.2. This already gives an improvement of the main results of [12], but more importantly serves as a gentle preparation for the more complicated general case, presented in the Section 5, which involve both a plethora of different scales and the hypergraph bundle notation introduced in Section 2.2.\n4.1. Proof of Theorem 1.2 with d = 2. Let Q = Q1 \u00d7Q2 with Q1 \u2286 Rn1 and Q2 \u2286 Rn2 be cubes of equal side length l(Q) and \u03940 = \u039401 \u00d7\u039402 with \u039401 = {v11, . . . , v1n1} \u2286 Rn1 and \u039402 = {v11, . . . , v2n2} \u2286 Rn2 two non-degenerate simplices.\nIn order to \u201ccount\u201d configurations of the form \u0394 = \u03941 \u00d7\u03942 \u2286 Rn1+n2 with \u03941 and \u03942 isometric copies of \u03bb\u0394 0 1 and \u03bb\u0394 0 2 respectively for some 0 < \u03bb l(Q) in a set S \u2286 Q we introduce the multi-linear expression\nN 2\u03bb\u03940,Q({fkl}) := x11\u2208Q1 x21\u2208Q2 \u02c6 x12,...,x1n1 \u02c6 x22,...,x2n2 n1\u220f k=1 n2\u220f l=1 fkl(x1k, x2l)\nd\u03c3\u03bb\u039401(x12 \u2212 x11, . . . , x1n1 \u2212 x11) d\u03c3\u03bb\u039402(x22 \u2212 x21, . . . , x2n2 \u2212 x21) dx21 dx11\nfor any family of functions fkl : Q1\u00d7Q2 \u2192 [\u22121, 1] with 1 \u2264 k \u2264 n1 and 1 \u2264 l \u2264 n2. Indeed, if fkl = 1S for all 1 \u2264 k \u2264 n1 and 1 \u2264 l \u2264 n2 then the above expression is 0 unless there exists a configuration \u0394 \u2286 S of the form \u03941\u00d7\u03942 with \u03941 and \u03942 isometric copies of \u03bb\u039401 and \u03bb\u0394 0 2 respectively.\nThe short argument presented in Section 1.1 demonstrating how both Theorem B and Corollary D follow from Proposition B, and hence from Proposition 3.1, applies equally well to each of our main theorems. This reduces our main theorems to analogous quantitative results involving an arbitrary lacunary sequence of scales. In the case d = 2 of Theorem 1.2 this stronger quantitative result takes the following form:\nProposition 4.1. For any 0 < \u03b5 1 there exists an integer J = O(exp(C\u03b5\u221213)) with the following property:\nGiven any lacunary sequence l(Q) \u2265 \u03bb1 \u2265 \u00b7 \u00b7 \u00b7 \u2265 \u03bbJ and S \u2286 Q, there is some 1 \u2264 j < J such that\n(4.1) N 2\u03bb\u03940,Q({1S}) > ( |S| |Q| )n1n2 \u2212 \u03b5\nfor all \u03bb \u2208 [\u03bbj+1, \u03bbj ].\nOur approach to establishing Proposition 4.1 is again to compare the above expressions to simpler ones for which it is easy to obtain lower bounds. For any 0 < \u03bb l(Q) and family of functions fkl : Q1 \u00d7Q2 \u2192 [\u22121, 1] with 1 \u2264 k \u2264 n1 and 1 \u2264 l \u2264 n2 we consider\nM2\u03bb,Q({fkl})\n:=\nt\u2208Q x1\u2208(t1+Q1(\u03bb))n1 x2\u2208(t2+Q2(\u03bb))n2 n1\u220f k=1 n2\u220f l=2 fkl(x1k, x2l) dx2 dx1 dt,\nwhere t = (t1, t2) \u2208 Q1 \u00d7 Q2, xi = (xi1, . . . , xini) and Qi(\u03bb) = [\u2212\u03bb2 , \u03bb 2 ] ni for i = 1, 2.\nNote that if S \u2286 Q is a set of measure |S| \u2265 \u03b4|Q| for some \u03b4 > 0, then careful applications of Ho\u0308lder\u2019s inequality give\nM2\u03bb,Q({1S}) \u2265 t\u2208Q ( (x1,x2)\u2208t+Q(\u03bb) 1S(x1, x2) dx1dx2 )n1n2 dt \u2265 \u03b4n1n2 \u2212O(\u03b5)\nfor all scales 0 < \u03bb \u03b5 l(Q). In light of the observation above, and the discussion preceding Proposition 3.2,\nwe see that Proposition 4.1, and hence Theorem 1.2 when d = 2, will follow as a consequence of the following\nProposition 4.2. Let 0 < \u03b5 1. There exists an integer J2 = O(exp(C\u03b5\u221212)) such that for any \u03b5-admissible sequence of scales l(Q) \u2265 L1 \u2265 \u00b7 \u00b7 \u00b7 \u2265 LJ2 and S \u2286 Q there is some 1 \u2264 j < J2 such that (4.2) N 2\u03bb\u03940,Q({1S}) = M2\u03bb,Q({1S}) +O(\u03b5)\nfor all \u03bb \u2208 [Lj+1, Lj ].\nThere are again two main ingredients in the proof of Proposition 4.2. The first establishes that the our multi-linear forms N 2\u03bb\u03940,Q({fkl}) are controlled by an appropriate box-type norm attached to a scale L.\nLet Q = Q1\u00d7Q2 be a cube. For any scale 0 < L l(Q) and function f : Q \u2192 R we define its local box norm at scale L to be\n(4.3) \u2016f\u20164 L(Q1\u00d7Q2) := t\u2208Q \u2016f\u20164 (t+Q(L)) dt,\nwhere Q(L) = [\u2212L2 , L 2 ] n1+n2 and\n\u2016f\u20164 ( \u02dcQ)\n(4.4)\n:=\nx11,x12\u2208 \u02dcQ1 x21,x22\u2208 \u02dcQ2\nf(x11, x21)f(x12, x21)f(x11, x22)f(x12, x22) dx11 . . . dx22\nfor any cube Q\u0303 \u2286 Q of the form Q\u0303 = Q\u03031 \u00d7 Q\u03032 with Q\u0303j \u2286 Qj for j = 1, 2.\nLemma 4.1 (A generalized von-Neumann inequality [12]). Let \u03b5 > 0, 0 < \u03bb l(Q), and 0 < L \u03b524\u03bb.\nFor any collections of functions fkl : Q1 \u00d7 Q2 \u2192 [\u22121, 1] with 1 \u2264 k \u2264 n1 and 1 \u2264 l \u2264 n2 we have both\n|N 2\u03bb\u03940,Q({fkl})| \u2264 min 1\u2264k\u2264n1, 1\u2264l\u2264n2 \u2016fkl\u2016 L(Q1\u00d7Q2) +O(\u03b5)(4.5)\n|M2\u03bb,Q({fkl})| \u2264 min 1\u2264k\u2264n1, 1\u2264l\u2264n2 \u2016fkl\u2016 L(Q1\u00d7Q2).(4.6)\nThe result above was essentially proved in [12] for the multi-linear forms N 2\u03bb\u03940,Q when Q = [0, 1]n1+n2 , however a simple scaling argument transfers the result to an arbitrary cube Q. For completeness we include its short proof in Section 4.2.\nThe second and main ingredient is an analogue of a weak form of Szemere\u0301di\u2019s regularity lemma due to Frieze and Kannan [7]. The more probabilistic formulation, we will use below, can be found for example in [21], [22], and [23], and is also sometimes referred to as a Koopman-von Neumann type decomposition.\nFor any cube Q \u2286 Rn and scale L > 0 that divides l(Q) we will let Q(L) = [\u2212L2 , L 2 ]\nn and GL,Q denote the collection of cubes Qt(L) = t + Q(L) partitioning the cube Q and let \u0393L,Q denote grid corresponding to the centers of these cubes. We will say that a finite \u03c3-algebra B on Q is of scale L if it contains GL,Q and for simplicity of notation will write Bt for B|Qt(L).\nRecall that if we have two \u03c3-algebras B1 on a cube Q1 and B2 on Q2 then by B1\u2228B2 we mean the \u03c3-algebra on Q = Q1\u00d7Q2 generated by the sets B1\u00d7B2 with B1 \u2208 B1 and B2 \u2208 B2. Recall also that we say the complexity of a \u03c3-algebra B is at most m, and write complex(B) \u2264 m, if it is generated by m sets.\nLemma 4.2 (Weak regularity lemma in Rn). Let 0 < \u03b5 1 and Q = Q1 \u00d7 Q2 with Q1 \u2286 Rn1 and Q2 \u2286 Rn2 be cubes of equal side length l(Q).\nThere exists an integer J\u03042 = O(\u03b5 \u221212) such that for any \u03b54-admissible sequence l(Q) \u2265 L1 \u2265 \u00b7 \u00b7 \u00b7 \u2265 LJ\u03042 and function f : Q \u2192 [\u22121, 1] there is some 1 \u2264 j \u2264 J\u03042 and a \u03c3-algebra B of scale Lj on Q such that\n(4.7) \u2016f \u2212 E(f |B)\u2016 Lj+1 (Q1\u00d7Q2) \u2264 \u03b5\nwhich has the additional local structure that for each t = (t1, t2) \u2208 \u0393Lj ,Q there exist \u03c3-algebras B1,t on Qt1(Lj) and B2,t on Qt2(Lj) with complex(Bi,t) = O(j) for i = 1, 2 such that Bt = B1,t \u2228 B2,t.\nComparing the above statement to Lemma 2.2 for d = 2, i.e to the weak regularity lemma, note that the \u03c3-algebra B of scale Lj has a direct product structure only locally, inside each cube Qt(Lj). Moreover this product structure varies with t \u2208 \u0393Lj ,Q, however the \u201clocal complexity\u201d remains uniformly bounded.\nAssuming for now the validity of Lemmas 4.1 and 4.2 we prove Proposition 4.2. We will make crucial use of Proposition 3.3, namely our parametric counting lemma on Rn for simplices.\nProof of Proposition 4.2. Let 0 < \u03b5 1, \u03b51 := exp(\u2212C1\u03b5\u221212) for some C1 1, and {Lj}j\u22651 be an \u03b51-admissible sequence of scales. Set R = \u03b5 \u03b5\u221211 and J1(\u03b51, R) be the parameter appearing in Proposition 3.3, noting that J1(\u03b51, R) = O(\u03b5 \u22125 1 ).\nFor L \u2208 {Lj}j\u22651 write index(L) = j if L = Lj . We now choose a subsequence {L\u2032j} \u2286 {Lj} so that L\u20321 = L1 and index(L\u2032j+1) \u2265 index(L\u2032j) + J1(\u03b51, R) + 2. Applying Lemma 4.2, with fkl = f := 1S for all 1 \u2264 k \u2264 n1 and 1 \u2264 l \u2264 n2, guarantees the existence of a \u03c3-algebra B of scale L\u2032j on Q such that\n(4.8) \u2016f \u2212 E(f |B)\u2016 L\u2032 j+1 (Q1\u00d7Q2) \u2264 \u03b5\nfor some 1 \u2264 j \u2264 C\u03b5\u221212. Moreover, we know that B has the additional local structure that for each t = (t1, t2) \u2208 \u0393L\u2032j ,Q there exist \u03c3-algebras B1,t on Qt1(L \u2032 j) and B2,t on Qt2(L\u2032j) with complex(Bi,t) = O(\u03b5\u221212) for i = 1, 2 such that Bt = B1,t \u2228 B2,t. Thus, if we let R1,t and R2,t denote the number of atoms in B1,t and B2,t respectively, then we can assume, by formally adding the empty set to these collections of atoms if necessary, that R1,t = R2,t = R\n\u2032 := exp(C\u03b5\u221212) for all t \u2208 \u0393L\u2032j ,Q.\nIf we let f\u0304 := E(f |B1 \u2228 B2), then by Lemma 4.1 and multi-linearity we have (4.9) N 2\u03bb\u03940,Q({f}) = N 2\u03bb\u03940,Q({f\u0304}) +O(\u03b5) and M2\u03bb,Q({f}) = M2\u03bb,Q({f\u0304}) +O(\u03b5)\nprovided for \u03b5\u221224L\u2032j+1 \u03bb. For a given t \u2208 \u0393Q,L\u2032j write f\u0304t for the restriction of f\u0304 to the cube Qt(L \u2032 j). By localization, one then has\n(4.10) N 2\u03bb\u03940,Q({f\u0304}) = Et\u2208\u0393L\u2032 j ,Q N 2\u03bb\u03940,Qt(L\u2032j)({f\u0304t}) +O(\u03b5),\nand\n(4.11) M2\u03bb,Q({f\u0304}) = Et\u2208\u0393L\u2032 j ,Q M2\u03bb,Qt(L\u2032j)({f\u0304t}) +O(\u03b5)\nprovided one also insists that \u03bb \u03b5L\u2032j . For given t \u2208 \u0393L\u2032j ,Q, the functions f\u0304t(x1, x2) are linear combinations of functions of the form 1Ar11,t(x1)1A r2 2,t (x2), where {Ar11,t}1\u2264r1\u2264R\u2032 and {Ar22,t}1\u2264r2\u2264R\u2032 are the collections of the atoms of the \u03c3-algebras B1,t and B2,t defined on the cubes Qt1(L \u2032 j) and Qt2(L \u2032 j). Thus for each t \u2208 \u0393L\u2032j ,Q one has\nf\u0304t = R\u2032\u2211 r1=1 R\u2032\u2211 r2=1 \u03b1r,t1Ar11,t \u00d7 1Ar22,t ,\nwhere r = (r1, r2). Plugging these linear expansions into the multi-linear expressions in above one obtains\nN 2\u03bb\u03940,Qt(L\u2032j)({f\u0304t}) = \u2211\nr={rkl}kl\n\u03b1r,t N 2\u03bb\u03940,Qt(L\u2032j)({1Ar1,kl1,t \u00d7 1A r2,kl 2,t })\nusing the notations rkl = (r1,kl, r2,kl), \u03b1r,t = \u220f kl \u03b1rkl,t. Notice that the product\nn1\u220f k=1 n2\u220f l=1 1 A r1,kl 1,t (x1k)1A r2,kl 2,t (x2l)\nis nonzero only if A r1,kl 1,t = A r1,k 1,t , that is if r1,kl = r1,k for all 1 \u2264 l \u2264 n2, as the atoms Ar1,t are all disjoint. Similarly, one has that r2,kl = r2,l for all 1 \u2264 k \u2264 n1. Thus, in fact\n(4.12) N 2\u03bb\u03940,Qt(L\u2032j)({f\u0304t}) = \u2211\nr={rkl}kl\n\u03b1r,t N 2\u03bb\u03940,Qt(L\u2032j)({1Ar1,k1,t \u00d7 1A r2,l 2,t })\nand similarly (4.13) M2\u03bb,Qt(L\u2032j)({f\u0304t}) = \u2211\nr={rkl}kl\n\u03b1r,t M2\u03bb,Qt(L\u2032j)({1Ar1,k1,t \u00d7 1A r2,l 2,t }).\nNote, that indices r are running through the index set [1, R\u2032]n1 \u00d7 [1, R\u2032]n2 of size at most R if C1 1.\nThe key observation is that\nN 2\u03bb\u03940,Qt(L\u2032j)(1Ar1,k1,t \u00d7 1A r2,l 2,t )(4.14)\n= N 1\u03bb\u039401,Qt1 (L\u2032j)(1Ar1,11,t , . . . , 1Ar1,n11,t ) N 1 \u03bb\u039402,Qt2 (L \u2032 j) (1 A r2,1 2,t , . . . , 1 A r2,n2 2,t )\nand\nM2\u03bb,Qt(L\u2032j)(1Ar1,k1,t \u00d7 1A r2,l 2,t )(4.15)\n= M1\u03bb,Qt1 (L\u2032j)(1Ar1,11,t , . . . , 1Ar1,n11,t ) M 1 \u03bb,Qt2 (L \u2032 j) (1 A r2,1 2,t , . . . , 1 A r2,n2 2,t ).\nLet r = {(r1,k, r2,l)}kl and g1,rk,t := 1Ar1,k1,t , g 2,r l,t := 1A r2,l 2,t . Writing j\u2032 := index(L\u2032j) and J \u2032 := index(L\u2032j+1), one may apply Proposition 3.3 for the families of functions g 1,r k,t , g 2,r l,t , where 1 \u2264 k \u2264 n1, 1 \u2264 l \u2264 n2 and r = (r1,k, r2,l)kl \u2208 [1, R\u2032]n1 \u00d7 [1, R\u2032]n2 , with respect to the \u03b51-admissible sequence of scales\nLj\u2032+1 \u2265 Lj\u2032+2 \u2265 \u00b7 \u00b7 \u00b7 \u2265 LJ\u2032\u22121.\nThis is possible as J \u2032 \u2212 j\u2032 = J1(\u03b51, R). Then there is a scale Lj with j\u2032 \u2264 j < J \u2032 so that\n(4.16) N 1\u03bb\u039401,Qt1 (L\u2032j)(g 1,r 1,t , . . . , g 1,r n1t) = M 1 \u03bb,Qt1 (L \u2032 j) (g 1,r 1,t , . . . , g 1,r n1,t) +O(\u03b51)\nand\n(4.17) N 1\u03bb\u039402,Qt2 (L\u2032j)(g 2,r 1,t , . . . , g 2,r n2,t) = M 1 \u03bb,Qt2 (L \u2032 j) (g 2,r 1,t , . . . , g 2,r n2,t) + O(\u03b51),\nfor all \u03bb \u2208 [Lj+1, Lj ] uniformly in r = {(r1,k, r2,l)}kl and t /\u2208 T\u03b51 \u2286 \u0393L\u2032j ,Q, for a set of size |T\u03b51 | \u2264 \u03b51|\u0393L\u2032j ,Q|. Then, by (4.14)\u2013(4.15) and (4.12)\u2013(4.13), we have\n(4.18) N 2\u03bb\u03940,Qt(L\u2032j)({f\u0304t}) = M 2 \u03bb,Qt(L\u2032j) ({f\u0304t}) +O(\u03b5)\nfor t /\u2208 T\u03b51 , as |\u03b1r,t| \u2264 1 and R\u03b51 \u2264 \u03b5. Finally, since |T\u03b51 | \u2264 \u03b51|\u0393L\u2032j ,Q|, by averaging in t \u2208 \u0393L\u2032j ,Q, one has\nN 2\u03bb\u03940,Q({f\u0304}) = M2\u03bb,Q ({f\u0304}) +O(\u03b5)\nusing (4.10)\u2013(4.11) and the Proposition follows by (4.9) with an index 1 \u2264 j < J2 = O(\u03b5 \u221212\u03b5\u221251 ).\n4.2. Proof of Lemmas 4.1 and 4.2.\nProof of Lemma 4.1. First we note that if \u03c7L := L \u2212n1[\u2212L/2,L/2]n and \u03c8L := \u03c7L \u2217 \u03c7L, then\n\u03c8L(x2 \u2212 x1) = \u02c6 t \u03c7L(x1 \u2212 t)\u03c7L(x2 \u2212 t) dt\nand hence for any function f : Q \u2192 [\u22121, 1], with Q \u2286 Rn being a cube of side length l(Q), one has\n\u2016f\u20162U1L(Q) = x1\u2208Q \u02c6 x2 f(x1)f(x2)\u03c8L(x2 \u2212 x1) dx1dx2 + O(L/l(Q)).\nWrite x\u2032 := (x21, . . . , x2n2) and let gk,x\u2032(x) := \u220fn2\nl=1 fkl(x, x2l). Then one may write\nN 2\u03bb\u03940,Q({fkl})\n=\nx21\u2208Q2 \u02c6 x22,...,x2n2 N 1\u03bb\u039401,Q1(g1,x\u2032 , . . . , gn1,x\u2032) d\u03c3\u03bb\u039402(x22\u2212x21, . . . , x2n2\u2212x21)dx21.\nUsing estimate (3.6), the above observation, and Cauchy-Schwarz one has\n|N 2\u03bb\u03940,Q({fkl})|2\n\u2264 x11\u2208Q1 \u02c6 x12 \u03c8L(x12 \u2212 x11) N 1\u03bb\u039402,Q2(h1,x11,x12 , . . . , hn2,x11,x12) dx11dx12 +O(\u03b5 4)\nprovided 0<\u03bb l(Q) and 0<L \u03b524\u03bb where hl,x11,x12(x) = f1l(x11, x)f1l(x12, x) for 1 \u2264 l \u2264 n2. Applying the same procedure again ultimately gives\n|N 2\u03bb\u03940,Q({fkl})|4 \u2264 \u2016f11\u20164 L(Q1\u00d7Q2) +O(\u03b5 4).\nThe same estimate can of course be given for any function fkl in place of f11. This establishes (4.5). Estimate (4.6) is established similarly.\nProof of Lemma 4.2. For each t = (t1, t2) \u2208 \u0393L1,Q we will let B1,t(L1) := {\u2205, Qt1(L1)} and B2,t(L1) := {\u2205, Qt2(L1)}, in other words the trivial \u03c3-algebras on Qt1(L1) and Qt2(L1) respectively. If (4.8) holds with B(L1) = GL1,Q, noting that Bt(L1) := B1,t(L1) \u2228 B2,t(L1) in this case, then we are done.\nWe now assume that we have developed, for each t = (t1, t2) \u2208 \u0393Lj ,Q, \u03c3-algebras B1,t(Lj) onQt1(Lj) and B2,t(Lj) onQt2(Lj) with complex(Bi,t(Lj)) \u2264 j for i = 1, 2. Let B(Lj) be the \u03c3-algebra such that Bt(Lj) = B1,t(Lj)\u2228B2,t(Lj) for all t \u2208 \u0393Lj ,Q and assume that (4.8) does not hold, namely that\n\u2016g\u2016 Lj+1 (Q) \u2265 \u03b5,\nwhere g := f\u2212E(f |B(Lj)). By the definition of the local box norm this means that t\u2208Q \u2016g\u20164 (t+Q(Lj+1)) dt \u2265 \u03b5 4\nand hence, as Lj+2 \u03b54Lj+1, it is easy to see that Es\u2208\u0393Lj+2,Q \u2016g\u2016 4 (s+Q(Lj+2)) \u2265 \u03b5 4/2.\nThis implies that there is a set S \u2286 \u0393Lj+2,Q of size |S| \u2265 (\u03b54/4)|\u0393Lj+2,Q| such that for all s = (s1, s2) \u2208 S, one has that \u2016g\u20164 (Qs(Lj+2)) \u2265 \u03b5 4/4. It therefore follows, as is well-known see for example [12] or [23], that there exist sets B1,s \u2286 Qs1(Lj+2) and B2,s \u2286 Qs2(Lj+2) such that\n(4.19)\nx1\u2208Qs1 (Lj+2) x2\u2208Qs2 (Lj+2)\ng(x1, x2) 1B1,s(x1)1B2,s(x2) dx1 dx2 \u2265 \u03b54/16.\nFor a given s \u2208 \u0393Lj+2,Q there is a unique t = t(s) such that Qs(Lj+2) \u2286 Qt(Lj). Let B\u20321,s(Lj+2) := B1,t(Lj)|Qs1(Lj+2) and B \u2032 2,s(Lj+2) := B2,t(Lj)|Qs2(Lj+2) noting that complex(B\u2032i,s(Lj+2)) \u2264 j for i = 1, 2, as the complexity of a \u03c3-algebra does not increase when restricted to a set. If, for i = 1, 2, we let Bi,s(Lj+2) denote the \u03c3-algebra generated by B\u2032i,s(Lj+2) and the set Bi,s if s \u2208 S and let Bi,s(Lj+2) := B\u2032i,s(Lj+2) otherwise, then clearly complex(Bi,s(Lj+2)) is at most j + 1. We now define B(Lj+2) to the the sigma algebra of scale Lj+2 with the property that Bs(Lj+2) = B1,s(Lj+2) \u2228 B2,s(Lj+2) for all s \u2208 \u0393Lj+2,Q.\nUsing the inner product notation \u3008f, g\u3009Q = ffl Q f(x)g(x) dx we can rewrite (4.19)\nas \u3008f \u2212 E(f |B(Lj)) , 1B1,s \u00d7 1B2,s \u3009Qs(Lj+2) \u2265 \u03b54/16 for all s \u2208 S. Since the function 1B1,s \u00d71B2,s is measurable with respect to B(Lj+2) one clearly has\n\u3008f \u2212 E(f |B(Lj+2)) , 1B1,s \u00d7 1B2,s\u3009Qs(Lj+2) = 0 and hence\n\u3008E(f |B(Lj+2))\u2212 E(f |B(Lj)) , 1B1,s \u00d7 1B2,s\u3009Qt(Lj+2) \u2265 \u03b54/16.\nIt then follows from Cauchy-Schwarz and orthogonality that\n\u2016E(f |B(Lj+2))\u20162L2(Qs(Lj+2)) \u2212 \u2016E(f |B1(Lj))\u2016 2 L2(Qs(Lj+2)) \u2265 \u03b58/256.\nSince |S| \u2265 (\u03b54/4)|\u0393Lj+2,Q| averaging over all s \u2208 \u0393Lj+2,Q gives\n\u2016E(f |B(Lj+2))\u20162L2(Q) \u2265 \u2016E(f |B(Lj))\u20162L2(Q) + \u03b512/210.\nTrivially both sides are at most 1 thus the process must stop at a step j = O(\u03b5\u221212) where (4.8) holds for a \u03c3-algebra of \u201clocal complexity\u201d at most j. This proves the lemma.\n5. Proof of Theorem 1.2: The general case\nAfter these preparations we will now consider the general case of Theorem 1.2. Let Q = Q1 \u00d7 \u00b7 \u00b7 \u00b7 \u00d7 Qd \u2286 Rn with Qi \u2286 Rni cubes of equal side length l(Q) and \u03940 = \u039401 \u00d7 \u00b7 \u00b7 \u00b7 \u00d7\u03940d with each \u0394i \u2286 Rni a non-degenerate simplex of ni points for 1 \u2264 i \u2264 d.\nWe will use a generalized version of the hypergraph terminology introduced in Section 2. In particular, for a vertex set I = {1, 2, . . . , d} and set K = {il; 1 \u2264 i \u2264 d, 1 \u2264 l \u2264 ni} we will let \u03c0 : K \u2192 I denote the projection defined by \u03c0(il) := i. As before we will let Hd,k := {e \u2286 I; |e| = k} denote the complete k-regular hypergraph with vertex set I, and for the multi-index n = (n1, . . . , nd) define the hypergraph bundle Hnd,k := {e \u2286 K; |e| = |\u03c0(e)| = k} noting that |\u03c0\u22121(i)| = ni for all i \u2208 I.\nIn order to parameterize the vertices of direct products of simplices, i.e. sets of the form \u0394 = \u03941 \u00d7 \u00b7 \u00b7 \u00b7 \u00d7 \u0394d with \u0394i \u2286 Qi, we consider points x = (x1, . . . , xd) with xi = (xi1, . . . , xini) \u2208 Qnii for each i \u2208 I. Now for any 1 \u2264 k \u2264 d and any edge e\u2032 \u2208 Hd,k we will write Qe\u2032 := \u220f i\u2208e\u2032 Qi, and for every x \u2208 Q n1 1 \u00d7\u00b7 \u00b7 \u00b7\u00d7Q nd d and e \u2208 Hnd,k we define xe := \u03c0e(x), where \u03c0e : Q n1 1 \u00d7 \u00b7 \u00b7 \u00b7 \u00d7Qndd \u2192 Q\u03c0(e) is the natural projection map. Writing \u0394i = {xi1, . . . , xini} we have that \u03941 \u00d7 \u00b7 \u00b7 \u00b7 \u00d7\u0394d = {xe : e \u2208 Hnd,d} since every edge xe is of the form (x1l1 , . . . , xdld). We can therefore identify points x with configurations of the form \u03941 \u00d7 \u00b7 \u00b7 \u00b7 \u00d7\u0394d.\nFor any 0 < \u03bb l(Q) the measures d\u03c3\u03bb\u03940i , introduced in Section 3.1, are supported on points (y2, . . . , yni) for which the simplex \u0394i = {0, y2, . . . , yni} is isometric to \u03bb\u03940i . For simplicity of notation we will write\u02c6\nxi\nf(xi) d\u03c3 \u03bb i (xi) :=\nxi1\u2208Qi \u02c6 xi2,...,xini f(xi) d\u03c3\u03bb\u03940i (xi2 \u2212 xi1, . . . , xini \u2212 xi1) dxi1.\nNote that the support of the measure d\u03c3\u03bbi is the set of points xi so that the simplex \u0394i := {xi1, . . . , xini} is isometric to \u03bb\u03940i and xi1 \u2208 Qi, moreover the measure is normalized. Thus if S \u2286 Q is a set then the density of configurations \u0394 in S of the form \u0394 = \u03941 \u00d7 . . . \u00d7\u0394d with each \u0394i \u2286 Qi an isometric copy of \u03bb\u03940i is given by the expression\n(5.1) N d\u03bb\u03940,Q(1S ; e \u2208 H n d,d) := \u02c6 x1 \u00b7 \u00b7 \u00b7 \u02c6 xd \u220f e\u2208Hnd,d 1S(xe) d\u03c3 \u03bb 1 (x1) . . . d\u03c3 \u03bb d (xd).\nThe proof of Theorem 1.2 reduces to establishing the following stronger quantitative result.\nProposition 5.1. For any 0 < \u03b5 1 there exists an integer Jd = Jd(\u03b5) with the following property:\nGiven any lacunary sequence l(Q) \u2265 \u03bb1 \u2265 \u00b7 \u00b7 \u00b7 \u2265 \u03bbJd and S \u2286 Q, there is some 1 \u2264 j < Jd such that\n(5.2) N d\u03bb\u03940,Q(1S ; e \u2208 H n d,d) > ( |S| |Q| )n1\u00b7\u00b7\u00b7nd \u2212 \u03b5\nfor all \u03bb \u2208 [\u03bbj+1, \u03bbj ].\nQuantitative remark. A careful analysis of our proof reveals that there is a choice of Jd(\u03b5) which is less than Wd(log(C\u0394\u03b5\n\u22123)), where Wk(m) is again the towerexponential function defined by W1(m) = exp(m) and Wk+1(m) = exp(Wk(m)) for k \u2265 1.\nFor any 0 < \u03bb l(Q) and set S \u2286 Q we define the expression:\n(5.3) Md\u03bb,Q(1S ; e \u2208 H n d,d) :=\nt\u2208Q\nMdt+Q(\u03bb)(1S ; e \u2208 H n d,d) dt,\nwhere Q(\u03bb) = [\u2212\u03bb2 , \u03bb 2 ] n and\n(5.4) Md \u02dcQ (1S ; e \u2208 Hnd,d) :=\nx1\u2208 \u02dcQ n1 1 \u00b7 \u00b7 \u00b7 xd\u2208 \u02dcQ nd d \u220f e\u2208Hnd,d 1S(xe) dx1 . . . dxd\nfor any cube Q\u0303 \u2286 Q of the form Q\u0303 = Q\u03031 \u00d7 \u00b7 \u00b7 \u00b7 \u00d7 Q\u0303d with Q\u0303i \u2286 Qi for 1 \u2264 i \u2264 d. Note that if S \u2286 Q is a set of measure |S| \u2265 \u03b4|Q| for some \u03b4 > 0, then careful applications of Ho\u0308lder\u2019s inequality give\nMd\u03bb,Q(1S ; e \u2208 H n d,d) \u2265\nt\u2208Q ( (x1,...,xd)\u2208t+Q(\u03bb) 1S(x1, . . . , xd) dx1 . . . dxd )n1\u00b7\u00b7\u00b7nd dt\n\u2265\u03b4n1\u00b7\u00b7\u00b7nd \u2212O(\u03b5) for all scales 0 < \u03bb \u03b5 l(Q).\nIn light of the discussion above, and that preceding Proposition 3.2, we see that Proposition 5.1, and hence Theorem 1.2 in general, will follow as a consequence of the following\nProposition 5.2. Let 0 < \u03b5 1. There exists an integer Jd = Jd(\u03b5) such that for any \u03b5-admissible sequence of scales l(Q) \u2265 L1 \u2265 \u00b7 \u00b7 \u00b7 \u2265 LJd and S \u2286 Q there is some 1 \u2264 j < Jd such that (5.5) N d\u03bb\u03940,Q(1S ; e \u2208 H n d,d) = Md\u03bb,Q(1S ; e \u2208 H n d,d) +O(\u03b5)\nfor all \u03bb \u2208 [Lj+1, Lj ].\nThe validity of Proposition 5.2 will follow immediately from the d = k case of Proposition 5.3.\n5.1. Reduction of Proposition 5.2 to a more general \u201clocal\u201d counting lemma. For any given 1 \u2264 k \u2264 d and collection of functions fe : Q\u03c0(e) \u2192 [\u22121, 1] with e \u2208 Hnd,k we define the following multi-linear expressions\n(5.6) N d\u03bb\u03940,Q(fe; e \u2208 H n d,k) := \u02c6 x1 \u00b7 \u00b7 \u00b7 \u02c6 xd \u220f e\u2208Hnd,k fe(xe) d\u03c3 \u03bb 1 (x1) . . . .d\u03c3 \u03bb d (xd)\nand\n(5.7) Md\u03bb,Q(fe ; e \u2208 H n d,k) :=\nt\u2208Q\nMdt+Q(\u03bb)(fe ; e \u2208 H n d,k) dt,\nwhere Q(\u03bb) = [\u2212\u03bb2 , \u03bb 2 ] n and\n(5.8) Md \u02dcQ (fe ; e \u2208 Hnd,k) :=\nx1\u2208 \u02dcQ n1 1 \u00b7 \u00b7 \u00b7 xd\u2208 \u02dcQ nd d \u220f e\u2208Hnd,k fe(xe) dx1 . . . dxd\nfor any cube Q\u0303 \u2286 Q of the form Q\u0303 = Q\u03031 \u00d7 \u00b7 \u00b7 \u00b7 \u00d7 Q\u0303d with Q\u0303i \u2286 Qi for 1 \u2264 i \u2264 d. Our strategy to proving Proposition 5.2 is the same as illustrated in the finite field settings, that is we would like to compare averages N\u03bb\u03940,Q(fe; e \u2208 Hnd,k) to those of Md\u03bb,Q(fe ; e \u2208 H n d,k), at certain scales \u03bb \u2208 [Lj+1, Lj ], inductively for 1 \u2264 k \u2264 d. However in the Euclidean case, an extra complication emerges due to the fact the (hypergraph) regularity lemma, the analogue of Lemma 2.2, does not produce \u03c3-algebras Bf, for f \u2208 Hnd,k\u22121, on the cubes Qf. In a similar manner to the case for d = 2 discussed in the previous section, we will only obtain \u03c3-algebras \u201clocal\u201d on cubes Qtf(L0) at some scale L0 > 0. This will have the effect that the functions fe will be replaced by a family of functions fe,t, where t runs through a grid \u0393L0,Q.\nTo be more precise, let L > 0 be a scale dividing the side-length l(Q). For t \u2208 \u0393L,Q and e\u2032 \u2208 Hd,k we will use te\u2032 to denote the projection of t onto Qe\u2032 and Qte\u2032 (L) := te\u2032 + Qe\u2032(L) to denote the projection of the cube Qt(L) centered at t onto Qe\u2032 . It is then easy to see that for any \u03b5 > 0 we have\n(5.9) N d\u03bb\u03940,Q(fe; e \u2208 H n d,k) = Et\u2208\u0393L,Q N d\u03bb\u03940,Qt(L)(fe,t ; e \u2208 H n d,k) +O(\u03b5)\nand\n(5.10) Md\u03bb,Q(fe; e \u2208 H n d,k) = Et\u2208\u0393L,Q Md\u03bb,Qt(L)(fe,t ; e \u2208 H n d,k) +O(\u03b5)\nprovided 0 < \u03bb \u03b5L where fe,t denotes the restriction of a function fe to the cube Qt(L).\nAt this point the proof of Proposition 5.2 reduces to showing that the expressions in (5.9) and (5.10) only differ by O(\u03b5) at some scales \u03bb \u2208 [Lj+1, Lj ], given an \u03b5admissible sequence L0 \u2265 L1 \u2265 \u00b7 \u00b7 \u00b7 \u2265 LJ , for any collection of bounded functions fe,t, e \u2208 Hnd,k, t \u2208 \u0393L0,Q. Indeed, our crucial result will be the following\nProposition 5.3 (Local counting lemma). Let 0 < \u03b5 1 and M \u2265 1. There exists an integer Jk = Jk(\u03b5,M) such that for any \u03b5-admissible sequence of scales L0 \u2265 L1 \u2265 \u00b7 \u00b7 \u00b7 \u2265 LJk with the property that L0 divides l(Q), and collection of functions\nfme,t : Qt\u03c0(e)(L0) :\u2192 [\u22121, 1] with e \u2208 H n d,k, 1 \u2264 m \u2264 M and t \u2208 \u0393L0,Q\nthere exists 1 \u2264 j < Jk and a set T\u03b5 \u2286 \u0393L0,Q of size |T\u03b5| \u2264 \u03b5|\u0393L0,Q| such that\n(5.11) N d\u03bb\u03940,Qt(L0)(f m e,t; e \u2208 H n d,k) = M\u03bb,Qt(L0)(fme,t; e \u2208 H n d,k) +O(\u03b5)\nfor all \u03bb \u2208 [Lj+1, Lj ] and t /\u2208 T\u03b5 uniformly in e \u2208 Hnd,k and 1 \u2264 m \u2264 M .\n5.2. Proof of Proposition 5.3. We will prove Proposition 5.3 by induction on 1 \u2264 k \u2264 d. For k = 1 this is basically Proposition 3.3.\nIndeed, in this case for a given t = (t1, . . . , td) \u2208 \u0393L0,Q and edge e \u2208 H n d,1 = {il : 1 \u2264 i \u2264 d, 1 \u2264 l \u2264 ni} we have that fme,t(xe) = fmil,t(xil) with xil \u2208 Qti(L0) and hence both\nN d\u03bb\u03940,Qt(L0)(f m e,t; e \u2208 H n d,1) = d\u220f i=1 N 1\u03bb\u03940i ,Qti (L0)(f m i1,t, . . . , f m ini,t)\nMd\u03bb,Qt(L0)(f m e,t; e \u2208 H n d,1) = d\u220f i=1 M1\u03bb,Qti (L0)(f m i1,t, . . . , f m ini,t).\nBy Proposition 3.3 there exists an 1 \u2264 j < J1 = O(M\u03b5\u22124) and an exceptional set T\u03b5 \u2286 \u0393L0,Q of size |T\u03b5| \u2264 \u03b5|\u0393L0,Q|, such that uniformly for t /\u2208 T\u03b5 and for 1 \u2264 i \u2264 d, one has\nN 1\u03bb\u03940i ,Qti (L0)(f m i1,t, . . . , f m ini,t) = M 1 \u03bb,Qti (L0) (fmi1,t, . . . , f m ini,t) +O(\u03b5)\nhence\nN d\u03bb\u03940,Qt(L0)(f m e,t; e \u2208 H n d,1) = Md\u03bb,Qt(L0)(f m e,t; e \u2208 H n d,1) + O(\u03b5)\nas the all factors are trivially bounded by 1 in magnitude. This implies (5.11) for k = 1.\nFor the induction step we again need two main ingredients. The first establishes that the our multi-linear forms N d\u03bb\u03940,Q(fe; e \u2208 H n d,k) are controlled by an appropriate box-type norm attached to a scale L. Let Q = Q1 \u00d7 \u00b7 \u00b7 \u00b7 \u00d7Qd and 1 \u2264 k \u2264 d. For any scale 0 < L l(Q) and function f : Qe\u2032 \u2192 [\u22121, 1] with e\u2032 \u2208 Hd,k we define its local box norm at scale L by\n(5.12) \u2016f\u20162k L(Qe\u2032 ) := s\u2208Qe\u2032 \u2016f\u20162k (s+Q(L)) ds,\nwhere\n\u2016f\u20162k ( \u02dcQ)\n(5.13)\n:=\nx11,x12\u2208 \u02dcQ1 \u00b7 \u00b7 \u00b7 xk1,xk2\u2208 \u02dcQk \u220f ( 1,..., k)\u2208{1,2}k f(x1 1 , . . . , xk k) dx11 dx12 . . . dxk1 dxk2\nfor any cube Q\u0303 of the form Q\u0303 = Q\u03031 \u00d7 \u00b7 \u00b7 \u00b7 \u00d7 Q\u0303k.\nLemma 5.1 (Generalized von-Neumann inequality). Let \u03b5 > 0, 0 < \u03bb l(Q) and 0 < L (\u03b52k)6\u03bb.\nFor any 1 \u2264 k \u2264 d and collection of functions fe : Q\u03c0(e) \u2192 [\u22121, 1] with e \u2208 Hnd,k we have both\n|N d\u03bb\u03940,Q(fe; e \u2208 H n d,k)| \u2264 min e\u2208Hnd,k \u2016fe\u2016 L(Q\u03c0(e)) +O(\u03b5)(5.14)\n|Md\u03bb,Q(fe; e \u2208 H n d,k)| \u2264 min e\u2208Hnd,k \u2016fe\u2016 L(Q\u03c0(e)).(5.15)\nThe crucial ingredient is the following analogue of the weak hypergraph regularity lemma.\nLemma 5.2 (Parametric weak hypergraph regularity lemma for Rn). Let 0 < \u03b5 1, M \u2265 1, and 1 \u2264 k \u2264 d."
        },
        {
            "heading": "There exists J\u0304k = O(M\u03b5",
            "text": "\u22122k+3) such that for any \u03b52 k -admissible sequence L0 \u2265 L1 \u2265 \u00b7 \u00b7 \u00b7 \u2265 LJ\u0304k with the property that L0 divides l(Q) and collection of functions\nfme,t : Qt\u03c0(e)(L0) \u2192 [\u22121, 1] with e \u2208 H n d,k, 1 \u2264 m \u2264 M , and t \u2208 \u0393L0,Q\nthere is some 1 \u2264 j < J\u0304k and \u03c3-algebras Be\u2032,t of scale Lj on Qte\u2032 (L0) for each t \u2208 \u0393L0,Q and e\u2032 \u2208 Hd,k such that\n(5.16) \u2016fme,t \u2212 E(fme,t|B\u03c0(e),t)\u2016 Lj+1 (Qt\u03c0(e) (L0)) \u2264 \u03b5\nuniformly for all t /\u2208 T\u03b5, e \u2208 Hnd,k, and 1 \u2264 m \u2264 M , where T\u03b5 \u2286 \u0393L0,Q with |T\u03b5| \u2264 \u03b5|\u0393L0,Q|.\nMoreover, the \u03c3-algebras Be\u2032,t have the additional local structure that the exist \u03c3-algebras Be\u2032,f\u2032,s on Qsf\u2032 (Lj) with complex(Be\u2032,f\u2032,s) = O(j) for each s \u2208 \u0393Lj ,Q, e\u2032 \u2208 Hd,k, and f\u2032 \u2208 \u2202e\u2032 such that if s \u2208 Qt(L0), then\n(5.17) Be\u2032,t \u2223\u2223 Qse\u2032 (Lj) = \u2228\nf\u2032\u2208\u2202e\u2032 Be\u2032,f\u2032,s.\nLemma 5.2 is the parametric and simultaneous version of the extension of Lemma 4.2 to the product of d simplices. The difference is that in the general case one has to deal with a parametric family of functions fme,t as t is running through a grid \u0393L0,Q. The essential new content of Lemma 5.2 is that one can develop \u03c3-algebras Be\u2032,t on the cubes Qt(L0) with respect to the family of functions fme,t such that the local structure described above and (5.16) hold simultaneously for almost all t \u2208 \u0393L0,Q.\nProof of Proposition 5.3. Assume the proposition holds for k \u2212 1. Let \u03b5 > 0, \u03b51 := exp (\u2212C1\u03b5\u22122 k+3\n) for some large constant C1 = C1(n, k, d) 1, and {Lj}j\u22651 be an \u03b51-admissible sequence of scales. Set F (\u03b5) := Jk\u22121(\u03b51,M) with M = \u03b5 \u03b5\u221211 .\nFor L \u2208 {Lj}j\u22651 we again write index(L) = j if L = Lj . We now choose a subsequence {L\u2032j} \u2286 {Lj} so that L\u20320 = L0 and index(L\u2032j+1) \u2265 index(L\u2032j)+F (\u03b5)+2. Lemma 5.2 then guarantees the existence of \u03c3-algebras Be\u2032,t of scale L\u2032j on Qte\u2032 (L0) for each t \u2208 \u0393L0,Q and e\u2032 \u2208 Hd,k, with the local structure described above, such that\n(5.18) \u2016fme,t \u2212 E(fme,t|B\u03c0(e),t)\u2016 L\u2032 j+1 (Qt\u03c0(e) (L0)) \u2264 \u03b5\nuniformly for all t /\u2208 T \u2032\u03b5, e \u2208 H n d,k, and 1 \u2264 m \u2264 M , for some 1 \u2264 j < J\u0304k(\u03b5,M) = O(M\u03b5\u22122 k+3\n), where T \u2032\u03b5 \u2286 \u0393L0,Q with |T \u2032\u03b5| \u2264 \u03b5|\u0393L0,Q|. Let f\u0304me,t := E(fme,t|B\u03c0(e),t) for t \u2208 \u0393L0,Q and e \u2208 H n d,k. If t /\u2208 T \u2032\u03b5, then by (5.14), (5.15), and (5.16) we have both\nN d\u03bb\u03940,Qt(L0)(f m e,t; e \u2208 H n d,k) = N d\u03bb\u03940,Qt(L0)(f\u0304 m e,t; e \u2208 H n d,k) +O(\u03b5)(5.19)\nMd\u03bb,Qt(L0)(f m e,t; e \u2208 H n d,k) = Md\u03bb,Qt(L0)(f\u0304 m e,t; e \u2208 H n d,k) +O(\u03b5)(5.20)\nprovided (\u03b5\u22122 k )6L\u2032j+1 \u03bb. For given s \u2208 \u0393L\u2032j ,Qt(L0) one may write f\u0304 m e,s for the restriction of f\u0304me,t on the cube Qs(L \u2032 j) \u2286 Qt(L0), as s uniquely determines t. By\nlocalization, provided \u03bb \u03b5L\u2032j , we then have both\nN d\u03bb\u03940,Qt(L0)(f\u0304 m e,t; e \u2208 H n d,k) = Es\u2208\u0393L\u2032\nj ,Qt(L0)\nN d\u03bb\u03940,Qs(L\u2032j)(f\u0304 m e,s; e \u2208 H n d,k) +O(\u03b5),\n(5.21)\nMd\u03bb,Qt(L0)(f\u0304 m e,t; e \u2208 H n d,k) = Es\u2208\u0393L\u2032\nj ,Qt(L0)\nMd\u03bb,Qs(L\u2032j)(f\u0304 m e,s; e \u2208 H n d,k) +O(\u03b5).(5.22)\nFor a fixed cube Qs(L \u2032 j) we have that\n(5.23) f\u0304me,s = Re,s\u2211 re=1 \u03b1s,re,m 1Are\u03c0(e),s ,\nwhere {Are\u03c0(e),s}1\u2264r\u2264Re,s is the family of atoms of the \u03c3-algebra B\u03c0(e),t restricted to the cube Qs(L \u2032 j). Note that |\u03b1s,re | \u2264 1 and |Re,s| = O(exp (C\u03b5\u22122 k+3\n)). By adding the empty set to the collection of atoms one may assume |Re,s| = R := exp (C\u03b5\u22122 k+3\n) for all e \u2208 Hnd,k and s \u2208 \u0393L\u2032j ,Q. Then, by multi-linearity, using the notations r = (re)e\u2208Hnd,k and \u03b1r,s = \u220f e \u03b1s,re , one has both\nN d\u03bb\u03940,Qs(L\u2032j)(f\u0304 m s,e; e \u2208 H n d,k) = \u2211 r \u03b1s,r,m N d\u03bb\u03940,Qs(L\u2032j)(1Are\u03c0(e),s ; e \u2208 H n d,k)(5.24)\nMd\u03bb,Qs(L\u2032j)(f\u0304 m s,e; e \u2208 H n d,k) = \u2211 r \u03b1s,r,m Md\u03bb,Qs(L\u2032j)(1Are\u03c0(e),s ; e \u2208 H n d,k).(5.25)\nThe key observation is that these expressions in the sum above are all at level k\u2212 1 instead of k. To see this let e = (i1l1, . . . , imlm, . . . , iklk) so e\u2032 = \u03c0(e) = (i1, . . . , im, . . . , ik). If f\n\u2032 = e\u2032\\{im} then recall that the edge pf\u2032(e) = (i1l1, . . . , iklk) \u2208 Hnd,k\u22121 is obtained from e by removing the imlm-entry. Thus, for any atom Ae\u2032,s of Bs,e\u2032(L\u2032j) we have by (5.17), that\n(5.26) 1Ae\u2032,s(xe) = \u220f\nf\u2032\u2208\u2202e\u2032 1Ae\u2032,f\u2032,s,(xpf\u2032 (e)),\nwhere Ae\u2032,f\u2032,s is an atom of the \u03c3-algebra Be\u2032,f\u2032,s. Thus (5.27)\u220f\ne\u2208Hnd,k\n1Are \u03c0(e),s\n(xe) = \u220f\nf\u2208Hnd,k\u22121 \u220f e\u2208Hnd,k,f\n\u2032\u2208\u2202\u03c0(e) pf\u2032 (e)=f\n1Are \u03c0(e),f\u2032,s\n(xf) = \u220f\nf\u2208Hnd,k\u22121\ng r f,s (xf).\nIt follows that\n(5.28) N d\u03bb\u03940,Qs(L\u2032j)(1Are\u03c0(e),s ; e \u2208 H n d,k) = N d\u03bb\u03940,Qs(L\u2032j) (g r f,s; f \u2208 H n d,k\u22121)\nand hence that\n(5.29) N d\u03bb\u03940,Qs(L\u2032j)(f\u0304 m e,s; e \u2208 H n d,k) = \u2211 r \u03b1s,r,m N d\u03bb\u03940,Qs(L\u2032j) (g r f,s; f \u2208 H n d,k\u22121)\nand similarly\n(5.30) Md\u03bb,Qs(L\u2032j)(f\u0304 m e,s; e \u2208 H n d,k) = \u2211 r \u03b1r,s,m Md\u03bb,Qs(L\u2032j) (g r f,s; f \u2208 H n d,k\u22121).\nNote that number of index vectors r = (re)e\u2208Hnd,k is R D with D := |Hnd,k| and\nhence RD \u2264 M if C1 1.\nWriting j\u2032 := index(L\u2032j) and J \u2032 := index(L\u2032j+1) it then follows from our inductive\nhypothesis functions, applied with respect to the \u03b51-admissible sequence of scales\nLj\u2032+1 \u2265 Lj\u2032+2 \u2265 \u00b7 \u00b7 \u00b7 \u2265 LJ\u2032\u22121 which is possible as J \u2032\u2212j\u2032 Jk\u22121(\u03b51, RD), that there is a scale Lj with j\u2032 \u2264 j < J \u2032 so that\n(5.31) N\u03bb\u03940,Qs(L\u2032j) (g r s,f; f \u2208 H n d,k\u22121) = M\u03bb,Qs(L\u2032j) (g r s,f; f \u2208 H n d,k\u22121) +O(\u03b51)\nfor all \u03bb \u2208 [Lj+1, Lj ] uniformly in r for s /\u2208 S\u03b51 , where S\u03b51 \u2286 \u0393L\u2032j ,Q is a set of size |S\u03b51 | \u2264 \u03b51|\u0393L\u2032j ,Q|.\nSince the cubes Qt(L0) form a partition of Q as t runs through the grid \u0393L0,Q the relative density of the set S\u03b51 can substantially increase only of a few cubes Qt(L0). Indeed, it is easy to see that |T \u2032\u2032\u03b51 | \u2264 \u03b5 1/2 1 |\u0393L0,Q| for the set\nT \u2032\u2032\u03b51 := {t \u2208 \u0393L0,Q : |S\u03b51 \u2229Qt(L0)| \u2265 \u03b5 1/2 1 |\u0393L\u2032j ,Q \u2229Qt(L0)|}.\nWe claim that (5.11) holds for \u03bb \u2208 [Lj+1, Lj ] uniformly in t /\u2208 T\u03b5 := T \u2032\u03b5 \u222a T \u2032\u2032\u03b51 , e \u2208 Hnd,k, and 1 \u2264 m \u2264 M . Indeed, from (5.29), (5.30), and (5.31) and the fact that |\u03b1s,r| \u2264 1, it follows\nN d\u03bb\u03940,Qs(L\u2032j) (f\u0304e,s; e \u2208 H n d,k) = Md\u03bb,Qs(L\u2032j) (f\u0304e,s; e \u2208 H n d,k) +O(\u03b5)\nfor s /\u2208 S\u03b51 \u2229 Qt(L0) since RD\u03b51 \u03b5. Finally, the fact that t /\u2208 T \u2032\u2032\u03b51 together with localization, namely (5.21) and (5.22), ensures that averaging over \u0393L\u2032j ,Qt(L0) gives\nN d\u03bb\u03940,Qt(L0) (f\u0304e,t; e \u2208 H n d,k) = Md\u03bb,Qt(L0) (f\u0304e,t; e \u2208 H n d,k) +O(\u03b5) +O(\u03b5 1/2 1 )\nwhich in light of (5.19), (5.20), and the fact that \u03b51 \u03b52 complete the proof.\n5.3. Proof of Lemmas 5.1 and 5.2.\nProof of Lemma 5.1. The argument is similar to that of Lemma 2.1. Fix an edge, say e0 = (11, 12, . . . , 1k), and partition the edges e \u2208 Hnd,k in to as follows. Let H0 be the set of those edges e for which 1 /\u2208 \u03c0(e), and for l = 1, . . . , n1 let Hl denote the collection of edges of the form e = (1l, j2l2, . . . , jklk), in other words e \u2208 Hl if e = (1l, e\u2032) for some edge e\u2032 = (j2l2, . . . , jklk) \u2208 Hnd\u22121,k\u22121. Accordingly write\u220f\ne\u2208Hnd,k\nfe(xe) = \u220f\ne\u2208H0\nfe(xe) n1\u220f l=1 \u220f e\u2032\u2208Hnd\u22121,k\u22121 f1l,e\u2032(x1l, xe\u2032).\nFor x \u2208 Q1 and x\u2032 = (x2, . . . , xd) with xi \u2208 Qnii , define\n(5.32) gl(x, x \u2032) := \u220f e\u2032\u2208Hnd\u22121,k\u22121 f1l,e\u2032(x1l, xe\u2032).\nThen one may write\nN d\u03bb\u03940,Q(fe; e \u2208 H n d,k)(5.33)\n=\nx2\n. . .\nxd \u220f e\u2208H0 fe(xe) ( x1 n1\u220f l=1 gl(x1l, x \u2032) d\u03c3\u03bb1 (x1) ) d\u03c3\u03bbd (xd) . . . d\u03c3 \u03bb 2 (x2).\nFor the inner integrals we have, using (3.6), the estimate( x1 n1\u220f l=1 gl(x1l, x \u2032) d\u03c3\u03bb1 )2 \u2264 \u2016g1\u20162U1L(Q) +O(\u03b5 2k)\n=\ny11 \u02c6 y12 g1(y11)g1(y12)\u03c8 1 L(y12\u2212y11) dy11 dy12 +O(\u03b52 k )\nprovided 0 < L (\u03b52k)6\u03bb, where as in the proof of Lemma 4.1 we use the notation\n\u03c8iL(y2 \u2212 y1) = \u02c6 t \u03c7iL(y1 \u2212 t)\u03c7iL(y2 \u2212 t) dt\nwith \u03c7iL := L \u2212ni1[\u2212L/2,L/2]ni for 1 \u2264 i \u2264 k. By Cauchy-Schwarz we then have\u2223\u2223\u2223N d\u03bb\u03940,Q(fe; e \u2208 Hnd,k\u2223\u2223\u22232\n\u2264 \u02c6 y 1 x2 . . . xd \u220f e\u2032\u2208Hnd\u22121,k\u22121 f11,e\u2032(x11, xe\u2032)f11,e\u2032(x12, xe\u2032) d\u03c3 \u03bb d . . . d\u03c3 \u03bb 2 d\u03c9 1 L(y1)+O(\u03b5 2k),\nwhere d\u03c9iL(yi) = |Qi| \u22121\u03c8iL(yi2 \u2212 yi1) dyi1 dyi2 with yi = (yi1, yi2) \u2208 Q 2 i for 1 \u2264 i \u2264 k. The expression we have obtained above is similar to the one in (5.6) except for the following changes. The variable x1 \u2208 Qn11 is replaced by y1 \u2208 Q 2 1 and the measure d\u03c3\u03bb1 by d\u03c9 1 L. The functions f1l,e\u2032 are replaced by f11,e\u2032 , for 1 \u2264 l \u2264 n1, while the functions fe for all e \u2208 Hnd,k such that 1 /\u2208 \u03c0(e) are eliminated, that is replaced by 1. Repeating the same procedure for i = 2, . . . , k replaces all variables xi with variables yi as well as the measures d\u03c3 \u03bb i with d\u03c9 i L. The procedure eliminates all functions fe when e is an edge such that i /\u2208 \u03c0(e) for some 1 \u2264 i \u2264 k; for the remaining edges, when \u03c0(e) = (1, . . . , k), it replaces the functions fe with fe0 = f11,21,...,1k. For k < i the variables xi and the measures d\u03c3 \u03bb i are not changed, however integrating in these variables will have no contribution as the measures are normalized. Thus one obtains the following final estimate\n\u2223\u2223\u2223N\u03bb\u03940,Q(fe; e \u2208 Hnd,k\u2223\u2223\u22232k (5.34)\n\u2264 1|Q1| \u02c6 y 1 . . . 1 |Qk| \u02c6 y k \u220f e\u2208H2k,k fe0(ye) k\u220f i=1 \u03c8iL(yi2 \u2212 yi1) dyi1 dyi2 +O(\u03b52 k )\nnoting that these integrals are not normalized. Thus, one may write the expression in (5.34), using a change of variables yi1 := yi1 \u2212 ti, yi2 := yi2 \u2212 ti, as\n1\n|Q1| \u02c6 t1\ny 1 \u2208t1+Q1\n. . . 1\n|Qk| \u02c6 tk\ny k \u2208tk+Qk \u220f e\u2208H2k,k fe0(ye) dy1 . . . dyk dt(5.35)\n= \u2016fe0\u20162 k L(Q\u03c0(e0)) +O(\u03b5 2k)\nwhere the last equality follows from the facts that the function fe0 is supported on the cube Q\u03c0(e0) and hence the integration in t is restricted to the cube Q+Q(L), giving rise an error of O(L/l(Q)). Estimate (5.14) follows from (5.34) and (5.35)\nnoting that the above procedure can be applied to any e \u2208 Hnd,k in place of e0. Estimate (5.15) is established similarly.\nProof of Lemma 5.2. For j = 0 we set Be\u2032,t(L0) := {Qt(L0), \u2205} and Be\u2032,f\u2032,s(L0) := {Qsf\u2032 (L0), \u2205} for e\n\u2032 \u2208 Hd,k, f\u2032 \u2208 \u2202e\u2032, and t, s \u2208 \u0393L0,Q. We will develop \u03c3-algebras Be\u2032,t(Lj) of scale Lj such that (5.17) holds with complex(Be\u2032,f\u2032,s(Lj)) \u2264 j.\nWe define the total energy of a family of functions fme,t with respect to a family\nof \u03c3-algebras Be\u2032,t(Lj) as (5.36) E(fme,t|Be\u2032,t(Lj)) := Et\u2208\u0393L0,Q M\u2211\nm=1 \u2211 e\u2208Hnd,k \u2016E(fme,t|B\u03c0(e),t(Lj))\u20162L2(Qt\u03c0(e) (L0)).\nSince |fme,t| \u2264 1 for all e, m, and t it follows that the total energy is bounded by M \u00b7 |Hnd,k| = O(M). Our strategy will be to show that if (5.16) does not hold then there exist a family of \u03c3-algebras Be\u2032,t(Lj+2) such that the total energy of the family of functions fme,t is increased by at least ck\u03b5 2k+3 with respect to this new family of \u03c3-algebras, and at the same time ensuring that (5.17) remains valid with complex(Be\u2032,f\u2032,s(Lj+2)) \u2264 j + 2. This iterative process must stop at some j = O(M \u03b5\u22122 k+3\n) proving the lemma. Assume that we have developed \u03c3-algebras Be\u2032,t(Lj) and Be\u2032,f\u2032,s(Lj) of scale Lj such that (5.17) holds with complex(Be\u2032,f\u2032,s(Lj)) \u2264 j. If (5.16) does not hold then |T\u03b5| \u2265 \u03b5|\u0393L0,Q| for the set\nT\u03b5 := {t \u2208 \u0393L0,Q : \u2016fme,t \u2212 E(fme,t|B\u03c0(e),t(Lj))\u2016 Lj+1 (Qt\u03c0(e) (L0)) \u2265 \u03b5\nfor some e \u2208 Hnd,k and 1 \u2264 m \u2264 M}.\nFix t \u2208 T\u03b5 and let e \u2208 Hnd,k and 1 \u2264 m \u2264 M be such that\n\u2016fme,t \u2212 E(fme,t|B\u03c0(e),t(Lj))\u2016 Lj+1 (Qt\u03c0(e) (L0)) \u2265 \u03b5\nand write e\u2032 := \u03c0(e). Consider the partition of the cube Qte\u2032 (L0) into small cubes Qse\u2032 (Lj+2) where se\u2032 \u2208 \u0393Lj+2,Qe\u2032 \u2229 Qte\u2032 (L0). By the localization properties of the Lj+1(Q)-norm, and the fact that Lj+2 \u03b52 k Lj+1 we have that\n\u2016f\u20162k Lj+1 (Qte\u2032 (L0)) \u2264 Ese\u2032\u2208\u0393Lj+2,Qte\u2032 (L0) \u2016f\u2016 2k (Qse\u2032 (Lj+2)) +\n\u03b52 k\n2\nfor any function f : Qte\u2032 (L0) \u2192 [\u22121, 1]. Thus there exists a set S\u03b5,e,t \u2286 \u0393Lj+2,Qte\u2032 (L0) of size\n|S\u03b5,e,t| \u2265 \u03b52\nk\n4 |\u0393Lj+2,Qte\u2032 (L0)|\nsuch that\n(5.37) \u2016fme,t \u2212 E(fme,t|Be\u2032,t(Lj))\u20162 k\n(Qs e\u2032 (Lj+2)\n\u2265 \u03b5 2k\n4\nfor all se\u2032 \u2208 S\u03b5,e,t. For a given cube Q and functions f, g : Q \u2192 R, define the normalized inner\nproduct of f and g as\n\u3008f, g\u3009Q := Q f(x)g(x) dx.\nThen by the well-known property of the -norm, see for example [23] or the proof of Lemma 2.2, it follows from (5.37) that there exists sets\nBf\u2032,se\u2032 ,t \u2286 Qsf\u2032 (Lj+2)\nfor f\u2032 \u2208 \u2202e\u2032 such that (5.38) \u2329 fme,t \u2212 E(fme,t|Be\u2032,t(Lj)) ,\n\u220f f\u2032\u2208\u2202e\u2032 1Bf\u2032,s e\u2032 ,t \u232a Qs e\u2032 (Lj+2) \u2265 \u03b5 2k 2k+2 .\nIf s \u2208 \u0393Lj+2,Q then there is a unique t = t(s) \u2208 \u0393L0,Q such that s \u2208 Qt(L0). If t \u2208 T\u03b5 and se\u2032 \u2208 S\u03b5,e,t then we define the \u03c3-algebras Bf\u2032,e\u2032,s(Lj+2) on Qsf\u2032 (Lj+2) as follows. Write Bf\u2032,e\u2032,s = Bf\u2032,se\u2032 ,t where t = t(s) and let Bf\u2032,e\u2032,s(Lj+2) be the \u03c3-algebra generated by the set Bf\u2032,e\u2032,s and the \u03c3-algebra Bf\u2032,e\u2032,s\u2032(Lj) restricted to Qsf\u2032 (Lj+2) where s\n\u2032 \u2208 \u0393Lj ,Q is the unique element so that s \u2208 Qs\u2032(Lj). Note that that the complexity of the \u03c3-algebra Bf\u2032,e\u2032,s(Lj+2) is at most one larger than the complexity of the \u03c3-algebra Bf\u2032,e\u2032,s\u2032(Lj) as restricting a \u03c3-algebra to a set does not increase its complexity. If t = t(s) /\u2208 T\u03b5 or se\u2032 /\u2208 S\u03b5,e,t then let Bf\u2032,e\u2032,s(Lj+2) be simply the restriction of Bf\u2032,e\u2032,s\u2032(Lj) to the cube Qsf\u2032 (Lj+2), or equivalently define the sets Bf\u2032,e\u2032,s := Qsf\u2032 (Lj+2). Finally, let\n(5.39) Be\u2032,s(Lj+2) := \u2228\nf\u2032\u2208\u2202e\u2032 Bf\u2032,e\u2032,s(Lj+2)\nbe the corresponding \u03c3-algebra on the cube Qse\u2032 (Lj+2). Since the cubes Qse\u2032 (Lj+2) partition the cube Qte\u2032 (L0) as se\u2032 runs through the grid \u0393Lj+2,Qe\u2032 \u2229 Qte\u2032 (L0), these \u03c3-algebras define a \u03c3-algebra Be\u2032,t(Lj+2) on Qte\u2032 (L0), such that its restriction to the cubes Qse\u2032 (Lj+2) is equal to the \u03c3-algebras Be\u2032,s(Lj+2).\nSince the function \u220f\nf\u2032\u2208\u2202e\u2032 1Bf\u2032,e\u2032,s is measurable with respect to the \u03c3-algebra\nBe\u2032,t(Lj+2) restricted to the cube Qse\u2032 (Lj+2) one clearly has\n(5.40) \u3008 fme,t \u2212 E(fme,t|Be\u2032,t(Lj+2)), \u220f\nf\u2032\u2208\u2202e\u2032 1Bf\u2032,e\u2032,s \u3009Qse\u2032 (Lj+2) = 0\nand hence, by (5.38), that (5.41) \u3008E(fme,t|Be\u2032,t(Lj+2))\u2212 E(fme,t|Be\u2032,t(Lj)), \u220f\nf\u2032\u2208\u2202e\u2032 1Bf\u2032,e\u2032,s \u3009Qse\u2032 (Lj+2) \u2265\n\u03b52 k\n2k+2 .\nIt then follows from Cauchy-Schwarz and orthogonality, using the fact that the \u03c3-algebra Be\u2032,t(Lj+2)) is a refinement of Be\u2032,t(Lj+2), that\n\u2016E(fme,t|Be\u2032,t(Lj+2))\u2212 E(fme,t|Be\u2032,t(Lj))\u20162L2(Qse\u2032 (Lj+2))(5.42)\n= \u2016E(fme,t|Be\u2032,t(Lj+2))\u20162L2(Qs e\u2032 (Lj+2)) \u2212 \u2016E(fme,t|Be\u2032,t(Lj))\u20162L2(Qse\u2032 (Lj+2))\n\u2265 ( \u03b52k 2k+2 )2\nfor se\u2032\u2208S\u03b5,e,t. Since |S\u03b5,e,t|\u2265 \u03b52\nk\n4 |\u0393Lj+2,Qte\u2032(L0)| averaging over se\u2032\u2208\u0393Lj+2,Qte\u2032(L0)\nimplies\n(5.43) \u2016E(fme,t|Be\u2032,t(Lj+2))\u20162L2(Qte\u2032 (L0)) \u2265 \u2016E(f m e,t|Be\u2032,t(Lj))\u20162L2(Qte\u2032 (L0)) +\n\u03b52 k+2 22k+6 .\nAt this point we have shown that if t \u2208 T\u03b5 then there exists an edge e \u2208 Hnd,k, 1 \u2264 m \u2264 M , and \u03c3-algebras Be\u2032,t(Lj+2)) of scale Lj+2 on Qte\u2032 (L0), with e\n\u2032 = \u03c0(e), such that (5.43) holds.\nFor all e\u2032\u2032 \u2208 Hd,k with e\u2032\u2032 = e\u2032 let Bf\u2032,e\u2032\u2032,s(Lj+2) be the restriction of the \u03c3algebra Bf\u2032,e\u2032\u2032,s\u2032(Lj) to the cube Qsf\u2032 (Lj+2), where s\n\u2032 is such that s \u2208 Qs\u2032(Lj). By (5.39) this implies that Be\u2032\u2032,s(Lj+2) is also the restriction of Be\u2032\u2032,s\u2032(Lj) to the cube Qse\u2032\u2032 (Lj+2), and hence the \u03c3-algebra Be\u2032\u2032,t(Lj+2) is generated by the grid GLj+2,Qt\ne\u2032\u2032 (L0) and the \u03c3-algebra Be\u2032\u2032,t(Lj).\nWe have therefore defined a family of the \u03c3-algebras Be\u2032,t(Lj+2) for e\u2032 \u2208 Hd,k, satisfying\nM\u2211 m=1 \u2211 e\u2208Hnd,k \u2016E(fme,t|B\u03c0(e),t(Lj+2))\u20162L2(Qt\u03c0(e) (L0))\n\u2265 M\u2211\nm=1 \u2211 e\u2032\u2208Hnd,k \u2016E(fme,t|B\u03c0(e),t(Lj))\u20162L2(Qt\u03c0(e) (L0)) + \u03b52 k+2 22k+6 .\nUsing the fact that |T\u03b5| \u2265 \u03b5|\u0393L0,Q| and averaging over t \u2208 \u0393L0,Q it follows using the notations of (5.36) that\nE(fme,t|Be\u2032,t(Lj+2)) \u2265 E(fme,t|Be\u2032,t(Lj)) + \u03b52\nk+3\n22k+6 .\nAs the total energy E(fme,t|Be\u2032,t(Lj)) is bounded by O(M), the process must stop at a step j = O(M \u03b5\u22122 k+3\n) where (5.16) holds for a \u03c3-algebra of \u201clocal complexity\u201d at most j, completing the proof of Lemma 5.2.\n6. The base case of an inductive strategy to establish Theorem 1.4\nIn this section we will ultimately establish the base case of our more general inductive argument. We will however start by giving a (new) proof of Theorem B\u2032, namely the case d = 1 of Theorem 1.4.\n6.1. A single simplex in Zn. Let \u03940 = {v1 = 0, v2, . . . , vn1} be a fixed nondegenerate simplex of n1 points in Z\nn with n = 2n1 + 3 and define tkl := vk \u00b7 vl for 2 \u2264 k, l \u2264 n1. Recall, see [17], that a simplex \u0394 = {m1 = 0, . . . , mn1} \u2286 Zn is isometric to \u03bb\u03940 if and only if mk \u00b7ml = \u03bb2tkl for all 2 \u2264 k, l \u2264 n1.\nFor any positive integer q and \u03bb \u2208 q \u221a N we define S\u03bb\u03940,q(m2, . . . , mn1) : Zn(n1\u22121) \u2192 {0, 1} be the function whose value is 1 if mk \u00b7ml = \u03bb2tkl with both mk and ml in (qZ)\nn for all 2 \u2264 k, l \u2264 n1 and is equal to 0 otherwise. It is a well-known fact in number theory, see [11] or [17], that for n \u2265 2n1 + 1 we have that\u2211\nm2,...,mn1\nS\u03bb\u03940,q(m2, . . . ,mn1) = \u03c1(\u0394 0) (\u03bb/q)(n\u2212n1)(n1\u22121)(1 +O(\u03bb\u2212\u03c4 ))\nfor some absolute constant \u03c4 > 0 and some constant \u03c1(\u03940) > 0, the so-called singular series, which can be interpreted as the product of the densities of the solutions of the above system of equations among the p-adics and among the reals. Thus if we define\n\u03c3\u03bb\u03940,q := \u03c1(\u0394 0)\u22121(\u03bb/q)\u2212(n\u2212n1)(n1\u22121)S\u03bb\u03940,q\nthen \u03c3\u03bb\u03940,q is normalized in so much that\u2211 m2,...,mn1 \u03c3\u03bb\u03940,q(m2, . . . ,mn1) = 1 +O(\u03bb \u2212\u03c4 )\nfor some absolute constant \u03c4 > 0. Let Q \u2286 Zn be a fixed cube and let l(Q) denotes its side length. For any family\nof functions\nf1, . . . , fn1 : Q \u2192 [\u22121, 1] and 0 < \u03bb l(Q) we define the following two multi-linear expressions\nN 1\u03bb\u03940,q,Q(f1, . . . , fn1) (6.1)\n:= Em1\u2208Q \u2211\nm2,...,mn1\nf1(m1) . . . fn1(mn1) \u03c3\u03bb\u03940,q(m2 \u2212m1, . . . ,mn1 \u2212m1)\nand\n(6.2) M1\u03bb,q,Q(f1, . . . , fn1) := Et\u2208Q Em1,...,mn1\u2208t+Q(q,\u03bb) f1(m1) . . . fn1(mn1),\nwhere Q(q, \u03bb) := [\u2212\u03bb2 , \u03bb 2 ] n \u2229 (qZ)n. Note that if S \u2286 Q and N 1\u03bb\u03940,q,Q(1S , . . . , 1S) > 0 then S must contain an isometric copy of \u03bb\u0394\n0, while if |S| \u2265 \u03b4|Q| for some \u03b4 > 0 then as before Ho\u0308lder implies that\n(6.3) M1\u03bb,q,Q(1S , . . . , 1S) \u2265 \u03b4n \u2212O(\u03b5) for all scales \u03bb \u2208 q \u221a N with 0 < \u03bb \u03b5 l(Q).\nRecall that for any 0 < \u03b5 1 and positive integer q we call a sequence L1 \u2265 \u00b7 \u00b7 \u00b7 \u2265 LJ (\u03b5, q)-admissible if Lj/Lj+1 \u2208 N and Lj+1 \u03b52Lj for all 1 \u2264 j < J and LJ/q \u2208 N. Note that if \u03bb1 \u2265 \u00b7 \u00b7 \u00b7 \u2265 \u03bbJ\u2032 \u2265 1 is any lacunary sequence in q \u221a N with J \u2032 (log \u03b5\u22121) J+log q, one can always finds an (\u03b5, q)-admissible sequence of scales L1 \u2265 \u00b7 \u00b7 \u00b7 \u2265 LJ with the property that for each 1 \u2264 j < J the interval [Lj+1, Lj ] contains at least two consecutive elements from the original lacunary sequence.\nIn light of these observations we see that the following \u201ccounting lemma\u201d ultimately establishes a quantitatively stronger version of Proposition B\u2032 that appeared in Section 1.3 and hence immediately establishes Theorem 1.4 for d = 1.\nProposition 6.1. Let 0 < \u03b5 1 and qj := q1(\u03b5)j for j \u2265 1 with q1(\u03b5) := lcm{1 \u2264 q \u2264 C\u03b5\u221210}."
        },
        {
            "heading": "There exists J1 = O(\u03b5",
            "text": "\u22122) such that for any (\u03b5, qJ1)-admissible sequence of scales\nl(Q) \u2265 L1 \u2265 \u00b7 \u00b7 \u00b7 \u2265 LJ1 and S \u2286 Q there is some 1 \u2264 j < J1 such that\n(6.4) N 1\u03bb\u03940,qj ,Q(1S , . . . , 1S) = M 1 \u03bb,qj ,Q(1S , . . . , 1S) +O(\u03b5) for all \u03bb \u2208 qj \u221a N with Lj+1 \u2264 \u03bb \u2264 Lj.\nAs in the continuous setting the proof of Proposition 6.1 has two main ingredients, namely Lemmas 6.1 and 6.2. In these lemmas, and for the remainder Sections 6 and 7, we will continue to use the notation\nq1(\u03b5) := lcm{1 \u2264 q \u2264 C\u03b5\u221210}\nfor any given \u03b5 > 0.\nLemma 6.1 (A generalized von Neumann inequality). Let 0 < \u03b5 1, q, q\u2032 \u2208 N with qq1(\u03b5)|q\u2032, and \u03bb \u2208 q \u221a N with \u03bb l(Q) and 1 L \u03b510\u03bb. For any collection of functions f1, . . . , fn1 : Q \u2192 [\u22121, 1] we have\n(6.5) |N 1\u03bb\u03940,q,Q(f1, . . . , fn1)| \u2264 min 1\u2264i\u2264n1 \u2016fi\u2016U1 q\u2032,L(Q) +O(\u03b5)\nwhere for any function f : Q \u2192 [\u22121, 1] we define\n(6.6) \u2016f\u2016U1q,L(Q) := ( 1 |Q| \u2211 t\u2208Q |f \u2217 \u03c7q,L(t)|2 )1/2\nwith \u03c7q,L denoting the normalized characteristic function of the cubes Q(q, L) := [\u2212L2 , L 2 ] n \u2229 (qZ)n.\nFor any cube Q \u2286 Zn of side length l(Q) and q, L \u2208 N satisfying q L with L dividing l(Q), we shall now partitionQ into cubic gridsQt(q, L) = t+((qZ)\nn\u2229Q(L)), with Q(L) = [\u2212L2 , L 2 ]\nn as usual. These grids form the atoms of a \u03c3-algebra Gq,L,Q. Note that if q|q\u2032 and L\u2032|L then Gq,L,Q \u2286 Gq\u2032,L\u2032,Q.\nLemma 6.2 (A Koopman-von Neumann type decomposition). Let 0 < \u03b5 1 and qj := q1(\u03b5)\nj for all j \u2265 1. There exists an integer J\u03041 = O(\u03b5\u22122) such that any (\u03b5, qJ\u03041)-admissible sequence of scales l(Q) \u2265 L1 \u2265 \u00b7 \u00b7 \u00b7 \u2265 LJ\u03041 and function f : Q \u2192 [\u22121, 1] there is some 1 \u2264 j < J\u03041 such that\n(6.7) \u2016f \u2212 E(f |Gqj ,Lj ,Q)\u2016U1qj+1,Lj+1 (Q) \u2264 \u03b5.\nThe reduction of Proposition 6.1 to these two lemmas is essentially identical to the analogous argument in the continuous setting as presented at the end of Section 3.1, we choose to omit the details.\nProof of Lemma 6.1. We will rely on some prior exponential sum estimates, specifically Propositions 4.2 and 4.4 in [17]. First we deal with the case n1 \u2265 3. By the change of variables m1 := m1, mi := mi \u2212m1 for 2 \u2264 i \u2264 n1, one may write\nN 1\u03bb\u03940,q,Q(f1, . . . , fn1) := Em1\u2208QN \u2211\nm2,...,mn1\nf1(m1)f2(m1 +m2) \u00b7 \u00b7 \u00b7 fn1(m1 +mn1) \u03c3\u03bb\u03940,q(m2, . . . ,mn1).\nWe now write\n\u03c3\u03bb\u03940,q(m2, . . . ,mn1) = \u03c3\u03bb\u03940\u2032,q(m2, . . . ,mn1\u22121) \u03c3 m2,...,mn1\u22121 \u03bb,q (mn1),\nwhere \u03940\u2032 = {v1 = 0, v2, . . . , vn1\u22121} and for each m2, . . . , mn1\u22121 \u2208 (qZ)n we are using \u03c3\nm2,...,mn1\u22121 \u03bb,q (m) denote the (essentially) normalized indicator function of the\nsubset of (qZ)n that contains m if and only if m \u00b7mk = \u03bb2tkn1 for all 2 \u2264 k \u2264 n1.\nUsing the fact that |fi| \u2264 1, together with Cauchy-Schwarz and Plancherel, one can then easily see that (6.8) |N 1\u03bb\u03940,q,Q(f1, . . . , fn1)|2 \u2264 |Q|\u22121 \u02c6 \u03be\u2208Tn |f\u0302n1(\u03be)|2H\u03bb,q(\u03be) d\u03be\nwith\nH\u03bb,q(\u03be) = \u2211\nm2,...,mn1\n\u03c3\u03bb\u03940\u2032,q(m2, . . . ,mn1\u22121) | \u0302\u03c3 m2,...,mn1\u22121 \u03bb,q (\u03be)|2.\nIt then follows by Propositions 4.2 and 4.4 in [17], with \u03b4 = \u03b54 and after rescaling by q, that in addition to being non-negative and uniformly bounded in \u03be we in fact have\n(6.9) H\u03bb,q(\u03be) = O(\u03b5) whenever \u2223\u2223\u2223\u2223q\u03be \u2212 lq1(\u03b5) \u2223\u2223\u2223\u2223 \u2265 q\u03b54\u03bb,\nfor all l \u2208 Zn. We note that the expression H\u03bb,q(\u03be) may be interpreted as the Fourier transform of the indicator function of the set of integer points on a certain variety, and estimate (6.9) indicates that this concentrates near rational points of small denominator. It is this crucial fact from number theory which makes results like Theorem B\u2032 possible.\nSince\n\u03c7\u0302q,L(\u03be) = qn\nLn \u2211 m\u2208[\u2212L2 , L 2 ) n, q|m e\u22122\u03c0im\u00b7\u03be\nit is easy to see that \u03c7\u0302q,L(l/q) = 1 for all l \u2208 Zn and that there exists some absolute constant C > 0 such that\n(6.10) 0 \u2264 1\u2212 \u03c7\u0302q,L(\u03be)2 \u2264 C L |\u03be \u2212 l/q| for all \u03be \u2208 Tn and l \u2208 Zn. It is then easy to see using our assumption that qq1(\u03b5)|q\u2032 that\n(6.11) 0 \u2264 H\u03bb,q(\u03be)(1\u2212 \u03c7\u0302q\u2032,L(\u03be)2) \u2264 C\u03b5 for some constant C > 0 uniformly in \u03be \u2208 Tn provided L \u03b55\u03bb. Substituting inequality (6.7) into (6.8), we obtain\n|N 1\u03bb\u03940,q,Q(f1, . . . , fn1)|2 \u2264 |Q|\u22121 (\u02c6 |f\u0302n1(\u03be)|2H\u03bb(\u03be)\u03c7\u0302q\u2032,L(\u03be)2 d\u03be + \u02c6 |f\u0302n1(\u03be)|2H\u03bb(\u03be)(1\u2212 \u03c7\u0302q\u2032,L(\u03be)2) d\u03be )\n\u2264 \u2016fn1\u20162U1 q\u2032,L(Q) +O(\u03b5)\nprovided L \u03b55\u03bb. This proves Lemma 6.1 for k \u2265 3, as it is clear that by reindexing the above estimate holds for any of the functions fi in place of fn1 . For n1 = 2 an easy modification of arguments in [14], specifically the proof of Lemma 3 therein, establishes that\n|N 1\u03bb\u03940,q,Q(f1, f2)|2 \u2264 \u2016fi\u20162U1 q\u2032,L(Q) +O(\u03b5)\nfor i = 1, 2 provided L \u03b55\u03bb.\nProof of Lemma 6.2. Let q, L \u2208 N such that L|N , q|L. The \u201cmodulo q\u201d grids Qt(q, L) = t+Q(q, L) partition the cube Q with t running through the set \u0393q,L,Q = {1, . . . , q}n + \u0393L,Q, where \u0393L,Q denote the centers of the \u201cinteger\u201d grids t+Q(L)\nin an initial partition of Q. Let q\u2032, L\u2032 be positive integers so that q|q\u2032, L\u2032|L and L\u2032 \u03b52L. If s \u2208 \u0393q\u2032,L\u2032,Q and t \u2208 Qs(q\u2032, L\u2032) then |t\u2212 s| = O(L\u2032) and hence\nEx\u2208Qt(q,L)g(x) = Ex\u2208Qs(q,L)g(x) +O(L \u2032/L)\nfor any function g : Q \u2192 [\u22121, 1]. Moreover, since the cube Qs(q, L) is partitioned into the smaller cubes Qt(q \u2032, L\u2032), we have by Cauchy-Schwarz\n|Ex\u2208Qs(q,L) g(x)|2 \u2264 Et\u2208\u0393q\u2032,L\u2032,Qs(q,L) |Ex\u2208Qt(q\u2032,L\u2032)g(x)| 2.\nFrom this it is easy to see that\n\u2016g\u20162U1q,L(Q) = Et\u2208Q|Ex\u2208Qt(q,L)g(x)| 2 \u2264 Et\u2208\u0393q\u2032,L\u2032,Q |Ex\u2208Qt(q\u2032,L\u2032)g(x)| 2 +O(L\u2032/L)\nand we note that the right side of the above expression is \u2016E(g|Gq\u2032,L\u2032,Q)\u20162L2(Q) since the conditional expectation function E(g|Gq\u2032,L\u2032,Q) is constant and equal to Ex\u2208Qt(q\u2032,L\u2032)g(x) on the cubes Qt(q\n\u2032, L\u2032). Now suppose (6.7) does not hold for some j \u2265 1, that is\n\u2016f \u2212 E(f |Gqj ,Lj ,Q)\u20162U1qj+1,Lj+1 (Q) \u2265 \u03b5 2.\nSince Lj+2 \u03b52Lj+1, Lj+2|Lj , and qj+1|qj+2 we can apply the above observations to g := f \u2212 E(f |Gqj ,Lj ,Q) and obtain, by orthogonality, that\n(6.12) \u2016E(f |Gqj+2,Lj+2,Q)\u20162L2(Q) \u2265 \u2016E(f |Gqj ,Lj ,Q)\u20162L2(Q) + c\u03b52\nfor some constant c > 0. Since the above expressions are clearly bounded by 1, the above procedure must stop in O(\u03b5\u22122) steps at which (6.7) must hold for some 1 \u2264 j \u2264 J\u03041(\u03b5) with J\u03041(\u03b5) = O(\u03b5\u22122).\n6.2. The base case of our general inductive strategy. Let Q = Q1\u00d7 . . .\u00d7Qd with Qi \u2286 Z2ni+3 be cubes of equal side length l(Q) and \u03940i \u2286 Z2ni+3 be a nondegenerate simplex of ni points for 1 \u2264 i \u2264 d.\nWe note that for any q0 \u2208 N and scale L0 dividing l(Q) if t = (t1, . . . , td) \u2208 \u0393q0,L0,Q, then the corresponding grids Qt(q0, L0) in the partition of Q take the form Qt(q0, L0) = Qt1(q0, L0)\u00d7 \u00b7 \u00b7 \u00b7 \u00d7Qtd(q0, L0).\nAs in the continuous setting we will ultimately need a parametric version of Proposition 6.1, namely Proposition 6.2.\nProposition 6.2 (Parametric counting lemma on Zn for simplices). Let 0 < \u03b5 \u2264 1 and R \u2265 1."
        },
        {
            "heading": "There exists an integer J1 = J1(\u03b5,R) = O(R\u03b5",
            "text": "\u22124) such that for any (\u03b5, qJ1)admissible sequence of scales L0 \u2265 L1 \u2265 \u00b7 \u00b7 \u00b7 \u2265 LJ1 with L0 dividing l(Q) and qj := q0q1(\u03b5) j for 0 \u2264 j \u2264 J1 with q0 \u2208 N, and collection of functions\nf i,rk,t : Qti(q0, L0)\u2192 [\u22121, 1] with 1\u2264 i\u2264d, 1\u2264k\u2264ni, 1\u2264r\u2264R and t \u2208 \u0393q0,L0,Q there exists 1 \u2264 j < J1 and a set T\u03b5 \u2286 \u0393q0,L0,Q of size |T\u03b5| \u2264 \u03b5|\u0393q0,L0,Q| such that\n(6.13) N 1\u03bb\u03940i ,qj ,Qti (q0,L0)(f i,r 1,t , . . . , f i,r ni,t) = M 1 \u03bb,qj ,Qti (q0,L0) (f i,r1,t , . . . , f i,r ni,t) + O(\u03b5) for all \u03bb \u2208 qj \u221a N with Lj+1 \u2264 \u03bb \u2264 Lj and t /\u2208 T\u03b5 uniformly in 1 \u2264 i \u2264 d and 1 \u2264 r \u2264 R.\nThis proposition follows, as the analogous result did in the continuous setting, from Lemma 6.1 and the following parametric version of Lemma 6.2.\nLemma 6.3 (A simultaneous Koopman-von Neumann type decomposition). Let 0 < \u03b5 1, m \u2265 1, and Q \u2286 Zn be a cube. There exists an integer J\u03041 = O(m\u03b5\u22123) such that for any (\u03b5, qJ\u03041)-admissible sequence L0 \u2265 L1 \u2265 \u00b7 \u00b7 \u00b7 \u2265 LJ\u03041 with L0 dividing l(Q) and qj := q0q1(\u03b5)\nj for 0 \u2264 j \u2264 J\u03041 with q0 \u2208 N, and collection of functions f1,t, . . . fm,t : Qt(q0, L0) \u2192 [\u22121, 1]\ndefined for each t \u2208 \u0393q0,L0,Q, there is some 1 \u2264 j < J\u03041 and a set T\u03b5 \u2286 \u0393q0,L0,Q of size |T\u03b5| \u2264 \u03b5|\u0393q0,L0,Q| such that (6.14) \u2016fi,t \u2212 E(fi,t|Gqj ,Lj ,Qt(q0,L0)\u2016U1qj+1,Lj+1 (Qt(q0,L0)) \u2264 \u03b5\nfor all 1 \u2264 i \u2264 m and t /\u2208 T\u03b5.\nLemma 6.3 is of course the discrete analogue of Lemma 3.2. Since the proofs of Proposition 6.2 and Lemma 6.3 are almost identical to the arguments presented in Section 3.2 we choose to omit these details.\n7. Proof of Theorem 1.4: The general case\nAfter the preparations in Section 6 we can proceed very similarly as in Section 5 to prove our main result in the discrete case, namely Theorem 1.4. The main difference will be that given 0 < \u03b5 1 and 1 \u2264 k \u2264 d, we construct a positive integer qk(\u03b5) and assume that all our sequences of scales will be (\u03b5, qk(\u03b5))-admissible. The cubes Qt(L) will be naturally now be replaced by the grids Qt(q, L) of the form that already appear in Section 6 where we always assume q|L.\nLet \u03940 = \u039401 \u00d7 . . .\u00d7\u03940d with each \u03940i \u2286 Z2ni+3 a non-degenerate simplex of ni points for 1 \u2264 i \u2264 d and Q = Q1 \u00d7 . . .\u00d7Qd \u2286 Zn with Qi \u2286 Z2ni+3 cubes of equal side length l(Q) (taken much larger than the diameter of \u03940). We will use the same parameterizations in terms of hypergraph bundles Hnd,k and corresponding notations as in Section 5 to count the configurations \u0394 = \u03941 \u00d7 . . .\u00d7\u0394d \u2286 Q with each \u0394i \u2286 Qi an isometric copy of \u03bb\u03940i for some \u03bb \u2208 \u221a N.\nGiven any positive integer q and \u03bb \u2208 q \u221a N we will make use of the notation\n(7.1)\u2211 xi f(xi) \u03c3 i \u03bb,q(xi) := Exi1\u2208Qi \u2211 xi2,...,xini f(xi) \u03c3\u03bb\u03940i ,q(xi2 \u2212 xi1, . . . , xini \u2212 xi1) dxi1\nwith \u03c3\u03bb\u03940i ,q as defined in the previous section and xi = (xi1, . . . , xini) \u2208 Q ni i .\nNote that if S \u2286 Q then the density of configurations \u0394 in S, of the form \u0394 = \u03941 \u00d7 . . .\u00d7\u0394d with each \u0394i \u2286 Qi an isometric copy of \u03bb\u03940i for some \u03bb \u2208 q \u221a N is given by the expression\n(7.2) N d\u03bb\u03940,q,Q(1S ; e \u2208 H n d,d) := \u2211 x1 \u00b7 \u00b7 \u00b7 \u2211 xd \u220f e\u2208Hnd,d 1S(xe) \u03c3 1 \u03bb,q(x1) . . . \u03c3 d \u03bb,q(xd).\nMore generally, for any given 1 \u2264 k \u2264 d and a family of functions fe : Q\u03c0(e) \u2192 [\u22121, 1] with e \u2208 Hnd,k we define the multi-linear expression\n(7.3) N d\u03bb\u03940,q,Q(fe; e \u2208 H n d,k) := \u2211 x1 \u00b7 \u00b7 \u00b7 \u2211 xd \u220f e\u2208Hnd,k fe(xe) \u03c3 1 \u03bb,q(x1) . . . .\u03c3 d \u03bb,q(xd)\nas well as\n(7.4) Md\u03bb,q,Q(fe; e \u2208 H n d,k) := Et\u2208Q Mdt+Q(q,L) (fe; e \u2208 H n d,k),\nwhere Q(q, L) = Q1(q, L)\u00d7\u00b7 \u00b7 \u00b7\u00d7Qd(q, L) with each Qi(q, L) = (qZ\u2229 [\u2212L2 , L 2 ]) 2ni+3 and\n(7.5) Md \u02dcQ (fe; e \u2208 Hnd,k) := Ex1\u2208 \u02dcQn11 \u00b7 \u00b7 \u00b7 Exd\u2208 \u02dcQndd \u220f e\u2208Hnd,k fe(xe)\nfor any cube Q\u0303 \u2286 Q of the form Q\u0303 = Q\u03031 \u00d7 \u00b7 \u00b7 \u00b7 \u00d7 Q\u0303d with Q\u0303i \u2286 Qi for 1 \u2264 i \u2264 d. We note that it is easy to show, as in the continuous, that if S \u2286 Q with |S| \u2265 \u03b4|Q| for some \u03b4 > 0 then\n(7.6) Md\u03bb,q,Q(1S ; e \u2208 H n d,d) \u2265 \u03b4n1\u00b7\u00b7\u00b7nd \u2212O(\u03b5) for all scales \u03bb \u2208 q \u221a N with 0 < \u03bb \u03b5 l(Q). In light of this observation and the\ndiscussion preceding Proposition 6.1 the proof of Theorem 1.4 reduces, as it did in the continuous setting, to the following\nProposition 7.1. Let 0 < \u03b5 1. There exist positive integers Jd = Jd(\u03b5) and qd(\u03b5) such that for any (\u03b5, qd(\u03b5)\nJd)-admissible sequence of scales l(Q) \u2265 L1 \u2265 \u00b7 \u00b7 \u00b7 \u2265 LJ1 and S \u2286 Q there is some 1 \u2264 j < Jd such that\n(7.7) N d\u03bb\u03940,qj ,Q(1S ; e \u2208 H n d,d) = Md\u03bb,qj ,Q(1S ; e \u2208 H n d,d) +O(\u03b5), for all \u03bb \u2208 qj \u221a N with Lj+1 \u2264 \u03bb \u2264 Lj with qj := qd(\u03b5)j.\nQuantitative Remark. A careful analysis of our proof reveals that there exist choices of Jd(\u03b5) and qd(\u03b5) which are less than Wd(log(C\u0394\u03b5 \u22123)) and Wd(C\u0394\u03b5 \u221213) respectively whereWk(m) is again the tower-exponential function defined byW1(m) = exp(m) and Wk+1(m) = exp(Wk(m)) for k \u2265 1.\nThe proof of Proposition 7.1 follows along the same lines as the analogous result in the continuous setting. As before we will compare the averages N d\u03bb\u03940,q,Q(fe; e \u2208 Hnd,k) to those of Md\u03bb,q,Q(fe; e \u2208 H n d,k), at certain scales q and \u03bb \u2208 q \u221a N with with Lj+1 \u2264 \u03bb \u2264 Lj , inductively for 1 \u2264 k \u2264 d. As the arguments closely follow those given in Section 5 we will be brief and emphasize mainly just the additional features.\n7.1. Reduction of Proposition 7.1 to a more general \u201clocal\u201d counting lemma. For any given 1 \u2264 k \u2264 d and a family of functions fe : Q\u03c0(e) \u2192 [\u22121, 1] with e \u2208 Hnd,k it is easy to see that for any \u03b5 > 0, scale L0 > 0 dividing the side-length l(Q), and q0|q we have\n(7.8) N d\u03bb\u03940,q,Q(fe; e \u2208 H n d,k) = Et\u2208\u0393q0,L0,Q N d \u03bb\u03940,q,Qt(q0,L0) (fe,t; e \u2208 Hnd,k) +O(\u03b5)\nand\n(7.9) Md\u03bb,q,Q(fe; e \u2208 H n d,k) = Et\u2208\u0393L,Q Md\u03bb,q,Qt(q0,L0)(fe,t; e \u2208 H n d,k) +O(\u03b5)\nprovided 0 < \u03bb \u03b5L0 where fe,t denotes the restriction of a function fe to the cube Qt(q0, L0).\nThus the proof of Proposition 7.1 reduces to showing that the expressions in (7.8) and (7.9) only differ by O(\u03b5) for all scales \u03bb \u2208 q \u221a N with Lj+1 \u2264 \u03bb \u2264 Lj , given an (\u03b5, q)-admissible sequence L0 \u2265 L1 \u2265 \u00b7 \u00b7 \u00b7 \u2265 LJ , for any collection of bounded functions fe,t, e \u2208 Hnd,k, t \u2208 \u0393q0,L0,Q. Indeed, our crucial result will be the following\nProposition 7.2 (Local counting lemma in Zn). Let 0 < \u03b5 1 and q0,M \u2208 N. There exist positive integers Jk = Jk(\u03b5,M) and qk(\u03b5) such that for any (\u03b5, qJd)admissible sequence of scales L0 \u2265 L1 \u2265 \u00b7 \u00b7 \u00b7 \u2265 LJ1 with L0 dividing l(Q) and qj := q0 qk(\u03b5) j for j \u2265 1, and collection of functions\nfme,t : Qt\u03c0(e)(q0, L0) :\u2192 [\u22121, 1] with e \u2208 H n d,k, 1 \u2264 m \u2264 M and t \u2208 \u0393q0,L0,Q\nthere exists 1 \u2264 j < Jk and a set T\u03b5 \u2286 \u0393q0,L0,Q of size |T\u03b5| \u2264 \u03b5|\u0393q0,L0,Q| such that\n(7.10) N d\u03bb\u03940,qj ,Qt(q0,L0)(fe,t; e \u2208 H n d,k) = Md\u03bb,qj ,Qt(q0,L0)(fe,t; e \u2208 H n d,k) +O(\u03b5) for all \u03bb \u2208 qj \u221a N with Lj+1 \u2264 \u03bb \u2264 Lj and t /\u2208 T\u03b5 uniformly in e \u2208 Hnd,k and 1 \u2264 m \u2264 M .\nNote that if k = d, L0 = l(Q), q0 = M = 1, then |\u0393q0,L0,Q| = 1, and moreover if fe,t = 1S for all e \u2208 Hnd,k for a set S \u2286 Q, then Proposition 7.2 reduces to precisely Proposition 7.1. In fact, Proposition 7.2 is a parametric, multi-linear and simultaneous extension of Proposition 7.1 which we need in the induction step, i.e. when going from level k \u2212 1 to level k.\n7.2. Proof of Proposition 7.2. We will prove Proposition 7.2 by induction on 1 \u2264 k \u2264 d.\nFor k = 1 this is basically Proposition 6.2, exactly as it was in the base case of the proof of Proposition 5.3.\nFor the induction step we will again need two main ingredients. The first establishes that the our multi-linear forms N d\u03bb\u03940,q,Q(fe; e \u2208 H n d,k) are controlled by a box-type norm attached to scales q\u2032 and L. Let Q = Q1 \u00d7 . . . \u00d7 Qd with Qi \u2286 Z2ni+3 be cubes of equal side length l(Q) and 1 \u2264 k \u2264 d. For any scale 0 < L l(Q) and function f : Qe\u2032 \u2192 [\u22121, 1] with e\u2032 \u2208 Hd,k we define its local box norm at scales q\u2032 and L by\n(7.11) \u2016f\u20162k q\u2032,L(Qe\u2032 ) := Es\u2208Qe\u2032\u2016f\u2016 2k (Qs(q\u2032,L)),\nwhere (7.12) \u2016f\u20162k ( \u02dcQ) := Ex11,x12\u2208 \u02dcQ1 \u00b7 \u00b7 \u00b7 Exk1,xk2\u2208 \u02dcQk \u220f\n( 1,..., k)\u2208{1,2}k f(x1 1 , . . . , xk k)\nfor any cube Q\u0303 of the form Q\u0303 = Q\u03031 \u00d7 \u00b7 \u00b7 \u00b7 \u00d7 Q\u0303k. We note that (7.4) and (7.5) are special cases of (7.11) and (7.12) with k = d, n = (2, . . . , 2), and fe = f for all e \u2208 Hnd,d.\nLemma 7.1 (A generalized von-Neumann inequality on Zn). Let 1 \u2264 k \u2264 d. Let 0 < \u03b5 1, q, q\u2032 \u2208 N with qq1(\u03b5)|q\u2032, and \u03bb \u2208 q \u221a N with \u03bb l(Q) and 1 L (\u03b52k)10\u03bb. For any collection of functions fe : Q\u03c0(e) \u2192 [\u22121, 1] with e \u2208 Hnd,k we have both\n(7.13) |N d\u03bb\u03940,q,Q(fe; e \u2208 H n d,k)| \u2264 min e\u2208Hnd,k \u2016fe\u2016 q\u2032,L\u2032 (Q\u03c0(e)) +O(\u03b5)\nand\n(7.14) |Md\u03bb,q,Q(fe; e \u2208 H n d,k)| \u2264 min e\u2208Hnd,k \u2016fe\u2016 q\u2032,L\u2032 (Q\u03c0(e)).\nThe proof of inequalities (7.13) and (7.14) follow exactly as in the continuous case, see Lemma 5.1, using Lemma 6.1 in place of Lemma 3.1. We omit the details.\nThe crucial ingredient is again a parametric weak hypergraph regularity lemma, i.e. Lemma 5.2 adapted to the discrete settings. The proof is essentially the same as in the continuous case, with exception that the Lj -norms are replaced by qj ,Lj - norms where qj = q0q\nj is a given sequence of positive integers and L0 \u2265 L1 \u2265 \u00b7 \u00b7 \u00b7 \u2265 LJ is an (\u03b5, qJ)-admissible sequence of scales. To state it we say that a \u03c3-algebra B on a cube Q is of scale (q, L) if it is refinement of the grid Gq,L,Q, i.e. if its atoms partition each cube Qt(q, L) of the grid. We will always assume that q|L and L|l(Q). Recall also that we say the complexity of a \u03c3-algebra B is at most m, and write complex(B) \u2264 m, if it is generated by m sets.\nLemma 7.2 (Parametric weak hypergraph regularity lemma for Zn). Let 0 < \u03b5 1, 1 \u2264 k \u2264 d, q0, q, L0,M \u2208 N, and let qj := q0qj for j \u2265 1. There exists J\u0304k = O(M\u03b5\u22122 k+3 ) such that for any (\u03b52 k\n, qJ\u0304k)-admissible sequence L0 \u2265 L1 \u2265 \u00b7 \u00b7 \u00b7 \u2265 LJ\u0304k with the property that L0 divides l(Q) and collection of functions\nfme,t : Qt\u03c0(e)(q0, L0) \u2192 [\u22121, 1] with e \u2208 H n d,k, 1 \u2264 m \u2264 M , and t \u2208 \u0393q0,L0,Q\nthere is some 1 \u2264 j < J\u0304k and \u03c3-algebras Be\u2032,t of scale (qj , Lj) on Qte\u2032 (q0, L0) for each t \u2208 \u0393q0,L0,Q and e\u2032 \u2208 Hd,k such that (7.15) \u2016fme,t \u2212 E(fme,t|B\u03c0(e),t)\u2016 qj+1,Lj+1 (Qt\u03c0(e) (L0)) \u2264 \u03b5\nuniformly for all t /\u2208 T\u03b5, e \u2208 Hnd,k, and 1 \u2264 m \u2264 M , where T\u03b5 \u2286 \u0393q0,L0,Q with |T\u03b5| \u2264 \u03b5|\u0393q0,L0,Q|.\nMoreover, the \u03c3-algebras Be\u2032,t have the additional local structure that the exist \u03c3algebras Be\u2032,f\u2032,s on Qsf\u2032 (qj , Lj) with complex(Be\u2032,f\u2032,s) = O(j) for each s \u2208 \u0393qj ,Lj ,Q, e\u2032 \u2208 Hd,k, and f\u2032 \u2208 \u2202e\u2032 such that if s \u2208 Qt(q0, L0), then\n(7.16) Be\u2032,t \u2223\u2223 Qs\ne\u2032 (qj ,Lj) = \u2228 f\u2032\u2208\u2202e\u2032 Be\u2032,f\u2032,s.\nThe proof of Lemma 7.2 follows exactly as the corresponding proof of Lemma 5.2 in the continuous setting, so we will omit the details. We will however provide some details of how one deduces Proposition 7.2, from Lemmas 7.1 and 7.2. The arguments are again very similar to those in the continuous setting, however one needs to make a careful choice of the integers qk(\u03b5), appearing in the statement of the Proposition.\nProof of Proposition 7.2. Let 2 \u2264 k \u2264 d and assume that the lemma holds for k\u22121. Let 0 < \u03b5 1 and \u03b51 := exp (\u2212C1\u03b5\u22122 k+3\n) for some large constant C1 = C1(n, k, d) 1.\nWe then define qk(\u03b5) := qk\u22121(\u03b51) recalling that q1(\u03b5) := lcm{1 \u2264 q \u2264 C\u03b5\u221210} and note that it is easy to see by induction that qk(\u03b5)|qk(\u03b5\u2032) for 0 < \u03b5\u2032 \u2264 \u03b5 and qk\u22121(\u03b5)|qk(\u03b5). We further define the function F (\u03b5) := Jk\u22121(\u03b51,M) with M = \u03b5 \u03b5\u221211 and recall that qj := q0 qk(\u03b5)\nj for j \u2265 1. We now proceed exactly as in the proof of Proposition 5.3 but with {Lj}j\u22651 being\na (\u03b51, q \u02dcJ )-admissible sequence of scales, with J\u0303 F (\u03b5) J\u0304k(\u03b5,M). We again choose a subsequence {L\u2032j} \u2286 {Lj} so that L\u20320 = L0 and index(L\u2032j+1) \u2265 index(L\u2032j)+F (\u03b5)+2, but also now set q\u2032j = qj\u2032 , where j\n\u2032 := index(L\u2032j). Lemma 7.2 then guarantees the existence of \u03c3-algebras Be\u2032,t of scale (q\u2032j , L\u2032j) on Qte\u2032 (q0, L0) for each t \u2208 \u0393q0,L0,Q and\ne\u2032 \u2208 Hd,k, with the local structure described above, such that (7.15) holds uniformly for all t /\u2208 T \u2032\u03b5, e \u2208 H n d,k, and 1 \u2264 m \u2264 M , for some 1 \u2264 j < J\u0304k(\u03b5,M) = O(M\u03b5\u22122 k+3 ), where T \u2032\u03b5 \u2286 \u0393q0,L0,Q with |T \u2032\u03b5| \u2264 \u03b5|\u0393q0,L0,Q|. Arguing as in the proof of Proposition 5.3 we can conclude from this that for each j\u2032 \u2264 l < J \u2032 we have (7.17)\nN d\u03bb\u03940,ql,Qs(q\u2032j ,L\u2032j)(f m e,s; e\u2208H n d,k)= \u2211 r \u03b1s,r,mN d\u03bb\u03940,ql,Qs(q\u2032j ,L\u2032j) (g r f,s; f \u2208 H n d,k\u22121)+O(\u03b5)\nand (7.18)\nMd\u03bb,ql,Qs(q\u2032j ,L\u2032j)(f m e,s; e \u2208 H n d,k) = \u2211 r \u03b1r,s,m Md\u03bb,ql,Qs(q\u2032j ,L\u2032j) (g r f,s; f \u2208 H n d,k\u22121)+O(\u03b5)\nprovided (\u03b5\u22122 k )10L\u2032j+1 \u03bb with \u03bb \u2208 ql \u221a N, where each |\u03b1s,re | \u2264 1 and number of index vectors r = (re)e\u2208Hnd,k is R D with D := |Hnd,k| and hence RD \u2264 M if C1 1.\nBy induction, we apply Proposition 7.2 to the sequence of scales L\u2032j = Lj\u2032 \u2265 Lj\u2032+1 \u2265 \u00b7 \u00b7 \u00b7 \u2265 LJ\u2032 = L\u2032j+1 with \u03b51 > 0 and for ql := q\u2032j qk(\u03b5)l\u2212j \u2032 = qj\u2032 qk\u22121(\u03b51) l\u2212j\u2032 where j\u2032 \u2264 l \u2264 J \u2032 with respect to the family of functions grs,f : Qsf(q \u2032 j , L \u2032 j) \u2192 [\u22121, 1]. This is possible as J \u2032 \u2212 j\u2032 Jk\u22121(\u03b51, RD) and our sequence of scales is (\u03b51, qJ\u2032)admissible. Thus there exists an index j\u2032 \u2264 l < J \u2032 such that for all \u03bb \u2208 ql \u221a N with Ll+1 \u2264 \u03bb \u2264 Ll we have (7.19)\nN d\u03bb\u03940,ql,Qs(q\u2032j ,L\u2032j) (g r f,s; f \u2208 H n d,k\u22121) = Md\u03bb,ql,Qs(q\u2032j ,L\u2032j) (g r f,s; f \u2208 H n d,k\u22121) +O(\u03b51)\nuniformly in r for s /\u2208 S\u03b51 , where S\u03b51 \u2286 \u0393q\u2032j ,L\u2032j ,Q is a set of size |S\u03b51 | \u2264 \u03b51|\u0393q\u2032j ,L\u2032j ,Q|. The remainder of the proof follows as just as it did for Proposition 5.3."
        },
        {
            "heading": "8. Appendix: A short direct proof of part (i) of Theorem B\u2032",
            "text": "We conclude by providing a short direct proof of Part (i) of Theorem B\u2032, namely the following\nTheorem 8.1 (Magyar [17]). Let 0 < \u03b4 \u2264 1 and \u0394 \u2286 Z2k+3 be a non-degenerate simplex of k points.\nIf S \u2286 Z2k+3 has upper Banach density at least \u03b4, then there exists an integer q0 = q0(\u03b4) and \u03bb0 = \u03bb0(S,\u0394) such that S contains an isometric copy of q0\u03bb\u0394 for\nall \u03bb \u2208 \u221a N with \u03bb \u2265 \u03bb0.\nFor any \u03b5 > 0 we define\nq\u03b5 := lcm{1 \u2264 q \u2264 C\u03b5\u221210}\nwith C > 0 a (sufficiently) large absolute constant. Following [14] we further define S \u2286 Zn to be \u03b5-uniformly distributed (modulo q\u03b5) if its relative upper Banach density on any residue class modulo q\u03b5 never exceeds (1 + \u03b5\n2) times its density on Zn, namely if \u03b4\u2217(S | s+ (q\u03b5Z)d) \u2264 (1 + \u03b52) \u03b4\u2217(S) for all s \u2208 {1, . . . , q\u03b5}d. It turns out that this notion is closely related to the U1q,L(Q)-norm introduced in Section 6. Recall that for any cube Q \u2286 Zn and\nfunction f : Q \u2192 [\u22121, 1] we define (8.1) \u2016f\u2016U1q,L(Q) := ( 1 |Q| \u2211 t\u2208Q |f \u2217 \u03c7q,L(t)|2 )1/2\nwith \u03c7q,L denoting the normalized characteristic function of the cubes Q(q, L) := [\u2212L2 , L 2 ]\nn\u2229(qZ)n. Note that the U1q,L(Q)-norm measures the mean square oscillation of a function with respect to cubic grids of size L and gap q.\nThe following observation from [14] (specifically Lemmas 1 and 2) is key to our short proof of Theorem 8.1.\nLemma 8.1. Let \u03b5 > 0. If S \u2286 Zn be \u03b5-uniformly distributed with \u03b4 := \u03b4\u2217(S) > 0, then there exists an integer L = L(S, \u03b5) > 0 and cubes Q of arbitrarily large side length l(Q) with l(Q) \u03b5\u22124L such that\n\u20161S \u2212 \u03b41Q\u2016U1q\u03b5,L(Q) = O(\u03b5).\nLet \u03940 = {v1 = 0, v2, . . . , vk} be a fixed non-degenerate simplex of k points in Zn with n = 2k + 3 and define tij := vi \u00b7 vj for 2 \u2264 i, j \u2264 k. We now define a function which counts isometric copies of \u03bb\u03940.\nRecall, see [17], that a simplex \u0394 = {m1 = 0, . . . , mk} \u2286 Zn is isometric to \u03bb\u03940 if and only if mi \u00b7 mj = \u03bb2tij for all 2 \u2264 i, j \u2264 k. For any \u03bb \u2208 \u221a N we define S\u03bb\u03940(m2, . . . , mk) : Z n(k\u22121) \u2192 {0, 1} be the function whose value is 1 if mi \u00b7mj = \u03bb2tij for all 2 \u2264 i, j \u2264 k and is equal to 0 otherwise. It is a well-known fact in number theory, see [11] or [17], that for n \u2265 2k + 1 we have that\u2211\nm2,...,mk\nS\u03bb\u03940(m2, . . . ,mk) = \u03c1(\u0394 0)\u03bb(n\u2212k)(k\u22121)(1 +O(\u03bb\u2212\u03c4 ))\nfor some absolute constant \u03c4 > 0 and constant \u03c1(\u03940) > 0, the so-called singular series, which can be interpreted as the product of the densities of the solutions of the above system of equations among the p-adics and among the reals. Thus if we define\n\u03c3\u03bb\u03940 := \u03c1(\u0394 0)\u22121\u03bb\u2212(n\u2212k)(k\u22121)S\u03bb\u03940\nthen \u03c3\u03bb\u03940 is normalized in so much that\u2211 m2,...,mk \u03c3\u03bb\u03940(m2, . . . ,mk) = 1 +O(\u03bb \u2212\u03c4 )\nfor some absolute constant \u03c4 > 0. Let Q \u2286 Zn be a fixed cube and let l(Q) denotes its side length. For any family\nof functions\nf1, . . . , fk : Q \u2192 [\u22121, 1] and 0 < \u03bb l(Q) we define (8.2)\nN 1\u03bb\u03940,Q(f1, . . . , fk) :=Em1\u2208Q \u2211\nm2,...,mk\nf1(m1) . . . fk(mk)\u03c3\u03bb\u03940(m2\u2212m1, . . . ,mk\u2212m1).\nIt is clear that if f1 = \u00b7 \u00b7 \u00b7 = fk = 1S restricted to Q, then the above expression is a normalized count of the isometric copies of \u03bb\u03940 in S \u2229Q. Thus, Theorem 8.1 will follow from Lemma 8.1 and the following special case (with q = 1) of Lemma 6.1.\nLemma 8.2 (A generalized von Neumann inequality). Let 0 < \u03b5 1. If \u03bb \u2208 \u221a N with \u03bb l(Q) and 1 L \u03b510\u03bb then for any collection of functions f1, . . . , fk : Q \u2192 [\u22121, 1] we have (8.3) |N 1\u03bb\u03940,Q(f1, . . . , fk)| \u2264 min\n1\u2264j\u2264k \u2016fj\u2016U1q\u03b5,L(Q) + O(\u03b5).\nThis compares with the purely number theoretic fact that the number of simplices \u0394 = {v1 = 0, v2, . . . , vk} \u2286 Zn isometric to \u03bb\u03940 is asymptotic to \u03c1(\u03940)\u03bb(n\u2212k)(k\u22121). Thus, under the same conditions as in Lemma 8.2, we have\n(8.4) N 1\u03bb\u03940,Q(1Q, . . . , 1Q) = 1 +O(\u03bb\u2212\u03c4 ) +O(\u03b5) provided one also has \u03bb \u03b5l(Q).\nProof of Theorem 8.1. Let 0 < \u03b5 \u03b4k and S \u2286 Zn be a set of upper Banach density \u03b4.\nWe assume first that S is \u03b5-uniformly distributed. Select a scale L = L(\u03b5, S) and a sufficiently large cube Q so that the conclusion of Lemma 8.1 holds. For a given \u03bb \u2208 \u221a N with \u03bb \u03b5l(Q) and L \u03b510\u03bb write 1S = \u03b41Q + g and substitute this decomposition into the multi-linear expression N 1\u03bb\u03940,Q(1S , . . . , 1S). Then by Lemma 8.2 and (8.3)\u2013(8.4), we have that\n(8.5) N 1\u03bb\u03940,Q(1S, . . . , 1S) \u2265 \u03b4k \u2212O(\u03b5)\nand we can conclude that S must contain an isometric copy of \u03bb\u03940. If S is not \u03b5-uniformly distributed, then its upper Banach density is increased to at least \u03b41 := (1 + \u03b5 2)\u03b4 when restricted to a residue class s + (q\u03b5Z)\nn. Identify s + (q\u03b5Z)\nn with Zn and simultaneously the set S|s+(q\u03b5Z)n with a set S1 \u2286 Zn, via the map y \u2192 q\u22121\u03b5 (y\u2212 s). Note that if S1 is \u03b5-uniformly distributed then it contains an isometric copy of \u03bb\u03940 for all sufficiently large \u03bb \u2208 \u221a N and hence S contains an isometric copy of q\u03b5\u03bb\u0394 0.\nRepeating the above procedure one arrives to a set Sj = q \u2212j \u03b5 (S \u2212 sj) \u2286 Zn for some sj \u2208 Zn in j = O(log \u03b5\u22121) steps which contains an isometric copy of \u03bb\u03940 for all sufficiently large \u03bb \u2208 \u221a N."
        }
    ],
    "title": "WEAK HYPERGRAPH REGULARITY AND APPLICATIONS TO GEOMETRIC RAMSEY THEORY",
    "year": 2022
}